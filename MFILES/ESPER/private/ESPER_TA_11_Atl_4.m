function [Y,Xf,Af] = ESPER_TA_11_Atl_4(X,~,~)
%ESPER_TA_11_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:03.
% 
% [Y] = ESPER_TA_11_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-143.241523403244;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.00458552991639557;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.5902028101376313174;4.1316246060772634507;-5.9227146516632496187;-2.1321944503757443989;-4.5433413606312758048;0.41246790706842689778;-0.52086562178960793545;0.1019793976010447828;2.0925192959995841946;1.3669291479059060279;0.74451146977156346107;-0.54755853877731730517;0.98525565275674087395;0.22931868618254300229;1.4668846972593154732;-0.73301167640815334536;-0.39086521903313475867;-1.1214081444809598231;-0.31149901303912463923;-10.148817146515922261;0.91733639386185394926;1.7467238948457668446;-1.0024122517183862158;-2.2093444612008599215;-0.87740154238370426931;0.073909028676942961633;2.657921123821802567;-4.1896201156692587375;-0.10426598593366137591;-0.9801658988763107816];
IW1_1 = [2.1818164673719611102 -2.8025257854169267624 -1.9244109507813471627 0.083627451579583178543 0.28986180867739652633 0.61954316079648175108 -1.1180490380573762099;0.52995955705512720613 -0.21764790660158811475 2.0406408253166015143 -0.15338513470722126009 -3.0875716343173098544 0.14103459560723741184 1.100789839741274978;0.97537251093144627934 2.3110502151962855066 -1.298177165215838258 0.55013037529531572112 2.0256704707285075884 1.1213190639222145872 -1.0316164140702110963;0.055179616256014016318 1.1681096724393176256 -0.95723782695202408455 -0.55404149716866446518 -0.58777042690323544338 -0.920442408663453282 -1.1966912662857234206;-0.57854956476482877203 0.017610864632981188677 0.10062144209854738397 0.74291717024051295848 5.9440845633918302227 0.40186940693058043061 0.55737389092282563219;-0.30660725351674128492 -0.65787401794517952336 -0.42302814493840978916 0.38820270479599155999 -2.9590649452972357381 -0.10887268452703791066 0.78204368122607559322;1.7907861251947587711 1.4230115236862965755 -0.65131070878560415327 -0.88244224206530863519 -2.4732324480061880223 0.26930505518644681784 -0.49322792549988492272;0.019630724569411780317 -1.3885490070935924134 -0.44617135789914852406 0.36482414870796397999 -1.8867640780907177778 -0.20503948651030473593 -0.40909423033808323122;-0.70373550134420170821 -1.8340757279034740623 1.9326030791616553017 0.56289905441882537307 -0.73184214345777198751 -0.3553774251140101037 0.63487398244014159321;-1.1765698237734567577 0.49653369047413925541 0.41167401816401227865 0.38562741788085447281 0.69572892517930939871 -1.3644337720659482915 -1.8192616382651762841;-0.12922651740762755579 0.11553940532120912654 0.60572772260109208897 -0.0099770307475319577883 -1.7989187080835999932 0.33629734868836042017 -0.1018794484796456401;-0.18479612256712707463 1.648411517057133846 -1.2709729011194799142 -0.39944022743497459293 0.49093181809915542591 0.17952877609794692937 -0.23240839407437499653;0.54797763320806303078 -0.4612828904900865834 2.6203173883051458226 1.3029174392021822815 -2.1482198653889263973 1.3704844899617043552 0.72808609895668530143;0.32971363781078727451 0.57511183663180509562 -1.2476822678614443163 -0.8431212432557870784 1.9109414671512150452 -1.5024269252508464234 0.22764038757844656802;1.618439392725210757 -0.99936533276348371579 -0.26873630957541128073 0.20782632296481218237 -3.8708842110249386259 0.3240840847128492741 -1.6250758004204888252;0.36431768589128210589 -1.9538577438549193932 1.3371286919723113229 -1.5047529082167616643 0.79051525343294315462 -2.1533321910110565511 -0.13824585981620512998;0.21757855816919272063 -0.29130672832834081376 0.76795801744716229997 -0.093302879824077963877 1.0508217910462129829 -0.62079272299388998935 -0.092506460814987895303;-1.408654180651265575 -0.30648194171844556077 -0.61079248180716105843 0.31176183506718035954 -1.1681271962874189008 1.4556167367530601364 2.1679022473790494629;0.12699148010165192679 -1.8748476488770990933 0.08377707375144047286 -0.16027941380832139151 -0.45207212311222794154 0.46365063746196244487 0.59072544582999919616;1.1301453367770317726 -0.40646278884827513611 1.9769792063298978757 1.6162032549903802003 13.162197418664492332 1.3241859084448750483 0.60902878108778790711;-0.77973465868776292709 0.44292663993330866345 -1.1727785390774747576 -0.31512186054513269262 -0.5644752701517276039 0.39922744858566860948 -1.020740926624773337;0.50554073676099331447 -0.099511474074194763983 -1.3441414549763692765 0.50070772624178494503 -2.7596429944956106795 0.52411568647416939548 -2.1418220142476611656;-1.5414766382729059302 0.2528517846422869142 0.30497450232810258131 -1.2075831067822691001 1.0142811137853005032 -0.72787152915325870062 1.5705631181096055826;-0.18038094993729214544 2.6796352615909353467 -1.5978971049714500996 1.2520759004714050455 1.3083316238313109636 -1.4839464966904027943 1.111076030666432235;1.568288133248534777 -0.97638171965694375842 3.0913727098847880725 0.27819838655906115044 1.766582209718359886 0.31507618034928930317 0.63597216136904988204;-0.16041660283746272952 -0.45949779662548828618 -0.64489716985849787623 1.4977558046913783674 -3.9487319229961514999 -0.63763877489071463245 -1.0025625471693182522;0.98228000672153359396 -0.28179844098419865039 -0.30878750833538221032 -0.26502352233200310305 -0.27187566424459141956 -1.9548494359893979766 -1.3992274374587605479;-4.6047263017116613071 0.66861736078611266887 2.3348534670456349005 -0.36316491744417445098 1.5417416340861884727 -1.5912683506456839488 1.3791428659820348379;-0.87622495450883075563 -0.53452491011621727779 0.57129382304766251899 -0.90418310876195440162 -1.7549292095265640601 -0.68220322207147277016 1.6717093746127473786;-1.8424010296793902342 -0.44524551524771277533 2.4116205787140589933 0.31619662999758296751 -0.099178657458230012889 -0.22343825882057843923 1.3392124100962841116];

% Layer 2
b2 = [-2.3842298147916283213;0.16580177107179139284;-1.8773607197164561278;1.119948365850204075;-1.7299631244672966091;-3.5820650521285535284;-4.8523703708601662044;4.441600591348326077;1.9511741721867097432;0.57357626896591629162];
LW2_1 = [-1.7235213111928291418 -0.94123326220941805342 0.88155756037124444191 1.0059050989361966177 2.8319288477699053885 2.8809437510539539495 3.0433774397623332142 -0.6336084296577413344 1.7542181088295181191 0.52905736255320368056 -2.5003310846295399017 -0.89773549920047168715 -2.8382899211811851714 1.7739989496729200447 1.7175625011623139038 -0.21972658554345783632 -0.91261796943163098206 -2.3176295767102983447 0.51422294074832008981 -0.10213258888931606161 2.1169937634063202836 -2.7366257727352207851 -2.5186852331664071336 0.45657037330113164897 0.84538909388299898762 0.93600190029713570272 -0.84047828228288368191 1.2417180503199403141 0.65324852942880551332 0.52480481950195889684;-0.26191824398102681037 -0.24612080154587578917 -2.5967201085053490672 -2.9383089712834631335 -0.53834097494320165556 -0.036892283852263396682 -0.15082693865674534628 -0.38112910379402076266 -0.067218161539028237206 0.59149814409719947417 0.67075006316069929468 -0.53555779146572279892 0.24803587872626223221 0.67233829153448021465 -0.21109832251725163532 0.46683680975062491481 0.78909384364701695702 -0.092752246974739771535 -0.86253888918809307196 -0.23177526088652092295 -0.48364020141980723633 0.70520743107883410161 0.62546227680221411216 0.87839969979634946462 -1.5388954733424007326 2.1934596949301745639 -0.52233683905577199535 3.0061372832850588033 1.9861045163458705964 -1.3772227627438153874;-0.23683983993439103322 1.1488496691856115994 -2.7081400654179459409 -2.4727819194713105411 0.074314178233243544103 -0.27350016852645192555 0.43882605799020424353 0.57824249693891260904 1.7906228659646941104 -1.2991968321782325635 -0.45790435727891037887 1.4972616144727635135 1.0889593734175710971 -0.37191863113464729285 -0.72441376620790509655 -0.77000536119904106069 0.33862284839126488567 3.2521509090519407081 0.38769344579384684701 -0.43413978790329105228 -0.63122671828794874038 2.3010480645911077779 -0.14484708736191770351 0.086479338584605547346 -1.6712634008466928925 4.5094289135914671363 0.73016392264669460754 -5.7813829483413119448 1.8632787094478058254 0.10883305154671776838;0.69538484819468382447 -0.41678541138138630595 -1.0849316652453844245 -1.1464513466000012532 0.38106132966279809837 1.1883696083037322833 0.089610839442301082336 0.35467121406929358329 -1.0680132631698104895 0.44939235329435472943 -0.22245330697801882214 1.3664451593395638973 0.31523248582363733172 -0.59896324410908496905 0.55659230207499399423 -0.19743124269884551603 1.2290266933475382238 -0.7761939167721526589 0.69228036394764036476 -0.36124730748499972455 1.9087785011594509132 0.57668102275658517097 1.229563019804059687 0.74269548241924998599 -1.5837324813229571863 -0.035668639849682763632 2.2697036351409227706 1.2915319443382418108 1.0685173203683073773 0.19252115307093214946;0.59872626573821330354 -0.0025109700247235716697 0.49675859059684718266 0.10527164194601246194 -2.0657501144605645571 -1.3943589970924668009 0.38524002317780298155 0.3498945275483750228 0.59273241694075073926 -0.13192812431642739202 0.78800357240239771173 0.59323748216575700187 -0.58088658415426441817 -0.95613734859396093402 -0.2426968411161090633 0.17810807961448749115 0.17494216357128858363 0.76640496675713953856 -0.25045479617468607847 -0.32209555129194045175 -0.82357579858166363174 0.26558962149414044873 -0.76439683339084041336 0.50972933272041087704 0.055376221383522022945 0.55878447698748112682 0.27178016042196539992 -0.052117116969267227033 0.87536282113151930862 0.33184612484995651416;1.3202423621069381277 0.075030337221380194457 -2.5474000735493969039 -0.19099878964500979772 0.64641254898471878221 0.55930779206861924724 0.3534774984092199368 -0.52309883800763390393 0.85906695031981750166 0.90750906424132016248 -0.00091588668905486989025 -0.60213987317178940817 -1.0095006151780503423 -1.1531845674536487234 0.36141756690944726316 -0.21050813396213990947 0.50055565117210620851 -0.097537103702989291776 -0.29989597636339165865 0.50539211927292204685 0.54384073672619070994 -1.7179620848238223996 -0.33072755122600477895 0.52675291331630746949 -0.29604834122319534373 0.73580470157119914898 0.094341585303572783605 -3.3995990662754440592 -2.1790805496259255669 0.90527268655442161283;-0.16835028930519307933 -0.57561559823247065992 -1.7801437208682897584 -2.4813932946999135432 0.68337524474704369748 -0.83761526221993187757 0.20667585284806994084 -0.3451127608663726587 0.16340024117239856927 0.40578813278430631017 -0.92413607283722210006 -0.66301393075871173366 -0.32184405922613595896 -0.64290228732823095914 0.18977838533504745588 0.015178798804886366181 0.89137618640305249507 -0.662628609923541112 -0.43781922690257918385 0.3883411025226881641 0.65492304708091741983 -1.1415917504638843916 0.65051672805861193716 0.65238133305788936767 -1.0331514043731337971 -0.04154064310804182758 -0.68891419946797005647 -1.211033624208281978 0.74596098879674621607 -0.9083958170285763023;2.8556700842034730137 1.2279641563802290438 -1.2391982604982925142 -0.18568041406486818223 -0.53208921097262718014 0.60098649922549784996 -0.42891873679394237895 -0.38374907745269920545 0.62991691548439254777 1.4811689894214596919 -0.55957877111754916744 -2.4126605297185412802 0.40142747767728159669 1.8794837593544282406 -1.7443619510151262553 -0.72013640638208875622 1.255496799220364057 -0.24969395231071397911 0.27281717696245133542 0.5468456548639073489 1.6311495722577860068 -0.056753417025325950118 0.37019399059054536316 0.099568753444325863722 -0.020713026236190604235 -2.2271396492564239367 -4.0080592229512932434 3.4912938932818442517 0.10919240921606615524 -0.018740274290602990798;-0.27165551200588794467 1.0151939111129639759 -0.23167634295116562582 -0.25300652758847114177 -0.78188465116622474227 -0.33144039607656422541 0.11700840228725077619 0.23504298574237836306 0.22940565325252126883 0.78181302873265812181 -0.74901274506329684755 -0.093792926666046799733 0.38868310439707315362 -0.96448283134645784731 -0.97116406702945246021 -0.52935658818479314203 -1.2395205023246265164 -0.71543237678572768612 0.44123561216233436744 0.32273321229592560888 -0.29328250029321178971 0.99674575873413062688 0.15056123806796115061 -0.13925737445097874367 -0.50392525171108137894 -0.41843420828537425393 -1.303283748281977017 0.78722305202456588358 1.2734483543357064672 -0.75241049164294271367;-0.44982775725365786723 -1.2038386376016783075 0.52411297767429321226 -0.82989259111046465023 -0.76719928601798181855 -1.1062297064510715483 0.56179879958054157463 0.66721867216714803028 -0.12282268976198601473 -0.098983320440138661267 0.47486763891782857172 -0.016402211342275895001 0.037807748328396423299 -0.13198771568013878408 -0.93433064988818836927 -0.64042042002835031234 1.5411891270542685817 -1.4161553593282913965 1.127710428711210966 0.10162047423032435911 0.46627850585971436503 0.04143888947524260874 0.57860443269229644425 -0.34207077484248232802 -0.37807106440316029516 0.55703034209181412351 0.60517946160505675657 1.0599135770615433216 1.9897496321248959728 -0.64233916179095595922];

% Layer 3
b3 = -0.14124442854979757378;
LW3_2 = [0.60926402004936863754 -0.078111915705135120946 -0.0099449890239124132812 0.0020137162220713890858 -1.3109119807235094513 -0.090886187131903634073 0.14971163477146506859 0.12865254950441323833 -0.094141252495406849143 -0.057126034875331813123];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
