function [Y,Xf,Af] = ESPER_talk_4_Atl_3(X,~,~)
%ESPER_TALK_4_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:45.
% 
% [Y] = ESPER_talk_4_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.4157089009129435;3.0816675028776186;1.2913702484895755;3.7343304593008293;4.6733448402720317;1.5556694779942823;1.5438164884556369;1.3194770954886612;-2.060858690481373;-3.0751382642138174;0.081662512618215083;-0.42309831640235945;1.931709784391394;-1.5959557559817015;1.1606175323774335;0.75501246971960989;2.6698074619460024;-1.418067279657957;-1.2284374207593489;1.9708489104910019;1.8486809127821398;1.7015428874583249;2.479509243346385;-4.0368319172487448;0.9300324086728774];
IW1_1 = [-0.088806852006714565 0.0075311132726756172 -1.4786989484570185 -0.12170052777758428 0.49850148555655294 -0.28890337757255252 1.1714965331707698;-2.3563601810642338 1.8314143208848921 -0.31523847498804541 -0.087130005972621827 1.8777360478001972 -1.239058112652869 1.2531418988478273;-1.4874003180770323 1.5244672873634471 -0.42439631744876999 -0.11134429177770902 -0.78383186215672374 1.5804671526825951 -0.27474206686747482;0.32011197848788214 -2.3139632031080639 0.040292235851946072 0.26244853173796828 -6.0436905768001532 0.13736963811432185 -0.99397911393056348;-1.8881692503577583 2.5874407258394685 1.5697054610584171 0.35233477752779541 -2.2759985254081725 -0.62491196246588177 0.73715181805746655;-0.12835928464221558 -0.92005769347805844 2.8752208617126249 -0.25243745671303075 -1.4732907442160945 0.90636826931347003 0.35873969785410365;-0.93253742337753487 -0.10253730095689381 3.2210311189382779 0.93973383219319617 -0.74002369467014806 -0.88934581941983415 1.2159986624659858;-0.48388315743812738 0.93274545499998496 1.6711524018438584 -0.14794407410615848 2.0354475784877928 1.3991127755099233 0.35376832596988256;1.4320325774345075 -0.076577251201022711 -1.8131427852003177 0.17659880161740701 3.3199502393781293 0.28850980030401985 -1.0002502920065279;0.22148447706088564 -0.7885606621096295 -0.34902028367714222 -0.22347706498897196 2.4455937970600532 -0.88207345926317782 -0.6936967763062305;-0.37083592482089595 0.12193273623874205 -0.092947487167511833 -0.12787739164947468 -0.97277120290353825 -1.3128380598441229 -0.90475865043308379;-0.49141848537881422 0.42609546392734743 1.1685168879038794 0.37414775378502735 3.6229716900608717 1.3302555048919475 1.8457255559903036;0.48278076352062371 -1.8362366810471076 -0.38828987333650511 1.34197547057799 1.265649398760154 1.0618771500972783 -2.1452743781292032;0.16066864034472944 -1.1453481326368125 -2.5251208763210653 -0.7350883183843171 3.8559780160404684 0.50476215015158021 2.1760339243024012;1.2620956145647972 -0.92884477991722891 -0.19054516655514012 -0.020723719522557936 2.1783208744998253 1.7567352033991266 1.9106731279432383;1.2241070819819126 -1.3712806997637774 1.8798639253736913 0.084640578210163908 -0.67074227924760899 0.063383998842255179 1.4071909712806292;4.5786658180226292 -0.51141350545435516 1.6071159636185279 1.6336772833712665 2.1134270784874181 -1.5455432812167089 -1.6211573163393205;0.7069362042304943 0.81043725760262686 0.41574171323972881 1.1866428829645814 1.8817790021709899 0.99744769406755207 -0.62131039667302856;-0.15066348046662309 0.32398592741251953 3.6208076931637985 -1.0098506131629232 -4.1430736706948625 0.66954014773859438 -0.06878271908840225;1.125564603570721 -0.81250241841408521 0.51799448575151918 -0.78988698668679558 0.67575929693572823 -1.0902986993737285 -0.98637232759705895;1.7964423173916051 -0.48728347344328315 -0.034333785211741963 0.94898721218023541 1.1239251654981424 0.24433140918901008 2.4644131376410794;-0.32113478785403604 0.77210329831487112 -0.26341383457966772 -0.27978045705650767 0.68151864101718873 -2.1847044475447954 -1.1023099853159422;0.30728861882807745 -1.4709339561695176 -0.33729318391787999 -1.4253581348333642 1.0582348850891392 -0.37457331120531523 -0.93407425775522057;0.44046010675212399 -0.38625349424364164 0.84122997108065212 0.086116177146354542 -1.3434083278740931 -1.0978413639829938 -2.2479139471670053;2.875127979822627 0.18064597122777049 0.76794399733458674 1.5060924682392975 2.8155255114661522 -0.94976253842728875 -2.9376412448323079];

% Layer 2
b2 = [2.1057567092101626;-3.0925916144684154;-1.6297605998675133;-0.72534785985633821;-1.1274791171945564;-0.76160215499779327;-0.27020043473257793;0.45733335279752413;-0.14850312011305727;0.09304072569926132;-0.98969223379081317;-1.5428104363392601;1.4248417722759417;-1.5649579918196046;-1.4005085603130769];
LW2_1 = [-0.67187604559253922 1.083131721894973 0.84770256281873535 -0.33795446336198109 0.13042899049567433 0.28061380225362048 1.4977064071283868 -0.4318617249443446 0.17582000354942834 -0.60937971398941493 1.0588738869481127 -0.27094410345034614 -0.26277106707595721 -0.99912273956642972 0.72849017244413472 0.013138710116135818 1.8359382334213559 0.70338936629608351 0.65196584739550312 0.90340267311259381 -1.2698471951469548 -0.2318214345686562 0.032433871508066897 0.97158303659364353 1.2002473795095974;0.59583662920370928 2.374729514523966 1.2514011207581073 -0.35542172275939399 1.1394493845096338 1.7814571322816248 -3.4076122383977188 -1.5987089257144655 1.6380593141009803 -0.33853254931489274 1.0132308171711206 0.25173319439304731 0.98312873004463508 -1.86535572613951 -1.6258512870342976 1.4550703100349462 -0.036594370401252956 -0.51189179137283425 -0.30646517585946931 -1.4437750187203915 0.062888749417309278 -1.8027851162197288 -1.8045044997071236 -1.8628935612654647 -0.19621876097166516;0.71786636005353166 2.132488518768719 0.40642730498900975 -0.56543341520699886 0.3499584009559239 0.096524797938003282 -0.93217083214554242 -0.92850967139598173 1.7429010556353643 -1.1892905305348336 -1.3292885918068178 -2.0388685640104138 0.34935594410522358 -0.79206183423858922 -2.9163403052930463 0.88084675435642645 0.57080492244086434 -0.47395039941884187 -2.3033489746588134 0.17568742517308114 -0.61926392692377219 -0.59106313952150202 0.18950046192442768 -0.86704431010853822 -2.3171014896426367;1.2643307407625219 -1.5254875726007924 -1.0959751497327439 0.51594432649201172 -1.1211290788651511 -0.17008611705739946 1.4486273638401026 -0.084247428760480025 1.6119996652328212 -1.938745366199075 1.5801964513146984 -0.075378806199436432 -0.59117661339282468 -0.33021196404847342 -0.38532759961174279 0.34501921369638811 -0.71434313754228973 0.28785900911604029 0.82313175469947986 -0.18286724533677567 -0.8630576383737476 1.4277865795408882 0.19272189484455118 2.0176577267890119 0.13781733025179582;0.55319469453412562 -0.19295616095881402 0.044055916762605521 -0.69537434154736244 -0.00069276308503487226 0.06285416480232249 0.39569225516663109 0.3509361691884354 2.8748171144556598 1.280883478629796 -0.52128771653565253 -0.17183451949385814 1.7471592545966879 0.33745833055779695 -1.2003348213734997 0.49081764622436896 -0.46228956556237472 0.68967249518986518 0.84352261507644732 -0.78652155850612704 -0.66058659617204074 -0.47168650719045147 -0.17299936695725646 0.41550999655577181 0.50789836307729463;0.9666750263210695 -0.20639185172101004 0.20061005337238313 -0.14862006495257274 -0.46616887611769781 -0.13829169617407427 0.5554414325585989 0.45947092706687859 0.82156892919133717 1.5260015219380505 0.065651041552008516 0.96602334833941383 -0.030300380554660774 0.18761807392156715 0.55791905184557022 0.59720542127066367 0.019026723023857467 0.15362883004468217 -0.97242188252902884 -0.88011333724704499 -0.92280166242642381 -0.31511384879646698 -0.85037895349989223 -1.5901461530889729 -0.62977387455157918;0.98199293432641277 -1.3878746313925805 0.64728468372725834 0.8055982817840609 -0.76409859470589003 0.16961402289702479 0.76141212777374101 0.59445652085656331 1.4071410000812601 -1.733127381309632 1.2973135566429062 0.75850320927072845 1.3250245976158883 -2.5662513175281942 0.47789911106267435 -0.76537537710475489 0.39200446159834246 -0.20906485756852367 -2.0624148451044868 -0.40320712198880909 -0.47404734010871868 -0.84268907900390189 -0.035784787093589787 -2.3880584045132029 -1.8745167219433363;-1.1205536148342321 -0.44204425925655777 1.166093780507772 -0.24703472296957918 -0.24605820958151556 0.21656227018912488 0.064641584967498111 -0.56529152788700621 0.77609223052274401 0.8688702667360505 0.33018559558312155 0.043410850177856432 0.81005323074339353 0.28013957799221828 1.5167223152127534 1.3891185048867551 0.68243604857879381 0.086752159433958226 1.4299331844319418 0.65575971995993398 -1.4227547075430962 -0.12104774531502127 0.78973627207280617 -1.5500506935180189 -2.2202034062411649;-0.059775475155026334 -0.27098637459961378 -0.37989763229677559 -0.14342788175309171 1.9508145994394694 -0.92148355300947227 -0.42706240525340738 1.1014538056547103 1.541118398912823 0.58986279784868723 -0.27430534775497895 0.2579702398884966 0.29497402884694213 -0.061279011571659492 -0.7430917257982731 -0.1348564485128021 1.6060132284416642 -0.40585840561572251 -0.10440733955144776 -0.023454384976626091 -0.012837556907557474 -0.088495366206154197 0.35800950347243105 -1.3007753632821477 -1.6173616721346946;-0.90576013408184808 0.29851695091041791 -0.93078598044362926 -1.7764415217918994 -0.11628089961961779 -0.92807494008336699 -0.50563645042091587 -0.11588296300978726 -1.3646835929039969 0.71440096202257708 1.5228116029311363 0.67794675405916816 0.84348727525654987 1.1476981104908963 1.2778792723883419 -1.9046596421217403 0.74619053850352801 -0.43973573676982414 0.2747245114910648 -0.65523584220298825 2.5762656009847671 -1.2298208356925264 -0.2167623075937222 -1.4848834342435484 0.72668058813507619;2.4804508084724208 1.1183913337498699 -1.2292244217510544 -1.5281653208720498 -1.6286713100017789 -1.0431927740226405 -0.83322536049370854 -0.27315828919539076 0.25304329969286071 0.033771356098294014 -0.82040474003415242 0.66517750103106865 -0.6568129393958444 -1.1942318878395553 -0.90736541918714952 -0.13819537883513877 -0.0073215768274777146 2.2180342707652412 -0.60851799360743841 -0.86754509723183737 -0.90205208060560038 -0.23474370125990834 -0.42406957664831241 -0.27379837111314415 -0.005470134983003333;-0.29246127410354505 0.89791671974156151 0.66532438310148168 6.0902899093326326 -0.16157135987579105 0.47388930334844026 0.55863978848322227 -1.1519480347813051 1.2764484165973216 -1.4907394869947397 0.7281802673240183 -0.13926588022965544 -0.95201445084914704 0.69205315791133681 1.2850437213592127 2.2293940439299043 -1.8280729328872491 0.48152739906564485 -0.60980127335797263 -0.44971479522241192 -1.4128070143749805 0.11561668091130739 -0.5343504076673935 0.72951076152201411 -2.2409960880649455;2.178859743120535 0.30887420605005772 0.32032320759209898 0.89894096989038919 -0.18473912681536525 1.5719393983043044 -0.40174407322556455 -0.2621971371333886 0.035933360970745662 -2.2054430630889414 0.27735064067913623 -0.15516528739165661 -0.14765553268434911 1.1647171439244499 -0.92759896785064155 0.98995747616556007 -0.25747380981539475 0.02319978652225705 0.054541891510106459 0.73170720983922377 0.40162335468203469 0.13420336073148703 0.19280622040712869 1.8769428265907957 -0.37227684824211743;-0.98811775059049733 0.97855454837846845 0.2647943498506104 0.44323626301126762 -0.15564018191146023 0.14202653172806406 -0.26541527117584185 -0.70219716691784162 0.56403957850485853 0.47361012108440614 -1.0222337443145915 -0.091948864376913603 -0.15271211169551616 0.26978253879017755 0.90642870779693718 -0.14304155596107759 -0.47219563659109492 0.44641242910614148 0.35747660349434113 -0.26885102522862309 0.8909566698696435 -0.72306789626875945 -0.56815223032177797 -0.13841890417258707 0.14589871733976811;-0.46643761239187148 0.7196260057186662 -0.88646926128964687 2.4766474788242596 0.91373300707616889 -0.98572086255938229 0.045820577898465942 0.86034001246096248 -0.92456445009308186 1.1161338373862706 0.78665630183588042 0.22213398541983403 -0.97700739500516243 0.6724135026485023 -1.2390350693142789 -1.1593259787218464 1.0205604961158845 -0.65732734741855803 -0.4198853386202358 0.52900162605132306 -1.3072306233364042 -0.14537451075036242 -0.88933113972089461 1.5073895102437656 0.62021391679627769];

% Layer 3
b3 = 0.52756327222628618;
LW3_2 = [0.035456619747528083 0.30556698525879589 -0.024069415334456577 -0.096109603799346049 0.16113875345159032 0.060655176322555272 -0.056649119743338541 -0.029752473061087657 0.59343175790329539 -0.02183980642327487 -0.029595697974191447 -0.014915079759989545 -0.052165759831542612 0.27021229210463349 -0.011848816045101074];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
