function [Y,Xf,Af] = ESPER_TA_4_Atl_2(X,~,~)
%ESPER_TA_4_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:01.
% 
% [Y] = ESPER_TA_4_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.1131749759549052214;-3.377859234356644258;-2.1095159180418363576;1.9622123052634845575;-2.305384771921100473;-3.4901832025887444821;1.8327096063621204358;-1.9205201013745707428;-0.40548909733846161263;0.4931263676811895591;-0.76868672508784274822;-0.95583730945009670599;-3.3100921936591771733;-0.81702706106193423441;1.1279544305507906987;-5.2782625603338857445;2.5671913861346755681;-1.4252498688513344227;-3.5044268536160614325;-0.87463197176418328027];
IW1_1 = [0.5249273448990477986 -0.030733881809870976926 4.0782471172835021989 0.7677378178017988386 -1.4730145942340469034 -1.8217421408437430852 -0.37829267420136597488;0.45332724879147678898 -0.33562617318430276736 -0.32164937237591784136 0.29671187305300611436 3.3519513002142171665 -1.2690014390050490256 -0.18724653667404117519;0.52101340259700157365 -0.086986323112433580618 -0.58947081636796139215 -0.14790795982650126184 1.1291737562653931803 -0.76414298960322735166 0.82855233526411653511;0.23101990991413004495 -0.25899153156673121456 -1.5072201938903537766 -0.0096128757616737066372 -2.2934799436351789304 0.91463116811470435152 -0.017557500639877876569;1.0926805877607639328 0.27879881097390490918 -0.27600720454185212471 -0.08829871022725233054 0.85820163481680233897 -0.69545108527408827648 -1.7115402313890826225;0.52057031588202029582 1.2730578829690846199 -1.8654547740240325915 -0.14550978766703634437 3.6836283790234660707 -0.21276191604846239613 -0.40871023034996201151;-2.0015377699781260468 2.7280598053970672723 -2.3558383363957564605 -0.78460806543457140005 -0.75684956802545111376 0.29287008165396699599 -1.1437269648784209597;0.51032434000116766448 -0.52541589545966416175 0.38881520552059906093 0.12420798476690354806 1.8969766945745016873 -0.58786436338435399396 0.35581905557164700271;-0.60489469853662780618 -1.3425332121220228121 -2.2569874772149898234 0.063499154059981952059 0.68129893802765528754 0.58767140168151521529 -0.51309182224122007465;-0.81862591815558927166 0.30533638574655752596 0.25966999790385536517 0.37815256491090276647 0.47474855402917426339 -0.60568093044380966194 -0.16362916023370008278;0.78233167133350400846 -0.14662371995131293079 2.9832155238123738705 -0.075203945394812662939 -0.12908808096570667523 -0.36130211738965889445 1.4271413862242356974;-0.40530301007369545774 0.38142757003153660023 1.0584911232896601074 0.034880131320659001071 1.1105240839633720995 0.84717183973714293987 0.56218189509884730626;-1.3460404122302400687 1.0766588615505703341 0.16446267354076551936 -0.35452317725014126371 1.068149258309201155 -1.5104733684016864448 -2.6968604829714837301;0.60360798731761300395 0.87633707065958377225 2.0626167878327179572 -0.061540542886689551805 0.61957125492070719286 -0.72895172192731150229 0.47574930475961635379;-0.94504629884020419084 0.44756583469483851578 0.44059342156680558755 0.38176484722070030964 -0.1157809993566072948 -0.51128159629688207932 -0.20305980644414822756;0.10946049199252241846 2.0711459151830395875 1.7357699441580711763 0.048869133053968887015 3.5382616432397848705 0.36021057181683513448 1.6996170376267769608;0.15868606960261041894 -0.21840847520238007573 0.039036971866379888141 -0.27782263157340164605 -2.864753475069041766 1.3859903471562824429 0.54888552682165958618;-0.5971120133761904647 0.061591506182430366678 -0.059211218011890220936 0.002734271222674151177 1.2277601104264905807 0.40776473429647341895 0.15085887946625339828;0.013757264669959077749 -0.11033413184879202473 0.27647772537585485475 -0.21026362470410919769 -0.30201419568005111183 -0.5305051120132938669 -1.1460387728104401983;-0.19994887136796449245 0.047648832630764879903 0.047143584471294255889 0.11043039136438101422 -1.0792580306227019804 -1.3712810733631908278 -0.16650119974715807403];

% Layer 2
b2 = [-7.4906724793103043325;1.8879627097356266319;29.206403734965807217;2.0698494236051709905;3.6420782078778413116;-5.2233965153099317646;-0.83872624684708652065;1.5583746961966145061;-3.7417349391113923218;14.16416505231357803;9.4498219522288611216;0.96515882100270733446;0.72052285376158697883;2.4083739039028086992;-6.9982722042721263733;-1.4426347425312198158;1.6969117817495018574;-5.842676499476716856;-1.3647674935263118812;-1.3128190503709251669];
LW2_1 = [0.53013104899834451178 -0.1780953530707483079 0.7845330710641380545 -0.018584536508215947215 0.29971748199863795792 -0.012115480616011838413 -0.38968943994010291076 -0.043569158792975251626 -0.94855748284970509143 0.60974936629828602186 -0.39389829967638223529 -1.4077948362671184324 0.82429757907117406912 -0.44060078588001727606 -0.25807666443338977968 0.68573682972423299908 -0.29571970248018553118 3.7673919615118851567 -12.914087396280150344 -1.3380094200808705374;-0.61626458668071071312 0.018884299386489205447 -1.4687994113422013776 -2.1515607823611500038 0.75284753625062528215 -0.73266710406906265796 1.51692773543642212 2.9764639462056674546 -1.4692214216922785397 4.9415465276356664859 -0.58357494363540662885 1.7007138624433055796 -0.17001396478344063534 -2.4981638220048907328 -6.2423261533037530668 -0.23461100111345900565 0.46320697636376567674 -0.34408563045439699568 4.8520899340286831602 -0.59035891179061150691;3.5346534986690829605 0.037219194825904897139 -1.8753946749505039371 -2.6796382042449273797 0.75636395994527305664 -1.5543644792430215684 -0.69160163898379389824 -1.5383949716086118276 -1.0098201745336976565 1.6230005493130543748 -1.8317647160333450085 1.7318563501744341782 -2.9873035692072340552 1.5272686036138920507 -3.2536809641701252005 -4.5012963068295128721 1.7911242910442841669 -1.4989215382946841082 36.236206687460828846 -3.7893578390953304158;-0.40043526414785762801 -1.0893498522719788912 -7.0477337855482842244 -0.10353393192577946269 2.9660392308848155807 0.13954206908653529751 -0.6522406631820465428 -4.6262812168547133851 7.3325185100840650776 4.1219853166114681642 3.8689662642518451996 4.1105671586518415239 -4.5183769327844149899 2.3282129731850105259 -5.0466781856899673997 -3.7837623820339132408 3.3251918443429322458 -2.1107513601342593468 8.3111224144932442925 -1.0296131148279457079;0.21975173361983768583 -1.7306804343522408374 0.051639240652750259541 2.6468028034168904483 -0.68673896423655977905 -0.48514940674859308167 0.17475800131683605354 3.0566512766972597781 -0.16018783876545203415 -0.58089518221411995391 0.61087973417173835333 -1.9978952370091609403 -0.68652557102053912708 -0.25386871308782005263 -0.24950594850307028505 1.3163451770132157392 -2.7776993987293456811 1.4735678843625326095 2.0824590818668382575 3.0649100189198112965;-0.57365283633651498185 2.2618613283141830728 -3.2274029375288164623 -1.1450413968922119601 0.13428140275497432721 -1.8023556477290012534 -0.20915377030075038567 -3.1798115517371128291 1.0109313295901514174 -5.5472186272385446415 0.56680107774384258512 -1.6365884652256870169 0.073675460499676242998 1.3912772897818110884 6.6696136421390415094 2.0095241362615015035 1.5757385031088446681 1.8546255946079226451 -0.054755395865890246765 -1.4894915929819829703;-1.1774116897016668748 0.9238554951571970042 0.20322062940350466009 1.7168593794973181499 0.77815010791635119691 -3.4807872759176312627 -0.21136957242030054993 -2.5559549159858550027 0.97557094367611019159 2.0441972310381810729 1.3748021656570863502 -2.1336257858341856064 1.5647141555510435396 -3.0478308724530678298 -1.2165184584033275073 3.050843623550607564 -0.89056278275144074019 -0.6276593254275077971 -3.813420449697825898 0.78329895324456011441;0.55413531563149787118 -1.2017942367988023733 2.4653367735264026805 -2.6479967893848201932 0.23165162620669879634 -0.5634645959669227766 -0.82363835883339286958 -3.6481645363105501545 -2.1109582045594019739 3.4544398113491237012 1.7379118473286818691 0.12645096708089714754 -1.4901228298904471981 -5.2324035433634152881 -3.404898786352613449 -1.3301938170953506724 -1.64450039003252102 -0.13184062321734177359 -0.84712279338769069792 0.53188319587839893998;1.3910654178215786647 -10.114590869406459461 2.5784963389295127989 3.3468770642475820232 -1.6042652249668620801 9.5549102024874414951 -1.9544756247155654627 -0.24474257812056585126 -2.1318902176675642579 2.0250737372508704759 4.9276273527395000329 0.2962246865956902897 -4.6000354916942320926 -2.1623110619832330848 12.29167638338483215 14.826631563981974793 1.7473030459247211876 -3.3612353147238032136 -15.54668318141037453 1.0237737875013970257;0.81312443399316070014 3.7873700565837746801 0.30467329033363177437 -2.3375759954724357748 0.50571177707572578797 -1.3053311380333472158 0.58850579066351593749 -4.7721925466594052878 4.2519151597018840505 4.2419466087425448109 0.67249068514447318812 -0.12399709133986630549 -0.13292778457545889603 5.1657755919245085252 -5.9446644000102990546 2.2303866079879277606 4.3640387739755848173 3.0463538419007889502 9.5289426224360074258 1.3126992142722073709;1.2493486908506916677 1.8248430662475929598 -2.5973456464302886459 -2.3954830759074012825 0.41185950709973445649 -0.84090863618689759562 -1.2638449888194176474 -3.0850614077684408443 1.3909241468469746295 -3.1266310636344831764 3.2132964986661152196 -1.0035868197613087016 -0.55731425877756135545 -0.034673928091676325947 4.0730682631317369768 1.1569198481996307848 2.5180973341685719546 2.7659978619810754452 7.176676100433802219 1.6806718506104971755;-0.017200087354012249391 2.1268746278143617623 2.1177249417011174693 2.3112561041111669979 3.7348444124092332608 -3.4816979488340646931 -1.3455437264245266871 -2.5752139565514129416 1.0426003164651389543 1.1894870598668481065 2.2845700384951128648 1.7022320651598681351 -8.2022463650117458656 -4.1155377773188890345 -1.2513082020768275804 -3.8705493653923395136 -8.9077719901031251482 9.0072692109201693 1.7976002335101091134 -1.7131634521502814295;0.71126759461424338138 -1.5622378886991434843 1.7567134977589875522 0.94906050866570434987 0.038778120255381902381 -1.0046304446848184355 0.72904111908571100908 -0.32740447511272946501 -1.0330158697558398107 -0.083544740577484621902 -1.0612992999247050641 -1.267639301121284312 -0.5140493313773523143 0.21030515795829274328 0.070180602527796190349 1.5951287500492723481 -1.6577117014466307143 -1.8466903727456240869 -1.0813606705841491973 2.1992210659978210785;1.3392797685490001047 -2.0308961301724020032 -0.78072983396385720045 1.1693415311912840338 3.0231347125031096112 -1.4167620015813278123 0.085702154719122985993 1.307540851018720085 1.7583068768010630123 4.4845585140813231106 -0.27380167050529480299 1.4185439880187187267 -1.096761565675424821 -0.54296846392815889537 0.0034749021441650047859 2.3575727776596928642 -2.1014118351121164885 -1.5137814857477576158 8.8497766450916728331 -1.8191153645936597449;0.68087382723299849641 -0.11913519698950432446 2.5966511220067456378 -1.4600090811628962939 0.3434821751399324552 -0.51841179990336572203 -0.84762485244037588661 -4.1548537854150930926 0.16185362725559487851 -0.76178964465770093728 1.9401139323071678877 -0.23925156213778717151 -1.138471481094374349 -1.9491064389560217585 0.94983596295788308428 -2.8828113157347368123 -1.0023981346866390751 1.0117826013070601032 -9.1324238655601099879 0.62244198114582627301;0.83664811266866045969 3.4052217367052790564 -1.4044529341578970705 -4.3424504596823929603 -3.6240894007364787832 2.0601236582021460464 1.7399401370633662545 4.1055904068020989683 -1.3071396174027896109 -2.1782178884627709792 1.1355350269760500215 -7.3015390150806993574 4.2326405100812305449 0.042250234945863135438 -1.1476698291018889719 0.35530231494114317137 1.4177880357552179458 5.3938146844542069758 1.3607346214872455548 -7.2245231357874635236;4.4794946425211215058 0.73449440066901394708 -1.9514542456732679732 -0.17764140436854761185 -0.28538594450502835498 0.59546670342452157065 1.3856118720396792821 0.84641874350534151983 1.5495471687674051697 -3.2366606051144755085 -2.4207682034854371977 2.0816992205419633244 -4.6930544491739043522 -1.5730208801342713265 9.7105578634220854894 0.40703762101760759817 4.8782170034383112167 5.8850733717124672495 2.3543581923269130129 -0.42879258355363425448;-0.80667676971906632222 3.0125474441540993631 -0.97813352599055358727 -1.4416266619114594949 -3.1923459867841312843 3.4490247536364662118 0.21918915494393725885 1.9102087948289161456 -0.54473860636301107974 -7.7095957271254889065 -0.66514342174116292128 -1.5159843496520122308 -0.89969958074428402206 -1.0127908033866550586 2.5941748311226171531 -0.61640304802680634388 -2.1042847269289408629 -0.24748921473837115492 -7.944375212520060181 -0.98732995024915792825;-0.86301606547458187269 2.0771391123049802729 2.6511116951177964296 -1.6933300135019913046 -0.20095693011164370012 -1.8224101760484143764 2.6197650185290592972 1.0476975224688140909 0.70273901161207563693 -8.779026786429010798 -0.18294469381059480506 5.9795669808256768363 -0.39900866281552932469 -0.050861241903166126699 7.3539936651811954604 -2.1887209659920290328 -1.9226024823868987923 -3.0470965155337026431 -0.40560544085433003492 -3.6256192718135955566;0.79615025108508086227 -0.73931690332380584074 0.13645534341169390791 0.077343169439720360625 1.6202597604562314348 0.10055568389329747059 -0.82693599097014824917 -1.9652624795516453471 -2.4183299713139541076 -0.8983547118592980496 -0.20297024217493236931 3.3159287044008260992 -1.6345187678057884195 1.0944405810556305791 2.2975965555428237153 0.1964685225427027504 0.38185314206276815829 0.3156529183309401132 -3.8413675270082272561 -3.0374335772143501444];

% Layer 3
b3 = -0.65758161080466370763;
LW3_2 = [1.2311110793782451545 0.29030376454776213313 0.00818221887772128606 0.0033638420676317098285 0.024824091861300304901 -0.078562295352003957971 0.031846333229657963759 -3.1201983963477397666 0.0059788843318918268033 -0.02943307310299955043 -0.01662273910558064241 0.0054581062862988959442 -0.078770845139928880041 -0.022739985008272553535 3.2151537897821533818 -0.014818291622684442999 0.0054314705307716521984 -0.038430490218434650018 0.021591416723768176028 -0.014195376235090260628];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
