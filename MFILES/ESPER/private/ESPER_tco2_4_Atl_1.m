function [Y,Xf,Af] = ESPER_tco2_4_Atl_1(X,~,~)
%ESPER_TCO2_4_ATL_1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:53.
% 
% [Y] = ESPER_tco2_4_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [7.6915097015812108;-0.10113057931089041;34.126219293738117;-31.572834003970158;23.980455751698372;-73.994974223790365;5.7230166614268647;-91.133434655431287;13.055712501005569;-4.2978504410363634;-8.0244198510591325;2.7611736757125538;2.1989032632284728;1.1276062243999203;-8.9322073595568963;-2.2386386999409571;135.50168992603537;20.070737750349124;2.2767224755430755;3.8165642826342143;2.4961526165428811;-13.566788455222362;-7.4579493737408935;-3.420518287446662;8.703520555196393;1.6803980987768894;1.283426590512579;-21.916149510115059;-0.29813755101595391;-29.267067280465053;4.1231144756262479;9.8425428001012314;1.0760109203484756;33.113988831392163;100.03458532271013;0.18254869729586629;-16.249873295033034;-113.90735532499578;-0.13354163796293503;-1.5595759259183521];
IW1_1 = [-1.5697783706805428 -3.0060334829551731 1.9279680748272043 -2.3423814073244418 5.6780276563790331 5.9956041910340652 7.0534852858771373;0.39245903686609612 -0.16833470042863022 -0.030161777299670026 -0.10563513449708835 -1.7226029472639459 0.57602099637710658 0.10259095890679402;-1.6091145018070223 14.951064336220806 -1.57257819946291 -3.9038220837924311 -48.101229527466096 4.0362928675807037 -9.4028362436193742;13.070708242670459 2.0476151603773403 7.1315485786233959 -11.787909874225535 59.337436261421026 4.8480434862189838 24.872005147915417;-5.7141584383837936 3.3133916128511438 -0.66114958168717985 1.6202293381544668 -28.004482627963412 -0.24123896953504742 2.0532907876781548;60.191601089832936 -23.609398983617545 -11.090607628860672 -18.505472123336904 -12.650767933021246 15.975518889887592 -44.938176786319687;0.22556931126608498 1.9726624349224677 -0.4779973929391364 -0.35940988408735314 -5.4166907752100828 1.9152661208295536 1.3584619075271545;-8.9932315100843088 -5.5369730824539962 -2.6235113203225291 0.0059643317328260045 90.747031955892567 -34.208130967608071 1.4347205258867581;-0.36497444102143056 8.4243986058289 -8.436572656437292 12.930424684067392 -26.327319431491894 12.833075371838882 -7.5548153603365424;0.60947658000360205 1.0911217510646116 -0.8451261219842281 0.24370547144493127 3.4071777918109492 -1.7778602989194137 -1.3775055916384058;1.5618879068715947 -1.5970731380788596 1.1507752793905783 -1.4550898549993592 -2.6595345474522079 -4.4075321718238287 -4.9853650646700496;-0.49036591608485808 -0.19815974577204076 1.2369322739522361 -2.3286449843395411 9.0330504834199523 -1.308672973816509 12.325261525487342;1.2501791248612903 1.1726441242603347 1.4031482612962047 -0.25658051174804808 0.19257362024820029 2.1555339563871985 1.7599954885918661;1.0435929556891201 -1.2717224106183482 0.22630568693608916 -0.42776551837527499 -2.3980255807931097 1.5398771738325929 -0.32287171282866883;2.5827678514132035 -1.6905955000675335 0.19855560368530367 -2.6997552626785413 10.005427564371431 0.616443624572102 0.27567697880331271;0.43111747084255353 -0.43061384463367852 -0.087616655332665216 0.32302196408915573 0.86870215163536935 0.95143951583239028 -0.92868957536747532;-3.1430831809005273 -37.618226993587754 -4.758878356362553 6.3713202526833781 -193.48632660085352 14.435250031763138 28.987813294268797;0.43075028176551999 0.070282406220538052 -1.1314595190463217 20.757009147894379 5.8016621342030339 -0.39454775898259614 2.3038309423754937;-0.10173497731624279 0.12534734318841637 -0.046340131402544213 -0.25241378258132968 -3.1288570232643069 0.12528403201307603 1.0542103411206611;-0.043083808957718697 -0.052587581595389801 0.22454486930937637 -0.20767397908815211 -2.3049794939646167 0.59605562157111724 0.80977760539226573;-0.14006551633640502 0.082339404744893666 -0.06556905925581942 -0.20961532579643355 -3.3993672214315622 0.23416920987013082 1.1204067324628713;5.905183646335213 -7.5930183976869738 -0.46535256278072151 -1.7661008780971807 5.9782307372702901 -4.3473528920884101 -2.7657811389895453;4.480494186087439 -2.3115017111696421 0.18870349051468857 -1.6129904879929999 5.5663996143279189 -1.401968060446231 -2.5232850697675229;0.38013895979638385 -1.187489928753612 1.4349216424219626 -0.38421427363273403 5.0966217704260472 -2.6037739309915837 -0.8526320401623908;1.5056236659971416 0.42099040289709 9.1698933588306506 8.415169613464915 -3.702923958099924 4.1958832409221412 -1.6157820451958127;-1.243514737113915 0.43129917305850807 -1.3345366768988762 0.7262172829607566 -0.46775505396467459 2.3494800807050966 -2.0552391404173438;2.418782262372106 -2.3565040112280866 0.036982859055920199 -0.24917395401415535 -6.7937551437852175 0.31358093129512282 -1.1366680563256344;10.404820633008041 -10.031209202504748 33.700041204690933 36.497435139509705 15.096143054758775 -12.453421907366865 -14.698604891089833;-1.0667039566977556 0.53473105823396672 -1.0410568868168255 0.26727953204179522 0.0070712738939414533 0.1751615545741447 -1.6733281349736533;17.319649312095514 -9.7674128455862395 -10.309820521768508 -0.48296362998795056 3.126828772922694 2.0040801799569432 2.0439516729747966;-1.1492514668858389 1.3547484267906758 -2.4606890416503622 -1.9074844396927879 -8.008291046978572 3.7648317509087756 0.64776335084627767;11.368071566247631 -21.58029006360557 11.503934450233661 -5.5080358149587054 0.24483693654479644 28.943299340946172 11.613969730831757;1.7586818096372598 -0.44249452874255379 -0.46846371330859915 1.3712342918292324 -3.0591188930079172 -1.0207676259714498 -1.1052376703422702;-3.388592392485573 -45.576180070613589 -1.673004745426566 -9.182218693595626 -95.193709010077541 -7.8496007616140409 6.0064065839701781;7.7371520847674846 -20.726201074131865 24.647135136202891 -2.2608855871181524 -58.424969166051852 26.807793854742293 66.130328872096015;0.30647770606969144 -0.094281367180022779 -0.13523950864511777 -0.011832234739879072 -1.7719284024492832 0.75158596063774108 0.045287404055305819;9.4084437510402221 5.2852788502177308 9.8971288732550846 11.830975885202886 5.5352283467287213 -3.2588083538284787 -12.067228914177855;-138.39952992298953 -4.5150231780212939 -26.058122513010989 -22.097857904720566 81.604277268076899 -35.807945290653528 -16.11196549794666;1.570060490417494 -0.12505974903328454 -0.51420799857928889 1.3484696157218852 0.50346828302602531 -0.084366630970826195 -0.9016568419805373;76.035867662544121 45.347988765041691 35.488810610340039 -17.155448841955764 -7.3819041085460082 58.457201960725534 -5.1460988054603298];

% Layer 2
b2 = 1.6784997941502633;
LW2_1 = [0.054896824545960746 -7.0294244793193119 0.0023118720825296259 -0.0013277548555538532 0.019446885829885647 -0.0017867692587362374 -0.080850133300434349 -0.007040605070454212 -0.045630816838367338 -0.13585155367349616 0.025697125488332504 0.016751700060463809 0.054949678858651534 0.23124574252693383 -0.029312071646406285 -0.55867011941782174 -0.0011817643411029775 0.08408975786626649 3.4490601987353995 -2.9769836838157606 -3.1046011571862784 -0.026793680757725848 -0.038626281562577955 0.31752074054840623 -0.013291959322806619 0.084378058179081866 -0.085751384289169105 0.0047626254299696471 -0.23717076298788839 0.017652905978570006 -0.09552833264894843 0.0016769700031536298 -0.088793001062562299 -0.0020062956467213578 0.0030116270660328504 6.4812458559988944 -0.0019856005190687547 0.0026118653911635483 0.11441693774497376 -0.0011413940844100347];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
