function [Y,Xf,Af] = ESPER_nitrate_14_Atl_4(X,~,~)
%ESPER_NITRATE_14_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_14_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.03];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.604229607250755];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.2246478866536660846;-1.6814148979048262333;1.0412168484131187896;-1.6561769657398539568;2.3152375423653483999;-0.093497984911910414496;4.3511740512022623051;1.1677257642728942066;0.25958687089967663608;-0.38152466796570527752;0.85560056571853093654;2.7832505804013489836;1.8644316585081353033;-0.060023378986028441684;1.8965386098871981346;-0.252710907956194053;-3.7011454170397879437;-1.447275827343953436;0.25632751764750622003;0.68412263512801285703;-2.2233661393996277944;-2.8397270852125062746;-0.39879224985294953187;-0.067630951187831786497;-3.4953492920895445906;-0.64548600101803110807;0.53210953801204874392;-0.74520033006972408174;-3.4904453862096622707;-0.18335647448863801046];
IW1_1 = [0.91117395161809877635 -1.2383825349502484148 -1.1528141980240058651 1.7199051581709545733 -0.90760398879470827183 -0.53637389432100146536;0.021758293423428654717 -1.776164191462213271 2.3154060935871934035 0.27329720479362168417 0.58646440056438120525 2.9828872061066302734;-1.8955528184837995287 0.85461542094370068767 1.7211521718941660275 -1.6622454069267189602 2.2261906368128148159 1.8684475241118989608;-0.58097480152794223063 -0.88208550440598809672 -2.2789398952817578881 1.4976104333633926124 -0.43030457755758289018 -1.1962258462035271211;-0.65117424766909293155 0.57420126062695653335 -2.6873070781281818142 -0.6550812396394792847 0.64313505743066079479 0.33285322479682871721;1.5637218892566158157 0.58174592029147542682 -0.52418330434991278199 0.32466687344775962965 -1.0604449361999228607 -0.78250704389190350874;-0.20170349652423505415 0.42256742980095368667 0.8903224678414228821 -0.45722394182660219819 -3.8766873585834025207 0.43522578654199600701;-0.9157124886504928174 -2.8668291932062501814 -0.12361458566764710332 0.29710345616098932098 -2.5868899982382322911 0.90135555015092538866;-0.90690852010425981877 1.2991478782379186629 0.70761124970029554149 0.76746799860280601191 0.53820699161356422291 -0.83619137827762257675;0.034848926252224098066 -0.54086096107112502374 0.92334355749815444359 0.019540155884614534426 -1.6112618765839166191 -0.68845366003385977116;0.26704651426686421001 -0.033327388484173964267 0.53665151472360261842 0.13094625919510610723 -1.9561114187384347485 -0.17408688215488171691;-2.6552253271192465256 -1.6381870314545587952 -0.97818401247788133723 -1.482490248727136084 1.6226791837963738807 3.6367671757671926613;0.2166279204393947444 0.22209039486341966563 -0.22427220579383069787 2.0887861600264008288 2.6574024995936125215 2.0118968506827785703;2.6916153844325312328 1.1679287415977883668 -1.8440425163142983855 -0.036310015858869670868 1.1011899915538028161 0.47281341141537408523;-0.81930336720136764939 -0.0041857096398478909477 -1.2699883838438792427 1.025774345175339608 -1.7786540710069793647 -1.0404633842736545901;2.2697638621992934915 1.9764869887850835539 -1.6190301757517866488 0.12138020331776622207 0.89075063053588776629 0.73399786724657734016;-0.64640364836602803855 -0.045970033068178928204 -0.066168065181592267132 -1.8714675202185111491 2.7566347429966713278 -0.71333259221678779749;-1.4737110024351298687 0.64143966158723375592 2.1015252394263925773 0.45293604445563717675 3.8745194867552208429 1.2337727328345011735;-2.0810797548388100253 -1.6464778319200470413 -0.25728196825802296388 -0.60485645535194421107 -1.5912999861518002387 -1.082853914096175485;2.6694850972628674235 0.22214784283553459798 0.041445439543407625038 0.40236016248394423922 -2.7389511077075829881 1.2717367551640255119;-0.29771874700976563854 -0.78782934580771735167 1.489341883749695894 -0.089585172045870548052 4.2420909741959071937 2.8276137907779799185;-0.30076574902970865111 0.60671434817428704367 0.72961758347869043462 -3.9518816265946159483 -1.4032802791304928025 -0.60430276364456780858;-0.051053367261502898 0.388207127780170691 0.39900298252995314296 -1.4092308483908961847 1.3554370594437648023 -0.66047614106333984996;-0.59432562662059329472 -2.6970945732641276038 -0.32491782397618435008 -0.024441728078509757094 -3.4304259774880900835 0.4633913362743649067;-0.59100425826851299416 0.21982850620609148407 0.25482248974630344884 -2.9011746410217749137 1.387013663604744762 -0.15590585909371573736;-0.49532546740450367206 0.35728136889910522278 0.82808997005980444772 -0.4418137590557270622 -1.2809133335775950702 0.98271845401034096934;0.62945930206747013891 0.15115547856470329391 1.4936327770650319469 3.6611747756628765238 2.3828107533491058589 -0.73446357801042017055;-0.9634991053446730902 -0.21070679986383447635 -0.11199480312743100019 -3.168136097711174326 -5.2906485586500995311 -0.7745428332157391349;-0.34481023349161038505 -0.61799338879157639237 -1.9725295383087917411 -1.473347855535217299 5.5251859789061477102 -0.46408837504037847577;-1.5000705771099067665 -0.78626522946942745129 -1.7263457831914050811 -0.64790682006223343503 1.9328095165560859048 1.0013944377125685303];

% Layer 2
b2 = [-1.572183218283095929;1.1654962448897772109;-0.87126502216196688444;-1.6104510578602506676;-1.4024941091156835071;-0.026686586020889573045;1.425767522372349605;0.84561689667059825037;0.25323774780873420376;2.6622548396096372691];
LW2_1 = [0.01614438038242951845 0.31276513179764908745 0.12206538410129127992 0.78418541009792297469 0.28553454502679831428 -0.68434141530283854049 2.3404731730012247048 -0.23477543190781283156 -1.7950096432139532876 1.2092391532584003677 -1.1211272998974650683 -0.27351266102202859143 -0.51059973068013919661 -0.30987095992722407667 1.4332061049920588047 0.099121125674135182604 0.7433503053865923027 -0.4100139679447522556 1.1115372277833976966 1.4830482723098035169 0.95728763398217275871 -1.8920600267150193829 -0.1288069033218359194 -1.1253574145549622987 -0.098804288675741466785 1.5418881425126385043 -0.12624688781826348682 0.87041802768708065319 0.28953261599124346937 -0.89107614760684861199;-0.026942514291726546438 -0.86198105302534888672 -0.0956246684865836305 0.6733489150908434917 -0.40715507964405789343 -0.75551691065762938138 1.5805290189470850848 -0.12622175894716874955 0.29171474315812301326 1.4864103441689466845 0.46619877030002554452 0.6366569821708533139 -0.77629513962422702633 1.2104598797205814442 1.209391013089399225 0.56222587583902094988 1.5521863480250839284 1.0221550141696151837 0.2384040184681877339 -0.35050429494099538674 -0.64881197356305608803 -2.1851530748973027052 1.4244227460042402367 0.056031571731564387695 3.0508505633119540335 -0.47341785999092422799 -0.48177523394014831748 -0.76948924691758624483 -0.413597479331710427 1.0880183709969344363;-0.090426110775640847206 0.038284924971807840488 -0.56239097289153283654 -0.35965451857802627211 -0.61284893860194133985 -2.0629174731623969308 3.2062568435082376972 -0.80915654423855332134 1.7187335976166797646 2.4159206243996944607 1.1399941518629959081 -0.58002757875123200915 0.86861385819837266808 -0.27069601382018310121 -0.054431258257130250844 -0.0004182043608603617027 0.5401263700459522088 -0.8426994228710580348 0.75169065279257563095 -0.43740178847881816537 -1.1239284408942813442 -1.9651556780648660183 -0.85150173765875591947 -0.77179879273891727198 1.6085267581495721334 -0.23518212807215307936 -1.1209829131620456799 -0.39499284854465077643 1.1659501530280518278 -1.1463650148720108124;0.91606226237322219141 -1.0016550785258646616 -0.64224876843462941345 1.4215490256635399113 -1.0210401454480777517 -0.57206635353495738361 3.1846203069090948112 -0.28312661388886056768 -0.23676474332389141342 -1.147753231187067291 2.2552872535494259409 0.10385765867082089042 0.74291398638070860194 -0.23023478790288079421 0.18820335192478748754 -0.61677023676514919348 1.2061433791040794272 0.71684420234487344903 -0.34026797531948327347 -0.33811743628455637189 0.27243842240297166946 0.68972338485027695487 1.1351584409819575061 0.12467181609176745949 -1.0199336806159295943 -0.17573928247661374513 0.014164365122970323102 -0.53215554723231583978 0.39095155190970104497 -0.19332803157310685105;-0.30947457562482871829 -1.3873286845857655258 0.35984583004575465548 -0.93693043386245655757 -1.8812658566689790529 1.188587375207790009 1.5575867807269827559 -0.17441154842756526056 1.7536068539446063586 -0.60150092342692451641 2.9881862924821658289 -0.60303701370213125266 -0.031191978040553368368 0.87708299176221315996 -0.20382209952569185774 0.018285464160186920557 1.3237041248072898281 0.75451515221196330252 0.95219139561796450888 -1.5043403073963776961 1.5407661540253076993 0.57305675992075899572 1.9892977546369743358 -1.3360440555345964864 -0.51100655026572283646 -1.5220822694502844641 -0.38840225605575462442 1.4621262436456083922 -1.2307567488971868919 -0.24033674769577129116;-0.053700511390296419567 0.59932936914084489199 1.1453761604776526717 1.2160395219204043205 -1.771852344554365466 1.3694221681920706324 -0.86326207141691757574 1.459058325582228699 -0.57365143326881451458 -0.34412640089028517787 -3.5448721092306811897 0.90640310147782809924 -0.83523950964931148455 -1.5048675059445777435 1.5283273343908789776 0.60040825947216858172 -1.2197985166895173315 -2.1059487673234618121 -0.11434589354945304263 -0.35996455674805777347 -0.10056294036478245768 3.3496138017846095458 0.84440879096177334784 -0.17105270910571521159 0.20394507209563544903 -0.14782711260692488198 -0.040451568248863881139 -2.053640716689789425 -0.12161933958633869279 -0.55303218249372620985;0.16965966861895098727 -0.20363661716690914516 0.054034302663251931875 1.8168861964822331512 0.35865198182482438405 -0.7455513266773081682 3.4908665391418529644 -0.34979907895077838598 0.22474464029927679332 2.2663199417280681658 0.80454649726149296551 -0.13500698494489993262 2.4048648189193047031 -0.36893249075973244544 0.011650107394882898773 0.47046635870722375294 0.021978761493402953348 -1.1628601152842308331 0.087005486274356669263 -0.15221931853448866789 0.38328064958968399711 -1.83887538454993682 -4.2679194329134455543 -1.0199598174455195565 2.4029351054778582686 -1.5657229262121585833 -0.00057294770899818381338 0.31040218747354042517 -0.12030063877792220028 -0.16187436012127826013;-1.4739863253869016635 0.46380664980190638991 0.73232705612733450806 0.18809269711968565342 1.3145206286735129364 1.4759578768249523861 -2.486050682346014451 0.21573538080924520299 0.65600878491479874821 0.74820857326879020022 4.2357967321553502416 0.63716376395847940106 0.131418876726080186 0.18779126687983821453 1.7435252066888211608 0.35072036725977184801 1.1291203532166853574 -0.74055875853964003852 -0.23136096191136415468 -0.18996250300525482912 0.88875279942064455696 -0.36762167555170088828 1.3456756096983408799 0.39394537987911409926 -0.32602561070028329704 0.52564962546757232342 0.11833964036514986462 -0.50764376651036424715 0.24392642267604250361 0.17105471375085876118;-1.6696041343067749008 -1.1018884124256058676 1.4502752252952202383 -0.92048218515217428148 -1.4258636884548692159 0.47065679080972938619 0.67595483003221890073 0.53358458353739701696 -0.36664198405591746921 -1.7608217898150955172 1.9972489523112821885 1.093521626722081086 -1.6904774782258797927 -0.52034277603379275323 1.4724443354921166183 2.6754790950525433324 -1.3698545660254592971 -1.549448400866988651 -0.30599243750706056622 -2.2368912483685319259 -0.30088989859032022611 2.791992951174059101 0.26180854050853430426 1.1778214403334459348 0.98571659612773054882 -0.61212264764649881865 1.4957189004402065002 0.59755576719623693105 -2.4910097042014363034 -1.6318755329795404663;-0.21639147210288361967 1.1853596347968347047 0.67855779657249515324 -0.89807758424028572009 2.8871409137806169909 0.92255672054108395219 -1.1918758486608453939 -0.12889649057145952105 1.7464989731300772924 3.1968564038936637672 1.1152746783473688197 0.42372313391789495629 -0.3914795803505782823 0.92486403127229521726 1.8494860737739413636 0.011709358442807009382 -1.015732987677506971 -1.0255079921954191047 0.070508926013788206233 0.28070236978075735479 1.3461972425860051494 -0.39134982434120124672 -2.2395186357121774634 0.93041540201093986262 0.7783982456961457963 -0.73484246832990229858 -0.81860647109737960658 -1.484587676888183605 -0.49533972250378310864 -0.47370518229566799251];

% Layer 3
b3 = -0.18128489919350601611;
LW3_2 = [0.37588784612789316597 0.10922574297692351497 -0.11019328894649603467 -0.20838179670745016203 0.063490064361812065252 -0.070849227990109439612 0.34430537325768312273 -0.46642112067684804444 -0.021686312052966644215 0.30346976617370802209];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
