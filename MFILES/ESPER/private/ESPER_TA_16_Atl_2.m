function [Y,Xf,Af] = ESPER_TA_16_Atl_2(X,~,~)
%ESPER_TA_16_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:05.
% 
% [Y] = ESPER_TA_16_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.0880882005651604238;1.607696109753206537;1.5778848102240539131;-2.460548738726744844;2.1225723658480535327;-0.75543292169075570985;-0.25478381225536617105;1.2493905100843472056;1.7790415713139546838;0.93199617524263855817;0.43110128442619677358;3.2985892788114914431;-0.14468542276454504636;0.82219205939134709649;1.617362363851979179;-0.92205189236003004538;-0.7520420478754521465;2.9037163847738698408;-2.2254643878253088651;-0.58181420644378512019];
IW1_1 = [0.43697987293072726445 -1.206475054869058372 0.49789802115124509596 0.047442099705948821697 0.058323082095508668732;-0.7770585095494795258 0.17732029700761986479 2.0304866066241107347 0.013066809486759567091 -1.6706401714631444744;-0.47677172276689344654 0.42646169094897296015 1.649524829759641209 -0.22957721289359458994 -1.4173837656862142698;0.87845805313282765425 0.71477590867107909656 -0.62488835475745452275 -0.78106054557034898522 1.5766754979324895114;-0.53535744329547396703 -1.4334127094477964182 2.4621575334007905766 0.00027349166388963147556 -4.4963435236668995998;-0.29127813646011996296 -0.81308471373757484901 -0.014322630905105901075 0.61934846843780311243 2.1787239029820795189;-0.18752092997471006552 0.098065868477068635078 0.26736737299884316688 0.15583851510554161401 1.040468266638118866;2.1865194808093697532 -1.3411254910694652143 0.084193697841916978475 -1.9347724800586065808 -4.8536428938943823042;-0.49566345436856701356 -0.32684977979955609495 -1.1747992558948214814 0.28589833120306529235 -2.4094321543964478671;1.2242665096075322495 1.2226168150387075606 0.78012285863732933056 -0.38937896035536551098 -2.3953409885913186095;1.0036985969171938748 0.8117310878874794966 0.35900730092923466286 -0.48736906478955571709 -0.038253876764160581192;1.2661456705153248947 0.92066182302177212993 -0.31366950575975982574 -0.44997723207722600813 -5.3478840505208609102;-0.40494748776371625176 -0.5441760341519540356 -0.66726381064958362188 0.02986344708470773171 0.59913341208590864539;0.36420213837072562546 0.34295234752741582396 -0.068259147993984706226 0.57830216654719479585 -0.88273327243141586074;4.1513471865412858719 -0.070037179404201718724 1.5853460546118518515 -1.5878162879121802131 1.1979895835373102209;-0.55079882458979190218 0.071306202851844177615 0.94544828057777630104 0.42341441436391041853 0.60666703562911228342;-1.4465470074574311443 0.51773450976114254729 -0.9079432879483007035 0.67243210474114467612 -0.25014392439395694012;-1.0307245297985374588 -0.43876632829217426801 -4.3017847895409841996 0.18419558067507851851 2.1303747213784620662;-0.8964668834098566963 -0.75960262121497512666 0.52314243317500297437 0.44410060187995137326 3.1713471686067276067;-0.8460230925296663429 -0.54505568495638068161 0.086142084211406400041 0.45457240852473107529 -0.76633247995874687053];

% Layer 2
b2 = [14.631169369575099282;-3.4767776353247281662;-79.306940976057404669;1.7936424699917534742;10.574146299659236803;-1.5183580395951552511;-4.9632150575897648892;-1.9250630698786468376;-8.5931138577646830612;-2.5205090730811923194;15.741472348662249203;-12.261815004912724802;3.6878534515046101916;7.6137425355886438894;5.4767735832369330851;-6.1873169976488862076;-4.6062479093739279179;3.6347668992274986266;-7.4275182028324193695;26.244822285553617291];
LW2_1 = [6.281011224810861826 5.2969964354690439734 0.19091623433325188852 6.4008142038637529936 -4.2124254144963968471 -3.4767861875681660422 -3.2285721568101739543 0.41659069513643526284 0.95460778573278248782 6.9897857495624631241 -3.1881450446780652541 -0.95904374536628755887 11.799414405088034741 3.1679096594071167736 -1.6373595330568861961 5.2384187078369679469 -5.292097494091179577 -4.3182152617655331639 3.1080084259580345041 2.0818859333253567634;-0.97932932285238061265 2.4589405216670212617 -1.0447400756192262161 -3.1101143495957450646 -0.58797608880014695654 -0.96927429356092964507 -0.90571223110895959785 -0.070643559934366328967 0.30323828543853836859 0.51729903163263379895 5.5989703448758065818 1.323969281986103752 2.5393156888652241854 0.61916524923079185871 0.21278456588156735574 -2.3644569075702031036 -0.48761513315046289829 -0.19562561705781586485 3.4693114730476004581 5.5171392149130458193;-19.397884491218604808 12.377716266998104899 -5.2026101473154433563 -56.942651309447903429 -10.072487014386346971 27.183308629441622628 48.878771104141222281 -4.1591356915461634713 0.28063752356275617483 -15.276485094615580351 -2.3858695511699803404 4.2263320193835491878 -33.168902059307839636 -10.248789282043722082 -1.9173657585299050954 -21.511580095613993535 -8.6569801943751691908 -4.1529578323853035826 -28.342184804545460963 1.2350115853093490692;2.0030511555814314306 3.8258691541952529747 -0.88415044378970719663 -1.1594799120132850412 -2.0280414048507569014 -5.3372362076688384391 5.0650491203794683059 0.6905629480918522578 2.5082862819312046199 -2.6040507459591633044 -0.77309399209848062018 -0.081141209666344499274 -4.7179422651749227668 1.9918567645954132761 1.8458024378982194058 -0.4686916364342087471 1.6037888610194193095 1.3107554441407562873 -1.32632968478823976 -0.26939064059415901431;1.653817288826925358 7.2217972277321296204 -7.115540058690775993 10.110985434334768485 0.63524813518242850829 0.48664984017274792727 -4.0483530098721525192 -2.4152620978050194367 -3.5806815596572594274 10.742960624685883531 -4.2002532073665150847 -0.33565760495546786979 8.6903548272115198614 -1.1858378870242811676 -2.7468453011265037134 6.7335204096329794865 -0.25180109804712208499 -2.7637896549850431427 3.7932684366245967844 -6.4008809551180405606;-8.5825427317383553572 -1.6985281045898403818 2.354623521171191225 4.7465311178355316102 -3.0324500086568035861 2.0091245715829542107 3.868771960599301174 0.31327599213186424487 -1.2682750350430906927 -1.2861019872648753459 2.7397841727243372745 1.3227643477947907957 -7.0400110046872041991 4.9575937099074200987 -5.2051267827156877388 -0.42835423400553007678 -5.0926918042084237115 -1.1377106075141902863 0.88744148903007558093 -0.8552884279285734026;-0.65999383584432314009 6.0838247379468315401 -3.9933300681945667066 -3.3728230616139995846 2.9729537207443632596 0.82898464836446994486 -6.4068781583243357147 1.7412448472514614473 2.4941930751716556713 3.7477534136002375043 -5.6301271828536583186 2.0571207107998312758 1.3408461449895621165 1.5614811340444219034 3.0101887180911925945 2.5696798845281718648 -1.6250461274990586347 0.35822933114270888444 -0.18758489602729061518 -0.77487084987067522679;-1.5487191540684674962 1.0241483389658403436 3.6350148949353155992 -1.5659351380591073344 3.6883597555724167982 -0.87085238576878898353 -3.2236626638462166916 0.29899499567892251495 4.7150730288917408473 -0.35917103866337862783 0.42144444594382801661 1.875623341945955147 3.9423467424920812796 -5.0613422488944959099 0.049507052926858703679 -1.3658719223617481475 -0.65754399264637242162 1.3686644364079212366 -7.168041691656666714 4.3726713578960998419;0.39591139365890504198 -4.7628038419381226731 6.2627444995643264392 -4.785192897895163 1.0569054956805030709 -0.07837502071122322278 -1.7128774869571619099 -0.057841045764291040832 3.2676162769869248059 -5.3782107822740501391 5.6201738305983726107 -2.8199830911439791592 -4.5439439597843787055 1.8270156218166688777 2.1919555136641024617 -0.69693360463622766598 2.1422246168477285799 0.085592075584730545335 -2.2173019445203765443 4.624612659253924285;-1.0341040998070811785 -2.3840031872474458652 3.5312504717279735722 -2.5832044610118187755 -0.46993559839326004557 1.1739599257152553147 -3.6069378866708481368 0.46581129148063965539 -3.2418553484643495288 0.81216108095437011816 3.9901632549326300214 -2.6296899458783418169 3.8484467038601710698 4.79236059077306642 -4.3317429846708188634 0.32773722491200590889 -14.307243413702993351 0.75399422131461713015 -2.2942532367544319349 11.219208400833629469;0.16867365323171057412 -8.904390317869808058 4.7704583553862436318 17.27795683653787151 -1.7110998548192786206 2.3615238027820009137 -0.086649389551657768349 -5.4325761057544710297 2.4271325488541863891 2.403520339921656479 10.368345162338030718 -3.1452391633941063631 8.5946770994404300126 -7.597366106514383155 -1.6435004655194047629 -11.498707051774349708 -12.378457694638955289 -3.453501664658924053 0.96457746595350890573 16.510884896583938541;-7.6736205990878989525 -4.3143374354160100026 5.5243460593292486038 -1.5651247630893396767 2.6915298162023089112 -0.094963610302914072681 -8.4044807192469175305 0.29606239005775825124 -4.0649550808381347267 0.14274958831367526302 -1.7482169518077792514 1.8425303232483369875 5.778223596097592285 2.2573241818300977535 -7.6859231343493021882 -2.0828930230415281244 -18.694536734514631604 0.42001644553223022038 1.9725344265800550669 1.4629266163789225175;3.6614563431209714572 -3.765543770504688581 5.8888840551338050844 3.7427255998049355767 -5.352795780957552374 -0.79835890668949049953 -0.98183096983617279552 -3.1948106687870194698 -1.7107471585070135323 -2.0247673496955407302 0.73689182683523357653 -0.59787791987313732012 -1.1559273647837462473 -3.0754929322995989693 -4.1850724886624730559 4.1318733690075690745 1.5140481305254824829 2.3239300039463244296 -0.8697229418940040091 -5.3735412219563594149;-0.3799652006310968444 -6.45274951964891752 9.0801165474251082088 -7.2987401918996956951 -4.9196794962187810896 -4.121746567049584975 -8.7302950476839473737 -1.3215223681986287829 1.6385674166412294017 -2.7084369593368489149 1.3817626038000028199 2.549858427421728635 -1.2491329034481954974 -0.80740904524912515683 0.88517982039801623717 -0.092811856014979307594 -2.1484569454433297686 -6.4186936246195918088 4.3364300825478876433 9.5482926279932556213;2.1599958636714950977 -6.5449621238497943665 3.7226025683836736491 -0.88554318327821457402 2.2543992902699474534 3.313867789427019428 3.6667317823315173086 -0.39580831906507957241 3.059984964376329053 3.3850188886665897314 2.5910224466925559916 1.857999033807600453 3.5864387221424181007 -2.4369670403411820558 0.79232099734681915582 4.8059045207455302062 3.3019177181457814996 -4.8458922396316639336 0.22184162755218697627 -2.9911393651771795987;-5.1233361432589168416 5.4801171637402985581 -1.9740640099543718122 -5.1533668206460836458 -2.1510393776766902896 6.0024420266667082302 2.7695821066039973957 1.6173393599287955169 0.32065493147891210857 3.3653048540910130981 5.3751622849955476013 -1.8942637879980199767 2.7640365085276985546 2.1799549230400039335 4.3845784193624997016 -2.8985101800314461151 4.3312795740394909316 -1.7196236370555479933 -2.8565284616721933197 4.4412360018744250212;-2.9905281503173526403 5.2661836607930023746 3.2220633974141241751 0.2035619422707016235 -3.3363910871728634788 2.5585058362576500457 -2.1196412601352436766 -3.148338757459219206 5.105188221526012704 4.6839591705268768251 5.0872251707148716804 0.012467755058354412084 5.6791106519808201014 -2.1897593071053034208 -0.56521883567489006328 -2.5269977746183429623 -4.5407680376660586319 -1.1086317288244542656 3.3471676801632779252 0.45344344870787228752;-31.774663010369142313 14.947170909451321208 -0.20379229577515953209 -14.193753930776059846 -29.612122221959346291 -6.7938383063132379291 -35.571495569559921535 -22.25937586213534658 12.929702141945567107 21.788237950894881578 32.166371100172021613 -24.660464135040349731 5.0799585022641107201 -12.724186050506036239 -35.316543289533775862 2.6802914804055917308 2.3048792653399994279 -1.7155229438561703237 -2.4947366576911949032 -19.843796191243260552;-2.1856705092059662832 2.2267009827205455075 -1.9625365690099136895 -0.23725288175902423116 -0.67884435746742044504 -0.48839747229174867993 5.175280927507224682 -0.42801200188646276734 -1.955902588936591302 0.79229115513937009574 1.7797842626746813721 -2.7247265798222319866 9.3053830085420106144 0.20374055212596892117 -5.3631224022384405004 -1.854435858759893696 -9.1845998584487080763 -2.2771689913759978197 -3.002573918176860257 2.2545153706919802694;4.0268741003149131075 -21.646707133148403557 20.955598455647326261 13.678472563189368216 -1.5752065123919942735 1.6386969132732509546 -14.003113382378598928 -3.1182450041056535284 5.8195228987492031436 -9.0712942919160468591 -0.52425919148847999196 2.2769509141446198086 -15.122820611029906601 -8.1550555690360599925 1.8358187367546043856 -1.1735097343840517059 2.0090553282751404396 -3.7606019786297717467 4.5046932279601792359 10.508622163892615831];

% Layer 3
b3 = -0.15678495963166788618;
LW3_2 = [-0.011721950180386127988 -0.28048572230870622013 0.0022899117682981789262 -0.11586830475123607864 -0.0071764714304977540033 -0.0015958514510803873624 -0.017356125302924498011 -0.0044602040485165368733 -0.60837956046878804983 0.026039008571047454754 -0.0071651053960209267271 -0.025922893907439400335 -0.0061791113884282359084 -0.0091191646221088027563 -0.30098156788459334843 0.029196245927024088579 0.028959812969112930237 -0.004641438131695796096 -0.039786342123350644517 0.0076178803857168096714];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
