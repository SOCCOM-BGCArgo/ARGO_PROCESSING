function [Y,Xf,Af] = ESPER_pH_8_Atl_4(X,~,~)
%ESPER_PH_8_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:23.
% 
% [Y] = ESPER_pH_8_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.5364652091574360071;-2.6152372368039564776;2.2418009171701940296;3.7658242853978278752;1.6605131487890010256;0.99561260762055114881;-0.86161590184001213277;-1.3163015854834152485;2.3325150313105691424;-0.49000888828198890801;0.64603871672408397231;1.9216528400491401651;-0.78405195692498397264;-2.0703408712391988544;1.3370174969343895377;0.62719928047812367744;-0.26604362059096237081;0.24821268982438302042;-0.81977040478404494817;0.95845754244676473199;0.17361106849276281006;-1.9564930068222572412;-2.4062891763778457843;-0.78055049880994897826;-1.7018023545970861754;4.9946156393204415025;3.7562157039824413118;-2.1288109744007872592;-2.562598433311460866;5.7634215161102453351];
IW1_1 = [0.53916919699299636903 0.052204886273886821901 3.8140708695401457362 -0.2059380387785824662 -2.2597772139244383105 -1.0412074258587860065;0.74981861342836475526 0.36370803297020254385 -0.30233407487992930429 -0.55557223659349874723 1.185046816580058282 1.8783521305137078627;-0.53751306129676246215 -0.34248142460638963946 0.83020187870289774423 0.36223772819172156412 -1.5883672497215162167 -1.199088231920712122;-0.052693922060341062685 -0.073335020501053962971 -0.39459301292084869583 -0.40746080725793115684 -3.532073067696412938 2.3273192402055777883;-1.4330576550032463334 -0.50913732883545192998 -2.2199758630986479169 -0.18403421902915401143 0.23756564573943447782 1.3575993274354385409;-2.1003887433179149191 1.8437260380229820722 1.0451164011808034005 -0.94416497916762398557 2.1258706011197037178 0.97812403306916373413;0.43518046818372618789 0.59358477861049763202 -0.20370118862812039429 1.6734182981884315744 -0.6442104785111091303 -1.125650264617671148;1.2596094413752780827 0.58635181922257983977 1.0414270665111595715 -0.556052353941194899 -2.5240154791052469285 0.082087677541738707232;-3.3829497489860083093 0.13242239938904698526 -1.0750503884721653858 -0.34380485167228236332 1.7650372970593046773 -1.3322401035219366694;-1.0514868675543551646 -0.64114093190286891577 5.1200857668112194077 0.98319028612834591385 3.1191165488389325233 0.70784088123505217727;1.5126047619549851664 1.4315580147555260204 -0.85664754318842006864 0.69750493347573216951 3.4106649347018378471 -0.75751549758256497835;-1.4961786980402351777 0.034799167360180238706 1.9789178258531250343 -0.73770121077270145449 -1.2070241551973759364 1.7433100007915618423;1.3832652447488507086 -0.29679743607071418232 -0.036514942028161356813 -0.083277121530862224796 -1.923574237107482654 2.427448360059643484;-0.16559422924414909928 1.225863574334675743 -0.256754766540100543 -0.028317824940752366752 1.7633829584552602743 -3.1376549562220414913;0.077351791930454175117 -0.14404060839544921557 1.9170534898062299156 4.3704659544860948728 1.8689952160412204307 -2.4561211237884235103;0.089573479979829437325 -0.085809034920193247298 0.90500319058478062573 -0.37014213442749593908 1.7861934034446946828 1.9482392362011071718;-1.4146022016960695389 -0.83368989671702842248 -1.721121486837440262 -0.31921533536392121544 -0.10671277648653448855 -1.0318994577429425608;-0.63592178232341944888 -0.38094918854912029893 -1.165272500732848604 -1.0637932426843441647 -1.6315364043176310282 -1.7885872980800019416;-0.20465088426956598577 -0.31685132756136019649 -0.26885562202984053526 -0.23477970780580081911 2.5057182962174904262 1.7574399829533682293;1.2626140144135500343 0.087965125217932330082 1.493252760131147383 -0.97079693320998816652 -2.3723760256894972365 2.2642876688584459011;0.24063967570375285887 0.40379117082692733698 3.0222493412021198544 -0.17224362513882141013 1.8042634595638902262 -1.1836876899342716474;-0.75172884195336997504 0.38179979791886792251 0.68668900359096518571 -0.19782751176868415555 1.7057600906376690908 -0.30872672102426240714;-2.1340093324330506874 0.59746271928431737841 3.5311328681593372458 -1.2510291736176433197 -2.5665413835304384804 -1.3624659221046746538;-0.1906088105120886389 -0.49347778465131214576 -0.95431360814658239278 1.5007653669298426369 0.97221990311071138091 -1.2561604764165519299;-2.4745058673848938646 0.80346176096353438822 1.0518889357908258742 0.53164146949640744833 -1.9542489736548069867 0.94322782032523444506;0.081891272047062493855 -0.60391050274967905676 -1.8126072994289925688 1.7141131585733255793 0.54053248560878419671 1.1849442727611889659;0.75831891028637798957 0.76348436640019423649 -1.8340754327704802407 0.62658550801736689895 2.0547748552349145434 1.4057571878765153794;0.43977737150769408148 -1.8360697957456331153 0.069857407554295272711 0.31901493987195733704 0.62365923268412415403 0.79087835426671004857;-0.72672608937803395701 1.2395487306852803755 -1.1131647101045707426 0.18896324466079156279 -0.13220507222423413807 1.525318972781947835;0.0036531864101457681496 -0.069090891440279258995 -0.8995832775791225977 5.0858010129490462958 0.96147492354478847343 1.0210676151112634269];

% Layer 2
b2 = [2.0652743921066014643;-0.77741818630906422971;1.1501859688728957032;0.48982377956916017814;0.27513145128072130641;-0.20002422263199096109;-0.64664481883247437732;-0.77633295295279414194;-1.4342086364598329862;0.56717537094975611911];
LW2_1 = [1.1491563231354036123 -0.41113038497104570368 -0.56031078184225979744 -1.2489633711824110751 -0.84466986955827327854 0.71844593668264844499 0.19631873058950016775 -0.41293294838793864754 -0.63097048079395490205 -1.0837216004024392557 -0.37742332229255826093 0.088552870920776377561 -0.66416502901377361123 -0.82542803157760002986 -0.60178648595617501016 -0.23739719541777831724 0.32461251526339474083 0.82247155768681823318 0.38792802768674722325 0.1847152168547985529 0.4796063163343513569 0.77508566310510451647 -0.07613911743110785002 0.58199485690419683337 -1.4875711625231002877 0.51859918328262677445 1.3310974402112947246 1.0551991240439653197 -0.47150815052339883904 -1.157010539579367947;0.18188034550919929266 -0.26337402480427957174 -0.16201188830955062792 -0.15362109826661798917 -0.22092691510437900693 -0.5812133554129230717 0.13809019899318872304 0.79620752982005815745 0.41818558651527865111 0.1629120424095650832 0.9002640540554958104 -0.40820827012242777432 0.16567381726763438787 1.2597527768699943174 -0.38373320252914261408 -0.69475007868865090721 0.34553221481168250317 -0.55779567533026941373 2.1226130451475810901 -0.30057946428104048708 0.2839777161345588552 -0.19141108808623563675 1.251541241296336926 -0.35381727083969533032 0.51355025943661136711 2.358159049347025249 -0.74858371981581095511 -0.038408355393618975882 -0.63316791771567892955 0.29588888827149800731;-2.2104835834317193566 0.23010183684499480039 0.97175426709058898567 -0.44100748930953520555 -0.029521952139062751508 0.66731229592148999519 0.54301255069319864788 -1.5217749854704398782 0.018341752868738854521 0.31543644337610826645 -1.0135989209979097136 1.2187883099045064839 -0.21156794987538030117 -1.0248322247791921136 -0.82114069172325032664 -1.0390664111696850114 -0.088395626096539711702 -0.41853520337997413003 0.46485806868964185679 1.119651119543152662 -0.018036025855342013163 -1.2374650252349763679 -0.66193455379711374498 -0.95145410169624455854 -0.57886151309790756514 0.84372653480108483759 -1.5060618520979078827 -0.49919565510894003957 -0.53849027897539625265 -0.13421547573702230505;0.39782431995688982695 -0.55266241954071460007 0.17760004281337937737 1.2190458186559782749 0.28282071965840288597 0.22525617784460308379 0.074846398090869084574 -0.89246096374186689726 -0.56308292924941871771 0.41461484484818650342 0.49390947330524681558 -0.62256413152208078809 0.53629907851137570418 -0.41871401326605639515 -0.23481384488414561162 -0.72305754203505723243 -0.75309729416280757341 0.060864431416491178439 -1.2504182084418231646 -0.12436815540663574697 0.026992247604744831063 2.2521124433997097292 0.49062531194907793575 -0.66859081780444473697 -0.19051568280524253107 0.050307469406474174256 1.1707002229725438358 0.29818812311979253638 0.31504435080606896236 -0.22521125826917426371;0.60274533982815392541 0.32497887146100445932 -0.29116549483888393146 0.87135620550980219523 0.57292412552287708127 1.0060137285285450925 -0.029986493812869025044 -0.053011613811060065427 -0.29596244230834128919 -0.23081794361435070684 -1.183772375714094327 -0.14993435373906774388 -1.0704946367843102273 0.43602595078674510898 0.47170634440650477393 -1.5396306089809037587 -1.6720869302451990546 0.6469483079076124854 -0.49295233319427295138 0.05454793723015478879 0.44930655606209346509 -0.61496947197778428773 -0.41831821740326091685 0.12614543593871571647 0.55421208206934435836 0.22591585943629283184 0.46732183470066684938 1.3040446345697038755 -0.68596411275037860733 0.19006695831479236691;0.48854123810815208717 -1.6228480028569480798 -1.0486344856674729709 -0.96197383419534743254 -0.37560854132298526764 0.27871433383579641285 -0.055253664135074008479 -0.32997062402718252416 -0.64322381928246441518 -0.16928745417062721068 0.7025346713634003093 -0.68253544136733290681 1.3920625138783131458 0.31793713643313997741 -0.59651691027896447395 -0.00038070871611876888618 0.0099712645175733041758 0.10414176027929500368 1.5094666266897220908 -0.027386206492066557383 1.6154815094363272898 1.3653845434424307648 0.58257368341746795792 0.12139984549734296471 -0.28648797038868056841 2.5674323855994667376 -0.020534859194903266194 0.48678932690052678645 0.80081596985277792022 -0.42036533334190911981;-0.32511058054390418182 0.49069262694532933544 0.79402048521697687899 -1.3354296267078273885 -0.54138949522867274577 1.3563467039263319425 -0.40594618976767887775 -1.1662574276115904581 -0.46551448079188001428 -0.63383025431350015211 0.82772981356955799281 -0.56950562962935746825 0.68560369896268502643 0.40305964516379783058 -0.6733306901450399895 -0.30365735062518400822 0.014348129786239090591 -0.015185040518503225074 1.7274965931909445072 -0.1427718167383296155 2.1908401744835983571 -1.0743796762888488949 0.032926786807934496637 0.39841453403122867316 -1.578989025426522641 -2.303543138147274405 -1.4084174495216468248 0.42399722674566892033 -0.13148371728341706755 -0.68427189945945110505;0.71162295028493915972 -0.79761833990530528471 -1.4484949407367924135 -0.4563735345721247616 0.32646562107218080051 -0.0833627809471139819 -0.15410925414942761025 -0.37759387834010810225 -0.43703384355637309167 -0.012595413658260333142 -0.55666209392150522994 0.48210085463005653006 -0.24408811765569221608 0.64512028609676785873 0.64436426842941241233 0.22525770936290512303 -0.71278062577135281597 0.38530380995560153945 0.58427056393018694802 -0.32160795171570327744 0.14712433202012317746 -0.44766072760352931814 -0.78041703535898510058 0.032625718259993566339 0.57596710680013007977 -0.51682582534588250578 1.2577764339249206671 0.57610793984574393267 0.14055739060542057906 0.21489708308832700112;-0.08069445924175297491 0.18462047603627695924 0.5045087395772012151 1.5989693369911655019 1.8734029699748429021 0.10913751065681255581 0.62950489135067877466 0.76546362648585009048 -1.4354726696159327837 0.35515741754608626257 0.91568172311119255813 -1.150095525010217834 0.32219598255932246911 2.3895547854597829485 -0.34845693253542009415 2.4489732132143662291 1.4854931817028740326 -1.2909027595663060684 1.0432959527361953533 0.30070508853269378724 -0.38263269457001358731 -0.51984877659394079785 0.49402578895752458088 0.75654616722065559653 0.34349433677536006515 -0.2347850626753499037 -0.57264048316431803709 0.16826961190540506985 0.49459972845444022393 0.12653720519724764859;-1.1204280656103968727 0.16863032616347453652 0.015834695182383718565 0.76384262276628178689 0.30813040363879962147 0.2036130318038474607 -0.022558052020675307264 0.89220360570493706387 -0.3975578781798070338 -0.42945713996839174342 -0.76224350564726994772 -0.46422243751043634763 0.18065558960426120194 0.794653859916786387 -0.074080205807895510572 1.364991415674853048 0.79886653342444136072 -0.15955296625401102495 2.818300178186246896 0.90669201691237433227 0.59879364130065027005 -1.1514816358235993032 -0.29348183300702351817 1.4173006754978403343 0.28062155925380916077 -0.084341533567964727114 0.91577494002021786468 0.28198189080057906031 1.0800270071270117178 -4.8167273561607046872];

% Layer 3
b3 = -0.22623039991678159377;
LW3_2 = [0.94410733821404158039 1.462115094224949452 1.0407059909579448043 2.2740198596504108686 -1.1816804787438965896 -2.625876565703625598 1.2693578321732748027 1.9501867388539044779 -0.76846754517482462887 1.5333973667591878076];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
