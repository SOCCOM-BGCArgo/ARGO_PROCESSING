function [Y,Xf,Af] = ESPER_tco2_12_Atl_4(X,~,~)
%ESPER_TCO2_12_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:58.
% 
% [Y] = ESPER_tco2_12_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.4594113177290129;-2.8696590348737914;-4.4687098630116893;2.3573953248367747;0.73011440924707194;1.8474732765082775;2.0271033792876265;0.1077674277032985;-3.292294359581851;0.17022543335149121;-0.31152444092872511;-1.8814159927780494;-0.29685183615498256;1.1898464421886374;0.52363209671957645;0.75205581932396781;-1.6967025295477265;-0.071114844263152108;-0.77076584220691358;-1.3958222053384457;1.2448591702439193;0.76390951200761581;-1.1296964377462242;1.9643690509523128;-1.5907064030476075;2.348074248292964;3.2366783084087016;1.7436738620115197;1.9479087743894152;4.9191698928617136];
IW1_1 = [-0.89466028782759788 0.41339428158719532 -0.45581745796329354 -0.03794917044075078 1.9924007561709425 -1.5806647199524704;1.5306115589171527 0.17403030491493335 -2.9102149742007226 -1.5001784372603666 -0.61706017644535582 1.7493254393938202;2.1453602558475509 -1.7013120878653714 -0.81230806833634528 0.32656695001216285 1.6255648735938288 -0.29583784295173809;0.87378205466422754 -0.76498227749098557 0.68694401393411997 -1.3826117616256091 -3.9078253159062033 -0.48869297811274615;-0.096811738307138948 1.4323259584118981 2.2396824767504016 -1.3061754714285416 -0.14683230600784106 -3.1685848463284798;-2.3995749458401341 -0.86605361488711829 0.3849033151396547 1.2699412431347115 3.5154545823982684 0.0087453078494046758;-2.114000439996794 1.1365570170800681 -2.2944212761454827 -0.90770056478370231 -0.49193789437990543 -0.55926430036884234;0.20615373008910254 1.4774947710547193 -1.3133614674379608 -0.76319667131946534 -0.68029335886440001 -1.2382761427317992;1.295498519355178 -1.162827658723778 -2.7614475255697566 1.61544880023254 1.3479675498188217 0.16966611338074752;0.29510860498864278 0.19647974322979914 1.224613010737613 1.5410255494323397 2.5325941681731541 1.4744461641121414;-0.28625605264049275 0.3835387980006853 -0.055028113933931165 0.93508295046147138 -0.041166584917033407 -2.4598040152126099;1.0392938870487856 0.21414559933757671 2.0731896894966519 1.1253689353942533 1.9386378507041351 -0.45664863061792532;0.53662530815860598 -0.94033994744867389 0.45110542113307378 -1.9890093608940302 0.69318372523394833 2.4505295155234657;1.8338444226431558 1.6123381776072774 0.30828634667324678 1.3694757151156776 1.8906323082039009 -1.1305055859261086;-0.39206948341954917 1.0343690147334792 3.1394576931441427 -1.8452217122189878 -2.7325697901288795 -0.62698170983430379;-1.7561869303667137 -1.6292285289901267 1.572566515165466 0.29785152346461657 -0.42727724794648159 0.72659325803316888;-0.022067603183489611 1.4066260488074567 -0.95043201956361201 -0.3570406409599452 1.0884733204420447 -2.536342718132103;0.78774180063520005 -0.48087149357769643 3.1208366646524528 -1.4541678637111968 0.59868556726985678 2.8330832799353329;-0.18439630605901516 -0.36327287706563788 0.27717031349583365 -1.4694539512929037 1.1989160112595707 0.63144511283997851;-2.3386466926270022 1.5125149540808955 -1.366017774268 -1.1028920452213069 -0.22275640685249223 1.4985281259744645;2.8907031330129596 1.6055812298280172 -0.11875855198270119 0.31340236379229186 1.5586178545439977 -0.95516292634724753;-2.3066818492477235 0.91280650650032336 1.345729417452594 -0.41711623814783871 -5.5759366796302468 -2.6373328111708401;-0.15367723374773032 1.8959448391627642 -2.7170963924525284 0.90707500427702681 3.7685910627307173 -2.3086974006384726;1.0447522319159368 -1.2972740734695969 1.0276204695020164 -1.209426806597252 0.82104054138823657 -0.47954916667892294;-1.3637153965339814 2.0210059218942069 -0.8372067971984769 -0.35970485865011814 1.5130782753444338 1.484842537850914;2.3216464677178932 1.3661624371777588 1.3687551861497911 1.8750223085632085 0.16020029322001716 -1.4384544264362342;3.5177130413699804 -1.7156270727380341 0.36576994208106539 -0.94338257747778731 1.0056978700928192 1.166492538558219;0.77545691030193109 0.13309456807036629 3.3919673391534273 -1.3619242707565435 0.026415061401364254 1.1585240849285545;1.0239085076064391 1.6187971667886323 -0.84218871184103627 1.4092132775338841 1.1129849808472938 -1.6475946783444027;-0.22908707314349244 0.54801729408574473 -0.65240673804552574 3.6507967021944601 0.9804086119890616 0.9348571464900497];

% Layer 2
b2 = [2.0465540966426401;-1.282263648357147;-0.920959182503022;-1.0086009613377607;-0.005145936579757376;-0.50625025855549743;0.79915570592703067;0.67166291082848906;-1.3135637741212867;-2.5021074363004172];
LW2_1 = [-2.1652163435729173 -0.15998743314359079 -0.42275609207208625 -1.872553724897261 1.2649772721991654 0.20817412193984194 1.8842231951599475 -1.2061116660294193 1.2102348905875797 -1.0719310847355235 0.49490383050438524 1.8972095324334732 -1.1540088949112928 0.26268628217272671 -0.55448764810750706 -0.30778317280255973 -0.47370105205455276 0.78121883880175857 0.8182552023178471 1.7010882719975073 -0.12160684896344787 -0.50645588928285334 -0.32710145792101436 0.63346070197742044 -1.0545138827379885 -0.50106616069461074 0.57607793198426871 -1.4333516598413991 0.95958843774448122 0.82424018988796832;-0.084592765994949456 0.5181730206660351 0.0067578769927588338 -0.15102246223482946 -0.92970461631411694 0.24751609948147119 -0.064699002116031204 -0.11349717934502188 0.43414809032559737 -0.7913512712538926 -0.86587009244834146 -0.22980123642264527 0.15841327606049391 0.065194374878603772 -0.47731650042656315 0.39048449489823323 -0.18368872005090894 0.060391815563466268 -0.64465779744099172 0.09720211107073945 -0.07569028500708061 0.32158151624744508 0.16058039249194808 -0.050645450996231592 0.23725405872766636 -0.18279052614769642 -0.17430083149854603 0.35116129754262992 -0.38487957511845616 -0.13691075515842482;-0.092468664870455394 -0.14815478101313201 -0.11625098696183295 -0.047068382360858127 0.126403666091322 -0.30567803712378233 0.24741504294243688 2.0805211621929427 0.04833520741273005 0.68467135591184947 0.59757348685201217 -1.1853277055120435 -0.60130095490273039 -0.41908899218223594 -0.39788155016415033 0.50486208439069047 0.54216420780640651 1.0741294986969148 0.12656240848818004 0.99403374031477187 0.063123469007756575 -0.020871671643115847 -0.33660485505955134 -0.40459735661721413 0.13982098984392027 -3.058036047978645 -0.39423917053404417 0.10978508524656777 -0.13340300493487847 0.5609949751022032;-0.89626086121577064 0.13180727203648823 -0.32744648843142909 -0.54083542681192209 -0.87660121444719241 0.16391656896496684 -1.3055209790477029 -0.07559399593648998 -1.8555563408474913 0.15361234953827071 -1.069448881694419 -2.3163590106942733 -0.70399180549090878 1.3789023251108479 -0.32971536423362607 0.75152456958996683 1.1200344703758318 -2.1897049841656324 0.44291341988513189 -0.2014215442665982 0.076565596002052413 -0.22225740956222537 -0.66183401220295268 -0.15656512183582919 0.18068251177477046 0.3023111239845655 -0.7762649120295777 0.61135937135621965 -0.31373835167845426 0.56689713960826671;1.7569543314656269 -0.36226196238375064 -1.3351578282553211 1.5341719754666205 1.4913875310629339 -1.4872342719364331 -0.12189012171528883 -0.57172792991117349 1.4131156393174993 -0.38256931123342153 -2.1616820392556368 0.57326686813183292 -1.821583547813282 -1.6776246699480291 -0.24387314448371294 -0.85540164695625676 -0.33627348006445051 -1.8853853231807434 2.3840271802937893 3.4083133576060369 0.86605136109628533 -0.037226064012187129 0.78819832121455735 0.055001635783621446 -0.3750848861892157 0.39490012753920389 1.2792593823434839 0.86473453192905703 1.08916909679817 -5.5647619219437612;2.0200504827841463 -0.29332325147612182 1.2179828553298044 0.031024952365538837 -0.012196639960043413 -3.0277473302849982 0.043467002805160332 0.88532086492026385 0.35100739157739302 -0.36766181024491107 -0.30815443154754663 0.63158850995817994 -0.20206803056236375 0.086017766489812797 -0.069512361992098898 -0.1998788638733017 -1.276467820578489 0.66695737149902468 -0.25599090609766495 0.62547119837342868 0.6109885170046494 -1.6761751042901678 -0.20231014594423682 -0.66393938765106697 0.42574934717568036 0.55021024958335651 -0.48356666901534112 1.1526750398220376 -0.76803311950433961 1.0576606927341423;-0.42161013311402984 -0.42437174760572971 0.68119751924449301 -0.086884349803409699 0.37906923139571064 -0.17730922684948169 -1.504352808737818 2.4766141382075402 0.98102164338428843 1.5905827751303883 -0.19687962114810953 -0.53787467566571179 -1.7999153684307201 0.59233791918677181 0.86423042364679781 -0.4160571952354869 -0.18888987449797073 -0.43030431568485639 0.77114916912312981 -0.029800191230176961 1.0172227186141496 1.1826940761074924 -2.1026712447012561 0.0082202101069336134 0.12509760210045717 -0.19676210055059024 -0.5429990492100818 0.14129523704828656 -0.1739330842198612 -0.16172601074288229;0.95002011675369613 -0.28686817950280286 1.270655676922573 -1.6372814343815663 -0.41376495869507279 -0.22276083944764222 0.30039405981014228 0.595142857922214 0.24444699793155439 -0.58591285081633215 -0.25082347420608708 -0.4293144034557641 -0.69194859492352134 0.64934018073880295 1.6220425844820061 -0.36758682237036916 -0.56436269604862777 0.054454447371741994 0.83387580848754317 -0.85511514621101792 0.38299371546756378 0.36927140015800691 -0.17624194169893517 0.072781249913159485 -0.54856882255030703 -2.7382562017869829 -0.45193034269939686 0.63976525424181285 0.060488028830398749 -2.2108795400555779;1.8331237467042729 -0.36433928952081407 2.0468328387410857 0.55182839531853267 -1.8142134810100738 -2.0314957989707025 -1.3146402470466487 1.3896914041396182 -1.4953791122084048 1.6000647678285695 -1.0935518574100123 -1.1884961117957713 1.2362113694729049 -3.6315665248970816 1.2383035102041926 0.93998105470697313 0.90991446474357351 -1.5680862915986629 0.29602143376950574 1.3637013454153908 0.41784443824654038 -0.13008454927698851 0.64120110146944032 -0.23240954848240805 -1.2983715386760353 2.5219890355147747 0.21741590805684904 2.6547573826103075 0.81092590096396722 -0.71443155501718314;0.59192153181101048 0.33040492795406251 0.072292891059399747 0.42465129688232006 -0.2948328903299835 0.39254267974086804 -0.73593680118475691 1.4156273922652494 -0.061833052192069193 0.28260141764680496 2.0669613982452635 -0.84900509012728875 0.35942604425352592 1.3104372277197571 0.054635805666435062 0.12172000049081624 -1.0384818918380401 0.041708315717358967 -0.1871400162376389 -0.13984478796983327 -0.22427715249946481 -0.11099495915846835 -0.027911428440870405 -1.1255580734312258 0.40891812591121129 0.45179952286829717 -0.18534548781137231 0.67569325368919098 -1.1160319495312809 -0.23220511876927097];

% Layer 3
b3 = 1.4162346425791936;
LW3_2 = [-0.82402158781672619 0.047583307857564684 0.15532093870699221 0.01972856744737422 -0.35252843551757951 2.3849974255149839 0.018412909524833054 -0.2041147419321879 -0.32437368240718628 -1.872248491906247];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
