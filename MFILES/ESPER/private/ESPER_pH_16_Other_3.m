function [Y,Xf,Af] = ESPER_pH_16_Other_3(X,~,~)
%ESPER_PH_16_OTHER_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:26.
% 
% [Y] = ESPER_pH_16_Other_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715];
x1_step1.gain = [1.0000770825255;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014];
x1_step1.ymin = -1;

% Layer 1
b1 = [-24.737768507042165567;3.2584601266749784187;-2.9608547387208790092;-2.2025921146046489874;2.6124022694007056344;4.8256686341534598128;2.4505520394417747987;2.4490713086849469349;-1.2811116010727414682;1.144789541574210201;2.0015232396984545815;-2.7168746483068031417;-0.57254380281887551352;-0.85375729578427705935;-0.96640589393910836247;-2.3963286645666848074;-9.91926459966452434;-3.3431414765677920364;1.0371240408604323058;-3.4504884261947137425;0.25043195830009429281;6.0004602155967106114;-3.8776504030036527126;3.0863883609687445819;2.7931959973398243768];
IW1_1 = [8.5807232842721443689 13.889213997874843898 29.746943109463142463 2.0562230330719875049 -4.8068948124978891911;-3.9085353575566266215 -1.6386677442565076301 -4.3404352661355130039 0.31305678301051181878 1.5057822682105059808;0.83509668683967308578 -0.9225763708234279159 0.68523929716276066326 -2.5306264478396403028 0.2134381608376830497;1.4650667338565981357 0.54521195688155743575 -4.4570254721947275556 1.7487542900070305318 1.3762254713444710408;0.83294623770312037347 0.0092844909558350632861 -0.47884928832400236454 -0.0068049222025671077599 -6.9761280438049553254;-0.54721688507351506914 0.34641568000728978349 2.2128877768891861422 5.4964543125815978897 0.29336125048872035981;-1.9830296680475913984 1.7138258244289128474 -0.19218144673164017089 0.75425596840999387105 -1.3014527227408452248;-1.9625448857047942397 1.6214229203329373341 -6.7207565095388313026 -0.22241104030414238224 -0.16626671516261101735;-0.58756694134610332192 -0.9736042931157654623 -0.62917787318057216694 -1.7958321111392916425 -1.0297115512533390191;-0.43375123624625322449 -1.2858415492977086636 -0.143477246727733182 1.0371102709697819222 2.0905459574126985522;-1.2792998414498988335 -0.39359648606211827815 -3.8660182201426214199 2.1833832998354627541 -2.2425870727024803664;0.77688629518312202205 -0.61600628239566024291 1.5338332382631734152 -3.0814147549061936537 -0.62449363957407377779;-0.17514735768270953131 -0.24759040864215167699 1.919680039221745238 -1.2070004038260699897 -1.6211678104613012064;3.937867093076897973 1.0729372815017450549 -1.5733828874299145006 -0.23883195594948244955 0.32132586521243577948;-0.4803333401510422318 0.32892003001565034426 -1.6866806660893294278 1.580621195808840751 1.0614615175415891279;2.4012020841128070003 -1.943206780558736968 6.1538616646683532707 -4.1438052607196018684 0.10845807428603018718;-2.4093764370896506577 2.8616232892200024196 10.940521307573790821 0.81358261934363207413 -2.5823528615615045645;0.24557714340317562951 0.056720668662386085346 0.5425551043600959078 -2.6435814442725700246 1.0585573635095919531;1.06017981725256627 1.6009380654164560021 4.7015243985173160723 0.4886776662139002414 -3.1528879995303453754;-1.3214323776706498048 -1.6039105041011947339 -2.2419383925127074342 -3.4331584598440194611 -0.45457434622181264183;0.88673630147673376811 -0.10509296738171430841 -0.38560824051915648658 -1.0600530871042346259 5.0374503286211895769;1.4080004517181285983 3.1558693240822726089 0.44312777192960745021 1.781020595818352259 -6.6541981601627080423;0.023382059838219618891 0.010266827161265923429 -0.38329074828775738792 -4.5909605825940964507 -3.3665579850337814527;1.4386800086174835744 0.59724564379365852052 0.63450718664047112139 2.6976790938999930525 1.0635321766341778726;0.22130349734021362296 -0.14075658403474367031 1.8812765963092559218 2.3368811710135211079 -1.1305042286665176743];

% Layer 2
b2 = [2.4664945950753387471;-2.4805288879279596692;-12.678546840236418092;0.68947025733082711874;2.5729623544641904154;5.2765361864372239964;-0.93824560546744939504;2.3218019977986323887;2.9770585061131131788;3.2816574284870476674;7.5994525755850412807;-0.24883636478915796553;-9.0002207969893071038;-0.78693631984994572015;2.1035693264996933038];
LW2_1 = [-0.15076183771846329851 0.091622963203003199295 1.7323338865055026847 0.2420638361536426586 0.51023045492156460234 -0.30960947337296812476 1.0770351894552672167 -1.0819180018221883355 -0.59382478515087433468 2.0475005780109305498 -0.64982074763809705154 -4.0283633475486109177 1.6065240417778277049 0.057837869350573452298 -0.29029963056648827591 0.81148225399175788475 0.75677557583104748673 1.0551516118005461742 -0.47818301762729220616 1.7615754851680407445 -0.20451520079588314527 2.8167216944194723993 -0.12970503814740377835 -0.71748985953620336709 -1.6503960941204345314;-9.1766786300678386823 -1.3594129939228953852 6.8966910756411641259 0.20752464662689859565 -0.56612911536031307325 0.0015675746129367364862 -0.33911811799353563934 2.4789647049781051713 1.7067985484210990155 -1.3206260252526398347 -1.1670048221858062565 -7.9889104079731048103 -4.0892110253784625939 -0.23256969833480456433 0.34947715841122806157 0.64200800511124667125 0.010906836636607835506 6.3573533349896713673 -1.5526747800213309691 -1.0972176162705900015 1.7766036292402540564 1.1775659194138736741 6.1952984941639890337 -1.3330879038994656316 0.056090840155994317606;0.7876690732876944212 1.8531214511159059821 -6.4228598340538516354 -0.77026235742816040464 2.0447184894672725264 -4.6250790695177981249 1.5066092050684714021 0.30349937923343300872 -1.799919061624932537 2.2052707863168388158 -0.57297123436343144753 5.1200636731736697271 1.4380364898361033266 -0.30950484735539618431 -0.55413544314016294212 0.13308270324070944901 -0.5950660731148307292 -3.5705901905282915187 -0.6657437130262375824 0.47049649835848528223 -0.092857925135341135014 -1.6060581742357513679 -0.80739674135293226787 2.5358279842560111916 3.045176973950170396;-0.445030312557449792 -0.25460063708232871793 1.6369031221754661853 -1.4280538445279014059 0.19612292898824282283 1.9365803779935835127 0.62247333066232579668 -0.76342675521205338729 0.58621823124481886591 0.89399476814569767136 -0.61329624893315137779 -0.062034678257454206607 0.95974639320899102213 2.3091363753855698171 1.6978207282377983933 -0.89649109493557765926 1.3372863937824168712 -5.33366171724086513 -1.8070284945128016751 0.65812377806506383582 -0.91419037060399099826 0.13541159087492463109 -0.61048416362674151614 2.7822122471895713858 -1.02084464552837062;-1.3496392004492570038 -2.2734666696092666882 1.7490796322777237837 0.092449249294107069264 -0.35458655669546945699 -0.98114574845184077123 1.5326530156916691183 -2.9083243804122016485 -1.2418553800022149591 2.2660641167745767532 -0.30679522947941750832 -0.31607660625030764567 4.448799356188370524 0.33027210091393749414 0.64451983403806933914 -1.9008376645172231356 0.74652589075059339052 -1.4653086386340641312 -0.99165512722469573159 0.33687032547099554636 1.2813593910615899141 1.1716043434397551692 0.37592625651498973172 1.2510378303986882109 -0.17462097111975005692;-0.32837481241046551084 -1.6242218868501843154 2.3522379903541899004 -0.43779085350182561642 0.98392399759205084742 -0.63720811567655932794 -0.47329220182298253894 0.44467755462951025214 -0.66621777115521596535 -1.0956290512279869276 -0.15884410145073510345 -0.95530317566615374769 1.4194900171272069045 -0.41362872106930526073 1.2215596355672766471 -0.47779821307121639329 0.16489166090505796847 1.9744131353934042394 -0.20105791230779065937 0.20523821131532660189 -0.72459676960976726612 0.82042287166610106119 -1.7866675944005885324 -0.42985454610495682504 0.63198156523031345788;0.40798669227605616205 0.18519627888959591666 -1.9723572094284860245 1.3640080191883103833 -0.20022616718880911768 -1.956839058637819484 -0.7873510531157987824 0.75405766761759773775 -0.50532585851786293585 -0.82645817103955809824 0.63995299295488206059 0.21670175116645581936 -1.0072319049021469795 -2.3551759064639790076 -1.7860493528727279244 0.94477409386808997027 -1.298526300696982716 5.2271734180208806464 1.8527030246488238596 -0.63206332343098770021 0.98222042672232756644 -0.14498064447628403184 0.65389212207866331816 -2.6669891718048477358 0.9708135856960279364;-0.03509026762418011175 1.5772704217384923009 -1.9804791360442126624 -1.1004658434594258853 1.711570181780117883 0.56024624271277445597 0.51447892284948859576 -0.17567287197789954734 0.30048103782478818857 0.71699916885386649756 0.18732837352035613954 1.1079811330240252332 0.28381093066636581268 1.1582206476441756493 0.30739608551291947025 0.1167594557786377496 0.038950435915433241629 8.4917000123474952744 0.7012558174457037552 -0.81237123884035511434 -0.99217904492022201968 -2.3571280612771041696 -0.60388325378815443933 -1.4791377842104427298 5.0042645267238246021;-0.036898251763322065244 2.9523656133854161432 8.9258402412214028487 -0.94538449700571358658 -0.12401909457606198617 4.4455043823750610699 1.3264985394664434715 -0.67728768678259931857 1.1331371821166345004 3.6625693799174969811 -2.4341585133275045472 -7.1657364125871776395 -0.42488867545102726453 2.1548898357212511456 0.38936559550945198938 1.5011408108750579071 2.5529055559944313636 2.5490010993945730888 1.1585149327669308494 -1.0293546897466905321 0.34678036358310726506 -2.8501127211515493443 4.2299859295934600922 1.7660354439413179506 1.9478074365446762517;-0.34900857513509464525 0.37534065101656949315 4.0622627831643738361 -3.8573365371204397789 0.74815751195443969124 -0.57117888880070222246 0.81639363070956605384 -0.83400381177516058617 5.8009693633215038133 -0.034129366402226468669 1.2853721981934733698 -3.1142326956758181744 -3.1874421442032510043 0.79482685310172829229 1.3310199452842346179 -1.6428828681169229675 1.7738414511510043337 5.379148314213399118 -2.410427619381012132 -0.76780551856027268176 -0.47120707314451842906 1.0218988330421074906 -1.4296213321314539257 4.7591465604870357708 6.9038910115619414043;16.865511786087335366 4.3079863701206795312 -6.4655525820788133373 -2.5779721506425312683 0.59800569952338022972 6.2357024330326034089 -3.1797426548167702087 1.4809391543071455111 3.8549721971858366132 0.15968181805993636457 3.6808115408210486663 7.3769203070304216752 -0.063821246031254164066 5.2574720683562699008 -0.8867908972799918299 -0.12210470311397106369 0.025020765686867757482 -8.3067048846366358106 0.41916541709948035299 -0.50851491761974587646 1.2569528484004885982 0.37357968558407095294 -2.4538346134729080994 4.1543524981367552229 -4.4459942354641013296;1.7787960819266002144 1.0663950026377453373 -6.4572037797907686496 0.44060607137283092083 0.62493845403840320163 -0.96109960700646845932 -0.69064919580875239191 3.0589331406420074977 2.5875515695527382398 -1.6781315221383121816 0.066626997251423847324 2.0197558191046249831 -1.277410821758782955 -0.15466659543652161446 0.050360008534965743088 -0.33352209426880435883 -4.6125914326405839105 11.126548546497570413 -1.8186090145140934027 -2.4691150535005128575 -1.3221274908931497372 -0.4743108109563041741 0.77375850755379149692 -2.419510389145801188 2.9291430646723957132;0.69832879145083326389 -2.9580289833759505491 -8.4116528133820978042 -4.0606651701050422432 0.10661819477120576538 8.7457318834758002168 -0.37865768988022513453 2.1610460716651220814 6.44512446181926002 1.5433421494017600661 -1.4069554704845288473 9.7185668887789411485 -2.8464980692805208484 -3.8332661076444818349 5.6566234400656698611 -1.18018929225271485 -3.6418317704433516013 -15.466880798218017645 -1.1858419055797788655 -2.1145158867780842193 -1.3044053504221893025 1.9228134136817325306 -3.9481812754887855021 7.5037188175984690375 -12.220509371178579272;-0.32565137668847587982 -1.2867216763341271513 -3.379377482587272663 1.0468426071531535815 -1.0161257087783310826 1.2836671159697234934 -1.2308503014509302176 -0.063539798695267393769 0.73144635035111149612 0.75267655566825586444 0.16651053202924406826 3.0737438948336728295 1.1369570697422985983 0.15046983213858092232 1.6769807811643302475 -0.85067513855015219892 -0.072102179169863445107 -5.7334267498770152827 1.3711220008722575514 0.39181545013865937133 1.6045552052025759959 -0.74695349893414331177 0.54722585288196268216 1.4585915203361141668 -1.8233197014869813035;0.30894166583671978099 0.22343891182267183737 2.2176887731782235491 3.0487846376755420863 -0.34644895657151980606 -1.5223625355460514985 0.75100225453543378862 0.14436916631352914031 -1.6097792546345164322 -1.316856472056539884 0.75800700359413375473 -3.0525863596554128065 1.4490065933471103499 -2.3901564139396209718 -2.2915065886183807464 1.4610094419324284321 -1.4219049939168231234 6.2352639778323357689 2.6508941374546819425 -0.82371306334301641616 0.65715649233611761471 -0.072666934128446061814 0.77194240890817533707 -3.3971916241704498418 -1.8181946481071507016];

% Layer 3
b3 = 1.0372034032233985457;
LW3_2 = [-0.50130601774705607632 0.13020133988644691514 -0.17452925453032000491 -8.3335135727540237127 0.17077760846920991833 -0.31783752510904950128 -7.6565722712941655104 -0.2269037068119080236 0.11642084152592102608 -0.38527301213459780316 0.16140758249764627918 -0.15030202366335396191 -0.2256849488830045547 -0.32944229319256718158 -0.50926494908493868952];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 1.90239167587468;
y1_step1.xoffset = 7.36300175998845;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
