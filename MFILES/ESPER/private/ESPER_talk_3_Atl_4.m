function [Y,Xf,Af] = ESPER_talk_3_Atl_4(X,~,~)
%ESPER_TALK_3_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:45.
% 
% [Y] = ESPER_talk_3_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-143.241523403244;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.00458552991639557;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.63958144270253414;3.022646351890304;0.75904293989353988;1.3154081753970983;1.6746513736060911;4.1659054667671125;-1.8154202262558037;0.78328293906540125;0.11857898497111968;0.83369127274963184;1.0562029013158807;-1.5881056432198906;-2.304604655009328;1.5040422807831382;-1.2662271038964414;-2.4966712607568207;-0.17420414763877673;0.49677551916480517;-1.9265899951508505;-3.2566741127820582;-2.5727342152045911;0.71722115318386626;-0.18444845081804137;2.9630828627302868;1.0016092631832487;-3.047969843561193;2.9547490243795895;-0.5982209720789049;2.7895962536963301;-0.67147148876992102];
IW1_1 = [-2.3050296254862181 0.26507061810132615 0.49591148749099923 0.53598765428189832 -2.2367649025718013 2.3334844658440144 -0.61572693873544015 0.98961615233935085;-2.7965464624395993 -3.2219706620965018 -1.2674799939565746 0.050909569886890771 3.1099172580129242 -1.0796850892088632 -0.44735491957057327 1.5447953966396835;-0.10195697933104572 -1.0116036656452805 -0.34229865271022492 0.39372239065647524 1.8221034266107126 -0.48703700344799267 0.6428073770929591 0.41436604717497172;0.017930782025863842 0.036498844944584156 1.4133362036421047 0.18659114249720765 -2.412023543703854 0.65639971309123402 0.72675579337920049 -0.26796826538047813;1.8117470514032787 -0.42300742211890752 0.058931454461830311 -3.1108181865261111 -0.30082377666535581 -1.2418134803320851 6.0684861799995264 -2.5960318844245078;-0.47343169346396702 0.31410617980539463 -1.1551575142611052 0.86683227884423963 -3.7841780594541676 1.7384315337199696 0.86662341124110387 -2.9234968454235699;-1.1156510803737216 -0.3682946896184775 -0.010966134188826842 0.621579997939391 1.2576769853215057 -0.074705832383240231 -0.034468671992273527 -0.58472370866273571;0.91633808181985943 -2.0657912697708984 0.87517581564284386 -1.7787537841588801 0.3334127640388399 -0.84467666744756353 -2.0963607217986988 -0.53803932858878534;1.0795977561695196 -0.43266950076443372 0.067064750275923971 0.36608256609799822 -2.7376032176075009 0.54496452955733043 -1.2771713396162963 1.228332191848188;-0.71790898925433533 -0.55604813111392326 0.21549849193160869 -0.045445840737051643 -1.0689231329726681 -0.73783287293859778 -0.93308124304018791 0.19198121233363266;-1.4207126727533628 -1.800271707681248 -2.0079455303842058 0.16291507362446245 1.7594314397061688 -0.76490332493866653 -0.0476608478770034 -1.4402266497022103;0.17156310111466566 -0.41101953789164508 -1.854100320482915 0.51573562493161151 2.6366486442735892 0.32974912138242884 0.10173269347416583 -0.32657472816830768;-0.56839467259868082 2.6987597306018736 -0.59548822955928904 1.5278397185787107 2.1291833387203862 1.1640399140441264 -1.8965295036797127 -0.03695672674836209;1.9734796393995575 -1.9317881914469395 -2.7258898703203553 0.50264811052106806 1.1414536779983027 0.31226522549113067 -0.52816966219542838 1.109036132384094;-0.79360812089923949 0.16258964649214522 -0.38910335139592434 -0.39062937006841236 1.5270968356248187 -1.0709055773298806 -1.0560037494603827 -0.16434230330122521;-0.95412666669943358 0.20347377114541934 0.26972284786474282 0.46857790141454092 1.9942967284953905 -0.35189120821184222 0.030147121779240903 -0.82481387309282928;1.5045264514223855 -1.245488275640755 0.38465567524099786 -1.1086314936964168 0.73777533324211841 0.90619761209674377 4.2392751243608133 -1.1622193325076557;1.3054128918998256 -2.7007946960249014 0.52957367634756181 0.2827555792576032 -0.34039731738236889 -0.44893704252843764 -0.2056257483401403 0.16919517451616906;0.91034394109053896 -1.9446550470818722 -0.90973633533512566 -0.022920635425334575 4.4165807617414075 -1.5263387460737941 -1.5020880642668482 1.0769364045226022;0.39662798878610173 -1.299361077118784 -0.036794066648577761 -0.39295728166445776 0.82393199127072425 0.5508260895490884 0.030482475655016904 -0.76641151329439905;0.15873735157954513 0.17939120148105786 -0.43858674054780389 -0.71619529180214514 0.99786031075538939 -0.68427084582502928 -0.43598418710402725 0.039817511433723168;0.07105435561241584 0.54242992975758497 -0.28923519898155031 -1.6344766125066981 2.3604920385913108 -0.14723785867354783 2.0056449330435933 -0.011135022387120231;0.019048596192579616 0.049146829423833499 1.2429267989842407 0.84078218929126303 -0.21401810555088019 1.623412943603993 2.0679025258671797 -0.69689313525653951;1.3612680861935906 -2.1315390294893009 -0.09739663623952434 -0.85986033209291146 -7.991333835729364 -3.5216682541557547 0.17000046642233307 -2.366172981750168;0.065632223529400915 0.043937114174562641 0.12309566241224082 0.33162766843500435 2.0797478391337751 1.1562770325834311 0.036240153106357698 0.4073860384931321;-0.81707966636628016 0.98952490993659314 0.28394011949591436 0.21165014060715048 4.405130422897181 0.052694204169661446 0.10856763019248941 -0.1646586072439449;-0.68430007436417473 2.0068170268741365 0.20915863611582955 0.57508282417276635 1.9650282078809376 0.043884341610440476 0.091931762963760405 0.94152809851948582;-0.031520092886623205 -0.1230977641863395 0.85858594512674069 1.3510809347371131 0.084073539855752916 2.1021062601922553 3.0338240433232877 -1.0849759712266138;-0.89195001119433792 1.9553429894453023 0.94620037067206531 -2.2180524543340181 5.204597362179781 0.44175655065598751 0.47615541426981595 2.4296488130118918;-0.28261441205828713 -0.14042886862436602 0.35069710076367738 0.65583619695138951 2.0798158743204631 -0.1792052992319598 0.16387629656209207 0.039564835204526229];

% Layer 2
b2 = [0.17890986259680455;-0.76009360627677569;-10.494058763302485;-1.9489633260702184;1.2474790335200301;2.4950064342146079;3.4148229472222948;-1.8038940389352009;2.3429140092606331;-0.23560020229019307];
LW2_1 = [-1.3633994984509812 1.0048875689363383 1.6492373288501034 -0.9970343611180893 1.7969884282595361 0.091858021403772305 -1.7273565355337359 -0.22433652544643645 -0.88591339860004636 0.082282950219483258 -0.69935051015226235 2.8663953570668759 -0.7216560363275436 0.23100035988348774 -2.5176994950334373 0.88116182202628468 -0.58171410637382426 -0.41552699137747928 0.17240949831662519 -0.1766432419248416 -1.1550074914067066 -3.6310699513667419 0.82241758079477212 -1.7863986519898682 1.7341312008497927 0.45579327312490958 1.4784185876401494 -2.5548763509469814 2.9955671483182535 0.053233820896262551;-0.85562087531282138 0.97121283430502447 3.1158650874054716 2.141636345959737 1.3190669714160757 3.8053467871936659 -1.1952332647412214 2.7377365943772065 0.30649976137299201 -0.46223403244372469 2.5301900815175418 -2.0441506544078529 -0.82009378976885627 1.4807295008987822 -0.97420406407951865 1.3407288944780715 1.0020877182586716 0.0075215232242340311 0.51063610118363156 2.3725514090087554 -1.0977998029214797 1.5739503690223016 -2.7775906506739618 -3.5141889596583331 5.8129425719024805 1.7948168961322444 4.8831478109583761 -0.31987980640535874 0.70511372097625824 -2.2052416610397292;1.5332544673057602 -0.37992312520995114 -0.48021150087229486 1.0358500679832323 6.2970351596338814 -1.911981392281447 0.28225976660707319 -2.9407544731644677 2.9415521102092494 -0.12335930089176589 0.58260473621436959 1.6139823279324079 -0.7775079608693114 -1.3607390256156369 0.71089059701899582 -0.68211565249126616 -0.31842794558760751 2.5834683406315664 0.16492791584445626 -2.1820386775095613 -1.8244065928520257 -1.224429939605131 -1.049984091834117 18.233314383856403 -1.5450942817567099 0.68933575844002093 -2.3033949846875754 -1.1963517774339381 -5.9364485014567716 2.1452583546586825;0.5431896378819463 0.70212866326757062 -0.26898163929684776 0.67090294732067035 -0.44386814202379615 0.91400304566592083 1.5183577204972527 -1.3390998794528843 -2.7629062135616804 1.8150305099041792 -0.099520351725746733 0.39629348378217416 -1.9022234664203774 0.55927611965252033 -1.9335108088626582 -2.5984878748478755 0.78856188480523848 -0.60342373493704349 1.7707937489989554 0.034124569092240813 0.0051191017779521307 -0.65318997215304753 -1.6294386766227487 -1.9349940245236088 -0.59397674844190496 4.2297199259392135 -0.20557498475090677 1.9181885743037741 3.1614056095125198 -2.105769646014831;-0.051036389313244675 0.29581356001667275 0.22723552321713864 -0.35789878394678798 2.9180237323035563 0.56494892559068111 -0.55115629622174023 1.3843813415621611 1.2619737378617872 -0.29987909162838033 -0.22715402139183283 -0.28941855527101784 0.80138018515538678 -1.3360428426463831 0.56571663761564672 -0.69845599449346818 0.37947039974647351 0.11286540522314288 -0.23616338426648922 0.33727215094485086 -0.14421825516538192 0.13732923639170902 -0.91066860555003859 -0.94632203556472427 -1.0242683428213952 1.0362569747674493 1.3547139847930059 0.17154423792892554 0.58016495075018459 -1.0654363556585174;1.1490645718642083 -0.46137596072124221 0.038290557106058998 -1.4005540315978415 1.9375784609469986 -0.068525745915794328 -0.43106431130797862 -0.45654612438168496 -0.56111474352922663 0.27587248706892498 -0.34599456612769036 -0.74992681187338328 0.22802768775328053 0.49494192474184473 0.068342953990886884 0.71256896201692321 0.063806561809637077 0.32081332323053624 -0.0021144332604851688 1.0085961998099704 -0.45513289949571206 0.011225600347486781 0.37312846191066446 0.27771694810276604 -0.22605584799683953 0.40293661567650152 1.4931285666800418 -0.053705063700711028 -2.7345511877302058 0.40923295677750354;-0.81316989631300518 0.25086685740658754 -0.13252370908838365 2.3282207185987338 -2.1320727369018084 0.54578828174760563 -2.1936356553450049 -1.0347263740574166 0.014604708005430289 -0.22634292531367922 -1.6953440518008684 1.3880110530102279 0.4258867582064268 -0.012279464093343734 -1.0161046947921666 -7.1030146167478705 1.308073250496931 2.1887865959667554 -1.1977673748396482 2.5952872609715332 0.87737678227051008 0.50609109225070292 -1.4272627385814356 -7.7727490744655805 0.87640616375083491 0.24986709943243152 -0.29123051253668986 0.014957994034655616 -2.8136516397023303 -0.093958952123980866;-0.98357216867198116 1.7559075856432993 1.0532959717678649 -0.66372596392544081 -0.015029878776504637 2.4150879666150824 0.25899519861751696 0.42888184062434848 0.035275592736968966 0.18841095887902706 0.78836430655753575 -1.0102616356798415 -2.527281995213011 -2.7190469087448736 -0.25062103855092915 1.2037310037462223 -5.1424950766459636 -0.18336867190512554 -2.3587941210087271 -0.078337799979195682 -0.068693218958285784 -0.38106073713177424 -0.6834379087007949 4.4848591967617262 -0.25651696708572386 -0.87944987634103966 -0.54806967834129316 0.32775426370586341 -1.6720233973673442 1.1864758185838811;1.1085500020306527 -0.84660863002541709 -0.50982298751134503 -1.7704360113325608 -0.41330768295469311 -0.11129923433096596 0.099959368134053081 0.39785067594367102 -0.31882232057061738 1.3356580574549979 0.96238059711855839 -0.29046018878113078 0.72554854381930367 0.84594230146343408 -1.7778168400065135 0.89459069003034697 0.77035763020985359 0.25431581144991433 0.46295401843151807 -0.7101461706408545 -0.85532693115389558 -0.5077293051474121 0.41482575759543 -1.3606470776125608 -0.29358512097228306 2.1019824977058983 -0.059186717717869736 1.1250151823153456 3.2434654722380034 -2.3772173903993159;-0.29269655598360622 0.73000337303908347 1.3175592132429434 1.7496571922866448 0.92426334603309368 0.064150100068807475 0.21545244503548355 -0.23204413207453259 0.23858571634558629 0.274101301061554 -1.4066816430406428 0.723441794110255 0.038967554528517072 0.072007580837946505 0.053434981861404558 -0.91521183742097389 -0.20242653849004136 -0.58328762442382398 0.90354955742203036 -0.024362124637565263 -2.3032691512305488 0.33591913304400534 -1.4080522043414523 0.19354080030940779 -1.8649016706919366 0.84601831798582183 0.04192447408650584 0.72975002092498775 -0.031369618437312639 -1.295050922078395];

% Layer 3
b3 = 0.41856938814681682;
LW3_2 = [0.73172993399872666 -0.030027528644464157 -0.0034360209817010669 0.091788028199296962 0.33460919822261975 0.17409514651732205 0.0073523169801053938 -0.038998842703207588 -0.1332009722933013 -1.1820901217288915];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
