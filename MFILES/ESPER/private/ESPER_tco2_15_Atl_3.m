function [Y,Xf,Af] = ESPER_tco2_15_Atl_3(X,~,~)
%ESPER_TCO2_15_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:59.
% 
% [Y] = ESPER_tco2_15_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.2994949665748372;-0.20220663596151336;5.3061809433561491;0.23800128953998154;-1.5589687275568347;-10.136660285840334;-3.9501513183341204;-17.784910358899069;-0.55117560193620529;-0.4910138126143947;-5.2379673963572015;-4.9003042393177916;-1.6964792657013181;0.48038879758184438;1.3684164817503477;-0.46310071472928127;2.7853311397270799;3.3831702039175835;1.6347647357117934;2.5803085447279188;6.8023265933665265;1.5253870598945924;-1.2354074946010187;12.548355651555379;-1.9413307247306772];
IW1_1 = [-0.91157896747798328 0.037712910738162103 -3.2649982398982105 -0.090886861313393366 9.1806181246573821 -0.7102756391995233;-0.60416383178364308 0.25481988090193675 -2.3631356072198293 0.74582161057268048 0.97457457622616295 1.8968233305617277;-1.0619761102096938 -1.5513488474568642 -0.39809269078844201 0.81954058042575584 -6.4247222047552111 -2.093726774249725;2.7476220926855941 -0.65464079617658277 3.408028051184973 -4.6044025265002038 -13.066774979250457 -2.8273310725570768;0.75537907215178879 -1.1660829258768988 2.6643251006738526 -0.22532813966185622 0.14666222365811729 -0.5455180039528793;-1.7426909755483291 4.8908916099690982 1.5892019333145961 0.18978191428854441 18.923522619136033 -2.4178075965011008;1.0485661975926193 -1.7297771293111621 1.0923662204047726 -0.075277789613050011 3.0343932542226622 1.5878200094786319;-0.096358255884223518 2.0483748321040562 -1.1700126984741042 -0.36678913590636641 27.19688394312838 -0.59400807591902927;0.17194104510626837 -0.0012591787935193382 0.057571988680374844 0.007726011492201805 0.97148471457491548 -0.0019891079179038969;-1.9319566178316752 -0.19282126778828568 -0.12044101090792696 2.5043414500632566 5.4303290579086765 -3.1079692446907354;-0.75500965644229678 1.7246465716000323 -1.8726396584996789 0.95209672018966862 6.9367901792220161 -0.47654589180455492;-0.17617496765854879 -0.010303079563798971 -0.16265903646626786 -6.1828841413461353 -3.6811157272377857 -0.80367565817907627;-0.52475326409782097 0.58767612688457105 0.89019816824664444 -2.2888389369605671 0.92082624548219671 3.4769782479422617;-0.054379673867904287 -0.035789632319272791 0.01340332082140596 -0.021573234639475095 -0.44376883322659977 -0.04809126197652324;-0.088315022009729696 0.16474937923595262 -0.24610730858907778 0.19181330662872548 0.37694415248327429 0.14747991998906324;0.17746518197192249 -0.42536901699889629 0.7179987657652589 -0.84177749569343618 -0.012946914692637071 -0.55523205748409044;-2.3753990379404124 1.2067207263716091 0.51304085519349063 0.10962208175537955 -1.9398565429825225 1.8173109330188062;-2.6364972437703527 0.60923043293684809 -0.75216155131527473 0.45495781327607526 -2.2213881269662856 -2.7643025512953496;-0.43385691160525014 0.39384310032740233 -0.63787242943153466 0.090728985866378037 -1.9752365219432739 0.97683298515760075;2.375855309977883 -2.9021726892729132 -0.55159282039516877 -0.94420266372537087 -6.8654579895338435 2.6798924490258442;-1.7190619767927486 0.49481116841336636 -0.5157782946669186 3.9216627895995431 -5.7290496370848221 0.51122169868217826;0.22942858850518091 -0.21292707177616968 -0.60810223154292986 1.3644869441494567 -1.1283953921618521 -1.7610112532915516;3.3071710137972969 -1.9998759222005247 0.81285361423132552 -3.4184634715797695 -5.2165972300504029 -0.92898502595579802;2.8416266057651938 1.1604793011962293 -1.4611994090446665 -0.24880013096569592 -14.047487244029073 0.73956532628519267;-0.72170319962176077 1.9930751278322527 4.2797655915922874 1.1375734276535461 -0.68819827492395425 -2.1701031348797697];

% Layer 2
b2 = [39.176699725416334;-8.2045410456543024;28.940352994688745;4.0463898680160941;63.313468027765758;147.07039290064492;-16.885727149126971;-5.5610695776517378;25.033223341739223;-3.8061343219701285;-62.743394862111245;-33.227824633615427;67.130405155797177;-68.403078613047029;-0.23682266801339741];
LW2_1 = [25.972466581906037 -53.919987872773056 43.762997518680706 9.0314100886611417 64.503456112814874 65.773106412770915 -19.326157385685125 -26.221111746013062 74.944450054048986 -13.545164337765376 41.315884445131587 -37.688303427479084 61.840364082390167 -106.50262067576814 26.62853216146625 -61.317443810850264 24.579599453145676 -146.44767685209325 24.917077254102718 -107.89236739258527 112.99518849737827 42.414954807756175 153.00594574235333 -102.03137749393245 14.058934538819537;-13.201141963713846 11.451619069388167 10.67981086755616 -8.6031453542725131 3.5704996973217011 0.31595964007591359 -31.826658033214652 16.12410304114654 -40.649946513026578 -30.668176265483496 21.292149806799671 -23.086172086180891 19.986554174989564 5.1069873612420364 8.9084038424434802 1.3609120740801197 -0.22861477618396525 12.606474969665358 -83.897639572500495 0.63517802043007832 54.232625963981071 26.804686814796526 32.609549729044836 -6.9840101255541347 -30.044645566193033;9.8655817738332718 6.5099386589923238 -33.42811558373954 5.1880072378414894 0.66557998636773896 16.449465778603901 -6.6389984433409932 8.2327631377513129 -18.10259567014835 -3.3902693254971408 21.780670830064309 13.161550540132035 -42.888495972109254 -5.299903757501629 11.000893162705244 26.238759470326581 6.7367804493530166 -24.791144140010964 -28.858910047947116 14.902178709994852 -23.063753345205537 6.0348656588997907 16.947389287869854 -11.961649436377757 -7.2687703028231336;-28.591531384254754 -16.854169556779237 -21.93329973627791 -2.5495590333864504 -8.615187615280739 -50.686891978431788 -6.8775364943731736 -9.5894051222375154 18.24803670063654 -38.501482322291217 3.2050396539091923 18.050090260893949 2.5412164868431382 20.114952673600417 -29.171303907011755 18.91082403440689 7.9645278492653757 26.542159316731574 11.932808709287718 25.055730974005332 -42.897303626038749 -4.2915764198300561 -15.201378207832956 17.458669451637171 -15.326969401555555;28.704187276867895 17.650253907289944 118.03821563744081 -31.607384529461196 15.773912133420305 57.620771099105454 24.711296431246303 3.9530579929713614 2.3406423035566597 -20.921664337160994 272.87261370117739 -72.094902695868356 8.6668926131833324 59.9200072245117 -3.3738325067011075 -58.102402216444546 -5.5161909333295922 7.212016411583285 -45.41743060669971 11.02096150676042 135.64512117165393 -10.98845984784468 -21.635465051959994 24.295609251203224 119.79294581482172;15.639058074375841 3.3359560898690162 -44.281956467555943 24.463253000225546 -3.6216333830403076 -113.6405097151593 -14.489741052029975 -36.580066825857109 -1.8359564371914898 -15.056464206213874 76.463740765878654 15.883997346144753 -7.1997195721205722 -59.097858426301435 -115.88936445515687 -19.068318396456451 17.006281826135314 -26.565336868695855 -37.525128330280076 37.369272818046056 33.645679616987373 -69.950706500960493 -13.708300012344075 -62.763010176106661 48.75799911374672;-0.05548969405859866 -0.11449912224853573 -0.048866244311561058 -0.025848970309892975 -0.081095045271446814 -0.015953349522911754 -0.14991860018081726 0.016434976570387762 11.055370863671643 -0.014284957318526333 0.25726371380240831 0.546253214203959 -0.195150177625149 26.532147593345758 10.831894481973753 -0.41338221989690671 -0.013681753557465528 -0.032558955423859892 0.25503193171278155 0.066500850506977835 -0.0063169920078561415 -0.53000278325185091 0.0045991086981845546 -0.047539508912551362 0.042037485468518404;13.711408573688876 -25.325274542391494 -12.1620768028209 20.213057183291617 7.3933212033357112 -9.8900707566968951 -2.0237367359076921 -10.544530814506935 -47.217158249285077 12.357555274578344 51.611434628639259 -15.867742971763647 -18.859632704588485 96.808533861900997 14.752897669832397 -29.177019475888407 -20.569816713337772 -54.010741503014799 34.91415017977797 9.5912102450160273 11.133503567964251 -60.084990563264114 -17.439792774716651 49.718108785309816 6.996293701130667;-54.798596255729713 -146.07059661207199 -109.84322869340347 59.636609771382318 -90.968669509182902 2.2366562230012792 -41.994331327755567 -56.269325438175102 -65.607420080531725 -1.0884240575202422 -28.901682449171432 -19.638917381178821 49.29633901537543 -118.75052300205091 100.73409838842396 -101.06925157537827 38.789755286573211 -9.4096646280642489 -38.904417310417479 -15.317267805242807 -82.586117927594657 40.423066807869318 116.02050888619424 -32.825927576205309 -87.098672972364696;2.107648188934629 2.1254190587643307 -9.8170797588927829 -4.4066528443835802 9.3341673090447923 -7.2026129709595708 13.636778682889627 -6.7051449598773578 1.6287488242672519 -10.955848371829035 8.1481372720264584 -28.010977427943246 -11.603522380522548 -10.511631389455802 23.327538194057457 17.711905809871965 -3.0667070731986259 0.037461057105719703 6.4990951636851708 -16.454731504501204 11.532494055954446 9.4906287716490443 2.6331131084962092 -15.363222137741994 5.7107434797467143;88.745450442346481 -58.579494575690752 195.38075087450534 -166.42253757396443 13.412303224182832 59.895265155519198 -11.619592068863259 20.903746612909078 -11.955614790344313 -92.239660972193903 -102.84623701286949 6.4644307377858539 -33.395613247084043 61.874606899795481 -157.07666914644381 40.202760844172872 -34.407785097910697 -25.657473293858764 142.31884574565015 -145.80259127029373 12.112006199916799 -48.954710233312845 -83.059810256209559 11.723330441956751 -118.63134891972426;50.235324194924466 26.154117192368506 9.6880326660365412 34.991405354487284 41.043584444521272 34.502533510329812 -50.3029619388466 -4.9139279021268329 -65.276539317195585 -18.573761981890719 -41.254696581926083 -42.384273516066827 -24.869612262548173 22.033308613953213 -17.798538879252696 17.699457928954757 57.724407512892505 -27.362495742312383 -53.313808492962636 4.9363347309131838 5.9736654302420238 9.2823493745260706 0.98662531175012957 -18.374815240564377 -87.353425607099851;16.185575369673643 -7.778962909395319 7.3779518524240144 8.5268360879330096 8.3493696417760344 -5.8249219716362788 16.782102613640614 10.274675079610848 43.610428693768533 -36.21596586180673 13.98979723427138 -12.387902745977788 -18.596846519737472 6.3141485089559612 -50.595411711620535 -23.475098713432288 -35.734733401669821 5.7130756215693461 -25.211191244342928 0.90861816195959366 39.345574828534751 -24.990575330696331 21.644398159742529 -19.012771943291295 -9.5816149835317059;44.528530694167507 -48.919936134469353 -11.31741233299091 52.871957728826928 -17.966597334116013 -18.209754721409826 14.033198910115685 49.450061820454742 -75.725226556842799 -0.48394861495994707 -68.739373975149647 -14.170984042644736 5.9880305883518368 17.06945776444088 124.23781261488449 16.953543838410084 -27.328657190379207 6.6369371699470907 -1.343637264648089 37.851926923457327 103.67796017677112 100.45520980808219 -35.121507488532323 -29.685437153094103 34.385891736899133;14.14718757107476 8.818400615262048 1.2188032551047008 -4.4036872563245506 10.426695225858227 8.1897429132025898 17.816708414274576 -11.959438487097893 8.8211795572788194 -12.059246842497105 50.436707098886409 -32.719387824001664 36.622476852321007 -32.084481297860989 9.4112569449034549 -8.0796739769684578 -39.188796372575531 28.087212840886878 25.086397644839202 -30.788483534902273 -23.492686131032876 35.430756698774395 -14.068866606275627 11.267782082896243 -12.44949893473127];

% Layer 3
b3 = -1.9145310695507101;
LW3_2 = [-0.0011475775097292346 -0.0040238388536542463 0.00063390442806212136 0.0018267083081743077 -0.0023038180674447334 0.0041750562347458355 -2.8872010332737248 0.0038191823970408598 -0.00018329016038400516 0.007115266559059915 0.0022783291143969927 0.004695737551416607 0.0026142777638660259 -0.001352313604506609 0.0023591017037397056];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
