function [Y,Xf,Af] = ESPER_nitrate_9_Atl_1(X,~,~)
%ESPER_NITRATE_9_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:35.
% 
% [Y] = ESPER_nitrate_9_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.03;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.604229607250755;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.8219932110713661366;-2.9479521539425275201;-1.4388441498459589862;-2.0356921123824660569;2.2461405709540551712;1.3141200112953042023;-0.005116499583094158074;-1.4996150506342322828;-2.2757786425701560518;-1.7889574320039960398;-1.6425077042473150701;-2.1716314521665625037;-0.18249054517030957601;-0.38221131036590688668;-0.2581035759346856362;1.2975238769318591103;0.052364881813262931232;-1.9891842756477193799;1.3773976169762227606;-1.8045400335001426928;2.2075611917719450972;-2.5814062832551916138;-0.43433453177166703174;0.26135834599159563085;-3.3272120315225173215;2.192034396582744904;0.11041296252096438613;-0.09781169374600164057;2.6102185678169660399;1.7415377109908429798;0.72141543250901740691;-2.0272298690874448468;2.8054321255783731814;2.6077634343736733058;-1.8301863990339182209;-3.2642632969523597275;-2.1690265637165340173;-4.1099473011093792252;-2.4963954753561266031;-2.5000234467923796444];
IW1_1 = [0.29610536380286067715 -0.23699073438850468132 0.24578986576768593886 0.49907103330192309487 1.917623932603581105 2.4410046225839945322 1.0112245641335735336 1.7943558995383015464;0.31717896973347453615 -0.06522810170698141452 0.23546745028284626899 1.0595868685324190128 3.4352769247336163438 1.3753705261148416739 0.26071780532795346685 -1.5385149831290982902;0.17075211042401072792 0.18045236265314901214 -0.15900459349722839697 -0.88039225307957791333 1.8153772011557467447 -0.31425010308473483311 0.33834911215329338541 1.7050581437196852264;0.80461168448911968287 -1.3342521755530101224 0.42118227442420963502 -0.98292675865815715142 -1.1773020357865382479 0.37230887072236334978 -1.0624092336932242642 -0.057495274797511250475;-0.72682367116956592135 -1.9789040104044721691 0.82577750661492610451 -0.43605229318978833142 0.64163742498085529764 1.3131792361123351132 -0.52829896693376532379 -0.054531110139670248282;-0.20539335929945973236 -1.2866331158955173208 0.7618233500404567593 -0.11751342622484026168 1.2163606478250192922 -0.089419415276807329152 0.57678847526164545023 0.84036719852056018798;-0.33916915211818421394 -0.10827504965446702045 0.62633653971240765834 -0.51354019838503373041 1.975282160665492448 -0.89816080621197813549 0.20600795560458076694 0.84883924538206811938;0.61921047088046499152 -0.050747481823335570394 -0.08947524201220261042 -0.39237442039596892585 1.6172146951434960283 0.64950141711059361516 -0.72500240442002439334 1.0668031326945708326;0.88981320993904999828 1.9748297739487206126 3.2357757504627406853 0.5288386472929065274 -2.6865898263593166462 -1.5579883249070392015 1.4395970248954752524 -2.3000607543308171365;0.81265288249470002402 -1.2607305216230388911 0.049619670124110643039 1.718314298734892942 -1.46029281612659112 -1.967613698163485747 1.8163707805714275345 -2.1317977983008304932;0.20552078780210306097 -0.43414532941348416006 0.96816458797983506734 -0.17866532278961436142 1.5888270290660604367 0.17991453152541558858 -0.065684787438844330354 -1.0012332914983910204;-0.04104924195460873948 0.38254260411476564974 0.9643447277381881344 -1.2400537310235704158 -2.040434838373862636 1.7309254768815942604 0.75492676225532995282 -0.62837678350048997711;1.5751033068648756519 -2.6588553727334511834 -1.5963607407775737279 0.54247696062113337501 0.119005686481472292 1.4801733653651956146 2.7957880070848477594 0.22991304703266257636;0.51236647741797991529 0.65089210382125284315 0.70712018763310957592 0.64337431788371379771 0.64400889471870281788 0.93546964489406780885 0.84894911501207148685 1.2051636074160219092;-0.093709148878612175126 0.98291877568790553266 0.44622392158577772747 0.72716542690149776895 1.3788346121395955723 0.53224392635974082655 2.0014808775703469834 -0.3230686687043677896;1.0439542283107041687 1.7089370518668880461 0.57446131877137840416 0.38363934450675524213 -1.0632525224661559804 -0.26938545544002179266 1.0510803135735053981 0.69722531239971408112;1.3316039789742233346 0.40423680139708056958 1.0513787223904162982 0.13438355208003477381 -0.019350656844346593444 0.20843733271193753964 -0.33127462521758638259 2.163899582820801637;0.43012686620671891635 -0.12274945702290358807 -0.5929825615056203425 0.83731299085645016778 4.5103740011579240843 -1.2597586428048337392 0.82248621592947379622 0.30066922493930631211;0.19208883533217518957 0.19631129883500456068 -1.3122824778749111463 -1.9451789825794811861 -4.3691997015059431675 -1.8063341019670808851 0.56111660845253030772 0.1902700099712445192;0.15499530136906605748 0.27715798599138991021 -1.2285607866093923857 -0.73461895673705912557 1.0744515704314869797 -0.85936248364219114393 -0.43725913690570983317 0.14295375745101765452;-0.19313550303707227584 -0.024254042263606168106 0.81253998869139132388 -1.1611940442234187643 -4.8103191941223961692 -1.2911393593260169776 0.65178243011819259056 1.3341169123135510066;0.60973781533287219059 0.22923883325879279571 -2.2575559540361971322 -0.93907266051333504464 3.6540588240438873768 -2.5590513591266041971 0.2316686214796679355 1.1086616161254652102;1.0442799488651524076 0.17446414882046262784 -0.35019545068199464666 -0.20146964195786121188 1.2715765963318743648 0.85134152733381629474 -0.83505980812356139786 0.25930147943563242041;2.5645908053942396698 -0.21881047048294946511 -0.92802883893780285796 -0.27902092855706567276 2.5276744429761555111 0.12062952374732344163 1.8351349275081170198 -1.2581700915533118312;1.2197684837893754128 -0.57157718250568168017 -1.0487880933249844606 0.37038812124343728494 0.93607202263931199582 -0.93810217568687859213 1.0961669276539274254 -0.45710101770670996668;0.30975195678738443039 -0.14353395267972379745 0.036804383412179605961 0.8700109587850400894 2.3756788672084647729 2.1159723356013020457 0.78959032159537834161 0.74883096714699926011;0.34696995217054682481 -1.3615452849462923446 -2.002862259284560853 1.2689518127521688395 1.5147553306772592041 2.77663873239714043 1.6548816015102578714 -1.3448296072085268449;0.47619465544887257247 0.027346082500067626919 0.10009174430108387643 0.77578519501088416543 1.3478782589891915578 -0.11157253979063107285 -0.21703617660739779605 0.52764876725656117973;-0.18146551104573810376 0.044503948250575048329 0.48971547516555008484 -0.75210039963467567592 -3.0097662145344559192 0.72876484272587804814 -1.3634382705261227642 -0.25583659036822081756;-0.49307808744103542864 -0.12721578896915211598 -0.098139135383979614335 -0.80239446924325674715 -1.7195767783510174098 -1.2154845236013811505 -0.04219594756916143774 -0.1959768071534163103;-0.42575608567117745329 0.25574138837704785132 0.74216100656652805867 -1.6427301985434661358 -4.9279586951640439452 -1.2069530694673678006 0.082830765925730479027 0.281138316475487815;-0.90312583768349630198 -0.27388167057152762451 0.25763208008865567944 0.60849536275352877901 -0.83069558397058052002 1.0106112954993866637 1.5955594113816935486 -0.49442913216889294858;0.14548747247949070371 -2.1908923750186790613 -3.4007537327923409443 2.2215813669431989652 1.7555035774583080954 3.8001537214109628593 1.4254454780219356635 0.40417581370490412995;-0.79015800018237913882 -2.0193497690503665609 -3.1311316715707246949 -0.51441150277936231738 1.976485680943687484 1.3070029636566682374 -0.6211888948293243784 2.2857446112001089666;-0.2102389644689783843 -0.40138047444712027234 2.3679140767125774758 0.40385334622315266495 0.30078163419918046984 1.0744670714971054082 0.03120759809130946999 0.25132441193163840287;-0.19775657366172574858 -0.018024785947855354734 0.70716637380596625295 -1.5734264116312886017 -0.91717507577374024486 0.11663589608402412379 0.37789776364231014716 -2.111629695117186678;-0.24651031484041377451 -0.22069034475172430443 1.3878173919839231765 0.16112052013889038848 0.6165184568455984726 -1.5821945066140912228 2.579703199868295993 0.72711422155461802319;-0.23262554127884638167 -0.30626840469485866469 1.4105363486615729585 -1.9693078928274256878 2.5972056353935739637 0.54091626115346036485 0.67896954852342650266 0.63932460991311346188;-0.21710408924041460499 -1.5559506741122210993 0.76129373122581800448 0.56163661228702776995 -0.20906600346720288774 1.4497779046322625263 -1.9266723876492570788 -0.12576273680854979653;-0.42576218100646523457 -0.64564879609359449031 2.5104544314902015323 -1.3519916818818635829 0.44102719158198999683 0.65558887043179625564 -2.4393966602007437494 2.3331804900488872789];

% Layer 2
b2 = 0.60225311126155522956;
LW2_1 = [0.49387530436397547584 -0.85103575838548073396 -0.97557019727315563706 -0.39964400637208541411 -0.41850984784213696166 0.64034844271361968104 -1.2031104276060247127 1.7697404977880502042 -0.47423559456247843524 0.12589887829298099242 0.21735359564830017409 -1.0275050651207475738 0.1650532340067921433 0.72159985644196433796 0.18925983359755266244 0.13415237982984212772 -0.47205698871673773542 0.75189473306926535301 0.19285661889851110629 -0.93289940350063904617 -0.77010667656541165194 -0.2879510806085326946 0.5739544631346152892 0.12118265446504465632 -0.37871953977894856624 -0.90212599422176598107 -0.36051230375997284083 -1.1081632745910929838 -1.0978271129330441358 1.5163020017954151886 0.63974563407560780526 1.6713180105441991508 0.12712604806206304064 -0.46874982770412204625 0.62971318500098927284 -0.68867742531767395242 -0.49909338583693241276 0.61213651619125564185 0.76216531343376947571 -0.31243870490577946297];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
