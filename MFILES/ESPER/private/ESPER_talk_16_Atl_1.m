function [Y,Xf,Af] = ESPER_talk_16_Atl_1(X,~,~)
%ESPER_TALK_16_ATL_1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:51.
% 
% [Y] = ESPER_talk_16_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.9383571898093983;124.89507197064371;4.8596022354175057;8.2564017371069269;-0.22446770792108828;0.43320196712206782;0.80494105479990163;-0.52145392434220394;3.3327362813441685;-6.9176007281076792;43.760192100354296;-3.0710873379349874;-0.41544517043104418;-5.3644788117019946;-3.4257899298033858;-0.96096713817114054;20.926203082584134;22.732059314766826;-0.35333449303356862;-3.9052488379042565;26.491631594971764;-0.48490143265650437;1.8880218391364754;8.6981851837411632;2.6088685655906585;18.481243638107646;-1.9532341755001714;0.031337865752335436;87.669957381950042;-1.3755373363138848;-0.64007014645043947;9.9887881730475385;5.7104066109928251;-5.458396872171897;14.811209131375664;-25.845976865407689;-0.56020142933726813;38.821039663396633;0.76437379433434349;-10.840028691637505];
IW1_1 = [0.36056051751595858 -1.8527699933726716 2.628008728181741 -1.2882088869960959 2.590945543047753;12.287485538710255 -25.466074007767048 13.84902031868601 34.0617177277149 -152.3967089464189;1.9456939585718793 -1.5131435492992624 2.1900168063952266 6.6715111333345112 -2.8572483723071871;3.5006159218100201 5.3279784625923297 -6.1555650439403511 -0.98851828779910689 -5.9591129161980883;-1.1992611977059706 -1.1323952920591234 -0.73395118404005044 0.26500093082462384 1.3935043331023838;0.37734833711817695 -0.80863188990474766 -2.8835025168310668 0.050520453921831972 1.9167205187270644;1.0483363135349903 -0.59893488730614886 -1.287189263356449 0.44794879616022165 -4.2921488254178719;-0.0136554451227395 -0.14616959279364072 0.8522020328552532 -1.5742551818498685 1.7922867919489092;-4.2559687340856831 1.0519471139090399 -1.3714854148675013 0.38752094237633844 1.3589488788613155;-0.77373457928180545 1.6852611932146686 3.1648893424313949 1.2832682148146328 9.142277785296562;-3.9747307092501161 -8.015279660073249 -39.711597286664599 16.562880922329764 18.210064859036518;-4.1205948527453726 -0.88847746413366213 1.7329420543445038 1.8624151596110536 6.9124329065863579;-0.96758993681874661 2.4076993785430747 2.0863512959686803 1.2449288719228773 1.5200344735944245;8.4408467387210369 -11.24543622891321 -4.5285933933196496 7.6337516328613235 8.8421806621697066;1.0253422076437788 1.8991068257356727 -2.6917126942558425 -0.30390794208941813 5.2004614621346752;-1.2156124358742093 5.0090231528897942 -2.8844196960405726 -0.61527817052826184 6.4317115613422606;-3.0371939396757779 3.3202942180694421 0.55048424813079944 -2.6925119496185634 -34.653187943378256;0.88095508095143693 3.0022354764675288 4.1928718886305552 0.049032634555023685 -29.739993433379095;-0.49217497345529326 0.86846517403828993 2.7570271207330115 -0.051314771266952337 -1.7439453141162853;-2.9830631695903076 -2.6361443071266364 -1.9267825221738446 4.2355721700567885 5.9560435689511992;-26.576734150079204 -8.0664761502367472 -27.725476415569435 -10.766735070284341 -10.085577694202376;0.71183654263590368 0.89807537263169646 0.56071178303310043 -0.18847748412582974 -0.13358565172812459;0.17167788634323158 1.9408841965375141 4.8468848239613962 -0.096261208488253397 -4.4072957369205312;-6.1581030786162012 4.299880671766644 -2.2048819154553483 4.6590647564993777 -1.3422745632536615;4.6422783776777701 -2.0014457410251771 3.6091781968845944 -0.91000587098716723 -1.9312697178200937;6.9817651279868693 1.5502347917079027 5.9834875756712398 3.7388691221259678 -24.827771580249081;0.59028754064037992 1.0341432292466832 0.6949279489397242 -0.65631360083330881 2.7697358455218475;-1.0227423991141054 3.1755655186962732 -0.89961692652319381 2.2351867576358115 5.9905396435465308;-14.175154732581815 -43.345798258667749 -16.295703584192573 67.717584128255467 -94.970705537962971;0.058286876705247022 0.4965651370908547 0.75826339149097421 -0.62199140009650455 2.2089516847361121;-1.1109207850070542 0.6934239220294065 1.1908663361105702 -0.46286710908863327 4.1298643665884232;1.1120474339065776 5.0076954519521388 -2.4212074339718215 2.5959730683205082 -7.8053277920241992;-56.011341855938944 11.982319553827306 -60.558750711295779 39.877021782012541 67.031634318555462;-1.6454322789121099 1.2464766714464541 -0.99889514813217828 -6.6025376240542064 2.8577391166826631;0.94976188207406287 3.4589565933652135 -2.9833141035722579 4.1230574180971562 -9.567756637157439;16.072540885196055 -12.41130920463474 18.851278929516063 -4.6685521252229272 41.610779997957167;0.99122927998390409 0.42909405929085909 4.9960792987215861 -0.088847446814350223 -3.3205734688043309;-41.474685887736335 14.675706677443092 -55.914572820598764 2.3031671977929009 10.686703106971537;-2.600045142594066 -3.5856660131656652 0.80556157243532822 -0.9569220699031965 -7.2414825218262813;12.878669954438919 3.0970508040891929 6.0814997119329446 -2.8601947291379801 27.918514838227996];

% Layer 2
b2 = 0.28592392804680644;
LW2_1 = [-0.084846881698311935 -0.001023806574290226 -0.026483671502834448 0.019385851337521916 0.67501973090500211 -3.0089520983740536 2.2183346111299254 -0.16446418773591057 -0.10117781349502071 0.068240283259024814 -0.0098833292418834678 0.016488006235417615 -0.096778699004610294 -0.0232881524400122 0.07293310814651352 -0.043317608396749169 0.011970072926442744 0.020613167447469178 -3.1753326750774398 -0.019670868026038429 0.0038569693923258428 0.73161933081604147 0.35960882844419889 0.020574898238041255 0.15299414653342716 -0.0031298327665519 -0.29144672804656907 0.062461131321406231 0.0008216308626186259 0.5375401199295422 2.3270130222182548 -0.017384197778058479 0.0019766131073753069 -0.031368954750260976 -0.025799431728825831 -0.006613336731189412 -0.33152899226641497 -0.0030598935444555385 -0.05013525150924724 -0.029682350747088793];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
