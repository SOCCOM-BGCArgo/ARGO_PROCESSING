function [Y,Xf,Af] = ESPER_talk_5_Atl_3(X,~,~)
%ESPER_TALK_5_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:45.
% 
% [Y] = ESPER_talk_5_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.2178;-143.241523403244];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.00458552991639557];
x1_step1.ymin = -1;

% Layer 1
b1 = [-6.1104990289569985;-2.6003935405084388;1.106734660795774;6.5601038065301713;1.2686420146298967;0.94654163043688344;0.57161031999070355;3.6122906429928339;0.15388646026305403;-2.2038434060459999;2.5574307691720182;-2.3847582054382381;-0.30001167108740784;-4.3767419652610027;-2.4205514916019006;2.9818544666709896;0.017478900437373074;0.55035092390177187;3.1028891248109627;6.9310515068001131;5.3400855780925758;2.8081115023619034;-5.4977535996994176;-2.2462738704822338;-2.1416786292723078];
IW1_1 = [3.6389526192789168 -0.53857640879588087 1.7772697885530122 0.40790686316277741 3.6951899747404906 -0.69999945305392974 -0.0138867067641152 0.072525657700982737;0.099066401788272293 -2.095958800786736 -1.1078647148387097 -0.12198044475749349 -4.7029433653034136 -0.46108971128486531 0.052001888420374842 0.51846911246073013;-0.30708289593400495 1.0018928005692764 -2.0585931540822173 0.28624982569500895 -0.64750670584795211 -2.6381949163742053 0.45910162444751867 -0.13956028634875778;-5.0212879848758289 2.1992057123772772 -0.88030748178814344 -0.41659944780168368 -0.36021980568982809 1.35435325614664 0.89995394280148733 1.6808255383576676;-1.0967335276329944 1.7987983584172724 2.0036682487758863 0.20574472157930765 -0.96242748922712185 -0.87924354736958965 -0.25918876371852417 -0.1650068285255111;0.1937944127099239 -0.56195251524104251 -0.48007210717874754 0.11268640880738423 -1.5128914458153007 -0.44746244571010341 -0.08785177366973855 0.15605517614754438;-0.96831413586063864 1.7737454866465949 -0.49601139130057426 -0.1624398544126984 -0.16933396152975899 0.062624375026282639 -0.10658130503999934 0.63040974169609154;-1.7540605744537587 2.0584605203568067 1.358641997784952 0.11823113302745719 -4.5360737246321303 2.0198920951594932 0.91015563506766406 1.5085340769692008;-0.48187494503541833 0.18735801990190745 1.4452571084726942 -0.052970598112714824 -0.46379118606894182 0.78413172230997141 0.12549083616205134 -0.082767809693689035;-0.72461957965092305 0.020623434838133996 0.57656368059258833 1.0132500522949361 1.9133317161226855 -2.6125073029104553 1.8326438998097656 0.0078132757921905716;1.2483763729192872 1.1029099654855474 -0.77302539391634406 -0.28636368019406033 -0.44423248811424298 0.52194703226277228 0.34259735436366595 -0.3140196471499509;0.96566629670734583 -1.3414698773103133 -3.1432212293759054 -0.063583355124503152 2.8818898295432946 0.22434744445314017 0.13877124848275474 0.32733656732707872;0.72451737101240199 -1.6889017654423311 0.19124261966122846 0.22989123721604621 -0.50493689037139577 -0.28828335915097325 0.041763423759044176 -0.42835362868854304;-0.13680797016621857 0.15259817159228686 0.40524650496109488 0.26521732761956762 4.804514830549806 -1.6030955376965663 0.23396417995767804 -0.71767874066079707;0.89921340000919769 0.36832584118957334 -2.1880781281641544 0.83883131265679745 6.4790757743885532 -1.9801246434927626 0.37915561068248116 0.23626590982285312;0.16276191524538902 1.7338715860451059 -3.0329868987246544 -0.31172347593549993 -0.29816209293156365 0.38083708945156258 -0.014506800742899666 -0.68027660117707522;0.51032189657524485 -0.13629733429896679 -2.8996924630127134 -0.14224237310652463 1.4416081164438008 0.33763416383362721 -0.032263114747306899 -0.095388728372614612;-1.831033083664418 0.21655062844704268 -0.45545542772726633 0.15112135390592277 4.6722468209899182 -0.3150994116947029 -0.0020873009329002278 0.64481328530147408;-0.33692164679788766 -0.86106634020781914 1.731407993804843 0.12308292149114058 -5.9713987416365057 0.70674476787191964 -0.16543198672595683 -0.26321701241300377;1.5797494588228 1.2995893168363364 -1.4583516019786922 -0.30063213158454666 0.029109941334513563 3.9050728618644044 1.0824746723188183 0.50772522897986261;0.38238083587882254 0.38446786338966782 -1.9619555543429359 -0.28895927576796232 -4.8947357159245861 0.17982916562538673 -0.28569854363978286 -0.5471560369546955;-0.50194249481344089 1.2814222783249891 0.81102996361309065 -0.15280983073840018 -2.1045898998365065 0.44163335382648738 0.25196056058702559 -0.42154809752853356;3.0075436588133551 -0.1531201411719576 0.117126060531027 -0.14560645244086926 2.1091582147275418 -0.089157533174560988 -0.10114622997882203 -0.54819842600825108;-0.52348157134205331 0.32560223747051437 0.69655041161494691 0.1391219791710363 2.2687214042779078 -1.2032424311591394 0.42400377541226408 -0.5706479516810542;-1.1403981112195662 -0.34728973963543608 1.7035769891140256 -0.32617411167180638 -2.4053953844852773 -0.22769308954862608 0.8407539044834359 0.35682577087201645];

% Layer 2
b2 = [-9.0540276591506963;6.4578859835017024;-6.0067425063281714;-0.24731040633795082;8.9353351884790353;-1.39473394183688;-1.9194512931356247;2.7359905476316273;2.6550512883859505;4.5052580157743085;2.2366883238041289;-2.6702301499875931;-9.644031975384598;-8.8919398196676767;6.8341373419353593];
LW2_1 = [-1.1024080694462137 -3.5304263329999115 0.66280210672242601 0.098888740849739226 1.0213067153161774 -4.7898772415046356 0.2792450816306688 0.33717468794298266 -1.514835300748951 1.1852579940833772 0.69027676309385999 -0.38239267856653048 0.69889875025073944 1.1706428023475595 -0.1294958148704379 -1.9644373108807904 0.66574264382072812 3.2298693570512063 -0.66728080567530568 -1.0443816913408808 2.5481728441748697 1.1676158303560193 -1.5413524398011111 -4.8210713153700286 0.64446035917241229;-0.31458672474322885 -2.0025459733184769 -4.2476675518972415 -0.6329392114933311 0.26679247634872483 -2.4362644957130177 -0.84940055074804888 0.42474716641263566 -5.4673285682771491 0.26494250875494429 0.63517113826368321 2.646085794647373 -1.1766552537597106 -3.2846047063392763 1.5033548598874844 2.6192526213720693 -3.9264868787373701 1.6603693943078377 2.1306798850133992 -6.3050666968315161 -4.9516229178880806 -1.2766973368669621 0.13259387059477437 3.0298499396648975 -2.6909867438320312;2.0790468749047122 -3.8920623469355613 -1.2638450285546832 -0.14481175490141024 -3.0238780731825177 3.1425264702106048 -1.4698192030651489 3.3062556131864347 1.2922480254526945 -0.42031263610490743 -0.20280574308615612 -1.0895314848474182 -0.15349766317061603 -1.3210148360313567 1.0231289346016073 -1.1179283017379391 2.0479403289127061 -1.0584435395884539 0.72655430989791114 -0.31106981395296879 0.75105121217864312 0.98983089476218145 -1.862314770703418 4.5758851817342059 -4.710802615709758;-0.0089237170962132347 -3.3276582204975256 -0.56081072877392835 -0.42845545204264618 -1.778850238520159 -1.3248811540231566 -0.012457375000073935 0.33802712363122289 -2.0449362505016384 -0.11623467891535724 -1.1464274256293789 1.2038110700549429 0.38345314964417954 -0.32776774436776884 0.694174916707192 0.62347799399120407 -2.1468010396752728 -2.8300395971100558 1.4492479348364899 0.76110750753888834 0.12289123302219164 1.5618788546632223 -0.74081660567640928 0.66759870594230719 -0.12259724079012702;2.9273470449326084 5.5941752702029977 -2.4154047146528344 2.987696069181629 7.00430291632067 -2.588119578086947 -1.5867614914221755 0.66798471250149638 -4.1500370232268375 3.0451039466109897 0.90847265532497123 -1.1041686457262438 1.6355611168168056 -3.5454872940995328 -0.21992888332030885 1.7584635351441757 2.2602246031449829 3.3206240441217778 -4.6419263831492446 -6.5864596106515156 1.4683270989184265 3.7207321739381904 3.9069775573456798 -1.8954444239440615 -2.0368648003274821;-0.19408333409024658 -1.6483227174581663 0.21600260027115711 2.4809192959033317 -4.7271398674332934 0.97641189827935837 -4.1557585295820525 -0.051722397667930978 -1.434323594504479 -0.48862512896050497 0.96570514645753236 -1.8889888203609249 -1.2118763967143882 1.05509404064389 -1.137304497900272 -0.88651155091544631 -2.2292239082223571 -3.0050672034546237 -1.6267363868484861 -0.18588727895136486 -4.4032504141432272 3.4634829346482667 1.8607479009632355 -0.98488599033808777 -1.6219607913498526;-1.975291786744052 -0.491712994479934 -0.30096010796142553 1.4156629289928782 10.582978939653907 8.9899582499258397 -2.7864816336427456 -1.9366308757829984 -2.4403812841224251 0.74192476945731212 3.7013076132704459 -4.8739391873196256 9.4198902491976195 4.4850064496066633 2.8040083409195753 1.4883430824934196 0.020117619367736067 -3.4956257685838033 21.397541760954837 13.902197960827264 -0.82987575517666379 -5.1005204374937332 16.048921475975881 -7.5148986355798604 -10.936367657131187;-0.33930157193191668 4.4515694923599272 0.35983702797843548 1.8513009789525379 -0.40783729042202599 0.34661913141751732 2.4024122329271469 -1.4853524979953685 -0.30058744394727588 0.057704796030007555 5.2880622075561314 -1.0983902560992032 3.8231607820482023 -1.9487763292864306 -0.66590597547008068 -1.1195378045998232 0.22349061089116695 -0.6706132748502901 -0.84954810443328044 -3.9653335764515409 -3.1002893146801624 1.8100421915618576 1.480401919082045 -0.39590542895245151 -1.1521727223874103;-0.52654993130811667 -1.4607396158395705 0.19565824788884004 0.33397544328073792 1.1863920302112878 2.664316524229283 -1.1080800854748543 0.85815509709807869 -2.5530642438643989 1.7145949497140205 2.7567611758140869 2.0193974081507751 -1.7407548735244953 1.0854009340802557 -2.1482136755781807 -1.366437843229936 -2.3505353877776645 -4.3090153035644798 -1.5468322295249006 -3.1867446235084986 1.150299237061523 3.830939157830767 -0.18140455601622846 -3.965553204001885 -0.6318826703324395;1.713920622922446 -4.9490267853566321 -1.890450759239126 0.20542083487503826 -1.6963870553806051 -1.9632021685466334 -6.7945386911314856 -4.7591858913854033 2.2918439793796899 -3.645361177154649 -8.2709262792803759 -0.50440691459356279 -3.7422580967548837 4.7267556798290071 3.3499702744389115 -2.2965351817484265 0.22382970751280834 -25.857398243810366 8.0490414172253839 15.982390495759157 8.6418358921212022 0.4617447793074787 -4.3012786549370876 -0.2225532799947072 5.5654915959613538;0.013091228527702987 1.7677138310526115 -0.79834903206837882 -0.39839347473198711 -1.8691978361787147 -1.8481940234798877 1.5924715180089528 0.069845307989917574 -2.6643614098072095 -0.05515605338316551 -1.3822558343141125 2.5282115910062184 2.1780795105962882 -0.13527762878747249 0.88125895082869787 1.344577658316761 -4.1582523163582676 1.3057673176620033 2.1307023764686019 0.62011888246409264 0.08830137833277181 2.1764294658769461 -0.10542399348952881 -0.23134663183975337 0.58376510056115749;-0.25141408526203324 -7.0533917973646227 -0.21711445861501577 -0.48369804410782896 -0.96839063781473977 -0.14642709479083396 -2.3179167508182599 0.71327024006752926 -0.92988390478316452 -0.13014502476484846 -0.81522467020929967 -0.20562932865357564 -2.3298205392667195 -0.23971986727553457 0.42883909344426308 -0.026527003515378851 0.16338157823420124 -6.2832476042480581 0.78770871551273547 1.0445681114519008 0.1531234103337242 0.75818922633422481 -1.7598702511036974 0.95240301908216451 -0.95362690273723572;1.6683133034998359 -4.2248571337324146 -1.4921372914933904 -0.081276811931990961 -4.7010507206859566 -3.0539802524663009 -0.15252971828643139 1.6874634432039857 -3.7280090822870227 -0.40443962791382859 -5.7019598711645703 -2.2520299742636634 -2.2909351919546799 2.2861342385202894 -1.4800036441102464 -1.6174604113270878 2.1467434999177013 7.4076778001593553 0.92922773806722914 1.7548497514256889 -0.69840583797804978 -1.1032379134878076 0.55289144632948761 3.9614385651236081 -7.2654828265178164;-2.9072802703430183 3.2938872979618252 7.5612451515116037 -3.1912747332778379 -0.56566109030050749 -0.49352991856706946 2.9509992256726267 -0.74412962046587516 7.0726560808015719 0.031279033650867732 -4.6330896173862435 -1.16169609670424 -1.5198698820648571 -1.5081183637913214 5.2179111012761057 -0.57687645144594979 -0.91537642767616545 8.679055141918889 2.5449154833320824 3.8294780984952439 1.1587306994102038 -4.5010839765836907 -3.2690231794419682 1.4336720641015994 0.73836398655271906;0.8002125035194888 -5.7228160981086713 -0.75289480987021096 -0.6563989488052876 2.3531597269412226 -0.88882780786374804 2.7137411120019972 -0.15320252084888808 1.5555443252620904 -0.65796592503916207 1.9711124824631618 -2.5638180841449851 2.0565820480086296 -2.687039540310197 0.74491702100694845 -2.9522722944248692 8.9943203317384768 0.13881074848328018 0.36022827610303682 0.48148203747225105 -4.5749236971194165 -1.5862580344917412 -0.31984310098688168 6.2428429120895821 6.1354483011728611];

% Layer 3
b3 = 0.37550541147805949;
LW3_2 = [0.04319982079451485 0.092883860641873303 -0.040305198654000202 1.1472760346680391 0.14598800425460842 0.026121798392644436 -0.0022382245061461697 -0.045798629797241024 -0.022811258864940311 -0.0016147719748046054 -0.69650839530182207 -0.63679234033517507 0.029698244368627513 -0.0036305297143809949 0.060359517786290888];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
