function [Y,Xf,Af] = ESPER_TA_8_Atl_4(X,~,~)
%ESPER_TA_8_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:02.
% 
% [Y] = ESPER_TA_8_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.7683218667839246674;-3.2936973760551047086;4.4502314382661039005;-1.7302185267859366835;2.394564492646581666;-2.5059539384169804421;-2.7408399331616681849;1.7897872385381428106;-2.1673744228548690316;3.9516961767460059285;1.1090508923898418914;-0.5212967847736198479;0.4152348621802097739;-1.1295900432533294566;1.7479293941098421605;1.5152420663840284742;-1.0511043050981401237;-1.6041866517653018409;0.06552362727722609026;-1.1423346954957027677;1.0849346008911338046;-3.9277706163568395503;-1.9818209296320588031;1.4119246161517775562;1.8452404852591928197;-0.17671254933214883276;-2.0784429274909315133;-3.0684674034738668169;-6.0275072628737706992;-5.4154125893837754546];
IW1_1 = [-0.67500314162664765139 1.1294055945443726152 0.47240274579959912193 -1.0315251428387468557 1.5345161362805481708 -1.7056837820001173878;0.67379006253643314306 -2.0643709407845922676 0.24658778627060187749 0.5531672695064856482 2.090744199755013355 -0.72983937761998163296;-1.3725839790682445862 0.83633393067504768759 1.0204766456392264651 -0.46831382524877335216 0.94026372219843712408 4.1092419470770638057;0.14668445527160478559 0.24477461391335941787 -0.16295784986616743129 -0.88614925204635930367 0.74394408324138128208 0.25397725585538460935;-0.65792605669592585382 0.61196553462860947548 0.052603753527907880227 -0.14180210314802801919 -0.21265781055784779841 0.83441690154617809139;0.94573533078291760479 0.18338700259655513203 0.15298718783720327563 -0.18533039862461403446 2.1182418012974633115 -0.034157858906811305877;0.98153033552214363766 -1.557952447861039813 0.071337037194527358475 0.22986125782026373132 2.4378427253045891199 0.1043142093407828791;-1.7129135098440577689 0.98034849522400135946 3.6078130915109105636 -0.4439565180036061931 -2.2963129574126472932 -1.258907564737428153;0.29201805645504519404 -0.1323946278889930328 -0.22037194730640491391 -0.91593248450811703965 -0.58963319450377515984 0.78982929342117202953;-1.3172209531744680788 1.6660438269317423554 0.057706574889936822215 -0.35662033861827402426 -3.1643863181631552983 0.31281241293921507873;-2.1253552203050984915 -0.72551306760649569849 -0.3387877584183460189 -0.17472031281433431094 1.4342554294855460739 -0.81427845037776647175;2.7601733071762897254 -0.55020599880405951509 1.98919790125664675 2.5445141369531145692 1.3473192365036439355 0.52209828614412312486;-0.51472570275364337711 0.25006567693987785672 -0.32267125029020460314 -0.093834091488744539311 -1.380541862230871164 0.032214779694893481976;0.86113698535809457546 -2.6005711623029892365 1.6117217160646484242 1.1183281290674995656 1.6607138667864742576 -1.0180171373374005128;1.3287421749955936612 -1.7386661731251102925 -1.3065358625637235601 0.512588760172226654 -0.60946447905698764025 -0.90066749303681037375;0.06708159518160616841 -0.092386034234430106094 -0.10930688206230065873 -1.5172328312240976889 -2.8284007956161532071 1.4630519044644303417;-0.27380256185226353738 -1.2963726913126731866 1.1208320631349573127 0.35742170825990715599 1.2144456065649740228 -0.26592812609999072482;-1.5409033755153191958 -1.0767213594270035326 0.37291450007870241556 0.69168100854368141928 -0.91519063174298054264 1.331593203472705822;1.1756559089394531536 -0.30237719324470774263 -3.6583063934548278873 0.51724585861633043393 0.65491594306583666985 1.0222796658462256492;-1.3308276038585280521 1.4248792464213346776 1.0313234810141167497 -0.35530283317753069694 0.41738493557453598681 1.1035215134131628467;0.34738844843840455123 -2.3167781478684106311 0.8058201926450265784 0.58132323760241411126 1.6229790828842467487 0.76965113708949361992;-0.20655541548938574636 0.99270011072906361171 -0.52512867658721396058 -0.16945740635950851116 3.4308974779054435267 -1.0473814402191079509;0.96770763810265114646 -0.8572370547016610054 0.19172219694686404301 0.10906051604146869971 2.5227992299626476047 0.22875710955872069485;0.51735702072976741395 2.1690521310218868756 -2.7428266443488000803 -1.1481769133662074189 -2.899548197864763921 0.33805428635521445058;-0.95694612200970596838 1.9185421347915392332 1.5176074471278704348 0.22191016842730065806 -1.1434610282559680705 -2.1349034877733314985;-1.3751089334627348837 2.2745743206823556548 1.3461872803875203353 -1.1352920959418626445 -1.3350711727031376874 0.99657405634288509511;-0.68303063501163119309 1.3209720022825732766 -0.55756837340346132592 -3.7442545083950315998 -3.6195452194573642934 -0.22993150190206956829;0.89629867198404877815 -0.20966137154698230582 0.32921343424080651285 -0.49390233935305405399 1.0997694514839289059 -0.040243417520534188747;0.68318225453575054384 -0.065060563836290802309 1.8662278275795736171 -0.89853425111987772489 2.5223466621330019599 0.64986359269965843222;-1.0723949173414248914 0.63451997933245440908 0.17542421710993949535 1.1112894415295535566 0.71151373767658132596 -2.6215465795758463585];

% Layer 2
b2 = [2.4955081763195825495;1.0814273395482552065;-3.348900453041099734;-3.2642310612897476041;-5.4836890552639125929;0.54984200852009468274;0.12982260483643320859;-0.79771554802272071072;-4.3038826104632983416;0.35535806963868810104];
LW2_1 = [-0.39592965304474508903 -0.99704903648715159648 -0.4992104803958056225 -1.8001573535750596822 -1.1444128645837403635 3.6438313084288216359 0.49245226926800106382 -0.41530612709457281895 -2.0691039940328845859 -1.1844564244046409396 0.5251514952581546325 -0.4573865101246200604 1.1164479440508181529 -0.4593790736841084632 1.5456673278757497858 -0.56043097313743794885 -0.84411841868226444863 -3.8902998887962372265 -0.87910284762500290334 1.7175238932412386639 -0.66122431346831933574 -0.48722370769843720284 0.73513838406971010464 0.66446319153315658301 -1.277170615172505963 1.4063462593313671434 -2.0040023658955803398 -0.48901642376856185868 0.69615482341575074532 2.5553020779144892671;-1.3376243559717495568 3.1453590887604039317 0.25398194556352299278 -1.1085789261983522991 -0.79572353795171102409 4.8598321521201102158 -0.87021723124056193921 3.0464306569236465627 1.084396695160419144 -4.3271423627019016678 4.870797738306520408 0.98143687006187252386 4.2868165891619529617 -1.1059360235001627348 -0.8119761148653836802 -0.69859372930783514288 -0.83179165614539474216 -0.98412714780144228133 1.4006631411728829306 -3.229237121942123423 4.0226635334044056336 -1.8790841402514717462 1.2219855496534506312 -0.043280493515279190586 -0.5017023243145491973 1.2792717904668620132 0.44726836316426715756 0.42043561063378431797 -2.5011105901722796574 0.56716001791010828281;0.41182121710532149095 -0.74925641842005163973 -1.6464609616909187118 -1.1201126785291883881 -0.45180995129268686217 -0.49668847281770439617 -4.2575634039859249214 0.13254888444414067439 1.7719437274491092182 -1.7200982250904037762 0.2168285587188011343 -1.3043256462853669575 1.6340726154263254255 0.25666556970457599096 1.3640985297731709203 0.39419714358270341314 0.91617046519472911115 -3.2445606808445699443 1.1541608788140469422 -1.6374728036315091551 -3.2319790867930944245 -0.45615215486734983497 1.6861601313257617019 0.096149447742920543525 0.85592719964699182089 -1.1499224866854687033 1.0320551325833957623 -0.66124211421864653726 0.42312332048054285272 -2.3585173496465028364;6.5751392895265974303 1.5933030583063609864 -0.57419915902978790889 3.7598060716746593002 2.5361377440013783691 -3.6505641006929034909 -7.6924512638020283717 4.4955810839135477153 3.5051441752318486245 -2.4275626037161437409 1.7163813582355089693 0.71176262809637669271 1.7593698747647026348 -1.0258177453128185519 -1.3374286013711538246 -0.09614762629333999111 -0.41872363161340625526 -1.6519333915843359417 -1.3911154068045885612 2.3450708657828460701 -3.8471931883392489482 -0.33337198744626883595 3.330402157079423997 -0.62153041593595736991 0.42242618239720008955 -0.54894726898102685908 1.1199548680951891821 -2.0158414508465374304 -0.37588854926871262396 3.8109547098013849542;2.6329358820701647126 0.10634210903457108621 0.34733526494365862813 -0.14962045564042056323 0.7190665502628338368 0.13759328380099786204 -1.941319588448568334 1.8083265199004321389 1.1112262202648517384 -0.97305767286471200883 -1.1197991188827198794 -0.27767794941050172319 -4.1837344641194746941 0.45196058798839533477 -1.1287303412784184253 -0.21357517693680333482 0.8876330953281238445 0.56710581296018391928 0.2400015499304050115 -2.284089037167362779 -0.41844299830027725795 0.87423107535154942482 -0.34958688214051308885 0.83543410733282874592 -0.51533298515299164055 2.4864189022131277795 0.46383765157605327811 -0.47559920875369193771 0.75087890529602208112 -5.0074723857178611297;-0.58141755432969555173 -1.0828494001612969377 0.47669849014483917093 1.2243486135387215974 3.599832714537265943 -0.30128829574627924437 0.48762540770264517498 1.5844987047862413299 -1.4385591540234212715 -1.9921434077894597525 -1.4295937049308329314 0.018579233974303815263 0.72022047708019309997 -0.3640940065246082713 -1.4566479009923782861 -0.46088732062415943558 1.7208212289830191466 1.7943096062836179083 0.87130596170091711983 -0.83587121621625759538 -0.4349681452965908357 1.3672950978695366242 -1.8431460694313763771 0.32734405755137535587 -0.31293493714694958774 -0.41067962553665615655 -1.4489704723242906592 -0.072446866439196483389 0.10076732222352637047 -0.68685950468791667767;-3.6486303918341596031 0.15483475379395075788 0.1556145632555690772 0.38122962143002359081 0.48990402893496082237 -0.56906241014381353516 -1.8722893637320123794 1.558414537520623977 -0.17850034514012935727 -1.3063772593490634577 -1.6911022305786798103 -0.29588775455521515445 3.1562850811344587143 1.6236300220757344803 1.9697628947209895323 -0.59527890152187945549 -0.42583783509826772518 -0.4272612995897401289 0.015961606729819232536 1.4112414802431625382 -2.0165337363740407639 -1.9361665589915846297 2.4416382585086466861 -0.88915692081430841576 -0.50231144417428541527 -0.58820711053699470394 0.12537376382292467203 1.7186323606627500471 -1.4908971145701066519 -1.8198527284049217378;-0.41362533041433607872 1.1385940723607845815 -2.9446986461173292327 1.6380010534226552288 -0.36333872508117370792 -3.2160259900437768721 -1.3690047468410408982 -1.3780694083780395953 -1.0490629128594977093 -2.3107972346381884243 -0.58424763976055638093 -1.8828172242058547337 0.69225929965245736053 1.2593581681330294764 -1.5720804086159818613 1.2110360269721398563 0.49635441794609164168 0.76664640096763780885 0.074728419037336707431 2.870696307780790768 1.0865144252779603828 -0.32948531978065442871 0.3284234418867992833 -1.3911324005744785115 -0.32070364104773718683 -1.1333746211306885421 0.11254230259166009276 -0.97353459159357258468 0.53584416576074078709 0.3854121079723057397;-0.092476676534234969473 -2.6292492006999501619 0.90587837734187104388 0.28936581814277312352 1.4030700879445250351 -5.8623498696216795878 6.8251939155610337195 -1.0088779661478535221 2.4679544610750228095 4.5577680973091858618 1.3815269854699743224 0.21732002548488865701 -0.75238414261439801045 -0.96114469126755797124 0.68861848996825547609 -1.901985028047614712 -1.4852959191338359624 -0.86234250350171204325 -1.5132062062264910463 -1.0869110473507019865 0.0050096766493876194321 -1.6545914050409329388 1.6203213370332578691 0.14741451156404958289 0.20074806847595458303 -2.4678377737494692212 3.4836839833933637145 5.3505645876241789693 0.96074928889113064834 -2.2513877466159000207;-0.017551157409259200703 0.76196974036035836075 0.41734931173882250377 -2.3011007352147356819 0.22675385271184320124 1.5069186950819186688 -0.2814718971898160782 1.1732237582773847873 2.62762091182920976 0.88809139025645467136 0.42191017678748626851 0.33991577584577709059 0.15982227239800969598 -0.19479130398001762159 -0.24438137745839649817 0.98182250712844332252 1.411060403659660123 -1.6288077550206663258 1.0730017092268520074 1.0506323867083164902 -1.2166421760939414298 2.0888487829513038285 -0.60727383110450572357 0.76788926844734117783 -0.25416174897651783171 0.5755739291508250588 -1.1189162219534096732 0.11279061026340497786 -1.0379303982883782975 -1.0230609751335548729];

% Layer 3
b3 = -0.21128315383785514769;
LW3_2 = [0.085898708622808642166 0.0071475132044336222442 -0.01155262054862112725 -0.22898643696591819419 0.36702020219206193952 0.18945370938445887932 -0.52714928217036494118 0.013856296885236056918 -0.060641962952670540321 -0.36801727806922468478];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
