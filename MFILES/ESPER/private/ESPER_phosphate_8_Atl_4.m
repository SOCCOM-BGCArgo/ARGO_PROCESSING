function [Y,Xf,Af] = ESPER_phosphate_8_Atl_4(X,~,~)
%ESPER_PHOSPHATE_8_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:29.
% 
% [Y] = ESPER_phosphate_8_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.1684448011584853688;-2.2978424486601292109;-2.093257135013475434;-0.95075474470857379572;-4.8808921355805088282;-2.9440122352565780695;2.813592795918455014;-0.70165962325987274451;2.670382102457111273;-0.7210223807996523071;-1.2300363346725011748;1.6949918466772517789;-2.7451823476731647133;-3.419381340961551885;-0.36346204968442352712;2.956235035848696846;-0.064262418774016144551;-0.38769390463028136073;0.89035475100640804058;0.35892416836975943317;1.0279445090127761198;-0.7385969163630833334;0.17164642857027212486;-1.3453078278861660966;0.63825597461865390958;4.1562298014832794735;1.4601176171578866825;-2.6945856798604914673;4.7462257757033308181;-2.6620410821782916067];
IW1_1 = [0.31160263497109491615 -1.4031499232251043452 -0.47920581516575011527 -0.60357112342665153459 -2.3531126492724960819 -2.5041576378785372903;-0.7814539544923878589 -0.21369337355529685607 -1.9623253745840769646 -2.1491704427711861847 0.51092364576737991921 -0.6217063250494866411;1.0199740872493370247 -2.2087695121196775361 2.6679566617099710335 -0.57681195467292101231 -3.1551846527387565899 0.35290550421438821038;0.68999919282547395039 -0.11322695642615401845 0.75216770063877091967 -6.5997154294366389138 -7.4825126006126989608 2.8559326008984302625;2.273174761686381995 0.69939744638307199676 0.46063690072719698509 0.80780235154770230199 2.6082285670555300783 0.41307764525892459728;1.8875054965611512969 -1.3453805757589500924 -1.4007845430894476646 -0.27675711432373850673 -0.16719792447279213654 -0.69549482054543565468;-0.96641328874370191482 0.17462743695189103521 -1.6712976857665344799 -0.62598761376905276421 -3.9361309284937049391 1.31097007393047571;0.27083451363533900258 -1.2168823367873513597 -2.0572212984413691395 1.3490688035545039813 -0.81733771748589956196 -1.4267348161896213909;0.31437340211678238555 0.30733273879285455399 3.9200829509788475136 0.44673201535941908791 0.1529451205176407258 -0.60296682560087833114;-0.79069061738050716581 1.1933759614257244408 -0.30250066891681026693 2.0394218678416975443 2.3720258656137698239 -0.69012321425551614862;1.6310500344692724362 0.016672928789604017641 -0.95286769109092628316 0.38391307478946140597 0.92056512924101430162 -0.33111565367804618454;-1.3796528623664188196 -1.5849525674328697189 1.3386656254581412728 0.15787821587824435454 -2.0162648191988861157 2.9952733905743200715;0.49688696563501183467 -0.3339834460877987854 0.24363772399800792678 -0.27917511239798964429 4.1695995720517338157 0.7500136804881126773;0.12503511054440749617 0.22928555800120278829 -0.0063370794937570714897 1.0481137081126561394 4.5132393560753101269 -1.9869779885803005026;-0.26214496854500879408 -0.031640274160104578383 -2.072879955905208238 3.4862200345168825599 5.3814611723961016665 -2.1591440920549458404;-0.030265261728699401067 0.033019177289540228848 0.71359119030371087611 -0.96943621763923282231 -5.5288242251097559077 0.47487034506134612188;-1.3048880881793631925 0.90517928139323211578 -0.74273347693381452927 -0.11699905386153819364 -0.031669128558228024084 -2.7393119419623768174;1.815283363781203807 0.26492215080022774032 1.4592056380399858195 1.4151915117382449782 1.9456825067946126318 -0.82926391478068739449;-3.461171180214981824 1.6449294111154562081 -2.1968180786972775209 -1.1313501215600303418 -4.2566126122747975913 1.1632334710160172619;0.32191644054234164196 1.717322656381939705 -0.33272809499983863057 -0.79046009680406215114 0.78649138878302304878 -1.5116089605982634403;0.42348656006177975986 -0.54650599241277708629 -1.2651714614250342272 0.18381763215867596983 2.051513476774708522 0.60535201307008479343;-1.3328494831794994724 -0.71611955736081656099 1.1409210218927474667 -0.61651365919965761542 -3.9579210584729875855 -2.5409415377667903257;0.37925532716886634077 0.25797173559698544087 1.2626407081425394807 0.9206920091092140046 0.41569741196771103908 0.81107142697488421312;0.4816461261524339621 2.1612305382993701741 0.94988439462391671686 0.08809271340487609403 -0.2310954756689831413 -2.0631280834235936616;0.26419223629597254899 -0.84020801321779747806 0.89072296365843661725 0.53708786411148201623 -0.013935178888876046874 -2.7393242564109669956;1.1897808369831415209 -0.43660786850505584056 -1.5608562713127760446 -1.057505546555879139 -3.8612183250782647903 -0.094618928362350016026;0.68647278659251287358 0.66045530191578627477 3.7669799978483573533 0.11567006821176467612 1.6578440938280836203 -0.88138797636124444068;-0.38354346292777619087 0.68086275168418830539 3.0897805396136326372 -3.0832896375109335452 -5.6786218192026121088 -0.7343735005122328241;3.2015414414540970256 -1.7194033181861829718 1.1290421216452179998 4.5428400156226071971 1.9677745222269427128 -1.2432552839344674922;0.3065301953357625897 0.16433921415677457678 3.7514817805501392556 -3.684617120048416794 -5.1035907435342817706 1.078048060388655971];

% Layer 2
b2 = [2.2501657918129702729;-0.80997547923027357619;-2.022107155191942951;3.7240564038178018968;-0.74328220111046050533;1.3660761819580549137;-2.1430835057870143423;-0.26182774196964408997;-0.29065645762637798422;-3.4295349992043346887];
LW2_1 = [-0.030190946551642922069 -0.34792920055163339965 -0.11255709782675130115 -0.73110448586999254861 -1.6135153922653469039 -1.1991063788233438103 1.8238334930410038393 -0.49880357316641915633 -0.83714806679215159058 0.67057630480026997333 1.4470473289906211622 0.31064551156510361585 0.10208524971880222898 -1.2425800310679557814 0.42274187568586346631 0.23262278488436793911 0.71676137404723039293 0.99767882758141113175 0.54257658220375515334 0.13958734940850045514 0.25962711416134931497 -0.48501001130683596418 0.23455501984285534456 -0.6572850045889718773 -1.0551648099550563487 -3.7843346955221499606 1.1691184551504545386 0.34411412724535694885 1.3840391076525673242 0.77056719623027558619;0.74970809005808169978 0.92346022425099882902 -1.0271511568118329993 0.059094251151571915159 -2.0298259573076813389 0.63290040833801231024 -1.0656042262635887496 -0.29431828559179556981 -0.54586041671237572892 0.44009441541095717376 -0.73940339876655314377 -0.28509626121394460174 0.55756679777003848031 -0.28704889322561721876 -1.2618416915351884366 -0.72914022664492039727 0.40859498715479275477 0.11626902475414997717 -2.6145217147187835849 -0.40582713244950335829 -1.2058846333887136559 0.33407855292410076897 -1.0450193241041656478 0.092332883498991644156 0.67186630715970230288 -4.4169536303272645128 0.61323243545966887869 -1.9234836494547040697 -2.1470567789550130122 0.58560129152244433381;-1.5879537669174912384 -1.8479901309314332725 0.30323640189408490597 0.207541771781844131 -0.55575343492640549847 -0.13783039464899127235 1.5677531855940123329 -1.1812865140966988253 1.3009691629031867599 0.4804737597351997902 -0.52009088376969836442 0.25847071393807136142 0.51346407694673679156 -0.63559763468173569034 0.51525299647244127144 0.16214561697984888888 -1.0056831321337951213 -0.2895236074632855372 1.914478348620471726 0.56444560477976135626 -0.069541172837642842297 1.4176017899027497648 0.14325417758543126934 0.26859535921298360872 0.57471364759386545096 -1.6803942952290633617 -0.013033878034827688086 -0.32364036086713043883 3.3647576028153660666 0.19026151417513448294;-1.1513554470138382957 -0.33659888593684383906 7.2873601299316845825 -1.0718465140292448012 -2.8649435546781170103 -0.18582807555999686366 -0.095284487767547276782 -0.40001803661993823313 -0.037337565114416458589 0.4433311983655844335 -0.38664918029755096507 0.26382696137139738379 1.1420201118605288748 -0.47677271073900145959 -0.25163294860470974967 0.34881476695135305022 0.98339997441871340733 0.047544733956024487487 0.51946079740980288797 0.3695207355811934713 1.5337204198103848718 0.6360397751426134505 0.96973982498036515043 0.79566108849675976078 -0.64817062943855385804 1.5001462101969376128 1.2583119190228757578 1.0439424321572534637 0.25773410579127226105 -0.14331045679704912388;1.411146051556745773 -0.49550285921530135003 0.42253661082918858583 -0.14382665222713597597 -0.53738074045030370662 1.0774397790638123862 -0.44880715391202880005 -0.26723490584359782529 -0.91096226642329569678 0.78151960477370885361 0.035777482116073018592 -0.92679640749411318357 1.7723255378009625804 0.347783351390726303 -0.60498030713510086986 -0.37891205645459530293 0.41896495310554482394 -0.36007919137989730096 -0.11578705329673980029 -1.0450196561561742037 -2.0137791610926703001 0.34982551363027886149 -0.087308747016478310821 -0.48249792093552157368 0.69321889496008937126 0.88036116685323428932 0.069359778159221507909 -1.5275794270181419776 -0.46053825694954836356 0.71643575295440553585;-0.89919852846750480957 -0.55741175045301238899 0.537066110372516059 -0.022912317768864466638 1.468862868117520426 0.49599728099781936752 0.7465614293831254189 1.0227305037454226255 0.71027784881430344743 0.010021607040461986277 0.32127619254297540285 -0.033957162186492112488 1.0958421689470501104 -0.95234866904871318116 -0.1778271756707834883 0.39972143479741378824 0.10316259563656463016 -0.018050322688179087222 -0.52050778055921254062 -0.40637624621166618111 -0.49304325233864593203 0.25348807096327341526 0.35517666456263197183 0.4119224494027990402 0.26406658856177123162 2.1061944084179455849 -0.97619486378903808088 -0.31935193674011075338 -0.34463582032975420555 -0.61883710447238637897;0.71901535581960163146 -0.87566020847742764843 0.49335009407538066295 0.2432450527483720204 2.0443162865123389871 0.33975155127826162094 -0.77130185554548946758 0.63648486296445250243 -3.4318455669250989004 -1.0331975901402150608 0.48453621951276443225 -1.0375240539098791182 1.3495405001214013652 0.45672579106075000821 0.077086332558000986159 -0.53193699511344083586 0.26422932858829406566 -1.0343055669673193453 -2.0793469440328125053 -1.4503426241434944632 1.2526236975372375682 1.5075088038314705674 0.09211840124089980264 -0.23687766533851090101 0.5869263270012836653 -0.21065757742027718669 2.7284140853982359332 0.24574826759980419877 0.31162734249380047435 -0.18109897927848195298;0.2105583833215093903 -1.0814223896526620194 0.62285062444556837935 -0.44666073812516887687 1.6282558136758094047 0.39692290161924953518 1.2995060954476977955 0.12836867143258892665 0.79217513563416419586 -0.41061251306118201621 -0.10965111316541634179 0.15671331934569984745 -0.69316733510087247261 -0.49721913381357746298 1.0192026589721037144 0.20755042057231085084 -0.35196033449062669174 -0.054276130219685254918 2.1629206125741964328 0.70570634612554805631 2.3432454626769940731 -0.21821929000114034802 1.8348727677576572859 0.096641740973981107854 -1.2180256724340818852 3.9917619422719492484 -0.82500516744718499496 2.2099585756333626207 1.6734263323306413085 -0.76080166027281070917;1.3854088456158935028 0.71053693491972225171 -0.19024646253380056438 0.29032000011259689876 -1.2511430234309035558 1.0936724533146020555 -1.4889484150383480721 -1.117680564968868806 1.0011232447888882557 0.29236062048564198657 -0.97529779117134063338 -0.45401217619415279447 0.93667044690450895761 1.0165119638699886551 -0.09425444736545758595 -0.79796718987496717546 0.36218678811328286482 -0.79732289433582448357 0.29180519365847829016 -0.44214721033212428525 -0.22531763509224186914 0.55397946917595808358 0.052432267450472622161 -0.14366683725297263452 0.14808566564565489587 -0.71294157264463631218 -0.77089343440300439614 0.083595991982037765045 -0.12518652498833462983 0.78132214837395475016;0.10036093647301003173 0.72938847337474355115 -0.68419436502288333291 0.1447291003200570636 2.6551743276256125625 1.7646180364089327774 1.3147210457102622705 -0.83647618803597323378 1.1884791657225575179 1.6280037504671203141 -0.4404225513878922138 0.18854407640976084126 -2.487801846288843155 -0.95839394222597551476 1.3702807734990147814 2.2706915721792433338 8.4771189896624011412e-05 0.92898862346456378969 0.48992629080647198681 1.6432371031994046362 2.0352671264931916362 -0.72944906138079734781 -0.16248482748977674528 -0.18677043979025961806 0.50379854308939509 1.0793455213451423891 0.14526904294045447918 -0.60237087236490194364 0.68157235413193129059 1.7574861900765017531];

% Layer 3
b3 = 0.4423212961116410602;
LW3_2 = [-1.8217915993277338238 3.8466614132514616031 0.68638560923491709342 -0.71198264154078017008 0.77578718515621958307 -2.2078492443172916815 -0.86789650434933574008 4.2681664439830973024 -1.5521325789566833286 -0.57877312033179628692];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
