function [Y,Xf,Af] = ESPER_phosphate_1_Atl_4(X,~,~)
%ESPER_PHOSPHATE_1_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:26.
% 
% [Y] = ESPER_phosphate_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.28;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0470499670650231;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.938233046767930956;1.8704164661197828501;0.88572636104616542241;0.41430261109449173507;-0.10662973002337737538;-4.781094452100037806;0.86565436446243626545;0.83353256642470574533;-0.67930178198807822376;-0.28313878250382290558;-1.0722090892305735643;2.8723123180917573549;1.0693865793064780689;-0.61199358315234164696;-0.73392741591622179254;1.9929892017260917303;0.30096549428060509479;1.1764639744402736188;2.3654311443145585869;0.38174747275463954965;-1.2820094208752439435;1.9071757124799439964;-0.87212537108484322612;-0.544434211732540696;3.2599472150979846852;2.8991612158453392567;-1.0864712982554229903;-1.6301415426262255703;-4.9637943132955557601;-4.2796375752323703168];
IW1_1 = [0.6717450098903979816 2.1080075365357280326 -0.21890328286181581774 0.25903186483005891105 0.25478001888441348388 -1.0574435616561279616 -1.5700560669637750877 -0.4842119851963369026 0.82080411413857645719;-0.32042251498389706654 -0.020975740517230209714 -1.0362863414449194899 -0.4638696897220025428 -0.9493401672703037919 0.78003523646729744367 -0.96899080237798995707 -0.34825007679732367105 0.70240869866627209106;-0.23808210182675493272 0.038132551377812184956 0.56449715146706702651 0.19161009603120293665 -0.8140967046657981987 -0.48671537491568106493 0.73867608841024146038 0.74538606655019035152 -0.65120264024212226595;-0.22028269752358561884 -0.75767857208544819869 0.086137345374113327701 0.25045833163270520005 -1.609262709498029631 -0.7635368232320471904 -0.21270270325130016809 1.1509945417073328411 -0.32164293073190269867;-0.61718322884973275677 0.083085048905529132468 -0.75211606673516928634 -0.36069602176729931298 1.5723875153990567455 -0.34112892238881653562 -1.9858741995130111402 0.59477854990200584862 1.8086913647412721229;1.6871045248517928528 -1.0782956538817385361 0.9918569989819285837 -0.0772162369369741447 2.0699269118643335297 -0.96986551617497362976 0.038430639156044381355 -0.33611711075340944266 -0.33017817206707855693;1.604291477260521015 -0.96020643332728006225 1.7004336223246367954 -0.36939583074293808052 -1.0929578617021131759 1.6345112953394835831 2.0095404816683615223 -0.54992518642572219001 -0.064772793468032219266;-1.3559999162229472436 0.77255206195088410581 -1.452111334207059512 0.49899573398383545442 1.5525526262824018708 0.48448629196383280471 0.92429684493375119381 0.59698587833288785376 -0.83541702250101157468;-0.12600371907077664857 -1.0431057415509608077 0.23920638071813826731 0.043268012619031064048 -1.0533691498683996901 -0.29982365865295274032 0.96686650974728061136 0.24096253382516524821 -1.0639047706401423277;-0.93990110542329796672 0.074537638336480818713 0.074583801980127512055 0.10832367384884923622 1.6587054128953997445 -0.36692941428380754232 -0.69053178485985944324 0.36653667745325180238 -0.025733163161830271276;0.0096909899769749043019 -1.0833638021780103156 0.4356618378065559849 0.60179317671980314675 0.075362624707058942231 -2.2571239379499616895 -0.31491406073027539136 0.79124920578059687593 -2.6876500437592105719;-0.71661462734197212132 1.6356209272580133351 -1.2144437606994133994 0.13050720560636788758 0.41831015597190268629 1.1099223122384840323 -0.6556607822260456242 0.73061039985315578971 1.418486455794030876;1.6970967034104302851 0.19665288030650254769 0.35922806731851997242 0.24838997836692863763 -1.0454191721723233854 -2.2593344745614150071 -1.4070278180324231609 1.1023708627388377757 -0.3260340372220197902;1.6271594562791076299 -0.41064881558500448966 -0.046596991098546897137 -0.09505690478531494958 0.55715425452853495347 -0.078067603598483303884 0.010578291218907541482 -1.2887777229935428736 -0.88206482802600894022;-0.28862585483017261234 -0.69590889538265088277 -0.42183585151100083666 -0.21178211324334922372 -1.3573958673633801375 -0.74444961022919220461 0.10617905180019340805 -0.28724670288354620107 -1.3022289916280791466;2.058598306884767748 0.15007475462567107516 2.7630229126129375317 -0.46270125842208326139 -1.1376665624981887603 1.1822619886374323706 1.8148315802978349787 0.5117195819521145328 -0.7342513045896498225;0.1490353956902194521 0.81789092680729913454 0.9343513104362427546 0.25964125198397025596 -1.3452543857626200197 0.44901674023088539167 -1.4746808640123010292 -0.097549332006156411201 0.98641129306883224004;0.42838675441811213673 -0.39767777220327943377 1.4901534588260301195 -0.11426453216951937275 -1.2097864744187758479 0.96533434342904334002 0.38159133717156040744 0.30058448111889579657 -0.55344966071405610197;0.11090853381168301606 0.18440634029964253493 -0.56763841195606690171 -0.13110251936650132998 -3.1194263678966582809 0.43471370913820328585 -1.1164706370777477407 -0.034966464821482419467 0.77333578717740181219;0.51617776718799557312 -0.93821979276837375039 1.0807583396299562661 1.104757350872193733 0.6307928830863422931 0.32875318386792123926 -0.20449266474328972598 0.73731483230447014687 -0.20469939652313848266;0.19341620259769654044 -1.8301876318520604592 -0.28227948861917639967 0.70918634880420705624 0.48418123890663056219 0.65248072928653533253 0.43793626341296776339 0.084674763458958038354 1.0937567780960224528;0.96963031868237359312 -0.93976427240042237354 -1.5144230877936391 0.15527518807135384793 -3.0228014062224839442 0.030524337031715500362 1.1579113619652299239 -0.5285369140857221204 -1.5307952107757312188;1.1454656674835719254 0.26327670528240026959 0.37292826801080947163 -0.26731380203850313437 2.9302793572822989354 0.88912817281858114171 -0.26423791768314852657 -1.1228312809540275108 -0.39633943947446514944;-1.9639558683612134971 0.3175538850743269137 -0.027673797441008431142 -0.80333702251274763384 -0.02348034839763025669 1.3914232673376210059 0.3417548961033772259 0.64637623068733207621 0.18881222000312772313;1.1518166657207016268 -1.6399614951497809567 -0.64061127761231562161 1.9969615897695012219 1.0273956255435476859 -0.7145319236680084396 1.4577335701177509542 -1.3603595922584605926 0.46069466457751961919;-0.051164240801672949965 -0.2754936833122019757 -0.052185026060304916251 0.10963787572388646041 -1.7862654757310176823 0.82505559852258802955 1.5679441613627584928 -0.16840363054950241439 0.70476645965191253573;-1.5089085221655493818 -1.6509733487570636967 -0.74056823508239721932 0.15322590002859867719 -1.7248236829269261161 1.5573695565818868047 -2.0941871234645148547 0.70113930811335345439 0.35877960613057502393;0.23420753594981930101 -0.27441385280863089813 0.75282144865574374126 0.34702674591719301356 -0.51826690359459970381 -0.18607272246264802695 -1.2050605300160495137 -1.1778099897647777983 0.99637237899926101026;-4.6597323957588532295 -0.046334180942641488288 -2.1400910624271887173 -1.0691723581497145634 -2.1536722521885045545 -1.3456899654566691904 0.99937950493937033336 1.4945416547955532316 -1.4884190062462541171;0.013652541873063351457 1.3067243614671371077 1.2047061924262056909 -1.0653679299473348685 -0.24025918305999574565 0.38720675879219368376 -1.9951464984280793402 2.3869572434420662788 -0.75022260327634615606];

% Layer 2
b2 = [1.9293436807798600707;-1.2207929454878614361;1.4869171838178036893;1.9700693801485713585;0.42073210985540998585;-0.19386628113303014387;-0.21259739568830068879;0.35864153821287336754;1.8185659245204230938;-0.38482471020063385714];
LW2_1 = [0.91638775453755616507 0.87007055879642725138 1.3571424485575931396 -0.35018203858990953892 0.3433937430516000866 -0.74218894126439050041 -0.10136965158368214934 0.21004090012741755134 1.1081952575444891096 1.0963780165771024322 -0.22881162640635316352 -0.49535117197487632534 -0.42145749458901532458 0.21897634886382438824 -1.2675670027139296359 0.48062538164240448113 0.081969935995375831084 -1.4409294815006903345 0.85440108792442459595 0.27639951251429967227 1.1443065880478795471 -0.30990545386431006536 0.1749267326867878225 -0.53034334209321265519 0.44091478029123198912 -0.7840584755028910946 1.7626994102055850711 -1.5919219178873984522 -0.41451641805396127749 0.4924105790369120994;0.42785065500013252926 0.92805782391510316387 -1.3143177426637360217 0.30240676771427832392 0.20466473011998578824 0.45775745228047370894 -0.35568468039536382808 0.20392401747008598312 1.0814488613578385756 -1.0384322219408206323 0.27635906088594597296 -0.35110246400897893171 -0.72872686185623447574 0.35837207095224776765 -0.62757202725997807136 -0.31832209697538899063 0.17916754657165734343 1.5723299660519700627 -0.59525971466872740212 0.08534001075725504426 0.047740179359573142737 0.11184596620916550935 -0.33851675871428665854 -0.97041952071740811281 -0.13458594015126570942 -0.32515117939551274606 0.2065756792379025153 -1.6398406332392752027 0.069783522631991404261 0.39674932384338601477;-0.68880486093412840454 -1.1115025495358867857 1.1303637063069509328 -0.83791246037062760976 -0.045266463220399677514 -1.0834583241859954139 0.12083195800956834931 -0.49567274520701465335 -1.4576655312679913656 1.2248909535020313655 -0.25970240506976455253 0.11030893703320364396 0.79087850007050708445 -0.9949855525981429194 0.76768558739519365819 0.45915664627329366709 0.96831960216023948984 -1.6922895060529967726 -0.076572464827384112418 -0.11895349383933195853 0.93463509245119158475 -0.25517271681723213694 0.69389487780431502451 0.7267660201361143546 0.98337825872036854769 0.53673546090215618065 -0.22445136971882903576 -0.22072490814920159297 1.4590084417068833744 -1.066363983942648419;0.39089270510126195024 -0.11029167899585452794 -1.2060838196015843948 -0.58110952587723874174 0.088733820746470418173 0.17336720243207096037 0.1115374618462762063 -0.56390921934991977693 1.7639592447274445863 1.2672615978824450789 -0.046457952515350856015 0.57741480138582046422 0.82941869404101864482 0.0052119841436213502905 0.90665576014438131747 -0.25070758057569014765 0.42036133883709647652 -0.78447489424782712586 -0.53284621055853198524 0.3562438619948312124 -0.35505638464475020033 0.52712571421727882903 0.024559470114722328771 0.50752410284377735827 0.090148805540874829556 0.81595359918576226832 -0.26880507527956987168 -0.55683883702847114527 0.45143292634801668317 0.17687328470412119752;-0.016582041349861773721 -0.82806021121249884231 -1.3590988297265114149 1.2768294284118357762 0.55235464491624741701 0.71426537881748453085 -0.2850675565861517935 0.74033667556808924193 0.73707198585097843946 -1.4349529405124588077 0.25940567862428043355 0.84911133197446975185 -1.4491450923708135701 0.63813891639755426777 0.17048004070865171999 0.44342846766792076707 -0.38235242874591657269 -0.23704109966070777138 -0.075092776962037241506 0.11085872997694705411 1.0634798884714298239 -1.14448527614245954 0.44370998272685313601 0.19852433456890783425 -0.89836431262329929925 -0.72948637186935316734 -0.65505837964222413117 -1.3838441925684221712 -0.45281754527562378954 -0.4514641302830227354;0.23388003324922743142 -0.44773452354155196531 -0.44448352698721255161 -0.3413683603315884052 0.42221542348471285955 -1.1353344538264169561 0.44596606556179035907 -0.26547728799959902091 -0.6261760517717175345 0.1096630825195343828 -0.049152354112712459688 -0.74337328485758480401 -0.12320406484487111953 -1.0926552749309896839 0.41938443644664591403 -0.26369488695156229063 1.5754579983516976416 -0.50129576397299213664 -1.5486211511353118464 0.27730868395016405881 -0.43362940176323999664 0.55912099598153619517 0.79409746335397946027 0.36891932217748479861 0.2314795166894496603 -0.26484837681128997611 0.11577519204099540051 -1.1146797453182162307 -0.040829403382802609279 -0.42372140365770916137;-1.0844327548425931607 -1.1720972021203495128 2.2317652554205102966 -1.3805767482397390822 -0.10375848285825252371 2.4766068835311774166 -0.26924700709243726271 1.3031186445183386979 -0.48909867357164937829 1.0200285593602627099 0.069352110502009733928 0.026217909999992891623 -0.12416841250844642963 1.7549434345200194407 0.76161623335308814564 -0.53084639747885853378 -0.059661957159420977992 1.0313897154361497677 3.3899485155906567968 -0.51816202726365112596 -0.44465913181123145614 -0.33996974151749431714 -1.8711725885756258503 -0.9288805789246091793 1.0107609849591836504 1.4350564466600364 -0.29830639365552075182 -0.21921348864755335617 0.90778662866949133559 1.7830963050241011025;0.11052224082327370691 1.5445291384703689896 -1.8590832730988571253 0.94917185690367122941 -0.78464484989550109528 0.77659142433593686405 -0.58709928764543328761 0.20834060289129593957 0.17859425559800978789 -0.72509837521277620276 0.30677978183746362761 0.26521810048245569869 -0.88481283190950921203 -0.29082093769139577555 -0.38525387440955338736 0.16298719158990343514 -0.31024978256053592496 1.7643899881234621496 -0.38740151518078630444 -0.90392828551173998175 0.8455264249974826507 -0.66909695473790453679 0.11308391524074629109 -1.2613764376039511284 0.3135090382878408799 -0.16870284681281516592 0.010570086465009190246 -0.63647495490922989525 0.29813239627945070653 0.24452712321427375053;-1.6779815998136886623 -2.4147713572421807271 0.34211155553747191194 -1.3759823544295366471 -0.42433571847410050948 -1.8744297331657135963 -0.65052615930174750858 -1.0898153470879972105 -1.9786405445243526735 2.8247721716683664717 -0.12020369669267755297 0.67038352009268364906 1.7587614800653981195 -1.733598782776700542 1.622153751099104424 0.8759758715204966073 2.1159937081857957963 -0.13404610041570580448 -0.88914025585565514831 -1.5000601925887457888 1.0638574254770978289 1.2728920688559213215 1.31439164852574919 0.22516650384917930028 3.5321626321893710987 1.0033363232586585134 3.7518199502365465747 -0.30545106213582956523 0.21794736879666223861 1.0814975019963970482;0.50023820615924341482 0.056204053054711586301 -2.1182273763745529394 1.8629365738952314846 -0.42454904254336023328 0.20554800732435676847 0.28788652473001585808 0.46350079936858784579 -0.96215562814854460605 -0.74205212215804827736 0.69168233399626088964 -0.21342308655380531901 -1.005978300899768918 -0.51926114257330746593 0.3830320194108329801 -0.17506859340687197513 -1.4869495678165458585 0.80753230724719926581 -0.43883196174537336676 -1.1571258882605592877 -0.00085122625277360072782 -0.32336897300478267825 -0.46225007594598638283 0.29237814767533165661 0.27793365026029115405 0.20315738647277545303 -0.47213779016400070354 0.65119977254014693724 -1.0306487163746071989 -0.84646363993618189969];

% Layer 3
b3 = 2.5885826602296631016;
LW3_2 = [-0.3600377378983478649 1.0544014412211160092 1.7115507109770127236 -1.013010999751239094 -0.240250365049775233 -0.81243833568271106582 -0.28958738764162866852 -0.69771039197348705407 -2.7029530384254210063 0.52657449809944600894];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
