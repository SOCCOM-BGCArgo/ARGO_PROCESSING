function [Y,Xf,Af] = ESPER_silicate_16_Atl_4(X,~,~)
%ESPER_SILICATE_16_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:43.
% 
% [Y] = ESPER_silicate_16_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.4657044419880336239;-1.4371421597511500057;6.6479659978340590598;3.1260963370852032917;1.0947674783961414136;-0.81102208693557775732;-4.870385555263701427;4.8694915907950013789;0.45880788505424996426;-7.7058165241708831417;-3.223435214551077177;-0.5440026148858763122;-0.12436638793685482474;0.072035252553348888549;1.4306562512517184693;2.782095112465949871;-1.681110380104308355;11.408050231592946844;-1.3525507913702645713;0.96794757773044393101;2.4304004003462340577;12.616082199045036916;3.6488635365070449801;0.29531603052418603506;15.56593055825172911;5.2315858053540740258;-10.67738083638323765;0.2248250353935900836;-1.7817776257462758505;3.0201369949558389827];
IW1_1 = [-0.014260688401343427772 0.01399567626008775198 -0.54938385160070324353 -2.1029703263454671003 -0.31280047687531947753;0.76449291166934341124 1.0416478871254444272 -0.84106382440991511729 -1.997669147446507143 0.78332506013531799649;-0.5442329987327959584 1.2277673859904101317 3.689915990250780542 -3.0207386642700875257 -7.9869864388327167504;-0.51205220647075877505 -0.42563615166102930498 -3.3155258061681105453 -2.5614292395162903127 -1.2466917707971583162;-0.71317144761407003095 -0.2332758469807851287 0.065576968606341282109 -0.36816087528282670505 -0.1657393554888883791;0.34031128938319749055 -0.35369335822814829129 -2.1391877047356824271 -1.6708016511818395422 -0.50423027448590906907;1.5533013006560580926 -0.013117631272423921351 0.48806969049759479917 0.50174865444201233178 -3.2130815535945882466;-0.88680092897852180744 1.248528142376961636 -0.67273814608652182656 0.95231324879007239748 -6.4467039137074122479;1.4910975406088784467 -1.9069137285840702667 -0.42365719849485605764 1.7968793155889275504 -3.4829446300095758815;-0.41593396636384938336 -0.31684542927499576015 -3.3435064205624192013 2.7483161774132449651 10.046722716282546983;-1.0798640017235194843 1.3699253845429311127 1.995933391154905534 -4.1472287000648453414 5.9239521854549703761;-0.59731825295483120808 -0.50660138107598973178 2.0702297396872166857 1.8720084049187557529 -0.36888492395723443407;2.3059653701743707543 -2.6862004637733378765 1.2703582006440738983 3.9946179155677552508 0.49425556422519839606;1.2666172663819996735 0.7013242596740181245 -2.5490835640895483927 -2.0546224001920423419 0.71177309154696766225;-2.0782598695811982381 -0.059479192408945648352 -1.4677417441722564462 -0.43271611612736604613 -0.28371027037649615421;-3.9417438111178948468 4.5025478170149551005 4.4065993831944103576 0.93654430966825608085 3.1346449297521972177;-1.5296566340180006716 0.51424995146877006125 3.51650573681028078 -1.713444914763721405 7.7877553234467136178;8.7044662214638872655 0.43189502073322039166 -7.5250820042446457947 -1.8109153688600176935 -0.65140260718860920619;-2.8522736710398524096 -0.24215636233935863841 1.1872762820797391203 -1.4123661909722562413 -6.3453324302682307945;-0.35057748214708939205 -1.4988219845841475042 -0.22943685233747163066 1.0999034154071465341 -1.307503866761327016;-1.7164797849627813076 0.10024587056756312231 -0.99476499085506475684 0.32559494021844437306 -1.00213939582624878;0.14570861546581725943 -0.67438097724287848767 0.18540482707091965331 -0.82206018105947331609 -18.61260105085905181;4.4329730276934578015 4.0815840925487760771 1.2419447953095010817 2.6021823567783983755 -6.4616162715947789152;1.2383677136124768836 0.75890355782790763772 -1.4111903461305710383 1.1128713426415768328 1.6624579561432675234;6.6657744037200261644 4.4837992877762422594 -14.811156444552336708 -0.31223938129505135475 -0.41891067946479410011;5.7080258442483993164 3.4480990680038221541 3.9828524314167825793 -2.3742939868918626622 -8.5279129394637376294;0.64570309676904402707 2.6728509873473904612 4.1324847588384683306 -0.92863380698443687145 10.661607337912402116;0.88305738724378657345 0.80134273981173043122 -1.1310547191925481858 0.67417809421429819583 1.2897784202842335066;2.0137373263072095853 -0.96174623669699921269 0.093168617591789557042 2.4708821101257325559 2.4575693548873571714;-0.8671707215943771363 -3.5801093133370520682 2.5191360687043573563 3.0372130039648803645 -2.2820315889316988844];

% Layer 2
b2 = [1.0359455526269958359;1.949055577343864476;-1.3992836077723702637;-0.25245978925320700093;-1.9928487945619504096;-4.5802556690435549669;0.17035262991128072296;0.58306230853713603146;3.7780838738294679757;-0.34441445967101741443];
LW2_1 = [3.369275849733326389 -1.0187610629091778947 1.2829591333929561969 -1.06703855928049407 -0.12758368792668059455 0.18678354681469347409 -3.1496366015945285177 -0.026375612199688692333 2.0655428360625247564 0.49012255857149344962 0.16158874020568569918 -3.5918884660646712703 -1.0119775149020742155 -1.2561050298639657719 -0.87195050381533345529 1.3694957982977229438 1.7005329123530341651 -13.507811330280009798 -3.9308585251075487399 -1.4145040277914679994 4.4623262221019235341 -1.7750927843720922805 -0.19673791222063244377 -2.7481823131538285487 1.1266594456301597393 -0.011654965790129078254 -2.5512866537035039372 0.90808439172805577311 3.7934384108033185612 0.35794522069817269472;-5.1378585920540551513 0.61664443824463521793 1.8241418503967978815 4.4898791047304538182 -17.59194957642251822 0.34308117657026987457 -0.67282017331890309197 -2.9792653790777916534 -1.3934890255420249172 5.6319328008907154626 8.5571268840393823751 -0.33623861953618955356 0.75634437206917415342 -2.1174347047813415479 -3.765692167010642688 1.0214988107723568245 -0.87148127041869205556 0.95965286697541452021 -1.1624284041271755186 7.1167763626410325273 3.5937651709298501501 -1.4947550802072442355 -0.43237340233247817389 -10.822022709528004825 4.4715644797445914804 0.37822502353757031512 0.26289088151244960345 15.535360589708076873 0.20515759809281700066 0.98381951954020996354;2.6634450520887154035 0.20053557340009606214 1.8931254588712367326 -2.7641583704497589835 4.3615396388407798867 -3.0451866460002050552 1.1647500083699326989 3.108154282174950378 -0.3131786763572936283 -1.5596681390949080903 -1.7917077885488419398 -2.7260071620952053273 -1.3843676383286265263 -2.3553662171780116452 4.8878060915754062421 -1.4899532502603585193 -0.72122471601341919811 0.74719204416151996373 0.83074036465375378224 2.3829554961197754182 -6.7185564657344327699 1.4208553690352441201 1.1137589367904692228 -11.651279797989879228 1.7546019969810109362 -0.43174442515627264871 -2.0976836104661655824 13.440625359052372545 2.6067774427662411263 0.19052677589141378545;-0.22181538384500620875 4.5573985781646886295 -5.584084118164648558 0.66409091620046412086 -6.2912253206146511175 -3.539305328651047855 1.7695470119196317071 -1.0467439012845805024 0.38915223601610970938 -7.574894725080545399 1.4710109041808023811 2.2491658639719025459 2.4215120918578203479 -1.1465950961554898235 1.7484958653272166806 7.1352956227109070042 -0.63828372583022052744 -6.2278713322514533957 1.1297275930056525084 0.34602012968007994642 -0.063347498918591593764 -0.91990732833235588917 -0.9990399402962102382 -1.5076343002065524246 -0.23659230054766927642 -1.1061489645559754447 -0.5044446016166539426 1.1246590219959737844 -4.6953766284916067519 1.1406889382456375515;-0.3070096882953737838 3.2989571515023481396 3.2342748986953826495 0.69699682653462058379 10.263003504843100089 -3.1925377292250018968 3.9140106509315426564 0.34737580143517388098 3.8047064520525388787 4.6267719459323206621 2.2909227209593128194 2.609964032690169855 2.2576253308124596408 -3.0689415105843789178 0.4306195652401125229 3.072917380810897825 -2.6592536072103110101 0.48455565271628919799 -1.0011255912977565785 0.77891033840628154383 -7.7109553149986354015 -3.0165194184728552074 -1.2093618147063696089 2.90423147572059559 -6.638236182873498592 3.0462898794432877736 0.026170102306625073196 2.2939687454427502011 -3.8979906670237638444 -0.20204949533913049708;9.6914344851791796032 -7.7850349891537025115 1.5553725118600603139 5.6795885539208565973 -4.9560550045554352394 1.3055903442788154845 5.4445007420424156308 4.9571446446885021331 5.1052334031643358259 0.75579662799429070397 -0.55311731905917116414 4.8866739696399204007 0.22407310798807220098 2.3555385065851761617 4.1293303170349382469 2.969827850984002815 -0.015088995055039876314 -0.23044514833016688238 -4.0547052161727510367 -0.540611957425555123 -4.8428569727719885663 1.5348026473639804212 -0.14652024695635046392 -2.648738050436428626 2.1618666255791740838 0.49656939129169763714 -5.1881856116714075711 8.9750916630472339364 -0.177778376759164497 1.1211750301120766427;4.516706043645133839 -4.1109506852050765602 1.5985946523395804242 -0.3567225902712435337 -1.4297803576341683307 0.2579022552648825295 1.6132406231702949295 -1.5853438821014433913 4.9448030344990447915 1.9137153837045612903 0.86711524496553726848 1.1140396993186894026 1.7981052218425530587 0.88820797272893969865 -1.1270995098075329288 0.66443294822668474975 0.51614269323687611557 -2.6942180928150247787 -3.3060203771166247755 -3.0635218557571173292 1.9538725032533486026 0.54984363585447326717 1.0262004005872342738 -1.810735507858753035 0.8019692513350288321 -0.21251087541650168222 -0.81501846291639001851 2.3457920326251073817 -0.81662102219345145127 -1.1688020891257502321;0.51206683237560490785 -0.84773426368119553231 -1.5653934020790771786 -3.6005553655736419749 3.1595849587340123499 -0.80222927346453420938 -1.3493245845111971892 -4.3060367232346266064 6.1767225316692941917 1.0931750173450123231 3.3127449016603920384 -7.5437089733441959893 -1.5623976594371693505 -3.6786238671907165454 3.5200324664199285074 -0.54799134776331026586 2.2116211893272379463 -0.78628103548689709523 1.0564104890730647845 -5.1884400352666633083 -1.7930512042972930331 -0.55055420364513418807 -0.35655193477415381142 0.70552490966906322711 -5.1821278461746773658 0.22861880381151425401 -0.79942041958986576056 -1.6738988531366265633 -0.12509087343279803872 0.94077954494000981533;-2.1431402313937994997 1.3317353659992501314 -0.92689505120106752134 -2.808510057308228447 -0.66422334379038472374 -3.4364587816322522684 -1.5187318799005005143 -1.5971157897044310214 -0.56364200235125094807 -0.22695744763159253488 2.9951138850558418625 -6.9640715574167870727 0.35094675472219011292 -6.1633827258112061642 2.6622441806661862884 -2.1983214494744203193 -2.8950090898054279265 1.2696675556933276763 5.4842636587555650962 2.3049539414270161508 -6.790288315762143867 1.8835220354465063153 0.137442255693706189 2.4181584949957484199 1.827067052146079007 -0.034284800180800663327 2.5607118869687925944 0.71808683296590714029 -4.1271262420247474267 -0.32961126917767957778;0.62668858419946715799 -1.589329474616206106 -1.5064211933246740571 -0.43491433138605761766 -5.6534364238173244743 -0.078237793902105889909 2.1619333611101674286 2.2563387889727719582 2.1954441377765658849 0.024942356161559285643 -0.31946470288756284583 2.8403472796399160671 4.3930616934079029789 2.143962144619034671 0.63434088430833657224 0.3477298727804667422 0.58779826245767863302 -4.4815675030460209172 -1.4934552652621333468 -4.1351453581139328008 2.0054227235746173719 6.6087052038926161757 -0.011858089743597543392 2.4772686565945374326 1.7663941021484561578 0.044413118051159092281 0.045186374956460072239 -0.12714959233874162381 -2.1102694618152595396 0.21759612308823278459];

% Layer 3
b3 = -0.057234214718343230655;
LW3_2 = [-0.2440870759452978267 0.20219297481763501279 0.12311896566104983675 0.3401495724022225442 -0.053220669461252548271 0.048719510552260446301 -0.10088766829969524064 -0.094335369911684036071 -0.22831151679683203692 0.65607355566597658214];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0145232735458572;
y1_step1.xoffset = -0.52;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
