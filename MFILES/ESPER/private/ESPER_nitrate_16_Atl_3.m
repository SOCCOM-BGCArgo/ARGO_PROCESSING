function [Y,Xf,Af] = ESPER_nitrate_16_Atl_3(X,~,~)
%ESPER_NITRATE_16_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_16_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.4110191166888217396;3.0289165058170928191;3.2554157482333008211;-6.031870743651705169;2.5685327144646818986;-3.6197112941780926754;-5.8116575824705423159;-0.37226848141484131238;-2.4880470627256179306;1.370301240099864426;1.9782040506857621054;1.6793832419214216323;3.9941490050336034834;-1.7372852221068335599;2.593865788151339391;0.86995279611607911896;1.4681997729495728233;-1.1295650962129974992;0.32148520708527711376;-2.3616098897484358865;-3.7034471305545673125;1.7640993877056876382;-0.098829383059550524049;1.5839294864794617457;0.25672755126268398396];
IW1_1 = [-1.726995391424477555 2.0072270983684723511 -1.3580941541738678069 -0.99384155994697620518 0.86038494567012879788;-1.7150785709424081205 1.3783645043343975001 -0.60181950212117996113 -0.70678785491759277271 -2.0478418073754447448;-1.464302041636529772 2.182492778337308259 2.0973693534902442259 2.0432945285166566052 -0.84425757429758008232;-0.1021601406344442714 -0.098060532748700204864 -1.1509727395008311213 -6.912855309726002595 -0.83058957049342596601;-2.669599122804232838 2.759231881130912889 2.0947363802697203106 1.1516875760741904777 0.93738858942796632334;4.4362552596552076167 0.20539411248563446688 1.7121489955890225598 -0.086777317508976895 0.48085677168580787111;0.1783992411910316489 -0.47722323238096342468 0.44225119375689020407 0.16213175060148041218 8.3085229422840054525;2.2695684455552505021 -2.597569200824931368 -2.7635710203932841722 1.3193573721977778224 -5.698797010217247383;1.7163685007879829758 -0.65806362731784373565 -2.5743693846509012602 -1.0053215497337277817 3.5745681431547344786;0.27244261495592897449 -2.0763727707847072779 2.0409110973736486194 0.85819914309392553164 -5.839814287785482172;0.96705958737151231919 -0.054457450994434095093 4.309303499535428017 2.2818631890063478806 -2.3048013146506534099;1.7358028969479759596 -0.55956170615601086293 3.2063089716011026198 0.85980146219106334815 -0.50758873444631080751;-0.32216293920490762792 -0.74963726728312285452 -2.9325895544246920466 9.944667769601275964 6.1414911702691865614;-2.6314382908373055159 1.7052152344254318805 -1.981328559465318051 -0.65849427397832926978 3.8045511550525699107;-0.67023524259377853518 2.3711738945755049812 2.953138708112741373 -0.15295929457890239389 0.17250353179942867765;-1.8503867941920901785 -1.4301247434213038012 -2.648627531556559056 0.27878059408333899505 -1.5125848642269759114;1.1074976936310121367 1.1074558800412428461 1.7333988986320472137 3.4174074419040345596 3.3077249852082868387;-0.7527335205835290477 -1.3527420760542747669 1.0676808832344242273 1.0380218193187995546 0.89086018030249547461;0.48815687513931144137 -0.35895026844127236876 -2.1323771301619420804 1.1514055158734641804 -0.13114108250500602915;-3.1056916378876744389 0.020454659058182396436 -4.3112990820908567713 -0.43757617083185812445 1.0388892108732468156;-0.023820601559351121251 1.8378150076584045536 -2.2256740846389786448 -0.57593206136454955235 8.1190477746863276565;2.6153874432369126346 1.743907293204333353 0.58318431146792948372 -0.2316733014342822472 1.5385478737625168932;-1.1598987327115037882 -2.2787197861729135973 0.34119361013836058127 0.7899193070862773336 -2.1919322571631805197;0.23709832693451193819 1.7406353394091382825 -1.7242713394976345587 -0.5380030093439588379 -1.1571407346950628448;-1.6053486165982382428 -0.57484224348821655326 0.18860977767854408826 -0.16765008802718325831 -4.256073694166597754];

% Layer 2
b2 = [-1.7789131086684772942;-1.7266808634401211719;-0.38911154536733055798;-0.80150664014459471751;-0.38432290350366338227;0.66393198902943539874;-1.2824586626099208075;-0.61240221075149037233;-2.2720457384558363501;-0.72678167349156108656;-1.5052995851679549233;-0.087690964854057668054;2.0082885355729112042;-1.6052461691807651256;1.3746624171601600217];
LW2_1 = [0.43976988031210872965 0.22680010074450729363 -0.0074650649675770085201 -0.79505224275868280337 0.10990048144472085168 0.32341919382098871516 0.89067084164385412759 0.25850964228019684965 -0.24040998342139188737 0.60777925923037035005 0.0213636686224946519 -1.5864970940166351898 -0.47963046844287404724 0.23030634404137848015 0.26704728461146570728 0.097902036391375957258 -0.14230232041315352132 -0.47954255406133522444 -0.41817884252981735171 -0.69238474582032472071 -0.47323636303347027532 -0.10556256396035083867 -0.72460501312266722973 -0.86675422152791348207 -1.3797332780761142335;0.81481684455671288259 -1.1284463374170985439 0.95362308572816090191 -0.41317099302192117349 -1.0417756053562421403 0.44086212576106836858 1.7850661522001967096 0.058520794286169630638 3.0918842583335863772 -0.11554302342605096698 -0.77698904272724711451 -2.8300820785002143154 -0.094873261348187201691 0.18469501488333806005 -0.82703257157883702799 -0.29502895869046702471 -0.42525546602623981451 2.2582475760829443523 -1.0888686204099458088 -1.5505986324631877427 -0.26777123312548051226 -1.0919249122030407761 -0.14827901106447910484 0.7453870310641528274 -0.29119210999690819941;-0.49523897031721214601 0.15089422847346645185 -0.45338026164585754074 0.15431182601437593016 0.38222518042217468182 0.26690283162583228194 0.40076063399476741234 0.0058720648556382978173 -0.001464257444822144455 -0.75424888963950864618 0.3043046396843958612 -0.074227394726671752645 0.59139117847707534104 0.09822521154831678758 -0.57254595502452798605 -0.098695186897667278036 -0.024939616065341958795 0.097632722367037391709 -0.069983326015060340342 0.25470658073559204748 0.25652280566310808885 0.13702516245926402161 1.0930587404959792863 -0.025634252695316564474 1.125613247182268406;0.48574006110778045198 -0.59455445238024329235 -0.57065103639885461639 -1.4930900215751188309 -0.11911116511701186349 0.56234117891780110998 -0.67262939332306204143 -0.84526927740239188314 -0.13414406533551542777 1.7204515097224475362 -0.43546155908788497513 1.2930732694915882952 -0.27438980263760842648 0.38440541160782260022 -0.39057748145080389834 0.59295451476648963762 -0.63238240512145038608 -0.92506704424513608309 -0.92748205377302439523 0.66107055178950679952 -0.21565559192303845881 1.297809087064991207 -0.3830810436116017792 -0.78220876790288218494 1.0146654584963141765;0.39970941820090793994 -0.70518363503238634671 -0.2606328240782960215 -0.74501142291823918562 0.4982621015721139246 -0.20798635169982773729 0.54280105568072101185 0.56048640182745934624 0.20595015655349671602 1.429822895349755596 -0.10896985886364381202 0.49876681766677005703 0.067123272531725119983 0.92795416372226446899 0.55046527287529412042 -1.1873803614567977061 0.054531468672279065357 -0.54945529705922502295 1.5638885717663593145 0.17837347599845426727 2.3187917934352748617 0.64610102472323716061 0.7221046400261444953 -1.9476077696869391609 -0.016716136549644253217;-0.90374216547153485291 1.6963169239606741279 -0.43092586747485972509 0.27564047992732221282 -0.11367709829867500559 -0.077551171252752668095 0.46486232858002030088 -0.25236153866436483728 0.91371915331091990709 0.99422177084663954094 0.47181235123103099083 3.8370073656683891805 -0.2202159432730514399 0.10498997914028439238 -0.082876625322711672261 -0.53496386398989692612 -0.50646883500583605997 -1.1564171515266687962 0.38910421440970760498 2.1389559822665296096 0.42268118982353120039 0.24971858499162197242 -0.046225949391457167581 -0.7589876946241401745 1.1776622602091504355;0.27992056581607643873 0.24424579240253116441 -0.59937058633668949259 -0.50221047967015919333 1.0842242200858802637 0.046088452320947451146 1.2939621800983471811 0.2087896598546841731 -0.6224225039281772176 1.3327734895146257088 0.20880717666386933162 1.163757972738227231 -0.39639953837388824942 0.59905737486806864833 0.69449662928899802417 0.36589713936978013331 0.5332272964111470781 -1.7091974466354526996 1.7429830260067922243 0.48161588326254450854 -0.062472448793200144324 -1.277070591205198502 -1.0242107877806678751 -1.5306728501564859091 -1.9702655550955601171;-0.090548719411631561904 1.0083273943666652972 -0.34793804381257742442 -0.63084387948751186048 0.18590662680877326207 0.054941911103028109875 0.56732943112379397022 0.52274390626234967794 0.78379412270697967902 0.4197259196332233655 0.16031319576725616693 0.042799633223810355787 -0.69012360386852811267 -0.097192835836014984663 -0.060503561929146347509 -1.1526333332737901394 0.076699481111427075808 0.023044065736907939912 0.38759393474899972443 0.51800340239588060776 0.41356256265636015534 -0.66111809171014879194 -0.092147726527505538496 -0.96665809337752184316 -1.4787832279849386641;2.7024800872075016578 -3.1781123777159061561 0.97184453645355783902 -5.2062016055641526791 -1.9961677052981261493 0.69071653851867353957 -0.45864434477148696701 -1.2324853058299338748 -0.057898381592094164128 -0.06989387258549265014 -1.3969044358028117614 0.37810512239558657921 5.9150385328533170437 1.322948394298970376 1.847898401856456152 -2.7202918364165338261 -4.9728379258468491386 3.1379152434378783099 -2.9763824062319708119 -0.78646532812751746011 -0.0070638955865177724402 -1.1421707878891660393 -0.6741273099683615655 1.9812751020127596924 -4.3622997749391814182;1.6815213119191485536 0.79139207452253257369 1.6726359543088245019 -0.63109866932770586345 -1.2499480625957883895 -0.27461107945081814075 0.50168738772277432503 -0.019878170481126999913 0.79793582033462795433 1.1715369694930508615 -0.4209616615353660718 -0.98354676634046578343 0.57577752326807052352 0.2019791112621922291 0.62696591613802454823 0.72214116853825016662 1.6261775734244916514 1.1026762009947344012 1.2060741280844395895 -1.299509387238157565 1.3973172774619435632 0.63646010640584993467 0.29431454325854039533 0.39486441874615563208 1.2719156356777574501;-2.1803834521121379098 0.2270671564872652759 1.0570915880850464408 1.3315231891827596922 -0.93855369914231268069 0.050477400515191561681 0.97072099787352028599 0.19042128304371680469 -0.25384897262924932537 -1.0833603945538208269 -0.44655417978169814619 0.12910230635509425956 -0.54468075616161315544 0.74566036859636464218 0.037096032068969879425 -1.3209910913101274854 0.089763132149196955822 -0.60644727279053467495 -0.58090784809171103209 -0.75624284066449187769 1.8793780593872215778 1.8116495383100175154 1.7573730434418235458 -1.533113731737374863 1.2708380751245962337;-0.49331431617937948619 1.0645543410206590451 1.0348771731986809996 0.1002511867737427842 0.35601515265215133432 -0.67135649517898543515 1.3443959329629429078 0.5236470752195759859 1.1654200036206132651 0.049027993499110564257 0.94312455778319115307 -1.2333653191083506773 -0.16124681888821357223 0.28259622629860159382 -0.64761892491347872181 -0.53286379977856301871 0.57110645737231846564 -0.73870670199473698059 -1.0792161741702082089 0.80789258618192305583 0.76878477064689876297 -0.57170695827429063307 0.76571403047299968492 -0.97807943300198318948 0.70592408274033136006;-0.19643782348699020956 0.82124330470383732905 0.807969088206354491 -1.4160825316607317248 -0.042891925959794734158 0.68037410621927685295 0.27673157556449529126 -0.21643770789934807519 -1.7512862912075253252 -1.4940808944284895698 0.3581706889107327263 -0.32436557990703090981 -0.2864183893071938769 -0.78058974181938745041 -0.95943686263739624831 0.13754554032640067818 0.20706689441900011373 -0.64287767942168738688 -3.1667031144894108863 0.64909088887949839553 -0.82372480496768440972 1.1279310601158010208 0.86664859844839226 -0.66969563552209931956 -1.0750775898047812973;-0.46735604394844898479 2.4337552583672987794 -0.80251732278586607183 -3.2552912634905664113 -0.21068780734740452654 0.4423876036916258303 1.6425587588461831867 -1.4292451986634373551 0.88565615017934651299 0.59447804495496547883 0.69446884012828913324 -2.360963560779279824 0.40397472530651568068 0.45641459875366424681 -3.1762506326185495631 -0.7735098572597148836 -0.72555208435462903438 -0.04314539009624734911 -0.1261839100209219966 -1.5517445242388216986 -1.1173299629354245255 -0.27842133003619529141 -0.62503662598500930869 0.87007361969135688096 -1.44734544621954897;0.46830810853878240829 0.87323352431273137952 0.21821195127015907689 0.35620029405217962237 0.3109281436503990026 -0.017453186878972577756 -0.17814079553984421556 -0.5569116167111467508 -1.9085758096495442082 -0.71781264338052497287 0.6056643984309871831 2.312955689808831039 -0.093732587051050017535 -0.10870076293542138557 -0.97474623016081085591 -0.38228857715199177081 0.016426479487636216903 -0.081642884543443164369 0.0022920969733657156966 1.720565910520788222 -0.19575236062572645701 -0.1930488445474088377 0.30700820420894248119 -0.096904485569932169442 -0.56306802520531940015];

% Layer 3
b3 = 1.1524852944330357118;
LW3_2 = [2.1544524774482933793 -1.2293386268237038728 3.1271114885896671431 -0.90359982374357983304 0.62286318813543728456 1.1377686125171553311 -1.2048724297416015805 -0.86248807214121592235 0.52767958908896606118 0.43498765927320959257 -0.70275281266427103155 -0.8893998228588391175 0.78153869518105345549 -0.51851068608972716856 -1.8329746497814844997];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
