function [Y,Xf,Af] = ESPER_nitrate_11_Other_4(X,~,~)
%ESPER_NITRATE_11_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:36.
% 
% [Y] = ESPER_nitrate_11_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-138.904784718693;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0042772329208737;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.9338103099569829979;-11.462242823641007661;-0.46401900119598593619;-0.46040735557731393701;0.78702172633186073814;-5.3510755385357029468;-6.8792416164770928688;0.032694984573750453249;-0.76097444058459529082;-0.23875885881519384735;-1.5431779278304580405;1.1407534771893328429;-1.945933923544487687;1.9248854146154708022;-1.286448031892025945;1.4417606179531290422;1.898819407243041324;-1.2744364574760020936;0.10189507052408817989;1.874393408116266535;3.9069965408972882059;-2.1858596187047556469;1.5739777234430503139;-0.56129508675857930911;-0.49500077365297606713;-6.4567240013203290872;-0.035882126088707930189;-4.1830405892381961053;10.623988759333284904;0.13818819667973009091];
IW1_1 = [-0.54144088469678508524 0.157258914495884361 1.8141895723080554426 -0.92317146885587297866 -4.2716403706576375754 -0.46503828759673099258 -1.4544452934395208921;0.69355686288849882626 -0.60071814481535790176 0.98915830239747803976 0.71403233826699852305 -1.8761407378748942154 -0.48798265605480478646 -10.648773335773761062;-0.30924362225140350491 -0.24604623680827553134 1.6616944801569417667 -0.028799957409021279681 -1.2055366203146540283 -0.40674242369239871353 -1.7603541660347088449;-0.33023834762509418628 -0.18642139314097924685 1.4298757723141333198 -0.034320823948924099323 -2.2178845513175198256 -0.64112469983634134962 -1.1919980805986170047;-0.18148904339307983524 0.31084983188907705509 -0.58991237231057358503 1.1554877830525829285 -1.509825171138635902 1.5769971003334899429 0.010792987313098665464;0.63187980889571826459 0.095018369185673620669 -3.9376926297936298837 -1.2191025300530216047 4.8037271292765382213 -2.0903246960642407615 -0.82343803933722836685;-0.090113640026492816681 -0.18242619522069128402 0.12635173200302390883 -3.6224178911474620435 -1.0858323946161958506 0.20274364391856924961 -2.9648722017294462105;0.066944753552300062527 -0.3436460679782881722 -0.86185660465371038974 -0.70979205849961501951 3.6730172323393999179 -1.5553628142601718665 -0.91912075034553197828;-0.20748184567294691849 0.03956994342184309843 -0.4434746916544448081 0.0066515501035889195575 -1.3488783502419570137 -3.5010638431325529218 1.1889859130057662817;0.1626604590187070154 -0.27180475485757954468 -2.0686811034107246421 -0.056548168173575850959 0.46963547628578800053 -0.43687354798706301562 -0.094494077660424391496;-0.10492449432863631964 0.026314835590271465349 1.1241406917836846979 -0.033373536264831332732 0.27942300132651587408 0.90916996172739361626 -0.97430286689991840721;-0.099857665569549211582 0.31710150899701766702 2.086459030717914942 -0.051361875857640078291 6.5229754459481439355 -0.54831941119293881037 -0.55800857249308721819;-0.042304785370675841716 -0.41129184791383310849 -0.1653798304347330328 -0.55798093982326446572 2.9534874266221846639 -0.36823779646182380754 -0.96044178813607550271;-0.19643184929965598617 0.35461596678076318101 2.4381796994565112513 -0.97878035385477368813 9.0962852482811751287 -3.1456533131157935479 -1.2330864287486098529;-0.98502443502962755417 0.24474200782293226153 1.2794880445258534074 0.44685580982101491543 1.6679688024486027942 -1.2806679478594134025 -0.8555895842776983784;0.071197338281681427086 0.25988331430588235138 0.2453732454258291118 0.5268028690511540324 -0.065082411034400863836 0.074034077639637541068 1.1505058017949694182;0.052691499522137641431 0.17259308931221220562 0.4623960710585794387 -0.1761229452424388775 -1.7125541993821562503 -0.028436862189558341496 2.1191261088554869119;-0.953873988291319308 0.1174965449448715088 1.2706819341012045577 0.49334674943909401224 1.7106977209853095889 -0.67419275930262512198 -1.0712271876085026623;0.24655995144618686465 0.20933883191169358473 1.4424045920568591139 -0.29463031095670377812 -5.7313918808975712338 0.43397212388690664664 0.51373902785248792835;-0.17270541887479973209 -0.11107831810531676453 -1.896945583410990066 0.47719776916447742554 2.3992986091640435831 1.1384228154332549643 0.76114579070265131477;0.29051654332299470251 -0.14682576613169112667 -0.51341229332469506819 0.45185775580142556462 -0.48791601343901846999 -0.0033966101908642861752 2.8310664053960228337;-0.048965956353766007525 -0.32821877747199273978 -0.2692766667296582761 -0.39380765009815943412 2.1084798369018469266 -0.075232499618128112484 -1.48301374442167333;0.1247503893384718926 0.39562931919246818735 0.413005976577489331 0.83923144043461284092 0.54016775438629283101 0.57819524699968627424 1.1288921910298945761;-0.22377576168790364042 -0.025022134178179604447 0.9479517402475571286 -0.095648401983585512598 -1.0085277245277559643 -0.97354114192238538905 -1.0791315797985172598;0.035769651947124871116 -0.164933623109301708 -0.82929195808707878435 0.59079515910174629223 -6.9575425535410539979 2.2459566988370589513 0.66925163539658993894;-0.067936922371999469705 -0.25204289461515272386 -0.042269841258227858205 -3.3305544718688557815 -0.050727733248881835826 -0.052977234171189324652 -2.6728179970906560392;0.20199590993319027632 -0.38797176884755663062 -2.5373444343450279881 -0.038794357082794099501 3.6797517066411304931 -0.73896145620525222064 -0.36949952495656379625;-0.087549657366469454955 -0.36060047732084971051 -0.80087835590281075682 -1.8624634011262217737 -1.4456312595541662702 -1.3050132679765402699 -0.94626668426629789721;0.21621436247907482864 0.10199670550902928401 -0.27227341699117924012 5.6999364029627752615 0.4847904949781411954 -0.82071202396532383361 4.1655507808502534317;0.10400465871585584665 0.25150948612876383725 1.6403292006986978091 -0.080098944133333391249 -3.5476767995420241952 0.16590734572540299929 0.58769214629877430944];

% Layer 2
b2 = [-7.3682453573377193479;-4.9278329925164090497;7.4299703627227389191;-2.7534810772021161007;-13.776309003694658273;28.345324380760583693;-2.5780799946604466832;3.0098850429031194231;-3.0506829965525117387;-2.7954920100237128366];
LW2_1 = [-1.5716031783082407003 0.30801008048003164497 1.7701352196302462261 -2.3757236278217321868 -0.44893909150817123965 1.0760416526956035899 21.919419940564367266 -0.2735993320986361832 0.51955512962927385967 0.90492171819999134286 -2.3235057806289391991 1.5656586770632168193 0.87755493352242985861 -0.44213541349287988069 0.52743062026706788448 -11.109869629968459392 10.657066404231402501 0.31464270644337877236 -4.0107836211238439006 -0.41630222520196830116 -1.9577916693801906689 5.0432989817430948776 6.9104779187222575842 1.2150661182086381906 0.74770790836817002667 -9.1861589559943137573 2.1336855507825531753 -3.7819552491738503974 17.260063445101842206 6.8996460169556739217;-3.6619985056076731489 -3.7523579561543507488 2.4869936344410819018 -5.9271074801729959347 1.7306662488665902622 2.1989510449174258788 1.6777071694209269026 1.1530401555171760908 -1.4421913567844888426 9.3134753715871472224 1.3744991930133954039 4.8535649577634636387 1.6892151346549248991 -0.06587395308548602002 2.0254070463298727844 16.188396397407924354 3.247754684664109881 0.61135580870113948038 1.2882725919726687458 -0.11760761611577083552 2.5889680900227021176 8.7370632016790601426 -6.1463319191872702874 7.540569922827848437 2.6978989185804458373 -0.38711269849128637777 -5.9340534675336051862 2.6870742181667242043 4.6585551503912983051 -4.1776910730605996136;3.5342001502024111836 4.9725623098963671609 -9.9937771781332909171 14.153612801057459336 -5.4331223957593861584 1.2318699704052396005 -2.1207223366978076307 -2.1859681799484578235 -1.4682041603206603675 0.99772096741018045929 2.8816361853721641495 -0.83391040919799019893 -4.7526808759629570744 0.12596908462847306032 8.4914135466167373067 -5.0590299911933165333 0.43006046160799965561 -11.315160182880184436 -2.546099542165343621 6.4164628719954173164 -1.9067062604825320005 4.4325712736601481367 7.4478181352116799019 1.6089734630187351172 0.34518761099229733347 -3.897742427620088268 1.3823982334830253738 -1.9759518542071714542 -6.2149956920852815756 1.6984425330097641105;1.0433038290504264012 -0.85336971828746399638 -3.1437503260154460172 4.9823016693149266843 -1.1223428915631670222 -0.12514305185864116332 -2.9251690045972509324 -0.5747417497961069266 0.27291212134099757103 -0.45061204980978003531 0.1258363191870666975 -0.57401419637196493539 4.0588332836296965311 -0.40153007241353044776 1.9659323253465108561 -7.5846538677328245726 -2.7705400061225753383 -1.8649452340325722854 -0.62953737848253654708 1.5562679431616739389 2.8236078590084678908 -9.9902204604045738989 4.2818132376577580089 -2.0912569622963190774 -0.28034028521375287113 4.9910258764256738573 0.29964505237126753956 -2.4555198010724095248 -0.23125700056460235521 1.0434949347145949794;-1.0135383247475058255 -1.0532185881359699131 1.0689349627251916175 -0.55554234932136437042 0.18482723209170798251 1.8619595113723133029 0.96206545360374917664 -0.57976756268800166971 -0.1305091095563809811 -4.5463164425769155841 1.6497069045200702941 -1.7065339616592385408 -8.6932784072984539137 1.0784266037048357845 1.9869298391433360962 -4.2090853965168015804 0.57090669473620436758 -0.59457854150768363333 -2.305945351438452029 0.3749736349556057613 7.460492654731039508 -11.726491840122296395 -0.32598730063857245254 -2.3696670335825458231 -1.6934799599878480603 6.2867818461021141019 5.8152547112649601857 -0.092443279732054323139 -1.4547989822319815634 5.2760264535343548431;14.398213398294235077 -13.494061582466800431 -3.8542434379624554985 37.523141144154649851 -20.328708243363884378 0.94137947443913250201 -18.525100830859688728 11.337597434902875193 -12.744437212129685832 -12.521135182265835439 -16.929605459095746767 -6.9319245841844461253 -11.580218255991159282 -3.6339403622421793116 10.57162674075733122 6.4938539489573035013 -30.716433487941205982 1.5861181001793263068 -2.1782126653946072281 -0.46524902681151725226 2.2711082051952544703 -8.3755120611227802385 23.338900851821790638 -10.251283185833697686 19.657763493997826743 22.685553336347162201 -7.8340914254325415556 -13.89548008172836191 -34.163741411767631462 -7.1003987972955879826;-0.055605980458562548341 -4.3634146877859372182 -0.55257144176615524689 -0.96138952365609431361 2.0710025211726628136 1.5491208704174490585 -3.520671714672364061 -0.85495843991388187355 -1.2714599618621127419 -3.2258129853375532292 3.0824129484415312419 -1.076061914887036286 -6.4762606313152097925 -0.062420360407094817312 -2.3847916624780061134 -0.6288478686463266909 9.4291774797400496055 0.43374189897265746918 -3.0642505911944888375 2.5673085094302670051 -4.929967247614777115 13.388148429186811583 -1.722800099534123941 3.8596961646561616099 -1.9771563152697477772 1.3073225992895571856 3.0581033996632585037 3.1160338485726728486 4.619873661073362392 4.8262317578954343489;-0.27696039837181463117 -5.3178540786857810829 -5.1460391166418570918 5.9038437272741930428 -0.20059762372167191935 1.8217660234020129906 6.0563851807340203237 4.2068341335329959563 -2.1371388625253509019 -2.6170832419828555793 1.1226508858971007143 -0.51496311621759005561 -0.20164302751545826187 0.81415152589796124794 8.7059810573466460681 -2.6390412201089925581 -1.4581252001591562539 -8.4343490842237311966 -2.54216587657353843 0.022829259546061186903 3.2683643318603663452 4.1583091077723119966 4.5146431673362172887 -0.46044964375248814692 0.8454731524435196155 -18.821485577009106294 -1.756390830581934015 7.94874937250836755 -11.872117223327355973 0.53345912813753848525;1.2857094694643211863 2.1600437533910512578 -5.2366548190232924398 8.7967945551957722472 1.7618920365307271236 -3.3059034251796499682 1.1208282257343007426 -0.10052549152545185718 -0.99331176891369132864 4.665239008409315602 -0.03833753622515970183 -1.0022489428659124844 -1.0069543161991312274 0.25161306648629483407 -2.8571655246683991258 3.0073615187102467061 -9.5543864751390970014 2.0210810158816294724 1.3350946901337550354 0.045007061577987991785 3.6606948986119296485 -1.8296585997278478342 -2.6283243446455841763 -4.2689121205048516927 -3.1744979029753315203 7.2244135273152005894 -5.7118020035963255054 -1.0051703786132748508 10.611908737026331195 -2.8562982749395180448;-0.2788841716548954297 -7.8505188662811722367 -4.1810104632390787671 4.8580377269926193762 3.2488155013394353077 5.9065584091554557133 10.708716525203298531 5.5100615287515521956 -0.54551819608183294008 -4.2079658701743616334 -2.1528247002790892317 -0.88423834217476782182 2.3534131862044680439 -0.84486087737487958194 -7.9041853101521617475 9.5556456104490958836 -0.29914195511281183038 6.4802270124917926708 -0.35996522666801344936 -2.5236803602200770236 -3.4810829862676997415 0.49975585562080843127 -2.8642790992432201058 -4.3896978302870621746 1.4288824394331480772 -5.7638295106024974856 10.301742581094039508 -4.3832237098427775379 6.7237618208708926915 7.707580824235733985];

% Layer 3
b3 = -0.11949688703401718792;
LW3_2 = [-0.28060170724776850593 -0.096962198017148740203 -0.083659719956729092227 0.64700548646295974464 0.07126871212407265288 -0.010791839579967271376 0.12958854601864236433 -0.11443487364899118663 -0.11472046249654291317 0.080908972534915427066];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
