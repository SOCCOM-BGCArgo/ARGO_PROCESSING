function [Y,Xf,Af] = ESPER_tco2_8_Atl_4(X,~,~)
%ESPER_TCO2_8_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:56.
% 
% [Y] = ESPER_tco2_8_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566];
x1_step1.ymin = -1;

% Layer 1
b1 = [6.1295530242803276;9.6729730155478659;5.3450560337460491;10.381229181341928;6.631999475680443;-8.6266386790722276;-16.438088816485863;12.533885957757295;-3.2179384033714662;3.3897335123255239;-7.4255481065758682;0.018794974315448208;5.5382002210033781;-0.75563113455253517;-8.3513627623018518;-1.1472726259209538;-4.3951724783354482;-5.9726095627926732;-1.4788403538318646;-7.992470104892214;-10.298362177821202;20.185122213465597;-0.40701972116686796;-4.6495276304543314;12.574400608518747;-15.319608351439639;16.286460923884871;2.8937624894450269;-7.8335500550746504;-18.436337443265629];
IW1_1 = [-0.53800939131551873 0.17626408786519776 -1.0418933097964609 -0.4814158039866766 -6.7336334445375767 -0.24593193199483551;-14.378301012855813 16.421271828181958 14.858391203555554 1.6290028242700278 6.5112072336476654 -1.6734983862561141;-1.5879100865130553 1.3691667135554859 0.12105472956452348 0.86347321198566329 -4.5424928064450141 1.7890880640408644;2.282070387486598 -3.8214518601264609 -0.11401074014209431 3.1563429500481699 -13.501805001535709 1.2607017968935037;-0.18360398170978126 3.18755916934367 -3.8260216472889419 1.4733439579219147 -3.3180829055251042 1.1467752834092482;5.7407007345755448 -9.08361964495462 12.064893401182585 2.2080437499173056 1.1979761612793121 2.7276802411333634;4.930227612380695 5.3704532857645084 4.0047289785547848 2.7008892429937945 22.067918987038972 -0.65992885121998768;-0.065059851835695806 0.79330478526471326 -0.68104255229700217 15.998138698427756 6.4538677295893034 -0.3346491699233563;-0.21835080951881819 -3.4563036859562577 4.2107256751510258 0.15020167910993637 1.7334195352483168 -1.2134165871482405;-0.83292206869560081 0.80156568452767307 -0.29459045019221869 0.32119902433122699 -3.7641923782025657 1.2696611700982192;-1.6225882609016946 0.71875695024979214 -1.3726617050061205 0.029158961532804509 4.8813495114628891 -5.3960751979760335;-1.113627710806613 0.37780401959768911 -0.50258245308609328 0.38339001375453918 2.4034308495977039 1.3867128992979041;0.94078543293385619 1.973406379369 1.6513701081426497 0.34637289114346609 -10.062469162321333 0.50112917780322841;0.53038167278835835 -2.5210861214647706 4.3041797585880976 1.1827020843692297 -0.80629575831209432 0.61898317034597017;-4.1157268777100926 3.6215920579619021 -1.7560456532870445 7.8374937620957796 21.91640876765139 7.0474149623500431;1.2153659700923156 1.2325277981436844 -0.73075524541994474 0.25019895149859178 5.4489953443346479 -1.0500768236304789;0.1783783714024266 -0.24854340393508645 1.8775369593333191 4.9403385308240884 11.217287806501279 -0.38575208358323781;-0.66019068171603701 1.7853961022956477 -2.7005228040899394 5.779120369696785 13.032802627450291 -4.2495665028757132;0.80913933975802665 -2.0088102345312038 1.1998848860141276 -3.650054678472193 -0.36857017919164908 4.2772825003376358;1.982771799964844 -3.2917820606720505 -2.9887967621417073 0.79013012335825727 8.6004455153828498 -8.3428898358342867;0.75272816703226697 0.71299266671616113 0.71586672487821235 -0.73109527070124847 12.857611831984721 -2.9623451278307877;-1.456434280790615 5.9935539079973736 -1.0561628431563255 2.564780550870795 -15.624029481888714 3.8660351602317773;-0.055044755774508958 0.89856011545346393 1.068221416106276 -1.5277865978393401 8.3312200899116018 5.9730443173152796;0.99925494876855314 -2.9242729363035433 1.7259587086173414 -1.6596544133220803 -2.4128621902734575 -2.6790625701267681;-0.10632232541408121 2.2894405096483896 -2.6603814518416056 5.1812890772631732 -7.026801714175372 1.8415615504748024;-2.242682543808979 2.1917738669773619 1.0593821985574587 -0.46779054308290463 21.997738522994165 -7.0723691107477933;-18.011175340859165 -2.4796252391963809 7.7806174934921994 5.8111172851827284 7.3291330365616023 1.3941832225270665;-1.8779017785359167 3.0058273187035027 2.7887255701773044 -1.1084269107407667 -1.8978784899250638 3.0825812809801869;5.4036409058331145 2.2065386708286545 1.2169727249085032 -1.0210373537443418 16.946603308540894 -2.7033568147383509;-0.29385437279529469 -0.86914323998337728 2.0226836598629165 -1.2899660757780791 16.077080128206994 -4.3138227219437857];

% Layer 2
b2 = [-22.216678380612212;-60.717500640949524;-24.605769653537539;16.887315848361663;46.143858375503093;-21.962720212317315;15.791962086127965;-15.068363173511752;-6.15176969201916;41.672751834064748];
LW2_1 = [-20.73985371196974 -7.6646565244910683 -35.18733442321151 -4.1552686424549625 -66.426663552126342 -23.825409182893278 3.1111810361138095 -42.482446704540656 -27.485816854009489 -24.092741086294517 17.967169429731491 30.796975881878168 14.121293957077109 -10.130058388526345 28.264337593432444 -6.3958561257386801 21.652109141394973 -8.4594198465966155 -32.620011615356013 33.635738168832042 -12.038707033989214 2.4902601359344567 32.857363809795956 -5.1726130519021201 -27.721353800643762 11.691382647691739 0.89881776497742505 -27.645898589240844 -22.416854194580218 -36.143656917007306;7.5926959678916299 -4.1581374686056574 -3.0722834536806047 3.0646008382289986 -7.642125347781203 -6.7079688477925767 7.8300669917642329 -12.061999709115739 19.244992974540953 -11.026931204795471 6.6273270700425995 7.7808434204220047 1.0688720815600918 0.87885130843043957 12.758583240619741 4.4508450081770379 -1.0018136445693773 7.4176460030465803 0.26418465701410393 -76.332860197879256 -0.77358853167498265 -3.553121862367929 -1.125776525670374 -7.3056173483518938 6.0720048848504407 6.6882126514843012 -3.8627223848356502 -14.393283618955888 -6.6053239108881971 -3.4228176534592856;63.649465164212117 -0.80970542043110505 -8.4178532058434747 1.3013547821913762 3.2280968056055097 11.545287515122336 17.517554472472813 -14.629406185199864 -28.172755793323777 27.089307446904751 32.066724263297104 -7.7068196582294481 11.594192331670582 11.503672112398377 -4.1578280766185811 28.96120039523132 -9.9653813955632859 13.621171504423508 8.0306423458146998 -24.078707122766978 -17.894771238183296 43.111497949308827 8.7714370260197629 1.3745247787765673 -12.30183235356653 0.65549698180481775 -16.386520714006583 -4.1840805898929618 -10.751831899095114 31.358899249391328;-0.14811369054374879 0.027192223914417165 1.886663652098965 0.014962243360500997 0.037491564235006339 -0.30328194562193406 -0.045924592198698343 0.44466504961667069 -0.093381638047716833 -2.7186617287013628 0.57541557298548396 -0.066663172010138161 0.296679931544787 0.79464465545196727 -0.018309860242448031 0.42834141515703 -0.38379359678420749 0.1115444189446777 0.27615788410316072 -0.042287535038619262 0.48939315675172063 -0.082077964362905001 -0.14274649865045758 -0.3093984644844146 0.10651363072572211 0.04458022354274583 0.01717234670558207 -0.24396930283242882 -0.86527094769304935 16.341016830012286;40.771288223137262 -8.2924724275701074 -7.5906605294413065 4.0190803466250875 -3.5986881078247208 8.569405457119764 12.92677468307534 -11.378943858277809 -5.1393578213182964 1.9763763541391908 41.483659240439536 -0.30606832634557934 -9.9678599528570135 -9.2159801832873463 9.6668517301551926 5.9614987483469548 11.338167952792425 9.486101131621254 7.6406947788008681 0.14163172263467 -25.82578002462138 -17.932821410271018 6.1266364528916197 -8.7700436038039538 -11.80480218787976 5.8458801580870965 -5.2318432241088564 -7.6044644475207051 -8.5984192033497315 23.241087176510877;-2.1371482152399972 2.1469239017947537 -0.94572689027910728 -19.399935816646128 16.149519144511569 -6.1937242754530306 -6.2552838025461535 1.3912867334306849 -2.4696987784167961 36.384864678311956 18.343485645819378 -3.9296632597310683 -20.298180883933576 20.817386204535232 -2.0355025020495363 11.572887993954049 -5.582638968721783 6.3679217107295951 23.558488771317879 -15.622389065759302 12.425588857233189 -25.86532055182019 -6.124987957402201 -26.906722414120456 11.007900220973095 12.879975759385353 -1.8621605821708132 -4.4977859818304022 20.336780405544715 -19.513193758809429;-0.47252708024741313 -0.44225203250682621 2.1009006240544958 0.14665326611409196 -0.23343314529895928 -0.18700021376656964 0.031607079162735884 0.69811054616855595 0.79849396752471902 1.1633432472133931 -1.6928925085966473 1.3595407379830853 0.60049687579302891 0.31322504553273878 12.902857078692158 2.6016934060992747 0.050752904729752378 0.54891541489181439 0.31012389458773382 0.805643675919402 0.24252915120962759 0.098902553221304493 -1.1467033749726243 -0.24077534512600227 -0.48934899725299963 -0.29770793507328208 -0.077335701196453346 -0.53030810892257885 0.16517125804650692 1.3402974720994749;-13.328779979252349 -9.1659106204752323 0.88570971130609122 5.0991017890205557 1.9928923220114849 -21.630187022577115 12.736186421048593 -55.560717855982084 7.7869485994115371 21.314968105556616 -9.0935782742360196 3.6091268321463068 7.5793053760354372 -2.3596153561066893 -7.2118598415088622 23.941929612164426 3.2387461467131988 0.50835372955825298 33.112078302376958 6.5385760245828912 -3.0471275961564177 -10.094057305342407 -5.4599947666134989 0.088281574154884079 -16.290787459264198 -2.4951547629478656 -18.302724695357821 18.180276486234273 -1.8528268026989512 5.2995388160654873;1.3223952370766072 -0.0011836440369355169 0.94358462792833564 0.83598346817802505 -0.51097606549710572 -0.31236190186521734 -0.065782430630100891 -0.32919428730304678 0.60031040641928479 -0.085478445286317969 -1.1195970941241704 1.2628173166483985 1.0560067906127859 0.44988478713774593 -0.055281247878765268 3.8507475312394281 -0.074084325282947158 0.26007363531747468 0.12620309035977617 -0.027387516575905178 1.6042506390758993 0.35174410044025856 -0.49269980081386067 0.69095726133864255 0.0058903735315613938 -0.29765657098676301 4.7547771833653902 0.45029660814568401 -2.1432970512018259 0.7898685058099939;26.890606407809777 44.191861609310273 -59.187072106918656 -23.552973954652064 91.506035257243454 4.3205175491200345 4.7997184729123319 8.5333584340729356 99.176035677600481 -39.696766024028712 86.323548374961646 -7.9764570120881819 -49.393140709158821 -24.613683462744451 -42.449359147685037 -18.538227092564668 21.64145076297665 -5.4154489322837351 -20.853478989927808 18.867198570919498 22.228387989469581 -0.77336805208235104 -3.0956360441783577 16.681764314318162 0.77539741978634713 29.467217589710735 22.596694823247038 24.987365399664569 31.312225983762829 -13.651937405659528];

% Layer 3
b3 = -0.67108635520918369;
LW3_2 = [0.0026100783264410114 0.0063083802798577287 -0.0041495716430100934 0.18293698967776753 -0.0045122007566173539 0.0035116834239295597 1.2610796507657935 -0.023126423573620852 -0.1023409461322477 0.0066445076460531112];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
