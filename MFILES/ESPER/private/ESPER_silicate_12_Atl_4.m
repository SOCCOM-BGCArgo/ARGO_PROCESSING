function [Y,Xf,Af] = ESPER_silicate_12_Atl_4(X,~,~)
%ESPER_SILICATE_12_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:42.
% 
% [Y] = ESPER_silicate_12_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.28];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0470499670650231];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.2668482918111747537;7.0805919236067378364;5.3874971345191129402;-1.2596033755909961105;-1.3699414328173262767;-3.1768798513854590304;-2.9182318347924511848;-4.3955352625021912871;-30.12959997129926748;-2.7414447666085690614;-2.0464592940962376133;3.5030779392730075905;-0.83365805667654846456;0.40933675598652485839;3.4521586138464450677;6.4861990686343524715;-3.4379733092162307884;7.5508739403971638637;15.348712583916157115;1.9491076253954116027;5.3864220731388661179;-3.7061423103734409956;-9.7047476032162780513;-0.2682731960404566296;-2.2501428070249787083;2.4860518464532765925;-9.3719169583901571485;-2.2820714121499237059;2.815556921222710951;-2.6898061341173962191];
IW1_1 = [0.25893125948237216694 0.17565435532754594683 0.11183432393408206107 0.77122555596058184335 4.366481354027787809 -0.51297170880951326044;-2.0024687737223056949 1.3924034591358416257 0.35564457108830921372 3.0965791827406259351 -4.5279118288567907769 -2.0167678465241967167;1.5198482240987418734 -0.11573888768251962278 2.4956293652148393569 -0.96103059407180579932 -9.7416134601436539242 2.7445030802242542656;-0.81510563164528526681 0.77500496739209367991 -5.3374107358874836038 -0.48564844269619805717 4.8371343660375085705 -1.7740836027850814816;0.54959022691884718004 0.97587522647621938177 0.62257333006871562464 -0.31473579231235321307 1.6815918320904519323 -0.11088816918006133561;0.14009591426765444222 0.035547302514040125809 0.12037549359864833931 0.30651984267162579734 4.5564659315028519515 -0.27521714879762382289;-0.64640380453166501606 0.19337600333093465932 0.16948240533429409505 0.67453325004732178627 4.2875340736856850654 -1.0758429328176575268;-0.85571893879194538268 0.69094563003546194402 -0.4807473607141293237 0.99548444838490657283 9.9090973955791135097 1.8041385608718845113;0.31410143752808178386 -16.927704793742311296 9.0101285751597686158 -11.413167226174447677 33.744645679337573085 -8.7456809841886666845;-0.21958458980935732785 0.10527050603122277417 0.41294764130139360869 0.69760710159303640499 3.425939173917606162 -1.1228629593537957643;0.83128901841359670311 -0.80484975325050078787 0.28928362688628683763 -1.760360768887793359 1.4540454971378622417 2.6734138040295643002;1.1094799650454618689 -1.1847134622500319345 0.81491872556475297706 -0.10800781276542685549 -7.7247231790580350719 -0.057639497289909351341;-0.99487359082974946567 1.0559219072112873139 -0.53566085516499817309 1.8103004399279805092 2.9462306210355513336 -2.5249901929839748682;-2.2279682108897800319 -0.24726515395617346127 -1.5526650709458993393 1.195000557134499708 1.0944684047459660725 -2.0871295640693405815;2.2703352720336682502 1.3405482645436823663 -3.0852810061748510151 1.326720181049509506 -3.2044681740525611247 -1.1699618428445923701;1.3251946173737874091 -0.31235149551414648217 -3.1126993756114131884 2.7812249801318702502 -6.1317933080255011546 2.5934215773949702566;-1.7246928914357260165 0.48985818040729495193 -1.9739469773025388744 0.96859497044114806208 7.4101869944184759476 -2.0839410545136201058;-0.77401550917367456517 0.67202231559514535864 -0.48769063484645547302 2.0486054127635191513 -8.241112422353651823 -1.0910750151769987859;10.133421460373627454 -2.5281025291909289265 18.898226612873841646 7.3684986039882005571 -4.1250142294042104751 -2.4359979409646048687;2.3514018179944455866 1.3524632618719838462 -3.5964944042356652432 0.39159238708628735237 3.7274900534660915241 0.0015109911757703441831;-3.7912526778504584968 2.3687685811897285504 -2.5841951152548672255 -5.1219294833613631113 -3.5608486425162992894 0.31563177253645008369;0.58099907313309318013 -0.17513921856879707817 0.371974592067186971 -0.29677729140785619188 4.9328208968941353874 -0.063158542610421447572;-8.9798368499724219305 -1.1150031823002439779 -5.3719219535059901105 6.5151975655202294391 -7.0134365312494244549 -2.7102336493130483319;-2.1432792811286014434 -1.2399463232249188227 3.4988356808159943867 -0.34404140377787517657 -5.2903545141877108549 1.0015400038823172313;0.71193988365212768077 -1.0909890541621607429 -2.2206552835109003574 -3.8849481879068537005 -2.5392317209744290629 -0.30559524884509564613;-0.58928791706753447244 -0.3484768688922301183 -2.2238461774394346904 -2.9704857015289358735 -3.1450825209679527106 1.8162655886266709793;0.25693838254945039479 -0.16124195844144570411 0.73910467277932034857 -0.72602350509089874642 2.2503362964484527886 -6.3649799543032310467;0.25690067883809614147 0.24970039530611767842 -0.022563896243798238495 1.2595080583627784598 4.989517934048844694 -0.44865945182580452277;1.4660161292082158901 2.3985885207866655122 -0.32076514090745456009 -0.040558251808673943806 -3.5519272836936264248 -0.86631125480884374479;0.22381239746805170476 -1.5695597133001266688 -0.032704996457401824816 1.2216261261171041941 4.2611378231706886766 -0.94716640553542830183];

% Layer 2
b2 = [2.8087674363114696341;15.520385055817303765;27.876678277361797598;-2.2779696160101283731;9.3158109632592012161;-18.261950713547381753;-8.6754865000448724288;-4.518054229486078377;8.6330618356295847349;14.997608651031402616];
LW2_1 = [-11.364990462795702797 8.7627643864651858507 -6.9385220793161597186 -2.8109285650390694045 -4.0293816276489726746 9.9818166439293882775 6.5526187382295137951 0.50855543261847069303 26.524717411031332404 8.3906148271090543744 -3.1111880427092786228 -6.4164926841086566967 -10.385788739615389176 10.364421648857318203 1.8041385059897081522 1.1820143858827960592 1.4643655954925471896 -3.6991975067501599028 -3.413429129074745827 -1.117860737411239036 5.1947109297507880754 5.9465685718050833586 -5.5678042305707293735 3.1465295222847315948 -8.4351371016902518818 2.8676199763726213376 -2.0968143661922384879 6.4968380558932707913 -0.90794548679814690573 -1.5829943405865318784;0.0323397469592871592 -1.8188146339651161121 -3.5387812853743807473 -0.27378124307220808031 -1.2647547788056825446 7.976195714866273434 5.1745511504211751941 -6.0765239139924203116 -0.0058411610061312934858 -6.2725532804278936183 4.9737562349376416293 -4.033765822314139271 4.4473245785447872436 1.0604333167508417368 0.12983996968064287492 -2.0508775011176103575 -6.1729256474626232887 4.6121587336827971626 -0.047094948259871337315 0.42518634451112730099 -0.033488849763552708261 5.2818185695783581579 -2.2070224061182055486 3.2175822105726403777 -0.53671117125191525332 -0.48436697051377641809 6.1357571543443407691 -5.823697451206927056 -0.45674208997259180265 -0.86942859340612965724;-5.4640892925882473818 -3.0814211138804457057 13.524972789300498732 1.4487517033680090695 -9.0796671180104286947 7.7743500302510399891 1.0486836565980564018 -14.600829888935846768 54.555109350908921328 0.41013497861958259083 -3.2743061076052288882 -13.201545079959251083 -4.0582216819672281005 7.1151712596644172137 1.3375761738052605043 -2.7488085826326771333 5.2338567845984629301 2.2701706383942852341 4.7048111210589436126 2.7323406167754771268 1.984937385969251844 10.654696227720858559 -24.49143545101095043 1.2291030847249599933 -5.3860815338898033744 6.6112877364638187316 2.8415972495456416347 8.0792001319127049186 -3.4061053749752239206 1.34936929446145637;4.1076291671429849828 -0.19783296501423744407 -0.34933297046092554039 0.088842223381751045386 0.66372559949365095289 -6.3983522276284592323 3.4193321318381229013 0.097650209726649367381 0.023444007320724755128 -4.0124390213352754131 -0.17963896744074928091 -0.17194161687412917727 -0.593679211202568613 0.072862951738307535354 -0.12569717599151036813 0.059371804172675485267 -0.54110287040019577898 0.0040654517596613575642 0.067017932619597167521 2.1151922961792828382 0.11364449641312601713 1.3738278683026856619 0.763364505436836982 2.3854742822310863737 -0.14162952015766466785 -0.36610662466666082926 -1.6979860568930018605 0.74843827064893175827 -0.23423775439465496784 0.36028895032477853411;10.020999101247237917 -2.0477557306630727041 1.1223381658884070688 -1.0539883097256623756 1.3208079701385107008 3.417433936756578472 -0.13873585275083863411 -0.20702672223310916721 23.653674164587016548 8.649855477014721572 -4.7439576376474583697 7.7845817702040198682 -5.0001158472534159571 7.754226208957122779 -0.023782276914297344195 2.1933228674441491712 2.0391420589806195096 0.17933840524645627834 5.2487793398132414069 -11.318115657790865924 -7.4000036880466684153 11.521798539567484454 -8.7302018429387207021 -16.446723216341055718 7.8981964356427543095 -0.043315848381218269303 3.5699445640322231554 -15.159131526644959109 11.25155408692616632 -8.1840044626783310378;5.0051628346668683989 1.1038611446228872026 -4.0163908602671423154 8.5901706501253229931 -0.89339484884294129152 -7.9357842588207594403 13.913286576640189196 8.4687303789761063655 -50.978736945794494773 6.9410665533564346319 -2.7393878994890581424 -0.70903135102021508374 -3.150506503451966811 -4.9968999961605113924 -4.8071642429435446076 2.1534338553305918396 1.0603928826719422052 -14.581550102019097181 1.7022409013468959849 0.86038803844456634984 -9.0074283496207705468 -2.4183773300259754357 18.712078988974113258 8.4414848604945689203 -2.3073155231400921394 4.1265196716346581596 5.8344646687831644982 6.307900685405901875 7.2940241895417869955 0.90616971053091865951;-26.596249671759618849 2.5892057743251570834 -11.558877437308380465 0.14271886811092795999 6.8970821745582728823 -10.302352230600710925 13.635503821577765748 9.2415001106163785494 -25.400670595470597135 19.013181275302525108 1.0985688039676329009 1.2085977478052964962 -16.548620978879622356 14.328606435669607677 -2.7139083335651457141 -4.7940714778581918765 -9.098087297607651891 0.84527524489690220033 -1.0433121496483921398 -1.93510128275294635 -0.7576175111724198219 -4.7005699312364797038 8.1262202712166082819 -0.2892972514044707677 5.8684377805615195456 0.44408212912191785682 -2.5248575845771630277 -17.435001582071478765 -0.85809999534421443901 6.4607636223915321239;-8.2936920273699303863 8.3954598348163163024 -3.259359840036986089 1.9395119067766131149 6.2706520411294999207 0.59690489626505138787 -7.9911808905049532825 -10.687204647886570541 -7.5820080623979979606 -4.3626924949159038292 7.3791190567117279642 2.9328387977795520314 2.4304401240735113987 0.70557056505854998107 3.878631951318872062 1.9085889852636350739 0.97778402915656470462 -8.182166855831884078 -0.16627859563438349144 -1.6417101047788815738 1.3910490185920647566 2.1525807912909953323 3.3190336180450210612 -7.7278750963442615074 6.8847171246505673992 -1.5512555922039288347 -0.8598276741236668963 -10.81598482798808547 13.723419109953278294 -7.7951550206891901951;1.8730447812169495059 18.00326900397599772 17.569059632292063355 13.284384163480380536 -6.0819027512708538907 9.387397448870729022 2.4922765805836895048 -24.002881119841482871 6.1505789585974097733 10.613116444228106516 3.4828822658565439241 0.32448878175637918542 15.080461367862207922 -15.711601090672015602 -7.8016585840000551855 28.393920277323385193 22.621004913768352651 -14.714386632009054168 4.9784158455643510166 -19.114468421574741797 23.311307097801932997 4.2856733525782377825 -9.8987149055721843638 0.07861036177027888594 1.1790736410992355143 -18.306284189385213068 8.4610888599389149078 36.80870672210892991 -7.2865493592843346704 3.0699837440518065179;-24.579612930564547213 -8.5838398622285385642 1.2107835296804632108 2.1496467372451237843 0.74099855360021626982 -2.8753964091524948365 -2.8075912279774630775 -2.8938635795787428506 19.170897155912573595 -3.1420441680822790431 6.8743425496271699515 -1.8142210192360115339 0.44120770512843199285 7.7281756939190664468 0.19248092106576492055 -3.3048698189189353869 -6.3236732432872955201 6.0799030391053650035 -0.60787125735872515886 1.6482517231196245344 -1.3245897835521058816 -1.9949943759599295667 -14.259186327292034946 -4.3573150827626125903 -2.6935981887835569459 6.8452802385097788473 -4.8246001333791523891 -4.7691770610027273136 -1.3992913415109642372 0.21193317098638936313];

% Layer 3
b3 = 1.0183746846497880867;
LW3_2 = [-0.0039351857812048732579 -0.91225369366080755196 0.0094876712401683188647 1.091366751564230464 -0.004716013950718352804 0.0064960229751142373536 -0.011021591773324604727 -0.0020798111288562481404 -0.0043717508238891701969 0.0031391459063858317101];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0145232735458572;
y1_step1.xoffset = -0.52;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
