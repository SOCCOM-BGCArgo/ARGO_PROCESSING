function [Y,Xf,Af] = ESPER_talk_2_Atl_3(X,~,~)
%ESPER_TALK_2_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:44.
% 
% [Y] = ESPER_talk_2_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.2178;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.4773886900353432;-0.73939641259969602;1.8156522976352152;-0.8616109509887554;-1.0275876487092785;-2.835445787591715;-2.0412756738575082;-1.5614746184799262;2.1397277611190582;2.4801281621536324;-0.97444419316370023;1.0850569278462907;0.85091390472549011;0.34823621107221653;-1.8006234669040071;-0.61031950909360266;-2.6079124864014083;0.53998165424348421;-1.4637281347208275;-0.95227502807711206;-1.56720887300451;0.32483752123127685;0.80152064070863271;-1.1116554747573839;2.8913780981031314];
IW1_1 = [0.5638810150734892 -3.3203116684858318 1.4139366996255744 0.47258221704220765 0.80202981036084287 1.1964947063595626 2.0985196683903058 1.3566685608872477;1.1416820330882476 -0.61754287661407181 0.15748059431405292 0.2209285486268793 -1.0977264031821088 -0.10350319159629245 0.019718480158241902 -0.35021148599399404;0.024375288592411594 -1.5914221375215727 0.79982070844386199 -1.2104684818428784 -0.46478815735847545 -0.46883378146961691 -1.1927821986665108 -0.96286566404471441;-0.92519692404260256 -2.3328744959875891 0.24750618670881178 -1.811341237095996 2.1108767024394868 2.2643410255725289 -0.92942101528689292 3.4725945908045106;-0.26951682084893325 -2.09685231159547 -1.5429204923662589 0.52402770890975847 4.2542470349593779 -0.28127407270027016 -0.30976326479622818 1.9049791947200458;0.94477888388705988 1.0666216855839301 5.4060976381121995 0.48153084480102554 -2.1322409043682682 -0.23406172227234673 1.9502421790803952 -0.89015953608596032;0.26127972759221796 -0.416058824294195 0.87551698189736049 -0.055602257112994678 2.2928772391391319 -0.79375857818983886 -1.804747967343276 2.3908667191557056;1.0148573901645173 0.89451057788891297 -0.28118779459983789 0.13414937894569545 2.4865858715823261 -0.92385334428193522 0.074405145125388525 1.0313509731663837;-0.52471323260159919 0.74742078527533429 -0.36404412027524491 -0.055960003418835814 -1.5867660074566683 -0.15836235435638774 0.38608821453648551 -0.090655806995695934;1.4112340560075396 -0.28143436034226366 -0.21165290595910438 0.19734435152561125 -1.2943961238237467 0.05353420101468287 -0.53927241147309835 1.8724043203870842;-1.2048305666161117 -0.44879257169901704 -1.3931290845279258 0.12040370429558711 0.18327360106924367 -1.5287205134198592 -1.0150557422774682 2.3049949414683426;-0.16579484271132053 0.53818989301224274 1.1826160224945976 0.34758689529515213 -2.9015633655572266 -0.61466004008548847 0.27666683195725611 -0.41168276584357566;0.2323059330096035 -1.5316074943934856 0.031023427121848662 -0.10542988494350325 -2.7750672013613817 0.37074378596929669 -0.60846274108316711 1.2831881890456904;-0.070131291827692316 1.3207576566947687 0.19140743200045551 0.57473999853724311 2.1158993339745269 0.91339998572543724 0.36182979091080442 1.7266005246904437;1.1254913937891811 0.98793495335122516 0.3421180060724292 -0.86682927816947231 4.0867687897216909 -1.0118423812106823 -0.52667357453755737 -0.22094781357531926;-3.134091843822933 1.1168016838341916 1.5223702227244438 -1.4813769423740213 -1.1698669295306849 -0.27277323778077822 -1.7043830435186522 1.2534375083688518;1.2475427420516481 0.053930472921721984 -1.8616309192985916 -0.14214306246735586 -1.2867520005862343 -4.5215579252825995 0.680510019603072 -1.7923415807080711;0.40564300152358623 -0.88827257034408647 1.1237701596298835 -0.97836332775417689 -0.18994761494009876 0.55280548862760892 -0.19214731202641844 -1.8083614331531692;-1.44322392468139 -0.33827151311495118 -0.45914646524679781 -1.5157478999494312 -0.78828879126138096 -0.12479292536561432 -1.754495584048811 3.9327250446662534;-0.74305332803435287 -0.12335506198007778 0.37620717729808995 -0.28910267202220741 -0.49850102168257288 -0.42571033687814397 -0.40616930318622174 0.39727362429413055;-1.7269070733952676 0.94520734647426974 -2.0464513276462566 -1.7149348749193312 -1.4705122196920675 0.046477806668358573 -1.7000246771220873 -2.461954683584282;-0.12968827082824932 -1.7353208850790602 -2.1173241345392637 0.96875720643355612 1.2450289765420022 -0.79458945151439697 -1.0260245343788439 0.85361727376231067;0.24090242940159884 1.7257888764505036 1.593834046765908 -0.38365473489206398 -3.4500704849223243 0.14135567030937476 0.50897913104361714 -1.627387337872827;-0.68792717532633485 -0.46510652222014898 0.49971142093345911 -2.4831292098449094 -1.5583696403216203 0.34822528985035206 -1.1786867241224288 1.8210008725462383;-1.5841435390336995 0.86533952636778455 -0.25292985724956735 -0.52935069864725381 -1.4861065738219952 0.56185242314641115 -0.069599376561998091 -0.26153606860155298];

% Layer 2
b2 = [2.3243917270863883;-0.85627962300387306;1.5224157074865212;1.9742065053075111;2.6556657703372335;-1.5995141633056116;-0.47260506946846531;0.69618883857153835;-0.22253343859591532;-0.88635089958580782;0.59838883414134703;0.21660908564703435;-0.41770109436706004;-1.1827276872256174;1.4592557002101485];
LW2_1 = [-1.7425425630123379 1.1184664266391369 -0.69623593010623364 0.15025552905223502 -0.26464765596501461 -0.91812483584613946 -0.95642805471231929 -1.5530519932212257 0.50747454209718845 0.95979530896802412 -1.2454427803816785 0.71395875086976668 -1.9421956110305381 1.0365513643239754 -0.16981274047308101 0.87750392789747766 -0.22018230529054716 -0.29203446891480028 0.26808320245904982 -0.90345994775651839 0.41270008569525252 0.4447249379494399 1.7728091309034475 1.6459451426075875 -0.29746236461630848;0.11835677905456357 1.5898833047591969 -0.028803967631707728 -0.066572117294160918 -1.2130300752024441 -0.33063774117363531 0.34935957571504489 -0.45181248457929324 1.1062019702217956 0.72052989693500613 -2.23383410502072 -0.5019192632333862 -0.75436692462924959 0.18121392843107625 1.8218771926528228 -0.13594773956470627 -1.2818170722161724 -1.6335094516679365 0.9009007359307426 -0.011042437396022738 -0.3366454235900091 0.69012434716959492 1.4330452511727927 -0.38236528347478144 -1.3338744698446394;0.06601708493400564 2.1391008636458033 -0.16854226635675321 -0.17220516663652879 1.0126796908372078 0.89441609585286996 -1.2817034900254367 -0.30468663332019713 1.7305186523623755 -0.30984747049803174 0.023919423349975988 -0.35773615616511301 -0.55098918694071464 -0.89523598864198384 -0.35889027931404327 0.8112982161291874 -0.25619215604113943 -2.1124261294259168 0.56073608475629999 0.055335990507114914 1.2917534409099547 2.2074318992397268 0.14205606220966085 0.26819730067239839 0.46566700173223724;-0.017441170603045102 0.81869063933008568 -0.835846525643829 0.38917062504213251 -1.5537139760711671 -0.41118045190019958 -1.1757599130653758 1.1677207752796033 -0.17412011038123454 -0.10803947554839086 -1.3567219477126751 0.21195158314759893 0.95882215362617251 0.56144531278458176 -0.01408978727063382 -0.64702170888572175 0.18715555051864524 0.51990253422105825 1.6184250032030347 3.341691083511507 0.25212058609640053 -0.39336308874397286 -2.0432850773441742 0.0119019563931347 0.62869764653655136;0.46287578818885922 -1.9287079992534875 1.5841606467755076 0.059035671544230263 -2.2754218493057117 -0.67547813350945762 1.065825890302287 -0.22457780359285595 2.2713250100413647 -2.6710860474238727 1.4741793906398981 3.0808901445265113 2.44312226451905 0.64990956451374116 0.85990304744046142 2.2129440360161952 0.48097161821396828 -0.34552446471616888 -2.2006339762393718 0.055687827686478966 0.94436080613673368 0.10552447042944639 0.68383538503489572 -1.1798567259193238 2.0462478810935716;0.15067126215035642 -1.9725092603179166 -0.027482298834192467 -0.0072549959522453843 0.94547524592201737 0.47646392196768772 -0.35584138547615146 0.29816791235342222 -0.99321456896550497 0.7601955559228748 -0.39462420364709955 -0.03120043504834687 -0.46349214497282187 -0.086865166758737983 -0.58184358645602807 0.077474983356733265 -0.005205501152810153 0.34443582643006537 0.77567081723982978 0.04132790653705995 -0.044595359704878941 -0.44006387299705402 -0.099452541956232848 -0.22418539063157322 -0.35755937958074158;-0.66163600380813736 0.27253631006936424 -0.015948858144663677 -0.30317586458586016 -1.1370984695919086 0.027575712140556638 0.86228923411151093 0.65501490147114527 0.35988120691917164 0.9136966145089449 -0.78344732741994283 0.88105792969088159 0.25298035405247049 -0.36493011473391646 -0.2932411266229118 -0.99917494346507651 0.90816661887605654 0.61867741526738229 0.48778239980109961 0.36811749876735617 -0.49197215440373082 -0.52629361418358911 -0.64964423060124965 -0.11645688129721964 2.0062017757129538;-1.2935248610918808 0.076719249207192017 -0.6846257858135576 -0.52058703323565791 -0.064312508708452953 -1.21285908546506 2.2777250053519031 -0.92006522246936528 -0.53571812733462476 0.37893244585760455 0.52553202242069297 -0.30047500713401781 0.43727718984317598 0.42060263341217718 0.82399745461211205 -0.33363698976081513 0.23223766043224486 -0.3814767533308035 -0.23944331270160166 -1.6246737994645202 0.46167394582462817 -0.22648120086893631 0.72912833736595795 0.86002670912065948 -0.08823049457006088;0.46322926918497143 0.73728370675117549 -2.010626237919884 0.54463014476092098 0.69671555901443405 -1.3382664077666899 -1.2751932208078873 0.14535433594876399 -1.0144133376215292 2.7396377547301509 -0.45515154763821464 1.4067967492865827 -0.058054324403451769 0.64383932551275003 -1.0937286198168787 1.8409563675553722 -0.84391307853400166 0.87206453496259095 0.75483677509603253 -1.8664279879482257 -0.25105123676229457 -1.0467708926082577 0.71983203736418644 -0.33522999190337394 1.6418712232429711;-0.10030631741983975 -0.41859562958677077 -0.6228419425959304 -0.6445641884972414 1.9364459534803573 0.31662133812963472 0.029857651577178998 -0.21904643394709578 -0.33090390601856956 -0.58684809405687166 -0.72115646725469762 -0.060909433659411066 -0.3556585248284988 -0.12021140060606876 -0.99530108442350151 -0.59304021761302328 0.73313355314142492 -0.98191820222362203 1.522653992226046 -1.5680192803860071 0.27679413467690966 0.41898420496951411 2.7163251587209003 1.5974446185542843 0.44735126118334295;0.39710944965119066 3.907595642067617 0.79019127570700909 0.24411190967532703 0.10431616329339095 -1.9874158758221718 1.2540744873964527 -0.18303107514991038 1.9003102571053978 1.6163426279269086 -0.3132175056601646 0.59237806702359463 0.15115823536547057 0.49061589343378442 0.72782475517851419 3.112701117408506 -0.55147071911070578 0.80200218002330448 -1.8385446622465775 3.2506865526337103 -2.0058816219270508 -1.5092449383239068 0.57582455241442543 1.3359534314871098 0.26060393295532958;0.94584702949246546 1.8046205411397676 1.8428697084287546 0.3960432677790377 -0.51687795188713559 1.3895959716407247 1.0012071161296399 -1.1827776869494282 1.6301563285421754 0.8259855330030923 0.65743370634602205 0.56350651566911913 0.45059055675546617 -0.93062586824680271 -2.6239751046045843 -0.47783525944225802 -0.34255387618555294 0.36724825706139491 0.70104107068348798 -0.92778017198741292 -0.27945527435796824 -1.4551396773992626 -0.21597383466141834 -1.4515121091078009 0.087987531191046769;0.090692182241204247 -0.62176579680086641 -1.0660721591331352 -0.53103117013433743 0.80653562023350511 0.67119244176316251 -0.74033220306356906 -1.6632191329352921 1.0798103764659737 -1.4159368653800706 0.47619966605741915 0.59953203407541866 3.8286757074496856 0.59164556504708787 0.5729536568546304 -2.2132082094483909 1.6112522475571649 -1.4562203317110807 -2.1624495711631146 0.72330541372141388 -0.7623750201313283 0.12873420137869715 2.4168804821951748 1.6553924215995446 0.49450173740674902;0.57187587732910827 0.82332884295705155 0.75364939172160661 -0.45088919383082321 -0.18221081535005221 -0.88943455910769953 1.1459922946840091 1.1068167878576156 0.294893986606171 -0.71729375284524366 2.0680772783030572 0.48211605504074045 0.77336937675348172 0.78841283380121729 1.9501339239994129 -1.2012931295624134 1.1680908294773205 1.2104348145816561 0.38586660827669972 -0.093865842333391861 -0.85391422817033624 1.3680292324964827 1.8692326142475333 -0.27589670260978483 1.046604828637365;0.38631808698482267 1.3332326775986802 -1.1269529624189198 -0.21183625423243307 -2.0646223934852754 -0.41919953360146761 0.43608200050458873 -0.062882247317816692 1.4351822884373171 -0.44145512772020901 -0.4794979441898074 2.6904705562864275 0.73822443472904775 0.02004927585809315 1.3721622877994797 -0.41828875486704759 -0.46937126615265173 -0.52649454314620958 -0.52078035593390537 -1.5494549230072268 -0.065380354213692662 -0.55438403722170349 -4.3312522512374967 0.09681176687225343 0.82229116584422524];

% Layer 3
b3 = -0.3420130489337031;
LW3_2 = [0.027049506401429016 0.014688732986541062 -0.031163066535970806 -0.10431439952141383 -0.0081732889462945851 0.20904123393939333 -0.035389555868229977 0.010102282869820144 -0.025621993236383384 -3.0506215983816989 -0.016958914943231197 -0.02238251538780062 0.016389766042394095 0.017322525123766724 -2.1947964446708661];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
