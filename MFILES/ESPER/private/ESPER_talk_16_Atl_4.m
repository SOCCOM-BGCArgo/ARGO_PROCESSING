function [Y,Xf,Af] = ESPER_talk_16_Atl_4(X,~,~)
%ESPER_TALK_16_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:51.
% 
% [Y] = ESPER_talk_16_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.9870425200840618;-6.6969483484170453;-9.808794150826202;-6.5468893118455158;-0.92133139878183223;-0.093225074295921112;-1.3382174388083363;-1.8014987338791544;-0.98416179198281684;-3.4915637053853881;0.99981546445722957;-1.0120544224126791;-0.1409339979451194;1.6221224595361852;-1.9792356663919783;-5.0779592014537203;-1.8477377450288024;-0.22914664829191908;0.77302189089772644;-11.904178011650666;0.50592827543381258;2.1653133775753521;0.14743860662828162;0.92091172645498176;-0.33249518603297717;0.14454159487866045;-1.1291142746344771;-3.9323785379064664;-3.3874411648165474;-7.894953766096128];
IW1_1 = [1.8434731746465598 0.83582205890574413 -2.5432474891297239 -1.5592665270224042 -3.1571709973494997;2.696813591932814 -2.7530242513249887 2.1433476546740611 0.055883661023804862 2.0247215972723334;4.2079942607245107 0.54951478677019006 -1.4391553175344416 0.23525633916335076 3.469590659704108;3.1001406461939198 -0.43080785598725768 -0.32726287870408255 -3.289938476747055 -2.8922041651682169;0.16859716849067399 -0.65190084075949417 0.97820486715235055 0.041288945976627862 -0.32755663796256562;-0.13087970237699725 -0.96373402222145377 1.0995699141845496 -0.20982221976331442 -1.3300783614741112;-0.14535405644651561 -1.8478383779382788 -2.6932611857145838 0.69146774763336227 3.0671314382590009;1.4956679108417597 1.2462685826627296 -0.53042351966362677 0.22455549682928799 -0.38855050361320614;1.3142996767768276 -0.77907894430179969 1.3979662216508173 1.0883289029727545 -0.64894582708110238;0.43270184982130638 -0.23263904721460021 1.1455142355498431 1.8060681922093602 4.1076817316514544;-0.11089917845901719 0.92340573479380117 -1.0468596260779548 0.0264179040876725 0.082382689248069421;1.0032406926040285 -1.4844923302182094 1.932871487935824 -0.23624348524089439 -0.23671284184932284;-0.43144457619046944 0.44964281032371595 -0.30194013577601941 -0.47440385598300161 0.70672674232926302;0.1495635342380281 0.46219141477896403 -0.25609684294376028 -1.177924966979869 -3.7514743178846119;2.0094003773033613 1.8569356890884561 0.54986756260822678 1.1183059677080158 3.8163012012610906;-1.1174008116767182 -0.2281560038067699 1.2112531072658033 -0.82329456429992487 6.6825261214894711;1.2177004165220859 -0.8332443848604526 2.7027117489693242 0.43545775824703287 0.5305233712377555;0.25260942149142135 -0.44428643284520047 0.17514689962632524 -0.077462073010187676 0.65330881355882242;-2.9453266429888809 2.4796580420753118 3.1186582089790207 -0.21437593923257142 0.51179080052094406;0.15939465881217346 0.57634613961871328 -3.0647468661513608 -0.56381253355880567 23.898514038281071;-0.8708897536980954 1.3530082732455988 -0.67533391430737866 0.17612371355828274 -0.72611119176254479;0.15706262819453293 0.5919275180776884 -0.95403183717032602 -0.53368816762116689 -1.134143056687988;0.36707319828884688 -4.0669487232521568 -1.0048213813583018 0.33967702545719303 0.30707496878999252;1.0833688367365288 0.95511218911346096 -1.5204919243253707 0.37655196645148159 -0.90214046865318209;-3.1809864975735094 -0.24898705461450396 -2.0129681377097142 -1.5267446923452299 -1.8823257358763998;-4.8128035319280347 1.8516505626945741 1.4482131626195505 0.80413857861622251 -2.9824937027817051;-2.1814406375103239 0.51545614864705525 1.9426057719503 1.3015099594344879 -0.82226064271041965;-0.32455067955114791 -1.1708093044411536 2.7788693677195946 0.28623552232491495 2.4700152280998839;0.065833589328775421 -3.0923963320865036 1.9721478343183985 -0.60872198610283901 0.94313821471137582;-3.336678911806541 -1.1333957343293868 -1.7404701143177592 3.0024208667850369 4.8412080977408527];

% Layer 2
b2 = [-10.509958588588102;-39.384945974218247;-8.2582006992896311;20.981591948464494;6.9682939737161362;-4.1306506572210218;-9.2797003853226716;3.2138716285538509;24.481129112663272;-5.017194550082972];
LW2_1 = [-1.1715568056785854 2.4107240354149875 -6.8748309643815526 0.34941006797491425 -5.4890982370687311 0.29798061254578273 0.05737486401451581 2.3226592992446098 -1.2913049978276081 0.41591340360245682 -2.6742528329309265 0.44439367155243265 -5.4497299808453485 0.77047622041925956 -0.022199844610010178 3.2361276132516745 0.18418683844565262 0.43919821300785417 -1.3590041943993107 6.7170339814033033 -0.85451383458822405 2.2263366079619771 0.13985411373728932 -2.4935023288832738 -0.75271260974611487 1.4216188403050494 2.9456033839940576 -0.63764130341142222 -4.1601477812650831 -0.92907957326989177;3.3816384998111029 0.17798790114624136 -12.76889972903591 -0.80905620104885556 2.3894864090837031 0.58333219723735141 -1.3400525977054607 1.6473100960817848 0.27513695493339857 0.44769242823318106 2.9940693594681012 -0.48609744466816879 -2.2630948183727901 0.11587653916785925 -1.0618225266744004 -2.2106338514639403 0.021933833900538043 2.6410363527444245 0.30006065711728275 40.513237413020661 0.54666775576239734 -1.6797635344479576 0.022258766613873673 -2.219852552693113 -0.0081365195371276844 -0.27677846089691338 -2.3300471400945604 -1.3911455495994873 -0.80177275375269963 20.561074132645413;-0.33863522194414158 -2.425818448091523 5.1002269987207631 -2.3361316015664864 -5.6552848344018409 -4.2152035503592877 -2.8191748408749802 -3.8320791326437011 2.8855232208240813 -0.59552190163318408 -14.643009668478598 2.5710743748445837 -6.0034592775113333 0.46885626372754707 0.30865939017100802 0.55985921642301373 -1.8206465234959257 -12.320049381689202 1.5178247163876377 15.892516385385761 1.0728276971782742 7.3908323071763817 -0.69326231480076761 -0.55554911095174608 -0.85542963683799755 -10.054189989513239 8.8138165096923622 -0.10591800996993229 -0.4265275628591601 6.0224776318430591;2.4825285266568766 0.021045687666423125 19.755627977449386 -0.05609975666747518 -2.0655351026857067 0.36462782867684596 1.5390215610789606 -1.3410191195874424 1.0509036152847437 -1.9605490158538614 -2.8517187661595695 -0.04212831584248429 -0.38978538753361713 0.84507611966246154 0.44082777948110563 -1.5537833938495902 1.0341711365608171 -1.0935620045796042 1.3314949346506741 3.4180045895231332 3.8150357417998171 0.56515577431123021 -0.75185341769134173 1.8498707524622575 -0.16583759901978085 3.9706004770752052 0.83051207250938841 0.65357930598630276 1.0286274751140332 1.1479005135501659;-0.69039159104720893 -0.70203545840807657 1.356159128401937 -0.25513818012927092 0.72905446229150528 -0.66768751501721824 0.95366023843444192 0.49788254209959432 0.36466483909997527 -0.64217818020875239 -2.5961357799596381 -1.1658998903464131 -2.2009107646116592 0.61652932824531204 -0.15560323773147511 0.12034030519225435 0.28015726615546543 -1.6529667722907486 2.995008846137948 0.097803296204410195 -0.08277296364570122 3.2720294241301855 1.7402147667842405 -0.61426688324565593 -0.32213086176666106 7.3861036134911151 0.5244218416642934 -0.66059005324536513 -0.10797426230841511 -2.8323352293528603;0.50222487823640383 0.69227723485881965 -2.3679681514129665 0.25836671419174556 -6.52094162420555 -1.4424984333649473 -1.9192606805133869 0.46501083963344736 -0.0642946156500247 0.58488389516247519 -1.0089210434960494 1.4314530786579631 -0.60830735761882948 0.35290273855058657 -0.34886869649235419 -0.59066002122091754 -0.22669404500572138 1.7695560844832923 0.45687424568111973 -0.28461223841002803 -0.36652558279285563 -0.9897765410773145 0.22496409828728803 -1.2522410069056074 0.44936924669272688 0.70343436558561068 -0.0025320810843811915 0.8527289699619196 -0.056082756704492573 -0.82875589840495578;-1.1108636578392177 -0.48933704968398173 -7.1635360029548414 -2.4406536319221539 -10.053709435424407 -1.9204727230430694 -2.2646584992340593 -0.78432318026790582 -0.051590546206522252 -0.30396977882899506 -7.9962844877269212 0.86421296744469467 -1.7084437692517753 -0.68390899540781269 0.21131471323943385 -0.2754503722394096 1.0718653439392687 -4.2578488120878033 0.99780997369612168 3.7314837804810401 0.80559838432898168 3.1611989575949537 0.59765186159020511 -1.0693917337602663 0.13911003998597118 1.9040779883333621 -1.7449999462139041 1.3614194753716646 -1.3526807867229722 3.4761333671597336;-2.9038871974986455 2.4092531266395398 4.7078839226235623 0.17756629253410036 6.2254147306842347 -0.84329123057597355 3.3943057695839713 -0.55849345691019936 -0.44754498538310927 -1.9888822111555686 2.9603659079638756 -1.2473561719381974 1.2205951888501736 2.0368660101595193 3.2770400395864145 -2.5565668881732315 1.8037490567069294 1.8503615192336655 -4.2978409420698735 4.3255890134924204 0.23194637049464625 1.8342477137379567 1.3251996862497852 -2.1014532115371165 3.6921775693722747 2.1080634932074829 1.0868091100878943 1.0802557051950059 -1.0172963034135221 -0.89338596022848449;-0.59397292094576781 -0.34562031978984747 23.868829770407796 0.059020197568050561 0.90117226245945969 1.3661096044241776 1.8097802370507656 -1.2616881270300491 0.46933443414769155 -0.64685755025323322 -2.4768879446734879 -1.4875691385634158 1.187104208645329 -0.3930282035883928 0.21823135039639149 0.34855059229707891 0.62339246440480212 -2.6191938601757219 -0.10666807965055464 0.24325018484392608 0.013375569349231084 0.49367641213701496 -0.26142724623832442 1.063983816575728 -0.62591839684298023 -0.66069295749358492 -0.23805424927739513 -0.83403809525133088 0.069494841430927032 0.97367212077628784;-0.9225460469484793 -0.45007001393246615 -6.382297186546805 -0.2621860125700225 -3.2641892186034851 0.12962615215344858 -2.2984043368635594 -0.53368726823867374 -0.79489664046395669 0.0045974281430934631 -1.627603983185099 0.7703367342109827 -0.70200756897963901 -1.2573682388273613 0.32623969960650329 -0.42122053147451122 1.0444581477512078 0.52681801744639511 1.1456549652972283 3.8699156408599884 1.781123137675267 0.26507473942523163 0.54354665666167123 -0.78177795145823192 0.11430058070146407 1.6858237306236843 1.2190937432884859 0.15307078526904919 -1.316153265457322 0.8647322958662127];

% Layer 3
b3 = 0.67027346815389333;
LW3_2 = [0.018691136736505756 -0.039457790433099542 0.0084610377141237231 -0.01854351294800053 -0.32550377470919017 0.65371049255247926 0.48556813984745756 0.0039018041655100809 0.65130033628925543 -0.47872619312909581];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
