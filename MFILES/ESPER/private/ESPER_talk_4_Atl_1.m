function [Y,Xf,Af] = ESPER_talk_4_Atl_1(X,~,~)
%ESPER_TALK_4_ATL_1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:45.
% 
% [Y] = ESPER_talk_4_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [5.3545742889245034;4.4276906170723649;14.466561220054873;-1.4664573469004065;3.8379123344533563;-7.3673386400151362;4.9103487211552288;-3.1754732001266754;-2.7550666022022132;-3.5023388231509518;-21.445708003589566;-4.9198012217074361;-8.596004205551143;3.4167585840802146;4.3897818556177945;-9.3396297829702455;-0.37009412976040673;-0.75488428818081654;26.133185298805298;-12.017134295774234;28.866102518871429;-0.19106354768100908;-13.446984543729544;-13.231770574555316;0.84767902754199254;0.29936231420595172;7.1758834966744507;-2.9448000434181698;-12.932317706232789;-17.201617476833587;-8.7411578952261344;-19.722234494235906;-1.9113406657407643;-7.2852656989667448;-8.1822006511456973;-7.6041789392304917;-1.1562561499082833;0.47710909816019553;-3.5912807159581321;-2.6174359529807076];
IW1_1 = [-1.2398595311898228 2.1105391117306014 -4.0109966528328265 -0.032594355440443125 -3.1051619510860058 -0.72875657155419526 1.8242383085344653;-5.4354805637992643 -4.8720102452614489 -0.47543487809862384 0.035340235546104132 4.0034465586203751 -0.53797710741744031 2.1593146236325054;-10.018418592925533 1.1301882340678142 1.2290126310048781 -1.4824473738646009 -5.5712797767074802 -1.161953954769178 0.28083005330720234;3.846918923901105 3.6423610109886755 -4.086602987834838 -0.029510297654637203 -0.025497823649302906 -0.2510223967638392 -1.1379957285386997;-3.0290845486022322 -0.20705298534467767 -9.9882262147625269 -0.99310156631959978 -7.4462373268084647 -1.0331172506829225 -5.5389763433751202;5.5082360446009915 -0.082751906271177053 -4.4162824838324353 0.1863541254323062 3.4831172787109246 -0.30211403633592498 -1.0551854616215337;12.480835598492138 -0.49750114978193016 2.2069024459007136 0.42750799881503088 6.5230022759180146 -6.479941641690484 -3.6747336735926739;9.882559612372404 6.6075174996093073 -0.65717076006730102 8.6537195131839475 0.93119541417452145 -3.3208629891150836 -0.59327140659687994;-0.32604223509019803 1.1218360344404492 -0.78553303820627018 -0.36591215456825199 3.8624748101639645 0.98294993208639325 -0.38875450496072772;0.38846680110244203 -4.4957431080827499 -1.8393774552179427 0.35430948542388152 8.6195573813538591 -0.041143150171888521 3.0038545037645621;9.8506961862430416 -18.924621394724003 -0.85168600967453023 8.9026589464621129 7.373588738358861 1.428467626897078 -6.0518011024071185;-1.9023405470225885 0.061033785016761863 1.9438446335363098 -0.40165315920925426 6.3561554752240657 -1.5816489880374873 0.26788279439248069;1.9827595772098923 -3.6590153703919626 4.4595589244342273 -0.036164284466196857 -6.2469151119088648 -5.7214381346777961 -1.5153255443775051;-1.0248702085784218 3.9200231807582453 -4.6547805169682572 -0.6351607648757831 -0.60963529782099912 -1.3548113318581749 0.88492748533701093;-13.520486788220783 1.6387116264916564 -0.62317645412456435 -5.8809856203999145 2.6811766588801933 -8.1326849613506749 -1.7311038788936892;-0.17277087080809486 -0.084712943653406134 0.51010168219775898 -1.1854814211441409 13.355431605593306 1.135631894314411 -1.2693540814934292;0.262853889607089 1.0805915936298598 -2.5673786416366413 -0.64693907053874278 4.6763937476458102 1.0166981680733937 1.4267180509763331;0.4539169882728129 -0.36223340046344638 0.47694134050109771 -0.10463089933023231 1.8468727776730052 -0.48405048900280989 -0.050719292988303709;-9.3112274635667944 17.806886064823974 -13.321994171626354 1.6916627489461555 -17.308306570946801 2.0589835628174997 -3.8663639628285567;2.0322005604707947 -4.4874764253891719 -3.7974947384129609 -0.93678224387105846 11.618654723008406 -0.88697355381153675 1.4191859525615838;-6.116842102696725 6.2267409194753034 -0.83412671636907965 0.33710973974459529 -26.908409765822981 3.3029912276476727 -1.433585271106991;2.3392466375277072 -2.918534742327858 2.4675834099110094 0.32724565362926394 -1.5997136466871322 2.4294817886872337 -0.79163474603964112;11.498548540555149 1.4413811313674401 7.2165895379145004 -0.98886354675313548 1.3078826870458669 10.37641140264212 4.1049001670448835;1.3389817190475524 2.2907527832852383 -3.9208059291421837 -0.74414885786059026 10.926997546763205 -5.9639431755602281 -1.3448902670962899;8.0416263034373543 1.4181755535060367 4.7528484607396786 -4.2853441005343491 -3.9782388102194193 -1.268178102315733 -5.584962221889934;-2.6651673331179491 -7.3389121812810432 8.0347399862848583 -1.8770126913087 8.6168388106866853 8.1266150097709566 2.770302857754313;-0.9613164469479597 1.5156192776347619 0.84395326882353472 -0.79468763624647087 -6.4497344051630821 -0.68868137591800194 0.10959204164311033;1.8335607117395081 -0.47882623734875607 1.7424914545553909 -1.0364530854360672 0.6610997727359722 -0.78554059300469448 -1.3863583273543163;1.0144623641783983 -3.7080969011114022 6.8376049807394397 0.61011329324638508 1.0609456869493508 -7.6034630625271928 -1.5147985871416747;1.139067054219987 -6.8041584060342979 5.498780694099942 -0.4579228122059848 16.263626761224913 -0.90631692659141205 0.42638971307979945;0.74735973785214216 -1.9463943165621285 0.22588108916631802 -0.42401907080072615 8.1710566790366208 -3.8603795020756602 1.0031747160984075;-1.8616264205307822 -0.49698206627423896 0.33753550672645533 -1.4293924062418109 23.431990046190784 -6.0690288618824866 -1.0896476503750867;-3.7725909759065877 -2.4399466501497242 -1.1391724924777447 0.66249672739015419 -3.2455095568903141 1.2169178263816238 1.1097956689731803;2.2162395776885604 -0.056691856276087832 1.9132362821007876 -0.38643473455526572 10.357365317007748 -0.83439311112228498 -0.47230397288677989;-1.0916621864959652 -0.40649325712870316 -7.0023356021499907 0.12819285431679567 13.068991755929552 -4.0890861586709129 -3.6207772487487917;5.6019328916507956 -0.22336317839279576 -4.4273558783798928 0.1878011240610076 3.5888467846782959 -0.30622913185593142 -1.0526955987570379;0.41538909339210339 -0.76332303527988388 -0.27702602272900934 0.24783482751917962 -2.9138734565203852 -0.44883043758716934 0.0009040592663615561;0.84076949425415448 -2.4088094476589701 0.62482116382021968 -0.10839310058309562 -7.4625251623759636 -3.9054894125415838 -0.24038302520706706;0.42161848719695283 0.94936703781153675 -2.6305808219628202 -1.3397640700033031 8.2513567641769932 -0.46564064304775826 2.0968271959599791;6.0230302622412477 -13.167404310661473 1.9220772846627241 4.6932702419040213 4.8303922109703654 1.1206907257338432 12.050419500497084];

% Layer 2
b2 = 0.04540819452850501;
LW2_1 = [-0.030970415169349026 -0.055337149291016408 -0.036073552880261928 -0.082354498162825834 -0.0059519839685930566 4.89239255343794 0.25429008042246876 -0.0022647244294528206 0.056359333441639493 -0.027970090801357539 0.002198331788050934 0.036990507158729743 -0.036519425641457208 0.037455662984130861 -0.0042351759944785107 -0.023173626991053849 0.06791809566040885 0.40174548074067423 0.0067154522386512179 0.031533961304232666 -0.034338293281278659 0.029104182405903907 0.011012235872063326 0.0202672087829237 -0.0028442388162226288 0.0065244927594293022 -0.073374400418113314 -0.022109540288556523 -0.01066488787671779 0.021263220422079964 0.04285006400665551 -0.010951970825394846 0.70945790542568643 -0.028690461349538416 0.022661063843777272 -4.8184385881660958 -0.76912762724405315 -0.024914983580303841 -0.057710710194227181 -0.0046202969418664497];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
