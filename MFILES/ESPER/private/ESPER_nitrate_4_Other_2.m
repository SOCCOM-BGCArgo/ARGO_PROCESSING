function [Y,Xf,Af] = ESPER_nitrate_4_Other_2(X,~,~)
%ESPER_NITRATE_4_OTHER_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_4_Other_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.3457115731550328697;5.2234547013351395606;-0.25625755121178384055;-2.5989957821470808241;2.9424089662311860849;-4.1840103249272173613;-0.14784934167225932677;-0.52860335559299365116;0.26185401772345595628;-0.15921516720196235428;-0.13929828560939575;1.8132704006872235603;-1.0093474008484246696;0.059816035855390845;2.2079354397483621497;-1.2078078177639743895;1.6223564409378083973;2.4535819240554226361;-2.9084437830162759298;-2.864437121378307527];
IW1_1 = [0.52702969946378308563 -0.079579323981990232606 -0.21695262209588458968 0.04828954443002033553 0.91853155589406110249 -2.8127515516865209122 1.628418524875603568;-0.18238472810882411235 -0.14512170275869368252 2.1520715750552645851 2.7937780556000193499 -0.92726401514449841024 -0.61484129424638334083 2.3823043034166571097;0.092559187125636169235 0.05861252321409274324 -0.90223720142931163046 -0.96137945121633283652 1.2304872215544833125 2.2637586131593354644 -0.67612668784918827924;1.2088296285690078857 0.088405381497611887354 0.66443583687900631407 0.67349875487935506602 1.5331444225095711698 -0.018579813769084289887 -2.5577239664301654187;0.41795822256387987759 0.09037078654578717396 -0.73392915290125526617 2.6309275499164197498 1.0331455890704095424 -0.47139949938185815581 0.10890983571972880084;-0.11704695728239382368 -0.35900859061468115563 0.081205741783990550986 -0.22975954491214442554 6.6669524226928755795 -4.7912383797127278129 -0.38045168245332006141;0.71614847526329483696 -0.13220626380285591117 1.2235241262936067397 -0.15733800658154603602 0.76862169631327303954 -0.81227393451606566543 1.1058089665903398924;0.58093876581193359954 0.48338005408721679279 0.066534449686040580962 0.28251966863758670723 0.89516131429873890824 0.53809227146691163135 0.45288799761711656666;-1.5104723409569074111 -0.8070500427696833956 0.93648724069693256578 0.047655446418298330613 -0.1824657959691595166 0.31998274207307153549 -0.2529479446023781275;-0.71228514852997637519 -0.44345654217247948425 -1.2014659424394285026 0.28648872191217589211 1.2895145511849053221 0.28333804898731579369 0.27810252708760191398;0.29006540108685741064 0.073822581571586873284 0.084671260811339355001 -0.087916774581204074068 0.42959463778042461524 -1.133274144233868741 -0.51730186349341444885;0.24004403857020142898 -0.15307429123711899233 1.4014003151869756092 -0.60768810581307775021 3.402594790368263844 0.98452531035751500443 0.92458634754428736802;0.12193349592932999081 -0.25193291440584009155 -2.2381165583220172799 1.0304982430223419421 0.87825080736528537972 -2.2316517285442909468 2.5269244761995386384;-1.303707525878481821 -0.39530036303947013732 -0.37316399166522584707 0.15464750960733428253 2.2032716105179961374 0.73074717217929763269 0.37282232755484295827;0.31355704841223086543 0.075725065991938136922 -0.88351128195977723934 0.061562960373480114795 0.49941170783438759706 -0.81450747291237013403 2.2225505671501069038;-0.73302460424812954098 -0.31310021757152095567 -0.56367050815006092268 0.0022040582571911417065 -1.200031049855736498 -0.95563806309028276331 0.17633637712109728746;1.1187971466928108288 -0.76101687816520557917 3.1741278426191601447 -1.1748862278392921965 -3.7840992905899737409 0.58394599625896725925 2.3378089867120621648;0.085749440488364192525 -0.067537241688840163323 0.87249419738269906599 -0.59140196659398736045 -4.8454572292418163215 2.269116742395489883 1.3168831286173634521;0.013876403502146833491 -3.4690500524285527995 0.77394437433458473929 -1.5628030236468628544 -2.6447607400048265269 2.6582732739975418745 1.5062803112179603549;-0.54065935294934708288 0.092359578076511072986 3.2816897607197077491 -1.3291611351377894401 0.89187761892253547558 0.021607703962041188706 -0.56456822635290526691];

% Layer 2
b2 = [0.7474208021895337728;0.73250053707786944024;-0.038523673402617399086;-0.40216882798422226575;-0.15850767318800665362;2.2274184207271217062;-0.46764495855353077625;-0.77803041760681412864;0.43525388164905010058;0.50241103032699896414;-0.5745403562038348122;-1.506571720802037273;-3.0858229017779996717;0.81048486963183086207;1.1924848213266470154;0.54577488723107281388;-0.64657774316297644823;-2.8263286487491758869;-3.8802213390769519918;0.15866619591528433042];
LW2_1 = [-1.2908424399306031027 -2.2550127177823795499 1.165301235555028958 -1.9126150705488398351 4.598335690795884112 -0.035878428152347291435 0.70511005180550045957 -1.7083060952210527006 0.4648620037850510478 -4.6448793251434645768 -0.36004815636845516336 -0.05053762811872974936 1.6747017966515818088 0.92571872753159900604 0.22419401168432759319 0.05634245243208051146 -1.4494211019444682709 0.95781568003120343135 0.30995217681478481886 0.66338738441877920238;-1.3353994803702671224 -0.69610541882528109703 -0.12084334562845625016 -0.5832890243748755088 -2.6216963566594326807 -1.3343255728682690275 0.32438091062872936865 1.0557938303556813064 -0.62896045720924165234 -0.87172551502756256969 -0.96551060453025017161 -0.33428122031951484905 0.29459906595335993984 0.38008223401670349073 -1.3344376379387654641 -0.47785041688419727102 0.83189258453708359031 -0.24287737936052228305 0.33240719000893825807 -1.0333233683025428995;0.12566825233810954843 0.19857657041363943606 -0.17915934584269041507 -0.26104481877775814747 0.29167146784932423964 0.36568335802460805173 -0.065292305143686654723 0.54678791698885131911 0.25308836693362107839 -0.052948314646971687825 1.1377687971948358125 -0.66666466369118626556 0.22151800862333329012 -0.12954360409253404263 -0.045948314125000271069 -0.20835604496018123033 0.45137042403382787725 0.13612966389239536391 -0.43897223737742641081 -0.063820167030200034008;-0.6834409938019587738 0.15524239327374933506 -0.58873002558240050686 -0.75236916362148054116 -2.4000981542115620293 1.0411449147689568751 -1.3491510113640610147 -0.46081926667000056019 -0.42868773011661515104 -1.1389702454613370719 1.2413175062432333373 -1.4880421700068637847 1.10256221773247165 0.94849985419786331242 -0.0078567384826058201536 -1.2095574314992290077 0.82690073654026774452 1.6159601847908195982 -0.24028760598916343305 0.67897918557177761034;0.53808854892188850982 0.67226308709689386323 0.18971626012087053348 -0.25183438048273998344 1.0247595464930878695 -0.81435097606608641829 0.31088494895201512769 -0.099391756666624267447 0.33513370959160543316 -0.29116767986598773854 0.12772956497024237632 0.2577430749316453884 -0.4887328551085868833 -0.11656058676729373624 0.0010773535671407038355 0.13856012815275339789 0.20474769264004427649 -1.269407806823861673 0.024485286706982564708 -0.26949717723818916726;0.50127572641833084699 -1.6207574264926805085 -1.499994858019844779 0.36656867889764083168 -1.47969480496908945 -0.70286891044373245307 0.40271793681804929355 -1.1330840175250844748 -0.36497709810788214746 0.11435493777208424748 3.0207664184050044831 1.3101605175563257877 -0.22603960823724270068 0.092429176088784315013 -2.5897828905747566353 0.85816623285797410947 -0.19669810721947811327 -1.0762119389954809545 -0.41939174606376877774 -1.0944395393132306804;-0.55437535768844303785 -1.1721096381831468403 -1.2438910424873388383 0.040873307237243215739 -1.7655600385674734554 -0.13987398757220614876 0.17885261960556522731 -0.30148038509397817597 -0.53665278186655884785 0.52247653419738904201 -0.40443731417371159287 0.35593771247663802404 0.53893851099184009179 -0.26952959522693276107 1.0532589624797443761 -0.27773523413564804585 0.074676688407075780818 0.33885782848158291225 0.30087375386240466923 -0.80018911703833472959;0.37114857948844343083 -0.68942356206968324894 -0.05500742418499798142 0.35642431490734161059 0.47547114777119020568 0.19747954882605156524 -0.77134583645237175809 0.014627856855793838417 0.63573160974920261967 -0.42478504038005227006 0.9262929397782423413 -1.1053189978548216832 0.33049620446472127711 -0.69770116250623903653 -0.23981983341872462057 0.79476302636012474689 0.17538526217715583178 0.88342303151840229081 -0.77119665762247335827 0.95271678009132687581;0.31468462255814100281 0.86661084156328216377 0.99375575888381917355 0.1150965223973884205 1.6849646388781795991 0.2165150500921973753 -0.067657646855038847122 -0.015246992380815845014 0.40169977962661912452 -0.45717412376837107679 0.35592487726733135212 -0.59325589117335608691 -0.41151782569503275733 0.18569587416435601179 -1.2457295017418761329 0.28251584960185449624 -0.056308527230000113284 0.024291565116825293569 -0.38258835079241987343 0.66375039441035632581;-1.1136728855106243774 -1.9717832198672911037 -1.8576124101443107772 0.92168170423725748197 -1.5577621372399821364 -0.33834735841527757705 0.72385407150985003888 -2.5764680650839726361 -1.1027051325719527952 0.17196138744637776141 -1.0679607999927673845 -0.20922496560042908031 1.1891318977385461064 0.13942547016359302381 0.99036468762656404419 -0.58790137671442033174 0.35790379836472191455 1.243611645985899683 -0.024912611752763651196 0.80988189776859131896;0.96623305882174637116 1.2469730696597585151 0.54252627518313234489 -0.88534436269814797971 1.3426869766507969484 -0.86441703610473419328 0.39285531583152005775 0.59169723287593978256 0.35642962247534154541 -0.83554575505556749615 0.43506924417652559356 0.68869085565412446748 -0.73409924320604902359 0.35128167244244717926 0.66395100550168761888 0.26508506846884882791 0.2631666911609992221 -1.6226205007791385526 0.063939877328293620584 -0.62596901750318267865;1.0350988210730796002 0.93874009178323425395 -0.57346653212626763629 0.4476542313735903944 0.91561289849178550959 2.0952182096804476963 -0.19947294905301224399 1.5506532113568434195 2.0633250037872654659 2.2714792063886890539 -0.29579450153543118684 -1.5652694501178274766 -1.3000225834238803291 -1.8685329929295158014 -2.3981781797036876291 -0.92805897266302572746 -1.4246294519747113583 4.0036940776845657552 -1.6655488141117014145 -2.7724804059871845929;-0.058796599926357620558 0.33300901188430365174 0.41617499373485550285 -0.74625340636138015604 -1.2523584497742918931 -1.3887731153542908213 -0.25084764664903380638 1.2670365856497489698 0.22306192539916178119 0.63058070036674562786 0.22057372754188830921 0.90398385963325811332 0.025771859535664902452 0.25202166833878880681 2.1306040063794196016 -0.65409380487822965655 0.17681269405664498673 -0.35011944795547600418 0.34341332717623396231 -0.27224073749427218916;0.87726969457082448756 0.37618812923271705007 1.5665124029444335019 -0.54137721061116339527 1.6144829314514135277 -0.77337656586253444857 0.9880005690767877935 0.83535970121255920251 0.14292262618517537209 0.056579007592765725998 -0.23776398434320786257 1.2224332103764876667 -0.56822049815535857764 -0.020098066100683133206 0.026495159467231722827 1.2795895435250792538 -0.52643117763687230504 -1.9018299957503319586 0.39559319391504565999 -0.62046058058600606078;1.7629743992752793247 0.67270353269586236067 2.2954873717086954343 -0.06162243916035485547 0.51815643658679777506 -0.3649403990098629702 1.1034527268344682671 -1.1373226529117890227 0.78578308126774998321 -2.2711866467778474288 2.4167311399582045439 -0.7293900223716052178 -0.47254893575451833998 0.64072274682315499827 -0.99558067037759601092 1.6836660697387479946 0.051240681792502289216 -2.2226519414516534567 0.24109562072585388748 -1.4750055586759365234;1.1600962974158177676 0.82911845570297926233 1.0163192439491801622 0.10993064565743689009 2.9320934579788882068 -1.2448082384246081933 0.57067277670392924094 -1.739397336345783085 1.1811844631077708101 -0.78191752458038477069 1.0047150497091479338 -0.50241806788351250912 -0.57877139232103891331 -0.59402485779785108022 -2.0831808317091287108 0.17445756340286266983 0.26995647227766755849 -1.7315128097043368527 0.07328166499987506799 1.1053850774569482507;-2.3515369103706804665 -0.75667860736848413516 0.17086090186570246363 -1.7072485518494371348 2.4722545764416219427 0.345228236096612906 0.72131489510605117932 -0.26914130889193904617 -1.5295237227018265713 -0.82693260635647947154 -0.67466491853398702361 -1.0930180149827237734 1.5430480766581577967 1.3753717025250504769 -0.84278197394980214341 -0.80951935845153277782 1.114728675560139326 -0.10890116077292728847 0.14981868662745165266 2.4025248757750423678;0.1372453095669540768 1.1507757765443142883 -0.4474893737925171866 0.83400112971218598457 0.43033749107608854079 -0.78816414112099875133 0.44043973529806368372 -0.02660587692362553075 0.45187976575731697571 -0.32041129608176499577 -1.5423666978009118456 0.13468661018742975055 -0.30193921248253507983 -0.33125260721672583619 -0.5638100065936673122 0.64217256393074795273 -0.35074175187025063982 1.9692352981438634441 0.42860485333488756998 0.46923908805083136553;0.43955686073620353627 0.43347437256133641847 0.78175616632692102037 -0.49805814779146834193 0.44345797524031577153 0.52400223031237136428 -1.3399649334107190946 0.18633516194498514484 -0.12418637345923501381 0.32948628260260370837 3.2194772007406475822 1.5902373453993090546 -0.069969780461801925342 0.65530966069377283301 -1.6302988334966610484 -0.68133929295813644433 -0.13854300982561817968 -1.0249311657512234497 -0.26996875272831055703 -2.3752703165207798008;1.3177588311505910035 0.49911776275833197314 0.51110199768326580738 -0.11036581718862878421 0.51396047653982190884 0.31532519122978874826 -0.74318342849195706545 0.51707585904195207949 -1.6655296608670859815 -0.50636015056262362322 -0.21307806845854793121 1.2591855521361094983 -0.18471223799496117035 0.51052689459505895542 -4.9133588763290347856 2.2521286903034516413 -1.1781744064491046498 -0.51127180991432685797 0.80538050398461435986 1.0623250447658350026];

% Layer 3
b3 = -1.8225178558457739708;
LW3_2 = [1.5251592752771618855 -0.30816617268885387881 1.0436284660286332393 0.3101516183792237813 -2.0647064298472335153 0.59490551018963966357 2.4616115056194467492 -0.58967276808324575743 2.837340201261875805 -0.27135122477861950419 1.1003334390372552232 -0.12032519090671438267 0.90806887073175723835 0.67212539780255509125 -0.33224861491168627969 0.51996487921979528402 -0.23245954389796452677 0.95920329367789791686 -0.4095499442828550718 -0.33170533794197332167];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
