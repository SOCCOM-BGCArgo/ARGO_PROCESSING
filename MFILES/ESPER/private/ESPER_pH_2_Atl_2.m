function [Y,Xf,Af] = ESPER_pH_2_Atl_2(X,~,~)
%ESPER_PH_2_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:20.
% 
% [Y] = ESPER_pH_2_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.2178;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.5943143752285342529;-1.8284321284436877431;-2.0750199994244860058;1.2065571756978978879;1.1292561912721084116;-1.0062468052589865763;0.80019310715177660587;0.11104313955767709798;1.4769136207665729543;-0.44493449476342666893;-0.22688107528488521414;-0.52696510954155095785;0.78502658081015663782;0.83750821442261169647;1.1345411639502960277;0.8964317412549525077;-1.5847887290410063166;-1.4647931673614409398;1.7963007014201806122;2.1611838174741042629];
IW1_1 = [-0.59751338375105045309 0.46420000624372564912 0.2103729164190283607 0.65158597093241821252 0.86422360198607772741 -0.81229211097038367395 -0.37407486429427833086 1.2663236649460092309;1.0342400101819337888 0.045620049192800965487 0.59124299959731496656 -0.78618863391320381595 1.361310465089297983 0.2406657975292278151 -0.12371372939796440593 -0.44404139565442529713;0.30032482686910699776 0.85888798742391292418 0.41741161705274315574 -0.76262945789252911677 -0.69156338701011388359 -0.28598383948598993243 -0.20501357452537422033 -0.74173748679652495852;-0.93087246613230711922 -0.81221428885501867345 -0.96472698084307273447 0.64707975697238706569 0.040740669847633137479 -0.81010003354459281244 0.022510121522889007389 -1.0141962751789255215;0.0086969784899033480974 1.1396171416059266424 -1.5311693468609703928 0.056718760648301828897 0.74294557234838487503 -0.80926490963913211285 0.57145865629450531831 0.34361829204291949313;-0.12517312328004262523 -0.2456807947248542956 0.81698067174034705307 0.090501223292883917204 -0.56158069643491248524 1.3754638275004691383 1.3045347424901194699 0.24995632686871821493;-0.098006470797579653409 0.46624075932518616039 0.081055130440137540537 1.6115701042489452011 -0.70150264563695641229 -0.62515404619778924822 -0.17234892846508173547 -0.39174355944233441029;-0.47794414256384742945 -0.50563526525062296724 1.2596860374245666403 -0.099884353216563928624 -0.67622792978477797021 0.10097338793876678431 -1.9625239438705288642 1.8977126446994958542;-0.2693364144012835304 -0.40344845103086196536 0.97577625660247879757 0.50285260286921928952 0.73870752674399420279 -0.036319497144821147327 1.4604480537628159453 -0.049083770567782791794;0.36108350607313666192 -0.46903384284415228223 -0.20901350291727352482 -0.23455771354176219168 -0.77611342232829250154 -0.0096888890070316105452 -0.5261135543781391144 -0.84892781768072478332;-0.13444452246190460865 0.65032439528193475287 -0.81388874476389960755 -0.90176343547129800271 -0.2850353099118809741 0.086256530698131619883 -0.45185840267501198309 -0.35470964812149574641;-0.72369703700420029424 0.11326078239349947341 0.21787619638282892942 1.2540753145641170274 -0.6628121423576258664 -0.62705103362668279665 0.039095284911641020598 -1.2122426607827512246;0.44869460783700265694 -0.60315911071270345012 -0.23646372193160045128 0.1533311548886558684 -0.23297226581378119303 -1.3376268829219863932 0.66223227183955635233 -1.5663444022944159606;0.52602085731804948399 0.061099222065488220657 -0.27659835453791326021 0.33046037794273713795 1.2519543596176696543 0.46876508108008746456 0.25966037332682079253 -0.66791173512590196193;0.79112651043273762852 0.032835066397412258909 0.76392755383466093289 -0.19054579382878397698 -0.56368184040579716321 1.3672295189248948599 -0.37244622881559868999 0.4053973653483265438;0.41167793890654019728 0.2307977450106970807 1.0938069836155741577 -0.25395749278318269226 -0.72819296474670980324 -0.18194572819839893718 -0.66360919041045607347 0.68621163461199918832;-0.57974657184354483341 0.14222238818729360244 1.4379069003919415781 0.062757975095366971829 0.26331524994717675492 -0.62534035166548262996 1.008324840575873349 -0.3816542157907127919;-1.3302683599923634805 -0.83949384801155157998 0.93472084167201041627 0.58077370418716656175 0.25048472538532923215 0.96279907191870539584 0.6556889358166622106 -0.26604366545094648711;0.65142646172746221378 -0.25185902752096550605 -1.5777296360471173564 0.2993510001188542935 -0.68820246556430764162 1.2950158872829975465 0.50934593319121956867 -1.1883844080646750463;0.15059992306850233934 -0.24693781006905851649 -0.56286112517182840254 -0.60431650842657291811 1.1768265916850579877 0.6173936208468586706 1.2913140486659246964 -0.25286270370392516238];

% Layer 2
b2 = [-1.7117217252745753342;1.4212653174968874481;-1.2077206093682735233;-1.1478031970327979838;1.0057415077163471828;-0.6406976705384753723;0.51293288969859129889;0.55834036634631756257;-0.3824284142744302506;0.12295158153517635191;0.26442330484976556138;-0.21268089580885513046;-0.39134461896617978027;0.65111771166245224762;-0.70832864183332377994;-0.9900263825990635036;-0.91839681731752864646;-1.1746365675697003628;-1.4593844079855817775;1.6326706910517243543];
LW2_1 = [0.44212626674474692079 0.22849715576956711183 -0.20931141655144352987 0.30804929398664959717 0.23910650073684225347 -0.078193034934832122973 -0.28312655560375515895 -0.12907608155574518127 0.29589807304590759474 -0.13851977543345664334 -0.53542174260693431442 2.9647237682984238505e-05 -0.32526118036490275776 0.22941005881331899552 0.68503409786743718612 -0.68358979692989807475 0.52419133614715052172 0.18459022173236311337 -0.2661387891174250564 0.51459774592142482064;-0.23918835811854394224 -0.18578921923221092261 0.64239326445219768758 -0.18265004358950565067 0.63299755938767188201 0.30129152063891112556 0.36669879604005378715 0.49071558606354331866 -0.60191387814112173871 -0.096900678941898743535 -0.14766180818666577168 -0.40254230571381310888 -0.039931512301695129552 0.41841693004927732469 0.60598091729231806646 0.057586560444814478832 0.37234779091899800063 -0.28246761282318810782 -0.58320607834542714798 0.18102217542297005526;0.086233050136776012717 -0.73091637772554329811 -0.45396479793841665318 -0.49991371691112984621 -0.02720661708160755296 0.37743624127214597808 0.28140753225632098022 0.55312221101140668367 -0.16217977171180517071 -0.55077050287839302012 -0.014923765272647739749 -0.56282923553353536583 0.21518077186825121383 -0.4016555501571856257 0.35227305429055666419 -0.23648402572387142162 -0.36548052865772889808 -0.26602585315746757333 -0.58936774387699020217 0.59039622845273276308;0.70872415022940171703 -0.32473887113756011447 -0.66035750718821495386 0.065514624327541223781 0.026613445811323341306 0.29481970206357765996 -0.078556372670509758138 0.40845624644597772201 0.27141350151848125938 0.40280424024223898671 0.50628505375923371634 0.15829069128007292044 0.39929504020015432753 0.63872281483656956347 0.15708671442930297046 -0.33175747342822869967 0.38493241505597258767 -0.11681683530539144211 0.20631682290529410051 -0.044361304542783044913;-0.47799683653104590997 0.79385483433163550604 -0.60713349203249600272 -0.058123433179394758119 0.37746532540767863129 0.21855739776780586103 -0.22886792450016632539 -0.31480927043282747047 0.0085386981349625211413 0.50027607768378512532 -0.59564388265551848622 0.43150951452390745589 -0.15650219213256869044 -0.072294255011661368027 0.30163732448062086089 -0.6617779158447094634 0.51997936603179628623 -0.29086228143490810982 -0.16204729377009435831 0.51120609848273290687;0.42906734199110496686 -0.066005468689367491342 0.53383173035518316496 -0.37035819209560139065 0.32035119828915226137 0.32154239610514750991 0.44848465981796847846 0.2644217877986036469 0.29621714210394495259 -0.088510143918483469294 -0.27919176946476464973 -0.42865435441307681019 0.28140167737804483439 0.099951212895745100706 0.15704111586450472671 -0.78397345318757716282 -0.51903363993459894488 0.65921027947876975617 -0.33727325646990485852 0.10904898928767613187;-0.46141975005094204576 -0.12514805767057818331 0.039689608451715131798 0.13292316688414423931 0.65886550847677261 0.22799733394117180363 -0.72468149999091813207 -0.73117588314635617586 -0.68666550081330202104 0.19010724030087405856 -0.45578590369387755876 -0.030111631896225954375 0.19583737748755572494 0.094828633529632777588 -0.44967319861414756232 0.66801310182659967563 -0.11194952724775739106 0.59362363546683349913 0.57081458420938646636 -0.076069227867102517937;-0.042185545012592209901 0.22104629579252071947 0.013798315755948902667 0.45182789094575204203 -0.12615489017510578273 -0.014354168600022988375 -0.27851228363406804744 0.11089338749962913966 0.40972380087820409189 0.20787144722751543791 0.24257955841580819412 0.41871760780798678026 -0.39156597110931995465 -0.01085413612397853611 0.98004853244882406127 -0.76238392384933806323 -0.23866389123544243245 -0.39532836253499969992 0.068676651577684280636 -0.46897201805878474534;0.29256703056082739023 0.1985031392904569314 0.22192508740336214235 -0.32175103028928225823 -0.37166165252326821555 -0.2890187315661617018 0.74994413885013344601 0.58421989533020757257 -0.019252794547051085144 -0.34928675173744316851 -0.19421906459613125229 -0.34068848115548600042 0.47531482159863785997 -0.38291711069444644977 -0.59130650644346849365 -0.263163042393061819 0.40342654420440310359 -0.062134987986845899299 -0.31238014614909009881 0.16376805056325932641;0.16607134785465380022 -0.074669632967731006112 -0.063361472143644528843 -0.063932816758395100143 0.70795780519553530574 -0.086728122841428820222 0.26693305380907372815 -0.89375063475702276605 0.6514015247974914713 0.011050555353482351129 -0.80876782878743802563 0.72499124869518072334 0.29371168520531154567 0.71783064758255887838 0.67236975776701901619 0.49091410978008254151 0.36707577500085553091 -0.017353815530422728175 0.37432983258477775523 0.43168651388926781998;0.0627077456637924191 0.26170178911751956763 -0.76091505212745980113 -0.18203832473059292085 -0.1730216135277261591 -0.5990026863956248171 0.40012789422973127351 -0.60456105556944583768 0.91822035917641087188 0.034232272557725068607 -0.15621937399970739491 -0.076779427991305132517 -0.35957494375884457849 -0.1460427446652799166 -0.60285436414845705588 -0.47533221293968008769 -0.11512817878878929545 -0.50689366569757698944 0.54724310940373910306 0.046933468816381468391;-0.21735062089069509539 -0.407398063992905346 0.25303856750226672023 0.18625911812027162728 -0.5821563433949770161 -0.23104691395032167511 -0.53200428960885082219 0.57073002426733498993 -0.69310832533504240782 -0.34950650216981993257 -0.29040275676282634176 -0.097011338763304144628 -0.25474541650125609449 -0.41011434691000336894 0.35919359530732786201 0.054314353073322212129 0.61958148754058373076 -0.43333850527492995264 0.51749130343703353407 -0.25616973511694274279;0.21765731706912458399 -0.78851025122394791111 -0.85999035917931665463 0.079472881397818648241 0.68272430766666125646 -0.44552339726430562061 0.574434836519630454 -0.13865705852484311311 0.3438399560222650253 0.0060964315204681176347 0.067322262116679965072 -0.22526058376436233766 -0.20852706791104763662 -0.42414894964927613019 0.72705189310230489141 0.6690695934031237746 -0.10984581974342359778 0.62902262428971200681 0.39687017935074453412 0.43234549425862423;0.33935285982479640454 -0.43757169342150942226 -0.087890348837740522869 0.59512494455794706649 0.34680260207050417343 0.10705133233827912598 0.29434850355887476336 -0.83949591092239261858 -0.50004820448565800994 0.32537916795432075823 -0.17808070704583159327 0.77342822691692070247 0.39628467203931577734 -0.21781041976665152515 -0.15919424390257447266 0.91834830342911211165 -0.55750273733095634388 0.52648710900845274718 0.6510227907452007523 -0.30540096081973272524;-0.18846300641518998198 -0.43434554488599985689 0.15037614975150256913 -0.27502391574854312406 -0.25569721341171192108 0.55370712476936978508 0.48833135812376859963 0.53495144319770693286 0.26587615666540337367 0.053454309967267077397 -0.017444450803345647183 0.12658442707942346717 0.49079222156639212837 -0.046473954320291749331 -0.17817888840021037233 0.71488062939134078277 0.19188841880996690414 -0.70427170525350446528 -0.080722873347610565875 0.020165151647958009379;-0.32180915817042415883 0.53278294282945526383 0.31280113521903796237 -0.22019432734775451488 -0.72000559080180470684 0.066766011303223626872 -0.36778068996685603365 0.37146782759353363934 0.27247516121103515507 -0.33736436941062547534 0.37683834153202833139 0.20140953197422445387 0.46181258803856412021 -0.39400536094664478926 0.18725945420552286835 0.27955887126749900951 0.078251243599044395527 -0.39804271182547873442 -0.27677859433054302629 -0.14801437055723798419;-0.04102043272473608615 -0.50009812438135115009 -0.48506585135757268601 -0.36966334903325825945 -0.00491808566842645567 0.3032433557113736744 -0.5351407186154794049 -0.17117076394330718592 -0.10361009964727231625 0.19577012325490714129 -0.23995188997646679785 0.25657384623093909548 0.39627810806542873578 -0.56292042601433445181 -0.33211134130696651212 0.1467711904129089806 1.0786193228482183759 -0.30305214591642953836 0.57445536161768240291 0.036994964842797205262;0.066775977482432524734 -0.15618748223427880717 -0.14705788460095128856 0.44481911539187940496 -0.46187078339716497455 -0.60665905945196874072 0.3267911463530636107 0.42753498631899455873 -0.029951436093650380538 -0.42904130786044281098 0.42580943629650958027 0.16220759139846097074 0.69285075565567455502 -0.26931895653671900082 -0.61200862339132966472 -0.1147808352575294677 -0.41020618389183011177 -0.36825507586524097725 -0.068353936475767401726 0.48550085194113284937;-0.4726602990149895156 0.37106609779982807629 0.24240917502890776958 -0.60566784458606914843 -0.61629314142744195948 -0.46499076752466506068 -0.4829565610025202127 -0.050740188801187718903 -0.30385335336043001186 -0.25520173047695698942 -0.15996129324946656292 0.34048802045680548467 0.23955300677070628934 -0.16688762497957956854 -0.36777658915584504618 -0.55720820714630892034 0.12194631921691602428 0.0092638768198515745317 -0.15186028062713743947 -0.37846128832195935487;0.22701761179863086393 0.21638821307027517049 -0.47300934267931732391 -0.0089684104326096247828 -0.64052186569564140139 0.48528784392242080292 0.025905372659257439732 0.41979690059030111415 0.525039572757643902 0.037414758285933456816 0.35834393572968165076 0.54118688669774639433 0.49197283971644684142 0.39025306551815075462 -0.31390864713425764565 0.3539038831852439615 -0.063349848444273576531 -0.43360409979640263112 -0.22391876201298918647 -0.36200424870578018499];

% Layer 3
b3 = 0.89424916490943107128;
LW3_2 = [-0.36519958153197401574 -0.1492297830289301408 0.87241457122926724388 0.9477400562119336902 1.1047433150839414129 -0.6935780767685054693 -0.66385470441810356945 -1.2154823422542302414 -0.55055777910896086524 -0.86975898084036318281 -1.1205161409743857881 -0.53619181784352354381 -1.0650559881998320488 1.2785332885511411227 -0.54117159304012252274 0.77429614305666050189 -0.97786329368954849617 -0.76785764396836053702 0.71848010555244690156 0.24139136365138291751];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
