function [Y,Xf,Af] = ESPER_nitrate_3_Atl_4(X,~,~)
%ESPER_NITRATE_3_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_3_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.3258007451299445023;-1.5592266784441473071;3.6973212909050445774;0.85852195381205731461;0.56324021882872876699;-2.7346179539648924894;1.0047609535751649279;-1.9150357294095559091;-3.1436740628396542263;-0.98179215458624846669;0.53268568444892760994;0.53639797545132505974;-0.73938944388681504538;2.2549064812843542249;-0.22787625337954353633;2.5943645393121026466;-0.35011133085115475616;-1.2801295558522394202;-1.0169225334104392555;0.60917778233500752272;-1.3714439296134350865;-0.097002958567088307107;1.3831538370999612031;1.8712040723331992975;2.3194134195988680425;-1.2538009579068138954;2.0456543530262578656;-1.2494719611792333147;-2.4318842709550319015;-2.0667055087989139039];
IW1_1 = [0.46234558004732317915 0.28258768506409220889 -1.3266569135394359336 -0.28097293521439448138 0.30819943387763970577 0.18420081764805887325 0.81091548846577254928 0.2169353870137334106;0.92038914231202106908 -0.37409226916405285968 -0.11533103301116204298 0.53512142220459957276 1.420744493052256141 -0.33898831368258763863 1.9530537707372608303 -0.39803100497224580545;-0.6772651109958864879 -0.11234802862907314336 -0.1686986441082273247 -0.72720256303896801953 -2.4738942569572137664 1.6694646434146052094 -0.057846614314559355319 0.33560177341235397641;-0.43925514644068819337 0.090874907797047377311 1.1095876967194897578 0.11627862489040448335 1.0506666521844463258 1.377732821039645561 0.66999949808063874457 -0.48457261983663707516;0.033467218436543801074 0.75257982884204355223 -2.1568981381914746898 0.70906755707961865998 2.5971826042644323707 -0.29891132989150387411 -0.58491486539901804687 -0.35442973097139612859;-0.52012060299610607395 0.79462903256699179977 1.1318310745826487551 -0.59632217444631829828 1.0209221447648302306 -2.6610850576132873968 -0.91265248214744087996 0.66100672278666527948;-1.4233046309330479318 -0.10303551805286298437 -0.42815771728892781933 -1.1582364033274097359 2.1163168470393496357 1.4845915269594964769 0.62034091280409475733 0.52490741054631373519;1.5585739020501447882 0.049288410370980369202 0.064515977511308900127 0.35617141209116065514 -0.36264986535532817147 -0.88241596242226727487 0.050945236709029693978 -0.15018446219075118342;0.39425638354630571092 0.85995940049504815406 -0.45739962049044130543 -0.69116159061157067534 1.1811155017268952783 1.0589599002054268517 -0.49960334260893823899 -2.2772128227501018394;2.5451980629802339884 -1.2406402985457871679 -1.0408304969451218636 0.26306936269933317574 -0.27148000785016385139 3.0592131172635634861 -0.16101243481266860891 0.75942975128342993241;-0.92710466900633059506 0.96590884264671028614 -0.31709298796700546852 0.87907074216708058767 -1.1567492578404803272 -0.36361906300385493651 0.38804155388520850112 0.87180381179283172877;-1.3178407731973276196 0.68083248355433656496 -0.4384756549621824373 0.56091442242210620694 -0.52417575260309301477 -0.26683712311827084696 0.27991612404707222339 0.19488503956944053241;0.040453447710510070934 -0.36584615044053242494 0.24161520641819375643 -0.9203320002141736067 -1.6170863853855199643 -1.2374067695072070716 0.22743869228502078261 -0.6500100582112871006;-0.70086961546522819066 -0.98594235050836809275 2.5870499420347208286 -0.72812950940461307336 -4.5532986286271777132 -0.26923713115206393542 -0.20650648255798348396 1.796602735626458891;0.12082421745577529015 -1.1808536068000392572 -0.48883271675999895312 -0.39075731836673349706 -1.4692008954197866011 2.1453185287403240267 -0.38842713829401298575 -0.7576629521003159784;0.22914888156649007578 0.22113538364915238943 -0.00025733896965312620664 0.91986997222530708651 0.9450743153784549877 -0.25919142585184562488 2.2810893744618900847 2.0271409832560287612;-0.35329107100130197061 1.2247008860684009957 0.83776537871179679318 0.96706749355233756482 -0.62623045497789953107 -0.099797279359098295393 1.539134233391473261 0.37791356598075315221;1.577848292244433015 2.759874000054233445 1.3233268018336015182 0.49755404173508116505 0.65403738731567795384 -1.5054191688560762952 0.48658187882253456369 -0.3662510997024527315;0.16940829265657020297 -0.062667320785784352832 -0.80024494545085167463 -0.19985632262824140626 0.74864602234972399408 -0.68122714515611537678 0.84071832363119303189 0.86093510244134596743;0.15406187820213232409 -0.20297629245538895137 -0.19589257988009922684 0.58444771039666310042 -0.50452415770989278432 0.5341083411730498387 1.1201949991281960894 0.43642765012495138288;-1.1600507493784553148 -0.79158445523955056622 1.0262073728827785235 0.18232307465800048907 0.76162612814959973484 -0.034501346737641498674 -2.2895914973679860616 1.32189648131736881;-1.2532219227537975126 -0.38871339140890687203 -0.60451641073318951314 -1.0626823108360592407 -0.32780008508328101202 -0.085613961068179603164 0.84625426052486507622 0.13287421156504469755;1.8949030480249626773 -1.6827019552469111296 -2.3070487246185926722 2.0749806096401957056 -2.18643237914273314 1.0214882216675689186 -1.1423897029770586631 -0.47828920870287555678;0.88065484571684471415 -0.72450131273473239446 -2.5619441733539112249 0.7320135056662839812 1.8748604921158000813 1.0260241930778757347 1.7316019462287457475 0.35703215833970469717;0.40753292285445347209 0.64003187439897557542 -2.2982477397967655541 1.1687950594781952862 0.42876675527409763289 0.64188646517817604664 -0.09502166071800971503 -0.32692145090737095847;-0.80894755846356680706 -0.50502781547632913384 1.2164197751597365382 0.52804178280030000803 -0.70986953241165773321 -0.36460987435161157366 0.036770700850603244003 0.86196886881774781308;1.4711414442738326436 0.39916321737101745359 -0.58869094083847328669 -0.39744789127645580029 0.96397044920887131614 0.34481546316088390602 -0.57130308011497576981 0.61584988826563213937;-0.59182317594952826845 -1.3211876782563707344 -0.1724750594786758906 -0.79927116926629604432 -1.2240131211238913789 -0.42702031248072808145 -2.620971793345048706 0.25680391544956615579;-0.20235411992051718921 0.21773348334528441761 0.35449493514289287521 -1.4327631811411600804 -2.9421127689883648237 -0.97745074303279722017 0.63908284409970617101 -2.9873417005687117332;-0.60938898644262073923 -0.23746329609193372878 -1.0745757945745084694 1.286857070490324606 -0.73086326918958766097 0.17368815095880801858 0.8373917850265238938 0.78704632244592753754];

% Layer 2
b2 = [1.7181609697511281976;-1.4237476520106580047;0.68864997831172380938;1.0051761991729359913;-0.57937687848376528965;-0.13300194735433779059;-0.44215481847159721074;-0.51394022471536260355;1.5664550896676658898;1.1228815129261566774];
LW2_1 = [-0.24490983600894689065 1.737966188991190597 -0.26742207612375595849 -0.51186624035358530005 0.13979584915820755797 0.41810997708321623323 -0.37746457698653751445 -0.58197318595335867375 0.4151889647788469806 -0.92069255717245190862 0.4842856341126917652 0.51187065061361725071 1.4056728018556137183 -0.70585861107796277203 0.17065421226641069863 -0.60361639429137303736 0.20091921582840763238 -0.57966590596913936118 -0.99499009367118662617 -0.49288421979876834156 -0.31528809089046655467 0.31480853276461745471 0.53295975975062093166 -0.069450144135598301798 -0.51543296305378671907 -0.3464429986082065982 0.43255802408389770752 0.037086287908171665373 0.47118334236511627555 -0.44211600447692817051;0.0029783792833184691284 0.50840394151214263196 0.17456269634396526236 -0.069319314239180696013 -0.27787287742315713857 -0.65028861299542783936 0.40717411114528001548 0.51702198723256231894 1.4757591895575834506 0.691046929553449929 -0.12419687736035184278 -0.85049880942778921522 0.85484345805396755313 0.58908572486981869432 0.18464872448314964548 -1.5662244324002332352 -0.085503983057445762106 0.30345494078307533314 -0.49976643703977136068 -2.2027710084361609155 0.31017288915942453631 1.4477992294197705725 -0.52142868679625775652 -1.1710372963903503685 -0.19456816652913697108 0.045877236882001792839 0.88307924636335954904 -0.2781488647647533119 -0.80743683214694217387 0.081369382320378144668;-0.50212258360697992199 -0.54098568422708326331 1.2047693713652429803 -0.40482975479190663748 1.2290888363457745935 -0.50756661713284523252 -0.5040828662577587771 0.83039312455745573072 0.8547433095300412953 0.090441203157339389307 0.10759169280000921431 -0.068393340443315964183 1.1860781575602297178 0.18922428983225089705 0.15897142657075485905 1.0045870803542669147 0.33974472662836940895 0.02498996424406647876 0.14443889329746856243 1.0729699341770633225 0.93835780022823955804 0.012229359413071070814 -0.029586767261458937761 0.35648896390201373352 -0.92786586334330733994 -0.28094726697088395762 -0.32022251289220204917 0.10894893895692168984 -0.27589016636793423087 0.76227736506107357517;0.84439064174051248202 -0.69387360344460358164 -0.12687424345691336591 0.0010943240319153365106 -1.3100513011297960642 0.62092440434674911476 0.1238712309115632404 -0.79564691255381048141 -0.00086060443168115008383 -0.56795061214551678663 -0.67183708512602591245 -0.52691131229456256158 0.19973939082440170245 -0.5489522920610044876 -0.12026300120570802832 -1.7861110156047428354 0.24390554235832825891 -0.11828862712620191733 -0.54847766834308786521 1.087259399448096131 -0.55412971568709534775 -0.64463049745867295748 -0.58311452568393484786 -0.56691449321945419637 1.7154112164739185875 0.0018994600063081401586 0.43939909836860852055 -1.0764263591256599817 0.010422312477281328591 -0.42797162597414040164;0.086875486093997561499 0.57135886505539745794 0.53660840304931234357 0.37044972662422281928 0.82900436649075903706 0.75186036017002899623 0.20730681844341369846 -0.017824080785146929201 -0.71654958829782833263 -0.73636894152973220162 1.1816831146829134269 0.72212350092207444607 0.31744276192680664916 -2.1127041366105920872 0.13197852212836541641 1.0923311107015085675 -0.70743783875079202517 -0.12983966551050410421 -0.38714029538798255814 0.85056720855159617667 -0.70391930559185389438 -0.84334774271305679161 0.36679842503918330676 0.42303773344832179548 -2.1311392889358322655 0.13864073792287692766 -0.24071751059897630864 0.89966829834627792817 -0.87523845541315681285 0.28694988121303077744;0.81062346787056493991 -0.95680109044375794003 0.98444315876602916937 1.1297767775186837724 -0.12836168978045442435 0.35499276948371100149 -0.86003914832065508911 0.26388533719354162477 0.12905304322348359891 -1.0554559335649029705 0.53066080168165985498 -0.37294231286332396591 -0.4700053652211564903 -0.88354575952719727194 -0.70717807260887932674 0.36394382535221436736 0.81533844231410468328 -0.85299986438409403089 -0.30909676599267271735 0.14394135147428885335 0.28222600795653945971 -0.16502855850584616237 0.80213361742436029012 1.4991344262367052309 -0.82272247501840078954 -0.072074661624453084663 -0.082468907156420342974 -0.50274603473986656521 0.36055200979903140324 -0.42809000079784131909;0.63823140168246228487 -1.1323663088878404004 0.17354039638907883814 0.68838553675335234505 -0.10624325209777879531 0.09128310964382495285 -0.63011892105688571686 -0.53976261771979372472 -0.89970505733169758855 -0.79730531802713400236 0.081056312378970457599 -0.27057643588580104765 -1.0176365367615671786 -1.030799258067315094 -0.45787514477377466715 0.23388936511165292487 0.33850156704442657674 -0.62341499990141824306 0.69382587959186137194 -0.31318891386206998417 -0.077695546219128358567 -0.13233750074015163123 0.63908402818512088928 0.755627740455867003 -0.8479796911312811325 0.59030373229666088797 0.24527304246935924259 -0.62850893701477572595 -0.14945395634391642203 -0.5593878470979466444;-0.21434639638315822197 0.09749560719011564347 -0.56224183588065812511 -0.6063555056780213226 0.75678398538485458502 -0.57880970521256669414 0.79453896177677152401 0.70736482573958259223 -0.51980960213568039308 -0.12340767928742545079 0.22022551231387524351 0.580965880427709358 0.79129353019191273066 -0.80869247567069291183 0.42928550636749379654 0.28629476641255841018 -0.028437638156554284619 -0.12413062958568192584 -0.25370073131958387203 0.54104160564800451994 0.46358864878775690732 0.034417735443748091739 0.052403922184463692935 -0.36497366836368816401 -0.73832548076300885675 -0.77544523392883513147 0.41300686444447698431 -0.050830786911535315309 -0.94426088474247393822 -0.54256878294624455439;0.58553259357320064371 0.59657039677500522945 -0.059195991905257636101 0.12650975911323553147 0.088332488588928698148 -0.21941572741965670312 0.1724429287616128792 0.67721714261231347187 1.0035959143344794775 -0.4716477757048976871 0.015754215994227348252 0.42007067601942815749 -0.16351409795652363521 0.026152464776335947183 0.43300473103980818834 -0.14157048525297094566 0.36622630185402055281 -0.30172494518135806185 -0.83448376022982828637 0.36886145976035811245 0.37998560863067321058 -0.058587014762760777908 0.21007376031331539967 0.10406702667296977016 0.11567770059734923394 -0.76396667877232882216 -0.027669640750631118581 -0.11556884128644738519 0.43088121283349084534 -0.49496745900912453298;0.16142911867468587306 0.23599686188546203924 -0.82976445097042261789 -0.13405980690504112895 0.36198396428815926562 -1.0483389780326521912 0.15694297074777002754 0.17555041568436866029 1.125865267269276826 -0.076054152602359773039 -0.34466065950015234431 0.36475238322698727567 0.31535233423033437461 0.35466401979625405971 0.39812029825923000992 -0.37818382739292832895 0.21374155365938168893 -0.093178767384680435959 -0.29188971782917016995 -0.33998522605460057555 0.28675003595020021052 0.046621648757855620182 -0.18875674976032502661 -0.53854452756700965654 0.27830658027975285762 -0.56862249542914100608 -0.20893096042073650009 -0.22524271474898949208 0.12284490634873741766 -0.080292709912791151994];

% Layer 3
b3 = -1.281436968978680202;
LW3_2 = [0.36556699060073033491 0.25772062305090692735 1.7066575263415257879 1.3393107014680478706 0.59637265479025625137 -1.1563087595555059384 1.3198999825602550917 -0.79414320045644093415 1.2747053775371655071 -0.79033788386764236567];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
