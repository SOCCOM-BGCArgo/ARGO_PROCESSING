function [Y,Xf,Af] = ESPER_phosphate_16_Atl_4(X,~,~)
%ESPER_PHOSPHATE_16_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:31.
% 
% [Y] = ESPER_phosphate_16_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [5.9336770792187758516;-5.29634269457499407;4.3661440309956747186;-0.90364357416013618707;4.834618126846388364;4.798780652336000152;-1.6567102039677616965;2.5170305299133821642;-1.4274329916933572449;0.88559476559207495061;-1.3743062972243438313;0.60542962910927666798;1.3331496869809333905;-3.1995461067198656124;6.6033847027612173619;-0.027515203326338062706;3.0914540194396686879;-3.0020427189218987785;2.1183476313723748063;1.5030823006578220014;1.3409105680561281826;4.2462597548802127889;-1.7036098191435034011;-5.3783290193924599976;-0.8531028391130546229;2.6909244558593092833;4.2058373430037230278;8.7884154333735935438;-4.8372132881771348067;7.972472385513196258];
IW1_1 = [-0.66298305987086858515 1.4662882795349687637 3.0462298023917711021 6.461558029325320085 0.34058842976537750946;1.4464387563886902388 0.052024273206371041134 3.253269461835567089 -2.1378318423215469934 4.0111764361773580845;1.2494312019349327336 -1.7421060876836289566 5.7219774733633759212 6.5182975022900633277 2.2865611129648022448;-0.97271194712559994056 0.66282592268514406442 -0.67382222103414624037 0.74992678252670397221 3.5423099751004500924;-1.5166851332072923686 -0.053423165191620103354 -2.8231190033511235349 1.9061885184401561322 -3.8879324968603805601;-0.71160432607076151701 1.801488263662721856 -5.6557770943704053224 -1.3964545583685494812 -2.8707963690246440791;0.20701587735446225214 0.26616233572241138061 1.2967832585355785202 1.1281623917689429515 2.0499436978580316548;-2.6858650342527390364 -3.8955928390713077114 -0.92866357946711974858 2.0127028844317331746 1.4690515729295434699;-0.70599272519012779004 2.2629619265555906971 1.4632607252967970712 -0.64627022274545842251 4.0860915202659846557;1.9107512862386035746 -1.0531536413169608757 -3.5310215048540727345 1.0597182612588857964 0.92805694895785273424;0.31735282720283647384 0.55396845172496866905 1.183077818498060374 1.5294814343097324905 4.0720315114024483449;-1.7017834079952298687 -3.838334779303050226 2.5785908650514386409 1.9358543388339830571 -7.0558124227756069402;-0.86065896086267967835 -0.86550743755302250726 -2.9293855428490056525 -2.6624983260999188772 -3.0733983593818270386;0.77721588597568624923 -0.18278480983766359769 0.39313173263649336953 -0.5732384985276380851 4.3892859615013186669;0.1768183053361566115 0.59388856488868169148 0.3777259661984596617 7.051842905437848863 0.17867722521411727454;-0.27050164573669305268 -0.095390766279323982446 -0.78781314838145766188 1.6468431838435113601 -1.3847154869306583791;-0.80785722466351717053 1.3922818351051686747 -4.7635346862648848543 0.64116640915044909033 -3.1837785765896788881;-1.741944606473049717 1.0545445792282852615 -1.3965422208407292093 -0.31621571785222440942 5.736410560618374177;6.8882933574843745461 -2.5574325179816259634 -4.479343818490337803 -3.1889134251748787463 -2.0073542016351622053;-1.0074562935457480606 0.57700210351149539001 2.075492357691826939 1.7463315028603225709 -0.6582241097501796423;-1.0598965169623542071 4.2727484819222034673 -1.4426699967812544045 0.045545428919899787201 4.5546386888519894143;1.5587228037029163819 1.3752282783046012593 1.8125068344972341539 0.69097148602981406373 -5.6138308770721785379;-1.3621342953612149973 1.584884222881418836 3.2106386261168271545 -1.5456373895695634246 -1.4248682462797235271;-0.36721161664286822157 1.797555853818536109 6.5265442324054001588 0.57807067344467688574 -0.19239359055310015223;0.63347801172419604399 2.5150289232013918195 -1.6173048813178936278 0.85792315947121622344 4.7700355112849317507;2.4792135236533985321 -2.0752327412213054103 5.2123361968335588656 3.7550775626161301268 1.6061941596710918034;1.6245997703997858697 0.98751898985696173749 2.4474324812591490286 2.6139455414055561278 -2.1807101745423418393;2.0585846384625279271 4.7089194615844558456 -2.2107695140485925656 -1.7726425860418246749 -5.8752593246933670912;-3.7221384324308939284 -1.0968886414798306728 -2.2109811775583763094 -3.4136519429267226933 -1.7914403286733884269;-0.089000122121657421204 1.016495607485832009 0.88564592114895046571 -1.7263008544579423464 -8.7021177819127473185];

% Layer 2
b2 = [9.3380403395403259736;1.4611566244621314592;1.0695624383443647076;-0.56784925363406535403;1.0202786706327937605;-1.432765187527120565;7.62481293181979769;7.2981481347383514446;3.7649094042343707045;9.6569713299338708623];
LW2_1 = [-1.6814547530115697693 5.1689700677079386537 11.074826071804606542 -7.1199766265066779525 6.281047375400068411 -0.45070643895183737371 4.2037715216974378407 -0.10508771124232779703 1.4220402162915788402 3.6151877760979709286 -4.2808382989913704719 0.11570377337477256996 -0.84564746478839714072 1.6163305404543246713 4.1515220917626800556 -2.0306639175974376954 12.240900316905399592 5.5224618465949930624 -0.054531369192145344449 8.3389994945267442716 -0.62708097326170053609 -1.719980588679944411 -1.5089262586991711856 -2.6129296476851608944 0.89307462420169403394 2.3853552377848066257 2.431599173725482288 0.29759795322151511021 1.1588439454307142285 -7.1489391033607132542;-0.021169865630914119076 0.3378276981044017746 -0.02063981084274941688 0.64382070284757642042 -0.079604373793909249946 0.022523071673801867143 1.6250812808516301722 -0.20890924903642182908 -0.326622461255417329 0.51309527690317024984 1.1723759676044211986 0.73705348234376721894 -0.084659394715432406686 2.7302059021647564485 -0.015075615731676214951 0.29050867247670020266 0.12728427804774003484 0.96144532957634076809 0.041971116397198096615 -0.39425321222244069652 0.75178634824352885691 -0.55352142227741052416 0.77668457942562652008 0.90718085417900717893 -0.26910621112619870221 0.1130137867563452414 -0.35916628137856310143 0.83383328689389935029 0.81878323034060829233 -0.012161140337254437022;-0.0016955845001737801948 2.2620984147019744803 -0.11356462078664816828 1.513459535696346725 2.0178463549579301883 0.37032834694563515621 -0.68819300162554875033 0.42914727127317831012 -1.3747569513124955343 0.33801508282273695638 3.5445318950496025323 0.020533702688413812965 0.47271266352061158678 2.2932422625863777554 0.27700537376089939823 2.2305526129550337089 0.10409966306612498943 -0.84206245818600045094 -0.4822032714740114856 0.03847569740700094304 0.80862672410713221094 0.010853798191038549134 0.96845675283074217354 0.1008477420303013905 -0.75997739322162283226 -1.1334152859441357641 -1.1679550005910721566 0.27590305892674121813 0.33614886855965636636 0.56100566970413023871;-2.7975450929122098742 -2.203496299815184134 -1.1022254663795920671 -0.22977210731004021893 -1.2738720386105053528 0.096954630123653878782 5.8008947344718357897 -0.26904484563179059675 3.2190787973042187531 3.3866867785497687393 2.2107444580949633384 0.83405547918814959552 0.10449824027582330088 -0.41784595857621509296 1.5859344454259327595 -0.5012486346380796709 0.75710202376999058416 -1.8525398550489819982 -2.6710460798735944365 -3.3037733380143889939 0.97052674884522438514 -1.0471370720424821865 5.517490192014488315 -0.28287020460675443845 -2.2478965188635955386 1.7534691246979379198 -0.27446632193856573823 0.34343694857584383673 -3.3477127333326706093 0.97113098836602229635;-0.62912481656256258322 2.3302391031695952606 -0.062822296779288189228 2.1006328231528601513 2.3652387311436600115 -0.13094242025999311418 -0.086293725214700009452 0.23639306003613216878 -0.84499367893176069444 -0.4922592852701696553 3.5250846626298746322 0.61179910058527020578 1.2933700173002236067 1.6720056098377000797 0.76562630904774309215 2.2394014588253270404 0.32673633312309924293 -0.88848618483421804015 -0.3346299933324703435 -0.24087977390588402593 1.0011413151652996945 0.55804832953976191146 0.15906100992660809901 -0.48646362938703907597 -0.59879434898980110624 -1.1964579840871321093 -0.98951271037047838774 1.0908648343951796722 0.25628017756295007334 0.9155865447114829303;-0.02493600973453162159 -0.52325430922886684293 0.12845099408986898615 -1.1386874245239531067 0.15933720038915227812 -0.003296070064812529378 -1.5069679775607436323 0.22725828659056676595 0.66116291573141305893 -0.68509175279721312712 -1.1238929260172783042 -0.063752466945076316507 -0.031752154058326910457 -2.6548852099089184087 -0.069699715126771033535 -2.4707100596168420914 -0.054283382997135483372 -0.70141285427751909332 -0.166991459931003422 0.49211758752901663128 -1.0501779601122906982 0.39391567404842381395 -1.2393293834859588909 -0.71441331850716793817 0.39656109838979752835 -0.11918735147686980447 0.38956543508532998077 -0.14339695612791622525 -0.73335774536249698219 -1.976108012917583201;-0.48829326373260389937 -1.3231320993517983187 4.5004131634546444829 -0.16523536735768790118 -2.9594170954784102534 1.4102703054482135236 -1.1009168868052856549 -0.36909365259138193771 -2.1731976594320441265 -10.556041114900459377 0.19529580316999559098 2.5256011273773242287 -0.19348022011192939074 -1.7114625899774396078 -1.8130038413920197549 -4.0696499187536998576 -0.6133410632990184963 0.020580906043370122971 0.8301192068067440033 2.6646029717101109568 1.840125256354142369 1.605924476919861954 -1.2530599118455347796 -2.1331954794216216875 -3.9167632540404020425 -5.7213042678113685824 0.55353264166471216612 2.0856505407418852727 -0.76842756505378129184 -2.4398154832355487542;0.90349131846097019416 -2.3827238421832763748 -1.5463194315641837218 -0.98687735475788063155 -2.2229849543108213261 -0.4994046360270532614 0.66824253191022342513 -0.37401451053217316112 0.78534645471163955222 0.80302309871030752575 0.90184684925321434434 -0.37343974605243601683 1.4483467961305822591 -2.117507047046598867 0.22726875010430613866 -0.86590675349976575781 0.50012211351356683497 0.89635182897489895648 0.6540513202939909343 -0.617743976994901689 -0.28169862995674604944 0.24248464088501781033 -0.44648732513274802525 -0.27243675862782468222 0.46809766247859502242 1.1312298977641586095 0.41336854208449463899 -0.55995464014649221074 0.96696275751157945155 -6.2035399220036779866;1.7188838759736515538 0.98790942494520195272 0.67823533963839832683 -1.8543095968536136287 0.0093893074647395345644 -0.37027812441670887589 -0.19117999699226734256 -0.61230137933943762363 -3.1128539826080179331 -2.0985053823881072432 -2.3420396353492893837 -0.65877030135596337246 0.51427945364268334849 -0.41562518786833713147 -2.6574946584617142875 -1.6870647836625793925 0.32200554351619570248 2.4171320158942002365 -0.98805567762076362825 0.2862059772744641184 0.62593446145520115209 1.4080463779236684907 -1.6661439688330461628 0.038207047212776512612 0.99387165986464021117 0.55425441909947514851 0.77669871305624083035 -1.2668901132144254618 -0.76898821413269791147 -1.5213414081981417869;-1.3514621884950417385 4.8452676955043969542 10.530191206113210356 -6.0241954358218681165 5.9622358393154950562 -0.51089202774914566074 5.5952484452416353378 -0.00025200107977207253504 1.3931153661039652469 3.0154563488950891781 -3.8832685090729839317 0.16679237955869596899 -0.44334077351488787588 1.2500731014707444633 3.9701318202445330385 -2.2555835917280604441 11.673263215151703065 4.7795033812357443637 0.043326368744742493888 6.2550763610262958281 -0.71833397355273664875 -1.6259785458928475155 -2.1874023676912752734 -1.0238408724196610411 0.90596176799090977205 2.2152262734833074731 2.1489757599535872501 0.07297049168129707275 1.0890160180206100993 -6.6013477412118843901];

% Layer 3
b3 = -0.43832800240010044712;
LW3_2 = [-4.533558521743046299 -1.6344996007130081495 -0.76370421997868875863 -0.25567943333666354189 0.70820013943540194301 -1.5465617145796022314 -0.14717172472222450619 -0.62322815402265663298 -0.28830421445149800874 4.7665815971482432545];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
