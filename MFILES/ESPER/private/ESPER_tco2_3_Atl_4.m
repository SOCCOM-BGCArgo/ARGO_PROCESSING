function [Y,Xf,Af] = ESPER_tco2_3_Atl_4(X,~,~)
%ESPER_TCO2_3_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:53.
% 
% [Y] = ESPER_tco2_3_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-177.232103709389;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.00425400504498441;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.4922301732367087;5.1465962912821777;2.3277777743211754;-4.7055111877075841;-3.2066912062559543;-3.1780412002297611;-1.4500787972533311;-1.7191466444698873;1.2444523053528846;2.9595523852294288;-0.94690430184398044;0.30507433275000945;-2.0980006199309993;1.3954281205553412;-1.5379028411838989;3.1131110423570645;-2.1043216184899007;-0.68786991173783063;2.2335865119836926;0.40558732361186417;0.69690954458220777;-0.10814806632080198;0.29535905707488203;-5.6968879862536053;-3.7281613802219198;2.1305830912916219;-3.3377622868161927;1.7126776674821405;0.30649907335315568;-7.2241338479140014];
IW1_1 = [-1.7540665160005693 0.46175133753134689 -1.6644964124075554 -0.16257799722954033 -0.84976425927437582 -0.063677344422609625 0.25757223755898068 0.13293748629259727;-0.57003418879036738 -1.85584613630336 1.2526951313076671 0.29861717420965628 -1.4539394976297959 1.2082241435062597 -0.85742231713602535 2.5219429005984324;-0.1614608510558464 1.452869331755839 -0.56811015125589204 0.89423219325141667 -2.2948641676514629 1.312694593706464 0.4860930941137932 0.060063743506778657;1.4244854436999534 -1.4347068632125548 -0.10354015839012422 -0.8165597800992227 3.1428930793488217 0.1312609889247322 0.58256588011437305 -0.59256506268705622;1.8660607962303921 -0.70788148089194713 1.6281742530468353 0.011129330415983015 0.93340897326840888 -0.10257712194825051 -0.27155703149921817 -0.41724245425677087;0.11567341282321751 1.2492001116726292 0.1079891898517692 -0.13711886668173157 3.4392466643038708 -0.98328689512805922 -0.47563000735447236 0.068040805167229018;0.33345729925952622 -2.5754177809464398 -0.64441020305967101 1.217371763895577 -0.27022114981414364 1.6148769747453251 -1.6415695770327974 2.0962174271321103;1.1538953388926563 -1.1683435521662255 -0.91370777078395771 -1.2561959989320264 -2.7856809849068696 -1.9522469592362763 0.45902271809901668 -2.1251302889214401;-1.2105845716985222 0.11218115845581481 0.35709340700979003 -0.23521929377104528 -2.3667787755853222 -0.14046606592202998 -0.25006307688882118 -0.082705047585713481;-0.85942544582583746 -0.16824623970014352 -0.84359738521951355 -0.065959821537124236 -0.6876215628240776 -0.66927217822764296 4.977912787659351 2.1185422499057038;-0.17321520322688647 1.2276152272002989 1.4082565142211336 -0.14579783411193922 -0.9116445794209842 -1.4583272005341761 -0.42964361637404302 0.93140564810677695;0.32759394547466242 -1.1695515647598291 1.1358636906606669 0.82063539324969981 0.35994691863539169 0.69203883464592608 0.14510638095474565 2.0846210521188095;1.6060332579424956 -0.544530765396956 2.5728757765245218 0.38550974454164616 -0.73002946336276797 -1.1683854974586092 -1.8015547637500247 -1.1173000318881783;-2.2965186753494771 0.39423252453867014 1.6242507784898934 -1.1010884173471924 0.81268411404382512 -0.056778346077777056 -0.031297153627500129 -0.16237107821650085;-1.7095694912373964 -1.2461311141595883 1.5045660783224775 1.379595596543824 0.41199118698193754 0.44415242041869518 -0.33396057170138732 2.1975485314744407;1.0500077655792341 -0.10060898305352328 0.73639559243775843 -1.0441146834514028 -2.3993183300401153 0.56481053832971484 -2.5020825157277731 -1.0840981066045579;0.68102714654034058 -1.2445565958788256 0.2344553101231602 -0.39275103288230073 1.9783445158868245 -0.84051167725527254 -0.22065062333447921 0.91320221549458147;0.92741362995810073 -0.4685746896835577 -0.040594962200387677 0.619200086624623 1.1241946330432406 0.65253359511891562 -0.30317996361728394 0.14092902907054214;0.26198543288443449 0.23467175281001448 0.45364396606645963 -0.43083940303201146 -2.8386989504653148 -0.16129088472479691 -0.1312300994423462 0.18176358826107561;0.95808684273394829 -1.5134741879309981 -0.86055431290396256 -0.82135036258499494 -0.16541287853879352 2.9860925331513646 0.31572169810988066 -1.4977527574213778;-2.2989927545277165 3.3126206552465347 -0.76854787429076854 -0.65847360157944257 2.398401661730091 1.1648198968435997 -1.7869521970254079 1.2905518828917222;-1.2696715359701614 0.83467987358822893 0.11420583267001216 0.4623353517770013 1.2369668513722964 -1.2054049623455969 -0.314343759420533 0.44036639065193889;0.49657845945646989 -0.55678068933976321 0.087027527452704867 -0.39790251063967585 -0.51857883511047997 -0.63733955285488475 -0.37516976772474958 0.72205302387824599;-2.0170508198940085 -0.21022268128895216 3.7544065495641523 0.39691946378627796 3.0894947511964941 -0.1215427100082911 0.42401273373979087 0.21168117361803096;-2.4954397621694526 -0.2834105382932452 -0.35781822761075965 2.0414491789325018 1.6404591517845177 0.74877498699249034 1.2586897509905748 0.66852803216715129;0.29610433326541497 -1.7239240560595723 -1.5466606365940863 -0.27038873144464082 -1.1204584002846245 1.2627817727359962 0.013020838797337439 -1.165542103290276;-0.28203669184106916 0.44991920874959251 0.61025400682972708 0.074612643310395299 4.6828186516444283 -1.2913101685747188 -0.04690785475698904 1.010862101513327;0.62873452872314439 -1.2311239003930541 -1.2139769154437672 3.2106116451191613 -12.69289737524112 2.537184903360564 1.7929043364830581 2.1757423840785735;1.2603129180860098 1.3242742542035209 -1.331100567993118 -0.78634251802924937 1.2257238610224555 -0.76996072156847872 0.29933727184150466 -1.7139550400395269;-4.2303737704149684 -0.66265962940949197 3.647311444427721 3.4660666031956344 2.391648882726213 2.4204273217703598 1.7398396309899145 -3.8005783570449636];

% Layer 2
b2 = [1.2398072279708245;3.0850516058737942;3.7630504148177675;-1.0290171158989612;-1.3550741840761384;-0.1491418134243036;1.4165297307183293;1.5579617405248072;-0.88506272173095524;-0.39864100516190726];
LW2_1 = [-0.12867158749052574 -0.89148860412954034 -2.2528244659916123 -0.68340418706444028 -0.68181956379699371 -0.24728148399307673 -0.22414693417388448 0.93867057380636643 0.67036813572092036 -0.17637603666874097 0.73300721750888631 0.77087846711683172 -0.016050663412141414 -0.30273346023549474 -0.06313088345731363 0.94022955521948182 -0.8006234955647562 0.42121071508653352 1.3389640589699694 -0.40282486121570599 0.65928437100356485 -0.13005748525754057 -1.1562897810989312 0.17256346054045241 0.39922578239131584 2.8575224805366672 -0.16401777751934252 -1.3272335949755061 -2.5760058434747397 2.5497422506964136;-1.4008057953501956 0.98766297931277114 -0.95841908951706978 -0.10499012190460778 -2.0017279196335327 1.0609294789810346 0.86077344262291655 0.50659093826531532 -1.5409949189856216 -0.14410603867332319 2.6241482649123045 -0.030618770814765738 0.80246735094464339 -0.38855942527711662 0.27424460756613694 -0.32071951168595431 0.29080735078640418 -1.4447459206444839 -0.51419563330450224 -1.1378570834150699 -0.62441105788270557 -1.0403580046379104 -1.2220117624112559 0.74291707021898068 -0.23980022007471052 0.13806061908939304 1.4490250032297516 0.3834785574981095 0.26917999411106075 -1.6643528481689163;0.11824790801558666 1.6186259283249649 1.839918307001176 0.93744545997407935 -0.85520286241425025 5.9720080641745419 2.8466376071374455 2.0922727123473548 1.9960661801578032 -0.63575192666907054 -5.3155600780819583 2.5412205784418536 0.013527361016320395 -0.21116256289743593 -1.472719330886278 1.3869460430587497 -0.7031466411065026 -0.83440416288696218 -0.3619533303230017 -0.75997841901826191 0.1711039289034369 0.37004587602962297 -0.49346298427631541 3.4767813543674677 0.059726907578220689 -0.67126382308575139 -1.1491079995000997 -3.1961318997599322 -3.4541034053576527 -2.5328404488476526;0.017377078059732164 -0.66144298373948396 -0.30779478541084354 -0.912030126566443 -0.67612010618169882 1.3695619638692194 -0.16637598759697111 -1.4610486708717869 -0.87894570521757021 0.27963525313132909 -0.12017487972393069 -0.87252055391560701 -0.082823034204207863 0.53901062781072273 0.43969340841884014 -1.375694392854599 -0.59147251074367369 0.43466079458888873 0.063877764408423438 0.96460090083743 -0.6686423511719467 -2.3236264604149857 1.3686785192934026 -1.2845921787537458 -0.015141145199321963 0.87993081842806142 0.38725750559055871 0.36383847210960285 -0.18849482053473232 2.3170875028844233;-2.2952796015550625 0.018430446040846978 -0.4901881384885079 -0.60332149551578618 -2.477912385523473 -0.53260689762406854 0.24637580711176307 0.29274887250197013 -1.2353899796468368 0.02795236219133701 -0.52477252675954722 -0.39703494083589774 0.31638394236158146 -0.24900062155412395 -1.0776891153169679 -0.57029130715377152 1.0577691500679802 -0.78708421834851217 0.55966762393363423 -1.0367046968879288 0.058713310666870702 -0.48158522964308387 -1.9865445257817997 -0.44713101062676641 0.45782835903647562 -0.42242565633705315 0.97334354903070153 -2.9676761565270238 -1.3837997735996184 -0.28927572163655063;-1.7478970611098759 5.0822094384125807 1.1360247132876997 1.4610168912945287 1.2424299735331077 2.9012487552111388 -1.3064063160164756 1.2925884990948833 4.3492967621515195 0.72433317167206501 1.8415913476984966 0.14178986532247284 1.1137798913078905 -1.4992444445280115 1.4266215163054659 1.7130647800731276 0.46714086746596434 -2.817228489821801 -5.5499953481858109 -2.9382360002841108 -0.3263764170046598 -2.8120986538718422 -0.22324558180334794 -4.0846018935254422 -0.61351208023580228 4.2809387760764555 1.2871437040681275 2.0972017797832945 0.8976971209869008 -0.33942120978926621;-1.957362821244427 -1.7855899292632791 2.0235178592424141 -2.6580347661197194 -4.3052276640870861 -0.19675907366468001 2.4394661510347939 -0.30853370946316683 -1.6185035195926032 -1.6250109796508552 2.4039337541412418 -0.84468661606378359 -0.42055942089929882 1.116531396548208 -0.6097843830365004 2.1897299479830035 1.4010871549186601 -0.88962572220329172 0.28420605506131891 -3.0411336740153683 -1.2426937178533994 -2.5167990286888071 -2.4820874674645004 2.2647653888341019 0.28259378370950716 2.8011223623279919 -1.7877712330625422 2.104261551998178 1.9845751309433042 2.8394957889723895;0.92154762445961602 1.483478123013118 1.0334515872709349 -2.3532915478738903 0.6890018955627234 1.1600062859831939 3.5488624751269797 -0.69350027699415229 1.9707994479449074 0.41755619774365504 0.46729540304298961 -0.10674045715469864 0.38036908190919738 0.7132953247422914 0.17229043054690352 0.94847932621888131 0.0051565837920005547 -0.86649117015305566 -0.11120382712327176 -0.32243884168136294 1.0145019759528793 -2.5948514766515758 1.7849847190431329 1.9325128254457253 -1.4571617355029332 1.7020880313051345 -2.3012392397424524 -0.82918246192893552 0.38857919786399958 -0.03364980046998152;-0.14171894588178524 0.111519016303905 -1.631648962135964 -2.1063241890345101 -0.54724412000251643 -1.6933607249900551 -0.35650953519694223 0.10028063624196712 0.63725664085282807 -0.077028197422270711 0.33739527724957469 -0.12985498525662464 0.32946810101439189 0.030770736168108881 0.7959114613784688 0.56021989697190955 1.1713678236886633 -0.90055427770646779 -1.6599747529958919 -0.84773658413499076 0.9535719392769243 -4.4451482127883581 -1.599439901819169 0.06566332794380865 0.84178272015333788 0.24213528169238635 0.70579301675890338 -2.4769107964493999 -0.010037659528928548 1.3110852629748244;-1.4564804854522928 0.5981706563802629 0.23600524874175549 2.1746960166994516 0.97698009140113728 -2.513599106687098 1.4564548364039862 0.12781924190688337 0.71377473305099237 -1.0335823820790098 0.39379371439012073 1.7358235877774018 -1.3276391744263094 0.63496400605444314 -1.0236057288626301 1.1394468519204162 -1.4098958908365666 0.22071984007394194 2.8812467365370997 -1.4423501146234556 2.3413358630432612 0.5136085155943545 1.6550295232357655 0.37949164487034642 -0.29107749442853026 -1.6736703869604888 -0.33013494058617493 -5.9193361237150341 0.46372654138133812 3.3697863611013439];

% Layer 3
b3 = 0.32682757585881084;
LW3_2 = [-0.086798044160551854 -0.12385229778669204 0.056864810167798541 0.071610799323992572 0.59106810745815785 -0.016922342055991826 -0.043886164919440876 -0.031149321189328064 0.11705988952920969 0.01002245832542888];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
