function [Y,Xf,Af] = ESPER_nitrate_16_Atl_2(X,~,~)
%ESPER_NITRATE_16_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_16_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-8.9687511102580259603;-2.3408134532277315998;-2.9924705844565466784;-1.3688726354534967999;8.7780335657419410467;-6.3247282776287496731;-1.3798892497829167159;4.1299352334731862513;1.2990328589217574606;-1.6944643569372035419;2.6654390016445512757;-1.6772481450279330684;3.9099039815883975812;0.95573610563045185984;-2.0867885286717267057;-3.3891449682450729419;-2.7103577776093836782;5.8496138433537447909;-2.4496443284107680682;-4.1029037840422741823];
IW1_1 = [0.755717565986027906 0.43544148071157623425 1.0537626943931952539 -9.3265390451795706639 -1.0363761737224364001;2.1689053970405747229 1.1687712845888145186 0.80577740603333547487 -1.0950459893095811914 -1.9107567157095932675;0.1581444244607110583 -1.331009824401761632 -0.0055411246565411119772 0.97896162142793374805 2.1238800986783412661;1.6144360373866677438 -0.37307804727993260085 0.35846658068229741989 1.4697407429272149049 -1.1595516794482478851;1.2438355876905191622 -2.2424350593745274729 -2.1752817220942115561 1.7944927926205986868 -13.622988354694637536;0.029052790778257980842 -0.96695458436552073067 -1.7033013092073159278 -9.188338894004766999 -4.6988502690775391102;-0.83464314250826321384 0.30023458962375404457 1.3357216275197369981 -6.3278107538885830508 -5.218865914260441663;-2.1412593838197468976 -0.45947810408724626408 -0.82395948266600782528 -0.87252063286513237284 -4.2575033642548216761;-1.6068261464338602362 -0.81181301262144933695 -4.3775972200903110476 -1.1753355336649644602 1.6615941838633683236;1.1235766907751714161 -0.28231482040678046452 -0.67079268760373311764 1.171142165073865371 0.1516888405569363496;-1.8280718793985129 -3.016741553121189412 2.23292703100660761 0.56953066304026922495 -8.0531747362713836935;0.20661121525474351879 -1.2043583122050047773 -4.0396283765054912251 2.38635246346222063 1.5329536257671916299;0.89678867416013285929 -0.010709799286416772993 -0.84597303287293634799 -1.2176580149219629057 -6.2032428938442816246;-1.2462880202776345229 0.74041845237884651443 3.7905513343466443743 -0.33968977002369182827 0.89227061100020899076;-0.90102460032007269941 -0.32609035139784381396 -0.13057803636239587175 -4.7529225684016962461 -1.6570013603958688719;2.0238396098708335558 0.023652773742335226476 -1.0615660878051502714 -2.2845737114985755767 -0.48684445317006569409;1.9823512253293205099 2.5814373762498696863 -1.1694160497394900933 -0.41488504451167657061 7.332513237141719209;-0.75885439390468389931 -0.058303534029580619813 0.38853171539234210297 -0.24524238953431531929 -7.5306576314729243293;-4.0288253454975775369 -1.0520163027373525821 -0.954620149397351625 -1.7600066355624064407 -3.3552558659957143483;-1.1420976687088977286 0.48106666904179135047 0.87425597220157447165 -0.37559521467611622914 4.491775132789999958];

% Layer 2
b2 = [-6.1056391824049205397;5.4096755068659927446;1.1768319586045619118;9.641136043885335738;-1.1591107191621625727;3.6227393832661443085;-6.7009825699410816569;3.0603885124933216666;2.205448114659626313;-0.66419891378357576173;3.1306667066653317555;-12.255785491331478099;-2.32785091744108108;-2.6866955752641685784;0.18431305821608318096;5.271844026775973191;3.0061219958899454419;2.3681702039124323811;0.54118800170491609958;-4.9535152276155240969];
LW2_1 = [-0.92879207439369426691 -0.75029046401816279488 -4.7498410637673522672 5.6845449475418456942 0.95340861551950972785 -2.623505368640173252 -6.0447563769482899332 0.82208993391711360221 0.16623369940942925305 -13.092451030124026445 -1.5909149906571091737 -0.67524610812760632594 -1.5066297591780131171 0.88076258871457346888 -8.4161079300533057079 -0.10791938921728802536 -1.7943176669225826547 4.8220736765579408356 -0.37058859407351574244 -1.8616330210719516103;1.3506294736318553706 0.45699357638063914377 1.2092894168335570626 -1.5934669521267519343 0.4616640583545025267 0.39694868113816184074 -0.14673347759649965627 2.3294683669529616665 -0.63104836689330734423 0.066444361464099349623 -1.4950086646094886689 -0.21058116167226414994 -3.5741210815542165946 1.1448007771909185504 0.86357988547848996141 -0.34857513986084487367 -2.3090901513845882853 -6.0816884036435387983 -0.76003213452937445904 -1.8461527286490686528;-1.3215573135224214507 -1.1613010568406945122 -0.42990089365441164215 -6.7812593507084457656 -0.24398623118140283506 3.3789680690059249457 0.53229076886738191376 -1.8725271738469622118 0.3852111967723463315 4.91657686550769224 -3.614865810685254921 0.64067877552017116205 -0.78794208167246471142 0.16784977200180944967 0.77960835834162445224 1.2490722393032616111 -2.8157872186520829239 -0.70048566928992350711 -0.22438340731498940261 0.33982849027995765123;-0.23092548024195497236 0.3368610177313370313 1.5010508331279874827 -1.304742442893325638 -1.5539543348502709019 -0.10126502848347712638 1.5407802409248754216 0.94384803206213363502 1.4499450416139489928 0.28533265491737480612 -2.0559441007533099111 -2.328093222770048154 -3.1742961812571479641 -1.363652585059389466 2.1054552320589325909 0.77564730912871970858 -0.82891535193205523324 -4.6777834749695994532 0.027485474487975704305 3.0806225516720759927;0.47690276681770887857 0.58262959804352321136 -3.7988658915027744278 0.32463111652852377764 -0.065815704355360230005 0.63183197246305200512 0.46647134199744727523 1.4063704378705048637 0.039117076109675977258 -0.16743563855330509393 1.0920922855498922388 1.5438549563188974645 -2.5399999487823552435 1.6463488334623117559 -0.80246303260174600691 -0.17076391863837750429 0.95733503338977665731 -1.0042873693302825089 0.12346804000770653098 -1.977487727491759939;-0.41604641681593329539 1.9266107307388655734 -2.5539878061624592398 0.30734883033896925886 -1.4783404333517078388 2.7153096507500054102 -2.1168023268727020891 -0.40558535836017922671 1.2752530957326069228 -0.44208764184265975095 1.3621779817102408483 -0.9054976170598290075 -2.8160878349100952889 -2.1468590270635843353 0.11709259521931436598 1.0974449430152295459 2.235740746400803225 3.3706966069720265544 -0.57544818228251481962 2.0002957345909675446;-0.21015631304965989856 -0.54093564664126281283 -3.0418641952231033621 3.0180629936280953807 0.79764044308031534225 -2.4796465450407931819 -6.8434356087485355147 1.7697813237107178352 0.18961541064143225266 -14.130272322208357494 -3.4765322418172250885 -1.4162002144706542506 -2.0755170281254669007 0.59192845619824152603 -10.500966021766139136 0.56786258404683420675 -3.744331071824887669 6.2759695060551488055 0.17871746607585539679 -3.1166137336538359826;-1.4705422824362164302 0.40101881693646479476 -0.54171170222834286179 -0.7835381780943143637 1.1025607995026951436 -1.9865723996114177385 1.1881390078747637862 2.0350343920491789085 -0.53936882142276776353 2.1963838438563740851 0.20856646282500160283 -0.58947192606002829507 1.5117967799179119481 1.1372159443402287682 0.045502808854361732893 2.5651272443322983285 0.36890957285439762714 -3.889349769954140168 0.47760360765598691701 0.17231952866031127747;0.9086748619136799654 0.13836809533005289818 -1.0786398761037008232 0.80956965798875224483 0.54289261848971681612 0.036736085142659337388 0.2569426129509371215 0.0055722459561645216672 -0.063716087498826332047 1.3411076360567164567 3.0361127185748686408 -0.56859179655599112468 -0.64520456543680249073 -0.36353356526096014534 -0.58586632001275196213 0.23925876639321025374 2.5575632189952148821 1.3709275361984263331 -0.87264575857072090859 0.35398763017776813111;0.11917837963344707353 0.51157536287747717996 -2.504547648533710813 -0.23918870591931210012 -0.023859796318644561214 0.074760333550430005389 -0.80409444724273859695 0.33405892053017477439 0.67017119427508964336 0.4333728083960531885 0.63564339882186138286 0.52833351434800224222 -1.5320227072251819678 1.2356292240505302171 0.37975708266295438165 0.46646911551328823498 0.77184072014661198047 1.2727352415068398095 -0.015150771372891775127 -0.80210279119099259226;-1.4365937292886823418 -1.0617142017237981566 -1.71974980972874536 -0.99458135562655436424 -0.032674862365845290524 -1.0115968688718925961 -0.34012557826136863293 0.39799556747423348035 -0.57990656178223687345 -1.5989538582835363112 -0.82695511945977584478 0.49009066015271030015 0.41869123150963166724 -5.0804723255590831243 -0.47167409178363711719 3.0003315819292861732 -0.1925869244602664565 1.8871951253431478168 1.2007481577397109973 -1.5888963470573640446;-4.8639699841142745029 -0.12874200492017293107 -2.5230216443164477091 1.6567365875398500918 0.84230745684832342146 -1.6215609823743395435 0.97015187412818515433 0.42580072523553930131 -0.90600033647682531868 -0.45577144587727025371 -5.6274849443789900505 1.3024842210506346607 -0.70055351692956591148 0.32067607513319745793 0.50614355335263239155 -2.5049714693566960122 -3.8921217435552240005 -1.2845328577057466557 -0.86589279838924770871 -3.2160077865129945707;-0.95880161485505155383 0.131048533352407931 0.9658618328570331979 -0.68234531397577535827 -0.5421826375875418158 -0.2289985981401561066 -0.29351533188248218886 0.11506141625375088111 0.17213638504429823461 -1.2018282696727429215 -3.327641834380248298 0.42483046465453200291 0.67294949822664640315 0.24199778237123428792 0.67097482397982077806 -0.19935458443360487557 -2.8854856968129065642 -1.3382045127380659544 0.81669245875941209878 -0.58131561313156021598;0.89053160200697534243 -0.67157620070266099699 0.43457649850248847301 -0.21682132971645304287 -0.019702129248445318654 -0.99550798808850837762 -0.12697909503292556521 -0.83053161273992537339 -0.22380277405578796746 -2.5184662447219721138 -0.87464563673301998215 1.5179180131322924652 1.4623654710447191452 0.73876997197939742179 0.096859083194209827372 -1.7379119326732890283 -1.150273470660813091 -1.6738537522247995959 0.42491970610013302112 1.1891289195132079826;1.3339384277284900282 -3.2766512922466763946 2.2128282700074128897 -2.3944985293800153947 0.77101696094497818024 -0.81101764084201721783 1.2797977290314914711 -1.4696013747406251326 -1.0499977752264930686 0.28685700694084642626 4.6240185357054270909 -1.4843118720977070968 -1.2343200371572466967 -1.0174549430127282079 -1.4235830540161904523 1.1539313430636075619 4.1345894227328097159 2.3246896994309782514 0.53993461656395325132 0.3602735396387672373;0.66873627794039480765 2.0814428781382767752 1.5970150532073683625 -0.67815997292829965915 0.8993318401633207948 -0.54057579435898117648 0.022249601965269552584 0.89346384922859056754 -1.6718255538380146774 1.9693132966918878157 4.2731928503073239867 -2.4704746644582860071 -1.7250060402968010465 -1.0149939277622304079 -0.50063359199843715519 -0.89751877306127192391 4.4364032501349068838 0.098846225433833923013 -0.02349103777274818769 -1.5506403808444102488;-1.659910127834479221 0.47876712489548206575 -0.99575879292294611211 -0.95607246032555059934 1.0650984065467639095 -1.9533807435495755822 1.2018795014569016999 2.0617366066407378788 -0.57040843461287404903 2.90399617146369593 0.057664435468212267566 -0.55447733685298605799 1.2308892407775680056 1.2358328215115010895 -0.025452229181900050403 3.0974525982944367541 0.23447958774821386907 -3.3772923857248069446 0.4813574457127934858 -0.21118302810790845481;0.20305800140902524609 0.91354446335349481778 -0.34615544997341096689 -0.42028562559797993936 -1.220565813328930771 2.5364376941544102273 -0.1105241245498727598 1.2662121478912593542 0.6339777990085063708 1.6447447829922978713 5.0753829878648017981 -0.95992936018693741929 -0.78143996629351997196 -1.0662429500341470412 -1.9553928723541356138 1.1857519814177586159 4.5271838204583003673 1.7020237559750972522 0.12847986466377669945 -1.9322899798460249077;-0.048889340629233717095 0.63084936173016525895 -1.4836298056634482645 -0.19287366618122259165 -0.52642799073086654627 0.81892545348789658188 0.1572736676130503386 1.0518594093374002973 -0.12374477015464478702 0.80505003784258055699 0.52201103208760846197 0.50766023795602799318 -2.0574812029709899086 0.70929540329301110635 -0.59753132293665323083 -0.13937952113829343848 0.65904401198618778324 -0.25797362715526983568 0.31228105149422502596 -1.5496437965148874838;-1.0098000975122114475 -0.29647363664028647534 0.84241739134246673704 0.57813997784509540967 0.45950489431254459838 -1.1611703978325378372 1.0063030896819618043 -0.56417406170732353754 -0.47486152591942837331 0.15867451866162865515 -0.47647848453116625755 -0.12261542118760898612 1.5483142610154838614 -0.81704154573102905079 -0.78389139565089605011 -0.054071493763232003626 0.070208043255460400589 0.90246086343512221806 -1.6827728713695380147 0.4244652024285295866];

% Layer 3
b3 = 0.41396482088768715712;
LW3_2 = [0.79877579798887154983 0.87803474674839954162 0.26708176229638974641 0.30895351713686525219 -1.4595798550482208533 -0.27877809538123216049 -0.73006550836058348164 -2.4547408714015479525 6.5176111062662211992 2.7783833159677873148 -0.7773787212616772857 0.23656910699145794474 6.2564680850797058653 0.89071981478497275209 0.32454803266959209029 -0.58891135651430159825 2.59711643374085277 0.31929871954535227196 1.7218675205057056843 2.8077079131134174972];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
