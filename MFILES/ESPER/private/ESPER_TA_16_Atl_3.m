function [Y,Xf,Af] = ESPER_TA_16_Atl_3(X,~,~)
%ESPER_TA_16_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:05.
% 
% [Y] = ESPER_TA_16_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.3906027403135730047;-2.4013971544420091853;-1.9650868015560780666;-1.8722740572324820807;-1.195829360381200912;2.1153054737386973727;0.97787562262866933871;1.3158446382182877876;-1.3085076154034134266;-2.3098480869593389642;0.12007128516399313833;0.78613721240099321275;1.0380914563753673718;-0.08714810031980776972;0.80705257188119461365;0.66810758972031714098;-0.60865790276419351468;-0.72037783265751598183;-1.3510123504003535011;1.6077699880579443548;-1.8829382016701334823;1.1869866482232160898;-2.5835060102354896472;2.9718642118595863799;3.1240769072073475421];
IW1_1 = [-1.0131034596099184331 -1.3052481872400722995 -3.0206687528397728748 0.11312218583871516686 1.2823871099989556654;-0.030269195039093203109 -0.23919614051070048344 0.17166233848840203868 -1.0258244893413472898 1.0712993154184129452;1.3355969041162203403 -0.42483833783334817857 -0.82433228314473161458 -0.17924044452731749399 2.2647626811991341533;0.13709227159925521655 0.20979153051664137242 -1.3890451868698812099 -1.031215463250624742 0.43541145386908258752;1.7577976255876541778 -1.5564539318316563676 -1.2203075160493539464 0.42283133874569123201 -1.3412158280701187429;-2.2159845300808584945 -1.2897671734834033064 -0.83209676355127926151 -0.25700314364433590741 -0.92193183151016644405;-1.418214462757406924 -0.67739911599752378191 -3.6761750795820309357 -0.74818587829603722117 -0.91691846939093202273;-0.29764909279955548138 1.5709675028028213806 1.2465002679241763417 -2.0635782066817425218 -1.2426939919162334203;0.85470116652924310596 -0.86799251725506754163 -0.51185560768183324676 1.2905937427314511101 1.5196006138102271521;-0.044737271719772125911 -0.25729080984014052191 0.27638915511706219075 1.074856746341838809 3.5000810297718172315;-1.196101184739137846 0.67671136207780757665 0.75212170317542126341 -1.856786128481493936 0.042296964307107956516;-0.43965671529010630358 0.88696052034788530616 -3.4915807629672923618 -1.0645005530865765397 0.8032186285429409045;1.9263128921785812597 -0.0034967988310619421005 0.56597971331182361787 -0.18290503830248519557 2.1051403945061610834;-1.9818115355554548618 -2.7928767305739130578 -1.849220209117117486 0.019844656130354049184 3.5332761586650480723;-0.87931048147285673089 0.31515596303048937221 -3.663403018139559375 -1.0782483565349423316 0.23751815796306177675;1.017207516389676103 0.7397290603990784863 -2.1498923554952176218 0.8873716498548546161 -0.61806989147699309406;-0.57514982107634382569 -1.3686759895199822612 -1.6419096515870266195 -0.021464812558467240983 2.1646941325591164684;-0.50853134273706657176 1.347692856016827756 1.57130759578913759 1.6070953540619472566 -2.0870552311226768794;-0.72569496368752561821 0.80360030501267010195 0.27508290710760902043 -0.23958171163364516687 1.8094520623358647526;0.80365286708654404269 -0.8424298331521281602 -2.4841608246035424834 -1.1943363131098505558 -0.28333977375828650613;-0.17730170232743935887 -1.6820814937100556641 -0.73224134804810903088 2.4837035982254418442 0.45025230157589890556;1.044282068918621631 -1.6140086374412498937 -1.3405055357241839609 -0.42994398257676197384 -0.93184236760591931947;-3.0078543253396858859 -1.5863158888221211562 -0.33005590759894920527 -0.85669995691933165105 1.0531329332751744321;0.82460028491535586337 -0.99721666571757572317 -0.79243990885460569018 -1.6826168103334504522 1.1373806445246792407;2.4116215202625648217 1.7948858985945110867 0.89834560332459878484 -1.2370643472591618117 -0.8579002684769510001];

% Layer 2
b2 = [1.4816431557917419948;1.1963641615751205993;1.5741674536854983746;-0.81609038333427896816;0.51000565994130919734;0.45145500392633014508;-0.30541510946369521129;-0.077316775124881456649;0.20940981385648346769;-0.45682042289268315338;1.1966519290076327309;-0.40900538729028196316;-1.0119917449594348913;-1.4012150488253827252;-1.8141611288821690717];
LW2_1 = [-0.68786620436673950874 0.17048846837976699975 -0.13115026511637295492 0.71535149407570264302 -0.032747677965990269755 1.6872925202695310265 1.1631969264794230767 -0.40592367222422764961 -0.4529497942992140036 -0.23600518979105336581 0.32866658607883542098 0.54950291026348974111 -0.36468899337695015461 -0.93879581099374331821 0.48725328895503877691 -0.47586049805459479378 -0.54544000558822869351 0.70111819744352044115 -1.0694797534795104088 0.31890302745146714702 0.606317192367031077 -0.26413652631120904113 -0.0062262667880279114196 -0.58043213433498708209 -0.22147239982773533895;-0.11963311509650931264 0.062744644495442924992 -0.68179853439392978931 -0.87816166241617921173 0.054508351573446515992 -0.10289642219090738839 -0.14299945788824863779 -0.099778140311348795244 -0.28540234023778882078 -0.4458122350958123592 -0.33392556831434533349 0.20643301119989279635 -1.0749580493025290284 -0.14232350616645011998 0.68456143852901507607 0.11499971825100326062 -0.2148864511989374837 -0.6962351405477673616 -0.48303256426793483858 -0.054733870056244811331 0.28494561108021654317 -0.33750879428487817746 -0.12781198561419995774 -0.33124841325472453857 -0.08373272189883709804;-0.15960163840947583225 -0.3149762780593549083 -0.86845484529112615402 -0.56184791451150906116 0.23374990227789241293 0.3182746283796296094 1.1394729623956261211 0.10945962187480076655 1.0637536197410726313 0.22324285667624599316 0.52998675904884984256 1.0906110268821054277 -0.64547673695321516885 0.00096420553291249027489 -1.9926921308447500536 -0.042086666717654597214 -0.38995156960267440827 0.63231022225681510207 1.0872951597972202453 -0.097559854331723483423 -0.15652384233539620717 0.77333899389824278803 -0.42521819203396027387 0.26672885437179760793 -0.35686825409075190185;-0.20093449258217321862 -0.21324563230471782482 0.028568385608426446337 0.62751024572887337261 -0.12643610943232258537 -0.28152161851764029299 0.45177171060610876729 0.22384488137386360229 -1.2508692051666172596 -0.28990734220313058023 -0.66173760753002686119 0.69570588994172166686 -0.1033092709049438368 0.24296657626924461626 -0.30353426782601766742 0.28277289726800663994 -0.48292256721099108274 0.63928433109986448901 -0.09652340879006528207 0.22297214634899906183 0.16214854380478121998 0.73716992475606946122 -0.078369916545602685831 -0.067469018506144312619 0.78925544104960576597;-1.1531034568270406293 -0.094913581420972420455 -0.19367007228938051822 1.0999301431359516101 -0.2091886388457326329 0.11927038356793721874 0.46494524714553231437 0.4034712037670565854 -0.68729771089907942816 0.31387827248186583873 -0.57961075553984930941 0.21915658116514957765 0.47858985003873061315 0.13861954394128098156 -0.086512286452402734072 -0.23443088408875412121 0.22756921878563213246 -0.27655757271897674077 -0.0068875942067696972054 0.92624698324773013791 -0.39564789957966389755 -0.55329718438358144184 0.48569894002210450834 0.064733487688406726734 0.095876368320578511661;0.87258799973630118973 0.79929171375134078215 -0.70025953804824270232 1.0135491345094735927 0.7848265950569116578 0.6739954834022638952 -0.33847495082141437761 0.43282198357030704505 -1.1256942184995626377 0.44382277294660127387 -0.70408077187767459382 -0.50979082164034439373 -0.8676213874248350777 -0.26020004869772495049 1.0844814381883829402 -0.59599685401905966309 -1.1564674278163555865 0.88997920596735702325 -0.67134409105692871567 -0.29934512388692008367 -0.4765038137456027445 1.7186008090708195795 0.10526830425578483086 0.61942220783583568089 0.62890645912895692948;-1.2282893424490954892 -0.97656803971073380399 0.43173748262575878387 0.55278661082816826777 -1.5479841281019601773 0.28601531776010252761 -0.78813967669363693691 -0.16009456192234225447 1.2093446043192768169 -0.021479385720647427294 0.8230164665899900589 -1.3904783101821460711 0.30726399832031087156 0.95950502954570282554 1.5240142435266339493 0.84748814677964179332 0.77879638483724900055 -0.051121418442472324473 0.33071762716857866504 -0.41302185445761485649 -0.22402627547835732291 0.069128045579210567473 -0.60702463573038756284 -0.19646419516278551542 -0.64106249405857318457;-0.47839612610245518809 0.33687674092332986486 0.876785646090121773 0.26464056477812863966 0.14574900659505046763 -0.900109062273956817 -0.83476826527225822527 0.56342580231711225647 0.1152790060354110524 -0.15375776576825384012 0.67088322335762096138 1.064563216138949997 0.21163536092415441425 -0.66291068843638345509 -0.18058557116212659022 -0.35351832452375209215 0.91558184973966871834 0.69527394326916880374 -0.70219260890640278205 0.091601267120118345932 0.72015222564923841997 -1.2475074654359716853 0.0071715742246765724899 -0.20569901739267068552 0.1296379744429337344;0.095576373776193102039 -0.69465101026590503341 1.2328977531481004615 -1.4977739997819177198 0.3564191510063394186 -1.3888583136801824214 -0.67897931721159165974 -0.76695628549482852687 0.29143630696845046479 0.33199910161909668149 -0.18546352891742293179 0.21558166524959418431 0.44799763443388440631 1.2250639015340696325 0.85583559208689174991 -1.1853575451721352074 -0.45251812573902139292 0.21953928312896991981 0.59602942322994001412 0.20649627476699325412 -0.26101172150358736834 -0.68156786553574932874 0.027798081951686648416 0.099611649562289336646 0.074261720856527838053;-0.5501669810128498872 -0.6081581020971685847 -0.61606188178277332401 -0.42111043677063358937 -0.95689649070474536163 0.58515810766676579213 -0.26554025782618012608 -0.4734439405585042504 -0.75300977194869600506 0.030908879842322108111 0.48969769198966583978 0.89056273053087653402 -0.098885889387259187644 -0.3328331055415021944 0.61155992996226948843 0.91160028533918568971 -0.15464000247772008434 -0.86292366270084353008 0.49673390748686130358 0.66653029284482145922 0.74042700270450900746 0.15434422247292522989 0.22616336100598816161 -0.18814306962905461007 0.56711659510221745784;-0.40491801688709783136 -0.93403833073098896378 0.26989922311793484999 -0.22872002072283076357 0.15841517490519615996 0.33692699192210245895 0.79974501445368939567 -0.095943728067571329432 -0.77125861909034376662 1.4251892361834697098 -0.13669104226919659428 -0.32790156168791767533 2.1325875318959357507 0.98839371053343072493 -0.88732984817712712289 -0.41405725202648968608 -0.5989987970090812075 2.4613966626956860217 -0.17108034395120144677 0.90423999491664297512 -0.3008577641662711355 -1.403943127555757675 -0.203881148367820203 0.83790905138866567103 -1.2395926804396788512;0.40944635327627393329 0.024434119339128149845 0.24949228395838002337 0.081101309578080121865 -0.94481112418317825252 -0.78037568742155249968 0.50812476688223440213 0.44025117846104672159 -0.35688782496226034713 0.19805141333954459637 -0.78210392984132270922 0.25071699828250526565 0.29825408785662282929 -0.19308659793253665771 -1.1338945964755076101 0.56675943798604966339 0.10431750199783149102 0.061045090724663943205 -1.2032417198969735939 -0.32527837343953547311 -0.46036856286621963275 -0.60677589975408940948 -0.65760776468614556833 0.29969348140342655373 0.0094060442945742787219;0.45967053733846519048 0.49898018612807770733 -0.39261978882126136181 -0.75963639829885731825 1.6833116953193016929 0.12435364063271998891 0.80117819814741975115 0.48480423420294388448 0.41547882858967005726 0.64622144577831985846 0.1290689876520397239 1.558730280185100181 -0.50639376561994320358 -0.87804891339447066478 -2.5010580316177848381 -0.89207185884315143287 -0.43076109148939289994 -0.19291981120934864613 -0.30768221329794342989 1.1481188032256151033 -0.17017218419484114733 -0.96866820991426771936 0.5100367452483122177 0.4236439131498048738 0.45891882118335181051;-0.52467366333516562982 -0.42449659364541603157 -0.47176194912440977403 0.63290069022427652978 0.47965425296315150616 0.32726594042543016849 -0.020812013894768791045 -0.12037827984098983802 0.5067796606532848358 -0.55469345004244197117 -0.81011156247237969819 0.037486302980420924125 -0.60497722772783490974 -0.38225366116923198412 0.28010067717300096701 0.16787405412589015419 0.033654016062169257728 3.9155893456948968889e-05 0.52963691438908255815 -0.1137726590220741324 1.2125056051091518405 -0.075880996336208442199 0.6839376464044006898 0.20505854728393327346 0.1731322160179839531;-0.090502161326707727951 0.078008903657809020027 -1.5408699124528562052 0.14185683930619397142 0.44908701185066313144 0.55016739491832833409 1.2012864857349372372 0.2538018529137233692 0.8044809771706353807 -0.17728906505125999193 0.54463040580629185072 -1.5541846591000718636 0.31415013740185943059 0.27463163473266821724 1.0484234899231414939 -0.1303918640838789833 0.2294294903410656894 -0.48787773410032453381 1.104587392194271267 -0.051791229575636206495 -0.4321649811518906148 -0.30107485318107973793 -0.067465534907390906083 0.63279479886399148114 0.90741255857009894825];

% Layer 3
b3 = 0.54064787336555519826;
LW3_2 = [0.055980828865656744042 -0.38962156127940605899 0.49066578171348085302 -0.55319420276984065943 0.2397837739549486813 -0.15003813622050699017 -0.42461681437690168561 -0.12559668044513433438 0.10818286066521477784 0.1145772334019489469 -0.88147253439775152817 0.23870485231044333285 -0.4132328946314781648 0.38236003526201761682 -0.13020445135096869738];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
