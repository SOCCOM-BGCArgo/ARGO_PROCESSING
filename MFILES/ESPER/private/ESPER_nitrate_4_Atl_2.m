function [Y,Xf,Af] = ESPER_nitrate_4_Atl_2(X,~,~)
%ESPER_NITRATE_4_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_4_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.9355911999708004245;0.91092130688347017209;4.5757674257649636473;-0.96666200991814765775;2.099362632265733275;-8.5632412523567662532;5.2888779913955481504;-2.369370072797976956;-5.3017349508432456417;8.0670227957075866243;7.2466502894192554862;5.5328236794440410762;0.3266054458951195838;31.376956861310336677;2.5316189120036525217;-4.0219740071980440987;2.7904129999966462705;2.2915111047956870927;3.4284842219642852612;-3.8485233127294398159];
IW1_1 = [-1.114174700169858756 -0.51132126480193040852 -0.25294062235726172405 -0.33575862098224334984 -3.2885364991044965244 1.9980686194589745153 -0.20279893725758418865;0.36707253681333695816 -0.31866646537843040798 -0.68186885186749091048 1.7905292083911044099 0.93633243638322460889 0.046385785862657173684 -0.45033452488343445053;-1.7595556053475280844 0.73161248714825033446 -3.4464666723220478417 0.69099805536204694789 -4.2264066534596915758 2.8848988736700791335 2.6471325228956117392;-0.10157043188897722785 0.010930574153827855161 0.98450467553225307071 0.33294425221947471227 3.5803266623921694567 0.94547433679243853 1.2679410287492569598;0.35137536641314420782 0.1379367543164176646 0.52089090754846767428 -1.2738565937087000801 -3.9000731280707583437 3.3165025266413517002 -1.7721489163351680229;0.31882423374000301575 0.042567017871449612521 0.40758059896314569048 0.27466574926318515493 9.3848239274173508306 -3.2970989341719829646 -0.09300406377425662896;-0.45776143499210364407 -0.15443296019294219801 -1.1734246528799714415 2.2969030137692518778 -2.0813150727742142365 1.098348703983644592 0.98204085936742646634;-1.9795884235962664111 0.89806797682721550835 -0.059621100444740844637 -0.31117338295117624725 0.49694417480507935281 -0.14344074627065822591 -4.7455766044459464226;0.38178186525929375117 -0.077053101831659240317 0.25764161304569721533 -3.3912870598571336345 -3.8659456752322358675 0.98955275758746419346 -3.7725301996365767643;-0.048155585310713525105 0.13414058590192606824 -0.50362003960301560124 -0.76387190431636819987 -13.970334185371248381 0.89501992069515334816 -0.051946705049808292176;-0.26515629022956260785 0.030125696461675465637 -0.26225779697068457574 -0.87809138644822426478 -5.1921386242109353049 -0.63063118267978035547 3.666306874709775343;0.10516102852187082795 -0.065322839574042293465 0.48409055503196324333 1.7459023871836505393 -1.4367783352537693009 -0.076927760918681323266 1.2833226757956484043;0.58563789087301953984 -0.43783301007120423165 0.56345988971520466482 0.77376556143947072819 -0.36432539722702256269 -0.39597367863121440967 -0.26851742780872223104;4.9073667003773691064 1.2820437787835510246 -21.582900585004882288 -3.4648896525532557611 -13.903282945213142341 7.258329655074526876 0.93892214401460982742;1.3117941886614770119 -1.2463279871492858319 2.6253864846908312458 2.4079573482021401354 -1.0044307949447748296 -1.7955735444823290869 2.1167233587888945046;-1.0153998686047494004 0.021532372419746023673 3.3960733447630331305 0.17048426942561695219 6.6891818857525588982 1.367711300622068471 0.76776400067298844476;1.0524704491419281105 -0.80480162309783587204 -2.5846355934444269487 4.3228755351075633939 1.9729363734198346325 2.0091140011735908466 -3.2349167951424488976;-1.3205396684732442214 0.15142452493117328216 -3.2500758948861965258 0.48324559910520770156 -6.1748633442230129731 -0.98460013600792417598 1.9535015377721647312;0.61002092813508734803 0.21282088983649632974 1.4082237911353563398 0.097201882851012388898 -3.050753850029364056 0.11953240673288687002 0.54551280572417970571;0.51525503756020252233 -0.324140714936887675 0.26385411393826624371 1.0200123290299289991 2.4701469264488093991 0.46349650515508578064 -0.63665064369952406587];

% Layer 2
b2 = [-0.4736601616683821514;-3.2367960380822249356;1.3071248990992376804;-4.6710426518430239184;8.9539246172409683311;-10.240825964805253534;-1.5564079793087710613;-9.3233549896308964833;6.4673243775002813294;1.1869758228544857737;-3.1881162646905774061;0.68418989638795946195;1.0435981640379403679;-0.70419712954806867877;5.2975672115118870309;6.2380559181083059528;3.8522962077602098674;0.29667884766189445145;1.9884742139309370401;5.1576979746109650193];
LW2_1 = [9.5777136590315841147 0.76773887121908090947 -15.959213387570805764 -2.7181178119056070841 -15.400909687503769874 6.2752468532815006697 -3.216457974459126401 -7.709824871023720938 -4.9441362391687109223 2.9240962819551774565 -13.034582459493440965 1.218709380991198632 6.3211347170633871428 -3.4041461636092660292 -2.584593156629983568 -18.065378104794582725 10.798266024041051736 3.3528198199152345893 7.7289386221080604855 11.042197835908444503;-0.6600356317562829922 -0.5817858537728253232 -0.94271509206566173056 2.406128941888799222 -6.3440535335524863569 5.2426241960751793769 -2.5762311481980542105 -5.2902770502674529851 -1.7958333978299747535 5.1718498589984198688 -4.6286332621926886688 -4.787697093891899236 -1.0788660863450512117 -0.9044565765429367632 1.2767693310567651555 -0.91420986386643021682 1.5245474347130003601 0.53445295961206518154 -4.7982346000053226476 -4.8754440415345339233;1.7640259987124171648 -0.41547615486598454826 -1.0613739682990106505 -1.1709220990604496393 -0.19115180896224434615 -1.2899746836725010102 -2.9120394985237889607 -3.6765758337489087282 0.68453012955128034189 -2.0352492973230473794 -0.8537526943684276004 -5.1843059078440250076 5.1028304310228280727 -1.2002131723403250962 -1.5836879313384040202 0.52619594820369874899 0.22233150140193763677 -1.4402935239834366854 -0.97244694587455449142 -4.0655090344876958497;-22.628638735384704717 -6.1876975883624467656 0.89237190725093018528 -5.8399681626116404232 1.2995032823094059271 -3.5300902005025012187 -2.1168626770333616172 6.3226949209881153635 3.9714749067693935203 0.2753416212561446974 -5.4583136441746296086 -5.2198703753936674943 -7.3563725454772255219 16.40758381461422033 -3.3179606730266479886 -4.8948030172711050056 4.4853063558996861815 -9.9074753918645104278 9.3964900063380571993 9.1460480010203859536;-3.1170805884010599485 -5.7319181688346834136 3.1764779108730523127 2.019587742325398505 -0.95949142836593537265 -1.5463898802833129231 1.1444126704085195723 2.5675285548772119881 0.66546918621570216867 9.9421260429842277517 -2.7086192502565724638 4.198322667104608108 4.8112362155198242775 -1.7049868594838097913 2.0519156868877983513 0.70091538943377396098 2.5851224971008823772 -4.1660087684017543808 -5.1928800024508419142 -5.0896347330889133431;-0.43378903186159517569 -15.264552363735235829 -2.1792479349254190168 10.1873878377949314 -3.1359099494021136501 -0.77642353783171269566 4.1071351880987245764 -0.33884920668659701537 -6.506533298151009781 0.30201951140486937852 1.0042142158332332258 -4.199896740544600604 10.683844607867360565 3.2835185157669295464 -1.7438013981684024056 -4.6396332161319797649 4.9402084862984931846 3.3632423225079213225 -1.9960877330911557248 -8.1174971527285766371;8.0212176777696555519 3.741444485263014208 2.5437006823130294819 3.9406783139571244234 15.888024901793174948 -6.370297860428610015 1.7932004016608096286 -9.1379615060347507693 5.9852739898506230887 -0.3255067044375679064 -1.7766817543165369653 -3.1950608843010326332 8.7608386485396820831 4.1094724674393932062 3.6922946964227247868 -5.8197246659995887086 1.9669887857918082474 0.95567202251940630564 -5.2227059877424437673 3.1455369221870426166;-1.6045515076528120701 -5.3525104944435071275 -7.6016809002957383967 -14.453477201672141561 5.3141767943782767247 5.8231212481106471301 4.3369395551991960502 -4.1495429911282188939 3.760144045023155801 -1.5424528423526817633 -6.6394144874428402403 7.747379535261059047 -5.5117270800652322649 -0.14302606420327859671 -1.0842193606779562121 5.0513998636070640558 0.20500222750237162561 -16.15705972893962894 -0.93330268495094914627 4.1663900699352867107;3.5713741951378317196 -2.1191766869249626382 2.5046331373507615403 -2.1992887794744637731 0.19195235947998556814 -1.4604855938435186147 -0.54612964573956401804 -3.9943132802633516398 -1.8463123412486106556 2.6421994303761304757 -3.1506964697856019164 -5.0143587625163963395 5.6968736276393467932 0.96700942622671581805 -0.76979329013348807287 0.42608775456573816376 -2.7205590234590175669 -1.4823142380204226143 2.3040595591124608532 -2.443402520756679408;-10.202809034116128828 5.215823355253769833 2.7656264763805862295 -8.4001666123524696417 4.4457393750394960108 -0.8492284703772228216 -3.7288252509981267835 -1.5176365029115372884 4.2760411485130989107 0.63148522359497594181 -3.997882452182017321 3.9294610854236298181 -7.2240189478237937237 -2.5297867075028208639 7.8266269538780957049 -0.97780259241215894406 3.1110421675080108805 3.8150352842630232963 -0.33194255653473292433 -0.79460024938389350879;7.5821738832606735414 -3.5897500765962675473 7.3837269319220908415 -8.8083296251624556561 -1.0095390655605065433 -0.40937010563371933891 5.1360356348968476681 -2.3508443077246865549 2.5738384689352482582 7.7005667388212106772 7.2522366361953958247 4.8337350619561885168 5.6004697037158308603 -0.46375931727420205419 25.972316974416607138 10.011577447308068756 -3.2349903215486000008 -1.1697986831969591215 -7.0837907348377333605 3.3408893468652203218;0.58192348631569135176 -10.789236303425951746 3.4651687607274315184 -3.9776464599206886597 0.70387734964442838503 -0.58968430503942137477 3.8648731704838614753 -1.2086037563355995772 -0.099645012543281591411 -1.7546762755372573572 -6.0413228390993243266 -1.6241626837755600565 5.2568058733211744382 -0.039484250076129878693 -1.079990356350984726 0.02511350305362613361 2.153533486814364295 -2.4014984874143756599 1.6488662418042279167 -3.865475251074630858;0.87938689633631150766 11.574753709038805738 0.064140943939785421968 5.410094348937928288 -1.7458524147466945031 0.81724617513979136429 -6.351185214405687951 -0.29746789103613913152 15.525222681492593324 0.35293979870000030674 0.50892774780013949609 -4.5301420027341139374 2.1326522868184358828 1.8702121496787080801 8.5991208395501352868 0.094094360395837489675 -3.7011764075912125804 -3.8904218371017749156 -6.3587646831624491384 -6.3693997020237675954;-0.043460446191221448198 2.2574293445426332205 0.38145517986562810231 -4.6849215368389947045 4.3146182235943379979 19.736615203482344327 -1.1004036363318157044 -1.2681732139812991189 -17.68935326885506143 9.654136283831512344 6.3037589206663904307 -1.0069661694007714381 -1.6599827195812704161 -5.5603117115734841391 -0.5699133920218568683 1.535442610249289519 -3.4743280642613894038 0.18659688128477894264 -5.3985356272306823655 4.5706689371940214528;3.4326860413656818949 9.9516466375571166481 -1.1302083549244235083 4.2997161885500716494 0.18676651242415159837 0.67662692315472350302 -5.7272028326205308701 -2.8317549820360814472 4.0224291699672489742 -2.9795050118201693579 5.8309516011471806962 8.0479618944123565427 -17.504307125792255562 -6.0998884068103986777 1.5576012434868369283 0.10858333755537513676 -8.4235540720897095213 0.81604636662730400953 5.980211454583384878 5.3844493196272988911;0.36356197968558345845 -1.2664089081606553222 -0.081572195652553580736 1.5243931285832836853 -3.7907139333047394913 -8.833856670261264199 -0.72901847894590754429 0.64696882828790736042 5.5015140316782042973 -4.0370772890559516455 -8.3458284114769529793 0.070430075553179483094 5.0286907898310984066 0.97518067528456686688 -0.17261275117553515068 -1.6682899645617699225 -1.9294232031367852809 -1.1828474634117360775 -2.2392526719197816121 -5.1908326015680463783;1.7835011716612281241 2.5868486556928766973 2.3537781097377608042 7.548034345641016607 -2.9225470703061100508 -2.7158478336009217458 -0.14599381542836623038 1.818564907917073592 5.3727289053574036615 1.329222648572549792 -4.1170520822399652161 0.43698311133561529296 3.5767808648838643748 -2.2627056771827396275 1.39161165486385352 -2.1623817673723202404 -0.51313667581799060624 -3.043856870647080104 -2.1084425213793691611 3.0773401849591719426;0.57369689728216632929 -5.751447438428846759 1.0047838598138232324 -2.8211229488757423312 -1.6334134092441414676 0.85630050424931847264 1.5767072336148681977 -1.2538355977234170169 5.7245984953363207026 -0.5275016673321245575 -3.881330042252803203 -7.7753704093598239311 1.9557218108239304843 0.67084451491700436421 -0.94320277606359492761 0.75361226243160084337 1.5082607824202287627 -4.8649241913117098335 0.36196731288493438905 -11.674785618642195217;0.29691796869012287985 0.26274082469572346277 0.12591449006636284969 0.11160982318722011131 0.34252871365954706828 1.0881156304080865649 -0.16537610811046241088 0.087854380674235052484 6.0135584208778851689 0.74662889583878677691 -2.0480254799376949038 8.8062065242781368823 -0.42134500364293631103 0.11069404883785546878 0.13684649618835650897 0.0047686405581802687043 0.10743180766810736526 -0.16199448179977130047 -0.3197057734423217612 -0.052638840896234988243;-0.83200087387469101596 -4.5714056003395295846 -1.0327262147001152748 -0.64151748583906020862 -0.57318156589716950933 -0.92694950277293608476 3.2572423662834157909 4.4510025205706567064 -4.3217132601422845184 1.7269281161869804997 1.2739788146160038185 -7.7241781570395708911 4.7982187332295209714 -2.3580596997009455329 0.6990718360626588801 -0.10289062612392801954 6.0968767688260108173 -4.4670025481627995134 -3.5966093743730809251 8.2206680372782461319];

% Layer 3
b3 = 11.188779784288579222;
LW3_2 = [0.0099590065470938158448 0.22234762136172447899 -0.041663766326344449376 -0.016144065780172182911 -0.24557260322124097041 0.10426831751199927556 0.0088764179870195088207 0.02391285673629995126 0.061754598913946870398 0.019245378315050645779 0.00515232964494496265 -0.16681745586154245187 0.021279452865835907227 -0.025790974373167258743 0.037485271300559466767 -0.064126215413914652852 0.026841476972839208026 -0.11379413212083430706 -11.334511991402935749 0.029436221490934378481];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
