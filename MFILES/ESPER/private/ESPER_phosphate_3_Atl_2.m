function [Y,Xf,Af] = ESPER_phosphate_3_Atl_2(X,~,~)
%ESPER_PHOSPHATE_3_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:27.
% 
% [Y] = ESPER_phosphate_3_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.3985197100918798085;2.2239428539386163486;1.4435433186274839734;2.1380533105346000156;1.4563468012346574287;1.5729200925627715435;-1.0674605296331500792;1.2656640073493767851;-0.66647938362599035145;2.2217521328145588555;1.1331239072554548653;-0.33282600589863742258;0.43227186061491545965;1.4328966145275012778;-0.12287093635884756282;-2.4443952475643899724;1.1005140901634298256;-1.6365751751635031486;1.8190692410052673456;2.1630412175159676735];
IW1_1 = [1.0167429796497993166 -1.8258686368416472412 -0.78293666535258277239 -0.74173657538342274709 -0.92843551697250159549 -0.73410686806945169014 -0.88444602346523237824 0.49581151277787538501;-0.17934138844183647454 -0.10686785373362923945 -0.85786251057205009651 1.0932562250873985032 1.9340425664934259853 -1.4603549233797263884 0.71553221031189151446 2.4345193409564349629;0.69320147170948787085 -0.54216644670944746931 0.9717567563893081406 1.3674094824195524023 -1.7972947657818327816 -1.8739012716100567069 -0.43857443291009751141 0.2869821039056706935;-0.44799647726893210287 0.24961632261842800484 -0.35211243030405142695 0.50295649800790021011 -0.86745882743761748568 0.61771377254938575341 -1.0869599475340567807 1.4689979515751045991;-0.58626727744634155037 -0.86313861312397810455 -0.69714384098093173936 0.26417138140411489111 0.62855312409700392351 -0.57625201203437947939 -0.084953694105922919477 -0.95894695813164410048;-0.61064949994396611199 0.4778869413614441064 -1.0733433702907611007 0.82190697194135153847 0.46251177799228931908 1.0446420032399479361 0.28003474361483216004 1.4897093481852812236;-0.26822336096796045579 -0.24341496122923181322 2.0123966908762112027 0.33985212656251545527 0.0635324680175247819 -2.2436574873541790254 0.22473060525956192746 0.77829939561768857192;-1.7362012228124927837 2.6083931372379982605 -1.9491791226010968252 -0.3303732009406095127 0.41406266798708879495 -1.1035970368832976884 -0.56552346429220989865 -0.9001733499584496645;0.34328619697405454714 0.81344277210104831699 -0.91342932224292705534 -0.16656956099267261617 -0.53416059118464676025 -0.81629282896365173983 0.94118128955562985194 0.72101944078218904721;-0.20752853553198216674 -0.69670819769234149099 -0.51390486058050011131 -0.35018124693531288427 -2.7577749745167245976 0.40551343760004249228 -0.4853008418308458749 0.83404031789358190618;0.088035811900562144228 -0.74367635519338570749 -0.65904814605869488364 0.22972028933247948257 -0.40588205130386834085 1.154948773858958555 -0.72519536795844175003 1.2960601533067377389;-0.34726606262465276043 0.023570937190060592403 0.18527431446811984395 0.45578495834849075408 -0.71882796162805306928 0.77474162924904610428 -1.0309095503016481032 -1.5423251437063383307;1.5319387783907287837 0.61282036422419683408 -0.18650604879432022831 -0.38739378123165213452 -0.569181483291729573 0.60536089414295612965 -0.63323798355348870359 0.6186103779292279059;1.0152321471607907988 -0.26912745182109221176 -0.23568125377999157855 0.23976437009295883951 0.73115829452935110488 0.9561978518218144929 1.1409843920018096775 1.3225528734560927369;0.58254070391949652752 0.74902647452295689767 -0.18561112164855059214 0.36438571065512959102 3.4596479579621268741 0.71339879417441087739 -0.21081847455343349917 0.080954292896838780935;-0.26016487943404631444 -0.39116287775947078398 -0.93299911272165292342 0.042812927057182793844 2.8860564791957155073 -0.92928088107211515023 -0.75173703510952760709 0.14767618218001246633;0.033457834919075231384 0.42801378310737397959 0.85169763975839196668 -0.28097521784399920319 0.0098434222640259860793 1.2449284479615581045 -0.32743656576359497778 0.66628868820770892345;-0.81780937963577693406 -1.4772291082696340503 0.90750238299191654523 -0.98432515766926853562 0.97875871082999044148 1.9584938752308380661 -0.97196570403358650836 0.33655260415433019272;-0.041180562145832010079 -0.45499076728267950909 -0.63794147950276081094 1.2033399727208680119 2.3930467199671259237 0.64623991811065362167 1.9712996132849327502 0.27528651596177983185;0.19621956694358988482 0.65356158634638206184 -1.5922798903091430756 0.36669200344301611239 0.93137742199048401126 0.52457009657094422206 -1.4201215385393224366 -0.10443237716358974576];

% Layer 2
b2 = [-0.80141254464139644043;-1.5085716059958265145;-1.1796156063078608867;-1.1447374538163026525;0.7955119258703480245;0.39249436300960804935;-0.33999218680664722303;0.43763919264511130791;0.19315803989737026503;-0.067559359503514784806;-0.47733884609827931245;0.013325756350965953581;0.7709731285638591336;0.71779336550180283805;0.63018898020251157277;1.0096403859678979575;1.3216845751893770977;1.6237419240442820811;-2.1184328855794549717;-1.6328078409729054332];
LW2_1 = [0.26747062338343557952 -0.66268500503359939469 -0.6779416335154377915 -0.40124900416382647261 1.0062290388144567999 -0.29389379226676154433 0.19591355984269753776 0.28806213204649455673 0.1757127549919229037 -0.51826474600993244213 0.14840336370001222521 -0.3615378235324265277 -0.43253415073824941217 -0.24950836472558896029 0.73641055689461598632 0.45304359451873055242 0.91537061083599846611 -0.20329546293664510492 0.61679147019768487681 0.15990905856263595841;0.39991498241307538164 -0.61865517545279469225 0.41246554494528736567 -0.48545408381872856562 -0.026580237763577874155 -1.0470020807198117119 -0.62927981814354128076 0.59586925687876124424 -0.43109264021234811048 -0.58393975718493806859 -0.36456267997576008444 0.074092024091154284893 -0.8927437271651922357 0.43726112190505450616 0.65323602771599964534 -1.0560060062309115647 0.40334820083093453347 0.87587119685232484034 -1.160477594730686457 0.58952515359516677318;0.80334779586915694427 -0.43395829789814882593 -0.56828973502979307497 -0.21240620702812118559 0.23931905612192982957 -0.69800014784258568312 -0.60971590658474306146 0.76684808379336988349 1.5478469916165245035 0.5153881591444168242 -0.81327183493191146368 -0.95614578912157099921 -1.5688320102204915685 0.1601346023142026509 -0.51192075506475664959 0.11149129847907568447 0.1414974181519785823 0.21147258027783691348 0.15878804362444562392 -0.44097248614326534089;0.71999588531340863451 0.4126661400898827825 1.4895689229472757198 0.14861016489564610188 -0.5851763536053161685 0.63856473507293831648 -0.20022940967510832744 0.087223435138317872983 0.042144716235274180816 -1.2205119779347590736 0.032434386436507867124 0.42896389431597403696 -0.24729912745072912816 -0.15596251417718856591 0.64464201530660181216 -0.079537952101238429403 -0.29000284531290376755 -0.43888253032978702395 -0.55310170357121757334 -0.0057246321328190451563;-0.27463467442847966371 0.11329405523611785211 -0.37465697639937767249 -0.41970363057938830931 -0.47474678594932839815 -0.57504230417432267153 0.3655175750997787798 0.099501672226184390002 -0.32202452798573538706 -1.2152125376265647816 0.82470813395123510059 -0.56846596015787387302 -0.38451562173293113434 0.36501909848140340342 1.3207227274553947627 0.79562409390204447135 -0.010809412627210548269 0.66649575634288049653 0.0040531172721473430337 0.42279906246763332422;-0.024580295295995820137 0.14483088600078938835 -0.15149359418370611507 -0.51962189446109463553 -0.23143899056077382737 0.15295086693864146099 -0.014539992447551294483 0.1531478979332723811 0.029152197978750300777 -0.29110708204211088734 0.18236203311838075636 0.64165299739091963271 -0.024761408696648366107 0.20899707833915703858 -1.0322390922313633421 -0.56443868818969611389 0.26700687994008853732 -0.043478893194295965829 -0.034043085280114113167 0.7487678728711530951;1.006407949812616387 -2.1918187466006875397 0.71286359820150635436 0.37167876159191959307 0.70170290111585875703 0.58835946683341511232 0.014996644620699977474 0.16560940475145013995 -1.1207440381108815242 -0.35056961074883191687 -0.9853848364783009961 -0.56471773565974381359 -0.35850780040133989335 -0.69605524821842978955 -0.88592144883507739639 0.36242245853698223934 0.40707024893970206181 0.21367262770341327593 0.058547455819999323634 0.74089822556441298218;-0.10858918398797690053 -0.6754073522437070709 -0.40424751075674786316 0.96333097068887429959 0.136844533820420583 -0.47549017951842570406 0.18874577582744433979 0.31685169077645453095 -0.026076121432648050047 -0.75034089463706743484 0.24655147243974501192 -0.26006018392477964207 0.031024212654326459998 0.83785357195084375626 -0.7195313016181880128 0.55847821489493698621 -0.014058640469137522952 -0.051221654201762084613 0.20086243361192146484 -0.31977316032238561894;0.14478551542386952633 -0.18546784928297468942 -0.14639021935429935573 -0.35450776798533450984 -0.30044168242864666141 0.14057062889291396801 -0.026121094798639138412 0.33377090801967901346 -0.16358143891727117136 -0.998707221274412138 -0.16386164071633702033 0.25219779078140674988 -0.25076979787241976405 -0.43292262216472926495 1.1652150230181788082 -0.52338555503712425043 0.41255356806063259167 0.4882017542230511209 0.31395429335679869709 -0.63653822411848959284;-0.64469584241203459207 0.043424024519539708433 -0.20647733721003422303 0.36692616117801984954 0.0090848861512146297098 0.472906959131426885 -0.060933612514473621535 -0.5769620046346156661 -0.86582085908234818206 -0.17618022453897674851 -0.35044777255134923477 -1.2073116094616678229 0.23929735834005011474 -0.057610343861211048277 0.89934921040424342653 0.53093641168476279901 -0.62550803486647144069 0.69148042003634357933 -0.38796296890091885867 0.70982561008307454298;-0.20078722712270488659 1.4252376350652959935 0.16546480214057490699 0.73699741609919566798 -0.9918593885195848836 -0.36106681339160462407 -1.1458587383812841587 -0.21640199546432586919 -0.07403388936979246604 0.46659666149600820262 0.15557824046627596881 -0.27950243071597402622 -0.17150437006977825583 -0.33617078565603913942 -0.15546222287988317734 -0.66753795807043869726 -0.10466099270382758779 0.52584150987280875444 0.7565813145601428813 -0.19625814880532482798;-0.58079776702291263657 1.4361346878996710252 0.010658082211547041315 0.72384137172606455302 -0.47538947710180745609 -0.64359040694001778959 0.054648160236334217266 0.033710386949074667984 -0.023135586749370339738 -1.3661515942040143301 1.6490858497861897725 -0.27205624141101375502 -0.0024807606726864376255 0.7407507522834255731 -0.72933831759878220424 -0.18412037954739099432 -0.005867078482686381713 0.28528712911502912553 0.08402075491756025305 0.73960565491583230013;-0.55335785355368549698 -0.3368094480606604324 0.6297052615491616212 -0.0065401215754335179781 0.053900457100679997902 0.11920628221066849328 -0.48306671819422491998 -0.23734343372524316362 -0.27016189736784979036 -1.0191494052473102361 0.81342596178313830713 -0.39097387423655077798 -0.012296409145417078884 -0.89568454536609798389 1.1668406673139319896 0.86477835108582779 0.17092340997607741171 0.45989684647410633556 -0.42405557708399160832 -0.98046259695317949934;0.19887422798375306576 -0.41266623244715261443 0.012375075673478513547 0.96055359197677980809 -0.44609643254840147808 0.64401154669015880927 0.45455884566196680385 -0.49196031361495390355 -0.19140142184074479537 0.049398420497285655539 -0.5458639192489689318 0.37593568818318046088 1.0822882170734693386 0.028078891530390687886 0.28474341565863781067 -0.65087471144737130135 0.89970522462124291607 0.0070776761353414765002 0.31997934673288114249 0.11656290415215683764;0.44814626502104143446 0.44250856962631562874 -0.46329639123643423515 0.85436494542698870891 -0.29259680449662678337 0.18295752221717279107 -0.24023227238328409561 0.12638618006869190014 -0.47254900758044954268 0.64370026052799467209 -0.71341317667467729624 -0.31362472070160285487 0.29371081412655419829 -0.08090939973810382102 -0.57481534249920196444 -0.64399368485009744756 -0.59361781710830729963 -0.48626107730402701179 0.41455961485886638762 -0.38307520270148309738;0.45894190278935836913 -1.020065268895843813 -0.93094500867769836017 0.72056520222067399484 -0.16089016304874617647 -0.89480434275407383371 -0.28862078821063763545 0.6098699450028828295 0.28208515958334828833 -1.1453946275297646196 0.45774803592235147054 -0.70350130484157702426 -0.70063609346149857693 -0.31026790246467311762 0.48920680486745099502 -0.11586181431348102633 0.00079478653786611147547 -0.46576605058008729854 0.57513503252925524123 0.10218731381988942208;-0.28928227092955843824 0.18049073474374191517 -0.58148068329488622474 -0.52277670972496859125 -0.0013289212531752711641 0.52502517855150254711 -0.71767032793734308882 -0.20927760261372094219 -0.61029126519733301048 0.044023216549147731191 -0.44300311554382298951 0.48690197748952851464 0.35836093465661850166 0.33088995819581762392 -0.98440908117237146957 -0.048693836478911838028 -0.10634138206496653034 0.3852039958537805675 -0.28254283651569861435 -0.54709231265620117401;0.71273760726726675951 -0.095275398438137509638 0.37221119024101273487 -0.57752599529124271083 0.99327933830243386737 0.14132264337798972065 -0.078080855563676693221 -0.59975809469394991691 0.035703239663741351273 -0.047088501400870168279 -0.60663566908633592689 0.55458654610202495761 0.28412646179669742708 -0.010309171916319359585 -0.75412102341652265114 1.1539165381009526268 -0.56841236116506255183 0.22620731688011389005 -0.65983288771261239258 -0.59611734166322871697;-0.99847243079314584868 -0.58632852169245341933 0.41257389400304844695 -0.075787450135666858952 -0.72543993926604366518 -1.3404900322997310713 -0.017777680434143520311 -0.42866400790096015339 -0.33058649041596532836 -0.36932002283843162749 -1.2176353276458793395 -0.32640136723332408009 0.10786285058848986418 0.71407975383124711044 -1.1153339307588769902 0.93226785495841868467 -0.73607815052102165687 -0.43737972875791153449 0.52767813930819196244 -1.3435393056821083313;-0.19516531964946309818 -0.0074285045820615611123 -1.2077132429496189037 -0.23518312234512345205 -0.1294300382747816669 -0.86045895813108175254 1.1551149176627089066 -0.60178330692296955196 -0.50608713854481923722 -0.12599261044712989355 0.059007523439650516606 0.49333309883729564715 0.52388344641247330813 0.17093646230258252583 0.039277255971280830571 1.0962641866050808481 1.2352504122965362043 -0.62074447558974699124 -1.1241383283515806735 -0.19192300544272006269];

% Layer 3
b3 = 0.17002495611229900829;
LW3_2 = [-1.779727880918676286 -0.32432654859358689414 0.31585592361261149996 -0.23286526241138622018 0.6551420073647571396 -1.761841362697514457 0.47047364694927484852 -0.89480112021207036666 0.65391269389021766667 -0.57711775969619005799 -0.26794216832126338534 0.86506791005026362207 -0.89843426766225120694 0.088273087994598792294 -0.70682791796062494072 0.75922096275132855414 0.67727108856595608088 -0.35327114131538789321 -0.31049312812175688947 0.44771908342736055353];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
