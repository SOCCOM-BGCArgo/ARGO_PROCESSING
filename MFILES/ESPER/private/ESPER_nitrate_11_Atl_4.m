function [Y,Xf,Af] = ESPER_nitrate_11_Atl_4(X,~,~)
%ESPER_NITRATE_11_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:36.
% 
% [Y] = ESPER_nitrate_11_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [5.7258781218921539491;0.52594406678241178987;5.4445588571783263276;9.0352872334224869633;3.1625360675405773669;9.3650190296477422436;-0.52555447908502039844;5.1001819990263799198;1.9144110911250906693;7.8628691201154570223;-1.1405991332700540219;-2.2899636662497067086;2.3369225848340033913;-1.7705765874390604342;-1.2875515477720267388;0.47854528584786032441;0.36598351097808190513;1.6341111687943035147;-0.60180976642741723648;0.23441831055702275211;-3.527352098695764937;1.6659053985753367044;0.33807481319491322624;-2.2183164250273743612;3.2505144839460564654;1.3297040182936827879;-3.2932975705486753348;2.1282202781331109875;9.4605328853709096393;-13.951598703951578528];
IW1_1 = [-0.5317952038817567173 0.38738837921218616245 0.39300211015690322824 0.53677509559966252173 -6.501782435410183858 0.80089616855686418528 -0.4158584250486372369;-0.46371760817448665071 0.52256035806864253868 1.614176163327687874 1.3700727984523044523 -1.2384058291392467943 -2.1674943547817071554 -2.7263438546238152327;-0.21407253442426640855 0.28792757873642133015 1.3239057616725078415 0.042987217461624011028 -5.9253884649517809535 1.1648417802663222353 0.33971582441784275996;-3.9484672165828902379 -0.62208759316791895078 -0.6574099056582327627 -0.63183250070118790465 -4.7916104520193814054 0.57709528597126880101 3.2664632879761237305;0.59111614804727585781 -1.4437669946726092718 3.6259030845432920209 -1.5792283168931473547 -8.964280641630153923 1.7204359924289025496 2.7117929482103542149;-0.46781655536218813562 -0.029102591544629102804 -0.61388221651787999722 4.37264750487568854 0.9779971830862141946 -1.52850849457498561 4.4079152795383791386;0.65928738338460690649 -1.1635014335268833996 -0.85656634865479341912 -0.57158167323752950839 3.6814496911767502496 0.60409918556856767591 4.6251854438993218466;-1.0806926536835015362 0.1686391245111673598 -2.0828527668243905779 -1.7195885356751285933 -3.8665817750483908455 -0.99452663216554615389 2.246077738429641979;-1.0053139105593051905 -0.1334461793774891214 -1.7835783665332569647 -0.068478976423336862522 1.4588674590182324486 -1.6485865708765747861 1.2011081822946225728;-0.81186210644128753433 -1.2617358543714130015 -2.7514753997675582831 -1.0351756095577535621 -4.0504868871842596434 -0.82260697066171617475 2.8014558991246500952;-0.42736777994116748047 -0.15646860374389764958 -1.5703422094219983141 1.4121247611695955104 10.293355550513652474 4.5989090877037153149 2.5178949744958636359;-1.0954095325802051253 0.36443798083277895161 0.69755456226847167844 1.4096203468698995653 3.836225315501222255 0.45425362736399832464 -0.46780048867311790906;-1.5631685334204941107 -0.49226399415275073901 -2.5486376195478031015 -1.0988281526478653749 -0.023680922469491785809 -1.755932579863865195 3.780782241525986187;3.1390471788246245843 0.64334449113377667473 1.0188899069556707211 0.14616856736317720977 -4.7034276913460377756 -1.7482250154909872997 -2.4835095979290202628;2.7041806908874979065 1.3522685873346067531 3.1927149072020060139 -1.2143367366969033405 -0.88942263000853183375 -0.33970486876758715367 1.5984390983298391031;-0.61693651513866942793 0.26693147987135396049 -0.33638379888220648617 0.95413837237650334089 0.24795182250691674697 -0.91263204422022858875 -0.48696970093996688744;-0.64933428842370866096 0.20867854180095887773 -0.65992284993402317017 1.1558806067784546112 0.45132944710444899972 -1.4772285826237054884 -0.26109086756820587549;-1.9834325391112697101 1.8926839397668366871 2.8381666515802752571 0.57340732644473979551 3.82478758010556108 1.1851063083659110209 -2.2958815285218592273;0.024971341336868291272 -0.046410464358902239757 1.9181476788707736425 -0.3608239091625260464 -0.71529889697044146679 -3.2736489816978355805 -1.3698627738929989306;0.24291584868104310058 0.1157078329589137089 -0.53855395431098063153 0.28637665428601544182 0.71398085436452285446 -0.84483264947923264465 -0.63777925613151842388;0.57912817979325226236 -1.1727809926010495101 -1.4327135063037723661 -0.93599468874058433521 1.7786850103117926025 -3.7061927002612322646 2.6909778707165639133;1.6822416806527102917 0.43584091514918316124 -0.57642248600334766717 0.2721517833970611977 -0.8234591616727101604 4.5026003632386313313 1.2843964565869225858;0.22840025611995676269 -0.084585388361037572302 1.9974899664707348457 0.21684684879473098418 -1.1084918714972056275 0.82109993001374304011 1.3363529384139503087;0.46956657567968101974 0.9027953448143014592 1.4192692978295791129 1.0151152027979717385 0.57972451328679153182 3.0253902839504087652 -0.67140549674383598333;-0.56124296227014780492 -0.44176643451269931306 -0.87644492422780251317 0.52301531665749245725 -0.94611109865356790571 -1.8687014513951476502 2.9720227438828827893;-0.70240404734573747003 -0.12609417046572915511 -0.13897946820358844655 0.51844226044604146963 5.4423983461376135295 -1.7106513920045440802 4.923523188580612775;1.132477106338313666 0.071878996167003827988 -1.0111524060297092387 0.30366314527521132138 3.7689371144382621814 3.6171331567678675079 -1.633263713885589663;0.19601271727914279519 -0.0053574925789664044895 -0.27689528232354349013 -0.61567636937295422417 -0.67314551746125528275 -2.7492074096320915366 0.45957872518728570821;2.0847528348102826179 -1.0663249588860113093 2.2034587073664213541 7.6043241264248857547 -3.9363614009113563341 -2.3558853877294536616 -2.4282609197824478464;-1.0290618287652817386 0.49802678029148267358 -3.3763552095457964874 -6.9174224939912516419 1.1262443124160990138 -3.2889946684641562236 -7.9134164069227601601];

% Layer 2
b2 = [-6.474869306424670512;0.81952506068418007334;-2.2611147317678459423;1.8642428277847415963;1.5572864914128323743;0.26929950501066357571;2.7070595852000312043;-9.7034705724593930398;-1.1860531481904250661;-2.5271205646410690449];
LW2_1 = [1.6503320788319757462 0.2811316645439594919 -0.38983054308337372618 0.44633003285934563786 -0.56585931777538889254 1.3231552341778753945 -0.067141544760412896764 0.28864064906543634992 0.064542216929845741547 1.2215375774012755539 2.1400063015652883713 0.11664478789538977599 0.058823927680550662511 1.1142649156988460035 -0.36573168129852146047 -0.030352589676292420634 -0.77224416830761577479 -0.19451332818024200111 -0.56469872927310515998 0.28425754521191914925 1.1240532562780356507 -0.13091128435212989745 -0.39606106471702107186 0.20223574701597296643 0.40965570905845699601 -0.027572210764862752769 0.45866248291442113239 -0.73964162680207368172 0.59056670970091751371 -0.0091104529595047306634;1.5446894421374159911 -1.7882460728154558893 -3.4414574671268800543 0.63556612835958981034 0.28500895724622599126 -2.8716303536768763571 -1.4012173965379275398 -1.2903734412292438005 -3.0363636599820766904 2.6651285075001585056 1.0763939588826207938 2.3440152395130633423 2.1921770407521976587 1.8267378609952569235 -0.68040064860649607237 -7.1080059462569185058 2.1978047656367034612 0.47328885381808893928 1.7618627838648630579 3.061423667656168135 3.3790361174961982549 -0.65771603221321262023 -3.522415117712776933 3.3541577911117030908 -3.1902908229659723283 1.386869969461838048 -1.2614452522044867777 5.8850177003555073085 -2.238107486185892725 -1.0796349308319264093;0.036277234318765345933 -0.60571727839028544071 0.72028414107609273209 -0.15363633220659417278 0.42744826484060971516 3.5535159147585058115 0.12845004721540825843 -0.66412486019510819091 -0.32891622800983877362 -0.29768965108623129945 0.19715597457375932944 -0.22609325494335169582 -0.21470815203994722542 -0.32248561472881348555 0.12558458689445048395 -1.2602787569929405631 1.5063400184345967503 -0.53362063945153048738 0.60514245944393840748 -0.96905822639680216923 -1.7326542764192851553 0.12041605244368336347 -0.35537791067589846739 0.014586275429291297931 -0.58816648830349826937 0.31913334220150063603 -0.60584919448469642944 0.46439014674927525661 -1.5305758929580175476 -0.49166812167656159804;1.2941251525340382589 -0.8404812920111042196 -0.2370908352180156331 0.53036534496109555281 -0.083361201552564184736 -5.3313205518535875527 -0.78108415972802425209 -0.5100445412799891054 2.8473742997866997584 -0.19031070229921362436 -0.51709112759422093397 -0.54901517236433439173 0.089570826159462657579 0.81185567463484176187 -0.12003347812141598738 0.81711713899734250699 -1.0527382252866530621 0.044771687565655873819 -0.15612759347980995073 1.7390188394827228446 0.19029241041355121622 -0.33444399698354254635 1.393132790225376505 0.35100150995579360025 -0.43198412717087086854 0.49388985290938780537 0.10990822452297645262 0.014698348972295476739 0.68181006727286175284 -0.0052111816800062202293;4.5386120699626406605 -4.4189975107377721386 0.31212767728724855054 -0.3978922091205210898 -0.10810979630438996568 -4.7520542357478987583 -1.2405994987706872035 -2.4365647034083237621 -3.4085757890520764768 1.8059932575735324622 -1.3773330452800669477 1.5338472872154218507 0.97662826415908021715 -0.7517391516575715471 0.47168797749525820384 -1.1728866259711301367 0.58964352792866481234 -1.727879727618226946 -0.28666447357169844157 0.30652667475753136994 -0.53192103128326306827 -0.47960253700131022514 -2.0142496427253901992 1.0873032307812335873 -1.5678313710911535583 1.7130350403730409958 -1.8666289872651626869 0.78586576628817261803 1.5016317187905021679 -0.45660720314963304522;-1.5455962415866677517 -0.74421753538258561544 2.4878046238370061793 -0.87864057350132140911 0.82643720197851056053 1.5630093084592393549 1.3021659560576726022 0.10214485634836709127 -3.1775008078152233715 0.46195169848908401722 -0.034102764221162006064 -0.0097650629002715531868 0.32725091902570591085 -0.39730290775079196708 -1.0248661708445421237 1.3315561252694128047 0.10272652547333761819 -0.84980295454019560975 1.1077353939520695469 4.1501682175574945433 -0.24211013480249374274 -0.77564129145564142398 1.1878267094006595972 -0.31535226874135585673 -0.87854128649649887439 -0.30473932645350554349 -0.19042202985460240927 -1.4979036560404099809 0.53038834837073145501 0.56610325066898758983;-0.11055758883350884358 1.1606205224748422644 -1.4819873325407835196 -0.017843186798918494324 -0.40597790143525741557 -1.0536441721929472592 0.36293905363652934071 0.4986846605612059169 -1.2437348429170165254 0.20381400906614033364 0.83217507904073528824 0.64522149936818251614 0.1178054571388211097 0.17965836227314987972 0.20699145076850855585 -2.779326760971251975 1.7344787519533828579 1.0816359332089497958 -0.38749273543610524007 -2.0267848981770644201 0.095959842234747294576 0.02549017182629430972 -0.60009546361729360076 0.2228682885871197672 0.58008821560189283151 -0.64737341058899133817 -0.20235235352023958622 1.5385964833462373313 0.21097502883310551014 0.70316738037649695325;-0.86611042278576921838 -0.020944590582669064815 0.49335607499235667461 -0.34788026520869741454 0.11702925374871589459 2.8600519214248874 0.45927470946718917943 -0.26370643937343651864 -1.2978783162165359322 -0.04445762166894667855 0.69901413664755196464 0.39442666021166039592 -0.37810664386449605034 0.030293773848165093249 -0.32461276746654549319 -1.4012169896942250347 0.63885583519095134886 2.9542464869785507453 0.6550808523287302565 0.83285067480867236434 -3.8156450528193510685 -0.30142799565809413886 -0.017955118603965529445 -0.15845364231203723504 0.12952420434304040553 -0.26086603283675791065 -0.87486451651562380238 -0.31754167497194207836 0.43205406074517821446 -0.54869489605069687865;3.5459777234814966462 1.3698381696230685911 -2.4887692709732234242 0.035464805913204069943 -1.1090674637900683752 -3.4109976832425279447 0.36606938208400707779 1.2001225747896782092 -3.017262089643300893 -0.82728028246458140682 2.7091484664066540766 0.086105315787349936962 -0.81891583595472006163 0.1605830057854290005 0.42877186881998313739 -1.6476954240064412005 -0.22182661388236837863 -2.7693639081419454406 -1.0170020116917961595 5.7479788799494562213 -0.60499286201836766086 0.96301401530589525457 0.55441256374372982485 -3.6093941894634089529 -1.0697101996107023503 2.8389611565340180377 -1.5587696770703640681 -3.3325320462411145428 0.85639282319038667612 -0.081012248424002397673;0.70227927101690368339 3.9983831501170477019 -1.9413216066493372836 -0.48942856648369564843 0.032201241972590985418 4.4979552895591510264 2.4587294402167412244 -0.56091870804413979101 1.6170651390605610409 0.42254411579084238948 0.14539973504988745745 1.1004712188112781845 0.98157935128105133771 -0.30846198238599714658 -0.092429290343212275327 -1.9884762579665336002 -0.0021348597765260060588 1.3496369446436942141 -1.808065197110259259 2.4884368568450332404 1.2659744105789030311 0.40863738157896617453 0.97694843878163517559 0.226067770117609812 -0.6722433894772884555 -0.4977444138284512487 -0.088000952813891170079 -1.7285243714104474577 -0.17523890145808668217 -0.90045178382822688157];

% Layer 3
b3 = -0.37138021805465654124;
LW3_2 = [0.93579774177118946188 -0.14879658109325910598 0.65459406381320106583 0.43837297613144099451 0.080059708585110758716 0.27383523796138370399 0.51494062903638881945 -0.46618888198763303032 0.19158701803593677915 0.52520251282334162735];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
