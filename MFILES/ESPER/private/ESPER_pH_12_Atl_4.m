function [Y,Xf,Af] = ESPER_pH_12_Atl_4(X,~,~)
%ESPER_PH_12_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:24.
% 
% [Y] = ESPER_pH_12_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.4741292195406217047;3.0363750830102960165;2.1983337618877385466;2.8986599762327580621;-1.8847242203103535818;0.92767232828832668634;-2.0418775799033954677;1.0317585253576677662;-0.8771687000515719923;0.9736083425636409272;0.6806170449975060821;-1.2735936419678774989;1.416764012004748885;0.32420340338984809936;-0.49022109898639359971;-0.7698817406433067223;-0.084297683454772245892;1.4765306393995198952;-1.1490468316140973748;1.7394391017161057178;1.040252245748173765;-1.0397061785606027673;1.7997675899564866686;1.1528269101544716957;1.5367778670470553237;1.4599140872812672587;2.4947985048040894895;2.1930174543789981989;2.4730626717583166219;2.5413500120380430047];
IW1_1 = [-0.44887427681305080984 -1.4341165352837172975 -0.88198229130278527066 -0.62138529664818387133 0.08956827414835431822 -1.6059085048766745807;-0.077329943595584621496 0.57709042121906872769 -0.89997516588325998654 1.6521725728757068463 -3.1253978091271927831 -0.38835133073637889689;-0.1201173064804379742 -0.10407010047434230027 -1.0491692071116192064 -1.2417907298560229012 -1.8784956894023039364 0.89642347586631598855;-1.2218949986671054919 0.91617662895529394795 2.1218497749233877769 0.32108160529732748811 -2.4185769560428913572 -0.24767948674314563262;1.0089129437719013271 1.3250073419124019924 1.570961736703696987 0.21613943337973273717 0.13443723461002479724 1.6897375434089934032;-0.25668187544678022771 2.2655149035806694258 -0.12973027199319317471 -0.288679539055873291 1.5313831082485755974 -1.1044585242917976942;1.1528190298710143669 0.7824166829141987467 -0.44306165397824742724 0.91538328034615323858 1.4870117979884669435 -2.0148305912403752238;-0.86120536009979342662 0.7837887289296483484 2.1349005888536116693 -2.0504600666715169233 1.577843361753301199 1.7060956271266944917;1.3093746936930186209 0.97571978306728424091 -0.11260454170129238771 1.1198838744919394905 -0.79740683016670010907 1.1736020080150877387;-1.3891011756240330133 0.66233182057580219926 0.59583825368838005954 -1.7385914053105175903 1.5299068994902442764 0.59502523307155263943;0.1421347067434678979 -1.1899859190220534177 -2.9121029857007285635 0.79372696513919582806 -1.1895644633256987621 -0.24157661720842768527;1.6809056638546255869 -0.20463684113169222645 -2.4512604193104947647 1.3409635037415681413 1.0852222622293992149 -1.1846301538666965669;-0.066906313574370449015 -0.41857331181091050887 -1.3013202997258972449 -0.010839434866256922319 -2.3053027425250482985 1.6346151837997797696;1.5448351774129169822 -1.942962497812864564 -2.5902190997844698472 1.4031358173543546641 0.02943506897403238079 0.32722546978322120115;-1.0096084908763818255 -0.75794092446248717554 0.40380396534906609629 1.8374788844642422347 2.3733479579347558364 -0.6112381556246414549;0.67287416856699688861 0.40331359957757456636 -0.70016217207654340982 1.5950088673002102979 1.6705711561408889132 -1.2756398027368309744;-0.62525761476440744335 0.52800811499478683686 -1.1621952687573833263 -0.58301407061225696271 1.7005216902385353883 -1.1772686591050729454;0.90283822022404358609 -0.81434498122056264702 1.8742257573349712096 1.5577994480347800987 1.0712422945065769309 0.56275329660168327273;-0.0099159955551692772341 -0.26699576253353812794 -2.8089425625378261486 1.0907481184800442708 -1.374982259522140593 -0.4568819111297512392;0.42292610979160388807 -1.0168033726110980997 -0.3611529469079326482 0.093677649705813575975 -1.082153624668364289 1.7749527847159458638;0.50415285344655147437 0.63579063368017629809 -1.3219791657812052232 -0.6438981524610426499 1.7004834761412266353 1.069349420769867498;-1.3112548782017310334 0.59615752138686650685 -0.24815503369750033236 -0.82361370791962240645 -2.0809254086147030982 -1.7009102967635265635;0.60656934756905989126 0.62430737346417664035 -3.5291351689721968121 1.1431006694051724093 -2.1498744196630394931 -0.018671158112447211463;0.45475280803092299475 0.20711606567415927205 -1.8519981767356017421 -0.13162221322349584862 -1.1338450034303015901 -1.2168520538403337916;1.3942708994099182185 0.38386124160419482498 0.91551031890836154226 -1.3162880033299770854 -1.1551952175292488079 -0.611445996867535424;0.55760354093135278131 0.88719834040150147292 -2.3006396202907133386 -1.1866783191423568855 0.16781085486205357671 -0.037348569885755973641;0.5073596509110740449 0.38037099541852376072 -0.54016367249390828675 1.9153459946587532148 -0.17112808527158623884 0.95252187581146341433;1.3847614861799959485 0.00048581797412357123622 -0.24171196746317641368 1.8766368469096701421 0.89085107074448954823 -1.7648462727520934923;0.135625829343801102 1.0006860634883163463 -0.92540927160333097401 1.188257668866246286 -1.92142823116513628 -1.6002781536162458131;1.1353994073554956046 -1.4259662331461597784 -1.3853642272479183006 -0.21390394903031742513 -0.74149316962534383979 1.115834849231871484];

% Layer 2
b2 = [1.4335800979800530364;-1.1632256906099489591;0.79667042087320771859;-0.048068083793174204432;0.48309097301209996678;-0.0011427950543860024811;-0.28943547114060708125;-0.9010057085282109357;1.2750727185720076573;1.7584099924443876706];
LW2_1 = [-0.19660748700197544503 -0.22873503375779885571 -0.56139859113157963844 0.51987885145843892865 0.23145552878175870704 0.15349255653798055121 -0.13059090030600903343 0.22879619624372179998 -0.039468189675736078947 -0.027652677841783986773 0.31509918499568001504 0.34073035963463432774 -0.67425995909721947452 0.14625375980435686984 0.38622756047948580971 -0.0010918926941116792809 0.41396397244645050106 0.31139240402473256086 0.10125959798830587444 0.61755754228943871009 0.27790482111577602398 0.4004967294810206635 0.21093002720488493451 -0.011168508413610587354 0.2242389850638838722 0.12957392037017934072 -0.38995179036133276185 -0.35974833025489671989 -0.018801741465055657465 0.10712375128597230456;0.37187503111316444482 0.041802922023755108294 0.11572941254082280693 -1.176421230633890147 0.1579523954330412927 0.66632631432913125291 0.35203309648405212151 -0.2081648505825577089 -0.19798291827679284638 0.8055083337643927921 -0.45260070736497032273 -0.72122290262777888348 0.56268002096386149358 0.30514260758924138806 0.032872022568741048054 0.45996436086092040707 -0.063966596665261638011 -0.46817463093969963195 -0.020364831635305703783 0.9065940452313303588 0.2346761153065960448 0.57387040456728799498 -0.81385267455817789095 -0.17935654984598897732 -0.23185012582526604019 -0.30156747245576576155 0.83495051444214862801 -0.49725274391242518801 -0.42335394743787174709 0.12219540537299643235;-0.22275156777385993201 1.5502280546091851132 0.21406692927008982852 -1.0043139319253002739 1.1149211206692373199 0.17530920617289538765 -0.40716425281944146342 0.84218166106427083673 -0.36639482505425835512 -0.41676846808096107422 -1.6527859762264289767 -0.46539235422857128111 -0.34130728803151866302 -0.0075657946212362749139 0.82375954975317777773 1.0987007010098810422 -0.6977990888898282229 0.10371293713396263769 -0.15160170286034613252 1.357935678543855218 -0.079611015760297304533 -0.20594288975865870928 -0.47657624165383916104 -1.1932296969714626389 0.42974522518248109426 -0.3151564526551298151 0.76617579600301888298 1.5423500584127054491 0.27573762400771939518 0.14792659029060276077;-0.53646154820236169325 -0.55082258040930975884 -0.065509674749667193283 0.60994803465318869762 0.35763351870868770321 0.31750926706895071794 0.073930826536270366489 -0.036713714864771609947 -0.40167909457352130032 0.098799721952232771871 0.21799432368719703912 -0.016436846588897768839 -0.095243918714121439395 1.5171732001678235324 -0.37918023034366848956 0.71535867391340379751 0.72585107463727061017 -0.42112024296543759672 0.16913741513063881849 0.37515284746538801741 -0.68102646016781631655 -0.091194178965695732453 -0.22892802731291506113 -1.4994624667998950329 -0.40811074275907549547 0.92590368204214379411 -0.32509326562308654696 -0.56662838888031630269 -1.1046737381086928487 0.66656492371939124464;0.052843519248652784381 1.9572272418363476643 -1.6191787919664986095 -0.13972914373248848663 0.072079859776550472827 1.7107914509359287702 -0.23334942091587956847 0.23293246635843875558 0.16743311177459496708 -0.2912558467364270709 -1.6908629533813550605 0.5852486768743085932 0.24147720281149059884 0.60805454693289118229 0.99268803844569142303 -0.51804941706430385207 0.060284452355542313129 0.67118367814136214999 -0.26438817050820573318 0.3902823486719380619 -0.90716930487588876009 -0.89269652490292616953 -0.21839123064545404307 0.19641858226559857914 -0.22784701553505987137 0.66850473082406569603 0.62100020034515535094 0.43744420242611853356 -0.36786891021241596711 -0.27848876228908236996;-0.11869825983087653465 -0.39744588027699390143 -0.39361972058582700429 -0.035996247583966696493 0.61899351248001510672 -0.22431422330339589877 0.098661803683891394212 -0.18909907645583234892 0.3224037063815917703 -0.34521210123135442904 0.29135512423772863544 0.15364478174147236378 0.03435171338601018115 -0.053136156728375939784 -0.27941699260791780235 0.10031040970351665087 -0.22285258000518462507 0.029781332309753567184 0.26396901542484713099 -0.1333459972536161775 0.24479665782410406361 -0.091612558907945784714 0.083583955811207616415 -0.37630541587014593174 -0.29250620182861702956 -0.427829056433922994 -0.39249165274494696165 -0.4572580494628837311 0.33183600297605042595 -0.35829604940193648943;-0.40175801886217143988 -0.068887784821133044022 0.52118631761991129903 -0.31650722946180820383 0.17341691099214054383 -0.51475827540251495318 -0.8083365729820518597 0.22591508356948530878 -0.10187689682268954994 -0.64769026787719918836 -0.81591267047239524057 0.16346406864286305849 -1.2999376068216967894 0.26740072217235905105 -0.32125665289367355548 0.030473968145249521328 -0.073758119005979477789 2.1529968686707876557 0.6753368744323581252 -1.0255335649849504076 -0.1680676849177064891 -0.43569365747591082272 0.31813821225827310091 0.078127827363038804265 0.52429347943763926487 0.43300549616611933024 -0.035811630716666938146 -0.56958098899092579614 -0.43773173357804739947 -0.054709262308577630285;-0.10763500395484934535 0.22954641953027657419 -0.10453436896327432393 -0.37448186216502471479 0.40233129205727591327 -0.22318519319743324036 0.23053371686976414923 -0.33076304822095398128 0.15774165025761710535 -0.17447803636143499606 -0.12473922797440312182 0.075564346102328677768 0.01391990986028418878 0.010256026187786891624 0.099814825205815374543 -0.45807920145265490497 -0.51709879340735942499 -0.070629818051184414807 -0.38905515343282875973 -0.14778813200122400962 -0.41783074204775116911 -0.46958343967148119535 0.21054847110794133735 -0.27679637381807919994 -0.16623182709199538221 0.042946892541796288789 -0.47277662772642026212 -0.54754320287913638143 0.2040550848505268966 -0.021935836518831786784;0.35152131524733748469 0.83388230419215148004 -0.46496220931317050473 -1.049265606617839186 0.013049576403325996096 -0.3781092808284786666 -1.0307875899150120702 0.78915293345325210339 -0.42217145410165363151 0.20113201756274523557 0.10515682329684915286 2.518464806618907037 0.22430549683623093871 -0.45700327285029707092 0.28421186728060177096 0.67178803629691763444 -0.81688654963925710906 0.019690495875900444755 -0.54983213688160692545 -0.41539316621400246277 1.1890217161956118108 -0.57549338809919425852 -0.68980407799604726016 -0.44219762465983342148 0.34351305938968851317 -0.63526434204122350646 -0.94364556778254460312 0.49822211619053963227 0.940292690096832251 -0.54503776915904489364;0.61546227276215659252 0.22280448371221228676 -0.39865075586595966062 -0.47204744397336179107 0.45677592289295360084 0.13007149466157408302 -0.40027310172199476179 0.41312550336438630394 -0.4275764053389528585 -0.32674118391934459105 -0.17962058570492214771 0.70670096745891930468 -0.045946633651270690768 -1.6248237141055710264 -0.023668750955141093506 -1.0260972214239492128 0.084103502600857818483 1.4104264890341573491 0.74786354010152589211 -0.47097733528705693073 0.25360983177547341549 1.4698396049407593811 0.65545768511635182918 -0.58059172824669691426 0.75224395540762367673 -0.33840724010181666426 0.72339005982131010519 -0.20150832771846452496 0.85955828262623479308 0.034961417061743313428];

% Layer 3
b3 = 0.25406911217362682098;
LW3_2 = [1.3854774296571050751 0.76401949430695892396 -2.3100157536686292126 -1.9591220201243666477 1.7785569643913772264 -0.39218271903310336635 0.42396654431788999284 -0.092767698667144404823 -1.6810605066081507619 -1.2494072938888378665];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
