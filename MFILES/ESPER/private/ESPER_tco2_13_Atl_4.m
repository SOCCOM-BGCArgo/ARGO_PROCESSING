function [Y,Xf,Af] = ESPER_tco2_13_Atl_4(X,~,~)
%ESPER_TCO2_13_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:59.
% 
% [Y] = ESPER_tco2_13_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-0.2178;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0461352500991908;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.2989661168601731;2.7531090543911594;-2.8394630452752665;-3.0777914120223824;-1.6307766151876411;-2.0835184999201655;5.3964117751316101;6.0248959521954584;0.079011508301559036;0.56550570981163317;0.552948024452526;-1.16907530109744;-0.80052168058575057;2.2083942229903109;-0.82076899479638288;1.5026823317111657;1.5569571574232852;-0.79642495450854311;1.0613992410762074;-2.9709542574201495;-1.1353112763522448;-0.74939693171554667;0.49141317067846768;2.272801820246614;1.1410215861362141;-3.2218736800235686;-2.5088567716070034;-0.63820695139313088;-2.2760994753001507;2.4845416351927669];
IW1_1 = [0.80059157968598216 1.2542870755300763 0.047214427255828154 -0.18665573495721344 -0.79759300617339557 1.5110786716583482 -1.3051105202481743;-0.76556110760027096 2.4328267638573622 0.53571849509757874 -0.30755021530112459 -0.81804955071408569 -0.0099005715578328914 2.4975133147232387;0.70074075841446948 0.9898913290943121 2.9768582482194113 -0.039717223515754116 -0.71065737802117579 -0.20154896181291185 -2.6307525731064452;0.23425655605431248 -2.1380247881232819 -1.5003040114284247 0.41642706540007884 -0.37148688322011042 0.73483495617790395 1.1436300536586883;0.047835783376782258 0.65195324360761608 -1.4402383920439774 -2.08448380010068 0.30689449448315431 -1.2593595958618657 1.2152977120049409;-0.3486179362362869 0.75061226676080062 0.98864963394883021 -0.53665902320293191 3.0592541880015376 -0.99588451089240049 0.46406881714501014;-0.43744952033078083 0.38782464884734907 -0.32178167316109035 -0.57053388731906585 -4.4523993817369663 1.3298896953771644 -1.3525070003621316;-0.12737990749018013 1.1911205525561697 -0.4961966999078834 -2.2416452349826188 -2.7709798200169007 -1.9006106829478338 -0.8977034380706157;-0.14491093537175995 -0.076387789660658262 -0.33650517190854073 -0.016964247317144913 2.9612527728444542 -0.22376934715075514 -1.1146285796427369;1.2449768781781763 -0.22905639897155083 1.1085355645003092 1.1093252240876148 -0.73692991280316178 0.21758019641199042 0.79261366902355501;-0.59585024219380334 1.1032991955371789 -0.86528315920776522 0.35873891592172258 0.077682276656026755 -1.4785277197102511 -0.61215849632685648;-1.6572957142779963 0.38579339729150713 -2.9653480640842083 -0.063038866215965064 -1.5012767059533483 -1.5201039436279489 -1.535857052808091;-1.4328118373337315 -1.6063064643436793 -2.7700859396003872 -0.44152808970317847 2.9054401062357926 -0.5365927610006922 0.069035143765855206;0.087816394910098891 -1.3756003553546645 0.34555123479147209 -0.013465038651300281 -2.8433757658482377 0.90507363616349779 -0.43359035722849615;-0.10080301988707416 -0.19167067848908045 0.58426703385322165 -0.095609689510571652 0.48138796417922952 -0.61217129936808234 2.0373572523296453;0.39043598717492961 -2.5901794566191843 -0.7824002502042402 -0.71041611475064026 -0.55765592011328335 0.050975378740561003 -1.2626151502177754;0.46928471527371057 1.7568871101967507 0.05616129583802864 0.20735679049579955 -2.1184567128896479 -0.73656734633105181 -0.18042965602684774;0.64252418071982742 -0.9470438878820947 -1.1623049388255753 0.51716516416361702 0.94166684274153312 1.5068574649602102 -0.50526318772171863;1.2041977370288592 0.9662964134784956 0.96958350423842043 1.7705044576326123 -0.28461706299708306 0.22094096331354138 -0.79761132322324357;-0.13515844642141661 -1.3431425372954899 -1.0626156519731589 -0.33998590644074322 2.6715071036945077 1.3518748554372999 -0.075762076680499169;0.81381938005272414 1.5105933635738735 -1.27066923347922 0.26292415755963883 -0.60363892525844853 -0.12144453169070656 -0.32416120016217559;-1.8202163953607062 1.4892691870829737 -2.4394241274481256 0.74703593153486114 -0.59781745840875766 -1.8865327319675849 -1.6335984784573212;-2.6544838854323967 0.84965164560804274 -1.2302805095230782 -1.37196117485029 -0.85197871688598725 0.10151991103839389 -0.32848620191014755;1.1405807499557574 -1.4501911664230596 -2.6682129656563718 -0.82796462301482099 -0.28983278046891542 0.0014321988406920706 -0.6155294337341437;0.96851027331789796 -0.078346529833628248 1.7176065628758119 0.11327085808007067 -0.40654321231267421 0.76085779128337028 0.18013384886333669;-1.7121603109922061 -3.1453500311758886 -2.5862070191430093 -1.8858869254237156 -3.8915556111585965 1.3695214077291169 -3.2623904264430093;-1.4919930532542769 0.54983167724653015 -3.2734554514177168 -0.24563325181958989 -1.1554340202799951 -2.206473056549862 -0.68563216021593643;-0.25400110145606059 -1.8100177007559208 2.4087128453649367 0.11598996406712303 -2.4799709739057887 1.3298835279491712 0.78253048653225066;-1.3441744766310062 -0.17400455910249468 0.33211764311258862 -2.4665810662438177 -1.4153594389867992 -1.4998839526004759 -0.45333459287113215;-0.08914456674575276 1.0849860418525705 -0.18347502082594 0.45757767877343564 -2.9123915826375759 -0.7787007128209823 -0.015684681385471511];

% Layer 2
b2 = [-0.72259743145792088;0.51976439544258313;-1.8291537298228051;0.94986915115858073;-0.54456712853975098;0.25877641857835465;-0.42754560304058886;-0.36830289392567489;4.0758775714711701;0.97924535078042019];
LW2_1 = [-0.097659872158858074 0.40145958707190144 2.1775585726978712 -0.38411528437692605 -0.70252453391633451 1.8591488942234131 -0.49583768463959543 0.51400554361214013 -1.5106951742842805 2.7187319227164219 0.50999895547226892 -2.2008210096251211 0.81429972640812709 0.19907745668477175 -0.61481094296205607 -1.8763049958035307 0.20646137908266676 0.6017160784480623 1.0844385877797551 -0.25548929838111467 1.4391247733791177 -0.93259549184733703 -0.96475658707900014 -0.45166253933533496 -0.59938174284748835 -0.66187482394421626 2.8380427581036525 -0.08341781372985678 -0.020429638006660793 0.31260930683311616;-0.17754149483806 -0.49730891487858714 0.058514310617450299 -0.21366819711577234 0.13035097899579928 1.2546008524394794 0.13983890476056685 -0.63003815663619878 -1.5178959733106172 0.64651603443404837 0.3207884675838702 -2.1941532015456238 0.72315011812504837 1.3894623621567235 -0.24143339024038363 -0.64622760812604274 0.97673446628321625 0.33476174432727757 0.040301768070376477 0.6653309130842624 0.58527490025225481 0.47169849861253071 0.24770743427161349 0.4213468342320591 0.81392379187866704 -1.1360464513763469 1.8062738386003205 0.61056532103889971 0.2332931008930284 0.29256643235645236;-0.52842436941633875 -0.52741105545886147 0.086038555795497462 -0.37690338352857156 0.15726097009714041 1.3522943292481082 0.29062362642821188 -0.70882882326211205 -3.4838080238673839 0.57628394986326958 0.13048087169048381 -1.707272083668594 0.79532998834456758 1.3282411513423253 -0.45741151345145503 -0.7437320808253034 0.78341159832693319 0.2519725349567708 0.079323265303448812 0.81418465914252869 0.76494702154232408 0.41728852378406317 0.21031052488614752 0.41881009148621068 0.78905942870700108 -2.0651669810459947 -1.815347069779619 0.67259390706167088 0.28144243273590014 0.68493899219239907;-0.49346947646734696 0.23206011780735411 -0.0003032719161444597 -0.21272122397117088 -0.001542845024367091 -0.39723030116738617 0.5899985239221861 0.22696407350106779 -0.48703811951620368 -0.71710877254544292 0.13511243967391701 0.64639736027555117 1.498393539006287 -0.20298123546618513 -0.37704000023765588 -1.4203650901521674 -0.64361251023296684 -0.60272435892113374 -0.10399512156739581 0.41072878500500304 -0.30115007209783434 0.55223955606521402 -0.52253361255420294 -0.90208976920328265 0.052769436752249294 0.32307572117322647 -0.024017807480661922 -0.22653533179103355 -0.14890256050433259 0.7477644908900426;-1.5641508709986438 -0.16073758694188844 -0.56293580802994636 -0.74473053823535218 0.82647881516989052 0.29164158494639136 0.49473158465418177 0.26670856380708002 -0.14224922758117892 0.055739499790246824 0.88345884386639306 -0.13508882171712702 -1.3574120160221597 0.6161327129528078 -0.9170456674065397 1.0923217137755685 -0.01917051781410227 0.17017097546777657 0.69218104178810047 -0.34227184036818054 -0.45817184260781774 -0.12374215167469743 0.11647827677731695 -0.095636277690391444 0.13655119349639686 0.72819362301310908 0.16180677026735663 0.46561580953257775 0.52046440272883676 0.44721042847394116;-1.0022716462139178 -2.3330997137597453 0.9250024181255968 -0.51583441854079515 2.5049041799095497 0.38976464907190411 -2.1480273783207822 -0.1002853482915721 2.4667265260322688 1.7453952565747139 1.2086476626607134 -1.3430343589302798 -1.6423519347041839 -0.30609179442795098 -0.38594559206248491 0.28944875160581829 2.51789379948158 -0.9124772589399327 1.7363746689107162 3.6596226258635736 -1.4443290681485652 1.691234582190823 -0.047231535164899856 -0.24742363209556337 0.67647848706944758 -0.070647188018820931 1.0343041509084208 -0.45879905590080994 -0.42717075240772451 -3.8461647402968597;1.0413913946004216 1.5901717614289439 -4.2573570457452705 0.80499328212402255 -0.2016933489458089 0.04192340954905905 1.3287766014088314 0.64201381430025983 -2.6069293641916254 -0.18614003077795188 2.1434849080069953 0.12868452227199609 0.78318062676886946 1.0704567293061111 -0.5092529843684932 -0.69246694269465359 -1.9018486493994975 0.90671713620318073 0.17995591229501468 -1.343575907545548 -2.3914193678069147 -1.2544887914716818 -0.90647569144594842 -0.7190548879308295 -0.36231285576438554 -0.21327341616588219 1.00474661917144 0.98084318315199415 2.0403514384762125 -3.5979165643912512;-0.41156822968873996 -0.42030981399639672 1.1696781884320977 -1.0653124208073232 0.44474304826859407 -1.9818773430810928 -0.77266825538625106 -0.44183059222114895 -0.69763535060023174 2.8774638739641771 -1.3976857882984499 -0.60657652932407979 -0.71506504392269521 0.073246899351324307 -0.67666457171017436 -0.011962745754747891 2.6744869590724236 -1.1408418672955434 -0.54195566299627596 -1.1138744761089843 -2.5168412521398289 0.34612374054169676 1.9838231608863068 1.8970847401454631 -0.60564837453714615 -0.13883642165687088 1.0709265776819008 -0.067053790270625843 0.87255711157722715 -2.2063761374925153;-0.95904981348415608 1.0032956971830456 -0.78061805899053049 -0.40697125150199437 -1.9542678851875612 -0.59168462412467115 0.021934277525654425 0.30004319379297695 -0.22492582429688765 -0.17010422769827541 0.43716079844384897 -0.65063074788568842 1.4489279884230595 -0.088684334977583865 0.086300888396339551 -0.061943315977071915 -1.0369709918260541 -1.2638265986165398 2.3392666801024973 0.70185527526298996 0.99600758917519561 0.61507668012748196 -0.45083594638597646 -1.4569348004201046 -0.97754085244163191 0.31094260569716364 0.080559352619009927 -0.22917884794897156 -0.48409723131300625 -0.21476843839226026;3.1345761923676219 -3.6628351436810584 -0.5735566786061822 -0.7902467461669227 0.15480757932332462 -1.4618362744963895 -0.45305182844171432 0.35339797727134253 4.50376006871788 -0.87156028769634719 -0.86326141436646331 -1.5441225246065489 1.0627358650369521 4.0861973388909707 4.5416088365811458 -1.9600838641386635 7.0017871864317343 0.28011972816692149 -0.048514953957218498 -0.66953371877481371 -2.356902222580211 0.955195665510985 1.3712708332706989 0.26657981982169127 0.41855015739142765 -1.5836020691641848 3.5413725774990357 -1.4754087482810083 1.2123707752331807 -1.5922110190875747];

% Layer 3
b3 = -0.93222338653263892;
LW3_2 = [0.015282608339584093 -0.89141800224499967 0.74810589984363507 -0.16309261396603594 -0.025147612351656443 0.017330395247759544 -0.010916468479469438 -0.10533767827347612 1.6096781972728846 -0.012307034780759157];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
