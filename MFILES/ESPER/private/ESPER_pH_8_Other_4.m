function [Y,Xf,Af] = ESPER_pH_8_Other_4(X,~,~)
%ESPER_PH_8_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:23.
% 
% [Y] = ESPER_pH_8_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751];
x1_step1.gain = [1.0000770825255;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0588888685539285];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.7461089040284947238;-0.22398903564587357984;-2.0929165261108533258;-9.8817894690862164708;-4.4427297997372559024;1.6105422619287652619;-0.19464141793231334865;-2.2365670810144386849;-0.028486260459953078455;-2.8669296504394674585;-2.376987213959130596;3.6909045312382913195;1.0809471811280018105;-0.39866588921242246402;-0.91724161522795755186;-4.5859274824566291784;0.77473323831551266228;0.46732492618385762517;3.322661876915974144;0.21713700753314274516;-0.49365812445456980218;-0.25299301103374177702;-3.5863608125386687853;1.1626246898452388123;-4.6907328240499985839;-3.0461047805949994505;1.1628351270401799944;-1.5030701621854907213;4.113266502264546709;5.3855880685897439264];
IW1_1 = [-0.68830082946157744583 0.47460084833018323369 -0.34029895456907421902 0.19266492415154723439 0.015458341361781442053 1.7570646216359206981;0.21335560290917901516 -0.49363900100898522316 -0.19136563641781736966 -0.2046648641643655786 1.3698394384497909471 0.11741442928157680425;0.92518395532065889064 -0.42305091261489036203 2.0860919735685956589 -0.7049198458590197891 0.31152855256074923895 2.0932346556990188979;11.850146992109204191 4.90679657190198526 1.9886423657772871465 -5.9865863624785573549 4.8048345583366520728 -6.5433775830755527281;-1.1820579757519140696 -2.7698052805705812851 2.0046502835711423884 -0.51423674101928351643 0.96610239869879788177 0.19205085611199668172;0.033131200275282629564 0.41836582880087114233 -0.013997691068325254782 -0.015898152287403023719 1.7758819151105289524 1.6935840085501054908;0.24324018320745216526 0.35742422094741860272 -0.76052998037561947431 -0.099042470595929230082 0.5815336604850870339 -0.71660293128853858047;-0.92614810044192741323 0.031973329578498445314 0.44142795839450094109 -2.6919058839925602555 -0.58094099928798659249 2.7357590054534726143;0.030112215663394507198 -1.5878763716381369964 0.15618142111274394002 -1.3580692567615240129 1.7098868311219628247 -4.0153467190099085826;-0.60808965009208726382 0.90435264271371007538 -1.8685022721708905991 -0.3106629131464203053 1.1587298443549249871 -3.9672881202918897081;-0.34160389997947993024 1.0410436267903850904 3.1309872941232534949 -0.67208805932073223399 -0.15150683269887166293 -0.65898656730094162803;-0.096009529495291748291 0.06307277236630551287 -4.4667304163874188561 0.27792241385051746905 -4.516176996783133113 2.7541418840640674581;-1.4020470779788445359 -0.29802688873943861125 0.15468494618806322149 -0.36134727056604221129 0.16883017008960343741 -1.1352905645273769775;-2.8574500461077034785 -0.6217730127526476247 3.2342106207362699699 -1.6135589867194559677 -2.1502947363307547413 -3.3415008769598282257;1.177980566767051096 -0.36406294020886165175 1.2105720733803326805 -0.40536019329372541264 0.96797324468824430532 -1.2049119133481944743;-0.5079059309291075186 -0.17901673338742721264 1.2478513009641702958 0.31622050655364369875 8.1439190159093399757 -6.5427329026374643206;2.6171372565607646798 0.1804219515275544139 1.4133346969188183007 -1.2567269028134435693 0.25713265805953300358 0.986964403817879532;-0.28506343919889826077 -0.93815479707323912173 -1.9945613212016983784 0.57258838986373139512 1.5559017074550292037 -2.1352565241002863239;1.4209458469676126136 0.45172654786923949199 -2.4798965969413333532 1.4846517139103501126 -4.3083448620314044319 1.9024315343560398439;0.32065987226192210757 -0.49639734880182229126 -0.29806247268887064994 -0.093782519130675312535 1.0617184406816755349 0.60809479238390073963;0.29041147646247161829 0.30913408278931481243 -2.6653761151597277212 0.26807775525101296132 -0.78586963394181730269 3.8015041765511283778;1.5775776079605696722 -0.54088709747819196938 -1.2565147028115364325 1.0120620661282140329 4.1397092589382218364 0.44221752177262174666;-1.2853800929096390604 -2.4485973161980938428 0.89414722535576895979 -1.320062408711485169 -1.2729962898920328396 0.045295443500058360509;1.1278116750192965778 -0.80823689887665495224 -3.3396100654412639308 0.75810635148177341058 1.5542064245066842254 -1.2096114873077274954;-0.52762475195862823529 0.84803444679037431886 -0.029218258648014992784 -4.9552449130755809037 -1.7805233049277426893 0.15959669734685427711;0.28192894216897290693 -0.80248272515991725395 3.3191869975442158669 -0.20564830536485359525 -2.1453490336536518157 -1.2895008867956503362;0.34453485040671505413 0.32027486615815753401 -0.54987746721286645535 -0.058662317498026438078 -0.30470780656508617001 0.46981166128075485533;-1.2855577613292930028 1.748327784598330048 -2.8301385507156004984 -0.33136406369202031641 0.48296132125372054356 -1.4328135425156356408;1.8552804147754777819 3.1014451018633280022 -1.1056554542743970426 0.8805226494685310934 0.56279300253738540061 -0.059960369191433091074;0.24924763902508387248 -0.16987584393254387405 -0.77436941236826239976 4.3652113737397320037 -0.21421632679230140361 0.082661431897697951188];

% Layer 2
b2 = [-6.9966676009739838804;-0.34113789635608682271;1.0114387663548860541;3.250854047839442984;-2.5332678217172892587;-15.619146756745672988;2.5868096668812534666;6.9653077643564200727;-0.8686852319949613932;2.5045139334112156426];
LW2_1 = [2.6565007141607384078 0.93317186685071706886 0.73930314437609778722 -0.40153244057547826662 -2.4870329025139046308 1.6653084713127508376 -0.0080442962045338579913 -0.33873864594055330679 -0.15177821081791320612 -0.6590206447121972344 0.38746351141403589935 -0.2661921727236910562 -0.30372503739444517423 0.11684500983587363387 -0.22742285039718598827 0.65647789971649872509 0.52102111776902815254 1.5041861652782428926 -0.090119234938258810375 0.28890776888088848251 -0.030872262693361761376 -0.1475959692243845045 -1.804940111654007362 -0.23697659606334783855 0.80766547881795736075 0.1705150721299615868 0.42193138452702921848 0.27930677295940364857 -2.2897017736815903355 1.0230046522138722676;0.44163426837616531762 -3.0279170571572073811 0.38612391744376289848 -0.19746947764686675897 -3.174996851029547873 -0.4902164145478498658 1.3230736332146815215 0.46138530630817992106 -0.35469672753994091474 0.1644704267993940261 0.011362211937920129248 -0.61374021745773876813 -0.90066206648944768798 -0.028748101506419071471 -0.84946188763868890614 -0.35509508962673658194 0.78482074093057663244 1.3655724575895347161 0.1950979042798308416 4.0559379836233828698 -0.88960678344949417617 -0.2077551184253283445 -1.9510500257702314553 0.17664541647156059567 -0.3235040577488447755 1.6556398041275113275 -1.8452316336198537616 0.25226272582523573407 -2.3022141775127615837 -1.0367620794928291694;3.1050011860899280336 -3.4011369682908112466 -0.084396552530436597106 0.5114286326424110074 1.5381468837219236523 -1.2802073334162022977 -0.76104872970565329293 -0.34216585470764443455 -0.83412293376970925163 0.151429584880559992 0.59254521308302177118 -0.20291893772595009926 -1.3172961136793048809 -0.014650204640446171794 0.57365005452215689363 -0.44145980010663843363 -0.72043379380559313674 -1.1699976369829132583 -0.049369846688220586639 4.1974276589616144051 -1.8472471924508997443 0.437061385203143693 1.0263585687568845817 1.9249474407071107684 0.24180116572702861633 -0.23934614948651139477 0.9922803115011523678 -0.17718263931127845034 1.4180025199743708786 2.2269806285429858406;-2.0062515645346752358 -2.1841149998803572885 0.48085223439762642128 0.19860977132550380886 -0.36615196756010442991 0.93080557037334976656 0.65672743523747156846 0.46437934161929839139 -0.30929543113869079063 0.33186981453718145119 0.12901273646678215745 -0.05801380204825575676 -1.2486759708289734139 -0.096485735261931729334 -0.49084042333769073441 -0.71929649863105149521 -0.15973863503304222555 -0.99070177336527465162 0.13887083751893883332 1.9275391765249927367 -0.95772525419087872756 0.32697916430335172144 1.6450164906361322004 0.27128887286827507719 0.10456068685154749909 0.65399658730648524418 -2.2187838838507629724 -0.11159082229454614366 1.1300844180975535558 2.4001976411366117148;-0.4689190756782205538 -1.3378198710158444307 0.4201771932275050192 -0.085926101391150769282 -0.71240727234675216284 4.0930084970056643812 4.3519961763494832141 0.24652499842082539749 0.091145597934318700606 0.04298607644828057045 0.0029472294958132762809 -0.39677256074363986826 0.57594359781914861163 -0.0036512312357932074497 -0.12246436932341336901 0.56494342310501122206 -0.031717309029244418472 0.12302948513653855223 0.21422033788840974533 2.7398454094691921945 -1.4726410234554065948 0.26147178919299690625 -0.76250694087867998405 -0.70558573358710618972 0.052860424815607022497 -0.29147926447409899797 -6.3772418603238740786 -0.085281150331628335914 -0.78764558750213409244 -1.5200831326087684836;-5.4733692319354423361 1.2252948611042722149 -4.9363004371356682398 0.66166204637792724874 -1.9425709406529558798 6.4659317563504226101 -1.1099156084148738 -2.8753257346871321509 4.2625587813059233611 0.45683881244091562035 -3.4179749400355361466 -1.3166596628328008922 -0.10403685216027501459 1.0633042811043595943 -1.3495787331441084778 -0.56614548702054268148 1.2339278812276943675 0.96046122326280858328 -3.1925231051580178487 0.8765772456612181962 -3.6045573207062311383 1.4557456987695651662 4.2816471042385018109 -1.0249001647777484791 0.58662592026423920899 5.4190553176692848325 4.8981581887285576826 0.29185212702063761947 1.947507649340293634 1.0744198256241528355;6.0455425264807969299 -6.0674089872709418003 -0.59335218814198087411 -0.30323164508076638768 5.1397605848255789596 0.37872486857098419666 -2.4983249190343501667 -0.30630432383663974694 0.30847625302211506559 -0.77139872131260023291 1.8683891203106135492 2.2048875415221238505 1.6825383953700832063 -0.28250152020123997509 5.2586521955149461149 -0.0017001693754455410486 -0.048496921786570015844 -2.5054059707965388171 -0.62905742123531682708 4.3838068907608676028 1.2935523468414529269 -1.2998034290157167714 8.4738934984036298204 2.2325865581495487611 -1.1359034122412265955 -4.2880649599696765151 -8.6693968544650346075 1.2527575716668337691 8.4480861896756955787 -4.5699194951727912795;-2.2690596404915099882 -1.5206125361007176711 -0.8883882438254568914 0.47525932205213677895 2.5436203765227576312 -1.3019970726698697483 0.17630190263499903591 0.065476467608948596411 0.14381605576021402881 0.60378538367941136933 -0.43604742201174706562 0.38455257249096097549 0.34378912237759406967 0.0070267194990921875639 0.45510868729611120287 -0.60809317487864633645 -0.6532653611613660205 -1.7104340463888740853 -0.016178599298110832999 0.0069905653146898755201 0.043982892968764696062 0.38311198158321574381 2.5504185386099145205 0.12129867271621530556 -0.80319122394553876809 -0.82815615661046582119 -1.5213412183987558013 -0.27131041764661717464 3.0189307963650238165 -1.5933568234825088439;2.0335982551945273045 -6.2398799042716488472 1.7532293525661521993 -0.0049110233716003568599 -2.0157786835814723858 -0.74543338656395952135 4.5797737367149355947 0.51526307831704554197 0.68760212605566128907 0.27699426780014663185 -0.021972117062121803571 0.035828888813795749246 2.1630153542656143095 -0.075034376707293515274 1.0243533565059719237 0.13553560583060747513 -0.23332058296800955999 -0.82317455604018274773 -0.084361666939884713545 6.2891924894076609576 0.13990239308332685919 -0.60666425535728729646 -1.8413683140282692818 0.047202795647196531259 -0.23217990696909923676 0.75307478741821776147 -5.6619756496396416168 -0.27779366972559949023 -1.7898570281626138279 0.28836236027108569369;-1.0654163240919836131 0.58658286992303731999 -0.18832278565475984999 0.44685221181477935426 -0.25097429490877842806 -0.27827672193505981202 1.017406068389945073 -0.54040554803811546858 0.91586640205463021314 0.27123174842991548683 -0.14343030393094147179 0.78472841426337303083 1.5074179617922687235 -0.01042326505642331147 1.580970859374043469 -0.5790432724443042023 -1.1815422753998481298 -2.8176346545704578084 -0.45206458372400276646 -2.297563291872541491 1.1724806256071755861 0.077612665587106804965 1.2353863845808730204 -0.17999345825957149825 -0.015652633564080396106 -1.3822253364549070831 -1.3679362985302745415 -0.37703606466013200871 1.0281267249535530617 -0.94562473275382763482];

% Layer 3
b3 = 0.23230886764212363427;
LW3_2 = [-1.6057049132487881682 0.74902095742877450313 1.2153862829691595149 -0.59098660947881020977 1.7055970963085851366 -0.3151238462610471136 0.21076676095034144187 -1.3813955178256209777 -0.66286613082274215003 0.66081635612727052109];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 1.90239167587468;
y1_step1.xoffset = 7.36300175998845;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
