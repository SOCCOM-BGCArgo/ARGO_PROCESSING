function [Y,Xf,Af] = ESPER_TA_2_Atl_4(X,~,~)
%ESPER_TA_2_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:00.
% 
% [Y] = ESPER_TA_2_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.2178;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.40122540972694747952;-4.4069439963351104694;0.43713833748461766726;-3.5536610359480209631;-2.3698911304959198176;4.2178886336351064656;0.45407792405907276834;-1.6032115170393828052;1.9806059616951603441;-1.4959478905971157481;-5.3316088288471732426;4.0429322854689218047;0.58198371695398920522;2.4881471953122837881;-4.2305137958909204698;-0.073095761295140282421;0.59520945001001646091;-0.60965639813633831778;-3.182205385305710621;2.8256156281034092714;3.178122688139910057;0.30129675533761685058;-1.1882356375862199727;2.3574547406292447604;-8.6834910253297170613;-1.0793768616799290783;-2.7074439594731143366;0.18857640683931059522;-5.2446231361871156196;-0.90555248518534137148];
IW1_1 = [0.71755997912515367965 -0.53542183827595402068 -0.94575269873695300138 1.0886389898640991269 3.4071667993989711576 0.37331044452213363316 -0.43350394250692891873 0.97892028440087341945;2.2605787155701699831 3.02381752708441498 -1.0639143807293869326 -1.2845650216272728183 -1.6258711388258506592 2.6630447015458749149 1.712061684009975604 -0.40986381790205705933;0.31956480255831537507 -0.53335276330735770234 0.69565755771325876733 0.4225986848110353522 0.63759786874194490647 -0.45463377909334012905 -0.40821061431433192102 0.54418897823467449193;-0.092197821617077346801 -0.23869491514903104501 -0.2573699082305450081 -0.14589857439567954778 3.3359775619730989149 -0.82399090355268711505 -0.073865471207002070253 -0.21761881199255117547;0.35541763175340668202 -1.1403108632846641335 -1.0785288867264797297 0.23942501020969886305 3.2008001144011242189 0.67230627497397477121 -0.19107321017283343534 0.063378593988814860283;-2.7023838563851265704 0.77105664183883193541 -0.81046275175312987304 1.6253724830441800275 3.2151866907616173386 -0.32474492185476677708 -0.56346884859023982361 1.1172163519894855455;-0.13074107459457692815 -0.27318263162934819377 0.14980638179348551575 -0.024251476838009308756 -0.22794705499078182775 1.0033468661349034257 0.012952544861082115196 0.50762990151748077494;0.93938782655104302588 0.31217673711960935989 0.15909011797002242661 -2.2251552369946789867 -5.862350780363557945 -0.6335295701997994966 0.40236484204161304667 -1.6718872375531137475;-1.1644133310133142345 -0.46362563792961386522 1.1173188684649222324 0.3457303185729062589 -1.9394133233336046107 -0.23237142082134348842 0.83921520011182970666 0.45879767156100237369;0.063352540561934428398 -0.44223863689205256122 0.34326099460528586294 -0.068855731001039061079 1.87651273918958994 -0.17093356887368896246 -0.045456170729497293037 0.67685817164793971035;7.1975502191821227882 0.026147120311144585181 -0.98534171798047154311 0.45369407451051230185 -1.8681624074325404727 2.0938892518340281867 -1.9063697776715218257 0.89414789016613904771;0.23129144542395652095 0.054638996613511868483 0.77144176551401089093 1.0524650841269018731 -3.5882919982650549606 0.71370828137793818069 0.65938791954880671131 1.920635940019307597;0.80043076166388338333 0.89061195748957877605 0.23364151546834646678 -0.34781735278846803716 -2.9778291357985411381 -0.57395446645442171896 0.38999789028491160803 -0.6876889740117645422;0.020062269186950854732 0.66356332793715866458 0.18064625780082763096 -0.50361726060622580281 -3.7829228373484520276 0.74940640569462457776 1.0252542518438514385 -0.088000813255171103644;0.26081081871933786687 -0.57049941158301542554 0.75293939512110164003 -0.38390060871891695804 4.8023686090150752293 1.0990598551112071846 2.1707757745496536472 -3.9879749538204900539;0.25886019708014118557 0.63961511642730484173 -0.47926428072617832665 -0.51132014745243048459 -0.96114489917584633449 -0.43252263829371423443 0.34463651237132597593 -0.79104856667037637408;-0.21634303722089937017 0.65990168110074076679 -0.40431342689866134332 -0.55547660705074097809 -2.0737403128577840405 0.30363937240147531593 0.65664573959230787548 -0.64536437278544289686;4.9635670735531371989 -3.9439819229896571073 -2.8790803198649328465 1.0353752867395531467 2.7462434997485178911 0.98429560620150047257 -0.57904629185556411031 4.342593172083312858;-0.6265199695556595838 -0.83465773317890812333 0.053547704895017894655 -0.12207430415791895029 0.098433258027237596766 -0.76439097281413581619 1.2251511974124396076 -2.0463618301685384537;-0.20403201494110162484 -0.20777125765248918854 0.028269441868293426062 0.051115322625626763431 -4.1981082497976496271 -0.028997434842586995718 0.013275808995992739725 -0.11739393141889037375;-0.13583630955271722152 -1.8471697656298744494 -2.1370790925011502459 2.8924499995341790282 -0.14902628852625418587 3.4115377924275001043 -1.6087070313913758302 -0.18215920099379701025;-0.6910720353517224579 0.33015197629186215922 0.15965632030005699749 0.81079944492353606122 3.168585889593603433 -0.48292207844663082028 -0.61587937476014054106 0.55621707255457819574;-0.77420646991716979279 -0.54308014205143384512 -1.1625348399903436825 -0.15549381104422999034 5.1600129322388790243 1.1861142102145123545 -1.7314157859849572674 0.95554259790166251598;-0.47864142647040403 0.78513758271374989306 -0.87688035311908429925 -0.81673936842287264692 -5.5806081841056593973 1.194689161422189505 -0.12963156655424182273 -1.58781812473001116;-6.7760597651279415032 16.249194696358564727 7.5767112428660361445 7.8502000365705590923 -3.5816438821766070078 10.416775267129686711 8.984729077976494338 6.5716548858458372351;0.4398750093226395097 0.21266321672090995887 0.9606628060622072196 -0.96486683963293795596 3.6920894273007243136 -1.5764744591719885847 0.5040797573135686882 0.2805776138290504429;0.087430066299196723678 0.19361549589302753938 -0.068408926699979236141 0.030062366238198676149 3.8569481450712626014 0.27984913738550315498 -0.057866214841511845468 0.13705548983156407017;-0.16012941526361809674 -0.64011326756422826101 0.15151201036455541615 -0.36223809646391008643 -1.0810706871131305906 -0.49519459680917921052 -0.38232860603485457895 0.098415403147678257034;-0.10679836263376574212 1.3490873281163899833 -1.5710010359518238321 -4.2454707649394158864 -2.4097796233688253409 0.81709049631429719884 -0.65566926467033270765 -1.8906637294858332776;-3.0515951252384767578 10.582455404081748895 -2.5312276124073811445 -16.173682881838885805 -3.593621043436626028 -3.0338964056295840699 0.46276019558933295661 0.66840635899320921531];

% Layer 2
b2 = [-3.2544248315090009704;0.66830939265162958574;-1.3666512993996451364;3.0945155571242120018;-3.4980977852962333863;-1.6310049510210267165;-6.6658455163881153993;1.3994738135906441556;2.8858913143594215889;1.1179925936682346688];
LW2_1 = [-3.7603839213957059862 -1.6958537878032615698 -3.443381263939999215 -3.9634419300454046819 -3.1600334933310492147 -0.015915954646605778855 -7.067283767669237271 -12.113210215926224933 1.5463986359125359016 7.2112206441861417261 11.897474427181659706 1.9854995915368021109 9.2797299729511308897 -2.5905111927171859953 4.7304175323700246025 -1.3540649204447976484 4.3506001280190478298 6.9393737465946552234 2.7428617454125596709 9.7286869907892796761 0.25449473818927531577 -0.095479433363264809564 8.2088591574124905037 1.0654611965251361561 -3.6295003627533684032 -2.3942128840710741322 -5.1369905228842567269 -0.62261898836565221504 -6.6362710424530373388 -12.019357245133219791;5.3519383755575278272 -0.91973124116202187306 7.0481680783220728159 6.1682257774889981405 0.8057797072349470735 3.0884765837155345736 6.2520909390294399088 -1.1795074301967329866 3.0377740790467426812 1.139754397486451909 10.358825636074570298 1.7767091817830011902 1.7604109812283292857 4.4433900782451924982 -7.4661526419495780615 9.098838428263670508 -3.0330193459752812224 1.0221990172707524636 -1.2392564521619122697 -5.7658848461348766179 3.9220400358365465898 6.5053720940961312635 -0.73243933810608330415 -2.3743308720837417169 -5.7054604577928360598 -6.7903378809076091471 -1.7068953167516656144 2.3398699301836538567 -0.47779486625810840827 2.2846895209421029804;8.9401753061741171535 -0.0088738342388909128428 9.6789073904539559834 3.8961198736156772426 -1.7365125881156271426 2.3145948512651997042 4.650186465585753659 7.9723596492362380772 0.94115904986730924975 -2.7575227230068311002 0.16601519573533599083 0.49878507322125714696 -2.9394509161902573346 -1.5653405749110538281 0.024473378345964705294 1.396143531882463984 8.1096385068599587953 0.12685968116299289887 -0.68353657492770492077 -8.8053045512322132282 -0.30455594212984776759 3.0330433641584244597 0.59968815514156514901 1.3692720616340186002 4.966108635947088068 -3.3710048001572614496 -6.9891732993248796291 -1.6115900442321342556 -0.3247828715024309032 -0.0059505431531943391368;-0.14122480264970302399 -0.22126995684034433953 -0.66238021067208752157 -0.55704136690294958623 -0.79882868582941513047 -2.9633185414449720874 0.87244608194073958174 0.43170545066638815745 0.50909720627210475197 1.8079375564979474067 0.17145906968664764713 -1.1004973573656009478 -1.160064436251307507 -1.5522568733734620761 -0.68794865498170176821 1.7137215143695427866 0.72917482151451651351 0.36870515008240040133 0.016800440276460354427 2.0395650162515033266 0.44793515453685345262 -0.050892970008636191637 -0.80785475745385404434 -0.39881652991269894715 -4.7411980954405388289 -1.3720081695812438305 5.1222588063930531987 -1.7868670595706879212 -1.4418737704290276458 0.064608895145298411711;0.33376825287272693377 1.4925390929134914053 0.25735769616383169511 -3.0279300664041173263 0.63775066834817173422 0.90252804813732956379 2.4979333150043481204 0.27620057931150110431 0.14294107112707457596 3.5568288284551599077 0.063184430618065889895 0.38728024150761958255 2.525931886917985647 0.90942184678076254389 -0.29422314189867709855 3.5545721698582388726 -3.0329660741847943584 0.26145633749198804452 2.5240757096380272984 0.71983790821179927111 -0.0099276720101007243091 2.6963983760272345336 1.278093668694773033 0.86358615933248183971 -0.045106886969443184265 -1.3998188095647070561 -0.58774537800981163649 3.4465068472191355831 0.85772146540682348004 -0.27366176433807670731;-3.4782927894948354464 -0.12342035192037298375 -5.3349904139800061742 0.21578989470329773548 2.6585253875764367493 4.520388458495984807 3.4411769289128031346 -1.4628869724698359001 -2.9584551495771846952 4.5642239303940392858 -3.5382276358147293216 2.5312752936294362627 3.4542413601151760183 -0.85386096803727407067 0.00052222666442094944905 -2.503636177285362141 -4.1780386746316313662 -1.3695724957499386676 3.0589278246265032557 -0.18017248436210159257 -2.126724781471190262 0.69161475865539678853 3.061003701714756442 -0.95348896818241346551 -6.7013024269595362625 1.5158517621565437139 1.6553243710522804744 -3.0546314198535200468 4.0221497739945162309 -0.24492652689215788087;-1.2801314262886693829 -1.1724116652170948338 -1.3291755473669333298 -3.5673694398567161734 0.74256517719587999959 7.2723399167598135051 -0.66000126444250539759 8.4086907278545552913 1.3043112686433544489 5.0858847269900246957 2.111519721269408123 -0.42257360061780779859 0.84627917670185193177 -4.787470115798652337 3.4227943305447632305 6.4042218798204677555 0.52618778406615795973 1.8277416410121893886 -3.4279656013989137087 2.195100953326499571 1.2367635601650532884 -1.2488277688178299751 1.1054184954282795239 -0.59076923317628382559 4.9544462182614470436 -1.2972312681244342336 -0.59596183524733192804 3.0137315026097524218 -0.39968214031834070621 3.0619034862282896725;1.0952395919416799686 0.99516642511702824159 3.6117132896809414078 0.39109277971620304282 1.884629481218725422 -0.81051534286815118957 4.5272725372092459395 1.7263151058836270213 1.3650867277328551097 -6.9992950356069520979 0.12840217432442233014 0.49242271166399254057 1.8091905347928161074 -0.35707685873217592798 0.59511739478188707686 2.6636471331499267379 -1.4661366248767018217 0.20818888327717091635 0.80387244658682543985 -2.4230039204045414891 -0.3535350767474532141 0.19819929125506385859 0.54099588409233734243 -0.56416231171815445222 3.984459914092827848 -1.9483622398265332265 0.40329732208859458975 1.7931951738584155365 -0.67778170844807572593 -0.018105878294056337169;-3.3182114106893485506 6.5334918073900123403 0.48713845136823918924 -1.3244782261875509555 2.7709784905572445446 -1.7400995235456575561 -12.089781374339189313 1.1914772058220191031 1.5874822124758118935 0.86688429710615677593 -0.8427950019465404452 1.3222103195642527229 -3.6788665680022600846 -4.1615579165312102106 0.75698118349715903808 -0.16698551105644338088 -3.1486395308066192911 1.555092432105526834 -2.9350228379584741845 4.4547755267907884758 -3.4734659547027733062 -2.0009007246655254875 -2.6182762359189006851 16.858499187821646359 -5.5927574309269667552 3.2500272247731087916 2.2913939293041094558 -5.7210476601722159984 0.27998959714638149698 3.747366091772686314;-2.359982224575304155 4.8522590438737038809 -2.3919334340202560441 1.0131862115415757319 -7.0086087185283716394 0.77195413918469646397 2.857331575597938933 -2.6041005090725453108 4.5173649250323952842 -2.1239116004419895667 0.64587608531445761528 1.9740285709523157642 2.7447496112326934536 2.2876940565216723478 -1.0488490445649230054 5.0565627425962720309 0.98448218364335438046 0.18410625272936737007 -1.0648418859411774573 1.8227496814981214435 4.1501541388837033253 -3.1382060935994631201 -1.4528215954861840586 0.99414525638256101558 2.7494308678711334437 2.9768527097217014621 0.84526187857935075609 1.6428825164853619878 2.3645631130529483066 10.315849315859578539];

% Layer 3
b3 = -0.48350971139807058519;
LW3_2 = [-0.00089530559414679946207 0.0015324232879949299755 0.44662923559334571921 0.10998037238964174234 -0.80653430509388546188 0.0077803109769900534454 -0.005201239933359780819 -0.42970953679755868881 -0.0034283493272640355558 -0.0041348333127444042434];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
