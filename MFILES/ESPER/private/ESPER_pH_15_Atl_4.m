function [Y,Xf,Af] = ESPER_pH_15_Atl_4(X,~,~)
%ESPER_PH_15_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:25.
% 
% [Y] = ESPER_pH_15_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-101.945317545701];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0054210015363163];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.5290017584128734462;2.6269232863279303736;-1.8756029222896410946;-3.0804324400934670614;-1.0881165208879008954;2.301268732804220285;-0.62744059897097859135;-1.2830449029104604719;-1.1038289464439499099;1.237851338237684784;-1.4625998954688306242;0.41362249182028415495;-1.3693746349808784135;0.60015438338420423747;0.69564782237488287375;-0.093053892989387737567;-0.0010383123561283277847;0.6527579160368568445;-0.64386108978146161519;0.80973634230194868611;1.3168019265494836922;1.0769984128990284233;2.6777446883646547349;1.2999827209772036873;1.5600314193405901975;2.5824768938711750721;-1.395870156310867749;-2.1135583537837989709;-1.8838457823314929129;2.4897345343784520466];
IW1_1 = [0.81448379880878207793 1.1693136498184286687 -0.88225382137407593053 -0.72038219672465952925 1.4483276275889949147 -0.6213534817503811869;-2.239268001160372723 -0.12326333127207618479 -2.2116167775310660026 0.79041665095943014485 1.346225537810813222 0.87103771333037327551;1.1340377421456540041 1.3258750205648033305 0.0064320697861605762025 0.48065927655417600706 0.38974961398015067759 1.1574219030383299245;-0.26809985611297576513 -0.062624652118069612516 -0.044393172639817887748 -1.5249999879141329373 1.1689013369810197229 -3.0588966294135282453;0.6859366043508852151 -0.91004344014545579533 -1.071989616093061537 1.1382311892725267555 -0.4391892426492772783 -0.53107644383486929396;-1.5528124769947724282 -0.29616606148549073918 0.46753274055876120618 1.2128741182368820706 -1.7555963666453016092 -0.30891885225467968779;1.142625649851285452 -0.17004077740295692189 -1.6411235950765243885 0.16876744269061755288 0.86725146470010838762 0.3989267967756200961;0.91608636346739658052 -0.34655594696108937836 1.9543867418665314961 -1.3945397425791348223 -0.088740229590326014097 -1.2785162240013225876;-0.38381610192830667438 2.0432980129114532986 -2.3037777049158005838 -0.21945661785557285528 1.2528368531640690087 -0.57942159168304308015;-0.52152053469520553985 -1.3629610026401748346 -0.18339263885477410931 1.6556033446115492325 -1.4060114348835086595 -0.22933653468609704884;0.48711374549309904847 -0.20618721559453509484 0.31834682604701541875 0.87945201982312470879 4.492892444087264181 0.11611996805621557782;-2.1560002233045989506 2.0708054154206121389 0.10253139197697901108 1.4504459343124818105 0.4761420580220648846 -0.45638559435306985668;0.34371206264158443711 0.81187232154824484631 0.82818021434295385763 0.68729021035081550028 2.3955350384516052031 -1.4921625695984004345;0.48698322512863628786 0.29729830628504239076 1.5211640838024773625 2.0519760208382504807 1.2580509535199355664 1.451344728647177007;1.7020103062554574613 0.071634551609944849271 -0.9276009044279985849 0.083922432944409097733 4.4140719146481703916 0.4451351317388688722;-1.2884717840223729457 1.2433114976812338348 -0.92105580055253499783 0.76421090779190503639 1.0760929243417209911 0.62720938886589527872;0.17449432090229341497 1.4898897581079719732 1.0715663533952928255 1.2856584256988106141 0.81099928356116202099 0.47196387650111853995;1.2202278602548148889 -0.79608653379743976597 -3.8241524320147797233 -0.89090049823991102063 -0.47170791047538312979 -0.61208096527584254787;-1.0520390028242585512 -1.1760798774879746009 0.12555927892479898378 1.5179738741699149163 -0.8955353168059431157 0.13349536834236538918;1.6139170100481656789 -0.17181587256911889927 0.36124950207271078195 -1.0856667345945778536 0.72526362147487766219 -1.6369155595316273732;1.1337659960676196302 -0.15781642136682630384 -3.9561933526685404416 0.24070881206312438882 2.0736494482097427294 0.013720897582090751596;0.5514024087682719566 0.67312889341816883881 0.3345700775338803501 0.88398181575848500113 -0.74393619615905348663 -1.1091588998156038937;0.49867245778759239361 0.55875085603089846842 0.399725740633137816 2.4576233698614564638 1.4230929199974178267 0.24874100240013413687;0.56829992970486942205 -1.20192635343677523 1.1134339747081969385 0.18267064172070013317 -0.24100349845566546025 2.5356870848556005704;-0.011295276068069667885 -0.89751170147724568249 0.93239487046417535154 1.2696908712367049876 0.62978001061522836945 1.3996375046217979232;1.017649004457198858 -0.90001860691985313689 -0.54066171316019839832 0.16585848790754087467 -0.64084995391664867359 -0.46892061543230717513;0.11980996122999276743 -1.5501625964905949573 -0.1051786784130642749 -0.77603410535798345027 -1.226951096801027985 0.73326772179566490628;-0.69505024080113408935 -1.2597518981944715311 -0.85598882340464121921 0.62198007856880632716 -0.29520993025264197218 -1.6661877167191050386;-0.16193879219222601096 -0.52391532741314095212 2.5085803499717074239 1.1032550310131021831 -0.36965395332531347794 -1.5729297954465226717;0.7856832454658391196 -0.026564811351411976581 0.90191387642148046488 0.27030967473746653207 2.0977424142006628749 -0.63270821962809919992];

% Layer 2
b2 = [-1.5429482361168884719;1.3547041373065966674;-0.93103746563140499237;-0.36658795490925899507;0.097049196023854755744;-0.15063463145907143859;0.70508892713620863191;-0.99822944748581332597;1.0384712894677106121;-1.2532035512516030984];
LW2_1 = [0.75453485014442045475 -0.30712427178837203856 -0.17004071470966414248 -0.037704878098802248332 0.14458397559639046825 0.26294043713014508823 -0.43412154266076902198 0.72265103275210518241 0.26677295387128158177 0.47076069791657076946 0.015799863889865047029 -0.16232244467873571669 -0.3050734868708945835 0.42152385173830952958 -0.64246003157238207315 0.42168230245736654238 0.14332832485200389105 -0.67193457986553850603 -0.02720794665363924017 -0.28746152367818450513 -0.66581280366690964723 -0.28267638680241430338 1.024510123711097842 -0.087890690436968510468 0.25032894293566548827 0.2947617290985736771 0.081546044574155332474 0.14018415368821285361 0.10502402722363972376 0.20045608980072693317;-0.61216241893593315027 -0.5399131845927540585 -0.34507358144313526882 -0.27143228541641745144 -0.20729486046101538999 0.63357154207832944159 -0.34869034939617915558 -0.061433036821490399904 0.075816847296195422068 -0.53469969075068735087 0.042317288813734366126 0.16573119112336059944 -0.5102838824537894169 0.070218196776686420124 -0.67599628519037291419 0.22407348943944815911 0.37791150616216473423 0.031656957531543891693 0.12362446188345500853 -0.25125304516398655474 -1.1811440568203706025 0.71005276736450839703 0.5264794622423893955 0.15080072366135055528 0.43469844043255617683 -0.11655597757522323521 0.044074303066288914033 -0.060503496683503507625 0.026323437803861843287 -0.11666174233509118974;-0.44800380363035147147 -0.68356000325280685814 0.097893297657113159671 0.35800157910746549517 0.068605989854194887601 0.20553311255991962847 0.63121923908069588194 -0.40383124186303315239 0.10511916993880190963 -0.25120383581956640118 0.21074826264776022611 0.15485934109762866662 -1.0959199418974023832 0.17032862931653711125 1.1653240716126358478 0.1803456638689779068 0.086127940598229812963 -0.71530282330880401442 -0.30732199780319358062 -0.27441804786865842125 -0.60429721718341300463 0.54911179854933067634 -1.374328872592304851 0.16666514845934335409 0.78929595778549366258 -0.31512387389605633903 0.27057785829264641153 -0.21864952161408179876 0.38874514274141996895 0.34475394017809607439;0.2676789242844039296 -0.04685724434305266195 -0.39477467072433153339 -0.53107420380011316485 -0.23575771264866415833 -0.18236878209346982227 0.10736746734339308595 -0.02152377967056537042 -0.44051096677160295201 0.55469436270212546525 -1.5331381118316482759 0.051381211655164370222 0.42411452687692191565 -0.28896563741196190644 0.3012390610198033003 0.40166468701069657499 -0.52364382032007628087 0.10647541155288658965 -0.10769101138766876136 -0.076057739324318973662 0.55849009136616745153 -0.04098143969548413007 0.32148736838141522831 0.11250677841132233903 0.21908185522515988275 0.91901189274751915459 1.0884463417298342325 -0.2351563446708193339 0.39948254744561484397 0.20474383684761349178;-0.40970420992358891343 0.23193176953907890248 -0.23117064870463460702 0.47506373857943517969 -0.2254061048750148899 -0.21941382604729797734 -0.0047303406430925440396 -0.070145773311143369555 0.50840455540276585644 -0.024549748880366449588 -0.46565606473449316915 0.14872998001325804518 0.38316677077415478569 0.091502788191459891176 -0.2204975868414776885 -0.39829051191573838775 0.1784591904501757198 0.30879406744605258917 0.29692443876778851219 0.21226588693248205075 0.17621012212637854333 -0.15171223065552025266 0.12379350922206504293 0.29079798603638873367 0.04364237490145990439 0.43949582677000886832 0.15238670294612455258 -0.018613495131651613956 -0.42173248117133421697 -0.075931238395458469648;0.6714798970296275149 0.80820653433203626381 0.4146063145058910826 -0.33066111419164795349 0.52950977115598829581 -0.57099198065745071506 -0.17948474226686911281 -0.045631468350195658612 -0.57951441907178824486 -0.2160093992385210826 -0.77806258294654551122 -0.31812934495053329931 0.72024419710433373876 -0.14049343144691181506 0.70662091000003923735 0.2003132690910829905 -0.14262499706255118981 -0.71500563408911443908 -0.27101390135097586098 -0.26714967389868105041 1.1812399237448019118 -0.50819418613399669482 0.89689989478895104646 -0.63609346531188193374 0.55452157878716867856 -0.10892992534063752896 -0.23984854760631202364 0.063036714455429826431 0.27309946533468193453 -0.44101724814918724649;0.010720688771839164549 0.52200560128368089785 0.16593096455516612164 0.52070219897539338216 -0.06762523626789590514 -0.067902312776070186673 1.4283931811347245766 -0.8485162179826593043 0.55685775679712001818 -0.020841247058506297274 -0.25818199083692916496 -0.67738960867059239135 -1.2380167087104700929 2.1215715102330063857 -0.48784513595254092033 0.057096334207515142545 0.23486191024291369622 -0.21342596785423675887 -0.32629909014199826034 0.46968552208885550048 0.4043421443728815734 -1.1325820832738313637 0.93959525940186605641 0.46056884503350736804 -0.019705295427958388621 -0.08036385979496024623 -0.22476825382450563162 0.6308278078826544677 0.3932849269661729541 0.48792798942689508124;-0.46917417599940114403 -1.1336211542307843558 -0.32229579104265221323 -0.1272595187231047309 -0.13384679521841880145 0.34879362163926741491 -0.53564082962534043109 -1.1818696224950362428 -0.14826710256911501684 0.33702314713612319119 -1.0384619149528662163 -0.65344760261143253199 0.18326956014131082218 -0.59682854423122277954 -0.0087969248683655229537 0.11096345120086877067 -0.45691068125194717053 -0.26225596682799351411 0.0028989957950233602099 0.027764456943462714061 -1.2663415655392924464 -0.34883322944661976361 0.62771782410205867464 0.72172348290433741003 0.0081636849630973978842 -0.63543066875900588997 0.45266622401187633917 0.64739381445594679221 0.317793237024677655 -0.14829132091917252012;-0.51169362535510620749 0.32589604438254005103 -0.42324590100413761462 -0.48610758556363997673 0.26614197769881120514 -0.83661699560178603985 -0.62948856312857992545 -0.24958443695033599719 0.036056302400197380587 0.33886747313702231255 -1.6697910550180914413 0.023281914320125024487 0.85139804913772965111 -0.060309139520387633482 0.69411800799420508845 0.2098074974223409217 -0.4495679405841591092 -0.46169313333064027072 -0.32445666423353741736 -0.20815681439531369401 -0.80373303018495423355 0.050224254618155682317 1.3711460238067056938 0.023006519703745131195 -0.20787164790710005446 -0.17482149081735806617 -0.019358074048098024983 -0.018981711100977724516 -0.042194265915877771089 0.33750102823615879544;-1.099327678522071805 -0.17910270553110263503 0.18344373034422467583 0.13267339663375277148 0.50548536959218792752 -0.75318873424693078 -0.69738224631911771567 -0.27502661687885016084 -0.38523759506627813787 -0.71229347395888187311 0.69239412380658404977 -0.239223740095173526 0.56269560483076652702 -0.19208957481556457325 1.06840411318227968 -0.52165271569471116653 0.073001771418031380367 -0.8570407377499006385 -0.21204639089210763903 -0.52331348292893942187 -0.96443841016973486102 -0.52760103052150597591 -0.33652694487146217472 0.70838095550080348861 -0.14185961578761374646 0.32793509371670526154 -0.79128810331984478221 -0.23265352700001257213 0.54494124733247495396 0.66176593118558979523];

% Layer 3
b3 = -1.4155618390654345351;
LW3_2 = [-1.3258118724488257012 -0.77611672577582369037 -1.816193142180716702 -0.79882542317187466008 -1.5379103771897852937 -1.2951487699227006711 0.22454978305306230735 0.84809346959803111332 1.4278123403290696736 0.44435776852919839364];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
