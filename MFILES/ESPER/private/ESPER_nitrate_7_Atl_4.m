function [Y,Xf,Af] = ESPER_nitrate_7_Atl_4(X,~,~)
%ESPER_NITRATE_7_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:34.
% 
% [Y] = ESPER_nitrate_7_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.1891855831558513223;-3.1589933331008381856;-1.0699678287972960167;5.931972591088905844;-2.8719507892172839725;-3.680280994088777291;8.504515480587924614;-5.3104669199403824464;-1.2002978315602228498;1.7081712217163909084;-2.2371565732864437948;-1.2972932415808482443;10.874761348860893406;-2.9717000276852152396;1.6221693525580054285;3.2185845192933917325;-6.1642446485009125823;-1.2029417459338496155;2.7966116609788356229;2.3799930096315424777;-3.621712182388564738;1.0978377431237815731;0.804334502897171566;-6.5900189452179764871;-14.875279525721317953;-2.2580898496027219657;-7.5209617843925542502;5.3889788675115042338;-10.999222640165035259;-2.266324060549686159];
IW1_1 = [0.0025854520871501072456 -1.0045405770226503162 -0.59478781538727432121 0.32363686564376481503 0.9412837849920606681 -0.38661687437364750108 -1.5156251219480292303;-1.5077795157793034697 -0.012057367135147229603 5.9935779890825759963 -0.038228618885628666557 4.2116552408753085146 -0.52591470898196113204 -1.5628349375314973813;-0.024802381122906988486 0.39415601057540833319 -0.1689572597689786293 -2.2274324501470230686 -7.4334580792747404487 -4.5276189947444231976 1.5402413101638927628;-0.97084774889033031986 0.90574235512045198071 -2.937078603161408008 4.3881628958725578116 4.1130669167589539725 -1.919288862849799937 9.7487533221787749937;0.41885624033952473244 0.19135342947982056372 -0.53012711298556247641 0.18907634650749197136 1.1382773078096368735 -0.9636126897374375222 0.94289290087404797891;-0.42112715859932492446 -0.28799532993953191884 1.628419922704066769 -0.95391151799309337189 1.4001340601737133351 -0.91657105279662254294 -1.0650120835677612252;0.26390945120711339911 0.33237202974975621483 0.9963608024559045262 -0.93851463931136780428 -3.2192397506678593899 8.4434564418013273723 1.9986760057412031877;0.24689978081016505929 0.1138539351802010241 -1.1514511973467831396 0.4813555375158756755 9.3428936463416789593 -0.24171704651980371881 -0.22146881164958118204;-1.1644635786192094606 4.2630283270805620077 2.9746670630696185889 -1.0829204053852334866 2.1575444245437460644 -1.09741079443128009 -2.0538524218169169622;-0.26459791285991590692 -0.2329902525120856327 0.33032884618825286704 0.0031857309692844733295 -3.6771115624358845508 -0.30733566118344579632 0.67430233209473999789;0.27020855667100829312 0.80434676707456698175 1.26515508978629998 0.28823230590598514222 1.9912707976173968927 -2.0784487101379380825 -1.8527267849794710752;-1.0240939620414941658 -1.2608695947118533365 -0.80582415697514475639 0.23677167293438333706 -0.076223278160374233203 -1.69147620429812795 -0.56993169836283585905;-0.19104603977507086943 -0.25087334106194669747 0.31549778543422674071 -0.26485268586616983466 -15.081197881958077645 0.04598348753148609469 -0.67079971822538098092;0.51144447487340194414 -0.12603017647272532487 -0.77592800949618701001 0.62262065039743008654 4.5875852575284197243 1.2735629279998887942 2.3299728607429561755;-0.69712261841073996926 0.0082246569205567388039 0.86054130297198472288 2.1158606987835959501 -1.8496720735688134685 0.63021141467643959633 -3.0856151350189611193;0.52918301168207826368 -4.0833296883107772501 -1.1392377546148813039 -0.047622403388927828094 -3.8298908903173898288 -0.76247510776264060262 3.3514440199506836393;0.32411248298793310374 0.23305390511400689291 -0.89356457727424676296 -2.0347223284281299449 7.2315697840558366138 -1.967854375599207728 3.9142715537669481307;-0.66499897924249773418 1.268558448668092975 -0.77534229948759980644 1.098415957605254345 1.8264980455997916753 2.5326755433592209599 -3.9408922989030918949;0.1258006126505621658 0.69551107094283348697 0.42769665137438872549 -0.68282325814844235801 -4.494082524513182797 0.59846093374032405254 1.911631491084051726;2.0580738070140487395 -0.33106200207476810249 0.41087420584619632757 -3.0980005205035436866 -5.5116621602955051529 2.407255857026458834 -3.9525316973839035306;-1.973770103954308297 -1.3993149947186653836 6.7664630507439058604 0.44594332914040535343 3.6448422921630880822 0.060358371227842419482 0.03115259563640906601;0.39065905340978623883 0.42106148787085373453 1.4747850358510730118 -1.311679269784980173 -2.0764024822670092973 1.8738042704694148899 0.20047734307311193547;0.78619169174386061005 -3.7830360238980960119 -0.3707761438605619575 1.9074712523699082212 -7.5482895513665360099 5.2901288650221856003 1.9203247312287419213;-0.26999704141938202229 1.2225235135045149359 3.6051158495088113654 -2.6787691942616085328 5.1837620747767783058 2.8760241311222096705 -1.5027589356896222661;-0.85376461281827076277 8.0088260479481903076 -1.0563129454694486498 -2.9235967605659620716 11.101516678264111704 -6.6749053726171556633 -5.3061023782935556881;-0.12181702979298053569 0.64778191585599009805 1.0841059174531368914 0.2144790075289106368 2.1958263294792699227 -1.6430284796083505228 -0.50115792935902381267;0.78058911573750644486 0.20960932858331732254 2.0397850595418489661 -0.062916785723752727266 11.863437754964778037 0.77004932729331776464 -0.56817138462579652725;0.33140720894889241777 0.22625497059645616194 0.22297604449513619418 0.24906199458751246412 -1.9397806172939933145 3.7179606494739871891 0.44054164461123779262;2.4855222645349619448 -1.0313731661578546817 4.635285883911807403 0.98597837373992636145 16.539825609813981089 1.7359955828236359743 -2.5401272963692611562;-0.098368275547692382577 0.00137586693801280773 -0.41413783925304675781 2.5730187154124877225 8.1722145094288674017 -1.474599462869878419 0.16571618706211080352];

% Layer 2
b2 = [1.8641215154734793735;-2.926761101777055174;-1.7336944940026655093;11.970630312583727672;-4.3393815942625657556;2.0169071003049197088;1.3352959697347359658;-0.46271031602735612775;-2.05753657797872469;7.0630454008035350455];
LW2_1 = [6.834002758669854849 4.3947139937411705546 -1.0592704208265895094 -0.52304526236707560294 -0.80953361656908628952 -2.7345261387016521759 -0.54475146808331664783 -5.4573667349786809666 2.1128442927874684365 -1.3789436798882062085 -8.1642554652338876764 0.81937309110244838095 0.95834986784374709412 2.9375942895619555628 -1.2671270194433341683 0.068621317677340545882 0.39177199483397967539 2.2222466806325806843 3.4162967075802854744 0.95479872972787660501 -3.5874177512281679725 -2.6764913061377599846 -2.5381651253643875421 1.7097730117679823536 0.51847695318160458289 10.547754664350986076 3.4376654917631692676 3.4901487669723891827 -0.69975347513823937806 -3.9138788643714019777;-2.8692582534279584827 -1.1247182917453064643 -0.11911422983795254271 1.6008079444142142567 2.5645614820477042883 -1.8847586726729315121 1.4772084765201825007 0.057107479625154201897 -0.68141166662291274836 -2.3836816335574346759 2.2216322398596646259 1.0678794320012341412 3.835580999602742569 2.7149935888860103894 -0.44869094227694700239 0.8513231280522038924 -0.89720579579177084373 -1.3376747085845188678 -2.9853352712222447352 -0.17186415052581788254 0.80932598997721016953 2.0373989517603137145 -0.20560464172227377322 1.3158186992636773383 0.18070345865823966847 0.2517946836960383572 -0.9995429278060042888 -6.0414602410456961223 0.211130115048979633 2.6981457858382720261;1.3603164206565874217 -8.0078195735448538528 -3.0146982905371220163 -3.4089896283346248218 2.7850097076839661625 2.3266716753288503305 -3.5300879448165796148 -0.65338013451088905459 8.3053742194275965716 -1.845054128870445842 0.085428207191981936353 -0.21671796792859587821 2.1121046375544190177 5.2920405985379348479 0.87061869719670337275 2.687679667513747539 -1.9612066387512290255 -6.5327239166153585614 -4.1578540795792973128 2.5898047397141166215 3.9103793954571748337 -1.1765278049966223506 -9.2057901331776914589 -2.0263566183318379998 0.92814009139173569984 0.74075384256116827419 -2.1593711734057321472 -0.42183433576763618156 -1.3372577728232486471 4.7299709640178306813;0.57221882917931199408 -12.978458218364819388 0.073280799104565919055 0.10182177859021154798 -13.497236960640780268 0.20800719653788102281 0.87976325626319418216 -1.1891466122251566073 0.81844812732359983887 -1.7338946907710282019 -1.8352517066269302681 0.76025321371870935305 -6.6337919417342670059 -3.4717848817576877352 0.68501752265791138186 0.26794764147806754417 -0.1119235954170497982 11.522272512508754616 1.0567153346320914409 -0.26659880925566870058 1.0694145057848321034 -1.356067405089945499 -9.496240459370431708 -0.042236443748663005104 0.2333871559487530889 1.4994192696122552455 0.29062455529012165556 -0.75378685207417872594 -4.4291218081168386433 0.37407158803118317758;0.26721628160517818529 -0.76784909513041432749 0.77169909844754325245 -0.63760744625467669078 2.4202078238298807555 2.1004493815437945692 -0.90467208661336362407 4.3663580086606774699 -0.15979859177103514223 2.0043103290138271078 1.5782262248563352358 0.30639450860478700811 1.6959641614040812385 -0.47096767580324672142 2.9010311771022951888 -1.0373562957784572269 3.2796735444623821287 -1.7267249693302266778 0.19411054798792287679 0.055111690740015172041 0.62170917707238682048 2.4699340199976140831 2.5526027258029211353 -0.0091201256796516819159 -1.6689966530427151614 -2.7479602169891932384 0.00045911892193390216321 3.782302715704110696 -0.31420275235123018565 3.2305371723106626192;-1.1425137030701537633 -0.070052437714647142197 0.67826825833790804765 -0.7146038167911950012 -0.028409884723988473171 0.30967216451868834204 0.052081000306532281019 -0.010724350869696440414 -0.7723231999842181672 -1.6789652223993676294 1.5590708324784086081 0.55422688293537514248 0.98774112955883053289 0.99680469728753440251 0.18919992750748160226 0.42547143119032371228 0.029135741884888384512 1.6357312711357463453 -1.2618225358939965108 0.010155423947724544903 0.081810109458125251924 0.7534596088868109609 -1.1544679822694707827 0.55020675433798216236 -0.0059402801376685267915 -1.2054311431156792267 -0.097806138837015374476 0.063453798924925294833 -0.12472860057713144877 -1.2651664458741358477;2.9036217381589271014 2.4778886202786978288 -2.1219011755279511 0.37557082862833401915 2.3031038251065800715 -4.3982076060328978429 0.26565674732934069224 -3.0997557582860331138 1.2983520134979875671 -1.5556668164369238383 -3.0439879150635023031 0.4220809242446239562 -2.0371420000820590346 1.662563382497910025 -4.5845961414639839759 -0.8219626657833762895 -0.33660973926717152604 -2.7918856691180558016 5.7662150756592751577 -0.83646136038081397857 -0.54179433245484087678 -3.8508664152058558194 1.700902533000349548 3.3510066590796641073 -0.14188424671590024739 11.747367277653502526 2.6768098703392739779 0.75237736833569834882 0.85223160609469095217 -5.3265165618024923333;0.85150104703616369406 -0.66127541588412686036 -0.56627568563700914073 0.85810053860858415131 0.39489345250461421744 -1.4230933814815973637 0.46226314238034010851 -0.56679768680209685616 0.67034210853441666966 1.1682466563999187592 -1.2143400776934627494 -0.41399696003798036603 -1.3930465167939054538 -1.2336077275385379792 0.38649725431829595745 -0.27407513123442955871 0.45098011293299961055 -1.8326401859247776205 0.39911240564103883655 -0.14153440596680313956 0.41252733960328896723 0.017927331946095859116 1.4696860464794239132 -0.59900342551466934093 0.10877946085248194064 1.624655690986602341 -0.15826249817757537253 -2.1871324163601766344 0.18732520587401133016 1.0280185913595343283;2.7547939668517580358 1.2995240298783756749 -1.5406754151643111683 0.42806110986551948461 -5.2823913635029375868 0.63006205682525728839 -1.9379327548408511461 -1.6317249788986993853 1.3336977098795330665 -0.65958472171540505347 -3.3896989670422339458 -2.4644530412608678382 -0.54803539370631926264 -1.8506064583585248862 -1.6515311153726608406 -0.2066863441091939535 -1.5600558024434310056 0.050237047472915997981 2.0658309668683352278 -0.36437444471184993189 -0.66089677424072756917 -1.9406248678238733341 -0.59719539621292250242 0.96002144171299053088 -0.27801733505091863474 0.47595729898666649937 1.3088452828847683129 0.6931975602441483586 -0.34845273830442363705 -3.0727559627713425527;-3.1194951874778915624 -1.040836371481101974 -0.16088777705838794296 -0.032910331136900020099 -1.2369067019108592742 0.42156601603989241056 -1.9200071129051228258 -2.2120972480989888886 2.1343794475905197849 -4.1893100889911432105 -2.5661105549684180005 1.2827808804086946459 1.0658684064462100594 -1.1084773602131674508 -0.72974858543536547106 -2.1763045855811506968 -1.3828722897257732516 7.7781442484521496894 -1.8977310964590057285 0.51916714028618060617 0.33340838876933220902 -0.011245502937482186601 3.7432869060900992864 -0.37320053412797155046 -1.4696436706043478626 -1.7442357677388029558 -0.18492144074967267753 4.3234268271379283632 0.03951917918518023376 -0.83372068056367565347];

% Layer 3
b3 = 5.2405647569563535981;
LW3_2 = [-0.08772698482231118533 0.20815018156510647906 -0.0093780649591634103468 -5.153171578023882482 0.28573145070815414437 -0.91611063938047743171 -0.017377209459567066058 -0.61550470337584994862 -0.13708285284399521209 -0.079010436245176354775];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
