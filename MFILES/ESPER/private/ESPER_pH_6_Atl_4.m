function [Y,Xf,Af] = ESPER_pH_6_Atl_4(X,~,~)
%ESPER_PH_6_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:22.
% 
% [Y] = ESPER_pH_6_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.2178];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.5513486183896261217;2.4114162440846125257;-2.1813613421097466372;1.8252943898555378244;-1.5941841343487122007;-3.7505785657938770505;2.3398689770879919081;1.3081376065072396475;1.9137836295507868467;-0.34672831496247852323;-0.63029083366249349929;-0.48648736710627438207;1.305796153035635454;0.51050736061113810571;-0.46735029394415950055;-0.18050577106412385442;-0.05806792053529062636;0.13905569409343040976;2.2121100840038905311;2.1393759112204580042;-0.63466514936431095428;1.1240277484597942514;2.5637030102871185555;-0.34431615622526384746;2.2119784243743549901;1.3925068703101319834;2.104951488706508389;-2.8866612882310902499;2.5493862455661688848;-2.0442833687173789237];
IW1_1 = [-1.4457388955272141295 0.5841579071740584661 -1.6526716361582729498 1.564255406917520741 0.63643110765979671317 -1.4063650604821760215 0.71917678581193711373;-0.44495652614309383344 -0.85260797866198656525 0.46370270078277209258 2.3356395443046364946 0.21784176970987739752 0.43165911211997048946 1.2203893285831783899;0.84647981418938000875 1.0607936474537669191 -0.48937575730289034626 0.4037665733129393586 1.9886770275971010769 -1.7316099269356919343 -0.0610516944045506188;-0.7536122856471897391 -0.60340453205477107002 -1.1443239832979628101 -1.0199405506723389081 -0.55182316818010479498 0.29231829373798751126 1.4579564039997419123;0.35624185163831351142 0.56518099998991266908 -0.24708493161577654851 0.99556933940662672988 0.78818663449592363257 2.1280122765687718989 -0.30330202514204213093;1.3964545571453954587 -0.89798245500268125685 2.1903912924129085305 -0.78797925070617591548 1.1129313983781301545 -2.0950409731103474265 0.13117998226413765672;-0.85116146284010696377 -0.57195514328809504701 -1.808151026274162021 -0.19760393849548835155 -0.92969585177330704706 0.51349306985163456485 -0.25854205975965377506;-0.12137267206878660231 0.84307532256908024326 1.9373960020381073566 -1.2123498134298895668 -0.33956888519104938551 2.4837544640035011945 1.1592526808511123271;-0.77118934631190427798 -0.93005911316185541082 -0.66950747709746127878 0.17565552832722131082 -2.0992652960040953936 0.35106398400547972338 1.1744025335383954101;0.63415684016211792962 0.26533438107395113104 -1.6960087143566977552 -0.89850724115157465377 -0.77960094265121571144 -1.3550464137222317795 -0.54606629641077508719;0.21092009425740868012 -1.395211612774327925 0.61963821266511553976 0.69591341726504829523 2.2911099801481045191 0.65969245140145016393 1.7496086913181023714;1.2588260446776449175 0.55826402848974165938 -0.19533134043402677893 1.2942843218747115408 -0.58645969813726550601 -1.1383641998359108616 -1.1394367684520299022;-0.11118799657063187236 0.77946106606868903466 2.6446689024454168582 -1.4934416830581576097 -2.0859919482357498488 -2.8620020865737343385 -2.3728949467135875828;-0.28284299272178425877 0.38592095652318952892 -1.7556114258151487295 -0.95359095510121805184 0.60555862634747670281 0.29344451786533287674 2.190575032551416168;-0.5564455022783542093 -0.9821370712686411375 -1.5703958461053653117 -0.79027226646326398374 0.36535855997600968914 -1.3890652612682190536 -0.37075063466014962499;1.6449174734549600885 -0.57620814448415291764 -2.1226909831586096011 0.21576318352763798614 2.0178913038234140842 0.89258782258610891436 -0.1520537671582986583;0.075938522737089397818 0.30632966285814577923 0.10737296278229416235 0.072684883266853933526 -1.7470838487776578773 -1.0117088066998227713 0.12813597137944082727;1.0109441510885963655 1.465913991195069821 0.019177901362746083841 1.0546446226528705115 -0.43312084529445776804 -2.3931613120976029663 -0.42950009487584267509;1.5700716604310678282 1.8808424694225576168 0.35170662980179401291 -1.445611174455065262 -3.1286479820054302614 -0.62932290296764470394 0.15512438061953490176;0.43797521347842965911 -1.2962943882977562282 -0.49106753451225515494 -0.13759018324373134545 -1.4757292639226917697 0.41062476722801410922 1.7288825649941290674;-0.31738293756395152823 0.34833548848323209191 -1.516787124600364578 0.65337535738052432421 0.39644324674220693394 -0.098898576599713433621 -1.4478573508874448272;2.6011436632134099511 -2.0532991659089465664 -0.12076833535485495541 -0.23006712026230022317 -1.0824254826310493183 -0.72756450356814639235 1.665240573876087149;-0.0025076505889011155293 -0.234440309112032369 -0.92876111535307759315 -0.79078711548904323525 -2.1110600313868368438 0.50537288289249659989 1.6270367012666053785;-0.62100305455758986195 -1.0180425880687433704 0.30441029666476415727 1.1402631407821555154 -0.56073737894496400447 -0.0091736910868317009943 0.49786253324681239985;0.75874543030768470953 -0.018485154835271522256 -0.79410238831917967506 0.17481139999334879831 -1.0165402707840862639 1.1507474974243712129 1.1436073777613686708;-0.31018536686874442765 0.12839440545699193352 0.80409156342849252841 1.3350134456406981265 2.0040138520974295488 0.67026817639028257734 1.147108865681967238;1.2264035854188983787 2.9439148479865626662 -2.6128964151496392176 -0.0060970592329268793325 2.0156513035762300134 -1.6638247120029232562 -1.5481499123481534674;-0.70119649736030575937 -0.57931732674589664356 3.1576782248047270407 -0.26595327020077685898 -1.5402991254970943569 -0.64106566072818604862 -1.2152230314489822494;0.89152879035462373469 -1.0355021625809901487 -1.113110350828607098 1.8581716061631181613 0.68541952061378319527 -2.8069787921720612545 0.52969458718112261142;-0.9057977198304627553 1.6554061822776398039 0.6940779975056458051 1.4029826730388808009 -0.59845789598918841534 0.61731113016533334381 0.77457877932148133659];

% Layer 2
b2 = [1.7526722826729617122;-0.96637006536037706184;1.0416755795580776578;0.76737390883533584951;1.4489128125402890301;0.91656840270066830545;0.93577343163666781845;-1.844672914292315502;1.8071578695139338677;1.830625768128315789];
LW2_1 = [0.037135357167364872744 0.050872497934526202112 -0.7256315567010996892 -1.2945158065528212799 0.5505747322800772503 -0.17097645213170481471 0.85628474828647138661 -0.058942969525579452794 -0.51918925619662803506 -0.15393607600691786019 0.90421043291185754232 0.21235801374015175758 0.25413935690024469505 0.19017150910185554036 0.091621007057412967578 -0.052221539334263981924 1.8679514930491925018 0.28616203006262436181 -0.099258883137502543215 -0.098915956540619312531 0.30463393413004369314 -0.16182244259796724206 0.53268674701070262145 -0.71127166815882436612 -0.43058719566496006514 -0.49523103513376220963 0.096010646874078772739 -0.50040351661313220433 0.38536988003516375878 -0.55891299196482269185;-0.38936593005308228754 -0.26693196362926036036 -1.3417703530752482788 0.14751464824162990874 0.027864500028040053298 0.0092414982472529116214 0.97542952369179503069 -0.55289633729592646549 0.87108051685768461692 -1.5157399390622616764 -0.41412079374332022574 1.4636741960151049557 -0.3250671848460522928 1.0839290878222549441 0.63135927724138640738 0.082179823373851129675 2.7130375486239706184 0.81948486919518537253 0.59072867144514007443 0.74003141838813413234 -0.15698799662580190106 0.98916891064222745023 -0.26315354657146178274 -0.18476923556376448343 -0.78180973338790182847 1.0642687027020929502 1.6872312033234253548 -0.89988108840137148725 -0.96692343933103930276 -0.96927875865955093193;0.28561529139385438691 -0.29124054913203900607 -0.84481049184703371768 -1.7867259310956702389 1.3530750189698217412 0.57198860077673252533 1.0889167596416022832 -0.52705369971747895175 -0.4304895989113191046 1.2738956974189867832 0.76443540302546875154 -0.33951872804029425978 0.46646149578012480186 -0.41053526890045083375 0.13692102535203790059 -1.7683256550798218676 -0.87545759274368284419 0.78687835634833525056 0.3270051365179810765 -1.6049111323481926039 -0.87618226456859193974 -0.12529582569558753158 0.39483918812562052159 1.020560759768019965 2.5658696488911210132 -1.240859280784706975 -0.066140304186195389424 0.49515516989328312025 -0.84373429261705235049 -0.15465475575934697905;0.067410237434603337281 0.25650285673551193044 0.25449852609337736409 -0.50714079279189061555 -0.71262705257458269781 -0.14887761772792787451 -0.48757908090542029234 -0.091102134083802327469 -0.41297016866011454495 0.19955216389321722703 -1.0692078234359194688 0.15934177702037610747 -0.91694464661046659604 0.2365188254741868723 0.20311505996370701754 0.86938417453799254897 1.5631708336944318827 -0.12027413212994617076 0.40317561774668853047 1.0622830474560742697 -0.71644140403639100523 0.13632450753908584296 -0.95891910738699293049 0.039329260787997810667 0.33627672043543666014 1.2951838529659940313 -0.74277969866464421678 -1.3039068587365356677 -0.51403744464526235358 -1.1595634635078846397;-0.36285856013254214059 0.21684384911794662987 0.14664934516682442966 0.45515964475087294927 0.73271670250258091883 -0.69380289989069909851 0.65155905031404448557 0.28151749725946190184 0.079189273324725792391 -1.0690212842379773761 0.76756703416739091583 0.55036455656426985783 0.40391685745177208222 0.92705222025725220192 -1.4201742113854325389 0.56911484873515549854 0.50397262192091729638 -0.28817172744737618029 -0.32916179315321048016 0.24200598799550110396 0.14675163703267948834 0.87438207705299719752 -0.46426025748336680055 -0.96488337388381884008 -2.8234035555683094643 -0.35919037851712765086 -0.73957056820685651566 -0.73432454413419823158 1.3558908992368106095 -1.4270881165188720185;2.0818770952627105864 -1.2338200365645231038 -0.080696558818601993313 1.702076522303479722 1.0422645846730276276 -0.42085511014279108899 -1.9549551552021442458 0.69428092853632528136 -0.28799078588181509231 -0.29053067150966083165 0.86129105462573529728 0.46130966263111827796 0.040282978999583891888 -0.65512088788806721595 0.42311619108294956648 1.3349940460621481098 0.29225436964495005165 -0.26729187887301336657 -0.69199632847636916022 -0.70527816256365316594 -0.33716864332888085709 -0.068655680919434081133 -0.20151319887059376823 -0.50712785645832270109 0.63075460451488363223 -1.0102304477470638311 -0.21620126678619044913 0.13062815895178081504 0.68781668354737979243 -0.2426718832539666304;0.13989611741678859014 0.30237600370717948595 1.1030416234696622801 -0.36423547749465001733 -0.25822177881318753023 -0.17045780305008381705 0.053580923106427771896 -0.15563114924987220267 0.0059087407010899092169 -0.31040872006294012442 -0.31445189673331408464 0.16037323733884920052 -0.82979448604853234261 0.40926885655989869717 0.074333127624582051585 1.2515822109837904108 0.65139797323135029128 0.28010628412449395386 0.48455848995420741643 0.036445672494920526574 -0.95786677216529092505 0.5831342474519261021 -0.74048331751295326519 -0.48044690813024892861 -0.1073263163394040931 0.11794117828730651953 -0.22390124758120630299 -1.0859601238298712822 -1.0948736756299988215 -1.2525857167417888682;-1.7514748766185477269 0.9022099905369524997 0.33474463370462159695 -0.49053314491331623248 -1.380859523720897819 0.32274590357153937203 1.9627857328519751068 -0.43523684042636595626 0.37420124228877843509 0.62712559622464636444 -0.73931651517555474484 -0.53667611056193165187 0.016685047926374648591 0.27553452638118419715 -0.74879466817950579571 -2.2104931558546656589 0.28999878305839510428 0.012675411788217872192 0.69527286182743708309 1.2890750326605560083 0.33782006570239847543 0.65707740887314425304 -1.4064137540823236083 0.65417583128118228508 0.97894506986250162672 1.3235136061154841869 1.1131286058656923998 1.035342047861972592 -0.1676912035173519222 0.82362029339881448475;1.0929918260887110382 -0.68794875688834200567 -0.2808288659255704367 0.64909489396284036911 -1.8260839342479429082 0.28707241104527037034 -1.5146303434426027223 0.36278769200285604368 0.5884266586711367486 -0.19395729232182759572 0.22118467423610257971 0.42860560261730396014 -1.621108040169569442 0.062739847729220157846 0.18318159288859778289 2.3496183705424811272 -0.022265579243825210642 -0.005794948517205623234 -0.44350921233331952465 -0.30419542958424539147 1.6725538510258037839 -1.3242581692005437333 0.33495680655166565343 -0.9012986977644166231 -1.0247234234572553113 -0.30018814137395005703 -0.22841366986598224398 -1.2413730651445951114 -0.95809228618934993982 -0.9467194425957325965;0.20803714867123948573 0.14952871771240563992 -1.1687365492376267095 -1.3527950397634316282 -0.30704535095418838964 0.046689527494640947758 -1.9176140230740457149 -1.9178537689805739141 0.31365357369814583777 0.46727782349074981072 -0.53736719893933238001 -1.0390990947276121936 -0.89143417301389338281 0.057550479925723485586 1.6778673913760697722 0.32631294240541847129 -0.78998026256780562449 0.4527563619446369203 -0.0027932986483413073386 -1.0121796175185415745 -0.62640434952151036185 0.72300907248669943339 0.43335298114086939769 -0.31909918629022354652 0.72980067798711822924 -0.59475370837650354261 0.74145977506502680487 -0.035779374670013540383 -0.71086196445644256325 -0.68047731965339386395];

% Layer 3
b3 = 1.4514413396605647666;
LW3_2 = [2.1747259535979734935 -0.59992970844335324898 -0.52526075084419843186 -2.1041692736191608404 -3.4817923839781674822 -1.234861202426997151 2.0593336905864525477 -1.5914720148400940403 -1.0564135887345509346 0.77659279692479743495];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
