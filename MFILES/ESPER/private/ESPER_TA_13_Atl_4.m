function [Y,Xf,Af] = ESPER_TA_13_Atl_4(X,~,~)
%ESPER_TA_13_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:04.
% 
% [Y] = ESPER_TA_13_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-0.2178;-143.241523403244];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0479365703301392;0.00458552991639557];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.5562635854724453655;-1.4427011793249384652;-1.0063335929923409306;-5.7716383915781284131;-0.27398832226332725526;-7.224008715891995891;-3.9627415594723411907;-7.1448067183253156642;8.8912781402594962543;-1.4138783291484542382;0.11599189099786336166;-0.48608383304458918639;1.1259895504771013641;-0.1524576584788296385;-7.4096847210592606814;1.2575703161078217729;0.37424195587389152973;13.77484095378441431;-3.1154164677373490377;-0.82359433315570773626;-11.437285707688339187;-0.39337589436756220662;9.2206712362410563344;-7.6667533088486301551;1.3068384515424240622;-18.513880325970497154;-0.43921474122298015397;-29.801932720689091383;2.9111500453543173172;6.4616535808356818649];
IW1_1 = [0.9407000886547206564 -0.25362863833467952368 0.491474021784218007 -0.37524808746107390922 -5.0266647364308960633 0.75347050670459825295 -0.63387878364892757954;0.78556992810450432252 -0.19207949836121512854 0.79290709549249827059 0.46909984378545760419 0.46266040535659203048 -0.61258982066998579619 0.41698631390789919759;-0.052967311260442039023 0.98686937807401864386 0.38414647727272493993 0.18528701299708266736 1.6331996231757794913 -0.20603364036279434024 -0.4911023642057825711;-0.8559245381128787189 3.6666691224539551541 1.3616847183093558904 -1.958759157103122206 9.274899435552246274 0.71937779500849785563 4.3070651483300643747;0.65119828262239731753 -0.61295065364756495807 -0.51315779208237743969 0.069218254029525985715 0.81048203243176220045 0.19412791512597843413 -0.095960027725316948688;4.9510376260989561459 -2.2029411533533806988 -0.69025237412076190235 0.29866730252783485478 5.5570248783634292877 -6.3014596833374660889 7.6746296907617583827;0.45989463235870436941 -0.12735601025031051403 0.58100461646662948656 0.26718356775258167435 6.2417536586941970711 -0.26168168262079799513 -0.12385894228008899332;-1.588540123096204848 -1.3827048255079135153 0.22712219692610705057 -2.0281876789746977607 7.9147628735788586596 -2.0231265607243393845 1.8259177878503818349;1.8508492506351665874 -2.6975828883532240177 0.66704307038960897192 2.4914479744459296917 -11.443337182446366995 0.034084711098179135136 2.0298047812423423153;0.20957774057539946266 0.17979063096864036919 0.35034343270805934356 0.84625627661752922393 -0.35730169320989924042 -2.1761648987537762778 1.1126280029362158874;0.7327142160639962265 -0.66660262516603785432 -0.64803284832050822573 0.039143536468341608159 0.27649015924288217194 0.17174346633522419303 -0.070142407869550241206;-0.93962657117035919274 3.233040744658267851 0.011792835534831729027 0.76077897480942402453 5.8905049329646796963 -1.8131367175906136779 3.276467920223119723;-0.26075390773693624125 0.12303329329409998238 0.082171932551302312442 -0.076431133852208774093 -0.53482352550744449715 -0.005360337416757862336 -0.10783875093619049723;0.045000607284625598892 -0.44640459508193952587 0.89115201548059874703 -0.020034460620203579928 -0.23358919501839042754 0.70175987157998709343 0.094764432466772630104;-5.816975154349600885 2.5302532176252587881 -12.699468828742638493 6.1079405318017743198 14.057895620553029659 -15.640339825025495912 -13.582645512048266312;-1.3032416226609517818 -0.77425698517038687996 0.032738589985110921887 0.41569974123287811718 -1.1955618589418028908 1.2748319698295678126 -0.83193773269241677593;0.60664609110854972318 -0.052352631111026691479 0.24836905098068015607 -0.0080672775209966289534 -1.7571936000456653826 -0.067696220371628729184 0.15685632783063524487;-1.4069925113067291989 3.2939928330412175939 -2.3583360900299652485 -4.0042172136635088009 -20.905292615968804171 0.37865623668451736661 -3.8896738226717619824;-12.768461323698215182 -2.7642104279641097619 -7.5083152414503029348 9.3568801510988226511 3.7807710786494745925 1.7425013445739181428 -0.88891957601439230974;-0.66994450445079056777 1.1076187797595893336 0.5090093739083887403 0.39473348596016083478 1.3098102744082189552 -0.62989895211049740098 -0.31249419040518555679;-0.80451430691642711324 -2.9014706470844044972 0.17055502178817188996 0.004961010523308500772 13.696143348366199177 0.41815667484399643428 2.2640646996855444684;0.61224210685897928474 0.21604563254642522585 0.43563341228295604513 0.12546105777719954166 -0.17661871300074463709 -0.16283586759450904835 -0.076072220881265847914;0.91681124700941085681 0.19515440546387677334 0.64547534698689357224 0.91351914918018994882 -15.445746670714687099 -4.2351615207555637355 0.43686721058655531014;-0.90802318063676634718 0.46167646590331901102 0.21239676148837305369 0.29590359183210862559 15.207980610392505483 -1.296874730521575092 0.96055861335838743642;-3.1929838506273759968 -5.6453033091584838843 -3.5617980892572456142 -4.1578922187357836293 -5.0483911797704541513 -1.2695061546070571801 2.7155358639979403357;-1.7349208856084630259 0.87826319715284284495 1.9441609584215349127 0.19239400029659281532 20.787184047934175624 0.38192590005534265973 -0.21774073337811833406;-0.10055247782461995687 0.034929947913847979313 -0.33282387179244710129 -1.1558040164779730397 1.3129864943467162153 0.45421441788552818775 1.3697476930510275039;-7.8729961001605364146 -8.1684241055714785773 -1.3343128347614343632 -20.210640971834351376 66.468568339085805974 -1.2402991166785828359 14.645528835072900264;-0.054451735278328944334 -0.076023980562209825251 -0.37272656840799794908 -0.14599216494280620182 -5.4733946884071036365 0.020375807689042381432 0.55012459882509723297;-2.2604201388790969851 -1.2542447734024582129 -0.11338646070580148117 -0.3642120037095001317 -10.811137064159019872 2.775524790573569156 -3.6688509693035937786];

% Layer 2
b2 = [0.45875606266557361623;-20.55835846008435297;-1.9917482465460716323;-3.5192051533505583905;36.72511656652573464;74.656653666056698171;-20.283213353657021827;88.678864003510142311;-45.664805509401311667;-14.992025557556376114];
LW2_1 = [3.623370392720244304 -14.44992015222086934 -38.783627212211662538 -3.7245762883593438453 -24.808980125347005696 -14.469535309130787226 -7.8318202273100476773 -3.5176181535234509745 -5.7537786126342886917 24.289043545895403042 -8.4043474407814322547 -15.255423520402295878 13.62885113587689645 12.738386938692944028 6.8507509657091274491 -12.363552998854977716 17.996381881208876052 2.6576082159246698922 -3.619125714115121184 -4.4504963908524626248 4.1107679404067720697 -10.92364600454589052 1.6412471159349280025 -6.3947035123704409898 4.5280814700227418612 -20.784546268748687936 -1.6476719532545804903 -7.9296471573035125502 -0.025121275846635909151 -23.953467386418118679;-5.0824738472466810535 -0.39853297806435461492 0.4025154532822018405 0.33441131883160174487 -23.606379562472888267 0.24269525346288664536 2.8733231138385240122 -0.41280159973955260488 -0.18579312904729178291 -4.0429591374141971016 21.575910899524650688 0.53066001474916124625 12.533161947008448323 2.0735111466360311994 -0.0241303955455112705 -2.6730551097774637448 10.474739183960888766 0.11674156988443153138 -0.17676373598516154084 2.0946878235531842805 -0.34859150648215009305 -10.703006571223490084 -0.45093468239601741665 -1.2366570035511190717 -0.32524371711220406711 -7.6702266672013923454 -3.2779615375654111986 -0.076301352715422821049 -0.29229731885241655442 -0.32880670631273878346;4.4985814112010604759 7.6513273565997774739 21.591111761839968608 -0.11456579786436571489 4.8040489494279565719 0.61521784460411055306 -0.77051805615292356944 -0.69374995619885126974 0.39290467121036942721 4.0364722327396638235 -2.7048454640149452999 0.35797119479661437813 15.036050738991180609 2.3047135265795120063 0.075413969003684813708 -1.1942580445771231457 9.2863070686101334417 -0.4509514115222673647 0.12696388122248153385 -10.492718458059757225 -2.7080572858384766022 -35.818794812029473462 -0.41925749703424264325 -0.66172890624509816959 -0.33639441006623616026 0.51749693684657149806 0.65685920922164064972 -4.0725864692050794957 -5.5143343344910258352 1.3070954461616268727;33.810857546123507689 45.304944784798159674 26.259625929233749275 24.58336057311442957 96.505983543203242903 8.4301255136878818774 15.789255460754192839 35.322852772787229014 -27.361593739641957512 20.460098243628308978 45.291222013593795737 8.5216768556559614467 42.438889287446883714 0.48876851730409925922 5.3268324012898649045 54.015632746606478065 -80.757623103083957972 7.0453273093878312494 36.3490645336599556 49.57877633797544803 -22.088411492018593663 -15.995688635907978181 -33.450038887144444288 -4.1853285443303231972 -25.44906123028227185 34.406950195471623033 23.04518092311819899 27.035513560428803714 -3.060072526973687701 -17.601686201536335119;8.9384419461730306722 -24.878353127251866539 26.786375297865419043 -2.541269926579476035 38.02987313614657694 20.212790174345933281 -9.3908620179958877117 0.16398198151596871108 5.9321454353299145623 41.457763834941047776 11.282954158664377786 6.9810948790048223955 14.402361241924429791 3.2686618702705438899 14.882955801715445077 1.0925372384666902636 -18.218298328429749944 2.6223179756007164443 -6.5280192005822801349 9.2547452799760918651 -15.193848612560602263 15.346381978426952841 10.193910454954622224 20.366462504122935684 26.081685837433198571 30.265628633798403513 6.4154261242754282435 8.081498256647519085 -8.6307724136434771367 22.915696647505296113;1.1947492742320389159 -13.639239351108487952 10.546715387779473261 -34.146872436491669589 39.334989300482945396 3.7045569065063408409 2.0862689898398598665 0.07303987557875982195 -30.905793722035021176 -17.636569541142673501 -9.8303661178643828578 16.804777932806370444 1.138165555694479858 8.7700996882658390774 11.022142484281735264 -1.4547024934803265417 6.5235574277621743988 -8.2813684211644744693 -1.0618073325767558579 -4.775623263202612101 75.800166907236146585 9.7116887169826728865 7.2648809949176138545 -11.321026704536924612 -16.825730765913899489 13.453293704133766795 4.0159074405896593163 12.864016582658727827 -1.7253209394586146441 17.476140534085072176;-18.313026150271021208 -4.5697790418966199866 -27.409378653014169203 0.19474496483395939417 16.944723857187486971 0.98006252868225651742 -14.284105274827728849 -0.91809851279201282193 -1.6707211750716979282 -7.2672190829440523885 -0.44835282637610324175 1.3905708554451943204 19.465263230182490162 -1.2040794413058097945 0.062959288012775935228 2.3020971638645715274 12.577934916309908786 0.34893991348202618719 -0.40332116663233796849 25.401583671630646677 1.9795736536845973674 31.725154129869189035 -0.59489292145144334611 -4.6521550323869131915 0.66505548090678168194 4.5893252812967135768 1.4670492035820876797 -0.15393607686829738346 -16.156280823030115812 1.7042213307819034096;-9.998705633048212249 -10.652706394715240279 46.917288200359600125 2.2871637470638979117 14.875285408995463143 -21.571130252770355895 2.0641643444548747333 33.801130867729597185 23.74267613311128855 -64.586094583458603324 -32.104918570666164612 -3.1678501924779958188 -16.565113619913130805 -16.897028422085980992 -6.2306787331969886168 -30.898886694104476192 70.640272622738592645 -3.4231806824057762206 -23.5683247385883341 -17.010991098568577939 4.3437530623492488502 -0.1242723243563559482 -13.082928803763056891 -2.744373301268528742 6.0422886341139943056 142.96952638197581109 -28.669238230099516329 -0.65711518873147256592 -2.1727461025178111953 -20.680403822273447645;4.8783426396982436657 10.543220037169092507 -42.57306399750998338 11.373055750701304589 4.9923678762386529684 25.78782048840339769 24.116393959361783317 -26.977880903473344887 -44.008249319680182055 11.187418573097959396 -41.052984974207859636 -11.980309531555336733 20.195381405398290298 17.507970368008230366 -11.506766083516048127 -25.231550210659758449 -36.407644133756818405 -15.445004241957576596 -2.3625006930733793986 -16.711085354220770682 2.9824519768875688008 10.249338910269461422 -3.0254301058074242192 51.45814617565554272 20.707090993198683293 -19.675300487741626654 13.910735276733735333 29.984582010769436522 42.642665192323214285 3.3541936244313261817;-0.20151110735137395258 -0.37746652766959176706 -0.33224757388788339618 -0.012439108972143123749 5.6175690429600786402 0.046262777324393128398 -0.0094772211608346295514 -0.025853798140706013564 0.053720935150645292289 0.15303021019579726714 -5.138193633868773702 0.064638366141277853183 2.8698817027888061659 -0.2588773481914772856 -0.0024635961001907998556 0.13665477377840568041 1.2742990322974718786 0.0084637051547203044632 -0.024492560737508415475 -0.45094989384164491097 0.091939486742423207066 0.55007287807645288691 0.046010979039377737643 0.078123711056536759845 0.045945101138716297473 -12.950782659497880545 -0.11865175903288670278 0.047337190775822393651 0.18983661248746014349 0.068819663152267118722];

% Layer 3
b3 = 0.16079608705967640692;
LW3_2 = [-0.00029347304685434249562 -0.13595540203251130218 -0.018309852071287328196 -0.001157583964959634339 0.0027583415552753405564 0.0031891755597089942523 0.022807184101929889319 -0.00055383116716005800252 0.0037539201676095659832 -0.4313930506527324793];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
