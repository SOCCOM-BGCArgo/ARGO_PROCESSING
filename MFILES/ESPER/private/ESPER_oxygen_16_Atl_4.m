function [Y,Xf,Af] = ESPER_oxygen_16_Atl_4(X,~,~)
%ESPER_OXYGEN_16_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:49.
% 
% [Y] = ESPER_oxygen_16_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-13.714189280468993104;-0.99299590014344818467;-0.73745879360983290773;2.3525810931537676218;1.5605509093230389706;-0.14885144830691454665;-1.0499472766855912909;2.8023700509478217668;-6.3933073883281554828;-2.9356928018944681291;5.13042128313314727;1.4533164786555987646;-1.9090860944690457579;-4.9766644144534852856;1.5858401512261550703;0.27822398464314590516;-6.8813353462332687016;3.8856420045029453902;-16.787903946319204351;-9.2650230941709548205;0.39135949996138885698;-1.3424262219613223301;-1.825231877182740492;-0.46137865415353096488;-11.155748979113745634;0.38995015415818312654;5.5674513256650852711;3.8220923578137946386;0.82053752467231455547;-4.9405446167656306145];
IW1_1 = [1.211319760600491513 -1.7813912284482618098 -4.9566134545430982072 -7.3914951922039344723 5.8360784467455157909;0.79377377188541065056 1.4652923778764459506 2.2573402244617812862 -0.68615083757942507692 0.67687805818980784078;-6.5830121124958793644 2.6981264669409905643 1.951781938935819749 0.057790894199381971641 -0.8236729289658959452;0.376523768146936888 -0.22813486361244234013 -1.7002464298198867176 -1.7314219888747841569 -3.0734481909130231259;0.267404133681147127 -0.0052642712626020044323 2.5428732189055387458 -0.79865230438401879631 -4.6581943215820986737;-2.9689006168484506354 2.9012433347271628925 0.96607292591798810122 0.67913500230539369795 2.6060247270717473711;0.022278347807903484123 -0.90150168371048700067 -0.045249146286855702892 -2.0781264291365832975 0.049702298958250942795;-0.038699054670512170184 1.3787657647407363104 3.3613698973659369429 -0.62356092985332844947 -1.4252064334917105004;-0.2480061429705277265 -0.77144269709124069223 4.3041491880033548867 0.88215683637087194402 6.525013504033862155;0.28804117009014928996 2.1922860361519744821 1.6704030077454758985 -2.1054156754633837068 4.2600645930108544945;1.1499535122338062632 -1.564916437789769077 -1.7127932093198234842 -1.7228853433389381689 -8.9272115073128510687;0.24585965929727132684 -0.28380702259954515565 1.556775585778198856 3.9636692590441531259 3.0287171312263936329;0.65632037780002094873 -0.070226095037144956046 0.10973445972242153179 3.5697961216719433786 2.2788219175683264162;0.66372075666166230334 -0.85236456015505213113 1.417932968772023683 -0.70541664763418621131 4.3471905346379147161;1.1541755773520983031 -0.69694794536714643751 -0.52423986599427518929 -0.26840457541476875347 -1.8200246654250298306;-0.32065967031296038758 0.95018267431294278769 4.0050079703980605572 -0.23189171008135375796 1.8299929468113582676;-2.4762883418345729147 0.51939017089303241015 1.7280590352306524071 1.4777037578079197377 11.717512872193042384;-1.6186551248206764164 -3.1729980893920011198 -4.607600266071546713 0.50300184566843864076 -5.0418418820055128649;-0.31730224279733354464 0.51417689028026070108 -0.16764943400978915555 -15.947639703718660797 -0.20899878690980613904;-3.2943037611265952869 -0.35458063321774790921 8.9869559844002360194 0.14666246861217940856 2.1100708319674512659;2.6267753574805579042 0.11900537023813645421 -1.267862513939474356 -5.3379033409960277012 5.9656827425848391044;-1.1614605426229409613 2.0752620355066024871 1.4777694290374552288 1.9660885974531538967 3.5170797698578875057;-1.5102367834915588762 -0.23742679617397197123 1.6314404082202893509 -1.4673612560270841154 0.088829831717776475131;-3.1202763385101315308 -0.34497930983239899483 3.8991870023938446366 3.6788274709703814302 3.4909909147994446776;5.4798324356797003531 1.9602610361156957985 7.8667840075322867932 -6.0877671730914890702 -13.006198573974318222;0.97201832832607104606 -0.64954663710959659184 0.86971638520529137573 -1.4153786916776738281 -0.49064325611733500265;-0.027879684540469795717 -0.15424764649820493778 -1.2458117396318340031 1.8576149019882135516 -6.1669026580973280716;0.38393124807336392879 -0.83453025257616852972 7.1167944149146382671 2.6538006490926542291 8.6401105306408734208;-0.19292938220659600068 -0.46774278888896769768 0.22941770232336902713 -2.21506372328415857 0.30265476219488718357;0.25453512873635331104 2.5617489962387698377 1.1499749729082822114 -1.5307910590590132482 6.5327730796356648924];

% Layer 2
b2 = [-8.7466709701833433854;4.2845698634520648085;-6.8635280057378373897;-1.0819689749924974453;22.393803441676936927;4.1425977252111474414;-9.8929159728285913644;-1.7334055922798032867;1.8563153553251154904;-6.3189684234282896824];
LW2_1 = [-0.58908339073845494838 10.026833137823221165 5.7986631545628872786 10.004214973861477844 -6.5245683939443122057 -4.6705111120327318375 -1.6496431943695504252 1.8308115013396215609 2.3054988320644467237 -4.3372440193306447398 -2.7593134898967210944 -7.4579071210895513389 -1.3320052215097379911 1.1462666707526916188 16.015689031688339128 -2.7543910532456328255 5.8038476738169055835 2.3347333238924754539 -5.4895507350889536369 5.6824298144401774735 8.5759101522227361158 5.8488135584404856715 -5.4484036717283164108 -0.29843099977317089078 2.1350490186021064964 -4.9969235267681977319 -7.7812544639478158359 -5.1108340820117126313 4.1974476281304440306 -3.0986591604336557459;-0.47466384795634919413 -10.141298787426203276 -4.6462890575927797698 -7.6092439198242090015 -3.5017719398710349665 -1.8758162521015078195 2.865319639517272865 -0.56656536805352086805 -4.0099525899204362389 8.2118256195368193318 -0.22513901011950576692 0.72466667884906554864 -12.316665172040691445 4.9643074735708543344 6.234296836366119976 2.1199750497557783291 7.0660907222447368881 -1.464989641085952421 -0.96950381141887420622 -0.39967544203229821154 6.6913704283289163754 -0.0014813372086665054037 -3.6308707344768280656 -3.5911738097775325329 -3.906893946919358207 1.9365830886133688082 -3.8910825232012768993 3.5546425819673936886 0.18436954149207543385 -3.6750825211037283502;1.2036066263833404832 5.2482096953560493091 1.7860696715685235869 0.85708307966764984975 1.8772643306752538894 -2.2051153539650254487 4.4987576930431050215 3.1564874509965292759 -0.58898643614216195097 -0.55059573325414890022 0.5267130003089416368 1.8492494214796797447 2.8766574132761171256 -3.7613819516815074628 5.5023261814513242385 -2.9757405746910121636 3.1965500076178265942 1.6589685424543560988 4.9256000039994916051 0.58049159913081793682 -13.351269426342117441 1.5392530710197001032 -4.8917191590348032548 1.1443900845932057919 -9.6923264923787204594 -3.6825155952838990459 -2.3520695957439197166 10.521446460713121951 0.92658094134006185882 -2.0951117847339291167;1.3526834511883425449 -0.66138072834602634753 -0.58153215219027909466 -0.11934799548256803947 0.021005230743205503818 -1.2225585944196344368 2.3440929075720879915 -5.3699626451015047834 0.77050995966236179857 3.4786223844571426689 -4.4503658935608418901 4.5412759621830831591 -1.2914476649041213285 -1.1716215692422802253 2.7673031316664369328 6.4352151757150064526 -3.5514952860703239423 3.3110904623569763494 11.067759827507472892 2.645021497693070156 -6.0015885416477612324 0.12724239854795391103 -4.7645900934659710657 -0.63489074717376703383 -6.9210636719537399486 -0.87986200440760864439 -1.052015197628187293 2.555011124298189884 1.0367966378451798359 -4.5062720782147183129;-0.93692996716347454189 -1.4099009674821831872 -0.089205651853951919983 2.3576214938511639296 2.1854183638499966591 -1.9829537118306996835 1.07271774163716338 -3.29334856448745672 -0.42863619836307415012 0.72609945346089743712 1.2547392500289957784 -1.7665090470785860255 1.595635382636699795 2.2209707230517112819 -9.6474290293817901443 2.3214119561371160394 1.0784885880175412165 -0.11370932739101781428 18.958157576436292402 1.5239929183463860607 0.25497758301719186669 2.7860725248181177349 -4.4356459823294640543 0.55744804761756505673 1.0261006583456386831 4.9620128332440751606 0.64613019717152642141 2.8831480765835326707 -1.7881114970655640484 -0.056611641050320828106;-1.7974263827827561268 -4.4568898191694010791 0.80114849378283270465 -15.752527021470955404 0.28686426309683044078 3.2894921508069443483 5.2769715743988019341 -2.4243356592913754 -0.68041638170971718846 0.92120272428891336602 4.2453482782663032324 -1.9359586253474661 -5.3625371326699688979 -5.6196689823640504358 7.6369056276110178771 0.64384731913463377762 1.5523037379348532117 -1.6568221680978867383 20.326748574329588592 4.1134023598834996704 5.5363654496000522798 -1.4101633115702842947 -1.4471399397092334915 -1.6668330007313112429 -3.5411006765420007802 1.6766339051698422313 -7.3718106940556262785 5.5062281591096020605 -2.0886574489512916841 0.59699990606400843429;-2.6950367016233367501 19.20995115945039089 -9.6359572466233238686 -0.29743268372099579411 -5.411881275085394627 -2.9452986950957416035 4.9792312694458162881 -7.614150148042388544 3.0500271512847203503 1.8717865542783891364 4.4798610236376319449 1.8397538014742838008 0.87556690700286576856 -10.483943148194374118 -12.965253623408178996 5.4324447337939298919 0.28793289694007029311 4.0289791322891863601 -18.185299181374990241 -1.1864798355986776457 -0.36799123354929846874 2.1246451653202509391 4.4301054940394068993 -0.48215335477995824309 -1.9288281651467518163 -0.93685727133032914438 4.2285192644183542399 -12.305974304666975172 0.95437942899580252565 -1.532684248368668678;0.021825423464426191994 -2.4347431456308412656 1.5206918813913874455 8.1910076012050154759 -0.023803163293602377232 1.1830199856832355199 2.1221749828038101171 -1.7863666252032761594 0.56632349591643948994 5.530204854476149734 -1.9564615137180429993 -0.46429484686060856768 2.1191466313820122025 -0.87657692767878070406 8.7074870840971527741 2.0524786500427594227 2.6992522227256583456 -2.8949748259116923066 13.947491761996019477 -0.095575656299725780807 6.816119630848107569 -1.7595194385631029999 -5.2330560323173758164 0.40433522798470833415 1.2565723259442571624 7.2709294272306808082 4.2222515361409396206 1.2835958742576205616 -8.6630942534587607184 0.32755575800099651085;-0.21356693009322902377 -4.6851062769096900595 1.4511011341471768965 -0.86656684901189284798 0.088399035023965538693 -2.1723839154273920649 -0.86173768276865858606 3.4538510265896955609 -5.9859626103557310728 1.0062714575365323544 5.1606456022920363935 7.373431591097145521 -0.59521257538730387715 -0.081661444491922155486 2.4056281311210789831 0.14196799775244653419 4.8593675908591285051 -1.6088707312425920559 -6.6151493341362304079 -3.7503318183069662695 -6.0545207521914594651 0.38506107283021595578 -1.912019542175523501 -1.7635925797999121301 4.6891968930842420349 0.33503234101078904761 -4.6107461208943547604 1.4873369992291103348 1.3020718080642226244 1.0686221576489858265;-1.5135279919408788363 -5.5587559931000694036 -0.77897483275622469989 2.1162052918417693093 -0.85039831005395483121 -0.79720849766045009943 -2.7914650965621379264 -5.1977055862832539646 1.6307793785208866133 3.2386094109242113959 -2.1886826642658534503 -2.3961767946431988818 -1.89630160005076287 0.53593242596356249763 -4.1016645319863043184 5.8134740865542964272 0.15467891033859998418 -1.4924143279813866236 -6.278001605299814436 -0.79346706257861854272 -0.65632633987815802712 -1.3928262722872428725 0.2895599957001729341 -0.9138705247104708107 0.77110774556010308611 2.7689678101305763569 2.1488487399879727668 1.7096800797056563859 -0.75555452922877885946 0.0056731249995146323939];

% Layer 3
b3 = -0.17471990900882575226;
LW3_2 = [-0.10744183319708572322 -0.014800049316221671261 -0.15971616253382686645 0.091544245696031326109 0.29536779647045702246 -0.1330521254322269975 0.047283816034273652706 -0.052499342062394725728 0.028577903731896971834 -0.22452330061862926791];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00368391969055075;
y1_step1.xoffset = 13.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
