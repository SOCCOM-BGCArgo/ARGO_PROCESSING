function [Y,Xf,Af] = ESPER_phosphate_7_Atl_2(X,~,~)
%ESPER_PHOSPHATE_7_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:28.
% 
% [Y] = ESPER_phosphate_7_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.1565089993364017218;-0.45981143203396857011;0.10832422592183423016;-0.30457491587013862944;-0.51138681987936029927;0.91506054014688309461;-3.8737769675880664444;-0.46227784166759555706;0.96165093091215381182;-1.0381697239138385491;0.87116843810715216545;-2.3842144300893695075;-1.5358212999678220179;-0.06744409721712474326;3.0250980052525795472;-5.6676174894264645943;-5.5627797560829241874;5.1506629306399851487;0.33980388914994141825;-7.1596815802285860286];
IW1_1 = [2.426245471410304777 -2.4491390372792545271 -1.2247628035700182103 0.83319300264113316246 0.68649243091751577239 1.5092747197953695348 0.031180727575974440113;0.30316121675179280581 0.22900508362214699876 -0.10185996443323422356 0.16626413896138747539 0.34873392522638524404 0.49040626477693977092 0.25731160667788022245;1.0997087646914975867 -0.14092384359096568613 -1.186594530764310873 -0.77844600086851212239 -2.8261629961702268155 0.21521295753814384533 1.642316266073811093;0.20462632858175480721 0.045861440727027281972 -0.293770678837539434 -3.4445005896652856059 -5.1678768666614383065 0.12792862229171680921 0.018056988671009330943;0.074872875550798523303 -0.64755419602866182149 0.077745916015977106772 -0.18425104962523766727 0.39409440761660047281 -0.082796665179930603595 1.7840118089056054007;0.11550923410822130921 1.9731167303420922288 -2.9069807351297369813 -0.80683405003600672245 0.85434063597241138854 2.5656708821234763818 0.6143512874897446574;-0.038330279238521343388 -0.26892704894376967539 0.18911361787363334397 0.048878138512051298725 5.8347937866493841952 -0.16326869461957094209 -0.50756443569350961909;0.18591564168184634975 0.10967858183010681383 0.086691985125476919705 0.11882036826838474064 0.64080492564902158392 1.2624616063099434182 0.32066586736064384144;0.49758385380976988266 0.89457734827274371092 2.9662174994210621648 0.38947125296183054965 -6.3058334231265442682 -2.1817481198374366613 -1.2011321196233535336;0.63630595653965160707 0.95751581049474177032 0.29505398636946517099 0.26268846435024389985 0.75382662342291861801 -0.27639454761370230162 -0.39542877356803429745;-1.1455798857230938825 0.73273311308336586123 0.89818073334756665105 -0.60758091124099555813 -0.59524078211804654082 0.34960119956637775163 -2.4942861961602202925;-0.21262369320547036544 -1.2805118654828766545 -0.19463105291437837741 0.07217303092878096793 1.452184880425614999 -0.94282256432430744386 0.87875176406633825898;0.65273433134954261803 0.7765908770373857184 -0.73107460347670993883 -0.024310467272093953806 2.746947922563886646 -0.48978771318281805192 0.45223244622218738975;-0.90131317444357716973 -0.70180411790161090213 0.69892193255434087451 -0.083231817871949081988 -0.97021247149816713939 0.3613550328981093851 -0.319232231868753491;2.5558552119814130776 -1.4219975519264340669 1.1588323284619499454 0.32250259228961664082 -1.5960101910814361581 0.82886879809402180808 1.6339966357545561149;-0.17150508755754820256 -0.38215582680089554835 1.9196825672800861273 0.20857781174269082736 4.3970497346242014558 -0.92110428012899592254 -0.32190456470854872384;0.32815493284470825808 0.57720427150096031976 2.1173245204859729718 -0.13766559009946541248 6.284263553485558873 -0.77898444379774423041 0.30630224736073780045;0.16346441209055967425 -0.37981598873260274951 -2.428653338589411792 0.0037814115778097719643 -2.1756011812443833975 2.0984974801010092271 0.19311459787872098381;0.9148001146620208246 0.6100903313662453531 -0.64265149625041884107 -0.13077681346054159661 0.88235876389586387347 -0.5155629168300185361 0.92165007887947381082;0.7314370553897769911 0.041295062822584348294 -3.4021265239428077898 0.27076719032117524399 4.9810826150709273108 -3.3357671780214896984 -2.7213950730272613576];

% Layer 2
b2 = [0.95357339404276186823;0.68040300171941547891;-0.18052874643916835828;-1.9720242376339278678;0.99072537795519077797;3.5382953397613619018;1.6975222071264099988;-2.0920766349043500298;2.5666553314315798673;1.5266748395594729182;4.7582587418346458108;-3.1352094366997795838;2.6576932836464961518;4.8505904933059760253;-2.059135291663485301;6.5571041646221814858;0.83157316932654179453;-1.6403057747022871116;6.1557531884223699592;-2.6526234711106426722];
LW2_1 = [0.084292711202007569726 1.1179544825216289894 -0.31693970841686075479 0.64105449412364223782 -0.3096859662575691674 -0.25229691052449615407 0.71970216316495838615 -0.36973835667622073631 -0.098847078016617018204 0.14896319547166081421 0.27994666326033113002 0.14958146424355589499 0.52057909091196485907 1.3450251438836726692 -0.25607638885549666163 0.40182665017898938631 -0.15273012583028219846 0.1546646877641747464 1.5410184799537305356 -0.26020531465829294104;0.46935447452561890325 0.78999634112198902081 -0.032050957308584759886 -0.98210587891275658023 -0.97989383494781756578 0.67123439952183372448 -0.58337809341643120931 -0.28724414658130931199 -0.22480613934768467477 -0.052596084791479438825 -0.53641038525141770954 -0.20432293245761762313 1.0268845405276434413 2.4728979485983448861 0.18405525610849801654 1.2286108749022328634 0.51362540767666975405 1.1280967601367402064 2.0724950391609282541 -0.14164043004834900308;3.5462700349624309837 -0.58230652294713203254 -0.3518973514855605611 0.95313188381023628004 -4.9104176134379144969 1.7908077731781018027 0.25762781953574759308 -2.3476766395182884217 -1.1341286701713124696 -2.5583012453944848907 -0.61028322568558046601 0.8485166209999173148 -1.8898158519422367796 0.37851248087507016749 1.194158204766435194 1.45766018752972637 2.250833741278241984 -0.58585673100520940793 1.8958405237829514256 -0.90018069521401677946;0.37265447992182298975 -1.4390548215550145184 -0.051787041826001606326 0.94270122785355914274 3.161499954267366963 0.31327140801477426635 0.97366957351945893073 -2.4606254598414674106 0.30290041800311079401 2.473484026113704104 2.0377324586015790331 0.087036874738746536351 5.0050201164534993126 2.7146610619339153203 -2.9740980329882029665 7.2265530962111768076 -2.2363372051689229814 8.7727547830276293439 1.8455717370975075475 -0.93358016703607682452;-0.9226110078466442932 -1.9813135743300660518 -0.94621800645518350237 -0.22030082978391493653 0.078766257845839890428 -0.23436318311481757481 -0.95981770659972864834 2.352343732098129081 0.67701574639875816697 1.0618066358996340881 0.071175863358027363637 0.3950719949500702266 1.7266443311441761477 1.1857560680896210847 -0.2596211251859903979 1.8778888848794688116 -1.0009736189114819549 1.4468679257619803113 0.30847530062043188037 0.38554863923167825845;0.0038805386105683734206 -2.3904708482731162889 -1.0008577085049668032 0.73315515137640985266 0.28911538947142778611 0.046108333055572867099 -0.63460396081217262942 -0.21905736877523684925 0.14147340295025176427 1.2722260400960883064 0.56274181769151587762 0.060674254705901244089 1.5676829766197948324 1.7492997679175721348 2.4196545559258000324 0.94931844090042760698 -0.23557452778033508012 -3.8704362897061956872 0.22723309871028468665 -0.32616556932249801681;0.29320240011508003075 -1.8132817276214212576 -0.20976714583818517612 1.0613206992408337204 1.3089930917035468294 0.14958542121465151498 0.65381751349474126478 0.21616981454011410801 1.1170618647564591885 2.0137727094334265665 0.31627284936806809856 -0.020755840977824780574 0.022520168655485943432 0.62094424859768970748 -0.010667544295665173926 1.3345918293351286543 -0.72207505087385615017 1.3864727030499446325 0.18194160584478163978 0.17665253420235932369;-1.4077643892436590978 -2.2055417106339714195 0.38969271779526737376 -2.086789203517302127 3.3579341488367124846 -0.55639669021286142225 -1.848642496585274797 1.5178962785239120681 0.25935915227827732732 1.2788314609213498052 1.1303617878277159026 -0.1107596485713343154 -4.1130492998823378059 -7.8522883852634883795 -0.8816626761572190496 0.31027655011554777786 -0.70073395429575890958 1.433861556548695626 -5.0044460391176901481 0.1352452577332633743;2.5116077259978948355 2.0412351732412128413 -0.55498811522722168998 -2.2479656431532273331 -1.2303547892816932841 2.4518841614264550444 -1.7216813015242333762 -4.2852398677057452758 -0.88419996167417036492 2.1911761840811108115 -3.2884881382102628677 -2.8505330727272268909 -6.1596885321219589926 0.050040678370033779554 0.76248934727213280027 1.5737700872337059277 0.74077095885704147271 1.2546307578927824444 3.0617537361417332953 0.14225650444859477828;1.3321635618271752133 -0.9092704154036025388 0.29828837385997830633 0.73632455778958461057 -1.1148458970947281443 0.11860565215912535764 0.38271296886651634539 1.0094157383857469412 0.6365564437351646232 -0.17751638362600127841 -0.48291942986505875801 -0.26279126065078739494 0.7248057845057145343 2.2693968371432280406 0.9378533303255399689 -0.26661765617744442869 -0.13361558172106066666 0.29998841571542783635 1.1667060816115841781 0.14924017453403135014;1.7481427499358350719 1.2223274800017718267 -0.6002137504816514868 2.6136012387880040997 -3.7914137049322200745 0.54457176659990491618 2.3421258567414842133 -0.92335383354325362149 -0.27694913983918756362 -0.43992051790016833968 -1.7023890843894946556 0.23450467193675694766 4.5782243000155684598 8.2052036130972130223 1.2386513983128342176 2.2437462420010207964 0.35625234136484806857 -1.3209767163734962292 5.0411597354033546026 -0.046487162517058193412;-0.55297036308111269243 -1.5090218704800109073 -0.58497145832877184279 -1.2756181959836638828 -0.17764150733253467052 1.164366673991657164 -0.70577641328469231663 -1.2298988936249579673 0.29307785422601573266 -1.5247407880797150259 0.32727259939413405609 0.42636235124966875842 0.2665705391729972229 -2.6498240448822123483 -0.36014164460503483856 -2.1943581321417129359 2.3848089438646158378 0.14384049175586924307 -2.8156259231113205388 -0.68992305752374005756;0.13492283141744806918 -0.010368614460639722502 0.006907737362974791448 1.2647091225113589186 1.2216919008283619874 -0.10947134362093520477 0.97965824518546817945 -0.40361367751429755302 0.80076881335655258898 1.845688263669496898 0.38471763496767591439 0.3930295572853024777 -0.53223376257960508529 -0.36161566472074596623 -0.20727414842860347743 1.1258571556727845486 -0.66677735269814208952 0.85744487094179744346 -0.55143744389784199456 0.18902774773584632428;1.4905289681175759586 0.32294411116221466429 1.0335464129196290095 -0.11892635094151486619 -0.30325267069011468957 0.30895270283547571211 0.31868977891042105099 0.6610285443661918503 -0.93982126155047263083 0.9401486927089114376 0.0066441575371035061295 0.522756716342544836 -0.3550907012156831466 -0.59638669460147952783 -0.38440301102473461992 1.075629148881044328 0.68318508034000513529 -0.86082720820797375971 0.11855280486644106941 -0.24145279174021039292;-1.2480330203955385393 7.1013473939906388566 0.25562449428762989978 0.44933664357385982857 0.6542239915010863438 -0.16973366358367583673 0.95565988567913795482 -2.7157836538552011518 0.15558064066162918815 -1.7617034565381020084 0.16170123812362793836 -0.94251561430883934456 -2.9260661936822436324 -5.1548064278984151443 1.0211267824702754403 -3.9168851351336244626 -0.69277014850879303776 -3.7724719644261885954 -4.1745774652965339513 0.16713691953895104536;3.5254281960181446109 1.2308617338820877496 0.18271669042101587599 -0.72071932301279406641 -1.285253710279537831 0.33376229308097737913 -1.2419108253974193712 0.46013723800785766294 0.34311434877451413294 -0.13691400532173392257 -0.72094565758181827775 -0.3911538711856972772 0.47345179610367615908 1.895793857402241489 0.60976350058860906422 0.94132312630181802504 -0.077814053554831189019 1.2180298915139828875 -0.22106798046799841506 0.33720606455744250862;1.3129711565283965768 -1.9935056339604433351 1.0245934875268101205 0.28844887853850653681 -1.069489674185766015 0.1477088497506159892 0.48181238157345790407 1.8782209905382603043 0.42296151518826907711 -1.2032380444495589522 -0.53737339688041152463 0.011036859985389760666 2.8613742811798075216 3.1520511736565777205 0.45328070349633181602 -0.70751711959546237374 0.25728047131783876589 0.17454104502319642278 1.6704668170140353212 -0.56092629816436401224;0.18797118043510013807 2.1339402271323177906 0.46550557711959328344 0.31423590356403452439 -0.13979816009292350687 0.13021391204706606048 0.99103666776718590814 -1.2867134443299697022 -0.21823232784442597731 -0.92007877847576280406 -0.24775055336610016243 -0.3888989281103176765 -1.2329687167096976541 -0.28161490849416137561 0.63023218393000990378 -2.1199709004048665761 0.36055890086155811813 -1.9112189389595828359 0.31883787703423088766 -0.20995252210928075365;-0.74833404242172563148 -2.9239294000365525505 0.93714761803886459379 -1.7388517331931794274 -0.064032348356657178834 -1.8325077910047298246 -1.579425612761953035 3.3642992765611121619 -0.29714126058502160488 3.8562644948551683122 -0.76496588453828817666 -0.5338963310710540533 0.29901533004446617658 1.6479365747890302174 -0.48087046214950351919 3.5886491587548396964 -1.0317905617225420212 2.7968730562760142355 0.79657101941377006504 0.99789601668013094837;-1.6558570121926616814 1.2839965731802862603 -0.63039432168375686416 -0.36122797603034539904 1.0341803799981317269 -0.089669852957201173771 0.54639224930293994742 -1.3439706635438468663 -0.53777526256191576781 0.63140064086814051691 0.27485572508080086118 0.20494319124333518212 -1.2469942826493329857 -1.8245223743681786566 -0.45933656919584592293 -0.41267176768031682554 -0.54807262911454435184 -1.2832778768301693617 -0.34228148400621011271 0.18114760123841094908];

% Layer 3
b3 = -1.6775025104837515411;
LW3_2 = [-1.8841528831571734415 1.4505287831421691536 0.1660771842563320555 0.17171586684039172321 1.7714593911957958738 0.95992607556944464786 -1.9866789757990463983 -0.70415717828776014375 -0.31754065644761370057 -1.4730234982575389768 -0.44206859887677418808 -0.24753118757790062987 1.9173415238522066861 -0.81403041359987782233 -0.40881550108848835334 -1.0862466096380176683 -0.8827358535376652604 3.0953685082521853467 3.0498544650566095093 -2.2544613004969575876];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
