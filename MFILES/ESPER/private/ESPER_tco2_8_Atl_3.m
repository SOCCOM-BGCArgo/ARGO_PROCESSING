function [Y,Xf,Af] = ESPER_tco2_8_Atl_3(X,~,~)
%ESPER_TCO2_8_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:56.
% 
% [Y] = ESPER_tco2_8_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.9321543968805588;-0.63149040087636665;-0.49229998076110326;1.9363553394532937;-2.2154715227311836;-1.8564699849438802;-1.1537444800731478;-1.399113013896859;-2.9680811209465263;2.5725134103826139;2.9741498596502245;1.032701877416528;0.20893249422394755;3.0145961434480428;-1.7380752291297779;-1.0169551809742086;0.40948769631556853;2.4439251517176186;2.4791526537150981;-0.19218296907927063;1.2056910603745326;-1.8729857668277252;-2.1020747256040586;0.68757131076309386;1.76994733606222];
IW1_1 = [0.062837885185706766 -0.3456410529279515 -0.10224896230354652 0.6600092995034057 4.1536509844424199 -0.58235447641521887;-0.049102431003558336 0.56521196029785215 -0.1097748586730479 0.41747007057193286 0.73540696508476799 0.90929437077659736;-1.3618495736032641 -1.0866457775733507 0.089744068260635232 -0.98771762642464012 2.3637568394801716 -1.5111078531684972;-0.2902551905969179 -0.79528357352872248 -1.104432800115797 -0.46262325432917228 -2.3059137825230764 0.2650564536038692;-0.0012594394300569443 -0.095009071615342902 -0.46812903777314741 -0.79939932784844636 1.2555317967163182 -0.24131775993033161;-0.086851122656947666 0.45633710689188706 0.93572589175377474 0.055467461899768145 2.9454383569261449 0.52624181887652521;0.059086797092816543 -0.014127264618528208 0.66029426328653984 -0.29514111842294793 -0.52144924794782554 -0.077831660226104021;-0.16028578400436616 -1.9787619630749602 -1.5935798403436323 0.61851915745672192 1.1506539257077966 -0.41845091582953897;0.65946332224800186 1.7861213381504915 -0.71166737886561948 0.60158352850590291 4.7412221549339915 -1.162661446641565;-0.35229633324999038 -0.069705626534801168 -0.081001645188255797 0.023167016182011203 -2.7683620499374775 0.37220644436617223;-0.22048204716830908 1.3654474352973849 2.020175266251842 0.058205103796711587 0.54373372204224335 -1.0807940519547077;-1.1929792352651554 -0.025828443060784467 -0.45161119922030496 0.40681226820026162 -0.3401460758074174 1.2474248482885291;0.27765633527206773 0.36785060722021812 0.0013377715165680355 -0.17792743689628246 -0.18481464059376751 0.073642794857776001;-0.15564559591290464 0.59466523717157505 1.011766719814142 0.52683533206925814 -3.4878424964238146 1.9435691768666128;-0.4049846034785482 0.072424510021631708 -0.14683594101340836 -1.2090674847081979 3.6841346662301815 0.71569249257385381;0.72886930839429309 -0.017014930393454693 -1.2608139217764098 -0.62850934419250881 2.0467411872793617 -0.10712117964647151;-1.3901272174405075 -0.41731243163322734 0.27851431071164823 0.30750831452117416 -2.5216932983731746 -0.85627771253133833;-0.251936594429852 -0.75060835161422568 -2.4721999880032248 1.291711242241278 -1.9802738454379007 -0.83557293010820288;-1.4286383726815737 -0.30924166103071216 -0.35583649995428229 0.45064539923392932 -2.7118141489544154 1.588017179943088;-2.9165547683698025 1.5444435759933728 0.060524602743721449 0.95194716310820315 -1.4359537103990334 2.9086680880080555;-0.044090137074970323 0.068299625590693747 0.41080755804681701 0.92741020644885597 0.3663715602442697 0.12689131272481236;1.0223439500163116 0.37643730319964808 -0.83436870222877357 -0.67813034940323302 6.675777773820303 2.6030262907638266;0.23913565194798175 0.5651828091044605 1.8339148610457485 -0.56630602456547152 2.1069102183483652 0.37507358711512917;0.7788690814652991 0.8599492749101334 -0.91567575687042124 0.081940061156293167 0.43887642595361148 0.11051755778212095;0.13888742514578056 0.20129557128619138 0.0029231257558047126 0.83632031179637678 -2.4856782342816888 0.23217179760977896];

% Layer 2
b2 = [6.2537972788542344;9.7594466807676454;-1.9305577290031661;-3.0591529912120805;-19.387262256806391;19.48393650838597;11.771124464822792;0.42129656657192593;-5.9312256122778777;-1.5067788921500007;-3.4036672283370573;2.772096777043092;1.6438295260501816;-8.6508127684191987;-15.429332744934227];
LW2_1 = [5.4090088189393022 1.8719777631226036 -6.5840242698072737 3.2756985020531011 0.42046211804460565 7.5868714843416933 4.6177645654015906 0.94143995094720634 1.1566953828425024 11.605287591293411 -1.6409608366789952 1.3119725844831731 -2.0219547312521895 -3.3225948434172738 -2.4457709366451637 -0.44977828733533448 -3.9041237478634478 -1.4379344162717305 0.88720794635136069 -2.004659320912062 -3.3954286238537907 -5.035310109188897 0.01605000382530947 6.6080953089201282 -8.5320168573005439;-8.7514656422154005 3.8412136668594008 1.7237702275626212 -2.0557285884661574 5.695661631743917 -1.0873665987054297 -13.454609635818271 0.08246352679863056 0.98108015417158778 3.3959791671014203 -6.2501345564030171 1.610127786156343 -2.5792205112708615 -2.4042004362673999 -11.114596086266438 -0.92632528373689493 -1.2591201934951783 -5.2978179043362266 -2.1878551814143949 9.4569564989180943 -0.27579858015353365 1.3418987978646622 -0.8337225818765972 -0.83314851591614203 -6.1721658091589147;-1.4014321536742236 -2.5774952411450731 -2.9508627962045781 5.2957192981988186 -9.2309898318926411 6.1721348065723243 3.6489142774038457 3.1099397592566929 2.2714949682057348 2.7020965612750776 -7.2767728572107861 1.6790073888549317 4.6260620217346782 0.05498366041209022 5.1716342928818388 6.2155398208787567 3.4052586889270833 -5.9472013821871785 -4.5906373723233074 -2.0276093626179845 0.17248413238867677 -3.3692226554084175 -6.9405540666714245 -2.6437658506141251 3.4419569980438518;2.9147013390672849 -2.9135573734326266 -0.22749875849406925 3.6821277358928728 1.4237594590048896 1.8941676665912497 0.53971919290601889 -1.2700836847018924 -0.61868307457882987 -1.1191662132127014 -0.70957846796638147 -2.416586275256829 4.193992153747585 -0.029766834891820491 1.2120166637069183 -1.8409623233051848 -2.9733114561138998 5.8134802047500971 3.8353088894935996 -0.70381550805611626 4.4487777300567943 -1.5120222138912383 5.9791995750850182 0.79260744223553703 0.062257017696514733;-4.8966940405643804 -18.445219611726511 5.3445970896628605 -1.9657658355547418 3.1643124563646938 -2.1197995557024805 -21.470483399337208 2.6681704484041799 -3.0475348678547012 -5.5208964246477805 -10.363679587773666 -6.8735794924015856 -0.57534407228717266 4.8199446110422377 0.80340609076740777 -6.2372411977897277 -4.2228410921784603 5.7383075142954239 10.945858607734918 0.35114395362548301 -3.1098486624511592 -1.0689292076634029 12.851862132069563 5.3068791982251575 -1.2357603546988443;-2.1875614953270892 6.5124281881198316 2.1122663566525728 0.8706021030413853 9.0610026917060242 -0.2315893809011304 13.425039474852307 -0.23060890848339197 4.8110600382528332 13.742360527713753 4.1275582653963756 0.9087459694150456 4.8512983253953221 2.4234944547779333 -8.1566883287905956 5.0711392634071224 -4.3951712806649317 -1.9778277854604409 -2.4157939351216293 1.7237366846943065 -2.616289325928383 -0.21998045746371603 -0.75555111276660147 -7.3928599740824472 1.0058158843565821;0.079334870982640332 13.522008664939248 -2.0194725375424238 0.88249035202119452 8.6673062582906244 -7.3803122604556304 9.8786499880511354 3.6607951251790229 3.5747973398094022 1.7880059945069811 2.1724790824819502 -7.2296250750153428 -10.29506694998404 -4.1216529776474919 8.883675471852607 -8.6807163154912246 -4.9552241475603394 -5.1178194810414421 5.3896534462933081 -3.2764289038987275 12.829640858315043 0.10849487719053111 0.11629160889554965 2.374454563037689 11.159037123869942;0.43628015926735458 0.48870918098355332 -1.9526099050687835 -8.6235433170140059 7.507621293323969 -0.90210169652020389 0.58885402921844321 -2.7629970618635644 -6.2723253913672217 3.1976285379441922 -4.1664911654482903 -12.042486247883179 -9.4726344722497355 -2.688725232433653 8.6955333993936144 -3.5543828206146486 -4.3835929975881767 -8.0338658324381989 9.8615761521120575 -2.9848836183590706 8.5401145703006289 -5.9720329330840674 -13.942702184056666 9.6849804743325993 4.3590685012819135;1.0334911278193697 -2.4097185664647331 1.464854719508935 -0.95624588815559686 0.81835055134443302 -4.2073816526161369 -0.61752101720071206 -3.3038137883663623 -1.192732863929977 -2.3834291198632442 -4.7975655580725629 -9.5780858189730278 1.1392326840506275 3.6425579084737754 7.5297390306399565 -0.5478899341525364 -4.8345507094726221 2.0805775392021117 6.3616021406171983 2.9876301267587766 1.2617471708894687 0.21711453876683351 1.9568297796630056 -1.5572261396898948 -6.6208459678108325;5.3091423035575023 -1.5032350196019659 0.17575063129585911 3.8543599079572832 -4.4844818468211836 2.0309637678109591 3.5593931877318705 -1.2614811080348494 -0.624023586371523 0.1234890145139888 -0.14669137424276638 -2.1806624130057677 5.8103631406456007 -0.73261883942910755 1.4546659924303271 -2.4553665440047432 -3.4798260921703856 5.5385364346240511 4.2095143949289682 -0.54379877625426898 -1.7182034887174418 -1.4277193092929499 5.5321322492301546 1.1057626661578488 -0.98495753465161118;9.9650527212323912 4.9917906497350035 1.5030282795810286 -9.7098023997379794 7.7640256652259767 3.885122074470734 3.1983061825591332 2.3527461786741615 -0.43069363669530997 3.1013189408089419 8.8629729019344552 -8.5681895161313228 7.1401444247985779 -2.0279469300065518 -0.2273639679403005 1.333939841682199 3.9139462105267007 1.2725573285414045 8.754350185576337 -4.332754842871088 -0.75138515839286379 2.6352875660354784 -5.6633840482193802 -3.304463809212741 -0.083965808013000257;3.6361765885202377 -10.754528281952242 4.0320886083037628 8.1821388854975634 -1.5652634311615001 8.5735216729663932 4.8123693568954868 5.4511391586312632 8.6333154129046825 -4.4457133620669378 -0.16243650431330564 -10.717287756673437 2.0354509469425062 1.6839959535164684 -2.700680452653653 3.4244034762554039 -8.0373473312838577 8.5316393122672256 0.64991180935803439 0.40563264499547885 1.7618328801287908 1.7779427047440468 -3.2395540318637188 -5.9176383779982045 -1.3059775504303828;7.6136401101146767 0.53729095552157091 -7.2654764690658284 4.555743878617009 -0.9648228650633961 -0.58376675943210132 6.8636651149885504 -6.1400685052041197 -1.9480823860905618 0.44863402860359708 0.025818014253709772 0.34752653638778358 -0.21285575957611089 -8.7996933717497168 -4.1885228527594025 1.0404752760938649 3.9903676700840318 -4.0879627963548266 2.4284321709196521 -3.1521664749930678 -5.5418286567691526 8.2817964779951758 -1.4282317587140343 0.6659439014178673 -10.770145395053984;4.5086681329447487 -20.632882215461443 -5.3406327589309086 4.2223550091729729 -8.5559335173442648 0.34244483286475974 -2.9043715312517113 -1.0346114375737485 -0.32499986736792119 -9.6017399495843403 -7.6934430356662586 5.415980858286443 5.5331627160117547 7.9663699048175634 2.1948578829909784 0.17540519853459655 -3.3050533067019812 0.15806694447456521 -3.3325270609466688 -1.8803923957485249 -1.7155525536970608 -3.0084461527052877 -2.1790209017848587 -2.3228879830357294 -1.9570473453729915;-2.0986965962581441 13.824049201140621 1.666225683166874 -4.9564207064509658 -8.9376823454536183 2.3028919291301362 -13.631284952258307 3.8452282488476746 5.1034708574084595 1.0154696337701301 4.9335244960920752 0.35588126364897554 6.6329030890366711 5.5871534255386877 8.6083487131049932 -3.7177935104585305 -2.7283735023213138 0.43332860838012788 -1.2944878038648702 -3.8053616048435579 4.2494715892833783 0.76623207670812321 -1.456198250195045 -1.0010959255938108 2.6236858581777391];

% Layer 3
b3 = 0.62309666940002817;
LW3_2 = [0.034520674426012997 -0.030099398031063779 -0.021533158229197803 0.69509348066586918 -0.017062737514626825 -0.0068254545096289778 0.027482797181459968 -0.013568657958957788 0.018959928681061441 -0.65723988426804902 0.021791189822290256 0.0070199378262166025 0.0042887435693114533 -0.039039713361749544 -0.0046104907041229753];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
