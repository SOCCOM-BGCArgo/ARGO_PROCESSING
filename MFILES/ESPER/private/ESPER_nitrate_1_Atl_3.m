function [Y,Xf,Af] = ESPER_nitrate_1_Atl_3(X,~,~)
%ESPER_NITRATE_1_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:32.
% 
% [Y] = ESPER_nitrate_1_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.03;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.604229607250755;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.3912019675200104629;-1.0252566627434300806;-4.2069410052211706486;4.5612093013120356133;0.82943325488440877713;-3.1263843478908417417;-3.1187474768806344727;2.0592936768640663914;0.80883051605390665628;-2.0797243167297909672;0.5814342761240955948;-0.8311478739017664763;-1.96439561400104723;0.25801745007327958614;-1.8851476821791519622;0.71742063622526208722;0.11360786758092022986;0.37635913827465428128;-0.73182922469529787524;-2.3408593802581321164;-0.87756080779048295515;-3.1110278040858765358;2.7945247418457110911;-3.0357878327404579366;0.35237067566320540157];
IW1_1 = [-2.1799368924321749219 -1.9542985463225812648 0.046201895603922564504 1.9745222449308150736 -0.4808824969634042934 2.4189630914988242694 -1.107160260505866578 0.9071407410751965994 -1.8852690911135623342;0.25269975695827590068 -2.9995233815547055478 1.5624042942111673327 0.76635341027762038379 -0.65447872885467295312 2.1278275585527026692 0.4826833252780616812 0.11751338086910749492 -1.9917854663158656159;0.55435548345817409199 0.42235576816883357854 0.34412724951903372883 -0.91359191444152787476 -0.034336743039600617355 -0.04342647823591366113 -2.2090822463256638564 1.1707898279239286055 -1.0490390527669419818;-0.3983726344345613346 0.090751460093252148131 -0.11904295515605484157 -0.11104116759005266957 -3.7013352886733117408 1.6230716329948222665 -0.42536035905779601141 -0.046914673611328547298 0.90131192821677708071;-0.070202460738018293562 -0.038388374044926287798 0.53274251568393293788 -0.27062517201106545128 -0.95455132288704624965 -0.22186155728310122393 1.0020952567416241408 1.0729208370535763262 -0.45193539141926919456;-0.37427435227836730602 -0.097231308383664699635 0.43214666227981685109 -0.40425715890898350491 3.5853857319170523432 -1.2981498222933010034 0.7787247031445625467 1.1479083233538056597 0.36339671232107101373;-0.28899239832570100539 0.27449962777943115455 3.2442849573633427696 -0.73474781154742407896 0.35518229254324518163 0.069670488446024539386 -0.12742091376694456017 1.1549911481844177263 -1.7143040519354297846;-0.56965504196722405172 -0.054280918844947449731 -0.023840510194738127187 -0.10659306138155584531 0.38213808053954184674 1.7979519654745010904 0.075151287596610549802 -0.62918883854878226991 0.44857867904717679819;1.1574177409233921132 -0.50587314601401545122 -0.62022229106871706872 0.78285276091295752376 -0.057874315387451573389 1.2578748866374682702 1.7243570834465287156 -1.0157490735973462304 0.29467849506778881485;-0.5989681460093114751 -0.18761636191356675929 -0.48621334572481972325 0.41887442043285710858 3.7552439131010153517 0.86906617746238912225 0.47340738676597515777 -2.6162872422869378752 0.059940973434686899146;-0.2874135211171323645 -0.45101217894313394563 2.3915782104879257375 -0.26001276275600571086 -5.2635744220745861455 -0.23525646361595151101 -1.9017289104067758299 1.8609114439153400244 -0.29231748474413532524;0.90076567370087468056 -0.18479030734437085215 -0.43056728652643255773 1.4138839976036512436 1.930333435075515025 -1.1873825295333551022 -1.8747735282282442792 0.93502152267787752571 1.1690131190998751531;0.20888581059818947527 0.1243075333202153937 -0.49917527507760806049 -0.72474535164881037641 -3.121365941240930475 0.47047315653989735251 -0.63456939868772332947 -2.1244381080738339307 -2.6474334352193560349;0.30483710297752297791 -0.25457795765004226363 0.012066449615145392882 0.87804360316568041966 2.2577081943085941518 -0.21600343444010752791 0.63645961476014401015 0.32214115919340652328 0.30835861754305349258;-1.0967124799901517562 -0.36066837927547518161 0.19105972799405510076 -1.2256389674908194642 0.20559373979035072688 1.0782309514930346062 -0.1102503891883504783 -0.31548269007810320064 -2.658601846843192007;-0.25214275301066590984 -1.2220730275233047113 -1.6038193738972299496 0.52231000791725945565 -1.2989483445227065772 0.15721456506284733901 1.2473729037753520377 -1.6222261823854764451 0.87960442159417207009;0.54478845572609890802 -0.97499606818999717817 1.4077667549524459645 1.560134173253451717 -0.10067491882432251515 -1.4716809414719214111 1.3799105188135361022 1.9638602565503997521 -0.77918860480285956349;0.44712404924583942778 -0.21948882881892520236 -0.1329057062744052331 0.69748668146552084135 1.0728591664685822593 0.070662755189660808597 -0.8426184828563774154 -0.36952115899345644445 0.44808358627469901947;0.027547571424717007954 -0.41902971926207821518 1.7582374377910154895 -0.63795333766141171239 -2.7931572269114011142 -1.3469911334051176688 -1.2265224193869712632 -1.2803639981421051086 0.29526002077357965669;-0.26785202202557106821 -1.3125366863614462698 -1.2681442337580628443 0.41517297988216317339 2.5164818193229776533 -0.2650162593888638618 0.066151611774682178568 -1.0302851653157809597 1.3631723628565648454;-0.34793691140704618991 -1.057616562171680874 0.3956217667749121758 -0.56364199902406131315 -2.2088910366985379241 -0.75608717882810005939 0.17853402433446402542 -1.1115212534930398736 0.027955482948360189238;1.6757681478009442966 -1.022742193646851927 0.72090903637633629852 0.62696601330594536883 -1.6789602201626068201 1.3772545613381126373 2.7020459288158829025 -1.0840885204159318445 -1.7483390670116085719;-0.19391148109804931532 -0.39851460375809499848 -0.48767438350339409325 1.5028756086935528558 1.3665922880551439889 -0.53269422781539121914 0.68572927882863365934 -0.0066614957177057289653 1.9263249351750730831;-0.56356407407095354678 -0.36409107341995633478 1.7928524236067941988 -0.95590377812497251409 -1.0150613062942508424 -1.7372904829333342125 -0.52846096989281798884 -0.48000449795652894158 0.2068441831847947221;1.1861734377476449431 0.94121512244391247748 0.39448648300343625017 0.65953958737861351214 3.0105445562935750914 0.32057171910125159542 -0.14923664971945213575 0.30222809862580568563 0.11097727735871637522];

% Layer 2
b2 = [-1.9593465206666400569;-0.66589157402872167779;-3.4440760260140401705;-1.3743825645658709345;1.0423312959155424107;-0.7236929334041387607;1.7267097683515406636;-1.1132860933836143946;-1.5114038153876392379;-0.40071054545389261925;-1.1427294586800016418;1.5956749121577369355;-1.1822643521137343736;-1.1030889243626142981;-0.72198340382814896188];
LW2_1 = [-0.1790798993057102495 0.22283842295578432102 -2.4791639708238224493 -1.1942530846745442741 -0.89555358237265658694 -0.0070046828592947958311 -0.36776284372283279955 -0.056378948828130853732 -1.0076100487373254033 -1.1010390465813202354 -0.23278158029463255629 0.7740742081729753421 -1.5440168743530771067 0.17895978780096216676 -0.20926527985190129799 0.38741853046161034424 0.070564034701848812881 -1.1263446060471815624 -0.17608156758541831932 0.24249598021109020074 -0.65904379409511215648 0.75878343620962862559 -0.98527157383341246177 0.8389101385573066727 -0.68294776353674890856;0.11793618745357864475 -0.0062822323619435840522 -0.091966550593931134516 -0.67165104542123799103 0.80518044800489363411 -0.70603760687181849054 -0.056140664756684929837 0.38642400873640481151 -0.22496171053489419367 -0.26359179600027837775 0.54836803570704584221 0.45897603781185875027 0.34212281734911093034 0.56681480197689737555 0.020816366730373608157 0.016525154885809831967 -0.12935120242211645136 -0.49443682050748688495 -0.6830313723534894299 0.29034865685910954403 0.67701434561117490585 -1.4314412999079169087 -0.30314801563939869355 0.91857451331538719774 0.42963135012727116102;0.11214155564981979907 0.062817433852595319643 -0.47265797886039295772 -0.92753171725449767848 -0.99852381096428000085 0.89041834888319526531 0.37693603245481754893 0.42539024930914998146 0.024969616429080562781 -0.084624978370268291727 -1.270425483956747037 0.30930511238126373597 -1.8933817591264630043 -2.5896295519634868754 0.067863148281573304477 -0.19401937406899222305 0.0051413885286807677749 1.6420850198782293017 -0.0026496924478057759002 -0.19996087797342815273 -1.947009419271342745 1.5370613846853247164 -0.093170722532100180846 -0.60702365081190112761 0.61909179441173356473;-0.00021190374814167669583 -0.049802853858516508978 -0.58982661719846984916 0.15982581553617727921 0.92487148302295407731 0.60564388947364489191 -0.35310435718912985825 -0.2421538790580878564 0.44167882904944183453 0.32911806116797182042 -0.42157814742059601665 0.19383391112214590213 -0.27996662721437642896 -0.73458668965300977227 0.2932883277985817716 0.11772791122229753213 -0.24170583689922237047 -0.19697832088124742067 0.52969504440217796137 0.10427906867152107739 -0.82444361516547748359 -0.31716672663368872254 -0.059052252357624297752 -1.1776197893788147297 0.011568263456596422634;-0.7391448089752988837 -0.12804637985786618271 0.64579492745052502478 0.72385942901627964297 0.0057277709715437656601 -0.65614438921837758834 0.90535427730726614204 -0.49172940546348703483 0.27740346712434121867 -0.36561851165164854782 0.0070584810583221050881 -0.34142006371876071347 -0.14624523910065098664 1.32841736540929789 0.15919145755791935803 -0.032631731869017362169 -0.27343224500769802709 -1.2501546986162956898 -0.56572887023992790567 0.29922901193101963946 1.8247322469033231407 -1.6093399426316636891 1.2427830582195626974 0.73875665873220497382 0.52427060082801335561;0.15457018587156298728 0.20098361395716057842 -0.011667599056826603171 0.4574961433689682111 -1.8636870525146846944 1.4203770116021152692 0.33902654425762446255 -0.14848897969291482979 -0.17904305176475057704 -0.59603156081145181044 -0.75640347598247703598 -0.38239341614509853029 -1.1681736228156636148 0.19457794858163024454 -0.13733917015774849135 0.5677789870737641742 -0.43789290584341161727 0.83967266702606147 0.46479589965640311089 -0.94302198432483896884 -1.1378274016144731551 -0.18497542812704712012 -0.26557051070494108735 0.46371499661389237179 -0.92600351258304869351;-0.13389138577908085703 -0.0044539797661449732555 1.3646212555911616526 -0.78691151080229571058 0.86339467804408198681 -1.5202255268833797519 -0.035219543646430880035 0.67373422402766336425 -0.014000014939640113842 0.44161334086390585663 0.71884503901109375601 0.2361547063022419457 0.97123605572381987994 0.42961902735552137678 -0.19827268191600369573 -0.0013310456104371794217 -0.24450187996558325754 -2.6922234257339878738 -0.23358907743395210255 0.35895167386703702439 1.1099522270287798253 -1.3635355432715261514 0.69185727907068494957 -0.24315680839004116809 1.2240696212167154755;0.11283845054712351996 0.23715016807862324133 -1.7946119753175506784 -0.27451022423949167361 -1.1577590334991476606 -0.084614500734780745406 0.1049609766760240398 -1.0174342020518380991 -0.49327402787612650847 -1.394043075534469267 -0.64654243952034295972 1.0142543454440613448 -0.93306378128165412544 1.671577710269687822 0.11352483821609905823 0.27671940777994835647 -0.43530324369215472879 -2.0115898533274987336 -0.2615664414945428895 0.337184573715977709 -0.84986472247868483088 1.3614950318373317817 -0.85565348272223640258 0.44027381111604596553 -0.62746044390380584233;0.063889776879769932805 -0.086045111045636238356 -0.51799529901022389744 0.44352978208460447362 -0.96477287888034579666 1.433283535957603716 0.0084726636699480849246 -0.22895974070177108062 0.2975359039147866258 0.10792309755953391481 -0.64724859365375175813 0.00022798745355603259981 -0.44698483836265739955 -1.260349638955540863 0.42895006897462772955 -0.27141203653976941901 0.28369036745779430131 1.9492100884139853534 1.159303396632727079 -0.039106271475013422434 -1.2155117888467750209 -0.011649898979257698045 0.03079590276559882045 -0.69162532883329352895 -0.89775176154813574048;-0.3013018863362516564 0.014089222755725787709 0.8778433441497510703 -1.1333706119279987057 0.1150128511870259912 -1.855963368116342771 0.62493429023171298553 0.3732699136437043208 -0.40973310142213981155 0.35069693668450285795 0.56127861409533374992 -0.22038737208655012623 1.2720841168979142299 0.68991158813350073054 0.0078514116648526807024 -1.4267495744937821467 0.52902722508750443797 -3.001537438129818991 -0.54919005928941055927 1.0606965240861152555 1.8374138172346832221 -1.5358526374903875844 -0.024070376936320393713 -1.51276994923694863 1.3672839926306390446;-0.82468145969106898541 -0.16876305539170816106 0.33017367002641739848 -0.96564065062218018554 -1.6727869300573190436 0.47320948705451304495 -0.76701833577976186174 2.6193153790171090911 0.88356032649034510484 -1.0620129350774853982 -0.32297348496253203143 -0.55968894006082314796 -0.42990146405145346353 0.52009850221979125884 -1.1640809954319228936 -1.1055698841827856782 -0.014957841260154959573 0.29206976882478946633 0.76219554075659057268 0.43954197052182097938 -0.047298406011909058244 0.23617972563845035516 0.90442173503773881649 2.8099257383107012487 0.21151302883780490061;-0.30900577648456234447 -0.073153590483781449905 0.33242933593701923245 0.67639421369876551182 3.2945814640026513942 0.30042446905244379884 -1.7514206333254502823 -0.2562842823901993472 0.9025017152449874569 0.25102395744239602848 -0.91937661617646537771 0.44729762164853192896 1.4715752522350689091 -1.2766763323889789294 0.64535895111236774024 -1.6479586342815151223 -0.22585923848646505263 1.4678381522523917813 -0.47577539866887752495 -0.73862448176626660512 0.70043712192518259307 -0.020407534080241658547 -0.23609382468981968128 -1.0622333279005060636 0.59962170989633978291;-0.87238199468851174156 0.36155371702697375325 -0.056644299299243736079 -0.39734341117100285823 0.41240108454821539086 0.11779880352664454102 -0.55018006030127930561 -0.10048437501888174417 -0.25739099719040148262 0.71583900473785888607 0.20567114488657661786 0.74073678875417847678 1.0663706321394885723 -1.4584327726792922775 0.54324070286917558459 -1.1185897055409612655 0.43021014965566262145 -1.2539814534108932875 -0.065889052843489323563 0.50188096916238800205 -1.0826551769984393836 -0.11031701843564097054 -0.56993395388684164882 -1.8832093239246121552 0.2446017171555243952;-0.16207349429963904819 0.060162054998760962354 -0.75370927767685202969 -0.075039941404188501006 -0.90633891677458278124 1.1968508084424047677 0.38138648424515786406 -0.23363154513302963888 0.38973988262373604474 -0.14540562720569435995 -1.1504245608467267292 0.62936895345576693295 -0.67302625500662216496 -1.6376534622766230065 0.72210030318643281255 -1.0116199041863100927 0.075047153216965464817 0.60483040592521630785 1.2415880306103026509 0.74069199329790547104 -1.3669482259944680802 -0.11641116965913053671 -0.44289478115181957207 -0.54533802231738470745 -0.58682419522442497151;-0.42787693149588879038 -0.17538265116396875576 -0.63555272376524696298 -0.66690356123427663171 0.21437084968830794063 0.45455978625406445737 0.13728473006028085734 1.1158361706051422857 -0.04551611347656213391 -0.13699208127608991648 -0.039471649461865154773 0.50787114020139667581 -0.72349883343605980723 0.50338355827690950406 0.025158151362186076394 0.31680246978250475864 -0.50867066193596066626 -0.64941632373945124002 0.11377284166407078403 0.050923243058460715416 0.99447639249854691279 0.27683971081368796696 -0.20564846146574200514 -0.94127325581551291034 0.88674502879428263036];

% Layer 3
b3 = 0.46078278274673617476;
LW3_2 = [-0.81952676702855054014 -1.5046623293377845432 -0.61573279670397940144 -0.93729991106725429884 -0.63032730168536121873 -0.76072341943656685004 -1.1119683257618586669 0.72117092315428366067 -1.5315378139034572236 -0.41715318731844569511 -0.24642602612801886575 -0.74194558558331991094 -0.3599883099163022071 0.78880335479753549421 0.80265889598138351335];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
