function [Y,Xf,Af] = ESPER_tco2_13_Other_4(X,~,~)
%ESPER_TCO2_13_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:59.
% 
% [Y] = ESPER_tco2_13_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-1;-0.999998793562952;-77.961;0;29.715;-0.9;-133.803853032615];
x1_step1.gain = [1.00000000274156;1.00000063368067;0.0138606862425759;0.0002963841138115;0.248478071810163;0.0419287211740042;0.00432440760873659];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.3598908621519454;2.0030422855819152;2.4746974765157552;-2.402667744474277;-1.4452109453256847;-3.4299587151672708;0.62123143236941591;1.7739154586487971;-0.037645881767912531;-0.88701795389918892;-3.2232021768147923;0.58741472890590762;-2.1006361082704479;-0.66116322574044939;-0.083310178498009632;0.69518729500388532;0.39031369129357002;-3.5591562387540154;-0.73906812718868165;-0.24329750434661529;4.7974002317216273;-2.9049026190180052;-0.96758327349556361;3.4534642995267593;-3.1995772734745191;-0.047191050489901062;0.069832084652091439;8.8747709768106002;1.4762340758679897;0.66385563921186652];
IW1_1 = [-1.4243922799249955 -2.2452650341605107 -1.047096169614866 0.77430822060981297 0.48173845900310369 0.49361185288809817 1.4341924344712642;0.99402299937142569 0.48592240041571633 3.3339520759472667 1.7525542482374492 -0.8991450605099135 0.45520699257353442 1.0898577180264046;-0.56942595022115383 -0.072193793086698779 3.3171015227596397 0.46697502136637342 0.7804504550457958 -0.11622495565519655 -0.37438816575713879;1.4671604480410543 0.90256718636142497 -1.9346874677424615 -0.013625871108095209 -0.14348610701237979 -1.7379665466817502 3.7435684275568315;1.8751616434810501 -0.51253162652955064 -1.5512175306048586 -1.661385403074042 0.94979009161168981 -1.2552766680409455 1.0474300938737635;-0.0085357336733019838 0.094135862346715518 0.20753295873904692 -1.4561361417293488 0.56424237450560244 -0.51703231924106363 -0.019051958151871003;0.33737700062450271 0.070785759002640392 1.0002042169594438 -0.13799677910991384 0.3855174089054198 1.1256831248577825 -0.25494677902258511;-1.4826496404766869 -0.59619469139521508 0.5595826048259096 0.15502595281603759 -1.4270513996845138 1.9136127286105096 -2.518680794584752;1.7057812754822583 -0.1805393706100055 2.6867267694995776 -1.1668018412550991 2.1807222425888599 2.1608490090986243 -2.5901619618951339;-0.40329199685879741 0.6840881215026412 -0.98040305307572462 -1.2130103301520214 -0.27103570347744199 -0.43105684158120078 0.0602676825111488;2.2733958092046236 -1.0315400328123923 7.5308215053159211 -1.0631818923166221 -0.33298902374209549 1.3815289178444219 -2.4068484541773314;0.27806037117602461 1.8698175800343462 -0.83921492540091336 -0.18075418791908263 -1.6924800776286704 -0.74864703835649626 -0.031759007477365347;-0.024070066588036218 -0.17737904757848572 0.27393040387490208 -1.9673363391388161 -0.30219129243916965 -0.71895925354831314 -0.47591162254553387;-0.41746595009376403 -0.08443290377849294 -1.0691752989779828 -0.55605221374925273 0.77461783832971509 -0.32072718560203034 -0.19670605338505776;-1.636328478399363 1.6841700742237498 2.793836189945142 0.64130336776932728 -1.2157711266319879 0.28311867883002673 3.220972101328746;-0.17870601900480082 1.0149742942239997 -0.53115650727976649 -0.30136736990108715 -3.0354277776484051 -0.066623751920667468 -0.79009299405814892;-0.011935564977924995 0.025577076128403941 -0.87615068696296683 0.89109099392599733 -1.2952361454369448 0.66644723480479251 -2.2338854815196525;0.2327391678615055 0.65466141334136563 -2.5920704332289155 -3.6221475226605104 5.6832676715796602 0.23124422926420624 0.19702960079562348;-0.13503244449084392 -0.13998802163161844 -0.7683681114043911 -0.092626554869639235 -0.10861340120429523 -0.56509742465441981 -0.17737106374585887;-2.0098339835655286 0.28101910343754022 -2.904802082488978 1.0783785883458297 -1.2140541429828138 -2.5530600614318946 2.4978226068996943;0.3402947587387708 -0.2262019703140786 -0.82502192759381276 3.5557320791000637 7.5477495202044391 6.1828480533142516 -0.4296153126905442;-0.13291210880302159 -0.75578119761411888 -0.097744178482894781 0.3393140517935172 1.3905957840504737 -1.6827260428641291 2.4003183975985123;-0.29920757389061303 1.3091472110483775 -0.73361655062430364 0.60995663547047652 -2.706903921027199 1.2502871489338661 -0.36646003738513055;2.6987233211095827 1.6329096542330312 -3.649978026571755 3.4293495226588657 -0.41692239477989068 -1.8684276096443322 -2.8829464059290135;-0.0035020837179975057 -0.15029747782319353 0.51248169928778431 -3.1138310282556976 0.30834100231534856 -0.9467010643327507 -0.59107951799281211;-0.082814739534344511 0.25150094254115063 -0.63791405184073824 0.032818050881527464 0.73068064799365151 -0.21847152616500745 0.25398247771759053;0.090325448638620659 -0.32353328891669508 0.75280428272891353 -0.020026309422210332 -1.0111852571327911 0.26248769713295605 -0.23602097504108233;4.5845564797374099 1.8173945744605509 0.10506174507198492 0.42216411346747085 -1.9225332858791933 -1.3415426909529353 1.3812775379191482;2.2109769839561042 -0.71331096555505979 1.6019149555921197 -0.54533798839085024 3.2359503033396613 0.9153320042419264 -0.11385482324459142;0.1423790255551709 0.11464121590812541 0.73039908930184605 0.084109236007461202 0.14791754939127039 0.5689862696238096 0.10802624581072263];

% Layer 2
b2 = [-5.9372391838479048;-4.5904278987386027;-3.2179382278324851;-0.2831746706889941;2.7072929155068794;1.0413720464837635;-1.8245213254200763;2.4531903304387881;-6.4050897446695885;-0.78830890725565428];
LW2_1 = [4.3083494779614178 -1.1230961258495749 -1.4968218629078234 -2.8891805918658213 -4.1314649282421971 -8.6090700734793106 1.619947957061209 -11.966634463241864 -3.2115912571028815 4.2547473360183528 1.2926748850356837 2.9471504798870876 3.3478521895940814 3.1497575332465653 1.1339605228038361 -6.4078464685236831 2.8996085776628568 -3.1521793593173251 -2.1082712315668193 -3.7163558718680365 -3.0946562237074016 0.6915819913629333 -4.6173774665037479 2.3438667485128755 -0.22774536103713297 9.5758374073118926 0.51850872397872594 -0.71939792610515529 6.5737238765890487 3.5447115101191531;-0.12793672685911414 5.7663282730542118 2.3988568679701183 3.4217687547173181 -2.6778013083169405 -6.9247162436755172 -4.6208833407435881 -0.83657132178186888 4.3411103402632181 1.6023328983264591 -6.0650225280992052 -4.2245104424687296 0.62757666659078826 7.5263505711801759 0.16196291556845549 3.8446621776273386 0.77013938166327423 -1.4465486737165942 3.6062051536290216 2.2663657675643778 3.6133811314714337 -4.9512836433280025 4.4695764246414615 1.4553062633878657 -1.3124096748465879 -7.6648605433585155 -2.2303262660470549 2.0326665571084734 -4.9940389229608027 -9.188887004083508;-5.0369671015194655 3.2639951798708928 -6.8811417369444232 0.089848558134079839 1.0451992286860887 -1.9887704757073985 -1.7758384520265651 3.6595147227781863 1.334570202819219 -0.85677925115111386 -3.2643027710299353 3.3225069195368624 3.6331277646580689 2.0718916568509904 -5.5490279013125425 0.039266174676448586 -5.8113918729094216 -3.28297706245481 0.17783814021654784 0.46696912192052398 0.68024837484350698 1.1041717706495107 -1.287436058044549 1.231548020946611 -0.74895392346245115 -0.76743105356492103 7.3602301144602054 -3.7955479358294748 -0.4231610654309364 -2.9413971572786735;0.34930753827201017 0.27486742605011039 -0.76273714863351783 -0.48913520787343784 -0.28622365901357244 -4.213350648140314 -2.9515223311648588 -0.65519345332914591 -0.59203010240528864 0.0010649397508852093 0.050473862356730431 0.20998696308019041 3.5321503061168933 1.6896054889011245 -0.13715488580983465 -0.34400706070195403 0.35107960880928851 0.12989295231113079 -0.90708583946575805 -0.60923845030990775 0.0094972899013231801 0.50527272578985438 -0.18570299199253482 0.034624752236278124 -1.9592825310419359 1.8199292541148859 1.2241491002520863 -4.2095736395804142 0.4604141806378359 6.1533379076830306;3.4240976070474418 -1.1037411773372299 2.9059204787030577 -2.1952399787015993 1.8055851029333863 1.6305155260139053 -6.6222819511550801 -3.1254165641501506 -0.36098997929901561 4.7638294163497932 -3.2267172294477064 0.78771364868733973 -2.1435650284982652 3.2337380852132012 -0.11417949657568065 -0.27979407614590462 -0.37302882376236718 -0.80159959368322564 -4.9274911354552282 -2.6089240443036381 -2.3226300872235202 2.3060628691154945 -0.87615178466321941 -1.0879182345219942 -0.055782741564246389 -3.5582909441881827 2.9467960038502392 -4.4619519731110735 -0.9169125642911895 1.1699178890047812;0.15372365011686059 0.65773572239062672 0.30495910632444168 -0.54121995389847555 0.7134914824990034 2.4118865389178148 -0.27901268525111134 -0.1780946996908303 1.1435744401963432 -1.1664550388680694 1.0512547850562211 0.15292336472313142 -1.4032818985540172 3.0472151730049766 -0.056992854090756023 0.059882632523045251 0.61956920090964263 0.49007160521797516 -0.67080259168666057 1.225380510437845 -0.083296459412945945 -2.2237704550500657 0.84776517690921183 -0.35915874189837621 1.05644577448726 -0.59694422387296253 1.0360094679021878 -2.5588612055484856 -0.24246009894684994 4.0692861159992271;0.43660580054943443 0.28590601947951139 -0.88629793100564735 -0.55421541632735194 -0.32265402820176853 -2.6017081589531501 -3.3355893559051371 -0.7734720914553922 -0.74050177301634879 0.045501204947302393 -0.024340615609702826 0.20615231647705887 4.0063933759017543 1.77369269634489 -0.14988399650454345 -0.36129630967934356 0.44211916647664279 0.13278396133981102 -4.6432797650172057 -0.75514699542059016 0.025518834800672345 0.25382419459550432 -0.1729392573140327 0.038337099362190818 -2.2893560593779494 -0.21799304386808768 -0.32752669059062722 -1.4755666485830095 0.54432012207902092 2.8932124436589981;0.99385252247756006 3.2858417541702964 0.92281797241742902 0.92518836360327494 0.6817931413596483 0.29780823045228966 -5.6408316510469341 2.0037342963324489 5.2540277999677629 4.8477551878216252 4.8219120698551619 2.9852649566127916 -5.3224241889735993 0.022297441172566587 3.4496963602545359 -3.1230363798521088 2.4441414611324359 -0.24819826873223863 8.7564742543542078 2.0681679079721755 0.87426379352908679 5.5545715239180389 -4.8535004051288748 1.8689719044729731 -0.13860789801144047 -3.3459686513203661 -4.3415251674628834 0.30116749362084461 0.836434076569334 0.75489038986921697;-2.1928295582012547 0.71268429335295236 -2.1135906350905782 2.468911251653902 2.7888795947614606 0.19663324418384928 -2.3765227818040433 6.4936206781012027 2.3108944371447686 3.2453811156222412 1.0020916912642486 5.556769681923817 -8.2645587722339062 -5.2882927472281009 -5.0585285838440583 4.331600136096891 -0.60229286841947927 -7.871491357186736 -0.22100855614748055 5.362332025235971 1.7431918366148043 -2.9679670845532828 -6.3511052627911271 -2.295628861474214 -0.27748837610767119 1.1416662300625855 -12.493836729844739 -5.1296225325127791 6.6967654283907114 3.5000326950539198;-2.9941021959984018 -0.16534681705530774 -2.3063724458254189 2.0638009506257857 0.61318051950021024 -9.1645314044075548 5.7566074097027995 2.5296767666909687 -3.1697427757217018 0.20028974119896525 1.0851441017954029 1.5183555361414103 8.0311581555025455 -1.7910461142098688 1.0830197023197048 -4.599545579348252 1.3181065598795372 -0.74196521856910114 3.7304294996818812 -3.0193117396403757 -0.25478026484223021 -4.1298099521806195 2.1955380169867205 -2.2485516426570729 -4.3385022452655422 -2.647183768654032 -6.3236292655490614 -1.6369661428933673 -1.4115561724484542 -3.3942154933049555];

% Layer 3
b3 = 0.041915915215760498;
LW3_2 = [-0.016706949023593362 0.011470251778053393 -0.063249309922569372 3.0702688095465716 -0.027028149850161713 -0.16289232020413902 -2.6984705301191032 -0.022578125157431749 0.017166030926751535 0.030441503135013641];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00314743155299998;
y1_step1.xoffset = 1774.26765577007;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
