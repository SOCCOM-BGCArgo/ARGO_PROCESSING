function [Y,Xf,Af] = ESPER_pH_5_Atl_1(X,~,~)
%ESPER_PH_5_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_5_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.2178;-101.945317545701];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0054210015363163];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.3928690557147684892;1.7219738534934070362;2.3952068068083476327;1.5296891495700557506;-2.0389217576227265383;2.0371910328565023818;-1.4069503143503963027;-0.86940832380680943547;0.13900285254791552858;0.8336749852438476438;-2.3757076311882334707;1.0491171867695787689;-1.6569557703232320467;1.7596346591600748877;-1.8132113148478643527;1.0870904824574942893;-1.4783834821187773478;-1.0351667178682624204;1.0123930301175414481;2.5806051231625435349;-0.61842443068192720634;-0.92292353340309751797;-0.86867620333679740341;1.3402266641661679802;-2.2816802488204417365;1.5963913356345655892;-0.86602868814230160588;-4.3488655006195156005;2.1431055571092416656;-0.24197079480412519992;-1.2239278728721385558;1.2909460639312047014;4.9333900384277180606;-0.30239706628034473956;-2.9959202536055600241;-2.0267019444616698465;3.0826976189324666322;1.2797539951370751066;-4.3824298300358375258;-1.7997149853338170189];
IW1_1 = [1.3068014957644702445 -1.4443157589585153833 1.9034705819075843358 -0.17994828396662365666 -1.9544030318278202696 -1.0526676969426957964 0.82314288676799640676 -1.1061511906489736035;0.40598623941196809728 -0.030931572104655864763 0.8351917668029978925 -0.33125307371925388766 1.0769271797265642654 2.1567014442766581084 -0.11625913487306545335 0.44102336893302646059;-0.23594965015980326473 0.3827361823379267225 2.1834287120274473715 -0.03923323737100608416 0.70946388605838239805 0.22040627166854317998 -0.41190628772294413107 0.18098326129903044568;-1.9592198546275314541 0.90360149462754546512 0.28979419279267221166 0.76599298799357828926 1.1120801009786791536 -0.69816680023942867539 -0.39662497694530751691 2.2473788573673103564;0.65071637375723168084 0.93266020414567274432 2.9872359196795308378 0.071651126685878169242 -1.4389131956509106924 0.88772063065452078146 -1.1376975967605356121 3.246366296989153355;0.6424801588549535758 2.2973309290829249107 0.72087821199463053556 -0.56193033989792151583 0.52249793677003664172 -1.2828800858996114442 -1.4964552619227482477 -0.067912341517724614248;0.76195132669706755468 -0.20985229843950697903 -0.22704206634324095027 0.174173538082736723 1.3987149327548558109 0.1372084943661511236 0.16998148559770620558 -0.255438829876758422;0.98553805337762911964 -1.1829061503548008449 -1.8569637627223460896 0.085912709475252271862 -2.1801170781957370792 0.17033850979818324078 0.09533745345454675002 0.12090053473413021889;-0.24942474057332850168 -1.0592417854260878229 -0.48611924868871125849 -1.0992389914343825286 -2.6062742728319525654 -0.49755294125518789716 -0.20172094938126380881 2.0312307411762620113;0.47997441087364206558 -0.95248649173447075267 0.56154601867849340824 1.8053957770880859623 3.1535259847823762236 1.3162403247683800434 0.76314283039490249383 1.512589234743096922;0.68189383253322688461 -1.6105088233934652386 0.66944534402409572316 0.013617185987081469045 -3.7496555330022318664 -2.3141576487184996047 -0.53254243744961526907 0.29358043315804160933;-0.79090565122770373208 0.65605331693067969745 0.62334560580683284758 0.15222558441093322901 1.2611730321343455063 0.19643261000491729629 1.2045256215336890282 -1.9130352662167036115;0.22747219492854059419 -1.5253632653963606902 -1.7139396046710777544 0.041565889293091920487 1.0978268208157755392 -0.78543125687695436454 0.23169594231652224092 1.1886325682923586378;-0.92864244204174450914 0.23458326262806941664 -0.046526658296172432316 -0.1930260636876695024 -0.74744544758092579251 0.53961696521381663505 0.24518866420851712085 -0.011308902776511380386;0.14250048730196407387 -0.80897078815060063928 -0.17899843991796166032 0.2200709352647526873 1.7200909252789355897 -0.81532694342536304877 0.065180908518225083581 0.26726430157144004385;0.70415117332677168438 0.6673450180998820036 0.67225301755190669528 -0.28591509523023855843 -0.73904612647582446083 0.36076179575810085609 0.26496047655858234737 -1.4526912447296205233;-0.26115766039149806987 1.7786578996188409096 0.78106235294068060426 1.2152636862060199885 2.8802787810587306971 -1.814411326058671392 -1.3441686492646427453 0.74764632422497157016;-0.28970095393017153418 -1.199166582138864845 -0.33773876397352747825 -1.237708224317421335 -1.4444539465790224853 -1.0884970653185226386 -0.56119701659429643836 2.8052707766043019078;0.087556454852390094845 -0.47594636872371098857 -0.77294868530275273599 -0.24527375957791294758 -1.5653290490348510389 0.022339455500695059448 0.025076163281418459988 -0.30269805413851386122;0.33667300916441961212 -0.61381348175419880864 -0.46635864390025466575 -0.45711831461329283099 -0.98486249421412641603 1.293226230644554331 0.72796708159424183826 0.33939226657638360551;-0.58415069743124048429 0.21521103364403368352 0.88784223268469009138 0.64006116043382998981 0.87007254336904205072 0.18050678184582186203 1.4048247761519787602 -1.2771855488732477557;0.029642971365513120369 -0.12914280061271349309 0.3042446518547390899 0.80073748709887326847 2.1177825640706484656 -0.12999355341278187592 0.55971225393694667982 -0.071140646872608737095;-0.52718121036935450263 -0.20625177894535251522 -0.22538056776061729525 0.17110499712219909285 1.1468481331784321497 -0.13305473867367362262 -0.053223840789872675638 0.85918513873463120412;-0.086965365646615513939 0.45070786470727475237 0.087445662527536813236 0.89952329341383252537 -1.2198281334298652911 -1.8886716855549772198 -0.18093535513864908437 -0.38307845285627467602;-0.48206538438633234067 -0.32359362005066838464 1.6603319563449130403 0.38991569907177026089 0.96068152681340990284 0.40822402275340002875 -0.9795778258409870709 0.30432325938667059706;1.0444341894834416884 -2.5165750764419385632 0.90867541496130699308 0.50138876989910252657 -0.52460657049454617606 -0.96752829960893094174 0.27178263258145390902 -1.4513956504539986536;0.52730059744914115072 0.15504067069041077565 0.30340588901921922149 -0.17665602486272194427 0.85147491077095938117 -0.45969201596398928666 -0.8553947507827437402 0.5771085369535026155;-0.75279845696471081595 -0.3963293724590469802 4.3950713940632679666 -0.51827319962643658702 -2.5233125303559997832 -3.179889780360672713 0.033385382383748746227 0.30546451953496345233;-0.20008061615219790985 -0.79136034450698178322 -2.2516088097329505224 -0.068172605209976505636 1.1894852370800517161 -0.86833327183876629629 -1.4752483148690744841 2.5942467087867817632;1.6102717416900527159 0.99285067718554065319 0.52502620749410100487 -0.357526422061426985 2.9469662344846523361 0.83946161671288688222 -0.28203646308664170883 1.9840732283155555482;0.094638595892462970549 -1.5155642447909509762 -0.14821745103634151319 0.2076423621259344543 -0.17331807824308465005 0.97578180366575606453 0.7686852595809976485 -0.50274986046285741192;-0.22657338221984976712 0.66559801235000315422 1.426948802596001542 -0.027731950311819915378 -0.84020176551618164229 0.85170081700992472662 0.18535971231377179613 -1.0835381359913489607;0.47479557165896552062 0.20837413912399291305 -2.9311434653944483664 0.71182068192737291135 0.23258677760423476788 3.0344302929547919412 -0.1354049380713517603 -0.42189127181177576986;-0.029495842801026173757 1.62760041348743556 0.41187526316084333011 -0.74549190564985479135 -1.7828185677471719561 1.7334978189139189642 -0.72447947216907182533 1.0998029799829049935;-0.43364448084715456755 0.042626637042267795374 0.3531697058215776952 -0.67224499671851645211 -0.29287362997858129576 -2.0437779080878044624 -0.085326248221224351709 0.60800993721759788446;-0.19989578885240535944 0.92367746329359656787 0.22471912966463275518 -0.86845746420386016329 0.17326873379162777145 -0.12982808982574664536 0.81970629084765078698 -1.6708414375197546686;0.19205793918036243029 -0.12440680322120924173 -1.2865831878161086976 -0.089300343741856788582 -1.4841274084212718876 0.41184583100479221773 1.1726927007763265909 -0.13406646122436513546;1.8234736248777476675 1.1291841409529630447 -1.1412342766100112001 -1.9470868041744422428 2.7494157366647864471 -0.43349916488994727493 0.14923547132774112045 2.4224634054590405974;-0.72559934477632515026 0.07998507525604263424 0.61046722582163315263 -0.93639136549411439159 1.117413883919806894 -1.711619869433215646 0.61992410888842852668 0.37592312629454543993;0.066120987458465910191 -1.4133814771769122043 -0.92760444900318528294 -1.0615563405309105249 -2.0909538169520538453 -1.0696413841343732631 -0.34021076287956958373 -0.0026424141095530741252];

% Layer 2
b2 = -0.69786794742982716233;
LW2_1 = [0.18702674958938891869 0.83090482315989777629 -0.80717020488709056991 -0.16544638846879855532 -0.36338686866328906433 0.67958288497407892681 -2.293655464217583706 0.56616016246293099368 -0.63355797121484513923 0.35097616677299675603 -0.60701105446980452296 1.1842440891600709563 -0.6254622734414544416 -2.3829858901752478673 -1.9866023585401675344 1.251328034683266921 -0.16959623213620614313 0.48765209858894004169 2.2565123879974682275 1.9489008396125400147 1.0600682514401900125 1.6403628046600529089 3.1900089688311821234 -0.43279139204121197526 -1.3095992834647300906 0.58891371252455693153 2.6865428348130286906 0.79675777140047399083 1.6436804723114741833 -0.31336932899965497246 1.3434475885131500483 -1.1651708617651810318 1.1683765879967282775 0.6724005078382078171 2.6031913587268404875 1.8324140723253534713 -2.2052512557527284009 -0.59390407694468583255 -2.4011218072492153119 0.64796220255153236245];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
