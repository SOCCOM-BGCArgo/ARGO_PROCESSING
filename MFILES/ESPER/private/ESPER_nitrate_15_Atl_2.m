function [Y,Xf,Af] = ESPER_nitrate_15_Atl_2(X,~,~)
%ESPER_NITRATE_15_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_15_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.7824375132732344085;3.7467810269956194347;-5.1797459887864576444;-3.4807333177766999199;4.9768662679760726775;1.8411869506915501393;-3.0714435724196880173;-2.5854190300030754912;1.0633666435166100328;-2.5683051003796317779;1.7581705192566148277;0.5909286068651913304;2.7936044707004374921;0.84824691710401023403;-0.54093450086874550475;3.3092000499275977532;2.7674349016994326256;0.18817952976112045649;-3.9131825832410220833;-3.8304752179028742631];
IW1_1 = [-0.50489166710730148946 -2.0154007748208329076 -0.010459170670728924063 -0.21572579472586150828 -2.5750932911748347642 1.0756659951213691784;-2.2466565167781706869 1.2005759085159417587 -2.0058055802881691321 -1.2787506884561694598 -2.1046125918007270172 -3.9562723450966781336;0.057406986544615581924 -0.033142129543624991583 -0.30306098616029281123 -6.7277766836789085758 -2.7162480371512334187 0.048150974572082422265;0.364750527558342863 -0.72886879389765124593 -0.54062731180250678253 0.029128757951373034085 4.4182401567745088755 -0.85324550410573696269;0.11508970266349793921 0.071488491591489386479 0.9844457510743243045 0.34752981472167215893 -7.9853162156991599474 -0.25169718506049237883;-0.55034877654856118046 -0.95017028261074076845 5.1617172917230496054 3.2091154797280481148 -0.52874434800201430829 0.91131898416537127083;0.32056016475331328142 -0.073888330560838030858 0.84371263897403780962 -0.69758254367755634373 4.6145624405124667788 1.4122713534911461863;0.48727689242250382673 0.47292919217275752874 0.73811116886965610906 0.44451676140461443554 3.4982293735358513942 -1.3742494942919909473;-1.1459138424059458483 1.9090125052475281908 3.8853656151440234545 -0.4217127978560930579 -1.9789099217732244451 1.6086784792548236567;1.1432774844269397718 0.29955105790136138388 -1.9472716159153029558 2.247618449439197974 6.972240897537052895 1.6648412407016535131;-0.080230542204046850774 -0.47135700246603917662 -0.40164846357575606506 -0.10953183009865810615 -4.9575113037469034083 1.9191678160632157368;0.78463883875962892045 -0.55701827807715309504 0.82385168584770585021 -0.041842610010954656152 -1.6398353571398149864 -0.70133311937235920386;0.74295555261798451596 -0.14816599807327085481 -0.24946813435455494901 -0.18879934024030331496 -4.6308391602619289884 2.0842902102864302449;0.82349629656700151781 0.87118687065965827454 -0.72887734734672271486 0.77192387057485045698 -0.80576338415156900652 -0.94466240962032987927;0.39076856796591175058 -0.5295593440160127896 1.5060748219355355459 -1.1727084585452522969 -1.9607976839830592031 -2.6490535032343189847;0.55540983568781421287 4.215508223788154929 1.0070358058284194502 -0.55938022655518948589 -3.3160085838574473449 -1.3196522667990764344;-0.82462030210104042549 1.1314395550436231463 1.6793895747435942933 1.4200746403370261284 2.80854241818129724 2.9146387288605430932;1.2494888278285858352 -0.76197362745562224884 0.16691812199996275412 0.29613076376835034687 0.79604217706747881778 -0.02945855779692827317;-0.66441333442377503715 0.33588636778491498536 1.7956555170619863393 -0.21583360289732789195 3.3276589177284638943 -0.092187829630067830156;-0.38521618852362410346 -1.3137446197647448809 -1.5064168217133999672 0.39737595597976677064 3.7244437062336226418 1.7866083917971042894];

% Layer 2
b2 = [2.7934483959141855891;-1.7439571346319753253;-0.67112047054235290933;-2.712557795669807259;-2.6301653712835646459;-6.430197168552878928;1.5011112523322724943;-0.49196227289709271169;-0.11448560987798461763;-1.6319298878598986757;-0.54937878533455897223;-0.90498345084542997085;3.0680532458207796509;1.663601023723939587;0.077527428534017492345;0.21003475498832602231;-3.9393489724862709167;2.883893953614873773;1.1920734962221051223;-0.061641239508124501256];
LW2_1 = [-0.01402901476021465102 -0.12432615025331886227 1.7121375843214856616 -1.3447933725033542895 -0.0015020323969952278573 -0.13885882998766080343 -1.3798307184540337111 -0.11835162323644544957 0.11016852349251766985 -0.60054724048294561012 0.88544507968268926223 1.3952308549428646955 -0.3382775798944581136 0.39917456904308257215 -1.0880634383203460214 -0.20458795025439657778 0.30183661915421922117 -0.63212141429539725479 -0.91575212514906290107 0.060578121550124167105;2.0904015871441883334 1.526299348071080253 1.5864325012805535753 -1.3832630419570077773 1.2345641100009874247 -1.6316412114183784787 -0.96053176422883546071 4.5364017267655185606 -1.1047714036459972409 -2.3217734587684164538 0.74666738027389045751 0.5036005163707414356 -2.4136879598787195356 1.1151623785551423307 -0.77258787364004199993 -0.53979223807602716434 2.4364964022709525437 -0.81969376634315205266 -1.5059507049987268523 1.8970442639802371776;0.53411789366467699036 0.18053328648374114551 1.5626940558760002986 -0.16299236561283303448 2.0826005493959773851 -0.44577405994692259616 1.3571886361309686286 -0.55737430902238238595 -0.32669238049173543459 -0.18366607933934042673 -0.34879563652767975324 -0.71808579707868458453 -1.4927051111171021347 -0.66916286219103615629 -0.88523742118264658885 -0.19253538306212744646 -0.39041986050590904433 1.565319013268567927 -0.089974066348946293847 -0.5985493463791499158;-0.37875673196334086468 -0.054154446288798382958 -0.83822747436247035946 0.34266826182569171122 -0.74929654967265379995 0.33541865570550655207 -0.47048894150214903842 -0.64887950275063921435 -0.83368817737377187704 -0.63635559789909357242 0.62854372897399024556 0.12020731326089736934 0.90657839092109049339 0.38022328222870588332 -1.1765624014383848639 0.18286821568646025038 0.13457643670939350988 -0.74421224849535427825 0.10663881814968421968 0.29191084643479237037;0.88599871258699913756 -0.10873692687380155653 -0.27757176330335031622 -0.40433353474013350448 -0.23463843107755849582 -0.49250677831421080244 0.18446121095503681397 1.2870742669939969627 0.22211997009252187896 -0.38670066823334864337 -0.42167412968183676236 -1.295679367066711718 0.1143357584928823556 0.19757122281359743021 0.75117674168335268892 -0.20112189636078731114 0.24535703660504104562 0.91471361605037693199 0.54175213369146435483 0.38702899117111011495;0.16438590093666327618 -1.4412514423023976562 1.5988920429044171101 -2.9948236042100395693 -3.4295902473493149465 2.0114353573029548627 3.3365425385834446281 -0.87161009884252915736 -1.3668818346548452514 -3.2409475728694734364 -0.66581420761211296266 1.423120682200155418 -0.54556749194693310301 3.2135833154676634038 0.47153500485721355773 -0.6975487849749036906 -2.8926280617755315561 -1.3125945688222326879 -0.22467914848125536409 -2.6333212312295040114;-1.2111625008403201775 -0.33875436257369062609 -0.60955236315469962793 3.1640333447063975214 -0.21027555389887170323 0.9420593271383383982 -2.3618312039102127287 1.4701469312416124424 0.5343921158245648062 -0.5385567073787012049 0.076107559293068546835 0.43832984613023950882 1.2572572503215162509 -1.5747762700075174092 -0.10362646216400250854 -0.42891876109358206826 1.1931320772819171694 -3.605170043998707996 -1.047991272717430089 -1.025217162556030015;-0.66738964417823865016 -0.083634739300709429188 -0.48113980185494997777 -0.76169920091339682333 -0.22587178690471426679 0.91498153496764922377 -1.1971738861273895083 -2.3161768108011377976 -0.053503272564739939865 0.75320621531232956336 0.55742741049745980764 2.0766408907519173788 -0.95603584974514510542 -0.23088407502588206843 -1.0011107640861154344 0.046544770942093791066 1.2912623912113567748 -0.67538442401682829974 -1.236198154442922581 -0.93672934843014354911;0.58302761561312932415 -0.022272135054255515207 0.31279841066686159268 -1.588776498992108932 -0.53465969279856428997 -0.42399960155398264128 -0.31436617013644929663 0.56862174948799237839 0.14292569712142375038 0.37285500644298547046 -0.30383236986946521307 0.79725947863168233898 -0.24977317580028116084 -0.39149915790980727159 -0.31231141457730476896 -0.34927874598045338672 0.35115896478921271306 -0.20004063918164172176 -0.097404946178860862815 -0.2536979350106443043;1.3651593680328588665 -0.60295914775330172741 -2.1576165896106331843 -0.34239869992156207745 -0.30014796919508784923 -0.0046421462523255005439 1.1083448969679157159 0.94160795149050291464 -1.5506032992480685007 0.073080593955604594703 -2.210750565119304234 -2.3485200109020492043 0.50816928854126786064 1.9018700681368612138 1.2231014541459805933 -0.83423301014633211015 -0.96227100323520342595 1.405850291189405965 1.9921724496460524456 1.1432002367171891777;1.0184862428302963178 0.29043820150893195908 -0.72069004472904307779 0.82236295056198072118 -0.020825952492382837633 -0.27948779495888126378 -1.1228455032061974705 1.1372409650882546739 0.4740932283490655319 0.20953766062457829245 -0.6228530603420492362 -0.23187495396344184884 0.77676437965200983982 -0.55311066158447030894 0.55000145187147664316 0.29867512519154204575 0.25361735365700377454 0.065003703877474672268 0.39075509727862361986 -0.091144995458393635035;-0.1862481865341971965 0.37685291710994123227 -2.8389574774548016478 -1.0253604218584462249 -0.76084081264923886234 0.31436804339992985291 -0.27014011571198875972 1.026715229025776166 0.26098771728519415403 0.56936641974206747552 -0.14228537189873041724 -1.6892020555692999206 1.6619020247697193771 -0.92457704525338935131 0.74077888067402697381 0.31917133802655439645 -0.79037091128705605492 1.5007513793621922726 0.14712945549434386372 -0.16523259686820246372;-0.5460165437612977124 -1.1709862684104921371 -1.7686204299661465456 -2.354788778836780061 -2.3707246303147027078 0.2890602788446259841 -0.53558872103056087699 1.6919596617804930627 0.64254350652404013111 0.30138566311972792011 -0.54418997556452841646 0.85294851817861272458 1.6200338680185266682 -1.432097785205171725 -0.4666358487057768456 -0.15187513777035593909 -2.3227717884811589499 -0.63571213934775316901 -0.98801675231127028542 0.53287633440779424987;0.47401531187346440666 0.046328151662949089429 1.8529007474607446238 -1.3468086915194763531 -0.48873873766653752604 -0.31696287752771767909 -1.086638946299854469 -0.12869453841646752434 0.53542553980522344936 -0.40731137359959473931 0.46954456924796711403 0.94255971063042620628 -0.20427697710009121157 -0.086667468862630894777 -0.66175569767175346225 -0.027344965608521811656 0.050394403045350776027 0.52152150966077115424 0.20619522430264514146 -0.073188101620130091574;-0.30343454591499063877 1.3945555201911130627 -1.682072991672741491 -0.54133004367670567447 -0.81492355890861023493 1.7079983673145304746 -1.2771451188457061399 -0.31087462990367403792 -1.1417477049708892878 0.72440453351455236231 -0.15233022407637469842 -0.16411769567177600382 0.031906573235795848698 -1.8418451362704253427 -0.79636370903631936713 -0.26210456027238232535 -1.359097463982993137 0.205243032655911678 -0.94456362761098056069 1.0386937248224856756;0.34156764037704379078 -0.13364314464097135082 0.84452344318013294888 0.38478410476291635689 -1.1325175471046620146 0.11426991289027274568 1.5639878680297809588 -0.14865761820792045 -0.11406814899158317089 0.65637568239713184326 0.09334532406122196535 -0.48318928173464098519 -0.17110157820203908408 0.20590813659248133338 0.71437595358277627966 -0.024810552116955680857 -0.39411623272592444245 -0.25791105793053181738 1.3789672216354460499 0.014183748200111659377;-1.591462104427804114 -0.2320270299788245727 -0.73112900169794059479 -0.1554159188739335784 0.78423042702710266116 0.015718477500679162856 -1.1170181114407624623 -1.1865288747314834961 0.069361117474187758414 -0.37050795479464360138 1.0167903357826071353 0.41314550111626463513 -0.64290763994446475937 -1.6491095251060550186 -0.75183271520417804812 -0.42796968107709038032 2.2950182218428518688 -0.10211272241648398917 -1.1955731048790723126 -1.1522067322452529403;0.23404589389623770002 0.38687297128362480025 1.0396875349644947306 -0.49067030830847541134 1.0486789340124389458 -0.90703139399661703024 1.146397587538790841 -0.02718589594752312058 -0.29719395944952686772 -0.81533149684054750939 2.9455358805382156895 0.06428780057906338663 -1.3381772061181766986 0.65863058435323462714 -1.0714498643909871056 0.51244892057577429156 1.1804923155441771065 -0.057994174204366907843 -1.2900182363090983984 0.37679575605398996085;0.06813779781585073414 0.8449335636698899199 -1.6861982840315588028 -0.10833309191346818245 0.98597255701304287179 4.6655074285187128069 -2.3881711201753637042 0.26067534663385860672 -5.5632613754804269846 1.2602406513393140663 0.25243606956618092063 -1.7840592232086058821 -0.769063465199989027 -2.7896405118904872289 0.49362867675239557874 -2.7783927889419461899 -0.45017327572259968615 1.1412685861737630333 -2.3058871276422809871 -4.2245072913103687284;-0.90537349307998205017 0.69570355383372328717 -2.8778228046693881126 -2.2892977154246731963 0.13234332288335126648 0.4682376110925867696 -0.53850397378098446843 -0.4049337093006200039 -2.5465402610034324482 0.57804489949978177243 -0.38484191666096739803 -0.70142511498183368612 -0.13470161655108595089 -1.6304852872032562505 -0.065858332887677895062 -0.47703698250760673272 -0.16444978234661111749 0.52187707900347513057 -1.3196702439056602341 2.1950225871416586543];

% Layer 3
b3 = 0.01679415960923701101;
LW3_2 = [-0.79253109716967917731 -0.11941900917382541891 -0.22542702766887801058 1.05595107151246137 -2.1845114879531042362 3.009761354291299984 0.20712714625463771179 -0.63523997269291998524 1.0130023472710611987 0.43415144838289976281 -0.51648924836835297114 0.62874240742974674134 -0.40576103209923330972 0.92118010712821396524 0.33655068681518479634 -0.62739248203782405078 -0.33159404767737177266 0.2710606482819997165 0.8105436965412048389 -0.28212222314242046961];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
