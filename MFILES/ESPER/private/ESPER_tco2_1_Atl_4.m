function [Y,Xf,Af] = ESPER_tco2_1_Atl_4(X,~,~)
%ESPER_TCO2_1_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:52.
% 
% [Y] = ESPER_tco2_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-0.2178;-177.232103709389;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.0461352500991908;0.00425400504498441;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.9737867357898435;-0.030669540375269842;3.1727926663668113;-3.2710892388062587;2.1811069199302926;0.67698316229921218;1.2607885728058974;3.358463327449162;0.22163507746755576;1.5057617943831758;2.1767968021187118;0.29296220177594234;-0.4938487774464701;-0.56159712817766305;-1.2202285325000426;-1.8759522258489958;-1.122485213376152;-1.2107554317229761;-0.98970626908880355;3.0396186524821274;-2.5268525542234923;1.2106518406857256;-1.5660984899070536;-2.1761050924201246;-1.5641757583231053;-0.088330847027317971;-2.4264089638559563;-0.38020996212883218;-3.2284075497966649;-0.39916927171205902];
IW1_1 = [-0.050310691825188242 -0.29509323560178391 -0.44587654569997037 -0.13847632907558016 -0.044996530988010472 -0.044095350198569819 0.40611137895492133 2.1783187056619027 -0.91315137694807902;-0.02101465952885578 -0.34761191036694478 -0.7834242421664509 -0.23586262314396289 0.46479014963819576 -0.93937161228044896 0.40170775349311161 -1.0513127399384239 -0.097186351590018039;0.019264668292513727 -0.053884281194725797 0.045110267154692463 0.23554253819101251 -2.667568565573887 0.31863514426372885 0.0010493527290380347 -0.088728276241313006 -0.23872789746810374;1.1408955430084438 1.6552706659627783 0.053416679608511465 -0.47304278219560225 1.883151100883999 -1.5934307217761718 -2.0863946902478956 0.50825959222811479 1.6855563637567514;-0.83457652240313951 -0.28638466033114934 -0.93294913449321304 0.25032751767217692 0.88042468181265854 0.4403264125183417 -0.26323335020870692 0.56411518187146048 1.6838647625285887;-0.49174073193233875 -1.1746309354300843 -0.026292334781648066 -1.4770289878430742 -0.12486108020642195 -1.6625329564847566 -0.69584662825730359 0.86455900472299385 -2.214510383335619;-0.27887668066155402 0.032662790193768526 0.63563305331255548 -0.47330127147875589 -1.5093120815119667 1.0907822931645403 0.30448181505043298 0.01355272125527952 -1.0473250495280255;-1.5530177435366801 -0.090876014182317513 -1.7891487170242304 -0.023676472908319306 -0.56622814651731268 -1.3917114721439949 -0.87006019144363267 0.3223313825549885 1.9412751987703463;-0.45062443034888694 -0.19762591008650593 0.11666534685654564 0.46757737496902269 0.57973451712128177 -0.17695870701594749 -0.59756001343167942 0.4423959052810133 1.6293686160701246;0.28581535964281501 -1.2468561317152109 -1.0306450924085491 -1.0494948699046447 3.0389802142776521 1.219340509423825 -0.414335786054286 -3.4990971732882219 -1.8168116612334193;-0.66390089760975468 -0.96037159217290002 -0.070313391324014984 0.10881844448108231 -2.6671799103794251 0.24791959941017536 -0.68186972862209905 0.22021892364783258 1.4006349578740889;1.2911141504347596 0.044084100501945778 -0.94399473725868932 0.67811106359580997 -1.7427833808433824 -0.57412374647841646 -0.18998335300724492 -0.24055883786870769 0.51691106303652079;-0.36343279412056867 -1.3629409925688787 1.2406479573941247 -0.72288053324363655 -0.66803350620044188 0.7567243394172718 1.2986204689295169 -0.38827951003103006 -0.93918579527447232;1.3628026107512121 1.3403966612162403 1.5994479118967282 0.2157775481546246 1.0858388334774014 -1.6689756364128483 -0.77449466848026516 0.90830977889096343 0.95815480998395164;1.0364109467796507 -1.1137832487453165 -0.99910968145617962 -0.15756451796658999 2.91401226780253 -1.1641510368914409 0.18374113288224167 -1.7491257298897449 0.97947824104435155;1.5297787048916518 0.013448387709488776 -1.8773172789235677 -0.044760930002910815 3.2347993713277248 1.2048195509514814 0.19844581867610961 -0.22945578374777259 -0.61885547945281716;-2.1051300817076801 0.40702155754228408 1.2137134841663038 -0.36395379840782538 -2.8846690871714857 2.4132457012189308 1.5665729257500507 -2.0993230083877403 -0.71315867793982901;-0.48223662887559271 1.6811618414926957 0.70606305451429874 -1.0595270156681762 0.22783580065608544 1.0466767404134114 0.19828335815771542 -0.37061017008554514 0.012140677815975578;-0.49517636553889799 -0.56447242943285303 0.13614057546651734 0.5375666926357956 1.8926814936668834 0.38159871403146661 -0.19047675068776715 0.44864917289810624 1.592221417226205;1.568977351113668 -0.22047294091229508 1.567050768404608 0.7463863802620101 -1.2636076193854968 2.2200410733535176 1.2223710388514348 -0.51317173361573165 0.74458387829629902;-0.68710431912837155 0.91438602185803464 0.83060608616361709 -1.6671854285986019 1.937350537001721 -0.035470587145504447 -0.43278526751842322 -1.3466521504826632 1.4634132332949767;0.087055176180445684 0.062848829211826246 -0.39296495823233252 -0.70845017639187957 -3.7333095310552107 0.2955217801717181 -0.095867902138114053 0.14439965458798584 -1.3911688167618548;-0.038370122840593157 0.3023358045770822 0.45121823276208173 -1.01539920349462 -1.7593591048986725 0.39168407761925639 0.045966974694007678 -0.055440493503063772 -1.3793824111041988;0.42932348836328688 -0.97687667933396582 0.49548556833422175 -0.19254529694956141 0.23030137916386736 -2.2035111449076705 0.24846703627622305 -0.78678674000229842 -1.0661328458332167;-0.19100008844564131 -0.39102284353734995 0.32773123656841091 -0.55195406255997814 -2.0952376311717602 -0.089555906416884407 -0.79813909756546841 0.61947565261530235 2.8430140693024133;-0.75454645858150293 -0.76630577940166511 0.58952300710978034 -0.48157743004265818 -1.4188319382796495 0.22041284202171049 0.63433465246017318 0.13818399373897078 -1.2829087873296625;0.95390336226227856 -1.6062250171967516 0.22710291619240561 0.67303820903008027 1.9156813498936922 0.94717348042852367 1.2738438417356901 -0.42222261517152943 1.1299361380154695;2.6818421806655803 -1.3739344267406046 1.89773650729979 0.88315480789022061 1.8409339258918636 -1.5086508792739695 1.067619111002148 1.4963030084226958 -3.3850770249615443;-0.78434511656730854 -0.99990293808740072 1.5188558948569308 -0.71918081967520986 2.3940005692691746 -1.1152943517350453 0.28932344826645784 -1.1916507074543368 0.021723149545647372;0.41632827476168099 0.24510824127381409 -0.49120648204366718 1.2088471618849468 3.1692514162256966 0.25964933870285178 0.70323973171683496 -0.11822654728217777 -0.67355427331300155];

% Layer 2
b2 = [-0.90466930815963487;3.6522135619215499;1.9307702458272038;1.0749018502541425;-1.3750142023003431;-1.8004401443112523;2.0477298491377178;1.7234639873661659;1.6772771941665137;-2.8124404040814883];
LW2_1 = [-0.50989138818227919 1.4184792875234613 0.485269735352584 0.47932695467680292 1.8485765385723079 0.77931086598575339 0.79877031218594041 0.30327156980524111 0.28597748710193582 0.72777596107381604 0.80576933136833373 0.011044932248352119 0.30185518337165118 -0.62184229993512496 -0.4627431146349682 -0.52769455878388172 -0.30859891232259784 -1.1309017454623607 0.38956597443626362 0.093005667461948299 1.0506146187693604 -0.65153469479565018 0.950105982993801 2.0293725151716293 -0.91525354169967854 1.925826637136973 0.12733923766353084 -0.1472093622558874 -2.7666809650571489 1.5842399207366058;0.10623425936546976 -0.15270780488530966 1.6583829579561009 -0.074949827827177976 1.2486335366052195 0.69984052417767761 -0.72677715819758226 -0.29114204103854813 0.45355048463947534 -0.80871618825111635 -0.49287629662911503 1.7562480621713898 0.47834292120808386 -0.40537433242449111 1.2302029060868924 -1.3136303976344774 2.07758400912298 -2.1608729726423888 0.31957169723205342 -0.50761954999012515 0.3844583066333776 2.2768894700029265 -0.8112671108860251 -0.24669711117527887 1.0559637070663874 -0.28546868185777685 -0.015246140229612806 -2.108836723758261 -0.10691314281373351 0.51337182880282528;-0.12131497980136649 1.1554321327961281 -0.08408998389256972 0.11453789504525852 0.23611914336905429 -1.0841982198615421 -0.16095564252650901 0.26247443038326235 2.1580375804911256 -0.45366218799886265 -0.50747825516846035 0.46716563605876377 -0.27240385254245453 0.89971688078793632 0.43093438540473517 -0.9163787489659595 0.17584518678238914 -2.0717728577202528 -0.38443349758915979 -0.79804487434775984 1.3490334480903132 -0.25093546331038652 1.7227805506138913 1.002562047906367 1.0148474672792234 1.368569064400498 -0.037313784331190078 -0.17464362920699827 -1.115437089713937 0.2560360206524529;0.64885619195374455 1.8938408998533034 0.39048957144344137 -1.1782140428715533 -1.2406494097417446 0.37274731045673226 -1.8537857274147498 -1.0121668490035447 -0.77407425002848185 0.47380304520345207 -0.50585589551013932 -0.56672015673347054 0.14667418525167514 -0.23524432436254442 -0.45597222381188296 0.77270575753667825 1.9347913496639859 0.4506967250316487 0.48035733785917495 0.084594751330272611 -1.9572102938967597 -1.6866607421556756 2.1188535919862375 -0.54288408820257039 0.34297147879042233 -0.081979054692314937 -0.52724412904975948 1.9840168581023041 1.4364113081268686 -0.91275919253337057;0.29848915643777885 2.1704281276529596 1.0080579271764751 0.32578297699405073 -0.39953694110256721 1.8797496249512688 0.1198179397247717 -0.75513250504933416 0.30949234464250786 0.15796682589486152 0.48531590658415724 1.0040575309899846 0.4278377159410171 -0.58273521739817224 -0.46152605973301408 -0.12193928657495923 -1.3514865129475122 -0.91950528096707873 -0.6572805032448692 0.04399275514658435 -0.80167754158637461 -0.0080896947672192271 1.6385810673578849 0.1352695379741094 2.5217136843756571 -0.52307499738737351 -0.68396047359991319 1.0727217579983346 1.1240795737320399 -0.32780889197396101;0.26596658931589279 -0.2166827854216587 1.5489479875207195 0.24943772956665367 0.11055041376372461 -0.23514415010071907 0.18498528768469849 0.17255846167796632 -1.5258998304045936 0.36670628780591552 0.48140301485607923 -0.15395833485625154 0.31907878201687201 0.19803743495337156 0.17682602338012787 0.22862612480150071 -0.37470342584673105 -0.35921695556859862 0.89016455571938213 -0.16170187426128074 0.012714964801145031 -0.5842184740248676 0.83249040081757075 0.072945985218191345 1.2548592036664217 -0.56954747825370722 -0.61960464367156443 -0.36583158405165311 0.22925163432540932 -0.036937048233238123;-0.27247062087241414 0.13885671103606767 -1.688407854483658 0.31379500268667715 0.25996540897189901 2.1812022923127583 -1.3809507878707146 0.011845724086082598 -0.70347077233736199 0.26176351208198728 -0.054451408476025143 0.83895479039350118 -0.42384967658791189 -1.0377666175640603 -0.1986059700376944 1.483783836203193 3.3517663471290144 0.026053351505676413 0.62786886688936616 0.79116969681547056 -0.94556047254721642 -0.1651612009407547 -1.2175422439269832 0.50875571646034456 -1.0282106954762948 1.0639661709414094 2.2930722876105185 3.4340360772112262 1.0123031478565852 -1.6371736604925295;0.56629165569647488 -0.54272327567503964 0.85364329089021451 0.62455701485711046 0.34292177394023732 -0.36873701916039237 1.122411085675675 0.98261270772586595 -0.78413841872120782 -0.6647549968790325 0.60856262398642613 0.42562443565743507 0.68203184769877145 0.48057882308624444 -0.3544672414536556 0.27873389281795496 -1.2881925577378757 0.27265279058969788 1.2298709780097337 -0.42592497173265426 0.3569319515981571 -0.40922336195693593 0.92170534718150998 0.27656962250965922 0.14385737531533532 -0.76508391187282665 -0.82986510129545943 -1.1229398300335725 0.32823595950836848 0.080439153650113615;0.83145088955153101 -1.0934618638056013 1.1682459076786758 -0.43911756601350727 -2.0942352797945452 0.48899215352794639 -1.7676618447588517 0.46182593713769687 -0.070031354545346008 0.21600759474729542 -0.6363148981135347 -0.73331245581322169 -0.65700394228200132 0.065274066895771893 1.4485072745051268 0.40340926024685331 -0.79700022966956441 -1.8428949360713471 -0.36069630892673582 0.069034981419432623 1.5940714771054245 0.40252034703526335 -1.130356634433654 -0.39491066567004623 0.94433583013545419 1.4663880225783636 0.71784009401453963 -1.7439195401943202 0.12323518643512137 -0.22894132873759171;0.066202300348379636 -1.8687756458730129 0.87213148414724195 -0.45882037198555425 0.32854220025549691 -2.9306166948387236 0.70916052732090729 1.1567357686499604 0.45573389747965215 5.0008922148008139 -0.26460043816846857 -0.35422024080105424 -0.40891406340085396 0.63014174955682378 0.40167196649615561 0.44095807067691795 1.5108687400665493 1.351297546850883 0.1766147279006415 0.50983193905324276 -0.18286674194141186 -0.81325817079698615 0.31852777642500613 0.054984496336145772 -1.6825074737090722 0.96487169787333149 0.54056286010366006 -1.5453675875518977 -0.48680805462641236 0.58906827136685558];

% Layer 3
b3 = -0.83694931938107464;
LW3_2 = [-0.49329130191322423 -0.11231695084410452 -0.030088106719540261 0.066410865053956589 -0.11412432051027324 -2.0618442126920264 0.19455525771566326 0.1819422445623933 0.12507980716957673 -0.087097023154040429];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
