function [Y,Xf,Af] = ESPER_nitrate_3_Atl_2(X,~,~)
%ESPER_NITRATE_3_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_3_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.643690159693939723;3.1541605452995304937;2.8600560947819846369;2.0806459832955561673;1.820783649976365659;-1.3711902426962285784;-1.7276575592332259479;-0.28277034828026076374;4.7029346094422788127;0.73921780452152008323;-1.0288559968257331434;-3.2729384912957475429;-0.68785960876484342208;-0.31142420158680278464;-1.2362348806797789358;-1.1998539524662164002;1.4821693057295084461;2.6702430241016026358;3.6290739072714872648;0.27395148056202917042];
IW1_1 = [-0.76351452272106823393 0.054829330686542679385 0.149981670913201387 -0.33006777596394648588 1.3445575448932067797 3.2016747030223293713 -0.8248095498584296914 -0.37527715887671853068;-0.030246513737440024888 -0.023525167254399362293 0.55933122245665622962 0.094690758988110232397 -3.9400663288733457357 -0.15054778042894428891 0.50127707266774901296 0.75180256554354718546;-0.97324472003235029671 -0.092836053044583838334 -0.90828124176108471222 -0.20514248442349339308 2.0095251620014047411 3.2462642071370311214 0.69655023716872455086 -0.15586162209608422913;-1.2187363582240064996 1.2495040109565449526 1.5149530920530165368 -1.4517364339808003226 -4.2551088828537384501 1.4858017623776502703 -0.81911535933510193352 -2.0603906289272835295;-0.71517240142417592974 -0.80283420814565409351 1.3485991889454560511 -0.45096979689047622664 -2.0849854732512147493 -0.24152944357990627222 0.77098820884093888228 -1.0245051530052946553;0.059024751736475936092 0.94633598378983962984 -0.19551747969159907758 0.69414462302711488206 0.12326314677347703641 2.3008012267077897484 1.7725723691590251629 -1.4477790345079566414;1.0350445925440028283 0.37854964477957370184 -1.5755318854710409493 0.16136400328498606838 2.0983221415490298511 -0.99550025232132044462 1.9478667834405423154 0.53335925482399759723;-0.45301166832852818311 -0.065790278162351695235 0.5387965540749127813 0.0095433108511289374554 0.064562862554922967329 -2.1773453041984591749 -0.26066508875782523624 0.78781190426911551494;0.24020313368450391112 0.14068478350261295895 -0.58141262006797000961 1.8007085242736977637 2.9931988666896889306 -0.90055872462726604954 2.3037483517070369565 5.1103536657931378784;-0.2513437156972342934 0.72258009647859777758 -0.39362226434328928537 -0.343035908922687649 -2.1315997233119974297 0.098496042445187018122 1.7248068291408991115 -0.18783650794574627274;0.40910576469054366067 -0.16463026512022718717 -0.35177850674980187806 -0.060860603662007989323 -1.0508928476312568989 -1.4346884749136075143 0.18777661903068038063 -0.90915238457657665538;0.95979451712692087639 0.36976825131311097383 1.1586441758175878292 -0.38150759904047742976 1.4465581080291396443 -1.4794704154508122596 -0.51992627964502657889 -0.9843066727403557703;0.10169625733057698069 -1.3161104627815023438 2.3742959608234071034 0.26561829047045631969 -2.0091506678178090439 0.24937199614498289924 0.5752221780272507301 -0.38093012443431012448;-0.18498500143415891328 1.1017259032073443148 -1.0344635473868137865 0.20518101031038760151 1.2990572293798332559 -1.6234649466026094267 -0.57460708882284616816 1.1088075500261995732;0.27554560289348217772 1.6294991480193148359 -1.113582245300687612 0.36569797745027893265 -1.1649114533523545756 -0.30156919278249921801 0.81730912918451736893 -0.76624200880975157357;0.030118893630594216482 -0.54383017124654486896 0.87717917867660100129 -0.16410083402128258778 0.5040259216989522173 -0.44065171324494556426 0.890258745778130689 -0.7298605812802916315;0.70647999179699139116 0.56458372670940726312 0.37600211172449443664 0.16273395339407620286 0.24033654293138856373 -0.56320676097991573261 0.36958912697326901098 1.7233844664063995289;-0.13285080950533348365 0.33632396401608666281 -1.2209097094993826005 1.715986683455829942 2.7012827427976535688 0.82872091270542136421 -0.78493723792572733799 2.5855434089766999861;0.6466065976530080972 -0.45840814208405000763 0.21464338246276482014 0.43754664885383215411 -2.9278566044535025981 -0.41180748434098068955 1.0812072355945308022 0.32081734225002167538;0.2914762095093030303 0.7559178668319458394 0.47048789814178915147 0.10904723544919991962 1.2423292806652430631 0.42691989345445374715 0.86063127647102855011 0.20615246170967313488];

% Layer 2
b2 = [-1.4004190446239086487;2.3081322738869434197;0.91272750158701199119;-0.97157354019397434985;3.047154532276110217;1.8127673354697175778;0.09673937922077674445;-1.8169026153525877909;0.60670729534271317096;0.22489790125985259506;-1.8281679281165343909;-0.82719967658898041485;0.41752170876353389417;1.0456659323891988045;0.82734994328154121135;0.97516596963585555624;-2.5115413760053426628;3.019374425792169081;-1.5757522731478963429;1.6088316465908474306];
LW2_1 = [0.095307314802570639034 0.20850538487668709986 0.88595025979336106126 0.40893259370983625622 -0.49502486856159427786 0.19317912710695314682 0.022859709729811602402 -0.33718837798382839122 0.016503520225330192694 0.18354056228639670234 -0.77083970594676287647 -0.062142424717590079297 -0.48505017765405261665 0.18668787646781320744 0.12862405057426928856 0.070060638785795686934 0.75527046832035837909 -0.094741201952209100345 -0.086380018985322340463 -1.3317867063735675526;1.5348874262224427856 2.3543339533471780989 -1.3207706628830202522 -2.7524806119995797182 -0.18155872363367087097 -0.71932860132619669269 -1.7436953151430747422 0.4569195597521166774 0.43277209261234367288 0.017409415328832267972 -0.36834006871941887828 0.75622757692272224439 -0.43120388331543901828 -0.00020713117773623820894 -1.1329971220357373252 -0.99766811950607980908 -1.0389104838861573654 2.1743802091226722695 0.21524955261266531803 0.75548275524278241111;0.1491534992439199625 3.3447942795381453429 0.56019198205856501893 -0.68558455215023006435 0.3366505692828873908 1.0047409346675739705 -0.10290788027020587869 -1.4369171494714547688 -0.21255203201303540794 -0.98378897941961818141 -0.23218616355593241218 0.86213243307045650532 -0.1001840505279930349 0.30382015258602290686 0.34476092635341343273 0.11503941981181223242 -0.8960358195377627899 -0.3516163673296927028 0.24218482426793599971 -1.0724448754347759571;-0.091000972833727378219 0.56750051575817828109 0.21547476773609844369 0.66731028695451954924 0.061099424253374695626 0.16299191639450921754 0.75762397550269000579 -0.59119746838462050587 -0.13035126344561892564 0.21146433605607620199 -0.18236595495992255489 0.39187228084868380718 -0.26529341908544457063 0.18434845757042797598 0.33285033312046380383 -0.80298484269467740315 0.44719169728410540499 -0.17790115130643241459 -0.3906885954390707516 -0.61722457087410242949;0.40643447151823774988 1.2398051444547446565 -0.32399709298112233657 0.30739493999104033906 0.33813806802692836229 0.22564430624393974623 -0.13390800666188429346 -0.94159997994978872349 0.125373730831160074 0.27654997210593834644 0.17461380292411765591 -0.0075661993354971561129 0.17386815908895619787 -0.44522244792880238951 0.067308046110143751606 -1.5711168306185379073 0.053130479469424951589 -0.31291698847838556041 -1.7709220112651558043 -0.41245684362829299063;0.01615430114066797318 0.14650973647036130698 -0.11605064664971831423 0.4609588293207281251 -0.10924097454906026017 0.83542351839007633618 -0.29847368122314227312 -0.7169613312530201954 -0.38559082321543525218 0.37332968208945260802 0.87356081657630380022 -0.29300407684655005447 0.11528011184760918184 -0.58446978259130744071 -0.5955333325084521956 -1.1204143408612226018 -0.15162653749795282354 -0.10614972858063000116 -0.093548425305863186496 0.29877208646219999277;-0.25752568944304266019 -0.30755329062364378245 -0.40866921677777090505 -0.02679542488844405268 0.70413840202941913038 -0.41949081827870893235 0.46278136375668432745 -0.37969102896288092763 1.096877213611515689 0.35813408478070707375 0.32165061324503402274 -0.0069729319589980232746 0.25806746124088369987 -0.26473793038242593445 -0.070580911284100669723 -0.7195440604674755436 -0.50184207720257900665 -0.29725613539610129532 -0.26368384935443650585 0.15390344562607430334;0.53896718645739727371 -0.33163509439073785012 -0.45284021193493817492 0.087776720882585285155 0.23050803710447337336 0.018413880910282336145 0.18732526634544455213 0.74707296518159771459 0.50026393754045261897 -0.036472419884759618713 -0.21782209651251285831 -0.45935627581340571224 -0.13315646103215231233 0.23331540685953236491 0.7357638770845374987 1.0532077029801762968 -0.30756424471074400584 0.37535751367663550138 0.44355003442450113837 0.28131345548003916512;0.12733438646737210709 -1.2468207106337487744 0.3789616977845450263 -0.19088571936454659661 1.1508820527706709047 0.93576174981957138677 0.75281692549596701536 0.33678539965293247116 -0.19675177594859719066 0.6527412374617914681 -0.13679637679217052093 -0.18976517417724816927 0.47252443880967209822 0.42086880464571474469 -0.23262849559913006958 -0.45508150327834501203 -1.837770444553327831 0.3977079036044046112 0.73596321153349752997 0.56578070750494757757;-0.87015928312380419474 0.26626495096849300825 0.14891751557422852614 -0.39481995453459389767 -0.32833303479520475898 0.34007559788470659301 0.21532492991676258076 -0.50337459734566014635 0.25285122610886084926 0.18630662665171313086 0.3949052269288743644 -0.10536171370287053528 0.11584979129150940746 0.1375750402662966887 -0.4660067932985794692 0.035185758265715141868 0.42881846362627878966 -0.067651373989676938381 -0.9570437576813057845 -0.38734061159998450785;-0.49011180499541223687 0.62019143725862124761 0.53085264870059145625 -0.18415522741986389832 1.227823895552364819 -0.48052189301303449565 0.64604444262136972998 -0.04624979797322977676 0.75330464675493336024 -0.61634867379760649442 0.45827645975138647794 -0.28238534172974344427 -0.3246421908506696985 -0.12604136236538177052 -1.3553159829110938972 -0.79771706465891545346 0.51255447223560479664 0.3179546239921107742 -0.60005201216983150569 -0.43803702906798880345;-1.7697506323953446916 1.5397377632439788187 0.91866648757195334962 0.17761738647381308809 0.17339351988605539168 -1.7653349524625225886 -1.9434526602916042393 -0.87992738716763385654 -1.16849214247004074 0.87386107184678707416 2.0318301354183132545 -1.2695237606464246927 -0.18961414495369924293 -0.12034512279932313428 1.1371170023655063908 1.9079086062791861256 1.0664966928148273961 -0.56092960066471941882 -0.76163566531289372818 -0.79871576351906170554;0.41103964644039636678 2.812811232013997742 0.17905855182322411023 -0.44640367367038158442 -0.39528726215506038155 1.2405370866376299599 -0.26693464176456738191 -1.0523346885069819745 -0.17965330176214150404 -0.72083292085362893342 -0.048573472756976848741 0.76583593813905281866 -0.65291119477203418686 0.36326732683543705438 -0.74519111602802434735 0.80319759641468779776 -0.68723355158229360029 -0.092114865698854214715 0.13218076953551174957 -1.616499279787209753;-0.48333431554385009044 1.4909079794853210554 -0.2253806511622253872 0.29216566970384855173 0.48079528064223747696 -0.50446105725940248998 0.083480537185658509891 -1.4999474524410407739 0.030499237736940930377 -0.82832108727998421394 1.3559964212733432998 0.32435399860359614976 -0.77031850110041943935 0.79358683304929744651 -0.33917293582302959765 -0.057727621073804934182 -0.11329057717968277208 0.68184032030821384307 0.044285351308887124788 0.32820103142937584462;0.27478395721916781813 1.2724528686031222335 -0.22288496734357143847 -0.092787212828581724922 0.29814060486977789211 0.20984717721268839052 0.048165497984182965852 -0.32594883784210604283 -0.012648372079149273681 -0.49957318638865771954 0.74102053154155211878 0.32743106642763025738 -0.56999448458945234375 0.77606601965332167037 -0.17050167725813225594 0.26978119905790032274 -0.45376607286798187335 0.93599186544529011655 0.0072658519331170699773 0.12638401102573618151;0.098856626319764648314 -0.83762085248195905507 -0.37849554829738479844 0.25285760449753102996 0.27455874728355084136 0.94495539687494412018 -0.27443765661623054086 1.5122744743184661775 1.5630881125169053814 -0.34338861495020922554 -0.052411405347906045438 -0.81685546123602614799 0.39278097709301817986 -0.26333090100880246487 0.12097861201766889339 0.081832002767729145054 1.1048203979719295464 -1.0520911954105662822 1.588443996469332653 -1.8315689923874554079;-1.1056139661757520276 0.50340314366226956988 -0.14332793521262618408 -0.16564073478153656938 0.94064407550565753979 -0.89670968859125377293 0.028017578590506762859 -0.71982771897252117999 0.55018816097240519358 -0.59515386496974964636 0.62079586533897046507 0.13518378485264037625 -0.22655171339191387814 -0.31837733283668206985 0.065605434572754584011 -0.37420221167313733046 0.24776406956272392645 0.017405886071269381643 -0.09156036068773136527 0.93448279760614594291;1.3401986394811586933 2.2486071388407413707 0.15768816315602460221 -0.46327746250027668218 0.35155375142830125323 -0.2188328199965645926 1.9754349517573250861 -0.0071218770996612015822 -0.40448936028491982997 -0.35825961718727766803 -0.75740649811303151218 -0.74364116320506534752 1.0485211634690267957 1.4373486761716651738 -1.965793856422678898 -1.6977606862463336945 1.3268870936658396786 2.6235185905611810853 0.82679338066353069703 -1.1366643267586724608;0.015320907000551661076 0.58989114372807949227 -0.15005843337744920185 -0.35036943195130837436 0.28374071719219290388 -1.4870453985105878125 0.41603062243524280284 0.46954483167820471046 0.73453659384619451878 -0.51191036294167968634 -0.96289667597171524349 0.29795290733779483672 -0.20052820267748527883 0.52006704858058494523 0.88585769534247471579 0.90237102093229271116 0.15651680370768561446 0.15865655281627347173 -0.8495357139147081682 -0.44507362411098577715;-0.027550014488225436915 0.22228725583421163337 0.25134116483825191812 -0.057497769019315345118 0.25247985803415073924 0.17906846848201041222 0.0569768836460412334 -0.72022340909850812718 -0.38475374617638496977 0.47817948109191543704 0.27674132385260702405 0.32273176116886853615 0.41822196757892182717 -0.54664163381366359662 -0.65769175160555581883 -1.6650021747263927807 0.39561269460097203687 -0.53741472999165951219 0.13204258770421045677 -0.049435528193998740099];

% Layer 3
b3 = 0.41621110044374820536;
LW3_2 = [-1.1312030231521867929 3.9624451499235244789 -0.58747650873919721182 2.0165809391227527136 1.5487927441933078132 -2.3273462169026433166 -0.63468519504990683622 1.8666147993452122389 0.17734821621368013211 1.1837650933616261639 0.50443052304218871651 -0.33004537558687707666 0.81657170166440018466 0.79534498864684644026 -1.2383770621241887433 0.27147674003910599039 0.70191623343894493647 -2.9241439245439497796 -1.5275952234270508967 1.4164259013199025361];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
