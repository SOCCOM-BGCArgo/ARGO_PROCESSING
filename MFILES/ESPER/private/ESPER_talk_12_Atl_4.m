function [Y,Xf,Af] = ESPER_talk_12_Atl_4(X,~,~)
%ESPER_TALK_12_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:49.
% 
% [Y] = ESPER_talk_12_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-8.4792961391064754;-3.0332600635521767;21.820531396372456;-28.222862400346049;10.427239069588401;33.082925353954515;-6.727460379250946;-0.95160304079027436;0.12294685327860071;-1.5313468939798485;-12.138069616915145;6.2795105663586677;2.5157642962955706;-2.1154947990057131;-9.5359743563747426;-3.5327368535489145;0.11196591868207666;9.2710735558522792;1.2163624370276034;5.1637432910366057;-7.5657012738792018;4.6033340488819334;3.6563913308231792;-6.6248402525229171;5.8535142357187322;-10.288890124719652;13.246330101733189;-3.486865655288498;2.2508354115453999;-7.2357079824511175];
IW1_1 = [-3.3258251078048944 1.5710533130332001 -3.6858204933103389 0.040735474372644187 14.237835969120159 -2.5089508356112558;0.2601054011191144 -0.4133513970301651 -0.20347185692090011 -0.28596287582039603 -0.83861129244602339 -0.26009807745531521;-1.4398455552441853 3.6132799152014319 -3.6246990974019631 7.8909334556484998 -35.892759123516527 1.3898829370357826;-1.5555494349839714 -14.018085833693053 2.4065380482578425 5.224032407931281 20.48573794601279 -3.1942320221866125;-0.81838138796321225 4.0600551279723538 -0.60165866253186973 -3.1688653013635699 -14.364615763440618 0.72826284956814979;-0.78544862879662447 6.7432654266459453 -3.3135087019419869 6.7038823299841539 -42.290716862117989 13.639970203953782;0.78614206575081602 -0.030676358819145551 3.9317365607715939 0.32920540032421608 12.01773581009436 5.3750996242751139;0.20299860928216315 2.5318330831503841 -1.6826587104722406 -2.3801199216479922 13.357639958698844 9.0303261050244306;-0.26747893400008954 3.7687374697268696 -3.6024862794557984 4.0763322185938495 -0.11802772035740494 -4.2746275268669649;2.7772339547535916 3.768579423580821 0.41184534900288494 -6.9299698945661055 1.4203498016818785 3.2121344437739081;4.4607799826583072 5.3066529640844688 -3.6874910088933284 11.587598560529534 9.6016344858104148 -6.0167107981992887;-0.15875995029229978 0.71287310665924564 3.6226496920747064 1.0872417125153215 -7.7828578100136214 0.39265871552159504;2.4225642010202537 -1.3828478534048387 -0.64424614055998153 -3.2134334122153967 -5.9848812556236295 -4.3224806691247144;-0.47788610463100756 1.6817908079874371 -0.4236799349892077 5.6677416898865038 3.0861605383306947 -11.282866806435454;-0.80839797867365204 1.1362411699914154 2.6462785093460908 1.8349895519872097 14.508632418657623 0.57195330407919553;-3.1246853803187831 10.126997585603435 -0.64414747667891659 -0.65812521032004723 -12.458734910370559 -15.474737809371788;-0.00013288330421717406 0.0016500750329182872 0.0012466600767858718 0.0039564308017126567 -0.025242680409037415 -0.0018779759834696365;2.2994049878847069 0.93954623555830319 0.62322874838101239 -0.25451904139923942 -14.081282609311431 0.88197706422471245;-1.1301136399471745 -6.4504534183267372 -1.2818164123981688 3.0831595646010728 -4.4749304094756397 -1.9149600223705798;0.14029036112620266 0.022472939126203201 0.2238339370926157 0.62498289827634324 -7.5642015350615148 0.2580543626778104;2.8635885620322705 -12.666679557850934 -5.0274934918195102 -2.4202160433087108 6.5133647533794559 -20.700850744872142;-2.6185761283399827 -1.2722237016183173 2.2349195526180123 0.25478822190838396 -8.2399901205279455 0.59202131559370064;-0.077097933520330342 0.45050700659524773 -1.7644096287322846 0.17160497681182346 -5.4769335173486882 -0.87289057178192508;-0.61896300995670805 1.56281104857446 -1.1812971180693295 0.79046292802532581 4.4497831682622309 -5.3757100697777043;0.013853355286900026 0.35347240779777611 3.6760736439491777 1.1370133141091201 -7.7410657761551027 0.35070505584069622;-2.0066495039037444 -7.8474512266355072 4.3823773805510244 1.158416043932571 14.358047327165846 -3.0900035304889166;2.0580265464692564 4.6400924100344909 -4.4409722805280092 -3.5051220752643899 -17.412937744245596 1.7104799786427236;-8.8342629697522508 -1.6608108994428084 -5.8087032991606202 4.6116455437010213 4.9832050396590208 -5.0823905640313214;1.802781839156014 0.033712710043599818 2.069667029633774 1.6218795611671966 -2.5328803450857862 0.072284419701294386;0.99844869184900387 -0.6990335238030454 -0.77641881090778375 -0.59946792801580995 8.5758071236885201 -0.74152981795182993];

% Layer 2
b2 = [-3.3168255522514918;7.6825362184663435;27.210766018812038;28.555034727863017;-5.3506350078994132;-13.767413476562377;-2.6040406422695197;15.209671016449173;-28.60035107669508;122.35557547815102];
LW2_1 = [-179.48169338575138 32.273479905725402 -281.91371510328349 -92.117095029229333 -71.930856684773786 -68.630743456243977 -22.378292149483087 22.172587431108724 7.5924623411597647 0.5149411734198247 -19.148589901510714 94.009902010164197 -53.590947725206256 69.746746475512381 38.662975174681968 -222.34508591942227 194.9408741109784 -51.459240980523923 -10.3928561429308 148.49210845045721 97.273952394158528 3.3620328685235785 -81.526708113327558 88.901069065415768 -9.6767652188406679 -22.015817646580967 -21.059265708671798 -5.2482224007958145 23.062651361472138 -82.567409194272642;-39.505740667788693 56.224787934707379 -6.9970862347409994 7.8788289765407296 -54.472236221806497 191.63328226980073 -15.017631832357225 -3.6815686163801011 -4.0011686507142272 -8.6138077191905609 -29.982809870900102 104.36850238579855 3.1862925396898389 -37.18162773173156 -9.2127224129791632 222.1425425541708 -1.0535828947547559 -67.142393697512489 1.3345236405971106 27.89325555262127 -97.313073617084697 -24.488167353726617 8.3949564443023394 -38.520755200599481 80.584038696623182 21.836330548003801 -1.5676348243469713 -9.6990526168654778 -12.238805880469634 -3.0607654404258726;-6.7326947373390444 53.4756528881219 3.3121640550105926 9.2168250916416579 4.7366834427088271 0.082689127345759228 2.36222849316884 10.09222921399131 -5.9203425160655341 4.2373513983467932 13.666339429140127 13.117713363231655 14.951762722399389 -12.659342327475141 -7.3868345311877706 -9.0618035504811498 5.8760448406701746 -0.97282796597331656 3.7336870414783832 17.899513816849826 36.42154674541618 19.821048139478048 35.248087919087887 12.244203287443217 27.205583585544385 -18.21451707679055 -1.7291241086824016 2.7835582979856066 4.2760674909924559 60.720147691672004;55.888003052531467 121.54741250306925 12.241541817947644 -70.821384922593666 5.8423650237942137 -4.5192267117586757 22.60351270894072 37.507514733692801 19.569637483518854 -27.218782241944968 -39.573585830200955 7.3107186230274666 19.210455802415812 -105.83312167161235 106.91431213421038 25.755146092145537 -11.284361977553544 -120.67298389428134 -29.086946020181635 49.505954660842491 -14.119693582106073 2.9559225164042364 18.927409571166635 27.140120461615041 -40.667270863962251 -106.10416073616685 6.5555902347180623 -0.44408603313939327 -33.823482055770569 282.56147483524728;-22.870279731983029 -11.341706250158628 129.94023506391611 -53.327857444142587 18.829414571462515 -253.23732841862204 -114.16430218455983 77.565337483381157 -67.465264191816004 -143.24345948541981 293.55914184609821 37.350986041713433 26.321259874925296 43.087342902927695 13.228018393882541 56.274759646404746 -73.77972289461502 12.027840220959689 124.44020259153304 2.6309332128891385 9.4290277572410588 8.8492685567709692 68.231872544303997 22.157373607167745 163.22125463684733 -60.975246979096632 61.148390566947818 52.798477621262485 73.813784996287467 3.9831403494679609;-14.180215164621346 22.828940452613253 12.951724394277072 -41.515276613628913 -14.800449739661877 7.7220215142074027 -15.756252787291308 17.691925312966404 0.91141564473592629 7.9796585600692209 -7.4518885913846207 9.6902624391532779 2.81318415598269 11.892068182369416 6.2186339391260175 13.34616594326927 -18.241306498563247 -43.5241590108472 -35.875120282160026 20.534792705808638 -29.903075247581064 -21.880186750009358 12.262017894318225 32.156043281638851 25.964768414888667 1.8089631836608238 4.3831868553867661 10.752642295513114 11.805154539937725 76.23824601361747;0.0059288699986289684 -3.3372439944929262 0.0017243893970928931 -0.0002668614718356443 0.0047654484548352556 -0.00043129841946950464 0.0042645901819278881 -0.00015717598881171048 -5.9293262473275918e-06 0.00033735414080739086 0.0013720205777670092 0.29108878802872334 0.0018439735295836847 0.0020443628517195314 0.0084207742727643881 0.00254948420810164 -11.362189077760794 -0.012096746571550566 0.0026012260304796933 0.055840343412645606 0.0010592704375332385 -0.005625640128881804 0.0096259210536577145 0.0076982597989157199 -0.27929719330118641 -0.00056308073583913375 -0.0030291550184130172 -0.00063604298740518959 0.010026299826519064 0.025763631983332747;31.156983538450483 -11.565845769028391 74.575591279303126 -0.77764782218523476 -9.4738907465447024 -46.380956495859863 8.6266073267024996 36.182961629688684 17.345214057101149 27.238149711329321 -19.010698105815461 -52.20266294073982 16.70092516145364 -88.72250640453565 -33.112355487616114 -13.943565135053852 -102.46223765811759 7.3127180849733122 1.3572710643080215 -17.230081220109398 37.761739866334786 57.411436214079544 115.22803489468838 -41.853011246543467 134.37717023570025 8.665153403892889 19.67346825783024 12.273862054632193 -8.0435219654973746 100.25012925769666;-17.184669108007306 156.6805014321757 -100.55315905756382 52.243127887932573 -8.7573397759796592 53.03562195076222 39.09299497440508 182.26015691033109 -21.331823547689289 21.107999899979095 6.6026865701574931 24.366174406110751 61.717158606944224 -29.002658255989875 12.517077861899221 32.918736309261135 17.679918698731672 51.337239568222664 77.566537786575125 41.482611031287547 -11.623664796123828 49.638610614944263 37.654548711717794 54.029848459318664 -9.6145360677373883 106.50566255355233 16.504065109925772 -48.557065783624772 73.893826451678621 6.0951202899069017;15.406805889706831 -46.725272381205748 -15.035420036634575 -106.4210291907041 54.020576227531002 -76.129365824925856 -44.80087724959521 -33.576768082845206 1.0884873681060132 -4.1588639170931643 53.872820322515757 -63.182526936231817 -9.524849622262817 12.515279960733938 45.482748212968538 -25.698092921176727 16.873988252839581 69.634395503095789 17.446056903017922 52.242277781289715 -5.4957891887970574 -30.242938568283286 -112.14936372280712 -12.600739672681911 -60.695162610160793 -14.120429473619797 -34.302365904172213 -2.4684290022373809 75.122205412185181 69.8862407904886];

% Layer 3
b3 = 1.6849658007813118;
LW3_2 = [-0.0030500917275319327 -0.0018059110037817673 -0.0014648168759756732 4.7533367021323063e-05 -0.0016275222459342464 0.00067498353104306237 3.5918679023065647 -0.0018382938243995284 0.0024709136061211424 0.0091872475547807326];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
