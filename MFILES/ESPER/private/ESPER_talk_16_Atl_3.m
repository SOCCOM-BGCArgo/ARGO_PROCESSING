function [Y,Xf,Af] = ESPER_talk_16_Atl_3(X,~,~)
%ESPER_TALK_16_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:51.
% 
% [Y] = ESPER_talk_16_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.390602740313573;-2.4013971544420092;-1.9650868015560781;-1.8722740572324821;-1.1958293603812009;2.1153054737386974;0.97787562262866934;1.3158446382182878;-1.3085076154034134;-2.309848086959339;0.12007128516399314;0.78613721240099321;1.0380914563753674;-0.08714810031980777;0.80705257188119461;0.66810758972031714;-0.60865790276419351;-0.72037783265751598;-1.3510123504003535;1.6077699880579444;-1.8829382016701335;1.1869866482232161;-2.5835060102354896;2.9718642118595864;3.1240769072073475];
IW1_1 = [-1.0131034596099184 -1.3052481872400723 -3.0206687528397729 0.11312218583871517 1.2823871099989557;-0.030269195039093203 -0.23919614051070048 0.17166233848840204 -1.0258244893413473 1.0712993154184129;1.3355969041162203 -0.42483833783334818 -0.82433228314473161 -0.17924044452731749 2.2647626811991342;0.13709227159925522 0.20979153051664137 -1.3890451868698812 -1.0312154632506247 0.43541145386908259;1.7577976255876542 -1.5564539318316564 -1.2203075160493539 0.42283133874569123 -1.3412158280701187;-2.2159845300808585 -1.2897671734834033 -0.83209676355127926 -0.25700314364433591 -0.92193183151016644;-1.4182144627574069 -0.67739911599752378 -3.6761750795820309 -0.74818587829603722 -0.91691846939093202;-0.29764909279955548 1.5709675028028214 1.2465002679241763 -2.0635782066817425 -1.2426939919162334;0.85470116652924311 -0.86799251725506754 -0.51185560768183325 1.2905937427314511 1.5196006138102272;-0.044737271719772126 -0.25729080984014052 0.27638915511706219 1.0748567463418388 3.5000810297718172;-1.1961011847391378 0.67671136207780758 0.75212170317542126 -1.8567861284814939 0.042296964307107957;-0.4396567152901063 0.88696052034788531 -3.4915807629672924 -1.0645005530865765 0.8032186285429409;1.9263128921785813 -0.0034967988310619421 0.56597971331182362 -0.1829050383024852 2.1051403945061611;-1.9818115355554549 -2.7928767305739131 -1.8492202091171175 0.019844656130354049 3.5332761586650481;-0.87931048147285673 0.31515596303048937 -3.6634030181395594 -1.0782483565349423 0.23751815796306178;1.0172075163896761 0.73972906039907849 -2.1498923554952176 0.88737164985485462 -0.61806989147699309;-0.57514982107634383 -1.3686759895199823 -1.6419096515870266 -0.021464812558467241 2.1646941325591165;-0.50853134273706657 1.3476928560168278 1.5713075957891376 1.6070953540619473 -2.0870552311226769;-0.72569496368752562 0.8036003050126701 0.27508290710760902 -0.23958171163364517 1.8094520623358648;0.80365286708654404 -0.84242983315212816 -2.4841608246035425 -1.1943363131098506 -0.28333977375828651;-0.17730170232743936 -1.6820814937100557 -0.73224134804810903 2.4837035982254418 0.45025230157589891;1.0442820689186216 -1.6140086374412499 -1.340505535724184 -0.42994398257676197 -0.93184236760591932;-3.0078543253396859 -1.5863158888221212 -0.33005590759894921 -0.85669995691933165 1.0531329332751744;0.82460028491535586 -0.99721666571757572 -0.79243990885460569 -1.6826168103334505 1.1373806445246792;2.4116215202625648 1.7948858985945111 0.89834560332459878 -1.2370643472591618 -0.857900268476951];

% Layer 2
b2 = [1.481643155791742;1.1963641615751206;1.5741674536854984;-0.81609038333427897;0.5100056599413092;0.45145500392633015;-0.30541510946369521;-0.077316775124881457;0.20940981385648347;-0.45682042289268315;1.1966519290076327;-0.40900538729028196;-1.0119917449594349;-1.4012150488253827;-1.8141611288821691];
LW2_1 = [-0.68786620436673951 0.170488468379767 -0.13115026511637295 0.71535149407570264 -0.03274767796599027 1.687292520269531 1.1631969264794231 -0.40592367222422765 -0.452949794299214 -0.23600518979105337 0.32866658607883542 0.54950291026348974 -0.36468899337695015 -0.93879581099374332 0.48725328895503878 -0.47586049805459479 -0.54544000558822869 0.70111819744352044 -1.0694797534795104 0.31890302745146715 0.60631719236703108 -0.26413652631120904 -0.0062262667880279114 -0.58043213433498708 -0.22147239982773534;-0.11963311509650931 0.062744644495442925 -0.68179853439392979 -0.87816166241617921 0.054508351573446516 -0.10289642219090739 -0.14299945788824864 -0.099778140311348795 -0.28540234023778882 -0.44581223509581236 -0.33392556831434533 0.2064330111998928 -1.074958049302529 -0.14232350616645012 0.68456143852901508 0.11499971825100326 -0.21488645119893748 -0.69623514054776736 -0.48303256426793484 -0.054733870056244811 0.28494561108021654 -0.33750879428487818 -0.12781198561419996 -0.33124841325472454 -0.083732721898837098;-0.15960163840947583 -0.31497627805935491 -0.86845484529112615 -0.56184791451150906 0.23374990227789241 0.31827462837962961 1.1394729623956261 0.10945962187480077 1.0637536197410726 0.22324285667624599 0.52998675904884984 1.0906110268821054 -0.64547673695321517 0.00096420553291249027 -1.9926921308447501 -0.042086666717654597 -0.38995156960267441 0.6323102222568151 1.0872951597972202 -0.097559854331723483 -0.15652384233539621 0.77333899389824279 -0.42521819203396027 0.26672885437179761 -0.3568682540907519;-0.20093449258217322 -0.21324563230471782 0.028568385608426446 0.62751024572887337 -0.12643610943232259 -0.28152161851764029 0.45177171060610877 0.2238448813738636 -1.2508692051666173 -0.28990734220313058 -0.66173760753002686 0.69570588994172167 -0.10330927090494384 0.24296657626924462 -0.30353426782601767 0.28277289726800664 -0.48292256721099108 0.63928433109986449 -0.096523408790065282 0.22297214634899906 0.16214854380478122 0.73716992475606946 -0.078369916545602686 -0.067469018506144313 0.78925544104960577;-1.1531034568270406 -0.09491358142097242 -0.19367007228938052 1.0999301431359516 -0.20918863884573263 0.11927038356793722 0.46494524714553231 0.40347120376705659 -0.68729771089907943 0.31387827248186584 -0.57961075553984931 0.21915658116514958 0.47858985003873061 0.13861954394128098 -0.086512286452402734 -0.23443088408875412 0.22756921878563213 -0.27655757271897674 -0.0068875942067696972 0.92624698324773014 -0.3956478995796639 -0.55329718438358144 0.48569894002210451 0.064733487688406727 0.095876368320578512;0.87258799973630119 0.79929171375134078 -0.7002595380482427 1.0135491345094736 0.78482659505691166 0.6739954834022639 -0.33847495082141438 0.43282198357030705 -1.1256942184995626 0.44382277294660127 -0.70408077187767459 -0.50979082164034439 -0.86762138742483508 -0.26020004869772495 1.0844814381883829 -0.59599685401905966 -1.1564674278163556 0.88997920596735702 -0.67134409105692872 -0.29934512388692008 -0.47650381374560274 1.7186008090708196 0.10526830425578483 0.61942220783583568 0.62890645912895693;-1.2282893424490955 -0.9765680397107338 0.43173748262575878 0.55278661082816827 -1.5479841281019602 0.28601531776010253 -0.78813967669363694 -0.16009456192234225 1.2093446043192768 -0.021479385720647427 0.82301646658999006 -1.3904783101821461 0.30726399832031087 0.95950502954570283 1.5240142435266339 0.84748814677964179 0.778796384837249 -0.051121418442472324 0.33071762716857867 -0.41302185445761486 -0.22402627547835732 0.069128045579210567 -0.60702463573038756 -0.19646419516278552 -0.64106249405857318;-0.47839612610245519 0.33687674092332986 0.87678564609012177 0.26464056477812864 0.14574900659505047 -0.90010906227395682 -0.83476826527225823 0.56342580231711226 0.11527900603541105 -0.15375776576825384 0.67088322335762096 1.06456321613895 0.21163536092415441 -0.66291068843638346 -0.18058557116212659 -0.35351832452375209 0.91558184973966872 0.6952739432691688 -0.70219260890640278 0.091601267120118346 0.72015222564923842 -1.2475074654359717 0.0071715742246765725 -0.20569901739267069 0.12963797444293373;0.095576373776193102 -0.69465101026590503 1.2328977531481005 -1.4977739997819177 0.35641915100633942 -1.3888583136801824 -0.67897931721159166 -0.76695628549482853 0.29143630696845046 0.33199910161909668 -0.18546352891742293 0.21558166524959418 0.44799763443388441 1.2250639015340696 0.85583559208689175 -1.1853575451721352 -0.45251812573902139 0.21953928312896992 0.59602942322994001 0.20649627476699325 -0.26101172150358737 -0.68156786553574933 0.027798081951686648 0.099611649562289337 0.074261720856527838;-0.55016698101284989 -0.60815810209716858 -0.61606188178277332 -0.42111043677063359 -0.95689649070474536 0.58515810766676579 -0.26554025782618013 -0.47344394055850425 -0.75300977194869601 0.030908879842322108 0.48969769198966584 0.89056273053087653 -0.098885889387259188 -0.33283310554150219 0.61155992996226949 0.91160028533918569 -0.15464000247772008 -0.86292366270084353 0.4967339074868613 0.66653029284482146 0.74042700270450901 0.15434422247292523 0.22616336100598816 -0.18814306962905461 0.56711659510221746;-0.40491801688709783 -0.93403833073098896 0.26989922311793485 -0.22872002072283076 0.15841517490519616 0.33692699192210246 0.7997450144536894 -0.095943728067571329 -0.77125861909034377 1.4251892361834697 -0.13669104226919659 -0.32790156168791768 2.1325875318959358 0.98839371053343072 -0.88732984817712712 -0.41405725202648969 -0.59899879700908121 2.461396662695686 -0.17108034395120145 0.90423999491664298 -0.30085776416627114 -1.4039431275557577 -0.2038811483678202 0.83790905138866567 -1.2395926804396789;0.40944635327627393 0.02443411933912815 0.24949228395838002 0.081101309578080122 -0.94481112418317825 -0.7803756874215525 0.5081247668822344 0.44025117846104672 -0.35688782496226035 0.1980514133395446 -0.78210392984132271 0.25071699828250527 0.29825408785662283 -0.19308659793253666 -1.1338945964755076 0.56675943798604966 0.10431750199783149 0.061045090724663943 -1.2032417198969736 -0.32527837343953547 -0.46036856286621963 -0.60677589975408941 -0.65760776468614557 0.29969348140342655 0.0094060442945742787;0.45967053733846519 0.49898018612807771 -0.39261978882126136 -0.75963639829885732 1.6833116953193017 0.12435364063271999 0.80117819814741975 0.48480423420294388 0.41547882858967006 0.64622144577831986 0.12906898765203972 1.5587302801851002 -0.5063937656199432 -0.87804891339447066 -2.5010580316177848 -0.89207185884315143 -0.4307610914893929 -0.19291981120934865 -0.30768221329794343 1.1481188032256151 -0.17017218419484115 -0.96866820991426772 0.51003674524831222 0.42364391314980487 0.45891882118335181;-0.52467366333516563 -0.42449659364541603 -0.47176194912440977 0.63290069022427653 0.47965425296315151 0.32726594042543017 -0.020812013894768791 -0.12037827984098984 0.50677966065328484 -0.55469345004244197 -0.8101115624723797 0.037486302980420924 -0.60497722772783491 -0.38225366116923198 0.28010067717300097 0.16787405412589015 0.033654016062169258 3.9155893456948969e-05 0.52963691438908256 -0.11377265902207413 1.2125056051091518 -0.075880996336208442 0.68393764640440069 0.20505854728393327 0.17313221601798395;-0.090502161326707728 0.07800890365780902 -1.5408699124528562 0.14185683930619397 0.44908701185066313 0.55016739491832833 1.2012864857349372 0.25380185291372337 0.80448097717063538 -0.17728906505125999 0.54463040580629185 -1.5541846591000719 0.31415013740185943 0.27463163473266822 1.0484234899231415 -0.13039186408387898 0.22942949034106569 -0.48787773410032453 1.1045873921942713 -0.051791229575636206 -0.43216498115189061 -0.30107485318107974 -0.067465534907390906 0.63279479886399148 0.90741255857009895];

% Layer 3
b3 = 0.5406478733655552;
LW3_2 = [0.055980828865656744 -0.38962156127940606 0.49066578171348085 -0.55319420276984066 0.23978377395494868 -0.15003813622050699 -0.42461681437690169 -0.12559668044513433 0.10818286066521478 0.11457723340194895 -0.88147253439775153 0.23870485231044333 -0.41323289463147816 0.38236003526201762 -0.1302044513509687];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
