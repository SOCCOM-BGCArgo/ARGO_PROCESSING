function [Y,Xf,Af] = ESPER_pH_16_Atl_4(X,~,~)
%ESPER_PH_16_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:26.
% 
% [Y] = ESPER_pH_16_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.5167283298119862422;3.0742690436962401002;2.4339102235035752209;-4.0060807622976541964;-2.3051178404551451173;3.4581983704140566438;1.1541244795668592626;1.4909665265618217145;-1.2405851433855277222;1.7560397689857090153;0.98779122302916799736;0.4654262543998163304;-0.16698129592386506959;1.545716423234444914;0.24950689632115596872;0.41668315806052586003;0.084581316224860828012;0.27615786453673840661;0.49622177552918306231;0.13635206910330743835;0.91260656431697917412;1.6172238030948118404;-1.4093289192327289605;-1.6582519157378541319;-1.6619207336924282092;2.9787987384850325157;-2.1387127294286001344;-2.4368953911920083755;2.8279565236182753196;-2.5207126876697647511];
IW1_1 = [-1.2251077836502872742 -0.45253639433895681554 1.8824068528281607815 -1.3043377891702978566 1.4424702518618301994;-1.8579599189849513863 -1.2510312855368665996 -2.8133035039773535146 1.0813761960724723732 0.39983670455660852427;-1.2797577804623219144 0.66986102450697537769 -2.4165823496131859649 -0.088022582839741569938 1.699696827229755014;0.0063182045379499181259 -0.63272893689465992129 -2.6843799982560914152 -2.7852800835792472789 -0.49869774422315854556;0.87387832390377151448 1.5522063809631643228 0.65179865994345953517 1.2156445238572961554 -1.291843208821463751;-0.49470335888355204679 -1.0576706620069915576 -0.97020827632089068349 2.4726295435607434925 -2.6882022254000323969;0.25282400618400313608 -2.282508567212010675 -0.10880890429456628599 -0.86214309776662634288 -2.9204396557768141918;-0.23334885457169229905 -1.5441067287736713887 1.8573000190021362599 0.69391880135278161124 1.190150604624571784;0.46248878261829068359 -1.9526635958494176215 -0.51295825099695235849 1.0317125515130232127 1.13106009916492245;-0.91501370566677875384 -0.31680384797700011923 -0.97679155676926732177 0.24438225987457387611 -2.5126212817343365202;-0.75218680899957590658 -0.8508240544958192153 2.2466447363915995616 -0.12185848781083390147 0.85840007969728793213;1.896114042648121778 0.39617683842409678885 2.3149161105427022989 -1.8842682885062120857 -2.833323295907104189;-0.92673101037682159564 -1.1913691772610763842 -0.27189982213722269089 -0.6598959415468683698 1.3941354883868706249;-0.83273297202400919925 1.9324984307624588631 0.29669728212505164233 2.0203972589828196327 2.2154336994430487984;2.0147789771737860676 0.66138303030860123854 -0.91656400448542207915 0.55673433782645476153 -0.48767905661224630887;-1.9161901653383277555 -1.1724303543557736962 1.718620437964240466 -1.25805654453664717 -0.85225952538265259406;0.14100565557898320224 0.43908197267590959312 4.7232318266913448923 -0.88115278262787732899 1.411251316244790166;1.9138806893615092353 -1.2339139835935923895 -1.64129184351917079 -0.49256672809685164705 0.92057270345636210696;0.2809699273249836593 -2.0825822477203583816 -1.3540092823181677506 0.64666640470029868037 2.0016757825818474181;-0.33577840440791728582 -0.89683196510882889907 0.93680516273527980609 1.932538450784324624 1.3829918900575652874;-0.1803221651969249828 0.74453578494768557494 -0.76159262017058970695 2.6977770722931553316 1.7187880192416917779;0.22585988855626945582 0.84022719935064982266 -3.5985108601170296971 -1.2313053939093505651 -1.4415175290542106001;-1.6135422922933158052 1.2193364000547890491 -1.0060725596735784482 1.617774053422342817 0.050385007225181167867;-1.136393203671847596 0.14314709826470040088 1.6938652944116519006 0.91454232419153469458 1.3388909082492403968;-0.66854932928355015331 -0.29062301529598283389 -1.3401666382106256492 2.8886384222789960319 0.57085822641854822024;0.6612740521982959363 0.45492185144045071965 0.43036378587047030564 4.1394499252324816752 1.0902820606471406162;-1.6704762590202564265 1.4388186755666765304 -0.28656104127835907436 0.79291645668341714792 -1.5478860896054309482;-0.71377871767672718128 1.4572184574221032083 -1.0272370567442981049 0.36921381994200019871 -1.9126011297890515017;2.2734307012984769081 0.90114875433810670557 -0.038278072580435099082 1.4809564907419709989 -1.0636531000627067467;-1.2934788801556313942 -0.70378562664695176743 -1.4257519081366116787 0.68299776056464500673 1.8727438862151346566];

% Layer 2
b2 = [-1.1925049144968520309;1.210852062822135089;0.56891194888933727114;-0.48881054040496718649;-0.103851638969751775;-0.26428904069542241695;-0.77730448522367712183;-0.76903133205315032939;-1.1382133716394711165;1.4261398139009153763];
LW2_1 = [0.27332388829671033781 0.32067905103443095083 0.33937145198933599266 -0.59588014011954515414 -0.63923751343593548935 1.6318751030744247377 -0.77141693716529624592 0.1943156075162877916 -0.61941974998911841777 -0.76339203420425827407 0.31852438098442964476 0.065733357073140430415 -0.47946122184802936195 -0.079464534229683095323 -0.53361908810176739149 -1.2453101546537510558 0.15356545460969914241 0.62472052770677266587 0.53310573710859132657 -0.26180186087075546508 -0.47885282618257307696 -1.0140040809992993953 -0.12462578906235358134 0.40652098945222187032 -0.69271498781369356124 -0.22331014848879657264 0.20145946150410262709 -0.10171882968477041764 0.29518605127878599914 -0.18853045409003899024;-0.5001742163077153025 1.0847831784826358348 -0.50717359173320475385 -0.93276732968519460165 -0.13757889984066321021 -0.27052483501545737665 -0.72385565116476036085 0.33016706022595238013 0.32596067430609781956 -0.28426005458160158446 -0.14400795150948811352 -0.8374668368363070714 0.42496935674689806373 0.25354627312695759978 -1.2495274957705984065 -0.83772877933904210668 1.285846992567672098 -0.23568141815022411456 -0.1867134925644272081 0.25852097704387833055 -0.54866588189424192468 -0.35841202581601894206 0.10893066738205396671 -0.38611712310533641279 -0.40515551915034808683 -0.1130223168986224519 -0.19114727335154108046 -0.33457297525858653575 -0.11997323023372603867 0.39026524607019313917;0.15514718447292485948 0.79447883798051976978 0.41326792332657613649 0.63221831065963063345 0.27282892113585688332 -1.2216207374904684002 -0.47123884776578173206 0.39852577964619689821 0.4708370669977120504 0.0014542393900076992785 0.4293888140248242058 -0.63248154346380924817 -1.3062727086530545595 0.36749627361371489664 0.60122610071916426921 0.81303299735785850011 0.66040623979477242056 0.087028014212517518233 1.0301067521264530846 0.54637799951812471289 0.46975274099882269319 0.26966869509027269203 0.32788670335796155086 1.1995770393327900294 -0.01441342081122100674 0.62160131415110431163 -0.089799702349441942739 -0.059750565151822442045 0.3288030652948836785 -0.019440115341263240756;-0.055353079964017393166 -0.7872997968630389698 0.072114263845725987134 -0.26107759101958666337 0.038511688452482664702 0.22508667642696020272 -0.89131315299118585305 0.39672598960749699826 0.0078688645913833586698 0.21916747034479697187 -0.32381707879944243711 -0.17850710646847608998 0.32876558547620537976 1.116566264962100874 -0.24039706578365860334 0.6503823462473593553 0.21397916413152276438 -0.13677324437243890132 0.11944461754684587707 0.0044499311505353453255 -0.20797750444258616964 0.5524260550031981909 -0.35774184353572824335 0.38395299891568640538 -0.39740034950172237194 1.0068142555309647079 0.4677049685393898093 -0.073436492904209463295 -0.048409074420850975451 0.6670104135466696782;0.19913556241753832543 0.97743103837148181956 -1.3203892440782003526 -0.4995063872307975994 -0.12535561605272246832 1.7335040057285162618 -0.43324217392923769498 0.04368762332089311945 -0.46014415775201056302 0.51482711973618289214 0.56833137457303173345 0.034801943973155433087 -0.918498433746589793 0.90026364115451851244 -0.025582752799423139067 -0.57011530067246285469 0.2588744636660368359 0.70574562557253073258 -0.88757520576458104333 -1.3313843450661420054 -0.71581864447806253793 -1.6164565219123119277 0.13548899533014766017 -0.71169678631093991061 -0.60642957601460267814 0.66835195504618094553 -0.3346766758519117424 -0.093300983165396894625 0.14250372900919278107 -0.55058604551882772693;-0.55923425985058805576 0.31528120951102511782 0.84139479449186171944 1.0797693294966059785 0.37277943197342811033 -0.82339091456131974223 -0.81708145931643105797 0.82999115940904555355 -0.24176432897444655179 -0.29876506445043621296 0.39281001077679428279 -0.49507592276628759054 0.056885756728805025872 0.26122160517133230506 0.57548091726738204166 0.80022161417677095674 0.40892265032162050664 -0.57980635080370812595 0.51087449824601705028 0.88957408168396645554 0.90396443068931175979 -0.14761627462919399423 0.32452889320991357147 -0.88173356664202162669 0.060755185025871349946 0.59455313572212553641 -0.30835026954328353943 -0.18227002680103432386 0.019252981443171668374 -0.42350261091610746922;-0.3869247657715166322 -0.74092179915483891151 0.32398443143393224064 0.90051227075273987399 0.35047204604609222267 0.36097508218084389808 0.76510877084175321627 -0.093629342592137371204 -0.51899221164544495632 -1.0373470271429059419 -0.033493975486676735853 1.2916039420850560226 0.020829582075552605103 0.57364938996088077339 -0.3695268967689780415 0.028592548096823714593 0.1994182942460161756 0.68572035804466080489 -0.82805630983088174268 -0.40015039493662124537 -0.38074038228851003751 0.30348434814428820738 -0.14564006751051650213 -0.6969305777422547532 -0.083726504042731866861 -2.6198186681598634173 0.61701154524279822056 0.43631344925602516538 -0.69106270806014014063 0.27750801161752092217;-0.082893356635647522102 -1.2235943351017746217 -0.16050758188983263453 -1.0379514175144635146 0.20637059034543026037 -0.82329285769783644433 0.70482131050821172913 -0.23406275552582583854 0.58303772983388180151 0.96255640929680341689 -0.14607873339514559907 1.547673665998121173 0.23738639410812348296 0.47951061025534419402 -0.47615157186118572952 0.12000378454350231483 -1.2604826978909948743 0.64369178411556837727 -0.53313033077840488172 -0.85959204564886293465 0.28311346601994930028 0.07934700734464925076 -0.13219053090800589323 -0.89578005261272752868 0.29585583209800841997 -1.3179087994275451301 -0.056345314795996657986 0.40432326946701308001 -1.1368855468015399701 -0.57627895155946773365;-0.60926878066587586424 -0.25031431481641608361 0.38690055718718197042 -0.29354675523383810809 0.3032527654986043042 0.092064346673363259277 -0.18812757992975079335 -0.09636134211883690126 0.38761080765706984463 0.3282376196990382522 -0.19420902787908228548 -0.25457632523953999115 -0.27973261756688860835 0.15482455197501479582 0.15196330503437968651 0.29012741593719076905 -0.12319024720452068089 0.1792731314486337435 0.082729156636409797998 0.46640653596082831678 -0.042595283841983896944 -0.11713833936594741925 0.031680735888776054288 0.68173239518912354118 -0.10352085066979550831 -0.071129705615591093393 -0.30048293372800921608 -0.067488895216503891339 0.31348973541749625138 -0.20629898880736161071;0.38110762121672175917 0.64521183796917591646 0.49237789934197279118 -0.24663255821913376842 -0.34687803786727833266 -0.22831043283945903766 -0.50269409729099212569 0.019691304875127470242 0.3242573852201061646 -0.75602421009325249113 -0.0041508459354599423763 -0.56038410693131934792 -0.33675073155503942868 -0.27405521677347816079 -0.25209301495902608492 -0.37356022705388070015 0.57995458024286983267 -0.35625141582158487141 -0.27919955906706228621 1.0579772578519830439 0.090258017879869575917 -0.073723169670634289274 -0.24323703185885484079 0.28325350478987021408 0.087661076396826992374 -0.094928062565760640279 -0.34026373777869817205 -0.051759284128387886281 -0.83274098873903690254 -0.016246551781523316249];

% Layer 3
b3 = 0.02080104564956641866;
LW3_2 = [0.81954022191811504161 1.1451464618981406218 -2.0957373713672691196 0.17938926720722406238 -0.62747508407256213925 1.9863264693595603649 1.7338305977447998618 -1.664651029776563762 -0.34217609147496014232 -1.4147503992917787041];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
