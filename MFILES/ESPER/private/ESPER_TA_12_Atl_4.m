function [Y,Xf,Af] = ESPER_TA_12_Atl_4(X,~,~)
%ESPER_TA_12_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:04.
% 
% [Y] = ESPER_TA_12_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-8.479296139106475394;-3.0332600635521766996;21.820531396372455646;-28.222862400346048872;10.427239069588400966;33.082925353954514947;-6.7274603792509459765;-0.95160304079027435709;0.12294685327860070678;-1.5313468939798484669;-12.138069616915144522;6.279510566358667667;2.5157642962955706345;-2.1154947990057131335;-9.5359743563747425554;-3.5327368535489145351;0.11196591868207665665;9.2710735558522792132;1.2163624370276033826;5.163743291036605676;-7.5657012738792017714;4.6033340488819334269;3.6563913308231792421;-6.6248402525229170834;5.8535142357187321949;-10.288890124719651809;13.246330101733189366;-3.4868656552884980115;2.2508354115453999;-7.2357079824511174593];
IW1_1 = [-3.3258251078048943761 1.5710533130332000606 -3.6858204933103388967 0.040735474372644187024 14.237835969120158808 -2.5089508356112557586;0.26010540111911439887 -0.41335139703016510193 -0.20347185692090011266 -0.28596287582039603414 -0.83861129244602339305 -0.26009807745531521306;-1.4398455552441853378 3.61327991520143188 -3.6246990974019630549 7.8909334556484997947 -35.892759123516526643 1.3898829370357825841;-1.5555494349839713575 -14.018085833693053388 2.4065380482578424548 5.2240324079312809857 20.485737946012790189 -3.1942320221866125074;-0.81838138796321224788 4.0600551279723537945 -0.60165866253186972568 -3.1688653013635699196 -14.364615763440617968 0.72826284956814979488;-0.78544862879662447064 6.7432654266459453041 -3.3135087019419868781 6.7038823299841538983 -42.290716862117989194 13.639970203953781791;0.78614206575081602146 -0.030676358819145550794 3.9317365607715939468 0.32920540032421607979 12.01773581009435965 5.3750996242751138965;0.20299860928216315048 2.5318330831503841338 -1.6826587104722405819 -2.3801199216479922427 13.357639958698843685 9.0303261050244305608;-0.26747893400008954101 3.7687374697268696266 -3.602486279455798357 4.0763322185938495323 -0.11802772035740494161 -4.2746275268669648995;2.7772339547535915827 3.7685794235808209862 0.41184534900288494175 -6.9299698945661054594 1.420349801681878521 3.2121344437739081101;4.4607799826583072189 5.3066529640844688487 -3.6874910088933283703 11.587598560529533742 9.6016344858104147875 -6.0167107981992886678;-0.15875995029229977851 0.71287310665924563668 3.6226496920747064401 1.0872417125153215345 -7.7828578100136214246 0.39265871552159503644;2.4225642010202537158 -1.3828478534048387338 -0.64424614055998152828 -3.2134334122153966895 -5.9848812556236294924 -4.322480669124714403;-0.47788610463100755776 1.6817908079874370753 -0.42367993498920769602 5.6677416898865038419 3.0861605383306947026 -11.28286680643545381;-0.80839797867365204009 1.136241169991415445 2.6462785093460907682 1.8349895519872096994 14.508632418657622765 0.57195330407919553473;-3.1246853803187830678 10.126997585603435326 -0.64414747667891658622 -0.65812521032004722699 -12.458734910370559135 -15.474737809371788444;-0.00013288330421717405678 0.0016500750329182872159 0.001246660076785871844 0.0039564308017126566946 -0.025242680409037415029 -0.0018779759834696365013;2.2994049878847069301 0.93954623555830318882 0.62322874838101238737 -0.25451904139923942072 -14.081282609311431386 0.88197706422471244814;-1.1301136399471745086 -6.4504534183267372427 -1.2818164123981687919 3.0831595646010727663 -4.4749304094756396921 -1.9149600223705798285;0.14029036112620266175 0.022472939126203201471 0.22383393709261570348 0.62498289827634323501 -7.564201535061514825 0.25805436267781040049;2.8635885620322705236 -12.666679557850933691 -5.0274934918195102185 -2.4202160433087107627 6.5133647533794558626 -20.700850744872141718;-2.618576128339982656 -1.2722237016183173264 2.2349195526180123395 0.25478822190838396056 -8.2399901205279455496 0.59202131559370063663;-0.07709793352033034175 0.45050700659524772762 -1.764409628732284574 0.17160497681182346197 -5.4769335173486881629 -0.87289057178192508424;-0.61896300995670805456 1.56281104857445996 -1.1812971180693294659 0.79046292802532580613 4.4497831682622308591 -5.3757100697777042697;0.013853355286900025795 0.35347240779777611142 3.6760736439491776828 1.137013314109120099 -7.7410657761551027178 0.35070505584069622262;-2.0066495039037444137 -7.8474512266355072043 4.3823773805510244372 1.1584160439325710268 14.35804732716584553 -3.0900035304889166277;2.0580265464692564237 4.6400924100344909107 -4.4409722805280091862 -3.5051220752643899026 -17.41293774424559615 1.7104799786427236086;-8.8342629697522507826 -1.6608108994428083527 -5.8087032991606202259 4.6116455437010213103 4.9832050396590208408 -5.0823905640313213894;1.8027818391560139766 0.033712710043599818099 2.0696670296337740247 1.6218795611671965595 -2.532880345085786189 0.072284419701294386207;0.99844869184900386649 -0.69903352380304539793 -0.77641881090778375185 -0.59946792801580994769 8.5758071236885200506 -0.74152981795182992819];

% Layer 2
b2 = [-3.3168255522514917821;7.6825362184663434917;27.210766018812037714;28.555034727863016997;-5.3506350078994131536;-13.767413476562376573;-2.6040406422695197008;15.209671016449172853;-28.600351076695080366;122.35557547815102453];
LW2_1 = [-179.48169338575138454 32.273479905725402261 -281.91371510328349359 -92.117095029229332681 -71.930856684773786469 -68.630743456243976652 -22.378292149483087314 22.172587431108723877 7.5924623411597647049 0.51494117341982470482 -19.148589901510714384 94.009902010164196895 -53.590947725206255825 69.74674647551238138 38.662975174681967871 -222.3450859194222744 194.9408741109783989 -51.459240980523922815 -10.392856142930799734 148.4921084504572093 97.273952394158527568 3.3620328685235785215 -81.526708113327558181 88.901069065415768478 -9.6767652188406678704 -22.015817646580966738 -21.059265708671798478 -5.2482224007958144796 23.062651361472138234 -82.567409194272642026;-39.505740667788693088 56.224787934707379122 -6.9970862347409994442 7.8788289765407295562 -54.472236221806497269 191.63328226980073055 -15.017631832357224653 -3.6815686163801011332 -4.0011686507142272262 -8.6138077191905608743 -29.982809870900101856 104.36850238579854988 3.186292539689838943 -37.18162773173155955 -9.2127224129791631668 222.1425425541708023 -1.0535828947547558609 -67.14239369751248887 1.3345236405971105942 27.893255552621269544 -97.313073617084697275 -24.488167353726616682 8.3949564443023394489 -38.520755200599481327 80.584038696623181863 21.8363305480038008 -1.5676348243469713228 -9.6990526168654778161 -12.238805880469634246 -3.0607654404258726188;-6.732694737339044444 53.475652888121899764 3.3121640550105926337 9.2168250916416578633 4.7366834427088271298 0.082689127345759227961 2.3622284931688399823 10.092229213991309678 -5.9203425160655340775 4.2373513983467931965 13.666339429140126782 13.117713363231654711 14.95176272239938875 -12.659342327475140877 -7.3868345311877705583 -9.0618035504811498271 5.8760448406701746293 -0.97282796597331655519 3.7336870414783831507 17.899513816849825787 36.421546745416179647 19.821048139478048 35.248087919087886632 12.24420328744321651 27.205583585544385272 -18.214517076790549766 -1.7291241086824016282 2.783558297985606611 4.2760674909924558662 60.720147691672003987;55.888003052531466608 121.54741250306925338 12.241541817947643622 -70.821384922593665578 5.8423650237942137409 -4.5192267117586757408 22.603512708940719733 37.507514733692801201 19.569637483518853571 -27.218782241944968092 -39.573585830200954661 7.3107186230274665562 19.210455802415811632 -105.8331216716123464 106.91431213421037683 25.755146092145537295 -11.284361977553544421 -120.67298389428134442 -29.08694602018163522 49.505954660842490966 -14.119693582106073393 2.955922516404236422 18.927409571166634805 27.140120461615040881 -40.667270863962251326 -106.10416073616684685 6.555590234718062348 -0.44408603313939326585 -33.823482055770568877 282.56147483524728159;-22.870279731983028881 -11.341706250158628322 129.94023506391610567 -53.32785744414258744 18.829414571462514516 -253.23732841862204168 -114.16430218455982981 77.565337483381156858 -67.465264191816004313 -143.24345948541980533 293.55914184609821405 37.350986041713433394 26.321259874925296174 43.087342902927694865 13.228018393882541304 56.27475964640474615 -73.779722894615019868 12.027840220959689077 124.44020259153303698 2.6309332128891385061 9.4290277572410587936 8.8492685567709692407 68.231872544303996619 22.157373607167745178 163.22125463684733404 -60.975246979096631605 61.148390566947817604 52.798477621262485115 73.813784996287466811 3.9831403494679609167;-14.180215164621346347 22.828940452613252887 12.951724394277071895 -41.515276613628913083 -14.800449739661877047 7.7220215142074026815 -15.756252787291307627 17.691925312966404249 0.91141564473592628914 7.9796585600692209184 -7.4518885913846206748 9.6902624391532778958 2.8131841559826900045 11.892068182369415652 6.2186339391260174736 13.34616594326926986 -18.241306498563247374 -43.524159010847199625 -35.875120282160025909 20.534792705808637692 -29.903075247581064389 -21.880186750009357866 12.262017894318224975 32.156043281638851283 25.964768414888666825 1.8089631836608237592 4.383186855386766112 10.752642295513114234 11.805154539937724678 76.238246013617469998;0.0059288699986289683866 -3.3372439944929261912 0.0017243893970928930726 -0.00026686147183564430489 0.0047654484548352556497 -0.00043129841946950463931 0.0042645901819278880795 -0.0001571759888117104753 -5.9293262473275918463e-06 0.00033735414080739086233 0.0013720205777670092025 0.29108878802872334424 0.001843973529583684684 0.0020443628517195313633 0.008420774272764388127 0.0025494842081016399517 -11.36218907776079412 -0.012096746571550565791 0.0026012260304796933075 0.055840343412645605803 0.0010592704375332385493 -0.0056256401288818039946 0.0096259210536577145129 0.007698259798915719869 -0.2792971933011864083 -0.00056308073583913374836 -0.00302915501841301716 -0.00063604298740518958738 0.010026299826519063929 0.025763631983332747205;31.15698353845048274 -11.565845769028390677 74.575591279303125702 -0.77764782218523476054 -9.4738907465447024236 -46.380956495859862798 8.6266073267024996341 36.182961629688684013 17.345214057101149052 27.238149711329320724 -19.010698105815460934 -52.202662940739820385 16.700925161453639589 -88.722506404535650404 -33.112355487616113692 -13.943565135053852089 -102.4622376581175871 7.3127180849733122159 1.3572710643080214687 -17.230081220109397577 37.761739866334785631 57.411436214079543561 115.22803489468837768 -41.853011246543466939 134.37717023570024821 8.6651534038928890169 19.673468257830240447 12.273862054632193264 -8.0435219654973746373 100.25012925769665628;-17.184669108007305738 156.6805014321757028 -100.55315905756381767 52.243127887932573117 -8.7573397759796591799 53.035621950762219967 39.0929949744050802 182.26015691033109078 -21.331823547689289455 21.107999899979095204 6.6026865701574930512 24.366174406110751249 61.717158606944224175 -29.002658255989874903 12.517077861899220892 32.91873630926113492 17.679918698731672322 51.337239568222663877 77.566537786575125324 41.482611031287547121 -11.623664796123827969 49.638610614944262522 37.654548711717794163 54.029848459318664311 -9.6145360677373883362 106.5056625535523267 16.504065109925772248 -48.557065783624771882 73.893826451678620515 6.0951202899069016894;15.406805889706831181 -46.725272381205748218 -15.035420036634574714 -106.42102919070410394 54.020576227531002189 -76.129365824925855577 -44.800877249595210117 -33.576768082845205754 1.0884873681060132089 -4.1588639170931642752 53.872820322515757141 -63.182526936231816705 -9.5248496222628169505 12.515279960733938225 45.482748212968537871 -25.698092921176726833 16.873988252839581037 69.634395503095788627 17.446056903017922224 52.242277781289715222 -5.4957891887970573563 -30.242938568283285861 -112.14936372280712362 -12.600739672681910974 -60.695162610160792838 -14.120429473619797278 -34.302365904172212652 -2.4684290022373809315 75.122205412185181217 69.886240790488599828];

% Layer 3
b3 = 1.6849658007813117511;
LW3_2 = [-0.0030500917275319327018 -0.0018059110037817673218 -0.0014648168759756731525 4.7533367021323062762e-05 -0.0016275222459342464452 0.00067498353104306237343 3.5918679023065647193 -0.0018382938243995284189 0.002470913606121142355 0.0091872475547807325863];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
