function [Y,Xf,Af] = ESPER_nitrate_7_Other_4(X,~,~)
%ESPER_NITRATE_7_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:34.
% 
% [Y] = ESPER_nitrate_7_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-138.904784718693];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.0042772329208737];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.7881522540703540525;-0.75120932104761539705;0.76932517906100506;0.16209519432279836937;0.95521763267608505998;-0.12320075961516757657;0.56605272883057411448;2.8309278041494509992;0.13434308770042252545;0.78794187676826688005;2.8501129372831015552;-3.3906053779996914166;-0.85672728935096631453;2.5639210739344071577;-0.36765560054781348809;-8.6040058301927206941;0.7764894405746460837;1.2100728500012489786;-2.0229215071454245134;1.5482128778433832395;0.26711628852523622291;0.56184455716297332373;1.020262833477945108;-0.89484998037665552939;-13.580861578296277159;0.35111027608047223891;0.13436129135150232106;-3.1961966584324419394;3.9461017356576371107;-1.5544210467930941189];
IW1_1 = [1.2708773158245101342 -0.091396233991564046484 -0.63579262635755928734 -0.029990439002374046085 2.5933276801324862681 -0.87970568198153642481 0.41722425068357238409;0.52182021842004933099 -0.15465125992120420939 -0.076001704526582170018 0.22042616081509996961 -0.74728983910388069312 -0.081747746371455862202 0.92556485646967734393;0.015117719319301699613 0.2737629749708317406 -0.02464586997084881187 0.52472691298167761786 1.1523656555013841452 -1.4060363436088425537 0.46601902816329210388;-0.22830550113471939633 0.235882371821300868 -0.68704206683211765938 0.21385121060670789217 -0.16786946148144421542 -0.39989153620468503858 -0.51105021017394280936;0.27772351764000080543 -0.15487904469620458747 -0.42834149836364932007 0.42080627654063368359 1.4644033211252531768 1.6450972427636068041 0.11933257966327653898;-0.91048715723882756023 -0.57209483580452569207 -0.21919437532789651235 -0.36365876507479183433 -3.1879903393522028843 0.4736279902318057955 0.036131703772331061342;0.1591246712930457774 -0.097027635981368681728 0.14478331806500310819 0.12858635443131388731 1.2241720601926355805 1.0093420039571017188 -0.087277798059890068783;0.66006981356735805466 0.89507479624401575791 3.6998926238095872776 -0.25072155202411722241 -0.66529549400517029589 -3.8731312350490991747 -2.5713951656002262958;0.80293807904744718407 1.005491726360523197 0.34931772191306409425 0.12393945794785612979 0.70074290695638574711 -0.63987787375668991885 -0.56702441227961863923;0.60383926915703844962 0.17478710643688341597 -0.54496897464252558319 0.1759820104133514862 -0.29212875968209656152 0.39796638575260695481 0.26582525881119778433;-1.4267435364675116194 -1.6503539186072953004 -1.5043118423411816487 0.64303293037220243811 0.79096831136170719923 -0.90000630614935417384 0.81702633456432138814;0.20516520451527830993 -0.27483671211024535141 0.92419989172518013376 -2.8713750666211246276 -1.2819819763568667259 2.0356084076539495697 0.0021961736024851408189;-0.075888464420909809705 0.024761388676530153574 -0.38336225350834535197 -0.36209617266721938478 2.9748129213510114965 -0.95008845366636995866 -0.15462513134614694343;-1.6023037550877485824 2.3364861555919795855 0.00871894273347810847 -0.82240693790432717325 -3.0128911647487357506 -1.0264292984565070999 -1.9041119042338123801;-0.57042388328903181893 -0.58377590352789565653 -0.057748172467357021531 -0.17993903550674805736 0.10694598518030974665 0.045979747967527281882 0.27654643561200042967;-0.062473942723583968106 -1.3832412280096919588 2.0407951054279660497 -0.86093597025642876197 5.999971199806085842 6.8709646850179648681 9.9443237570484424026;-0.42973014871720821573 0.66758457719242658701 0.65461127878490887877 0.22153676747659301061 4.27893668007242578 0.86212626733789865519 0.11445279746972790436;0.74208669670695459608 0.93077083353835543544 0.31025245897976561071 0.59324852318633247705 2.6012537145731737809 0.2621874170067602372 0.80827994846596284972;0.39727127512831755807 1.4795151706239952905 0.87877811248956139156 -0.35454619490294753126 2.9569706197133562853 -0.58102102610402583949 -0.54875217876579063248;0.539416670881347593 -0.14978493941994427963 0.41759821782345540875 0.14040838153418874756 -1.058456755275554384 0.49691406785560621184 0.91019886776386016436;1.0146647253282388146 0.32034447709147412242 -0.029199295663170102277 0.58315103474985496845 2.1128394317073282416 0.0070710487846359056444 0.58688570813912366297;0.2207397687546698295 0.43338718961174116373 0.57814959867209037014 0.21222063055113807306 2.3716860934748251744 -0.45171583771128909213 0.2954373018974688625;0.01794108030048546798 0.16939992853314689292 -0.55138739678071257977 0.22723839349437546797 3.0036927594923379381 0.74920376174425495908 -0.30160283415777622285;0.19921139649020935813 -0.23190807666429702483 -0.74634449548073755754 -0.16893333605606902781 -4.4967285239425285326 -0.34819243641456881777 -0.16673742366622437694;0.024851628807495515505 1.3873822411842857694 10.058204178298153053 -3.4642828353756840443 -1.4533652178347213901 0.12179901159481704154 -0.98394816454436040409;0.28489994391899131632 -1.7519301037914871699 -0.61118864553226404102 -0.3807069884904606405 1.0279605057598335538 0.77566478613929057406 -0.80609245858988509692;-1.1259726252656161449 1.058267302912446306 0.5663802070539942779 0.14692892704532403703 0.40846763365827398751 0.21617880844032996701 -0.29301248050446659921;-1.6178376166073253906 0.70767888978039905634 2.0123803421998394114 0.027647893015914824788 -3.7389004277535460297 1.8640948587727947938 -1.4884916491365269842;0.51750934300459283666 -0.32295458987977515575 -0.0089499827398500774595 1.3641582069737241412 -2.0641578813945868909 -0.8694119582156236703 3.6746765145802395836;-0.29484947071347411551 -0.26176213925654262527 -1.309001313155171875 -0.044920573508616147562 -0.21861428024159831884 2.1078367695495185963 1.9088484509271623768];

% Layer 2
b2 = [-3.1222413328921283515;-0.55786923673313604244;-5.920483296752835578;-4.7916963143796156288;9.8990647445712323105;-6.368859975110285454;7.1863555692617246962;0.93924861255024505446;-2.8015877370972899207;-1.2104034171595741132];
LW2_1 = [-1.5352876557841752536 -4.1780864482351125488 -1.9256248436815104341 1.9847375279826813266 -3.429103605105295216 3.6203074678852900092 1.3504909855990381295 4.0257520786207265928 -0.75700713167534949832 5.3969185491725557569 1.1792817066088971956 -0.94251320788304682186 -0.80065874377584977939 -1.2811808147593863882 2.2638319035691494285 -2.5658215312971472954 1.1718546251450934204 -1.6988294356802091656 1.8567147542577484565 -3.0773489796688018316 3.0018625116454735746 8.5067581330113757332 -1.6427316032683076941 2.6507560280350164206 1.2428955035792923489 0.50837248212374774869 -0.82463700533802031245 0.65765142816093624667 -0.57553602666772696317 6.2812471650502708087;-2.4621090410487038724 4.7500320074073085763 1.2686838431284193085 -0.34148421855695448857 -1.4460068121852001077 3.2677072870895833567 1.0456819672291735035 -1.3947489979447629249 -0.0091270566604289282697 -5.854914082670709341 0.39492579543463129932 0.92704950998817281516 2.2072259982231150488 0.24060110136693815819 -4.3164909353116076574 -1.5901695624388727524 -1.0093802151710862258 0.33483177389164248128 0.020033888100496530932 3.950657913177088254 2.522957210906861647 -2.7903807329500494028 2.3430707243848196697 0.053200379771291467224 3.2198315995727453398 -0.40443529894179153228 0.031514728601156657972 -1.185605164585412874 0.22664302084169837825 -1.6280951639178069534;-2.8269610875807567041 2.6983476395254348823 -1.122163755776602434 -1.8930984339568339703 -0.76007814182163324634 4.6558157568946052507 1.7064432572398051668 0.069372510216214461343 9.1605545633140810224 11.312781650054072102 3.5331950695564389164 2.7284056550886712778 2.345088447121653541 -2.413243899367579548 10.789747226098770128 -0.094084217198038985752 -0.53140988550175205507 -2.0740435232177949487 0.67360376539836308574 -2.8700149321797394641 2.1809588525974965556 3.7265628441089302392 2.1461468204727149889 0.3402792799462885931 2.0727390478946738916 2.7110204053514648237 1.8023227873210883043 1.8157324246995509842 1.6237427375845658872 -3.7926516361524229559;-1.077840063704202489 -5.1258193579234578863 -3.7646997408072109259 -1.1786681354251733467 -4.8530067998680044283 -3.2045618743732497968 8.3470393909442304192 -0.41995420042113601466 -0.49791258644434893688 6.6279676767969091244 -1.4508066778134560693 -5.0413977982995232807 1.1618032594236586963 6.2006224256977775511 -1.0589519287830528871 1.5668634075147620521 -1.4777520848837750744 -0.70358818712049686628 -3.7380926430500842628 -1.8184423636867346197 -2.0292561414479961535 -1.0693989755762030036 -6.0449394401769467322 -3.6893341730181763438 -2.5853801705991905635 0.29890602224163942413 1.8550091706187576968 6.150310557687780566 -0.023029546899055564069 3.8736459451984668334;-1.1309383702573501118 -0.12944198010582919078 0.15038685860124054172 1.5249139642982816323 -1.5910386586966747124 2.3607725931043086476 -1.8695042849333971535 -2.8205794388600775591 -1.6440577420216158089 1.932776684720004523 -0.83904145879657188178 1.1704325001773985271 -0.22860143563235471587 -6.7173302527816067808 -0.33206235941281975199 0.69780788735909959897 -3.3092285456531578269 3.8277052053457785163 2.7503051171533656749 -5.0343763736721314217 -0.98800731731913338241 2.1071194738884622133 -0.99439351524826169459 -4.6338330735983479514 1.897299094755013904 2.3662527558279582429 -1.4907229834198076901 0.93857159879385920753 3.9288986923342896773 -2.1158801003298428611;-3.3200493105374273561 -3.0239447239778396437 4.3070881148848298992 -0.57170923227086956064 -2.6377984097619893156 -4.433898396683580323 3.9038493920837233908 0.64221170689336892767 -2.8749873546521240719 3.2002566549834532417 -2.5844404850030211485 -2.1933766694544925002 -1.9644211754249270019 2.8012450172300566997 1.973608934892062905 2.1613216944721966861 0.46631229105483446018 3.7500150361448221226 -2.1676116090873662756 -1.4620154371096425461 -1.6259911254082886067 -3.2983853958737072709 -2.2447150024027240356 -1.1139481088772642536 0.11164664033518781339 1.9306740394133523608 1.3356541993429491555 2.9189629721312133626 -0.60012925967022023865 0.091996082180546126517;2.2573570113827501338 4.2248659982487604125 -2.0267072689163780908 3.231340987823876354 -2.6203104255793689958 -2.6984048360175787451 0.039569188111634269467 -1.6220411262375236117 0.66447936813576524706 -0.95248739068730448043 -0.8580420311854956017 -0.87433566452502020638 -0.20202361299901502867 1.25464171575981287 6.0089044635446144937 6.9338290091599770193 -0.68442527783992457291 0.87614993692671783165 -1.6201516967328275509 4.497876082476484072 -0.83850920055228628236 -2.3414557665777548934 2.9518350942991120611 -1.1316141363664231623 0.53623231903521118014 -2.7557463081714250741 0.49036546783393519799 -0.89757100838423242717 -0.041579694338137934695 -2.4137597733334326122;-0.93528957538426038543 0.74328284417623802227 -0.050684478537143903831 -0.8876623567493813205 2.2461330943116255554 -4.0602021776991206181 -3.4552152324528244698 -1.5276123907659140411 -5.7171106596780392195 -2.5390519637822950294 -1.6061554008068241739 -1.3950842025507461663 2.3420586991814302813 -0.39136667080085379977 -10.37440902325774239 0.44663892923393372358 -1.162967617324828673 0.21704875593136940815 -0.86240676284263728668 4.1162474558525232737 -4.3828095508999203034 -3.0363982176797543744 -0.26968704706931045934 -2.7821693619280503107 1.2905915960486509242 0.54854062730731723008 0.28254960199856560266 0.094144547446168277971 -0.50861918654285409591 -0.12144533308408754502;-0.22803338987919707925 -2.4231998648752353098 2.9647033310225650027 -1.5369501307384427768 1.446610723216670058 -2.7842654818378278492 -0.87804634727230346236 0.24706927090569441585 -2.7419150315212608149 -1.2603750657419812153 -1.2330687131574886717 -0.078633017002777985671 1.66435064401764099 -1.5135390873808125534 -5.5872708373616184474 -1.3332987625621415262 -0.51974319260157653133 0.49533922171823940861 -1.4794301365402249271 3.355861966915593797 -1.9627339480913401637 -4.7326415910693739875 -0.32488373971840772692 -1.995819002560684563 -1.3749687559275152182 0.12291668545317177563 0.33371952538951837886 -0.01485514494582314271 -1.0607189921747968153 2.1305754974863480022;1.9239390696950497972 -1.2226529475244549694 -4.8247271579762252003 -2.8989088122552622018 1.6784934001762992217 -3.5335474000878654977 -9.9960384346138209111 -0.95383153673079335011 -0.75227013993884817022 5.0233749125571831584 0.47120720050207881568 -2.6878644099580850657 -4.1555047964225577672 0.56165034169095606753 3.360653133988718011 2.5554583550787000057 2.1933456159753719206 -2.384774097057752229 0.86426904952932348536 -1.7704248887627180853 -3.9248970950247490386 8.2766757652030431558 2.6761054792871630248 2.5441521821377097723 0.21411442699471353035 0.72056803675875180648 -0.58545595083379942114 0.5862255087214833793 0.073270512712024893354 -2.1913562302364657519];

% Layer 3
b3 = -0.011704327873299582435;
LW3_2 = [0.17598357426090641131 0.48398447842905284455 -0.2722640400085554746 -0.12608876055599868571 0.082621637754015875288 0.071872166997647868314 0.11477609773154544281 -0.50028500295423672384 0.56627006686618197584 0.38529769169104860493];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
