function [Y,Xf,Af] = ESPER_nitrate_14_Other_4(X,~,~)
%ESPER_NITRATE_14_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_14_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-0.04979];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.568038194888224];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.3588976982234708402;1.560070442232605048;-2.2676422834980174414;1.7760222141657551198;-4.3010790115487527174;4.9691716469766671338;-1.2951656703714096164;-1.819374086579676586;1.0017961022309713748;-2.2670047450829020619;0.044862573882334159936;-1.0432219307976813294;0.54692885962494486307;0.86820805797668376691;-0.50206273262553502423;-0.85907670841998651223;-1.007670909472372367;1.0537030557154691834;-0.14192348974858876032;-0.87491683054984503709;1.4827355422015353614;1.3380477026514758787;-1.0630861415266057435;3.8341556482955727603;-1.648638446890376974;1.0546844149618577191;1.093415485807959886;-2.6696969176686917713;4.5557142818803617601;-0.87458456519422211883];
IW1_1 = [-1.26877876184871341 -1.2289315953586978925 -1.900836311921641375 -0.56821804982043233601 -0.15364451850759561213 -0.21915741575190106349;-0.85431088064309335106 0.4730077978764347657 1.1884740266872548808 0.68316561316386303915 1.5735334759604131527 -1.0024233979298811104;0.76863570068993036788 -0.16769372977234239808 -3.6992743298580696987 0.27873966408130645966 4.55525390991712964 1.7788956410444678458;-0.83105550973934461112 1.0721331330184511454 -0.40228636339440304592 -0.070713049935642924293 0.61014711728146397984 0.23546223171735936042;5.7662612399197268331 -5.4926748470230695176 1.5060835354230945882 0.86010935814877509387 -5.1973800458079812969 -0.38492772766990362987;0.13499595360334018523 0.24667459385052589727 1.0806876496857806824 4.2118621269261469209 -1.9584174034207888493 -2.0258682125886822156;0.39095172161290864254 0.63349107603136600719 0.66892678416092399285 -0.26639543709638435764 0.020762794102214772451 -1.2408741597740313711;1.1419401961014736813 2.3225357009063092306 0.79523873666426370121 0.35091462380014215583 2.2446980606367339384 -0.53843509724646032577;-0.27294028461306801825 -0.42826082390458575233 -0.54782264502568156495 0.39587225310777907072 0.2174642129034722593 1.2804793259342246436;0.51467737998326057447 -1.4902360979901163596 -1.841491319365223589 0.33698590272361672593 -0.26307654165444038785 1.7782470703450128369;0.64948242641575981704 -0.14531390901116325587 -1.9872498719031244097 1.1380986128891179554 -2.6459103675158184288 1.1326991039928087091;1.5902396193843748584 4.4427752512887099812 1.0598425286549857383 -1.3135010092863896869 0.11651946527207203419 -0.33722492945919058105;-2.5587707600715599021 -1.2528967042768388573 -1.1974728078430090239 0.040596735989664352318 -2.3222775296391287014 0.56611275352398515714;-0.047120976932629857203 0.33787153930956376202 0.15040635007777566901 -1.2813551471819075722 -8.7123984898644977193 -1.4522416323418290141;-0.070881581785585082156 0.72397735927334749828 -0.9095568427946655321 -0.095340102462362394387 -1.4453296516148721462 0.86831423506459681771;0.96172172644763864735 0.044121284070452487791 3.1731907641452203883 1.2666707435687194483 -0.11289809662447058969 0.88814134245250941913;-1.1191336739217718765 -0.24011038122212977064 1.8149713251059453878 -2.8910706606518656869 -1.6047874864784246185 1.8329267160097506562;-0.11316772409089001505 -1.0277198055350904582 -2.811307472084915382 0.67971553259574424288 0.98815027889184325893 -0.39301591027336452155;-0.31909982745754367217 -0.38365324515585141896 -0.30932260335832190146 -0.37542047534574213286 -0.030654389128917731294 -0.85942248367227580541;-0.20640379917967430212 -0.7215276484832091608 1.4645814065956601624 0.40474074262382181422 0.99736514882852511654 1.4018069935326007425;1.8348393401112281786 -2.7656117785353733218 -1.2796987651040150347 -0.1599543420154179163 4.3894746843134759828 0.89677023333340089017;0.88569215311532756285 0.26858451643572478496 2.150006532385171365 -0.12935851753409949305 -0.3009290886124337816 0.001994576864603093188;-0.050083362935628518431 -0.033920888617646492713 -0.26601537954753323723 0.11702539642557832633 0.58259585753062381741 -1.1878937467737895606;0.37777228296480352965 0.50589427574707213076 0.28775130959417039023 3.9640282614308364195 1.6233116753534280186 -0.5309224558502789737;-0.39783036788489994917 0.16306284766518255869 1.1490113455219226335 2.6466935657799850468 2.7568626542477034924 2.9229507172970792261;0.99682902827178321292 0.32794860519171820101 1.3477283488066347239 0.16788717406077424688 -2.5531435566013120919 -0.55938707846774760046;0.1456227224341140325 0.57692234102289641218 -0.92631299865238603264 0.053386021215223240788 -0.9486413474055149786 -1.1268735584272009387;-0.60423021600743498372 0.61533003590262091986 0.76963843143612564734 0.054375331547093813667 0.16548137994037015464 -1.3948216058888889268;0.67990160983261660466 -0.37930359503256494413 4.3251402028782415243 -0.61751048639461325607 -0.66622544398139782462 1.7323978940291311357;-0.29072792532867725024 -0.33117737343182696019 1.3101228118860717142 1.2923103503705761774 -0.94898352816637010498 1.9634302241876622208];

% Layer 2
b2 = [2.0194642676303655726;-4.0682761567973573236;3.6165316702616361333;-3.8984642319784645892;-3.2471606946349580447;-1.0338836128167716577;-1.5015792270341428161;9.7980099609653414916;7.2038418438582532133;8.8164423574995147703];
LW2_1 = [-1.5094116425254329172 -0.26699096571857727778 0.13421408302130041768 1.2861600048669321605 0.26945562221196162067 0.20111364201772682914 -3.0558576687013734308 0.71682292912266676321 -2.840445150369727223 -0.67313742801471687649 1.1969661968131781737 0.13357142761584792079 0.51089762798838633806 -0.74789274764349400471 -0.27919390226836415803 1.6661801794913171371 0.016826462980241197603 -0.2785677174530037381 0.20026356563928987553 -1.3894888647475824861 0.062368405485706268632 3.6734098763024505274 3.5990768796845635791 0.15336201541565874784 -0.80299068010411145391 -3.6638568780709839245 0.36575232306625710121 -1.9211582225998344864 -0.041471137828555632021 0.73705081088990953564;0.38019058454670628944 0.2111741572829241298 0.2597162151735150637 0.28407627638916016499 -0.021507967567032531403 -0.11472044995254769562 -1.2800221084389766801 0.022061273973369488477 -0.45538241994081546382 -0.11253614092046448913 -0.2701934700947585255 -0.011307898745915248226 0.013400670919484526655 1.1628908524768251098 -0.31977925822667518929 -0.49511303835009984331 0.10287561495158380198 0.067441115570509316268 -0.10478407385502790106 -0.9095319289626286885 -0.050005179768773812266 -0.011196037598038086763 -1.5699663088912345632 -0.061994381806489910758 -0.098326206285779094163 0.14047713874038647575 -0.79994003402211555365 1.3602056806923477073 0.79400520306127986281 0.5131499417749321168;-1.6164676295525508554 1.5348108336333259327 0.35755500443122029131 1.9690751695437302971 0.46768809546300282864 1.0244792914870055611 -0.1627895494539257637 -2.7530975760464113655 -0.91883588512213187904 1.1343305189558634538 1.8126819613153088984 0.00664136736544639842 -1.7464514397604720131 -0.30127015381106692082 1.3828519481063095142 -0.86905846576843892581 -1.2353042255435247032 -0.92442254939662715785 1.6595765144054874796 -0.027405021404027757326 0.14368310085858404523 -1.1472683667818748265 0.20751645198818671756 0.69938521573918099872 0.1912114878243337257 0.4238686608248279919 -1.0384769114764591524 -2.0014694385975113633 -0.55734966197057733694 0.86908312770476248144;2.3572501013841447026 -1.1157719645793797714 -0.34309022775421227358 0.43429272172550359432 0.16129536166363381278 0.22334564118897698437 0.39725279660238960178 0.57235163155352009046 0.054005984714469656982 0.25984623592642036582 -0.46892219063429929626 0.22306807853964347177 0.10881973686745324836 0.21403550694452325165 -0.50633795669136738571 0.26543081953090053027 -0.11678544085614517289 -0.3487663001354324166 -1.2092499593958598858 -2.1922624258375598139 0.031759544826592170375 0.34642669493007877124 1.905752799665005659 0.19047877374960778263 -0.18559588115347347426 -0.87076853861421665837 -1.5493702441846441964 -3.105964407076897249 0.76542384058634926891 0.5052977936034008799;4.5593777902450218775 4.428406631790644532 0.3310899963861520523 -2.0483516431187291928 -0.30415145115542169263 -0.80719556701227512807 -6.194808768823071965 0.36902627122852232899 -2.9192989450061732626 6.9210787794438761722 3.1722108162857463043 0.060184128685070746589 -0.46092389218090135117 0.22075741906545898185 -0.88022457423639177687 0.96610403236366226842 -0.30578545499326287294 -0.093959064681600618085 0.9887034596667098052 -0.53396084519404340973 0.19128457307725799108 -2.8106152124024190719 -6.7646115133368498462 4.6887411304858686023 -4.3855419699721807092 1.8813359057007619235 0.55652195017105654529 2.4411542661785232688 1.5557400348254672995 1.5570657307572550732;-1.1265208454287349848 0.36061612844862628302 -0.35465857361742031406 -1.0140102259168817245 -0.23132207669993004595 -0.34534364614861456921 -0.41135923547455077731 -0.32982628767481142473 0.042983322974402979333 0.5420122385510023344 0.25519576990969911057 -0.077232208141929187262 -0.24339005883106162864 0.3083915231102517529 0.46413327436381579538 0.10064577707911466498 0.041625039490703084899 0.30117186475601720463 -0.33373788319541175529 1.7158706006214861084 0.063851791177629194096 -1.4576827485932155604 -0.59382196656062347095 0.23487750511074803605 0.44581007943337375155 1.1985744157882411987 0.7760102378957494107 -2.5814715342058427439 -0.38036198736381637842 -0.48905751003408148847;1.1190167011795109087 -0.45765132932954954992 -0.77562850992895315816 -3.0066928728208948129 -0.31833184344881093608 -0.25309683884156281009 0.87099939808202642144 0.2035011818088684199 0.43413825284694168571 0.2283567319167784937 0.27574682215565360366 0.18419409670567504778 -0.3469523238687456379 0.8930336148407830299 -0.31254265606723569126 0.56981252165123486009 0.032626697375592164652 0.13620060504123965295 -0.75717011490560581777 1.9341639064160758288 0.023308105832822490627 -0.53321414675112288606 2.9878874535287427427 0.48751186764456427847 0.92073500009712450076 -0.58318084373990608515 2.208633168585013351 -2.1939691315113680758 2.5031053752062004669 -1.4780680614401349171;-1.1141267598834443397 1.8681779011588761641 -1.5856541800281787058 -2.6289623914638093893 -0.75986853980668089825 -0.41198602395128119946 0.34132318620926904718 -1.0897127600074465459 -0.47979853954045714737 2.0465947314458876605 1.1903668855904998569 -0.086691626515089784122 -0.55022256275521241875 -0.75050503304652016467 0.33521484210775359669 -1.2081907787865604487 -0.87043412068428394068 1.139720717480717127 -1.2836354476405023028 1.446751449002971146 0.39574149680599440826 1.7568935432115242445 -0.87252898915936960567 0.14187572726510769283 -0.1377322797021559575 -0.74603420163640343787 0.30239933094516185941 0.94076254707693884871 -3.4665893904502067535 -0.33614492192689088279;-1.7264422026387302722 0.30809500546629203788 0.96893811005152052918 -2.2926960339311976966 -0.48303037180084840152 1.1786338198676340472 -2.7230891706722903933 -0.071651977062397273488 -3.3995983775165639074 1.7450999329741927468 -0.23124815850013952234 -0.34724502712230148616 -0.29167605815556596482 0.61452461188400919756 -0.18709466191549109504 -1.1796944007902829821 -0.78779216685333108838 0.78899098631937902848 -3.3259401474712011471 3.5946925513176815059 -0.12476659850663830709 -2.8252360714463766733 -4.0031439712376002404 -0.63200083906408655032 0.60464695047494032565 0.99120456743963858415 1.5379892908986232403 7.6448087574789500565 3.6330821897013021449 -1.4792079195030491956;-0.64468254379305456325 2.2289324551296085808 0.053665854588215898546 1.6256347074191417335 0.42524014027581380493 0.92451152704422456807 0.81408797320435377642 -2.7021451621151566513 0.052898708023523664801 1.126378702362308859 2.4700591652393306674 -0.030178313409995553146 -1.7371880766564771204 -0.2973285759376279036 0.98296557293289255064 -0.49850935064147394726 -1.0928421966190511316 -0.74250096452578806527 0.76467795751453748743 1.2287328518170514968 0.13074143742696514581 -0.65677572196097278034 0.72533140641760551759 0.40062832339991705233 0.060660425065536330291 0.25614499353759623279 1.0218747323278767336 -2.132326433074729799 -7.028310726709907641 0.69654423322250902384];

% Layer 3
b3 = -1.7064088085535200623;
LW3_2 = [0.25694105851604787105 1.0038269239461223847 -7.8848663035884589689 0.32609327644911495492 0.099633323767803289028 0.61107759538621386763 -0.30944582283848687254 2.5133621274530710821 0.14294783867400831512 7.6666945980881671119];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
