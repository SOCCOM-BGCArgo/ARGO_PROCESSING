function [Y,Xf,Af] = ESPER_nitrate_4_Atl_3(X,~,~)
%ESPER_NITRATE_4_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_4_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.5421710590503912019;-0.71388956005083470391;4.4269750793116626753;1.7184795093667659671;2.9450153606666447104;-0.26139707075424056804;-3.1591242977673337222;-4.9032406921757738516;-2.1923613969547424141;1.5322457107226443718;-1.5411346222273714091;3.0604905297722280189;-6.3721514010714814802;-1.0079290165231344911;1.6318650407558878968;0.15986807539936084832;6.2012848715918913456;-3.3514776682420186482;-0.89857668598229256673;-2.6974290015727162562;-3.3809614904507614419;10.081269352138617634;-2.4392016077404052865;-0.47610362447381848749;2.8438285639604297117];
IW1_1 = [0.65664728336794797592 1.0189395660395506038 0.2269507849990635151 0.061774943831492970525 -0.36816642714626446331 0.34934240725327975197 -0.50288339744292565037;0.39195291650533142791 0.74990996729565684298 0.29981899332349437604 0.043456113533893163392 0.24895809609204341828 -1.3163989913845146607 0.89217724249396568315;-0.43475248034369295969 -0.016320445451995208019 -1.5668820923960338209 -0.1726035257534640488 -0.80018662364499104633 0.7481922646685787992 2.7598964051398264807;-3.0927907042288835804 0.70625773073386666212 0.22674951871224624522 -0.3355626174487764124 1.7887582676118021219 -0.39237529096494344616 0.25297244041806066228;0.2943138637591136697 -1.4200785660192611903 0.88969765501729969337 0.32637214422847699025 -0.69227610094951674835 2.1048196149225857354 0.20512852915019824662;0.30264320531199928599 -0.83339305906088601006 0.7354125563713069802 0.67339304149500112118 0.56864987582652359865 -0.6629969720140722611 0.53561442992146024444;-0.0044331812285460904868 -0.034950066067756885291 -0.94508170998475193869 -1.6328803013190500426 4.2883417127478509201 2.7133471611308177529 -1.7352585757505398778;1.0858311113478371634 -1.4555432630179725439 1.5299624970909857513 -0.30214713704552220719 2.861791285184112521 -2.6434319509609691679 -3.1961599748313220815;-0.18144654744327726181 -0.7674447774335459993 -0.50423461168762284679 -0.028298889456494155659 1.9129542692312009322 -0.072510583790957219841 -2.3020464429516009908;1.901575171960729671 -0.14508659498034395807 -1.3090320363628173972 2.4612148123931087973 0.12943024723379870089 -0.23549830434289914516 0.97394215934421946024;0.036954990358334147138 0.19719295692641139461 0.23707749615951839717 -0.198500816656758311 -0.069685935695564443781 1.0403747263082590013 -1.8004165047141091893;-0.62034795679633381038 1.4946027560536685463 -4.6307120100933873985 -0.77417555046652419826 -2.315840699917955714 -0.73058250025068649514 1.3994658694081509864;0.31641414921911126257 -1.0151533485994150841 -0.18496172521235579311 -0.012638834587536763865 8.6755856126172830045 1.0937609652801865145 0.16860380777841230127;0.18845322938427333526 -1.2637929353973140767 -0.014551718709532302648 0.12116381433559472725 1.4953189502712527226 1.7105508320123716803 0.59903911210949589705;-0.27187642669085337888 0.76196129761185438234 -1.0445066000670788497 -1.2046037590287437258 -1.6499435823296619841 1.5115576819063953895 -1.402762095988755453;0.78836747959319775081 -0.62006460261068530038 0.79975983310513920621 0.37784948416967067963 0.83256873538128928214 -0.48558296057655048195 -0.029205196950175808801;-1.9131279246166608132 -3.1975942207617071844 -2.3009323140592425894 1.4589553605018747984 -5.2431137846523334645 1.1329769455581486515 1.6621560277383984339;-0.14720767526328368269 -0.32792358155457512758 -1.0997313725192072731 1.7764735581952244559 4.2576738615343368011 -1.4260254180246840772 -1.8617630613700917319;0.36968297876624106602 0.37052505813864877737 2.1368267575522419399 0.57839684102971578028 -1.6139671601488256858 1.0472076209360443588 -2.420092252157328705;-0.28748422143148166796 -0.91259286117742410838 0.35134041899933954323 0.14743115172001608482 2.648569403979189385 1.1766192083321369566 0.22598643179400348946;3.5283383048978969043 -3.1566235220415261864 -6.804950447561059157 -0.31054745626755331234 -11.388294643658642968 1.9480974101651880037 -2.7297998347138179298;-0.057162279451325515023 0.4251829649836362246 -0.86831704768303730191 12.821677983399190737 3.6730842857563010817 -1.2796147470718566286 -0.39001798178020918861;0.0087472083957882990762 -0.7205643566185845339 -0.44402403782466765003 -0.049456076444842636541 -0.033196328082191799147 -1.8036428028191509032 -1.5780037503628661089;3.7543070146669674791 -0.13450513201356179005 1.9644097823037200978 0.12867624162720117664 -1.3620134152271070604 -0.51492475308610596851 -2.9228773281936728523;0.67956896479155781687 -0.27421925823034232206 0.15303814762547632289 0.054607311974390657094 0.62842467052101125269 -0.43204227629232616614 2.6501778684805445963];

% Layer 2
b2 = [3.9602463163205428032;2.3805079414951917371;-4.4638292503579828363;-0.84866590633325034165;-2.8564797948147613305;-1.2247132845033461557;0.29831856117291671859;4.7441121897673195207;-1.740523455586692414;-2.6325752033933498275;0.60593633163027416089;-2.6907821497844044423;0.69502040857006341934;1.5389089022609745427;-3.6396808691455140305];
LW2_1 = [-0.52324160393610164022 -1.0970233522662280468 -2.8135516613027098387 -0.76631779754369455659 -1.0795545979735172715 0.5734982156143048071 0.53251905205504479479 0.039997404730044830434 0.1442089697160674755 0.29383873131600984907 0.55834966962027865467 0.83726918802088368121 -1.9237184890130909487 2.2633616021106477412 -0.57689327095290487968 -2.0947637658380227066 0.066367064200263961582 -1.208742131124774799 -2.4307639302011292415 -0.27457967654169224136 -0.43632658791384143493 -0.92050855206825810129 -0.4481542739516742313 -0.026373706681632150262 0.39734657499347408871;-1.488713186168284297 0.27910983029503427799 -1.4836393587949807671 -0.073449706689892965694 -0.44249333882774927185 1.4812109813679241732 0.45075954081008440255 0.12762214945293823276 -0.045083382092556884002 -0.32268453967651311576 2.1144012756099868078 0.58142533551068065201 0.092646506407509876535 -0.34472664896090043918 -0.14853259493367029775 -1.0003687184618845762 -0.036839083259973745554 0.4236710721330467222 -1.1893658439077745559 1.2163003227642599224 -0.60812636480411230711 -0.61317855855708092161 -0.2562909277931736951 -0.081433624344257701799 1.0679408423891687541;-0.15512199103383328413 -1.4849173042416701218 -1.6452562172754470193 0.11358692498371733559 -0.32969607599272099385 -2.4640425219370967191 0.97854122791397124548 1.6977700596603129135 0.48365332261777194134 1.0726716478635991425 -2.6435839228505515486 -0.50421855970868867391 1.4877810924170482565 -1.03259908255612598 -1.063230010474437659 -2.6209713291897305254 0.49045256467894116081 -1.6367120174399301114 -0.13921609154598998948 -0.5212500305111508192 -1.30154344673693112 0.61269202246916187882 -1.4381602906780337481 0.64312221324202323292 0.69781468764292087226;-0.75397399788244900964 0.85916283091772782665 0.27121750363994651112 0.42667054559668632363 0.63828621499908300141 1.3857222096614463247 -0.087519072706857423127 -0.82982147358905911094 1.1544879417110447406 0.024833683584986752241 3.5041936657728585125 -0.65468320923759459884 -2.4420468967086215173 0.54414140276032330057 1.0060666612510777984 1.6709920401351172625 0.41580555687493003791 0.18373265142644887304 0.10043729990113951789 -1.5488688532560026534 0.50071740800838715479 -1.0080610726684455791 -0.14085078707710801948 0.11992391327563019232 -0.23525968193483451363;-0.09909029409110818587 1.3599473174874081582 0.42435880579278117963 0.31969755256737819593 1.0168492149543995051 -1.1771287658745703819 -0.24391258125729611828 0.19242565657048313343 -0.45942345633152592566 0.21826888134756838866 1.5950649830250587247 0.30419688547955892055 -0.5634787655483579627 0.24668855031479000606 -0.3468363287627667102 0.36922467489581339839 0.030215661114495161177 0.16691433987447915066 0.12707706974567770097 -0.48695247978869388161 -0.97431725343927833016 0.38904222401996052527 1.667798029464421905 0.0031952809836846051209 0.58847605200216601684;0.16793713110816263501 0.46232100338555615071 -0.45054749721961884212 0.19976078397360058636 0.94963765987417236847 -3.1062609012905926242 -0.63759832755744283439 0.39718291149001411222 -1.0891397738798576089 0.21007544563457564157 -2.676450066795585947 0.43724092235281475372 2.8008605814668818823 -1.1533267615306534992 -1.0723644663852385239 -3.3436796774365040719 -0.51290205116809317598 0.23763634030557623245 -0.69677391772513597168 0.62268120117086922516 -0.72006897702930205973 1.3993252137595952878 1.2353209877327036015 0.1802880660661081158 0.86784059358056686584;0.45950271463772307534 -0.81327322233643961624 -0.60203478042811042759 -0.87806008154990244918 -0.95416308743839295392 2.5287379150112085924 0.14480220879570609993 2.5618497674109304008 -1.8884359044758902701 -0.14517179843078026336 4.6047930770611973372 0.39996829628201790996 0.87170768780470453407 -0.76417512822152011687 -0.066242811333312043298 -5.3446179937101234714 0.28172505433484168469 -0.31748066088252174799 -0.27704666610519834702 -1.139514979285009888 -4.0438728674630199933 -0.33748118514185693195 1.7148783306652155556 -0.066145303184459047774 1.0736659862039885649;0.24775204261896816016 -5.6785234828416202291 -0.78507566966493824712 1.2782575462359122564 -1.822475024507866026 0.90703617736667552229 -0.67102644887181228661 1.1511260930645499378 -6.7680312208562369847 0.51633729494100810697 -0.09619002158075830311 0.35085073167913888303 -0.62053858476260614907 -0.7681138412788975911 -2.691031429991801005 1.7527784571433804306 -0.484778951845202144 -1.6523514945500181739 -1.8329632344672983635 0.5980779928097788023 -0.36736621619672410466 1.0055650053229050478 0.29863964558375122316 -0.67232698400249391035 1.0490886325075341468;-0.87208434922981714621 0.17097797941003617384 2.2663807297465723423 0.39518703561097717758 -0.38101387430183270011 -0.30157629896703708194 -0.30542879279867957143 0.38001604879612393972 -0.5394524868793229011 -0.29893445868309542757 -0.51242693657980087352 -0.72475330160146878011 1.3752777092064434328 -1.1047167855251944779 -0.80794755463956746677 1.5594456862267229713 -0.25655481881989489201 0.81864301093684632704 1.4571583113698189926 -1.4951038315857452243 -0.29679005831189625431 0.43606140408705401645 0.22783060954334014014 -0.13512641502980771158 -1.4865709840666061492;0.67879573622660294152 -0.11432263373384911331 1.0403982241522937713 0.22855975038814013711 -0.85794091596636401498 -0.62006102787705563717 -0.086007903444805730575 -0.71375022096311369069 1.3337823935636070605 0.28901103459601906742 -3.1027211582954654645 -0.81519495908952843699 0.59332336583119338336 -0.37651052811289797972 0.23610566208578673275 1.2527350175994240722 0.32948836515393009616 -0.87993246994216001156 1.3585852534659297319 -2.3674355521575685124 0.92700996748441333306 0.28642391204483524936 -0.53956529374377104613 -0.19607986268207533431 -1.1686203039385285596;1.257825582846941348 -2.0832134570819080821 0.57893119605135567873 -1.0601773207760527562 -3.8355539183593894137 -0.92307914326907947178 -0.33370442325292520858 -0.28469286350517608586 4.938699620227282594 -0.90705076483514146535 -0.60813885492062469407 0.44821606341152442354 1.0618760926567847314 0.32500049086979909685 -1.8351243133466517143 -2.9969591653415861288 0.81465578191382537199 0.087128108866024830959 1.1674833289742871933 -1.1030599506533871335 0.24580042953368982928 -0.75805521541563158916 -1.2328455857579787569 0.32610988435022980614 0.64553358697252571918;-0.022111706066147419208 1.1794927539130553029 -0.87986467954220060061 0.5569183640293481341 1.113816916648521671 -0.65632586745355570024 0.049714315445916097691 -0.45866580059305245287 1.4977780461878069662 1.1619067497464805605 -0.17945551689688740704 -0.063135215351380030713 -0.12647709512689089828 0.67292232882148228512 1.9827353141938652836 -2.2855050835427537237 0.30847901791456022735 -1.5142183815732510599 -0.66262395565923615237 -0.28946163924273782264 -0.17401513260356524238 -0.062285646157075158502 -0.52220852688807728459 0.23943703089509643656 1.3551361806595869641;0.68269059208773408276 -0.0087797320767568076683 -2.2365008952129166175 -0.19971663915710682891 0.50970460814196849597 -0.10294844260030287797 0.28309140660141374202 -0.39762200965222832538 0.71467663246327850501 0.42715632341938231109 0.13227522648464004607 0.7751155853299590559 -1.3450541671847149328 1.1467424260398260127 0.99325387416496513371 -1.1381078413108653979 0.25039667419398359272 -0.96025749153744366371 -1.304239827807467611 1.4234709950370658671 0.13975758672455099174 -0.40339489447215876039 -0.30731239365771723104 0.12399625754355959872 1.4524248487908844041;-0.95248202729205988515 -1.8016695627146250835 -2.0975015302695845243 -0.036349120376525295706 -0.39527469441007284656 -0.53015833399914324975 0.026987183406650280815 0.1813237787156204428 -0.99702912782348251941 0.3289921941354707613 2.047687247486887685 0.052179187454401775026 -2.9517003100285834627 2.6257300731862684984 -0.48015450148635102634 -4.1994061022535804639 -0.25401517803539347407 -2.1882663197749412376 -2.492869073382614431 -0.33883627513343211879 -0.25466703199028722926 -0.70504543251453499764 0.93990920444805547973 0.67323473598927452421 2.7753165248833133738;-0.3710017815750552006 1.5066056288338560698 0.5439811127276266145 0.34844553663675936761 0.95800940522806865562 -0.9405770307713380296 -0.26383700718359875959 0.27202586502397430035 -0.49985510213519923628 0.20875434538014223107 1.8734015222902271613 0.26077409815077018385 -0.52019995479747171974 0.24233618123218983453 -0.2478130066780337426 0.29434817639078708629 0.076966300641708063068 0.2112089791608174616 0.27022913025099215556 -0.76700623769737452662 -1.0887092358097556488 0.4485584073604659272 1.68890210345174685 -0.043747602501589329116 0.79348098014327805849];

% Layer 3
b3 = -0.30067031931385307386;
LW3_2 = [0.66041016730809620761 -0.96575724318475220098 0.43937195363710251916 0.61576589974069195765 -4.2269845355907031959 0.48708124078781434019 -0.41524473977961168236 0.46429844352570470711 5.0675164681905737751 -0.44377469637910843536 0.45661032589863792541 -0.94111210177876958305 5.2109280609217343283 -0.35043895343585429458 3.9920567416032697317];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
