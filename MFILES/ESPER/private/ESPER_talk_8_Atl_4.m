function [Y,Xf,Af] = ESPER_talk_8_Atl_4(X,~,~)
%ESPER_TALK_8_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:47.
% 
% [Y] = ESPER_talk_8_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.7683218667839247;-3.2936973760551047;4.4502314382661039;-1.7302185267859367;2.3945644926465817;-2.5059539384169804;-2.7408399331616682;1.7897872385381428;-2.167374422854869;3.9516961767460059;1.1090508923898419;-0.52129678477361985;0.41523486218020977;-1.1295900432533295;1.7479293941098422;1.5152420663840285;-1.0511043050981401;-1.6041866517653018;0.06552362727722609;-1.1423346954957028;1.0849346008911338;-3.9277706163568396;-1.9818209296320588;1.4119246161517776;1.8452404852591928;-0.17671254933214883;-2.0784429274909315;-3.0684674034738668;-6.0275072628737707;-5.4154125893837755];
IW1_1 = [-0.67500314162664765 1.1294055945443726 0.47240274579959912 -1.0315251428387469 1.5345161362805482 -1.7056837820001174;0.67379006253643314 -2.0643709407845923 0.24658778627060188 0.55316726950648565 2.0907441997550134 -0.72983937761998163;-1.3725839790682446 0.83633393067504769 1.0204766456392265 -0.46831382524877335 0.94026372219843712 4.1092419470770638;0.14668445527160479 0.24477461391335942 -0.16295784986616743 -0.8861492520463593 0.74394408324138128 0.25397725585538461;-0.65792605669592585 0.61196553462860948 0.05260375352790788 -0.14180210314802802 -0.2126578105578478 0.83441690154617809;0.9457353307829176 0.18338700259655513 0.15298718783720328 -0.18533039862461403 2.1182418012974633 -0.034157858906811306;0.98153033552214364 -1.5579524478610398 0.071337037194527358 0.22986125782026373 2.4378427253045891 0.10431420934078288;-1.7129135098440578 0.98034849522400136 3.6078130915109106 -0.44395651800360619 -2.2963129574126473 -1.2589075647374282;0.29201805645504519 -0.13239462788899303 -0.22037194730640491 -0.91593248450811704 -0.58963319450377516 0.78982929342117203;-1.3172209531744681 1.6660438269317424 0.057706574889936822 -0.35662033861827402 -3.1643863181631553 0.31281241293921508;-2.1253552203050985 -0.7255130676064957 -0.33878775841834602 -0.17472031281433431 1.4342554294855461 -0.81427845037776647;2.7601733071762897 -0.55020599880405952 1.9891979012566467 2.5445141369531146 1.3473192365036439 0.52209828614412312;-0.51472570275364338 0.25006567693987786 -0.3226712502902046 -0.093834091488744539 -1.3805418622308712 0.032214779694893482;0.86113698535809458 -2.6005711623029892 1.6117217160646484 1.1183281290674996 1.6607138667864743 -1.0180171373374005;1.3287421749955937 -1.7386661731251103 -1.3065358625637236 0.51258876017222665 -0.60946447905698764 -0.90066749303681037;0.067081595181606168 -0.092386034234430106 -0.10930688206230066 -1.5172328312240977 -2.8284007956161532 1.4630519044644303;-0.27380256185226354 -1.2963726913126732 1.1208320631349573 0.35742170825990716 1.214445606564974 -0.26592812609999072;-1.5409033755153192 -1.0767213594270035 0.37291450007870242 0.69168100854368142 -0.91519063174298054 1.3315932034727058;1.1756559089394532 -0.30237719324470774 -3.6583063934548279 0.51724585861633043 0.65491594306583667 1.0222796658462256;-1.3308276038585281 1.4248792464213347 1.0313234810141167 -0.3553028331775307 0.41738493557453599 1.1035215134131628;0.34738844843840455 -2.3167781478684106 0.80582019264502658 0.58132323760241411 1.6229790828842467 0.76965113708949362;-0.20655541548938575 0.99270011072906361 -0.52512867658721396 -0.16945740635950851 3.4308974779054435 -1.047381440219108;0.96770763810265115 -0.85723705470166101 0.19172219694686404 0.1090605160414687 2.5227992299626476 0.22875710955872069;0.51735702072976741 2.1690521310218869 -2.7428266443488001 -1.1481769133662074 -2.8995481978647639 0.33805428635521445;-0.95694612200970597 1.9185421347915392 1.5176074471278704 0.22191016842730066 -1.1434610282559681 -2.1349034877733315;-1.3751089334627349 2.2745743206823557 1.3461872803875203 -1.1352920959418626 -1.3350711727031377 0.9965740563428851;-0.68303063501163119 1.3209720022825733 -0.55756837340346133 -3.7442545083950316 -3.6195452194573643 -0.22993150190206957;0.89629867198404878 -0.20966137154698231 0.32921343424080651 -0.49390233935305405 1.0997694514839289 -0.040243417520534189;0.68318225453575054 -0.065060563836290802 1.8662278275795736 -0.89853425111987772 2.522346662133002 0.64986359269965843;-1.0723949173414249 0.63451997933245441 0.1754242171099395 1.1112894415295536 0.71151373767658133 -2.6215465795758464];

% Layer 2
b2 = [2.4955081763195825;1.0814273395482552;-3.3489004530410997;-3.2642310612897476;-5.4836890552639126;0.54984200852009468;0.12982260483643321;-0.79771554802272071;-4.3038826104632983;0.3553580696386881];
LW2_1 = [-0.39592965304474509 -0.9970490364871516 -0.49921048039580562 -1.8001573535750597 -1.1444128645837404 3.6438313084288216 0.49245226926800106 -0.41530612709457282 -2.0691039940328846 -1.1844564244046409 0.52515149525815463 -0.45738651012462006 1.1164479440508182 -0.45937907368410846 1.5456673278757498 -0.56043097313743795 -0.84411841868226445 -3.8902998887962372 -0.8791028476250029 1.7175238932412387 -0.66122431346831934 -0.4872237076984372 0.7351383840697101 0.66446319153315658 -1.277170615172506 1.4063462593313671 -2.0040023658955803 -0.48901642376856186 0.69615482341575075 2.5553020779144893;-1.3376243559717496 3.1453590887604039 0.25398194556352299 -1.1085789261983523 -0.79572353795171102 4.8598321521201102 -0.87021723124056194 3.0464306569236466 1.0843966951604191 -4.3271423627019017 4.8707977383065204 0.98143687006187252 4.286816589161953 -1.1059360235001627 -0.81197611486538368 -0.69859372930783514 -0.83179165614539474 -0.98412714780144228 1.4006631411728829 -3.2292371219421234 4.0226635334044056 -1.8790841402514717 1.2219855496534506 -0.043280493515279191 -0.5017023243145492 1.279271790466862 0.44726836316426716 0.42043561063378432 -2.5011105901722797 0.56716001791010828;0.41182121710532149 -0.74925641842005164 -1.6464609616909187 -1.1201126785291884 -0.45180995129268686 -0.4966884728177044 -4.2575634039859249 0.13254888444414067 1.7719437274491092 -1.7200982250904038 0.21682855871880113 -1.304325646285367 1.6340726154263254 0.25666556970457599 1.3640985297731709 0.39419714358270341 0.91617046519472911 -3.2445606808445699 1.1541608788140469 -1.6374728036315092 -3.2319790867930944 -0.45615215486734983 1.6861601313257617 0.096149447742920544 0.85592719964699182 -1.1499224866854687 1.0320551325833958 -0.66124211421864654 0.42312332048054285 -2.3585173496465028;6.5751392895265974 1.593303058306361 -0.57419915902978791 3.7598060716746593 2.5361377440013784 -3.6505641006929035 -7.6924512638020284 4.4955810839135477 3.5051441752318486 -2.4275626037161437 1.716381358235509 0.71176262809637669 1.7593698747647026 -1.0258177453128186 -1.3374286013711538 -0.096147626293339991 -0.41872363161340626 -1.6519333915843359 -1.3911154068045886 2.3450708657828461 -3.8471931883392489 -0.33337198744626884 3.330402157079424 -0.62153041593595737 0.42242618239720009 -0.54894726898102686 1.1199548680951892 -2.0158414508465374 -0.37588854926871262 3.810954709801385;2.6329358820701647 0.10634210903457109 0.34733526494365863 -0.14962045564042056 0.71906655026283384 0.13759328380099786 -1.9413195884485683 1.8083265199004321 1.1112262202648517 -0.97305767286471201 -1.1197991188827199 -0.27767794941050172 -4.1837344641194747 0.45196058798839533 -1.1287303412784184 -0.21357517693680333 0.88763309532812384 0.56710581296018392 0.24000154993040501 -2.2840890371673628 -0.41844299830027726 0.87423107535154942 -0.34958688214051309 0.83543410733282875 -0.51533298515299164 2.4864189022131278 0.46383765157605328 -0.47559920875369194 0.75087890529602208 -5.0074723857178611;-0.58141755432969555 -1.0828494001612969 0.47669849014483917 1.2243486135387216 3.5998327145372659 -0.30128829574627924 0.48762540770264517 1.5844987047862413 -1.4385591540234213 -1.9921434077894598 -1.4295937049308329 0.018579233974303815 0.7202204770801931 -0.36409400652460827 -1.4566479009923783 -0.46088732062415944 1.7208212289830191 1.7943096062836179 0.87130596170091712 -0.8358712162162576 -0.43496814529659084 1.3672950978695366 -1.8431460694313764 0.32734405755137536 -0.31293493714694959 -0.41067962553665616 -1.4489704723242907 -0.072446866439196483 0.10076732222352637 -0.68685950468791668;-3.6486303918341596 0.15483475379395076 0.15561456325556908 0.38122962143002359 0.48990402893496082 -0.56906241014381354 -1.8722893637320124 1.558414537520624 -0.17850034514012936 -1.3063772593490635 -1.6911022305786798 -0.29588775455521515 3.1562850811344587 1.6236300220757345 1.9697628947209895 -0.59527890152187946 -0.42583783509826773 -0.42726129958974013 0.015961606729819233 1.4112414802431625 -2.0165337363740408 -1.9361665589915846 2.4416382585086467 -0.88915692081430842 -0.50231144417428542 -0.5882071105369947 0.12537376382292467 1.71863236066275 -1.4908971145701067 -1.8198527284049217;-0.41362533041433608 1.1385940723607846 -2.9446986461173292 1.6380010534226552 -0.36333872508117371 -3.2160259900437769 -1.3690047468410409 -1.3780694083780396 -1.0490629128594977 -2.3107972346381884 -0.58424763976055638 -1.8828172242058547 0.69225929965245736 1.2593581681330295 -1.5720804086159819 1.2110360269721399 0.49635441794609164 0.76664640096763781 0.074728419037336707 2.8706963077807908 1.0865144252779604 -0.32948531978065443 0.32842344188679928 -1.3911324005744785 -0.32070364104773719 -1.1333746211306885 0.11254230259166009 -0.97353459159357258 0.53584416576074079 0.38541210797230574;-0.092476676534234969 -2.6292492006999502 0.90587837734187104 0.28936581814277312 1.403070087944525 -5.8623498696216796 6.8251939155610337 -1.0088779661478535 2.4679544610750228 4.5577680973091859 1.3815269854699743 0.21732002548488866 -0.75238414261439801 -0.96114469126755797 0.68861848996825548 -1.9019850280476147 -1.485295919133836 -0.86234250350171204 -1.513206206226491 -1.086911047350702 0.0050096766493876194 -1.6545914050409329 1.6203213370332579 0.14741451156404958 0.20074806847595458 -2.4678377737494692 3.4836839833933637 5.350564587624179 0.96074928889113065 -2.2513877466159;-0.017551157409259201 0.76196974036035836 0.4173493117388225 -2.3011007352147357 0.2267538527118432 1.5069186950819187 -0.28147189718981608 1.1732237582773848 2.6276209118292098 0.88809139025645467 0.42191017678748627 0.33991577584577709 0.1598222723980097 -0.19479130398001762 -0.2443813774583965 0.98182250712844332 1.4110604036596601 -1.6288077550206663 1.073001709226852 1.0506323867083165 -1.2166421760939414 2.0888487829513038 -0.60727383110450572 0.76788926844734118 -0.25416174897651783 0.57557392915082506 -1.1189162219534097 0.11279061026340498 -1.0379303982883783 -1.0230609751335549];

% Layer 3
b3 = -0.21128315383785515;
LW3_2 = [0.085898708622808642 0.0071475132044336222 -0.011552620548621127 -0.22898643696591819 0.36702020219206194 0.18945370938445888 -0.52714928217036494 0.013856296885236057 -0.06064196295267054 -0.36801727806922468];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
