function [Y,Xf,Af] = ESPER_phosphate_2_Atl_1(X,~,~)
%ESPER_PHOSPHATE_2_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:26.
% 
% [Y] = ESPER_phosphate_2_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.28;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0470499670650231;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.2548659836706137494;-1.7870550291041369384;0.58040204593726130167;5.1998296608954746034;-1.9849069217795034525;-4.7880032049192555732;2.7924976498490985399;1.1498251109937569492;-3.4556315130782682132;-0.52218706520002822202;-1.1115175413059212861;-1.5635557381696583157;-3.626816537097616866;-2.6307683792154912261;0.30322217376038629322;-1.3324165832024768008;-0.93089118058292419366;-2.9617391620553066289;-1.2523660607580302528;0.85993794934763712057;1.0545311711169824687;-4.0983767101427499568;0.7367829446956113415;-0.8101128200788239031;-0.91399631784709967075;-3.8613311182379246311;-0.51343336783430459924;0.80707968791818329723;-1.1108762059180199433;2.45354193522437658;3.1747145280344120089;-1.543044221876530786;-1.5607211438228321132;-1.4396934132662833061;-3.6940320890536750831;3.2852245082947146848;-2.2919036788984961106;-3.2727798074936429451;4.4743484500122301384;-2.4826896255957282555];
IW1_1 = [0.84250820863742759137 -0.55546089793039377103 0.47976374280596778554 -0.28359383848399383199 -3.6501477663474486413 -0.36679344696453752839 0.21906297889491069264 -1.4949304116552790678;1.5616646858351683758 -0.93659658133286927129 1.6470813393824259574 -0.68754390125074327234 -3.7119405821397197798 -1.1022866120469294593 0.53399417744575794487 -2.2285598984219134877;-0.27564962709328721946 0.65396551216194742651 -0.50904539862788955595 -0.29927974266595225306 0.19203692361749435946 0.98321431741736864396 0.76188676827698320615 0.60902035840816315382;-0.48504641232129208639 0.55125635756786650621 -1.1843762615427302354 -0.0015803896707657603959 0.14514909365387995699 1.764182648901929884 3.0930068825245919939 -2.1838329687156581294;3.6720135709374699395 1.1799442343208597084 -1.61853234268270052 0.20294943426668013431 -0.078037845856104542941 0.10646467462570302631 1.455684761524715265 -0.24007024761298378923;0.17168639189259593536 0.22703853160777207054 1.1241479668249776402 0.47146562807810937779 5.0671845583801102819 -0.43261850248293126642 -0.043671323416715583654 0.20329850493984821802;0.93100046570059169504 0.040917036685248125982 -0.94215311559121461826 1.1407552845455208868 1.6372291507155944945 -1.3173480754847515239 -2.0643119589827638727 2.6493719411980736211;2.4492600424176504958 -1.35608069077696336 -2.795799888557759072 -0.65329716463196951803 -6.9776711813227905168 0.86904578365440288135 -0.68258549741977359027 1.4691978501104130395;0.36387995720335924998 -0.088299416207748032681 0.81029770041117865631 0.38494551141265181959 3.2965116366538271819 -0.45925841997912847381 -0.094655716951746959875 0.20755510225374279587;-1.2754148396764422024 0.94870136953230455035 -1.3718599518279144256 -0.19304439335417039603 3.4395850234818521329 1.1872962098677146692 -0.17614749419762831817 0.44145848972810369792;0.39177163963810851532 -0.38926615539990022663 -0.69355152642850448341 -0.82564944804110773635 -1.9939879642104820778 -0.2489331978107287846 -2.278927102924196646 2.3960141057957162758;1.0219312031176825961 -0.47979192306580564775 2.413081379085782352 -0.49234669205095021871 -7.0186487693593235804 0.41556035584698536312 -1.206700842632979942 -2.872570389402984592;-0.59404147177593968898 2.5115854439058051817 -0.050454653954712942732 0.38500096797607386012 -0.26753330859038637612 -1.7387761247734070391 -1.4721977819980651692 1.6029183649443969895;1.4192486317613433044 1.1491372124677570188 -0.035883706264722148305 -0.14179038017143918982 1.0571148151227727219 -0.17823855420989054288 0.086770449641320385181 -0.29843129924301259326;-0.11700024808274961385 0.4070768438719742921 0.30664951815934010648 0.26797759998052050889 -1.0876137308180475749 -0.62143422445266682796 -1.8233239422884239822 1.17555199213572803;-0.01021121198850310878 -0.47794606094283698106 -2.7157389656096269093 0.78481511100655831914 3.033909779156958475 -1.1173063855985070347 1.3207159454078758465 -0.50840245301072961581;-0.08965781765151564775 -0.85208343833470157058 0.94926124496856867374 -0.10372765487402373086 2.7795329449561889668 0.47780897979991759916 -0.52934045369731386188 -0.27732968208712482916;-0.17640565026517479597 1.7922326453374932687 -0.20445471793959152373 -0.53349464503048416031 3.521403247902742617 -0.56627688729739444895 0.23758706499184537031 -0.765659400103035237;1.3344695141357236778 -1.3966408800995910866 0.71864687682865180385 -1.0843339797593471996 0.087991125332900377298 1.7663547383240474353 -0.38340390568076659905 -0.82779797912430908013;-0.43619059176140478895 0.2101215211882347389 -0.64374374344001084047 -0.14869609349787429875 0.37304925128469457185 0.23015395565791155197 -0.0446252237853104472 -0.0045191400425908532026;-1.2873022437435066578 1.5283464834702291668 3.0814035033756530524 0.19353590750974736245 2.0724886847542252077 1.2964131529282727495 0.11776045939232257509 -0.29330070679300379588;-0.51612071082388000232 0.16906833680901517392 1.9813419645788004075 0.52629098375826943723 6.0221721542179702524 -0.057244044394495735562 0.93321281318035964603 -0.76611766562715233331;0.48040820582003790351 0.5364760903082054222 1.3552327971446582744 -0.61771905511450297954 -1.135594421258957043 0.4498426596312395942 1.5705225382562000291 -1.8782814037299588872;0.11790817988258406324 0.37202741479538853353 1.0530078091471257729 0.41846766934416940176 -0.31332015729062401288 -0.20080026455296237642 -1.3693353771793288498 0.86695780318655812913;0.42645707755560313679 -0.41741466821287126487 0.68960273697346263777 0.35012771582773866141 0.53082530912612102547 -0.67596261821982794871 -0.62570775241723264326 -0.53279317528005820659;-2.9635781292026104339 -0.22705727234349018517 -0.55916020788012354981 0.83394791837800918977 0.36856253747607298221 -1.1657037576379540855 -3.2074732440328257432 2.4077627951544608997;-0.45299892950013054271 -0.50413799556518068545 -1.3015399250842798473 0.58449846655699488895 0.72599577569487672157 -0.59100338669475027675 -1.7201466381495036373 1.8597991817547383508;-0.59802236088506943723 -0.3267795633120963994 -1.1738320214352657711 -2.159453581159877178 -5.5273753667314551308 -1.8271975558260709072 -1.6742559958198375281 2.2561027504386497178;0.12147125482730643242 0.47902257522010183166 -0.13412627987588623957 -0.2423321558536934428 1.0037735819249002933 0.98562540962188716076 0.15032476374609046732 -0.02508644725450881463;2.139225755144902763 -0.078875194874634887987 0.95008404763666665094 -0.77860379094839782255 -2.4449289940356502271 0.79516667453672973398 -2.1162760306555044032 -0.45346352691784780342;1.0311849214301258559 0.21153499861499897028 1.5326902706727698611 -0.71449433168556619744 0.85064443719557847334 3.9666637033881468888 -0.47068487583893781068 -1.2509227499691375485;1.3792636326545952841 -1.4752888846897906916 0.75267964435218226438 -1.2112386585578265308 0.2677744788580301849 1.6249424842296635862 -0.27925442294403379773 -0.80352754834115280858;-0.94035206964801998364 0.11306462536985875666 -1.305457502682239479 -0.39356137753326531081 -0.17694613508028239623 -0.29958898815000917226 -0.63703798890562834956 -0.28472626210479634601;-0.86139995167353622385 -0.062003559580941003393 -1.1338227837714649482 -0.39922628686636874029 -0.66426691203152710141 -0.50770352173575750143 -0.78604009544768516093 -0.29020873439808880789;-1.0912686339419548354 -0.10671921448606522254 0.89671290743172515914 -1.4419761525684322567 -1.5999636960470253744 1.1867298115392088675 2.1354490487425277223 -3.50371436744452458;0.46715512266723319135 -2.7880630234369676579 0.27729850575300496462 -0.31204651547805895007 0.68143005899536068792 1.8831231886741268688 0.80942666509402905195 -1.439139206150748862;-0.67404606685096102314 -0.4464399926915109118 -0.57877060650546019449 -1.3514339604333225342 -2.3387992098744572189 -1.4302815795682404243 -1.385241849657756763 -0.059747634247155581577;-1.0489019494060032311 -0.10356098362561477755 -1.371791049857057132 0.60204778058453845002 -0.31539649759647442329 -3.8621849836104416021 0.53423792462661190417 1.1666584381101712253;1.1977170668279901733 0.30101800506079690045 0.83081935150952290758 0.01066006755795902497 -1.6434083353504138625 -1.0459186266902578133 0.00428612298885743849 2.6050050829703526034;-1.9247589675614502625 0.83065115361594188403 0.30453369088946846688 -0.071306173822764051806 -0.33740340660314671606 -0.10706082296965317713 -0.67239410210544059421 -0.70436824101435568934];

% Layer 2
b2 = 1.1600276787863057493;
LW2_1 = [-0.90702866236440515824 -0.28616964860718663299 -1.2560415837499585567 -2.3415477001472742025 0.042110343712356890222 2.1152422494318203761 1.7744500797499473954 -0.12294913674452695451 -3.2738154927159373031 -0.39864530916833346152 -1.0759166587505526458 -0.11491241192238968449 3.1275772497346863155 -0.71103220100394060044 1.3067782454567082873 0.12723808491346885741 -0.68395454281568324184 0.35782231422459409576 1.585008507280430301 -3.3940580447631978345 -0.13172028236480159968 0.2619691111236873704 -3.1224480209855949298 -1.7155764021878499026 -1.9704167720978462697 0.94728388835824195446 -3.0350244047368337696 0.33948071855077149861 0.74953123925983522469 -0.2585938941959027848 -2.467402827166038648 -1.4255918056562957297 -3.5690989777747184064 3.8184573763157496629 1.3409012549670860093 2.7740412665854634611 -0.98081080576551604722 -2.8839710979805217583 0.28793412604686274836 -0.6645127845004815681];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
