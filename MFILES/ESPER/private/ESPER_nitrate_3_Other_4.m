function [Y,Xf,Af] = ESPER_nitrate_3_Other_4(X,~,~)
%ESPER_NITRATE_3_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_3_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-138.904784718693;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.0042772329208737;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.49929308687361850794;3.0589672222255792633;13.277966367562703098;0.52536750678903365586;-1.6138703311513959981;1.8672829870616716175;0.35177394061645295142;2.0232700767738887038;-0.54323974099968341811;-2.9315252600048808951;1.9423704594215112085;-0.99226102070173771708;0.68968255779935783156;0.37298534954689105403;-1.6717849249556355762;-3.5593132647253158396;3.5534849982002807423;-0.39361232265806900266;0.56051004826139660953;-0.36532579454184938017;-5.2272222538623944743;0.27084023110413618651;3.4431366387161714826;0.53182489605312177616;-2.5496499497291731373;0.75123446995054832254;2.3211739943701119593;-1.8172855242008176813;0.29612104337951450361;0.15679312101221931641];
IW1_1 = [0.2435069239623281756 0.67364189907016169823 -1.9979956166976551302 -0.48133799235904112246 -0.25179273536619128926 -0.87035496763201047887 -0.95315137764568080847 -0.24629405634961268334;-0.013644023750570321088 -0.37849800978036768351 1.3270514197023446368 -0.3099705942835963568 2.3558931564346998755 1.1478154032107363847 2.2585342753216899325 0.50485423210807134353;-2.8243454228165991715 -6.012164588901256046 -7.6302952398798602474 -1.0600046539980945148 1.1854399513318012449 2.9726667503092625289 -1.3072474706953987056 4.315777013541690188;0.57659469607266145008 0.2078499475244385275 -0.13234963814067685073 -0.21532312742295403596 2.3645064065435050793 0.15643975018023292822 0.031796132365445754775 0.97340285348404820276;0.3784368198066942468 0.55236125224207499596 0.81708009876412901473 -0.71104837970154477489 -0.64495313995803038587 0.88872823685020252427 -1.2409561018222690087 1.0066272237495774711;0.26298322202423130012 0.5704203699955481266 -1.0474846642184634238 -0.50273413477822515016 0.074591396749272981248 -0.44718339470218310128 -0.3575497135029758744 2.2368287393557708675;0.043543683164822467868 0.90565458310246971241 -0.22687563442292829619 0.64437604677690585309 1.0132471982161630475 1.7364442678295506362 1.0462950956576060335 0.28174681406994672717;0.32833843323260497593 -0.096467113512173421896 -2.4718450502117121914 1.5383997059485496894 -5.3391030421640479631 0.29469708715410469768 1.3694311229059310531 2.6492623096089067403;0.098320196119559957748 0.33347459835578524556 0.18499673588306064786 -0.29225909713662467926 -2.1593625514332845938 1.0086007819315416789 -1.1095286300206019803 -0.10536682469424679676;-0.40080586877826657188 -0.1628301354916945054 1.6041912206693542675 -0.96637600081158225862 -3.8135576082603908077 -0.31700305775511405937 -0.72406214676012781162 -1.2745574734977560549;0.2564613691567527165 0.47058211638818425726 -0.91100583344980601286 -0.25311925311736077626 0.46789358881494896858 -0.247202977755774711 -0.053785215581729037271 1.8824097267736219496;-0.13697830324935755808 -0.030608808247932418889 -0.46372627629985668785 0.1207797637455530898 3.4880711935477357599 -0.11616522623217222232 -0.069734030318951575889 -0.39287731876104647899;-0.033674689656281869832 -0.59831455516093112745 0.33884811462299269103 0.14385486487253529297 0.90720851286012482717 1.3932698539977435015 0.60003706080606344919 0.14736189910373212464;-0.1952095395528293531 0.25585999219545113581 0.12239420831500633091 -0.12897771740748517622 -1.9121669423663745224 0.56100155119403949389 -0.30779544577768402913 0.10138441893910261904;0.041998708796477782212 0.1978333447936749534 -0.32065465620837158012 0.28071899073202355446 6.3105504261742950689 -3.4111526346258740361 -0.39444165531986891127 0.32922393819371581491;-0.18261703655063271645 -0.4614380890196152496 -0.27717294860181385108 -0.034845584481307895208 -8.1717130019377393069 -2.7984965720925796262 0.57897171628372101626 0.59687261330627350286;1.0834891819447873829 -0.21844406101242314078 -6.2935556673771335667 1.3882526246530024761 3.0733278959875498515 1.2527869404080278493 1.371643561917238241 0.99590055173472136207;1.9002595338177781237 0.24387582027296422771 -0.42468827880628085003 0.73397022435736380963 1.912034739903292424 0.62946883887209503783 0.20188322882796244651 -1.2907680118030770977;0.020865179058995469291 -0.58663740839178468711 1.9544135625851524196 -0.3317941200391621992 0.71073229843597829358 1.3410481439851489327 -0.36316792628481303629 1.8942708081180470447;-0.13261338992858978658 0.44726119520167434418 0.55595881000791880222 0.15506744577804973395 -1.4266560933356264851 2.0926044344224248306 -1.0651051165299756374 0.27145405179959269937;-0.22137884899334642208 -0.38902835302358190761 -1.3842522696853407638 -2.183073810747428567 -2.0323328921775285494 0.62517378041781446196 -2.5308809329241634956 -0.79444268475611867775;0.17966728467568071625 0.10363565671363510201 -0.43380287425817598557 0.16642937076180291944 0.80277487980613027041 -1.1118825406277019763 0.82899016453508833635 0.20383632187399061686;0.98315971833801851787 -0.14888087276451528185 -6.1036680387825406058 1.3093806194177288749 2.7460550202854983048 1.3086493545821962226 1.2478194770990862494 1.2597504061766733319;0.31773527087469727315 -0.44944451555852082958 0.28027221442275285224 -0.099758404267696609846 -2.9622018380183292585 -0.13735075021647680238 -0.89799092080294307117 -0.084669053426655191408;0.43784373408046101117 0.080623515108210461189 -0.83124670299711145294 0.32923693520397834256 -3.9163267568547017738 -0.74578782079756600343 3.3763082010797060839 -0.083347225796309265533;0.72661667494574544435 -0.51196118539495294453 0.043401587704716075578 0.36393910647719618368 -0.92981447849150855589 0.44857138593685497163 0.29785674389776256588 -0.30912438558641186503;0.26727132029800076962 0.25505680999778307383 -1.3299582135360286106 0.45286370110346824136 1.3326221173026882028 0.80218710465614162519 0.56167598330672108276 1.4333102956164107677;-0.04066589208745517714 -0.33720177012614421796 -0.17879215827310948606 -0.22097035603409201365 -4.2752775020267019812 -1.7731896855084781084 0.29354597743632637741 -0.20177278798296907625;-0.09657953620487531865 -0.34974669380070072533 0.13171012431265771703 -0.0074210962497347141009 1.1329355072844247143 1.5850202988947659222 -0.14726301118041881799 0.15967744871881603408;-0.75356405367885881397 -0.49080032028665060428 0.16985154404683069918 0.47817687214916398952 0.37750760040517944427 0.34541907007236904992 0.50994107517754871939 -0.81546139907398784707];

% Layer 2
b2 = [9.0761011655789438635;-15.615718006031372056;-2.8163712007531809256;-3.4566990358516034298;-5.6686812704079567737;0.4184060491658485037;0.60382695823278020875;-2.9575583633271582684;1.7572176876448426519;3.762983074382972859];
LW2_1 = [-1.2256755123291054321 0.73937136351935472955 3.5522170862760100718 0.87812891592290454046 3.8956022584559981681 -1.3257094727338740725 -1.0142776364882721829 -0.44387415357856607745 2.0100331090666840872 5.7075072642174937698 2.3826345446807524198 -1.999070522601418709 -2.834194778265671566 -1.6248906922576267231 0.020137797888639737132 0.61515711526866723169 -0.16927299329534686856 0.34962807623243680188 -1.1364392805176277701 1.63106144936852826 -1.4974995261357573195 1.2348515896279468329 -0.082533349861853164131 0.4474237304181037933 0.50247203522286287836 -1.265700087999851009 -0.92484289895631921485 -2.1044096283031499262 4.3363623287795292072 2.1146131854947589623;-2.0133289502128675075 -2.3729335894634417947 13.523637961377724892 0.095372116099091158725 -2.0101477102563172217 -1.2425044114174517151 -0.92508194495879836339 -0.73323686392535469825 -2.7035516996585347016 4.666287530018034424 -1.5058306125924849628 -3.6399621041734220306 0.10898218582988455916 -9.4058377839732667525 -2.7249200925367502713 -0.17234205548201211866 -0.12162325344530681981 -0.33598092724089573258 -2.0592338543128172468 2.8191865953089614294 -1.1266042685687147618 -4.0011711907359339691 0.57213957401888815291 -0.88978941861316729334 -1.3383901783361451532 -3.1893401964032035423 6.2789072320856318399 0.62659744718155885312 -1.4727947067540163584 -2.3619200830618569675;-1.121178876454977269 0.12603859109134418759 -0.77060378583739452818 0.79537797596876891326 0.46664258896365912177 -5.7029923842707956894 -1.0651273137661818602 -0.082374336898961439402 -1.1706910315637155673 1.6391304601097780314 7.6394521442792884258 -0.30794759957472561673 0.8172080078240447909 0.81377311618513481495 0.14048394348801337972 -0.21459287284946854113 -0.46930485451548065168 -0.30276104026306605022 -1.5779068402414784256 -1.1789166546390561496 0.63467426076589494865 -6.4184142612399970318 0.34802955289511877668 -2.2276801083040087548 -0.23245242747686917228 1.5812416162480338322 3.8114802313130402567 1.156838375111993944 -4.6103695692923363225 0.093778619326312526172;-0.15165067040876864524 -0.20386183414851768991 -0.77774122423687142014 1.843232346536044286 -1.327203948137559042 0.059570698091108674477 -0.99891151370627140338 -0.081203407427753407366 -0.9722721520431046871 -0.18698336687929045796 0.19502561578747851234 -3.6595815627004149029 -1.5255861481951751291 -0.65723065855595541596 -0.034780857670035553175 0.48124381928039283718 2.4600680175284916906 -0.16138637852141665685 -0.94123783273900829549 0.4436402435139397693 -1.3010822139944318021 -1.6740379534881717483 -3.0576911152306482933 -2.0047650737276097033 -0.42748575053409493263 0.71589041894561888935 -0.30385393431018392629 -0.34303883427786185933 0.90898491193914576769 1.2711112016446457496;1.7001222907879454116 -0.83173442384394413729 -0.25268551412902667819 -0.03616982588327625342 -2.5047632497565044396 0.42153347840070742869 -0.949594156199026318 -0.54844153228278536005 -0.45684494472646564045 0.4225408550417707465 2.9543890391893072866 -0.035500614445923769913 -0.14633398207730621832 3.29275770361623632 1.3549842394643769605 -1.0983902478696527805 3.3168689433253901733 -0.26057708873000290373 1.4402785685448731279 -2.0658595735045368613 -2.0779669264172566656 -2.3455508841838370593 -3.3353930759723438015 -2.6954078508721623919 -0.091368816540994782227 3.2081946077102450054 -0.98124497323015358319 0.5139224847467623869 1.9805161174892604858 0.61863886134426204766;-1.1682307253229851085 -1.4812992364945982704 0.15819246309680778939 -2.5904316092397188243 0.82014764353125635399 -1.0754154539319054074 -1.5496585168887317963 -0.094871961950160454968 0.73913675264639844276 0.6835549157712391688 2.5088506035781730219 -5.2621321065752830748 -3.026448624140750443 -8.4304046865478898809 -1.2994289107254151094 -1.0118444533994650492 -1.6004606697102410351 -0.30991380703284526765 -0.41754690619733769719 0.32471969968089603453 -1.6053406255538933411 -1.5145590168236644502 1.4712651385030794948 -5.6468892196847582099 -1.2071125129530133613 0.97654475639445670332 1.5127635354345139174 0.3760927917688169364 4.8865624021038289726 -3.0262473817235902018;-0.59936262119907790513 -0.075785081690681557753 -0.72121465820255936663 2.7580064066139886592 0.48030007358972809373 -0.80253954170671848445 1.6816813865950475115 -1.0178712884619682821 1.0268505835649452962 2.835544887533443692 0.57061162359210604311 -3.1165751863822697132 -1.1140185642414652811 -4.6026029178105201112 -0.68619352194761895625 -0.54601996929394747138 -4.3431273355006148051 -0.47500225846710936173 0.070974429797905483341 3.0766880142386279218 -0.22935458627406568599 3.2316359341853169163 4.8186062215957115029 -1.27161036878949818 -1.4250889580018748504 0.25408275017462589318 3.0598699147673458221 3.7546392315815051433 -0.57408377708071589574 3.1953585773210062548;0.55161676451574315205 -0.25773810138128361302 -0.063087084752309119384 0.060509971434489988329 -1.1802584495331933656 -0.76590496105494465517 0.048968303196190388071 -0.22342164221633684096 -0.77972779724442387028 0.0098689028124935088138 1.7712855851701347909 -0.67901014311044960436 -0.12075488047472998643 0.77582676116754667461 0.076113841591856801205 0.031908208166707016651 0.44050562221599814938 0.011400748421119558107 0.46604340195733445773 -0.19689075045892462379 -1.0085424841367687243 -1.0239724641958014573 -0.52255477073313882919 -0.27165294078182378179 0.11908486135319854005 0.39965183032195206181 -0.43602991499923254848 -0.023975127803082758871 -0.17690635438789881206 0.087010103707316155397;0.75356072245595140391 0.18596796112567232084 -2.4806542520296765986 -2.0463631628126499606 -1.3697048636434130398 2.3005067450397875817 1.1307321654574149505 0.49752113807004200163 -1.2274949030018182938 0.97287774400298743238 -3.1489156794965027508 -0.091612974066015512298 1.5946373970689577959 -0.19798992909378529403 0.14055465660432336916 0.078409222981194792723 -0.23716559527749167535 0.87045768531880385321 0.72648824512291187983 -1.0256428267141928234 -1.3454512647196179564 -4.2006038817844864042 0.2390046290930156192 -0.10006659907313943114 0.064598170250435016371 -1.0068377031709332403 1.435430434187782156 0.41609626665112198207 -2.2851686622026980977 -2.1993640481032059597;0.037527176502834477811 0.44994244777497233168 0.15693898975541092922 -0.40235093204435801173 1.1054761696271677707 4.9783727529134580436 0.085968604334765399977 0.49801755279546289223 0.85697291386650220613 -0.41726451023325378253 -7.24004112754892315 1.7523251869652818336 1.3961923036837964318 0.2950869585265729067 0.41514806241526014396 -0.39913471481604484437 1.8197422085038106321 0.14253113994283486687 -0.0073257555575642480106 0.73044733204373868407 1.46087571125295268 2.8489193187064123514 -1.6911213369878506096 0.61335730872801275115 -0.14116920868830390434 -0.54874926243456279007 0.37105616775733252233 0.2387100702581676781 -0.27672494155100496593 -0.30322181291133293302];

% Layer 3
b3 = 1.0119568437836901076;
LW3_2 = [0.40560415653989906337 0.98570660449173763684 0.36007307205983074549 -0.30349665762367472599 -0.2581264668180217603 0.14961692192769723841 0.087572331690209281874 2.2064921928009075813 -0.35774240007395918806 0.73142153440882562432];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
