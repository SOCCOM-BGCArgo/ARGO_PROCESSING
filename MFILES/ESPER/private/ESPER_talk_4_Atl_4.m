function [Y,Xf,Af] = ESPER_talk_4_Atl_4(X,~,~)
%ESPER_TALK_4_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:45.
% 
% [Y] = ESPER_talk_4_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.21010195647442229;5.3628526392353262;-0.35520664842134642;-0.29295306785073227;6.3588984048687518;0.73439938678280292;-10.638226490592151;0.18562898634759092;-3.6721241294186626;1.5372557048978899;-4.5087937805939395;0.24569750568539528;0.7500711071225894;-0.73775254861011452;-2.3510402051864352;0.99606096216062123;0.78336235714431401;-0.56007677060340477;-1.6328592903176746;1.1259535460229457;3.9702481474162714;4.5884905872539177;1.7799736348331494;-3.8320753691881819;1.4355157143617023;-7.5922775566324034;-0.062091046928769426;-9.7023904237700211;-1.5735741307740456;-3.585441723782735];
IW1_1 = [0.15062346563808951 -0.13193530321711772 0.057225865065687817 -0.067950926814805288 -0.2013204126409931 0.51804033116284509 -0.0013119519839994288;-1.5859704925690163 4.8272584315954052 -1.352641943047481 -0.51249409111049449 -3.8186837306352559 1.3448229070731066 -0.2901099067820293;8.4325331679363487 -0.71917305302147627 12.590747809826032 -1.6738703380676929 16.211735356602606 -4.7490254727753864 -6.1231729938788515;-0.62550667131966908 0.65437482787796963 0.15970156355853365 -0.32117447315480652 0.56860893124995671 -0.021335795813070935 -0.033555426402345719;-0.38863423696487526 -1.7274531184073583 -0.31333587990591616 -0.21010744658210168 -5.7957225825973584 1.427071898364352 -0.64387961455803999;1.6616510788825223 1.2725388241160023 1.4785682253987242 1.1773741331904097 -1.1014151280261391 2.0894886657169613 -0.73372238270437029;-4.767194964627115 2.8802096409188174 2.8881094139900108 -3.7752807394875614 19.242452700671052 -4.9976461737875235 -0.97245159987182739;-1.7381154649815758 0.51711175550955657 0.19320063265105938 -0.3780470335719408 3.6227098708157639 0.52863337674928401 1.1835710885240767;0.846490971016577 0.42836458153018031 0.0448057798189061 0.65235963760206472 0.11810116169302429 -2.1890268721558241 -0.85668385358051591;0.086659919843252123 1.3797187082802567 1.5918882102219509 0.61214590779910871 -1.0473823180504029 -0.19094790099569278 1.8594591812537713;2.8673801490836501 -0.22839039780580639 -1.8975876799546314 1.2957651580128384 2.6745730929347777 -0.46626004290325013 -0.13127315629507336;-1.4199003013406404 -1.3318728040911105 0.83989812430434951 -2.6402319348343521 -0.70623583226853015 1.0029684486410568 2.893143254748479;2.2428519069628639 -0.40797736118839129 -0.90533855640746141 1.2955621125646637 -2.0719103427314383 0.46609976698458122 1.4354173446759155;-0.72930020564888609 0.56585615713954351 0.10029862615069557 0.74319739491145842 3.6525075504242346 0.16151934999061496 1.4221038086227746;0.16027003047254279 -0.46912413676890757 0.0070618486699245524 0.018909812089201308 2.1368400812305515 -1.5357788081018291 0.87836280895992103;0.90066848409442768 0.99983786989090673 0.47474354589175505 1.4119695005707333 -2.7067225043099836 -1.2093029432432225 -1.9112206087368753;0.99806564181755786 -0.4384979177485242 -0.29403659080486505 -0.29408025822541312 -2.2966861320981868 0.68638019228325531 -0.20354094665895792;-0.21708600580489146 -0.45015338022022799 -0.35990924500086269 0.46003942714549084 -0.26206067454330878 0.065403334489312168 -0.16538086852661629;-0.5883361581022335 2.2187021989715281 -1.3123491439999464 -0.50133397155879045 4.6149414800660589 1.8155210446172847 1.2139180017917455;0.17460339880823095 -1.5710051161818561 1.0711899978380062 0.37812574557715839 -1.8939588471991062 -1.4970880353230132 0.036493043133579615;-1.1666044885537603 1.8492510218569647 -0.29090404509284973 0.55399306033395634 -4.8432720966993266 -0.73322125980858854 -1.9675961937326607;0.49803806264144512 2.3067273605200755 -0.48678165853404204 -1.0661884280104639 -1.796005290099687 2.917687660185738 0.61538884024140006;-0.50736486764899724 -0.03954886673126401 -0.4871787998151052 0.83545587174791203 -2.9087063504764021 0.91738897058044766 -0.49737541571331845;1.4783292560067649 -3.6533192722181531 0.87570054329855107 0.44631910588575302 1.4121660722645846 -1.7222779464150781 0.066147522772756193;1.8618986461359626 0.32621865302441888 -0.49244400906780228 0.37427256265031128 -3.2958526939335409 -1.174900932848044 -2.5117290328391348;1.6043949363586909 -3.1941661474421568 -0.85683064472703585 -0.7785849749733218 5.6220873747847433 0.39534452539565784 0.95775762144327292;-1.3371125646565423 0.28609496487085057 -0.62962103549478832 -0.60304940221068926 -1.698049721874378 0.88558088552028502 -0.040786523594555701;0.68839484388184558 -0.74414015890174712 0.38028723257412572 -0.026114720640198538 10.608503451723253 -0.93674042386991774 1.1452612022900122;-0.54591073217169706 0.23025160579245454 -0.52695917024062777 1.9663687167837565 2.2745728424051697 0.53194251707901796 0.25451431186483703;0.3127198071645102 0.33405694897068022 1.5992683682976554 -0.77909932359215495 8.0222345620697677 -1.7524817753669613 -1.6383804755721623];

% Layer 2
b2 = [0.95074601736622477;-7.694706469438926;5.7443593578986514;-4.2165744736022086;1.62181798264955;8.0196050956442964;-1.6623755791548693;0.79856712215143821;-7.2661780036844554;1.3791518826228848];
LW2_1 = [1.8177758791491454 1.245415044102105 -8.5147941430510379 2.2675807100281524 1.5420474896650411 -0.27633079179642761 0.26075177217150347 -4.2579165271127284 -2.7867250930108827 0.25489300526303993 2.1338112014610595 1.5433410979545763 -3.0555351353072426 1.5269251341616497 4.0597892688867558 -1.0886917879180196 -2.7407176254558481 1.4531203897968548 -3.7138718000838051 -3.5828657552557641 -2.0038266194344958 1.1403869510479603 3.4830761390220806 -1.4759271012294948 4.4118917647658051 -0.6672121655936063 0.10292215138247005 -1.7743730747737112 -1.6081364298170702 4.1571032258805722;-3.2911519807169807 -0.56033681593824924 6.5658865098111781 -1.357604598587725 -2.272586677123257 0.21112004609059945 -0.065144518221818076 -0.8153821060403168 -1.5454898937098036 0.39735242922050529 -0.057864242885652471 -0.047388703516821978 0.08933652931013307 -0.32723841651210245 -2.5147286260832393 -0.59496905335952743 0.0074747763694655439 -0.92901808348284765 0.37622430751442126 0.29390067183132801 -0.37903520367117022 -0.54170408383817448 0.22479545552726657 -0.5147015946315121 -0.36459530696103415 -0.33933922373740533 0.75887743864935298 -0.16919558954098732 -0.10410658028792623 0.79431525882540488;8.4891610443784682 -25.715206726281366 -1.8936441716763635 4.3822319730346164 -0.17564471651308983 -9.5985891545433581 -14.320327658212813 5.7460337424098125 -1.6747120622857561 16.210945382379446 -20.016263519502857 -4.5745458019038656 -11.378525255164893 -2.0442798677891716 30.944616933895738 -7.7187805630257085 0.59125900291883582 -6.5393581983456359 -4.6389192853577184 3.5641029137124773 2.6472106719293409 -5.3040735727602382 11.91155581236521 -22.621344297067587 7.4887061458655042 3.2087628251527205 19.078450892131173 -22.076078688922763 -2.43603923273221 -28.856839753833004;1.6252860143751136 -0.35768184549446302 -19.268429913446319 -1.6212978951686388 4.5065682423598332 0.45494650130224251 -0.54160438084683626 5.1308434126923359 0.096087526206300872 1.3271390378872117 -0.62576678496957527 -2.2061565429069594 -0.35359802522163208 7.4169180427934833 0.42660310988843714 0.42421608655236898 -1.0260372390112686 -3.0707591505834406 -0.45860152689157713 -2.3767874886788052 -0.053667600955853732 -2.1463454896155176 0.42477804553186488 0.84539789472231086 -1.2392219304046206 0.1459853217336014 -5.9058380008648035 -9.3752923692957175 -0.72651377166848852 7.4114468624201146;-7.4400356210665031 0.82718179325826557 -0.80108028455116598 12.613731653012071 3.3641278865865951 -2.8720959676060098 -0.39879735607667766 1.7605833474018022 5.2760198486619432 -1.3952920515628344 2.9826073610633985 -0.27055738285665271 -2.2012254610837405 7.2745277533394805 -1.3851450967020258 -1.8740773192277427 4.1397259862766047 -21.922969151694598 -5.4876602246580184 1.7280524933161736 5.1170940760789811 -2.9343484664018002 -6.7203248251041741 -5.1975100405727872 2.929640487647327 -0.58463660514039806 -1.4653880032595872 7.942243648566695 1.4871900698151508 -5.8335694732291792;-2.9083873368697395 1.3164738855468026 0.14661035455961507 -0.67959177348629862 0.33669043218644135 0.43377704523916144 0.387417264479132 0.63835476125003821 -0.018454586407090592 -0.65805566686139838 0.40913347966224273 0.38450195766952855 0.10403532519350361 1.4868305582765107 -1.3994954664938937 0.074118460082576804 0.80308368334747715 -1.2484277331847964 0.829366512097237 -2.6997631550603236 -0.075200860409362413 -0.10565519011234493 -0.94698768654055654 2.1533404518445409 -0.31447975754970703 0.94407740742060831 3.3689613682147592 4.7704470653143618 -0.26539301622699657 1.5612208519971302;-3.3513309739057306 -1.4101369460516782 -1.7592712331236438 -2.7694217532484076 -5.1594442015181814 -4.7891363382108523 -1.696958051916585 13.668894441906748 3.9717728387002293 -3.6200618913379539 -9.506254919621238 -0.64576314809756252 6.6220365311017551 -0.82190736537553055 3.8465004721779503 -0.44689018844637701 12.693771526504394 2.2541380679907395 -2.8753430354850438 -1.2257739014017652 5.2721653168451628 -0.83591290977033261 0.055056835805312725 3.8999736225163768 1.3042479342389615 -1.7140555232540289 2.075315102019244 -2.5296411089383724 1.5780217928879545 -5.0346787229045962;14.202865922010984 -1.5228806336891152 -6.6638800265652316 -3.0683230189993274 -3.8147314971297108 -0.49192839901601054 -0.10821222767706397 -4.0414337247250129 -2.6272561794583962 0.10459074221660294 3.4156895297971488 -0.42793584976066401 -2.3878521765902239 2.941849747223686 2.5410554746538789 -3.0432508167481078 -8.3539483878748317 -8.5191214631458507 1.2256433230210488 4.2348351217854852 1.1207286728271817 0.15272924199578686 1.7912929115583776 -2.0498605747583354 5.638119661742989 0.85566724039247677 -1.3224470218750894 0.032381205752212393 5.2416845287454379 3.9005453684157914;-4.6476447997324728 3.0155109848056387 -13.61324293981516 3.883161586538622 -5.6235118206075452 -3.3056583506967359 -3.489580033894681 -2.4979535970048432 4.5308647927220225 -1.504867892709884 6.4802261952149971 -6.5363863802961628 -1.0153227162616978 -24.499485293465579 -5.8753435989766913 -7.1913124046269621 5.6073781732355741 -14.566791634320877 5.5096689852495624 3.1384654999369026 -0.081391890242202419 -6.6997586154281423 -3.9337564329950188 13.40126991238639 -4.8298153197586151 -2.6009607423650487 11.134920218074743 -21.972617982586719 7.0443342622693912 0.33838252919284922;0.47719390879319679 -0.35286341106778846 -2.8104883283801065 0.85558586410445714 -1.643007298011254 0.066517137412260383 -0.26400258298779544 -0.096135644571461884 0.041930464651017553 0.19812397423503261 -0.33470502093871141 -0.14922043916418962 -0.22744946512254607 -0.47565583399687833 -0.62433823854317638 0.15363143029009257 1.190726622145541 2.6993698269299817 0.32471345020063636 -0.043463321804429793 0.12021553986304326 -0.28920170284395724 -1.4366183802160994 -0.48096618440855149 -0.46759772776306729 -0.51606495797865681 0.94968124924192754 1.0644435041102212 0.69409335087303614 6.0858315000931071];

% Layer 3
b3 = 0.25238162016610199;
LW3_2 = [-0.039513955978558057 -0.27014625211529575 -0.0018772198374056599 0.0040305509427488234 0.0023535842286738782 0.10349195973671481 -0.0029257703917335469 0.039160091191806426 -0.00050571883978540403 0.21795152166976256];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
