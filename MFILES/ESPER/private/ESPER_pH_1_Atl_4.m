function [Y,Xf,Af] = ESPER_pH_1_Atl_4(X,~,~)
%ESPER_PH_1_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:20.
% 
% [Y] = ESPER_pH_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.2178;-101.945317545701;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0054210015363163;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.5834353317358820235;2.0314003392938748682;1.7538479139631666381;-1.2478455342102134917;-2.106703631919168096;1.4207887222056307941;-1.3763406609337305309;0.53711851228042406525;0.351476797221724091;-0.24110781768413847015;-1.1795228256557448443;0.28874658189282104148;0.42484228889475572633;-0.10042555424684621035;-0.49687813602676406122;0.6609651050032451236;-0.39143296482014028337;-0.1197678806093442766;0.43660255082419735517;0.5671511316794798363;0.57440418443115359715;-0.99404327811623316435;-0.9262733443932066324;-0.17534407836693102767;-1.2991426633584379768;-0.80054437563484770468;1.9648978941163071088;1.9711170418174528418;-1.5380853679559631786;2.0133804630656007006];
IW1_1 = [-0.43707813825275793063 -0.013173824486340780793 -0.19015270771248518611 -0.0074938042525527562288 0.64322652534378588207 -0.011954102848707175155 -0.76658849171229648256 0.83023500779568459862 -0.97344460668173904416;-0.66638072655207525319 -1.0770687905730345069 0.66041025459631885752 -0.46456673428529643433 -1.3431706050240055372 -0.46567586529973120646 0.078253170710361821816 -0.95463222078674236926 0.35792780401081142339;-0.12536393656208127956 0.066039416562958683232 -0.10837323762973283259 -1.08935407300335374 0.24448949263385197361 0.70613533852053722573 -0.45657844154325821773 -0.52285624751249859532 -0.6040401455961413868;0.70692321950316294732 0.58684119254704536495 1.1875654673140019213 -0.77295371374409238552 0.76667213623569530068 0.25109364749437462772 0.44736889779815991464 -1.2768125252385924551 -0.95253152344690417141;1.3441485046610466281 1.4884404500308578978 -0.42106555187564803644 -0.028780489119308017704 -0.96103491024487341932 -1.263106099760355816 0.18131566142106042561 0.62042514179601981894 -0.063121783985815041462;-0.36446299780805102575 0.49671306064952491788 0.34201528000685343933 -0.16816995444617882649 1.7938452650141269995 0.54844298915566125352 -0.24570322588354207016 -1.0753940123777110394 0.48528312321730515677;0.092438156362650125697 0.72529072895464119508 0.59893626308559411164 -1.8038608357105605506 0.32665673866569622241 0.81415258934408174518 1.4789471108216794004 1.1950566859574169865 0.5011443953726345546;-0.32768573646836235413 -1.703521293698969874 0.133936525158276587 0.003729621719367370164 -0.22693200557050974275 0.13766118303739707796 -1.0689151065422561881 -0.51007688396199712955 -1.3498601361156243872;-0.60328436033507304437 0.17947639758757785722 -0.59365811896363473998 -0.18411693607361573344 -1.6877581577928320034 0.19776931244829329404 1.424328198809652557 -0.55855435586891277744 -2.1964037536463729694;0.5263283384376739038 -0.34176610786592975799 -0.30594371505598810801 -0.3084864787091082805 0.61098543710310726507 -0.90285280245955112921 -0.87472688421552025062 0.57889320997964710536 0.26823172227031788495;1.4430826291284351015 0.0636626256379615868 1.5811078051719089643 -0.033482171945745882458 0.74695294327219952102 0.0051478066427603740018 -0.36370046376686615552 -0.14651009671308368176 -0.24789269712534672818;0.0046581883485933978095 2.0185083291537724293 1.4789919208782458249 0.29949051510742874527 -1.0683335464274696935 -0.16086542653844987383 0.47874312773216987082 0.96640208270001370927 0.6366968958371070908;-0.87133321255795626037 -0.30458758497227778062 -0.55457054698291219363 -0.87980782203983287637 -1.7321780196881804148 0.33306227597316373501 1.1129722832500414942 0.72344722063249433663 1.5178325772451681797;-0.3626297781627391692 -0.73865127659207574506 0.3164329466274624636 -0.46145648348264856065 -1.9005076124591240294 -1.6811140380127986838 0.050096703145803264667 -0.51031038621538649114 -1.1099926321198265722;0.18554013773989055935 0.46834001797310004234 -0.93644050218960139809 0.23286441489591636067 -0.15181746520154246194 -1.3653787098791907439 0.19585304328172248312 1.0466893077312531268 -0.82252809382859404241;0.53892113502015970283 0.31569363038671771626 0.4751923595837997949 0.62122669483065107165 -0.25948712131481160847 0.59346127205617082989 0.51800125783253114786 0.1128625110426542677 -0.45296682985583208714;-0.44850209983196431818 0.018496761365086381718 2.7494831144335716289 0.2110850519479751386 -0.77956926825607597564 0.14578509926838947863 -0.55418469072927822872 0.31419297165267556782 0.24659898796484078232;0.074936409637015449769 0.10125452192811984498 -0.050345848162816710103 0.63138206879906066948 0.19026105750958732798 -0.224426519934293911 0.89246770669048014479 1.28500719544096631 -0.29601660247531358383;0.17150899896765103847 -1.0328025422477351558 0.84222087679098511792 0.35482352457976373827 0.45958294371732022476 1.7917854676436175687 1.0755727242432773227 -0.8450575106351739807 1.0630968495691184295;0.50018066083993528714 0.67150490112133509601 -2.0523218201519881632 -0.14562832169123468562 1.3797584139306702244 0.64818602567095806588 0.99795477043550073759 -0.81257464335588314164 -2.0265593801331829305;0.31092001652912581999 -0.600896052325994523 -0.5397298577787267293 -0.15055926871086691698 1.1087491553083677065 -1.7761118158715953896 1.0846469403426546307 -1.0513579309421230423 -0.058926204640568788373;-1.5862122427711469186 0.12679222427354525093 -1.1621199328106068815 -0.082505301684319201638 1.0800091400906970396 -0.38492494298821000598 -0.80833952690734411917 -0.31920049699746050331 1.3584598455666054839;-0.58280702245196724931 0.15171127641203768777 -0.86485951428359497672 0.32556387512995527134 1.3122442808419019222 -0.0024450234482828485036 0.24906598402252605462 0.16801230397409788742 0.39871973431322554893;0.38981365834332681874 1.2373517615382296775 -0.040301649913373045753 0.99872010200517669087 0.95722486201549195073 1.6866702181697978968 -1.0731488461868501361 1.7341364421582496913 -0.39778845535266155187;-0.41578649219296170969 0.65548220207423002481 -0.0046942508009574467065 -0.53819447465942094055 2.1204748486883149283 -0.28422885201922876153 -0.58756475594465884527 -0.74756494662705530452 0.14811265553422242602;-0.57854766754130371176 -0.39470136268612660002 -1.1276345368762654697 0.98396016132305186286 0.80515106451807816335 -0.30407215002945769955 -0.24986824787697919925 0.85176656503986170055 0.85616912419133761603;0.26692146263746191481 0.10744445094257105977 0.6885586425724478099 -0.22734591961459313381 1.5643494602317240538 0.81503813481153053466 1.1359192417817629561 0.80029923339395736548 -0.56594395823907250875;2.0867753644725497431 -0.56146811026625909058 -0.33135039996636456161 0.61559940307836569229 0.19854006164722953764 0.64335486542088704542 -0.50609530371185418307 0.70122296517811022465 -1.5806408152765238917;-0.7064822239153735195 1.0624890861148492682 -0.075390637119701647828 0.25396912990285502865 1.0495844286340676454 -0.12720352300883522312 -1.0730820664950990739 1.0960701632448193177 -0.44301839568922951607;0.96671773582047493267 -0.19104669527527179396 -1.05338612327409753 -0.63979000830730825555 0.12122514689110501507 -0.73739484405069855022 -1.1396985450519980798 0.04614843042617963742 -0.54863797368555033973];

% Layer 2
b2 = [1.2683215562448195701;1.6054690237372619688;-0.32712523786481600974;-0.54978472978918546676;-0.39288652611225477473;-0.32090188094962229792;0.32637524630097475287;-0.85181466792952020839;-1.0885336850759910199;-1.544533651961133458];
LW2_1 = [0.077928189790856000618 -0.64831785219476179005 0.22309813324904481657 0.52563909041837553193 0.32567095048253502654 -1.114187000027088148 -0.26408995932783363436 0.042736108596223301714 0.016254361971062381703 -0.96918931958309095798 0.40279443034645789901 0.53599649393108750317 0.04296398970776986459 0.1707548476709885299 -0.86916694591362131384 -0.64811360930963612947 -0.76329314492259003888 -0.1290036975517069584 0.41915042036808730641 0.25491702660072657061 -0.40774790893484547105 0.16738861946243191459 0.026227496411079315869 -0.10107400045849657122 -0.83441155198246796942 -0.38713816278019913542 0.35196542296791910598 0.25552096550055292123 0.88091404118062011097 -0.18023587896452739066;0.39661164506239748873 -0.46355794708592501507 0.23392748852434486206 0.6326789558852482509 -1.1021821387356001143 1.2120761787093710105 -0.33058576487901697449 -1.157275863943992622 -0.96242826168065354064 -0.87838877186157926502 -1.917369539920312782 1.0165201963171797139 0.81701093115236222975 2.7718169830403001086 -0.3173864994804425077 0.97386883102552379565 -2.5941161223116799839 -0.20634861317664748848 1.4427690044168519634 -2.0556503945644224451 0.23108004435251053299 -0.38165896766417839459 0.32860020477046719689 0.32388480916926892794 0.20155475323210794714 -0.70516608714134965119 0.80693203764431342684 0.52520244350267109024 -0.21432153572693571353 0.45797928627305084515;0.36500736685390722247 0.74928898193501114466 -0.47688979349475663083 0.23943013524719122809 0.25323258506193579986 0.0076053179590482569358 -0.54292726514800149218 0.20754739999698224029 0.61202613629631696934 0.13856707414256741462 0.29262714424158065007 0.31613342517836123813 0.39729805747082774792 -0.21096627077013010987 -0.19744914544952937852 0.047700169765853429882 -0.30109442437401523485 0.27446512951383555956 -0.45970321947601194834 0.39850265526744732547 -0.51673373698613367377 0.54289619323078774915 0.5393556873849536526 -0.042728677527234464051 -0.37697899072995799674 -0.027318378375175464412 0.31800690293718342216 0.42132375449755049557 -0.23136831020714088147 0.55484250835739057361;0.18183815231192140827 -0.70236013481476422537 -0.054960638677707021604 0.23856284776047342877 0.14525317682859600898 -0.11681792122004100443 0.21264703536259035865 0.081207918798178818642 -0.60418293696753566646 -0.80704728481368470661 -0.068202258477779442725 -0.33019710014863729031 0.20043530573132808947 -0.2272684849729580403 -0.22132117465581238602 -0.25842774489313574682 0.28052349659132291837 0.23720548614292175094 0.40568604270293884273 0.84197030169233144647 0.14571346129040091411 -0.96286015979559957945 0.29634625732990466096 -0.56420686775569783844 0.8605133118317561669 -0.32588645363658247378 0.071833264019995263228 -0.92338826274329943722 0.47226791109766474985 0.25324590968845012151;-0.22007113787236420865 0.23912673289651675823 -0.29456198128893351651 -1.036051003907577206 0.28814495740682155578 0.48853022653647382167 -0.11845384143459537774 0.29869541845614988596 0.52611488252613825001 -0.80614662721286278746 0.87142468852861798556 -0.047897947769444212951 0.36361021616665822886 -0.48871685561559147226 0.31560376594135025607 1.0297738743279898355 -0.16654351449234541804 -0.13839036346953068057 0.019744970557196612343 0.39879795620952718238 0.18939530110116120643 -0.10335570981373876087 -0.1733423217109911485 -0.90321870410454008216 1.5181433024109567409 0.16659548320349351624 0.2509157724783179777 -0.52155782955547935753 -0.39162799656155516947 -0.34334741971660220905;-0.37044629093167030787 -0.11274450965183548112 -0.11949859129137495317 0.74444740391083574771 -0.21714671000780672028 -0.5149899443170999902 -0.014850596188102221928 -0.1644852216134177203 -0.27189853084616200096 0.22933047256983657425 -0.80137632312053852512 0.0050837046346638783967 -0.13440610976412964428 0.17547522864501466366 -0.33039578793900686859 -0.72848224120958593453 0.33306067067821970573 0.24333672179063420282 -0.30797650440716611842 0.57291515963091366181 0.52194394189528592332 -0.071172160981048185335 -0.44516457947498921932 0.75059060489473650168 -1.4419071352732049096 -0.16965059770136509121 0.47269396879243630316 0.041319239022962681029 0.11732167778970768734 -0.37523263816095875356;0.15950219796929490657 0.21308539894609634935 -0.4608340296966548788 -0.30279444173884528801 0.94774722740660999332 0.014396274131315960412 -0.046419216952623049144 -0.13756281932406611013 -0.24285003333429933114 0.30243926527664988235 -0.74918414344327188825 -0.44648001696495026591 -0.084071954713350924293 0.28035568847907121892 0.68446852402888669342 -0.56399907685801686785 1.2206595418261148023 -0.42778161622525062713 0.5959449097440134846 0.91866865973788369715 -0.030456838750508953562 0.40651745636841546405 0.39537525664372746848 0.1139908360482281835 0.50506345912000261134 -0.21410541956480383385 -0.62665161237422739582 0.60061081145924921643 0.052506488557685124241 -0.53356064387727819565;-0.41182403883076723616 -0.75508112655589332274 0.041445676836623611405 -0.8674173750394493787 0.043448933953856419543 0.022286078252004657557 -0.14973493090889694601 0.43731280967244900992 0.042272269470104838207 0.39927321471246207674 -0.3704649019560503076 -0.46809343977954143146 -0.13152341055855976126 -0.084572311311778017306 0.18752300198743876436 0.05016721210521643548 0.64246856948904995654 -0.49594147246440789534 0.63279280261514703199 0.089062190931673751448 -0.059190098389747147767 0.61495247878190339996 -0.68506173712764617534 0.039334005784849315757 0.13772107175961270653 -0.65916418153413591785 -0.41715377638210293654 0.28957207823278169334 0.18138664512997201839 -0.43520616042720539074;0.17146041132161760068 0.2251526116849297543 -0.02899727182151176641 -0.91446526010376472104 0.014905945608119738899 -0.51299012221950590629 0.27387950873091543302 0.098041056789006764127 0.10858722318568593546 -0.32949142568025557853 -0.40005342826186685024 0.21372816933248414695 -0.12837634069243383794 -0.40166804958155083449 -0.76415436145029791426 -0.2495098260342736296 -0.89882382306011610051 -0.029259107546070702022 -0.079090669745285627212 -0.86984412469101135557 0.12589353625473756471 0.1096004773135891841 -0.45400928249210020793 -0.13699612797817026233 -0.032051458572282837123 0.71877278885243578443 -0.12935627691036188924 0.45384850287728545348 0.40418801162339945687 0.044268853964435583848;-0.28078679543949153219 -0.50233840817362973574 0.30867376348956554466 0.27524040931407295352 0.044982391967831138191 1.4126595666579537802 -0.27994790721472989636 -0.34119512682551167426 0.4089217985960647006 -0.5509504764763883955 0.46854445621825863144 0.70134660569880935554 0.70514739339116405681 0.31632675048121033923 -1.2148219048702528777 -0.43131047176455916681 -0.86565390170958500526 -0.0037928463858487196196 0.28835664717625425491 0.57426085689557104796 0.21386751199585934957 0.44433506505830677735 -0.89419327759657030175 0.11002805707494008047 -1.0347916848955545088 -0.63898181309319435073 -0.89325810045808429205 0.12061417556057336953 0.83945200096523187039 0.2385289958290899015];

% Layer 3
b3 = 1.1760131793140164991;
LW3_2 = [-1.8832906151336918921 -2.4482291380092453537 1.6745136629081331936 1.2013696459826070928 -1.2899931295839999201 -1.4674247342605588607 -0.36662219188747285914 0.70409804531016928486 -1.2639218990225509209 1.7715003542916072377];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
