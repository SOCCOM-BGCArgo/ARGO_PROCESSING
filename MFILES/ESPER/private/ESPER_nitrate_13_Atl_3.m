function [Y,Xf,Af] = ESPER_nitrate_13_Atl_3(X,~,~)
%ESPER_NITRATE_13_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:36.
% 
% [Y] = ESPER_nitrate_13_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.03;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.604229607250755;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.4980694519584769608;-0.066322608551320230696;-1.6899437367666443333;3.3635514749652726252;3.1196626010205479318;2.1329553218023171723;-3.7548270276292279313;1.3578066650274864813;0.47492772981264830268;-3.8142571816079100522;5.2314575703920160876;1.5704225541350969042;-2.0249373137442971959;1.6253529438312570576;2.4262828778417744324;-1.6859625661468016222;-3.0718935266572375831;-0.10305966847439783363;-0.79238732056576011153;1.9022477658518919252;13.078614146094114545;3.4063012888669876865;-4.6582718229222948025;-0.502373200412373766;-1.8475352072172539497];
IW1_1 = [0.3775083453357908625 3.9724424775025788392 0.17550037001856089169 -1.3286641804414698331 5.614333063471944385 5.760099472893358552 -1.8289369357138758332;0.20639683846405640355 -0.12689875971603548077 -1.2272839696928723452 -0.27869270821313513187 2.6366484471049553839 0.53582669962975215672 -1.2086159623894481285;-0.15829939632056980181 -0.49327596631290726581 -0.13833871525456284401 -0.091610927318517360041 1.5206075038449791137 -0.09677293388457183787 -1.9721545265382658396;0.40851988302830494204 2.0999831891169025155 -1.0538845305766395555 -0.65836964337084136201 -6.3438775960253170894 1.061618986068700865 -0.33899208337699610061;-0.16574809248135094486 0.13851108623491667493 0.69663022228309900985 -0.22023270392228525005 -3.5398233195519619443 1.0937030511684151524 0.03327813321457165352;0.24338596204785500898 -0.41947499186285897022 1.1844571480372292349 0.60786164384173602127 -2.9985079666868914572 -0.91764383510688285472 1.5583090501137266681;0.25210300841272648142 0.1126918857124262624 -0.11221763313610928769 0.28168516353056816115 5.2738038520129713049 0.13076675924506564463 -1.1502148313437134952;1.2814313125142882122 1.2591045331746979485 4.5826752472342793254 0.3944219042936218389 -4.9478121174276790128 -2.1727257368971195639 -0.11835512603476715243;0.041374779179245077532 0.10267266970001041881 0.15025772100244211282 0.32463008346866567555 0.48142047805843302122 -0.045690239894228566742 0.074110370303372877232;0.14710993408679062799 -0.099850341155924809966 0.047727713359861978493 -0.60565657314601650807 3.7410560959792329427 -0.54055677707043880975 -0.86946856797463145661;0.22131364920491247705 -0.81301117762335173289 0.72840226503877225639 -0.38603451754903361781 -8.5049721964190965195 -0.25999965020679521865 3.0246833282863945236;-0.17550924937566431128 0.014616224891179198722 0.24288269815316218536 -0.30002915565184345992 -2.7902079699136157487 -0.34579600736698234975 0.41068361771189848541;-0.078075623004136687766 0.02847256171271912023 0.50289755967506444279 0.37516391332814208459 5.2725741133968631047 1.3941340814408618165 -1.7361467751906249912;-0.37169314523679719553 0.33780440162394159698 0.070510199607058413052 -0.2277531905316529659 -0.78174759747162247958 -0.40578871387809184457 0.15836884289123057123;-0.15849550269963874616 0.18714475204043759526 0.14747261615835594029 -0.43014969095218580364 -4.5002705602891319714 -1.0071411104544774062 -1.0562780004724483529;-2.1327088815646857434 0.60462505537125277311 0.18856372182528771675 -2.1456135888588203642 2.2490018432869591791 -0.43005253704842549833 -3.0493657644086051839;0.21382664220338634675 -1.2438316947780976296 -0.75408238266395588578 0.108036077782910786 3.7217409244103212274 1.6852029269360024877 -1.4932812918535489644;0.39640022704500005313 0.66168651959541591179 0.20584435712441651045 -0.31060588809436429081 -3.1153338529667387036 -1.170473793133094631 -0.48379540733548920262;-0.76023848957947781635 0.8750339438850156526 0.17959779753228058419 0.13680385956505647371 2.4978724371794536196 -0.8156271331418476489 -0.78151510767099585664;0.83811323747433852382 1.1311959911352233998 0.45028165672462422409 -0.034159126462905642363 -1.1146989165313754278 1.164644597381049973 -2.3803687505483761555;18.261393161435044874 10.175843512220389186 -12.448121663406732651 -24.894197924416495482 45.675547070635303726 3.0373343090451476733 -0.4855664858739465739;-0.54220540430758867867 0.54302319288077049997 -0.34325538509391462227 0.38603755831634678497 -4.3246688590636415128 -1.1749324661347013699 -0.73303565863041753037;0.70686259259272843369 -0.69986777928243670832 -0.30874715493429599755 -1.695990861994372656 4.7492431789920814822 1.3534687532590850001 -2.4458447214221301635;-0.066303555139483022485 0.081448505083656266845 0.31407244701897946149 0.93837097679565606434 3.7905430112551443678 1.0485662566849596189 -0.80999486401157871907;-0.36126168101156069801 -2.1446250557581714169 -0.69438504968406433715 -1.155214605659006688 -1.4861915897531374764 -0.90508790515890691353 0.83814961259462461562];

% Layer 2
b2 = [-0.43230863323983353963;0.70618877606916385936;1.110185818516065126;12.111027121257398775;27.332769303139262007;7.597135070838215043;-9.3710086372590826187;1.9237195781976266229;-35.291207624519792319;-0.3767416792404831849;36.145781506727622912;-0.76972196100271028651;-10.450034958751754033;7.9298867266888546368;33.592242394918244486];
LW2_1 = [-0.17614689480018472234 1.3515705896418039877 17.62466466084698169 -5.3938595978595555991 -5.4613570783868858882 31.98592558467055369 -28.483864466083073097 -3.4550891670475833983 -20.569215891520972406 13.465995370483344828 -1.1870915301244124862 -21.459503153370835804 -4.6651971798203026864 3.4423868867736340249 -23.012386402834092536 8.2789036712071695234 -12.682315162603194025 31.568854168184845577 -0.6856488042657560289 15.630809506140231235 -1.413720504743426698 3.4449584277073044269 -0.90762892128601124764 -10.989232809412154523 -16.102723888468922553;3.7568392894752711264 -5.2770327814392068433 -11.579086249319683333 4.0589652262119617632 16.453789710297762383 -6.0715161797746768357 -8.1896047484904990199 -19.397547204775186458 -3.698930540732003891 -13.064602626367133098 -10.980172923842374644 -1.5842458935608676462 -5.4785133457268617718 -24.671083146355744731 23.358996699565611976 6.1408528800009065662 -17.509430368117790522 -9.4786138676151825422 35.287960561285814265 -1.438667455946136764 5.7734070402076937967 -13.834598351729159305 -6.6039679326490867695 22.114642814931904979 9.4005176410798103603;-0.080041640436418176607 1.2816587034641115928 0.5454631952393143024 -0.0021999729878870765212 0.15009702290761989252 -1.362626051482491274 4.3117181652335165865 0.027368212476601747052 6.9006890806920146986 -0.0030072944750684270712 0.59132087681605371987 6.7343528129254774939 2.0490665892931034797 2.8969083416466734349 -1.3636773675071489631 -0.037370234203054221445 0.18553935082393910316 -0.40369432220194101379 -1.3496533596633091268 -0.14546935736573360365 -4.0446264341442637047 0.9301056507307178256 -0.21477483086485968378 -4.6953769604132693516 0.04929673374097053723;-6.8582765431370189546 25.802199505743423913 5.9808939748588443308 9.9457684379299546862 1.7326697351790094626 -2.1468559547713694791 7.5171148459572183498 18.734256565455783772 23.049740275384070998 -13.917409585268318395 4.6460416159485804499 -25.656197400623458549 -0.35805717867175290703 -13.547095525438164643 -33.524992020293460371 1.651168705729274544 -11.496974217634116755 -11.993463957363863059 23.041740724495955561 9.6871856813822319054 -22.619793052158847502 -1.9756368066111307247 -4.6516438848329473288 -36.433528180894924731 7.9958587025092677791;-15.717848966611429162 49.477331399166573078 -5.1211709712673210149 8.2317538305335009596 22.964025941787724605 0.65427483392466689871 -1.5054245839090647507 14.108333170154121916 -71.542246863613272012 -22.915060568572659605 -1.2931588384694645555 9.5976608354054793182 20.621754197135530262 -9.0538101628235629903 -33.497407973817992399 17.760679258663852664 -8.1905101571533567295 -2.3224603807409516243 -11.182003894158297541 -9.2826017535186782226 -15.128793511636793312 -21.326268581639915567 7.5062755610182430033 -40.310511151909231842 7.5572314804193956306;7.792178309131278624 14.155509263324743685 12.053809905948060788 4.5265635882020331948 -6.8136257725582263234 5.4736110199176284397 14.638849497694526036 2.7383202770975585416 4.1548943477638529131 -6.2986684892148083748 3.6738403849313647775 16.45404900521263869 9.4836233103048215298 -2.5599456907905246972 -6.4808692036187283136 -1.7935578036137265201 4.8090136843393320731 -2.9085311380804657055 1.8551739847483723622 -8.4696946865563251805 2.1050937155170266202 4.8971884079993612815 -1.2725114835358279919 -16.555541334037126688 -9.2070942542779619089;1.9908460736139379499 2.7147302827331603048 -3.2224262060499890836 -1.4131487100461068707 -1.3308068652633944229 -0.83439057280840744912 -3.9220762293719890756 4.8603336618929535717 -1.2244981229615214957 -1.8711859351343087532 3.0458222653723892037 -14.787499889441471979 -12.183189033366383924 -0.87715419803369032437 8.8042445859986671053 -1.4800458899930344359 2.7210813083383738054 4.9479042467634268831 1.5581699698454622993 -0.59827554384248449182 12.560838843277331023 -0.57712512765456247532 2.0046511666601154467 7.0724775339670937768 -3.1963132002100151929;-16.490860757392841407 -33.911978343425651872 10.127659411291789482 -32.166233217997721283 -6.0463276487456667496 -21.808822370317532346 -34.455086619256491076 -29.914081385291058979 -75.162312459944587317 34.153230409785209076 -19.13444658020241107 -5.0638288474664792105 18.457985565074164214 13.131351015787002368 9.5137434568356074038 -4.7194695448724957032 -16.270075943135772434 2.5425907415821775714 27.416862437374550865 -52.421208354542756069 3.2604622629362651764 -12.667746907695564218 9.0034689701593659805 8.3470399722338388671 -15.45711942321270449;0.7202939029326700382 7.6815977853257875196 2.7525345574983264285 -25.578220632659306233 0.87638750645059049216 1.6674674614637070569 -30.479930158905492732 7.2128619637674198373 -9.852598622064444811 0.16099238766825418878 -12.325071439472258916 -5.002270849689961274 -11.301100346684481934 22.387702479064746086 10.601306198071558384 -0.52454785297448225379 15.96870520767229884 10.038584285884139646 -2.0235315871652317377 -4.8503188672392019143 6.1356926183730395863 -12.774028225444068241 -3.1241150467278457903 15.021917004802814333 -26.402034329893648845;-0.022153517974356131542 0.99988160305814022255 -1.3420657344761208751 0.20329949339972927524 2.0289093704141891727 -0.13912055309834292505 0.93096216736529113778 0.23249510801371905955 -4.491589722807992402 4.110298147054372464 0.27710645814071643844 1.2240413233420601724 -0.4294888745431484911 -2.6599179927875726825 -2.3267237133501663671 0.44477365810851987593 -0.30183570175961071946 -0.98030389861781908056 -2.0870750399160611366 -0.12367684173183149388 1.6493267354234268929 2.8570941694384313081 -0.68819802173358679553 2.1331189627811744103 -0.064010074075314796205;26.848316340525443024 -10.945384306667881091 54.47526838937903193 -2.065356792912652395 -53.401787425852731417 -22.890741447926192365 13.285911222731048298 17.820307008504375545 13.232078787636964989 37.824937507297157424 14.014540203383360151 28.724247193189970773 1.8718826222358531108 11.105032885687252886 -5.660205684719112007 -7.6862095175572742178 38.818465219219525864 -38.510693881470245969 9.4540789986285993507 -0.60011608974881269774 36.778823781987398434 17.257977611769803161 -22.386978839001923092 -40.891993011815500836 -5.6357133461483286396;0.19963395904446432083 -3.0369559516188893156 -1.6218978602675568901 2.341152037508035022 0.97138187068332626506 4.0457065136116883153 4.7652377577060827107 -0.27863292298146585813 -0.96077063182217048443 -7.6931420058660364703 -1.0815502617814789499 0.11898187015798213084 3.1723874690207924942 0.20941280033431564078 9.0579933855586656222 -1.6379821127667035796 3.2607979052347242366 -3.6946446774474277497 3.5903550291463397492 -1.5666226465923098754 4.2668362294238280086 -3.9704082169794472357 -0.34278557930238073848 -10.409938602039067845 -0.19741264992824494873;2.5561713712268856469 -1.4167789283934009159 -1.5341944184822016162 3.1843021573820293746 -5.8977126665454626675 1.5587895164845637641 6.033611280467127358 -0.53084972445877687264 49.840747653418212337 2.3194936997936936862 5.7344842065488901284 -32.067736927997550822 4.1976282543537175584 -21.099997727478267961 30.971852173883487325 0.91530290436705230572 -9.5015522078950702678 -3.232809569162724106 -18.156880975223984365 -13.890496769390543008 -3.1617432736612185451 -0.55373712236831507116 -2.3265748297627153462 6.9320277946579373918 -5.585663281200002217;3.9885975771519053268 5.8898297541966719848 4.7479535549937645911 9.0382293223044971597 20.01339922532284632 5.1245505526940142715 0.41100963801998369185 1.8515092250990912159 -3.028828275018593974 8.594493864436426378 0.49279204312826802026 16.4034659135634584 2.7707323726905133121 7.264244994358612928 -12.16794909554009152 -4.2949638996865848739 10.55266439465656525 0.90438016558412837043 3.9832386979808789285 -7.3840746907953276335 6.2594726144111820787 -3.9062080147493056792 -7.3059428977356812851 -9.7255855458398787761 8.998931297793177464;25.264357063650660251 -20.973235111723525392 -5.9558769182707962386 -13.85518530512593216 -3.782525790068642646 16.112865637376838635 -45.867787964285660962 33.535523940410293164 -10.374605140171889062 -44.726512237153585261 2.164333465158998937 -40.225757683111723395 15.008730643803712468 20.701560822074920765 -61.056483180279983003 17.213513599761220974 1.8653979785184731099 38.791203631230118276 -14.058790818647560528 10.559495639620777752 -14.117467307647086017 3.2796363157378163322 54.089460315098499166 -21.188019556161169277 1.6910962846040522578];

% Layer 3
b3 = 0.12197943582199603785;
LW3_2 = [-0.017490623504975790631 0.0091346022734238377372 -0.56899994965142486336 -0.0093835035881080428033 0.0059237397139488990466 -0.013391253052920644093 0.012153647164932545113 -0.001465297333676935862 0.012256668675154328355 0.61192877283852098458 -0.0062600499678486512187 0.045075480053676175718 -0.0131894564410364179 0.0032428552612552325081 0.0031231190312734874275];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
