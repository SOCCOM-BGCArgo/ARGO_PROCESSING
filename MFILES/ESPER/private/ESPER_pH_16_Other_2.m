function [Y,Xf,Af] = ESPER_pH_16_Other_2(X,~,~)
%ESPER_PH_16_OTHER_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:25.
% 
% [Y] = ESPER_pH_16_Other_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715];
x1_step1.gain = [1.0000770825255;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.2442670502291379719;14.378633994876045321;-3.1185928044705697459;3.1121522619220511885;-1.2019797675909769108;-2.612307800236821187;-0.32539181102294606474;-0.065677355295235245736;1.3950263704776975082;1.9299663925289367583;0.2795869851923934446;0.27559971379351305698;-4.4834994739800908548;1.2422899618140730293;0.3764028890731722643;-2.6832106850206329796;10.302301737445844765;-3.1930157954595470571;1.0249579339698351443;4.7939813752664788282];
IW1_1 = [0.77113685129575204602 2.5342495778711944254 -1.1849558657536838346 -0.7305051691350084031 -4.1093852837896598373;0.10967023970477797479 0.0060108016505247699804 7.1587129274955279001 15.003932396049115994 -3.4476425620986876908;1.7308855937743232722 0.93155503810007878052 3.0387708109480748853 0.32474924408563193845 4.6560242725582670076;-2.182530609965374957 -0.19998857077270468241 -3.0067625863412499321 2.288774505661596681 -0.39257133229295321231;1.0807784720306834458 1.1352984679641673349 0.26233931945219590709 -0.032558976758799963724 -0.43724942161057422929;1.6407970750004463589 -3.1161149259725813288 3.2629855458650540712 -0.010214492604478058249 3.4081862235703788144;0.8772481725906703387 0.75172096530382503943 -0.25602632770851030397 -0.85877313396007115553 -2.1881036051648101726;1.1220088452086411923 -0.64997446241286493951 -1.9668046877608358347 0.6175410215058440011 1.7625387115321931031;-1.1945489165882710036 0.063119022256631115986 -4.705207790912840693 1.4917108278311610459 0.75683651340175250866;-0.29005797640596014952 1.0071821706479342495 0.20104299532020747376 2.6196594150224119524 1.3839446182361980764;-0.22481388602774901586 -0.094937687158951344912 0.56610976662427670014 1.1729186071344079867 0.028095229787387092368;-1.1404201938819256146 -1.4538570181834571393 -2.8800380893069275068 0.66266148498045707171 -2.3731667548001627033;-3.3806835508910979549 2.1364985861636780484 3.6227091745088184638 1.9586590734779605327 -3.4818743482111864651;0.24389510121027282996 -1.1935759944629260598 -1.877441256595527852 -0.12701954808278737019 -1.9228059955464646968;1.2293269624550087205 0.82926356543720070036 -2.4523188983318631173 0.23287649117918271524 0.50231817237865106218;-0.518289989665853712 -0.65211290222454876275 -1.2516235521257284002 -2.3294349459055547769 -3.7736665907583470947;1.8071331910701204926 -1.8539793962330721744 1.8495599452884678993 10.542805167044624781 -5.9118385572618459278;-0.51333249790757051745 -0.67003666575199050115 1.9965414901163140993 -4.2591333405565237058 -1.0585117900557619031;0.4197472776251502391 -0.31322094109910414428 0.73618258394254620924 -1.1572051051422198586 -6.5407032175383807981;4.0000252145119894465 -2.0338527391398728561 -2.0391915975528736027 -1.3079214144517508078 4.2668760304030426411];

% Layer 2
b2 = [1.0997813291131588453;-10.57317817586163855;-4.0959989030372572216;5.1707661251471872532;10.660236827417906014;-10.720043708958948869;3.9444478469172139512;-0.1448016142943689688;4.5297439480134320533;-8.191079205134226271;0.91125604995514519757;10.426295457300204461;8.0756573868345871148;-6.520432886669047079;3.7822902205072628234;4.5612458538794067309;-2.8555490669938694559;1.3811842079353251478;7.9318381091455290033;6.6289049297513882308];
LW2_1 = [-0.43489882663148637931 0.51089052276195878743 -1.6315533277098099862 -0.052398279789452509303 3.3029902610493286907 -0.75508445069964735819 -1.4860539465066973097 0.41512811141386457559 -1.1237751942742182365 0.17903455481076796518 -0.20119994830679233111 0.95270680350912395618 0.72994636582913496881 -0.93564629079917915888 -0.98594656216778497893 1.8456630982219974779 0.1866840339315085362 0.08761209003478778734 -0.55384073457930449447 1.201801125243183499;1.6791960380153105881 -0.47300278708043186349 -5.1192739527187614001 -0.60598942364948438222 -1.7322504878062681133 -2.1781196465517758121 -0.45781643109503000755 4.0921159277011094346 -4.836792859413987955 -2.2347132010437631422 -8.1962949677339729249 -1.0291283865808347198 -7.2280036472695883276 -0.69407381983725602304 -3.4372120601819355912 0.61234863093250335719 -1.7909777571814271546 -2.2705511830882962876 -2.2327817330284451813 -5.9650447141197018297;-0.55062954189926593962 -1.6555803983449766115 -0.75238597586463140665 1.3191070083908957855 -1.3834952145313557104 -1.136579722013945748 1.2444020520831466925 -0.017449639020161139547 -2.1188142050317466669 0.18466988388316457614 -3.498507565934175112 -1.8067961611031582159 -1.2677226901704063966 1.7156674652958567862 -1.4972760720825193381 1.6239034282966362532 0.10581291042006374381 0.12430112506003532236 0.32767923402597526339 -2.2329746287912795033;-1.0063328857988225185 2.635806792841508539 2.0261161390191344545 -0.080110487453758788545 -0.22872571674236452655 0.16048395670853732309 -1.3920171885237608844 0.28945444803632974784 1.8775436837013710356 -0.88423515848686196072 -0.52373352324065536312 1.3433681243570341213 -0.12604836067668745425 -0.99530580390930056822 2.2354127316313645579 1.3347555588087915979 -0.094034192892488210891 0.22924736064703674088 -0.55409095443563149974 0.062617221001602732522;-1.6193082415196806689 0.47036436258177444225 5.1719215036388206386 0.60185319570282758139 1.7287820146099572849 2.1878798510931889432 0.48996801311800708412 -4.1440257631880195177 4.903220365034746564 2.2299056525587803712 8.3955406426809204845 1.0367018194913655282 7.0798499909513701311 0.69386823511374817741 3.4852025779363251523 -0.6246530639497681614 1.8162384389310737287 2.2906545560099549341 2.248162567380883381 5.8002345942561941428;-1.2205114820293443412 -1.3937582987007182123 -1.8764673395016897572 1.4750846585739274541 2.7534829822603894556 -2.4052737851814853798 -1.5105715031917956725 1.6786445327247920822 -4.1637672188041330301 0.67076280218006312239 -15.181114663105931939 0.34995514734732086071 -7.866802924318916368 -0.94669418497954138658 -3.6878409166942147657 0.15064353594539092729 -0.75392153055623345459 2.1920241082549787315 -0.44216071962569630793 -8.4332468389263119946;-1.8337474746421387195 0.36568915464593276798 0.18751715662982165744 0.15036129761510802494 1.2277003788275966389 -0.70865307551180467538 -0.69688622465247052062 0.051213663821862799586 0.11224931655913830686 0.24114732458692805794 0.41845539632951794795 -0.030508239643129042573 -0.75392785704314901896 -1.3493637627959960135 0.65735931471354858147 1.0988255741407511046 0.088576762443851389528 -0.2209493387510216289 0.066199338400009841155 -0.6944045908222731267;0.88124609597413716688 -0.046923231474667502494 0.77722300012807365999 -0.32960257745385607153 -2.1550115573572288241 0.80647692674340909491 1.6242106668929214841 0.74286053234086746322 0.54701308590459851722 -1.0407336267670734831 0.95124823614067399724 -0.52949044520430998961 -0.99479046028916040534 0.11285707444480670703 -0.10133418751904485489 -0.45020372906434064086 0.069248071902760666152 -0.090074323028699401772 -0.2265285454994669101 -0.69628697119767402057;-1.1796177831421288396 -0.25207476973235487527 -2.3082182543254781137 -1.6225920795858803647 4.4698801277363848783 -0.37303148551493203744 -2.9183233254270710688 -0.58541854994243514021 -0.36765678390634431993 0.6331611071744357444 -1.034029695747406441 2.1821541062370504171 -4.697585413409758992 -2.2568528767078608332 1.0696947336048279187 1.2400331933829864539 -0.27189798959129513056 -0.14259429317924038338 0.81220759081726567885 -5.4660537870796384041;3.3350644336094488196 3.4890986448944301124 3.7979393647339971807 1.1142410480223257085 -16.017504903069191613 -0.40471149750495211128 3.8893555722179145029 2.916436277377952635 0.94962545283549126829 10.071251088667956708 5.1462136471251058722 -9.5065197721166025957 -0.90857419637662495404 16.608381504381938498 4.736896843748055197 0.59656291074855238854 -1.7773547988442923717 1.8351037476842815277 -1.0160061268562152748 -0.75584759250143473963;-2.6654208824375289488 -0.12326881876346906797 -0.65577135903909533621 -0.37054829262380217791 1.8686574992539937146 -1.1203068431957807771 -3.4553118818819017477 -2.9787576027036930526 0.75274021497099974365 0.15706433120448146101 -1.7845971076766424801 -1.4332219306336124731 -2.4496115881299114214 -1.0438462238933399195 2.214110772529243043 -1.2864399557261638751 0.2840083743640483549 -0.44407757346632842355 0.65714978834853443601 -3.3459008428713095107;1.1051371243749312789 1.4052079511911981236 1.8941457628620261833 -1.4268676834333140491 -2.6524752608377477614 2.2153102917089242396 1.4263924155575831154 -1.6611735771531352945 4.1209199952244182086 -0.75750216664690450674 14.583677220056134871 -0.34710101299008178088 7.474636975735242217 0.8584352278894363808 3.5334965446828547897 -0.2093994917334124628 0.75645127937119860384 -2.2864717785474755196 0.46335511294052328379 7.9906165937054964843;-7.9487345046697512885 1.4523587216303368574 -4.78860211198131136 0.88385830023072275985 8.3970416569654542371 -2.4121227666361253483 -3.4809080223364885498 -0.10649973763027051343 2.789709226833138711 3.5116960339919920386 7.3739947206963574189 8.567963254884030988 0.78050855337646218857 -5.6195561727512126637 6.4066404312931055642 -4.2654028348892492062 1.0822228356492729073 3.3812912353288862022 1.3478395983583013606 0.85425279883158344862;0.4008621415111203734 -0.44032985168083427219 1.173526081970224233 3.4318769187600879356 0.2470464959651305914 -1.1718488944797185169 0.22292674219099503641 0.22687268161517631926 -2.0985777748320337821 -0.088682956618924613235 -8.2199699920105206985 -0.67548839695209750289 -0.032899635348895395204 1.5608626329741719374 -1.6071874326709523206 0.2284636817198912595 -0.093058621712980210683 -1.4911208553520689524 0.20361910309580968925 -0.72059997366494954463;-2.8118221011099322482 2.2936000792900612666 0.96192840780872457263 -4.4855357537058964112 -13.622464286258145094 -3.2540544495634717848 -0.8917393761356418036 -7.4455333578093387814 1.0458752446050074703 0.090302541474296268986 -6.0604925440213035515 2.1532206302200176395 6.5437890485085432601 1.7021438939799762302 4.5011283045184695695 5.8607659371071951782 1.8262335337637713994 -7.8646578266397160206 -3.0288593953800075909 7.716661596115675259;-1.4303084091060636052 0.19910058278280567956 0.45021741459338066038 1.23287966849817332 0.48607442050833810088 -0.73151480432410886934 0.14647662235659655861 0.51545681841560953007 -0.58531459664188578707 0.32692743649339167655 0.8997928985818317571 -0.28414415236825890654 1.0755630660485417938 -0.20878023593710742789 0.1098591400479666802 0.91854033130377377159 0.036402743763073307226 -0.038071749230701050493 -0.080735445826872337394 -0.67968401646239862135;2.2890533914518136349 0.19075502580194306224 -1.1457585933415630475 -0.34809095437071058132 -1.7233178811416842713 0.68716308558525440731 2.3159771256115533333 2.9708745592022691717 -2.1557742863613187367 0.10947859449684606281 0.7971702140235600309 0.81903531683358121729 1.0740754025575669495 1.2021480676183344816 -2.4925652416450287951 0.20060514386325947744 -0.13926615480578019568 0.070205590396988801216 -1.7027305051059278274 1.400370526283964745;0.15577492932035191808 0.20551239275675917129 -0.9276554489261105152 -0.90167323565458179502 1.3730802647268292027 0.21587884968414297604 -0.41130114859458155596 0.75752141393446725814 -0.3360536274710230753 -0.61961197907579979027 0.47999782589878486894 0.7991281826189978732 -2.6317397047390467257 -1.093132882585117871 -0.3089333115146812303 0.71908266420827571253 0.13496326095944979895 0.12370543231911297621 -0.44124042118901724008 -2.5509945756766470026;0.48170296050318733849 1.2856569185980246672 2.7501883783895979541 -5.3264688919947227319 -4.0770299839453087998 0.46761256724088001713 2.5512659708923575153 0.41570400338537211171 0.20174622310444306761 -0.65388258093967155382 0.72834752736388574945 -1.8754324663600441259 5.3995918547517884889 1.9590169775001515795 -1.977172550995423439 0.89738747700036380905 -0.49347830352095944928 -3.6191214058831207012 -1.1830576159548225057 6.1526968638245245202;-0.38226936999251420746 0.45462756120902592105 -1.1372007093220990459 -3.4468340159808921186 -0.23637392327800660352 1.2125173865442542276 -0.21706354723239626447 -0.22240511726329961761 2.1880844116249460463 0.11733487347369800369 8.3101289636362185576 0.69085621355445947511 0.35536777187214235729 -1.5509960384472611938 1.623158554262836839 -0.16152587491377190521 0.088902341797360784348 1.5876561988853028495 -0.19552085653541786958 1.0709717476055857777];

% Layer 3
b3 = -0.54810862650873515278;
LW3_2 = [0.31817877905897778978 8.1319348757864453603 0.3180008479626562079 0.19597156006851015886 8.0067113977006698633 -5.6684108146244893689 0.80574029434626937007 0.59386135985191224052 0.1956475641865801085 -0.13759003006967568394 0.28405334913975166522 -5.9011520491167415159 0.058623800285794364084 6.2286865908361503941 0.22543145931433225537 -0.97048377053865131359 0.31795450106161493586 -0.6740393022094021136 0.60741326242822324399 6.1836139864388961485];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 1.90239167587468;
y1_step1.xoffset = 7.36300175998845;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
