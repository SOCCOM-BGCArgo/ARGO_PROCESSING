function [Y,Xf,Af] = ESPER_talk_2_Other_4(X,~,~)
%ESPER_TALK_2_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:44.
% 
% [Y] = ESPER_talk_2_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751;-0.9;-0.1386];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0584431850247228;0.0422119037568594;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.1476927923382605;1.3191258447525644;-2.4967799123871015;-5.6629209070918769;1.7080246827353118;0.1803442394132834;0.91025813837142899;-2.4480214183213764;0.50525977813979472;-0.75819854089708993;0.31502304111199042;1.5370892048153006;-0.11438844935853942;-0.72423480399829343;-1.2108924494571762;-0.55092855571471888;-2.9103575440355733;-0.58393382404659655;0.57438910665639553;-1.0787172930014366;-0.24988173510583861;1.00734491161051;-0.37302123788974978;-0.77403350971367957;-2.5035414583919122;-1.2549791884445454;-0.2675370143682928;-0.81122872096676146;-1.7724210117779624;2.2311906374462005];
IW1_1 = [-4.2800255883538245 -1.5000412462372099 -3.3563230257549597 1.1933200819736909 -4.0717846192820266 4.8991363863687747 1.6441888216553395 0.82892573530752867;-1.0093889941801908 -0.016318261530049831 2.354222608586535 -1.0832018122863107 -2.1681317276252887 -2.0869264728763564 -1.6551820792556566 -1.0570558651321873;0.55965717238235091 0.29363133375498829 0.052342979965341485 -0.58446571810797365 1.1108524095362005 0.90603974998962455 0.17281269085528286 -1.5892403732201765;2.3828750607025353 4.7484623899458169 2.2626056864795601 -0.25839592966355324 -2.1637047113648999 0.050470496086672444 0.065403145759592038 1.4455656140487971;-0.55091067059483623 -0.14134010238896838 -0.11823650223729583 0.5070993130353999 0.49768025905964752 0.78626466903539616 0.45445404983203463 1.0504650383778475;2.25550755008235 -1.1094076142475238 0.51415543101517003 -0.14064300135037219 0.56068549725076022 0.056109228023860369 -0.89082459467310027 1.7212339494995537;2.6260321234867048 -0.95846029970406688 1.4702179800288455 -0.30414962080295072 -0.34533987296387969 1.1202317896360414 -0.59638963023615621 1.0488716723186606;1.0886258759841765 0.2476051614226088 0.78348104039257049 -1.1144108009238334 -0.62269521982144316 0.84292876640805758 -0.078897071871582347 -1.7638055976123812;2.7345886142199718 -1.0112160288203424 -1.6598949633083255 0.1985961411138798 -2.2916256693431367 0.93680516942595637 -1.4080418172970375 1.7138720482534049;0.46526578051283946 0.61688140175528461 -0.010871487819010674 0.85340451711053811 0.18674050957771085 -1.7073421321826989 -0.23765796342646203 -0.82764330935068742;0.10967999208134789 2.6783089095532748 1.0550516057528208 0.63477545432727833 -1.2260052527133418 0.56174523031637913 0.045533898026221438 -0.48753256461035233;0.52157492535721239 1.4649822009376663 0.21744116013735429 0.9714703165085693 -3.4843072878636892 0.48730346448847167 0.182874531679657 -0.056858076711564898;2.0777678313049739 -0.27980006864709001 0.40393802660530365 -0.52435558266794802 -2.23950294478565 -1.6370764939346703 -0.47589098464663943 -1.4483585987660041;-0.017793946118065812 -0.0089126592993088762 0.58215107131526223 -0.36195715401308842 0.58906461395741205 -1.3250899267474665 -1.1187897298339966 -0.1365497720350656;0.61968690456355591 -0.39155752941340777 -1.3302632749438459 0.8108816830076131 -0.65863362592766694 -0.80722095217866752 -0.32174919406298241 -0.72076531090302942;-0.23712763900612904 0.41434545999137606 -0.34440547735866273 0.1899260134709907 0.9377113585247806 -0.48480508051710341 0.10059255594853939 0.090417527355619101;0.24601873482107284 -0.32402828206908152 -1.6204358401911587 -0.61759730150928738 0.11336251973934877 -4.8196019075469998 -4.143773788406266 -0.94449190809379935;0.40900156706278368 0.11528885216773238 1.3838975889014384 0.29848615662414835 -1.1801268793028694 -1.1818382593291901 -0.2057212230119822 -0.12640709965790287;0.32856741470494227 -0.29335949107468651 0.9647103438188589 -0.24267439979547745 -0.42642950710063865 1.2471305903786249 0.28134754988575722 0.28759443204321861;1.366657898319303 0.9501789543777841 -1.8056518381473321 -0.58896714380278403 0.010290844933638729 -2.2369055625066894 0.21857557222070723 0.079376253330649141;-0.088782169357478541 -0.070369728136675108 0.3798247631053237 -0.053205205939271735 1.789752835228775 0.78050942173553617 -0.11101414169481384 -0.95715077515843072;0.070225389018844439 -0.054886929270326942 -0.10455411706708322 -0.038100534275124644 1.8158747038570533 0.12987424535847975 -0.10337023510102496 -0.24239878193926676;-0.15158133940268181 0.087861299735198559 -0.81644421413745683 -0.064390280348374615 -0.43881194374097371 -0.58341332232196141 -0.2408777580723325 -0.12811152727154276;0.057333805959679955 0.47165620396988334 -0.6599966866530067 -0.86848057981477789 -1.0310465170510277 0.19953886058351394 0.67056190300837026 1.0402234587287964;0.43256023392107112 0.060908993959588861 3.0207548460349516 0.54755518932969094 1.7084977885287298 0.44682798485537867 1.8632760224820921 -0.77831213542271194;-0.34602599543157503 -1.2798340424940386 -0.68979055066529715 0.39918540718128631 0.049619185344636441 -0.02355475298595457 -0.8503140014480044 -0.40686061876275292;-0.19604008654469673 1.9714146503006893 -1.0233409719066253 -0.42385734279427867 -3.1536208843064997 -0.22365359256408476 -2.2874842214486715 1.89998879636187;-0.35888785932921391 0.13367469288110792 -1.7693733221265595 0.31232594006196679 0.41532067649004506 1.0548059008654074 0.50003433988352741 -0.36894557427213842;0.16095156569944194 0.11504064525159508 1.1702942571125485 -0.28121601938731072 -1.0669755030719663 0.60103725712943812 0.084607404632218788 -1.5687330285994459;1.989847560009411 2.7769042498129028 1.1672050963845277 0.13989914339381765 1.5054653517428789 0.88561040541529312 0.017963204552627555 -0.46726366713088152];

% Layer 2
b2 = [0.74456032013819129;-3.4057371684911479;-3.578434154200655;-1.9029637755446427;-1.9716596961474702;4.6667415999178594;-2.927923388901617;3.4693648445695779;-1.1711361925171948;-2.6024568325506037];
LW2_1 = [-0.092622961499836148 0.033511854091698809 -1.0252325897573229 -2.0427690672458816 -1.9218790900703615 -1.4866547304557269 1.2258401050026031 -2.9209791358694384 -0.28116972903948395 -0.92040029504325482 -0.75559565822281338 0.33093935145578446 0.15173437185003336 0.53176894663587038 -0.35113506155425356 -2.7559683715660466 -0.30179731156058875 -2.8820039416768894 -3.5407497481461943 0.148976764886423 -0.12199252946533698 -6.4928792407045028 -4.9449573786737293 0.89396260170062647 0.30001497685585987 0.30005636356904197 0.53970625757779678 1.7662782632486842 2.0724276205518151 0.57966979937570928;0.65771614115014976 0.86831444404663893 2.4863015974447777 -2.4821233306709725 0.69252244297898236 -0.26534224572780929 0.38896874644104196 -1.0820094898051189 0.36183506427520562 0.56685648843291769 -0.97027163930714999 -0.1583768221092714 0.32126739519267727 0.40434070876259376 1.686620927778556 0.1837439179582267 -0.22314487840681338 -2.2014273066605763 -1.6867392044199103 -1.1601792681345842 -0.18245233650083451 -0.76494746842833183 -2.9469264351490958 0.15615382755463639 0.86297884226405752 -0.9839340663161702 -0.23554297609335775 0.99080618718204105 0.028776390062217501 -0.97481656589627708;-1.9874936143673527 -0.64824463991662318 0.69005425324277181 0.72804536814324783 -0.63846224818924679 0.78472186968519375 0.013089763995812555 0.24066939439310328 -0.87180721838764252 2.0265728517596933 -0.34685622727267212 -0.22678428460856498 -0.6757579574755912 0.43413131480158762 0.65660213848420568 -3.1278835037200565 0.43487497275927717 0.071543894446726305 0.77964905352066549 -1.2115365067326951 0.082320381673500365 3.7615561015674954 -1.4611432486437792 1.4730285530578837 -2.088445731621102 -0.19117318070580103 -0.52262982434645555 0.6273551747978926 -1.7417057129371463 -2.5199437922340504;-0.033766142117540629 0.10190493887936505 -1.7500228709641501 0.41480201213049928 -1.4000759650097612 -0.16244886313486684 0.10280882346314689 0.76244588413214731 0.20988575230221479 -0.81563928518080309 0.16538550150471598 -0.31182585028629684 0.22454598830009229 0.24649906647295416 -0.7710764165726588 -0.39133093725334528 -0.22094577970895579 -0.235509689073546 -2.9691009823459735 0.26346518889048476 -1.4549584185676006 1.935586213520607 -4.4557863163756037 -0.50114733476733164 0.12641965568915833 0.21155552965026692 0.21840650686127619 1.5898702416839727 0.37286787804938881 0.15054313798989402;0.60582795993592276 -0.58489581457172146 0.29158698362101965 1.3177428482907636 0.38447945046940152 -0.55399288535534819 -0.10424708546372753 0.74021540951134424 -1.5787954909558635 -1.7967765107430522 0.47528645370248934 0.51174627533214345 1.0655483219551916 1.5609002787035464 -0.044824917806936725 1.3833280072212826 0.13746078277934631 1.2610805447613802 -0.51955845327169903 0.68568868412249184 -0.43125720639662629 3.380028926473297 -0.87236740619321895 -0.10171584288563464 -0.14310916337128773 -0.26647417532306483 0.55484242887803836 -0.066391276637637053 -1.8222437802635176 1.9740088569412018;-0.01847979131376128 0.72829114589602328 -0.28983891784532723 0.006351045548010241 -0.14449645046494003 -0.14703024778222132 0.35317384732225277 -0.56139352357338435 -0.27152713057228867 0.17152819625755944 0.0035109495328092604 -0.12553435273951485 0.18861768329663195 0.090965367593161234 0.41829027999814233 -0.78783680216435825 0.016161108612947752 0.5500149861675997 -0.42353890158672236 -0.12533716092275163 1.1249112968292647 -5.2063162058641774 -1.0297522125197431 0.92394444049196278 -0.54831675238963551 -0.31338627894878462 0.096584104884353469 1.1321306466051941 0.45296591006060899 -0.24593436484172657;-0.11985328598674486 0.48125507973990811 -0.20363425442226141 0.61002723372976975 2.6303401517331717 0.1449416372808992 0.060568315779992117 -0.36947916744255976 -0.40250179417806659 0.70413788313724668 -0.44938828213482473 0.73827024037688727 -0.097086709377932248 0.94577936129357809 1.3889461738161484 -1.9498320148008821 0.29216193717687272 -0.42724864028178461 1.1421597156797438 -0.077434954769137115 0.58609573883439048 0.8515486704976889 -0.33005249223774918 0.9450245568877903 -0.26859234252696079 -0.86070182135025886 0.12008329696337898 0.23477003968547072 -0.99259527405327785 0.098986304900988212;0.059642372854670549 0.77281225737373493 2.0729752970873783 -1.0517503963180983 0.5251485928865427 -0.28837858628123225 0.61283116328509013 -1.9729811503269681 -0.65566965197971949 0.8267208559657554 -0.10915028221110133 -0.032541307936852386 0.050808410658661284 0.29621057663426342 1.1900347009588017 0.59128196558126223 0.1499912704911566 0.55521792866786035 2.1179568818699641 -0.51886555909686072 2.0935808644791747 -4.5128066045243598 1.7671342351752535 1.7196463809634428 -0.62113505915740252 -0.048990252539078086 -0.19284358814750796 -0.11486681309527957 -0.33232130919606762 -0.52016307479903134;0.021027420430010508 0.49309202233355109 -1.6997185628777913 -0.46516886366429616 -0.171232545962515 -2.0186883065348167 1.3300535059092695 0.52458123617600794 1.1245734821823179 -0.66649492450424619 1.4858796161789882 -2.1942896754965675 1.0036780975453177 -0.029376237076671724 -0.55782754481220542 2.5616438384558817 -0.1534517166494328 1.2680065212704454 -2.0121860476468374 0.34366475800003271 -0.87792221058804454 -0.60236817564216361 -2.860805098582536 -0.78701927003326588 0.061861607579508669 0.89391506810314736 0.37535046867205168 0.60977973128187513 1.1383540500598399 -0.58585944958133962;-0.5622873618161901 -1.539576667891251 1.0216649473181016 -1.1369261788392933 -2.685141922118341 0.04443154536947088 0.76671078817456984 -2.7233805625789906 -1.0826319524026984 -5.8512666952652559 -0.50292076008999997 -1.0118816800977324 0.34924717914618059 0.80112996342935694 1.4992668321508618 2.2303994243252432 -0.055401084944049106 -0.50851961532360046 -0.10998161761720454 -0.67527614395547475 -0.24829739791532437 -0.71380296131588461 -2.6345462467596557 -0.25660775950048303 0.12495691757944621 -0.080561085080358419 0.6496163787951249 1.8725033816064829 2.6459064158096464 -0.92418329966319956];

% Layer 3
b3 = 0.66691042400884526;
LW3_2 = [-0.078060258362952301 0.098541772582423859 0.05468164155184458 0.64603304185548227 0.070512550170984387 -0.45897680961372078 0.15446067167256994 0.26141014539312207 -0.25455265370378127 0.26789820937094427];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
