function [Y,Xf,Af] = ESPER_tco2_16_Atl_2(X,~,~)
%ESPER_TCO2_16_ATL_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:04:00.
% 
% [Y] = ESPER_tco2_16_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.3644739260566308;-3.6470797227559371;-2.1082725308460066;1.5715411646980102;-3.4982797077278671;-2.1800076295693653;6.113377045537856;6.145070418365834;0.57428086120469546;2.8400568577677996;1.3222836190016953;-1.8392901585482688;2.8543870063145684;0.06974692019912318;-0.33877568927547252;-0.18023143231132885;-3.4888968657134929;-6.0940693617881143;7.5290661979505531;-21.881970782838152];
IW1_1 = [4.2997929708284861 -0.96798900538514221 2.5980122364962228 0.63000348402149287 -1.1181256428099409;3.2004175635996717 -2.6300910077330824 -1.5149467925931623 1.6470123763487792 -1.9942353877736445;1.1668108977628731 -2.0456644281196534 0.96269448249201073 0.89503837152287358 1.1501678110597344;-0.25390389983474904 0.050856916050972693 5.1484407986851064 -0.024508175191424265 -0.28024443016549466;1.9462550285792393 1.5639125202165374 -0.63699390764693298 0.043169301299671038 2.8195766556459523;3.2471396065286657 -2.4782864545474728 -2.1248976860815576 -0.6832859766870848 1.2250720376934014;-1.1222634969267666 2.4433992609726847 5.2778555565785634 -0.46151292097464552 -2.6651306933817582;-1.9504843990302339 2.7709323786167395 1.2177859517296814 0.83546744867821154 -4.0407831268096785;0.87795625153684864 0.73261474803415294 1.8653262554719756 -0.43988305087184326 0.75261755000836716;6.0236246153119302 -1.7197610075307075 5.2434674437634037 -0.22449342484905163 -0.52793137889108765;0.81505924452630985 0.55116686684386773 1.1997444452759956 -0.61395753859990754 -1.2203288628573696;2.7116344593615378 -0.76812426547852752 -0.46346661399182892 0.67890160925863974 -1.1911947450739853;2.967019448086671 1.2661743029476693 2.8037811031452202 -2.6373809890318216 5.2191317506556762;-1.2744138703328114 -2.7639616829016673 -2.5744736619483217 0.15910540802173043 1.9085614095206382;2.5299340664948247 -0.78545780249253505 -1.9653181843357457 0.63589542234127572 -5.9175862679408811;1.2906521087889011 -1.3555446220229177 1.5483788890277084 0.092405497652099253 2.3068235419009735;-0.17914295393824439 1.3055534705174763 -0.18218917713685145 -0.14316019402225896 7.0410428834814454;1.1184034280364559 4.9643230387612398 -1.3307485383927045 -1.339819897038629 1.9052362149192696;6.9212633482898589 2.4484150207284467 0.090599850009988853 0.19401237617414446 0.31525627824700136;-0.11076505014070293 -0.65982943457678633 -0.00032088474278247747 -22.805586200370172 -1.8033101414092281];

% Layer 2
b2 = [-1.9855196320448882;-3.3849824978763667;1.1405169605201984;4.0965104351651025;0.39991817507272837;2.054400180887558;3.0456299820395136;-1.5151457399582673;0.69953098755910725;2.0336357580209614;-1.2983584634662637;1.6925872849119428;-0.2365494864870403;-1.4526028419070331;-0.24854542747855632;1.5938877057087739;2.6965876070056112;0.63430980587176233;0.61565427805889972;2.8040327695961178];
LW2_1 = [2.9032425852221544 1.2910344547470722 -1.6960166542893618 1.1296699227646751 1.6541836827632943 1.3498480018904939 -1.6092971645716236 -0.94949525601620788 3.1543533217191033 -1.0554453579389547 -0.56789685585967842 -2.9374231657148053 -0.69943509949380722 0.77012896713978907 -2.2364146161745913 0.32979479727850269 -0.62657564806197419 0.23568952482567226 -3.298923059673871 0.60230057561683403;-0.48268983857767134 1.2766554620793666 1.2276500098065282 -3.4187008728683366 -2.8364892711112235 -2.399404081287587 3.5742598443924467 0.93386698902262966 -2.6594513329734721 0.78298686387574146 2.6249470611900376 -1.342095457028696 -1.7975293735968816 2.8773581143145597 2.2900444773767612 2.7359570092984993 -0.69700936454787776 3.8446591440509139 1.6737678130735389 -1.23241682816507;0.51481077558903943 1.1459143177982007 -2.8333213315969665 0.087255857747651905 -1.599479187020751 -1.0095717125833596 0.49524144029467548 0.37640908174075088 5.3761224421416411 -0.57526953555368732 -5.3606331304302559 -1.4700774032075192 -1.7524723462328533 1.5289456072544818 0.053330471564402022 0.14460560313398063 0.54441802649340487 -0.68945380569721282 0.35465957039920709 0.046875532090420904;-4.6363486972570005 -2.8479970913311075 1.8515395301174331 -4.1293812443595295 4.9671682729175091 2.0232427403554931 1.4547715413442062 1.4912964458703621 -2.1274091645789377 -0.18050021592077287 -2.2229110284565792 6.504876078463572 3.9848437611913452 -1.8550428887189085 -0.82890645202810709 9.2825846464827322 4.4376445135124953 5.705119379473266 -0.76629596540121325 0.31461123229819971;-1.1112126174372119 1.7992983065144945 3.4682711811758553 0.47036685446818438 1.8383211274769706 7.5214476718843013 -0.31977884463100015 3.0535215087182124 -0.042417233211023489 -3.6050171144631311 -1.3986048068373687 1.0785660779981108 0.85528329097904143 -6.2525775520024132 -3.1776347012920376 2.6316311876536438 0.83068383423892789 -0.61668142663352021 0.61041398386454349 0.38785834799674312;-3.6754879872181978 -2.1239187976878693 2.255087751992578 0.2385455799331539 0.46137689428764833 -2.8448738540572771 1.1772184047692023 0.75867969586942241 -4.9124986266990316 1.7451967289975643 3.9635454319906955 1.8197775977981678 1.2238298142197892 -1.8722334494864821 -0.33142840093260084 -1.9659058418850197 0.58135826439583538 3.1150763983781458 2.2398647376109713 -0.69370757774168545;-2.5754754206301373 3.7622414996177622 3.078633835882377 -0.35266636378185451 1.6303265642706593 0.36293042103733203 -0.64735025398697066 1.3475919298165822 0.43725251544849641 -0.83918052733463622 -2.2095297936112455 3.1650303156450748 3.8925754002034196 -2.0289895849673756 -5.5281636918633739 -5.2364690732865657 -2.3651254451709414 -5.3584182841483834 -3.3885711129085125 -0.35328932707476096;-0.054147074893522093 -0.76423760952272557 -1.015928821362641 -0.63634847639926895 -0.89353358849286346 1.5028059341542814 0.82645629176590074 1.2181326714216747 -2.4921117001244411 0.79346317877411476 3.5209544352297715 -1.1543245433583369 -0.81528432522333338 -0.24418707652998664 1.9037525149765124 3.8824565334474919 -1.4673227930583077 0.43640759944413487 -4.1161843206793787 -3.9028095726991952;0.85095621562071888 -1.9930955978383995 2.8751699553009695 -4.9799076184310467 0.20968917648487162 -0.94349576598773166 2.8421461157534393 0.23232254450478523 -2.3931986348977041 3.8521100602697906 -6.9435003427489965 -6.7136487134860499 -0.45732850550520693 1.6016683902284672 -2.3624478271304681 0.91373774211070802 -0.23301900718029542 1.3021788430998154 2.1763570395349228 -0.49739366846636368;1.1889178703383545 1.5044866248251765 -0.46925595868646519 0.29384615178563928 0.11924792949886211 0.77867058049571958 0.050105117357160063 -0.33648284567814485 0.88815674212328011 -1.3029204981320441 -0.076607903268885752 -1.3756153820198236 1.7348624363096801 1.1254841902115624 -0.42251361878283311 -1.9943337321510635 0.20242741018746166 1.8060594649832851 -0.86599837034346727 0.31458717525639435;-3.6705177570997263 2.4524912759336068 -0.11818133910915553 1.0542626063010148 -3.902191838390856 0.87183632272997358 -0.53021987016199423 -2.3439991909180176 -0.06534084725180371 -2.0088350776473072 5.6664116371487365 -0.24867877780351885 -1.8435238581075177 2.894122402554256 3.6861006360959854 -5.5835740078417428 -4.8227532565408264 0.06586947175145158 3.9651304912026304 -6.0607595213901737;-1.2635284047554498 -3.2845929718064948 2.5441764785134837 0.57655489839987883 0.16729110677839309 -1.3199002956449213 -0.73559844679091646 1.2342727958697735 -2.0863761138839472 1.4528864055505804 0.41242558492140952 2.7761439341678846 0.59030081257454003 0.006987975507407684 -0.11671932799967862 -0.29291250358396465 0.57338199640196441 -1.7050126910030494 -3.6029785069374465 -0.90660937673023045;-2.0267501682148037 -2.2173390118609246 0.92649177886320311 -1.376760555915522 -0.19593056861052288 -1.2255946945165634 1.747246133528503 0.67942714780533287 -1.4959540486240561 2.3495496580715085 0.15872570120718682 2.2355365062215187 1.7169593586569272 -1.3800181155786022 0.15820258367548642 -1.7579514533366258 -0.89986173651404 0.89355942720226988 0.43909913732422151 -0.3010433908830647;0.41961206705577764 1.284053482180372 0.43386668316540045 0.82151529962830339 1.0676126227686911 -7.3200275062631031 -2.5768928082990397 0.71862288415755016 4.5608249693179159 -2.1989320655065288 0.91334298345609699 0.1954171646263701 -1.3183298603799298 4.3290904819961211 1.489419908310865 -4.7127910064605851 0.50104833008253125 0.72821687223150444 -0.85249317868837449 0.80722627926020385;-1.0409345902088232 3.7541909619997109 0.91838206222242014 -3.3924797967382867 0.75880118487907178 2.3003513416054986 -0.32593332337640607 -1.058134820170912 3.5451814925590757 0.74023307056583953 -1.676214631308214 -4.9285500137438643 -1.7714057716911884 -3.2548157210819761 -0.098012632685908679 3.1787868986056811 1.507743349031291 1.0685413315096322 -0.29181216433737434 3.4179521599121525;-1.1831716283786244 -3.0422372796347035 -0.22735961387138146 -5.7535653120824577 1.9696830681204978 -1.4441947322725155 4.9952424362995291 -0.17765244064995867 0.081088933749534076 -3.0386232333450054 -1.7624855378742648 2.0259781951040754 0.38004138798080361 -1.2733542288201289 -2.0143611331277316 2.8064791438254413 0.60973680257411822 -0.22160070118065051 -0.26769696138257476 -0.91079078942666403;0.38142955740035028 -2.3368278844455577 0.011443099539842542 -1.8419966764912548 0.043116988948188974 -0.49742353207489803 3.5862251677723833 -0.59886952627539036 -2.2780284395173584 1.8050651021517794 -6.2371112164118703 -0.79670847225214936 3.787243960446641 -0.060195646777234629 3.7389044355427643 0.67218930160670609 -0.022130007463473513 0.19499765440512201 1.1083350749072876 -0.36696393065892602;-2.4489143440102739 2.5233303484075069 1.9591509719401019 -0.40194553375713693 1.2510857719805613 0.61486159529695705 0.12622934592884844 1.3386787233480342 -2.1848869472022301 -0.37241860646667346 0.77836942899440409 2.2865366994533063 -1.5296682755857482 -3.1072108287856577 -4.5842324537436143 1.8823048415368151 0.29435640616329745 -3.475078278197568 -1.5572409741699256 0.25321467105053214;-2.281903950267417 -1.7614821366836473 -0.11917793715186985 0.3113063198796277 0.69692517711731283 2.967819390386417 1.2559463620613347 1.2194452889647218 -1.6793707996282736 0.01656115927223209 -1.5963314961360244 4.1659507013911332 0.58454446654518133 -2.4298372705989078 -1.2926894697435511 -1.5168895700607723 -0.49524142325830395 2.5357933319121377 -0.37509600271147642 -1.7928961394900582;-0.43357180908405457 -4.4323940332123275 0.95430848226840082 0.73323484292226071 -2.7810652802679838 0.9367953049339296 7.8588831069669443 -0.56580844929273133 -6.9319242121290499 -4.9058212403422212 3.0827352910772219 1.8386526420480567 1.5063504479324832 -2.2555518768757756 -0.97635404032152184 -0.11389194105243203 2.1730651168418813 2.8331194530271442 -6.4658092977263202 1.7634637134954703];

% Layer 3
b3 = 1.5515544407156174;
LW3_2 = [2.4936815628671121 0.072128505567074425 -0.11779752858141859 -0.064761457691780336 -0.050827677747338963 -0.37730190694651122 -0.065909228120198032 0.08041235736183848 -0.33484707726107821 1.3285278762246986 -0.018172838549980683 0.48571734631804275 0.45255104947407343 -0.24858106654820775 0.034737381906392299 0.12789764104273774 2.4024959788240676 0.13958786114049268 0.035383513864975819 -0.047885791963734083];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
