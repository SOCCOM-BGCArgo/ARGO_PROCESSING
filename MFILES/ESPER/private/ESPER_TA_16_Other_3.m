function [Y,Xf,Af] = ESPER_TA_16_Other_3(X,~,~)
%ESPER_TA_16_OTHER_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:05.
% 
% [Y] = ESPER_TA_16_Other_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014];
x1_step1.ymin = -1;

% Layer 1
b1 = [-6.4139386086210308235;-3.4938865082602106327;-3.2424383911322371965;1.012747846802935392;-1.697083528157304011;0.030596454002750593515;5.0562845189095471099;-15.753897573632835716;-0.82455274218078611348;1.6689289147947545811;-0.01984936857814451755;-0.47504002449549531661;-1.413942300754588155;-3.0082972419794091756;-0.21534838883961970879;1.1671469040281134966;-18.339127435692045509;1.1372351521167716193;1.1320291177173782415;2.3829917732439049871;3.0230642442132449332;0.1021485582941821374;-2.5609314767172026706;-5.7897015636474442601;-8.2534799221222012733];
IW1_1 = [7.4209781860638166506 0.0068983961376817013247 -3.3925417058091307254 1.408317349643511518 11.52222795766202168;-0.69398084124142622731 1.8581532721941926845 -0.89479787515544906285 -3.5201894867169989389 -2.5942794992454802916;-0.48401033061239628896 0.55495221162190244701 3.8665806906258093356 2.0382023839409262322 -0.54245390847353791575;-0.81343795619633152416 -0.18914807694537183469 -0.5163920187851521737 -1.179890524373956584 -4.6381034387116910622;0.7584028765722226062 -0.75797085202641034662 -2.2108777184676080552 -2.956378618756462906 3.5291749212752905329;0.052622005300605609324 -0.48843274824918930799 0.0097987138087562916655 -1.5209608896105681897 1.9659558046656215868;-0.65876557299436722115 -0.44639332332551662219 6.8027939194199547046 0.33583618505252843534 -0.2988473228759099265;7.5403346422646375657 -14.169360674412848411 2.3100035888713019716 0.35673465424212080777 5.0770576971819894041;0.035874596133491067074 -0.66964349445089277335 -2.2392474700100448715 -0.27376596147664389314 3.6733649513315937973;1.3395760748411611463 -0.11035074082577119026 0.057051111727748037017 1.623129632446751236 1.5701261882611323717;-0.74895046374643559073 2.0818653077828463971 -2.9024155723871665202 -1.1537137660054979094 1.8153298042358452236;-2.6744491677650201744 2.1484370845045890341 -2.1361784389922013894 -1.5562228653029002157 4.4992720841942750454;-0.42916692147101720423 0.81216034011016347005 0.10269279318306936966 -1.5487615006157249287 0.94882833620062767555;0.16189173568985340546 0.93207884969501042516 -2.3322946598734861645 -4.4673114394298671925 11.512576481981630749;0.013628044505785886012 0.15525708051835038215 1.2905258069995291237 -0.35624513170452276611 -2.1615997974768279555;-0.046253012136756373185 0.16181100039591378437 1.0543612349566737763 1.8737601029073349679 -3.5583615409544182562;-0.057260992050256864783 -0.19950985243875177244 0.39051119697228325878 -16.326363116490121286 0.33712171083915937198;-0.0528811470665142766 -0.60914648094048129412 0.26363108117437905609 1.4168507330896580321 -0.45329751660785910783;-0.077287037833661129116 0.18579471184991580568 1.0751781426176731937 1.83602834437556095 -3.3480576130841162019;0.8678854168428125071 -1.4934749426914377679 -0.96297225991032853187 2.5183126450577670852 -1.2792347343364365297;4.3665717861528676735 -4.8963697497578646534 -2.9300359810573977093 0.26401534456037500931 -2.4642482607626092772;0.34902709012342164607 0.047089225421591683618 -0.15914990041700644019 -0.78001078275416124708 -2.1140871754961136908;-1.5829035909752200428 -0.51192306596712289224 1.3589948045359878659 0.57091787121544168571 -1.9394216604450751351;-1.6498132870407951067 0.47567172850742389656 -2.3599235431179841349 -3.2676269605773224924 -3.0962684915512310724;0.044856340065414460061 -0.2345516866641222109 -1.7138471786976168243 2.3681424349378232819 30.340197942090885164];

% Layer 2
b2 = [-10.724492674340433851;28.948524908509977394;-38.997451715285350815;-22.963621306566786018;-79.74398363816226265;-0.68568147555168679208;5.9281952775917972076;-37.384704849744331057;-30.085831311715224956;0.11517217717892698492;-59.7631564943212652;14.429187013171700826;-9.0919730118668695695;-29.335718173597932434;-17.508779887714592149];
LW2_1 = [18.935111331077713714 -41.496577169566748466 20.024912370618206836 -18.714935575670232026 -53.922634923864237066 -5.548912365654418366 -0.85629704055042443755 -22.605393671741232708 16.135867614002098236 -48.658731716435219994 45.778528650937225564 33.938397318642621769 50.645794880417653872 -82.155330378647093426 28.868409177540026889 -0.49300793654154845269 -20.062548170807300352 -56.259904329173011206 -24.512981109866913698 29.514508501699925347 36.928849726875029091 53.392865930781745476 19.819519594536277651 -17.283662614371472444 47.194316334684224046;-15.481020946817997341 5.2367084536102819214 47.716337071555187777 20.834463374400929325 -18.101755548864925771 -5.7756506133743954479 -11.257075445469622466 -28.71630859818476722 -4.2384057623781057345 -1.9485755446698678206 -1.1990933032326114294 14.349305224178774409 -28.915454852480543479 -2.8283336787387889366 -57.127927951273299811 5.0802859975873646547 -0.38555869464422765081 -31.215218955998274453 6.2907021579257929034 -21.864437237706493278 22.683386443624730333 -5.2786475368973224676 10.032178740889531099 24.536081654938520558 -12.648500099673547936;-27.243645391207230944 -12.678225847494184464 -10.069461799132124469 -0.42900474921788173122 35.644305556090486675 16.238682434397329502 -8.5946078148340276925 26.798690156210412283 -11.433961767541280352 -14.630723916830220332 0.9186294031216474254 6.4353498805902686897 -50.730668007117969864 18.4147350865874877 40.266990234895075673 0.56344101945951718946 -26.118902688844059412 -62.415655329368597393 42.278025942350431876 3.9979990381999992444 29.17870286430747484 -47.490307226413300157 11.818439367832318965 -32.658373891016033497 -3.8195821132356604366;0.20509250219005786819 1.5709727003335962614 16.814149397945136855 -41.275060460401221007 1.7356147422997298957 1.7775157699814685408 18.387674271614880439 -15.016340985331268598 -28.780682411387711994 -28.192488967542718825 3.0096956127419378646 -16.655028157471349459 -65.894483682472198893 27.755790735966371585 -16.324642168301505052 -3.4867789224255560931 27.783673840706960334 4.8448005309697794729 -6.3118065984356119813 -22.037859822800534459 -12.502718438769610643 -60.649445248760443405 9.5395836323853036021 18.561183179280536848 12.555280325929841112;14.214372825724472804 12.71855946177784169 -14.860878338385887787 1.3784002468735807589 -18.344644480520770458 10.035344142100136366 24.764455913563718781 -1.9262595925448966483 17.417987222299711192 -5.4761157105581865778 -35.64526090314329565 16.995193743782280649 -53.247070534314488555 8.6041869678336144744 49.838014567513972963 -26.800494711390694391 4.322915816298359637 -7.0812205372992584884 0.47453821838522292076 -23.153612388776352304 3.6085007856626805101 -27.723737739842484018 -1.7534756866252676488 -54.897694608573914365 3.8248463204573681651;4.5650488567431626308 2.4109881136616246877 -1.9457230265219291887 -12.108700765433253466 -4.0296814621858274563 3.8684354179197333323 3.4549340015879748123 3.0975168363091265533 7.7923882791138590065 -11.440937958360171578 -1.094055514669337148 3.1179588479518396404 -6.9916367854796721559 12.35732374755338725 -8.9122146714675025692 10.404885050345978215 4.9400858090082042651 -3.6785800782689817012 3.3850213554608776789 -3.170284116980478295 -6.1039676615779780988 -0.38338128937192045287 -2.5172211178620669259 -7.1820934208782185593 -6.1716929297460723092;5.6274423636219612632 -42.939358593257665575 -5.0528841209437471704 -15.955070447288882463 5.2161628986028949484 8.7138971329304659719 -2.9142321762052962875 27.474328660239176969 3.8341121526074228854 3.085296318063516896 1.2995149232592961841 9.8196851748412967709 6.6564042816372941402 -8.8528900932936931412 12.361794114569951475 -7.0238625841820372386 -1.197600381963927596 -59.415681808470779401 4.67434972769968482 17.789500279364638402 -7.6034523561256293078 -12.247743710655651483 7.5944256281273680997 -12.540549359733567769 -3.0234457661561542352;23.038699488285168115 -46.626258797010699197 59.32716999354639853 37.970904575122659708 -10.505729516428674586 12.34412099027214893 17.759691112155515214 -72.093980715701420081 35.318726038097160824 2.3713349983579443681 -2.6772151935547343626 3.3780246340350466028 -131.72937096358401732 8.5792576015037713688 42.835499214279501246 -34.00203314576962299 8.4179620456189638844 -132.93026223955584442 -4.1528145078912181987 -29.582907210090031214 -17.500401844907838012 20.009360859423761525 16.664866637332345078 -7.9339779732887452113 0.68878070276557523677;-5.8184147591852592996 3.3715521343913406049 29.178116899637441151 57.080890697593716254 -23.279024153430199817 39.5540254401194602 16.778926058389206588 -4.6563105484573092951 -8.4961024521614643135 41.22030813881432465 3.2158698772307023894 24.926097375037741699 -86.098992797436892488 33.799906170002060435 -36.159947042174586329 -19.799733189772243946 -13.015232492513701956 -41.197156846822913678 42.56994438432366934 -50.426229503084833539 21.689293017380187223 -83.826143862535261064 110.87011615705095835 -29.148779567598694484 -5.9618726686163325823;-0.036974517994994959835 0.064641908137564887959 0.089109163351786688234 -0.32559291500935516606 0.15660568757523535277 0.4431463277194653827 -0.11795942054881311534 -0.16329345133714198712 -0.012500338614983390328 -0.14169901694775985379 -0.074387496814196180095 -0.0038990543571462139665 -0.89420037634578986019 -0.076019161830427617321 -0.32996454634099819936 -9.5582515987403660063 0.34837344721974861095 -0.82747136640687313225 9.9327316405908039343 -0.17161702603537717926 0.058718063772009471135 -0.63964715057975551904 -0.14534572599391853975 -0.19723041112374412043 -0.14502300852966684697;25.707947743213736658 -87.814841012599671899 10.262792071649379011 61.741826219078973281 1.1500134410325524303 -36.510384090151248415 29.868690358587770106 -4.9688705336580945016 -0.037804507128516844083 28.101646658427544168 -11.982148265343038673 9.6451102639226427016 -45.831031221532249731 -8.6354169432008784923 -7.9299788439901810477 8.6651468446061361561 9.6180842693686265932 -19.746802080597056772 -21.769057664442932776 -38.269063478644824272 1.0353152785182784257 30.528086731711610469 4.8407205266980453118 14.650059188373822039 -8.0474491768098523892;-6.7511226879663652767 2.4959514443253048022 1.1034834375813518115 -1.7614462636809136153 0.26776232671375344019 6.1040920880591027498 -1.1036153105603792035 8.4863550736255444207 -0.15279721189036196694 -6.2879945133239036892 5.0287373214270933985 -3.7597288207406180938 -1.9001976606672303927 -0.21233400034220492603 -6.2126601943986194954 -5.4501460073105532089 -5.1844820338786412606 -8.8815119247952818426 9.75114815341091834 -0.55257201037784053899 0.2573782043817520182 -1.2982929321405156653 11.710760080800165284 -1.1252642815613544958 0.89177650690314047566;-3.7000666782653688358 -2.0088468793771303567 -12.811124956977048228 -4.1517121843994075903 20.295909098022839601 31.405465756555635437 -5.3168581760304665096 8.383267176256548936 -24.18149808416623614 -0.11002947627175499457 -22.187664969004455173 -6.0963852008852557063 29.539018233148865988 -7.55616208445082016 4.6483904511039071394 -14.740448257769099172 14.252435493689176838 1.59153760749081985 15.670145983559777392 23.857317151886007878 -1.561111939440869234 -9.0118855808506914684 -26.097826741235277126 3.5708727712851557889 -4.9089833469625245854;0.33867614097566772768 -1.6181975955849350335 6.6057284284560964238 -0.54741159426747365568 1.0362543950059139863 4.0881828070538777098 0.34535773969403693595 -0.12171253322901902372 -6.590173334619224832 -0.87041740887157981188 -0.048790235110224074166 -2.4209445594486460607 5.2212938244159463608 4.2056730135065283349 -11.882677457620134831 -6.2965880145905446241 7.3185502658886081306 5.4335903064412347518 11.572210535503561601 0.24891359170091800768 -0.80266481993355720537 4.1859370286514092641 -7.5267055197945120781 -30.006173538926944389 1.3253840020916061171;-0.19235190345343108898 0.48714793115449323002 -12.389161532520747144 -2.390596770939655169 -1.3632550192675279011 -4.1540419038150009357 0.50396008766148781 -0.62115369471134518342 0.94957092626942185554 -2.1594670124986929949 0.44769439859650811409 -0.31587569325828479538 -3.4736326354190936172 -0.29595682003858153619 3.4984703871243643114 -1.5329556751727833053 -7.6375272510376470692 -3.1181035638134835253 -5.0385672813627540023 0.24331300908197450727 0.12193113531901583757 0.2733023649262552035 2.5553171925612194748 -2.078161002447453054 -0.62657111624970962538];

% Layer 3
b3 = -0.020423252576690604371;
LW3_2 = [-0.0024355993576609430602 0.016195952523182299138 0.017232359731731435037 -0.015847952958996873452 -0.016396149559448635474 0.019384373278945116886 0.0092865133658078923701 0.0080686141343863301834 -0.011710418434150578551 0.84306112201319283184 0.0089344772636047644493 -0.023329558546643279493 0.022917423149870299465 0.060050467756864664426 -0.17137259195493248498];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
