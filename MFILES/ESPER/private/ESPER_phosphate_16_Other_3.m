function [Y,Xf,Af] = ESPER_phosphate_16_Other_3(X,~,~)
%ESPER_PHOSPHATE_16_OTHER_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:31.
% 
% [Y] = ESPER_phosphate_16_Other_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552];
x1_step1.ymin = -1;

% Layer 1
b1 = [26.90040110547419161;4.5388077253162304459;9.101488086807078659;0.22268821014636872024;1.2183769335884808704;-9.0445249016209192661;9.6169160844617476158;0.7804529717253124721;3.7874044636262040875;0.062210275190719768745;-5.8664726669424123173;1.2726483908441055259;-3.6328789566204022776;-6.3626936261940185702;-2.8353911491410310752;-1.3920485921157705889;1.8570524669949957097;-0.32137853393471710328;-0.37118818605446635139;-8.2688282153181251743;0.86360119277919977776;1.9962415719183517204;0.099060826267367854681;7.1877242067618558607;-16.978353543517993529];
IW1_1 = [-1.3610310027710532665 1.1091357102895482711 -1.5485345969141188771 30.112659058322417849 -2.7894233668849488517;-2.7977718584782365063 2.6635746878211978839 -2.2714543623428697927 2.1971170684959711039 1.9989033571735224104;-6.188974944848447457 -1.3647495755307981202 -14.2615488698882249 2.3537478638711943901 4.0586069358695331388;-0.53160413405304607348 0.57130160173950439439 0.84428404287865865818 -1.616998726655034968 2.0207050017612435688;-0.93681326061320691068 -1.6741886834820707275 -0.31701647976490077152 0.37411034650268915058 -2.7951250342530609139;1.9070324958068338717 1.5956192676784621831 0.3938131813289210692 -6.1995058445428785632 0.98218584550730114735;0.14866578975348482272 -0.6152956727652459934 0.73187137564370963183 11.248447097997170019 -0.9276236970631218659;-0.39849655012448276237 0.046874895444381982357 1.8665118659082735597 0.26895710240179104833 -1.48048036995573562;0.64728744305332341913 0.3557947770763798534 -1.2870713192673766123 4.753915621418108195 -2.2232438933974010276;1.6844721733510303885 -3.1208165305332649098 2.9584093786186556052 0.68973551816813760684 -0.54987334294998813089;0.082444772042352523767 -0.36817856298267120918 -0.11623607827906977386 -5.3016174788256273942 -5.1331078873380073802;-0.36473241813307571979 0.02432582288047727137 0.093206018800529269464 1.9193748030205415311 -3.0469757805234785053;2.3522243367520210278 -2.137459776212559337 2.3628779262712957809 -1.8128893012747551161 -1.4658308097353838217;-1.9241954590502845512 2.5753651195575377741 4.0737396525254059299 -10.600382110600143903 -4.8442505666450212942;0.6075685398399938153 0.11183899349905786214 -6.7382432337570286052 -2.6495214083869234045 2.0895061934585030805;-1.053648320969009955 0.47709896181277633431 3.3669777796904165612 -1.6223657110179263707 -2.8045251542456526295;1.4214920176846743693 -0.30345441827239544308 0.96492991609906797468 0.48804782940911017874 2.7567988249398207579;1.1366996015823145338 -0.37990089552724365385 -1.2566763573553538791 -2.8373626504440845331 -0.020527911246863015521;-1.1265794948561576039 0.29907040578895610627 2.4647915362363241876 2.3695556972380797944 -0.64000059848658374939;0.16296040714785167691 0.48230105939918566094 7.6765517272757941569 -6.7440965614279848594 -0.55126915239155749315;-0.19523547311426187045 0.21388723034716988769 -0.85188334128190723593 0.40561997923829146151 0.14563517441830739485;0.67753474301751470676 0.58656628288061618548 -2.4613864839824799446 1.5539856273314518464 1.7288153740281406723;-0.44013993325443190319 0.50954791848478908634 0.80658520665502697611 -1.5634097924755738784 -0.20053780918511826536;1.1109364640910741606 1.7558493469220639582 0.55620688364467063547 4.6502368744208393281 -4.4413166836665345372;-0.98209475715802618812 -2.0835233799380707964 -9.367292329504284254 -8.2216587042611397607 -3.9035441457015229716];

% Layer 2
b2 = [6.1496443010723078615;2.3282719247256440376;3.9751755442463880819;-2.4565376438478137011;2.2296629689435580879;3.1318781844461418551;-3.3476941916952438483;-7.0367602793901724567;-6.3605036968661474717;-5.6462195197308897576;1.830916961326172876;-1.8459871681243464892;7.5185224145819740116;-16.37575591434511324;-1.3870260442085269315];
LW2_1 = [-0.20649959053158273292 2.8834276545944925729 0.079795416206261945979 2.036141900107923064 1.0661268182674048521 -1.7124748553671373941 -0.16024871280655458849 -2.3451510760127622923 -1.2002485092569563641 -0.35647226858661912319 0.16246764876775479647 1.8173286527371834698 5.539777705094604876 0.33465441229122083744 -1.3746450486015515668 -0.85974028871389684969 1.8668028468714441548 -0.7570684371257032641 3.1101556981002200786 -0.89092319945022013794 -0.074631249414317174518 -0.59438468883600448223 -0.69102739070993945969 -2.4093798414677758402 -0.11998370945618321015;0.43246269094086520202 -1.3156467763290948803 1.2216220720688948376 -2.4892102367364477011 -0.3365219793044327834 -4.5406677626999059072 2.452956035132392465 3.1490709555805573849 1.8785290786509907246 -1.4817684710608483023 2.0716164733068098691 -8.2854413328119065341 -1.5273695015260970731 -3.006137357626179174 -3.5084810459135158389 -2.7688243056201242709 -3.9791228413298775912 -0.45228264711343246773 -1.1359762517525577863 -0.76677778222975179201 -3.0938677725456202872 0.33280361021297266699 0.74402722801700305055 0.77043238566478977614 -0.59761349034890454135;-0.20622364471806084452 1.5376920720947271359 0.32946393911291060874 3.953876532183643544 -0.64446867150952724668 1.5166648120265557864 0.52776830822120257558 2.171486469368773875 -1.4811637765275975642 -0.36775950113489408455 0.088688371122313799932 -0.041987430957995855452 2.7771591347296573637 -0.21580288485629336992 0.2098006226239427785 4.0515995253409462507 0.56237092044861725082 -3.0274866766987322819 -2.4503761369959113914 0.34462199859570080696 -1.1224437358664427489 5.0339544898964536657 -5.6317211503643376247 0.10708241345909340347 -1.1680984367863793683;-0.50914760631421529524 -1.2970691657116129036 -1.3149680589305632328 14.676942852339834644 0.32451642098712729645 -0.093389376378818056423 0.29582753773236503125 1.5542327245429665705 1.4473673895577334747 -0.011563666197684931147 2.5636101600904632747 -1.0771019864040969338 -0.026198699580693297906 -0.13538658269713341187 -3.4926922962678763618 -1.8306962659880756661 -0.049375328435643357772 1.3509724122270359015 -0.47832603273602875005 -1.9499098862824761902 3.5799411694710245868 0.49666827030586435665 -16.922663295187181376 4.8136179351709031948 0.85817709350961324244;0.41716164459001314757 -1.8439320115684010304 1.1967552633193982992 -2.1335715491041749026 -0.22727774765222807929 -4.5816834142294453613 2.4923930972123122807 3.2274312478754243472 1.8712140736608504632 -1.4762196175873416593 2.1092801477597382664 -8.33903435121079184 -1.9924595100494328914 -2.991502875682767737 -3.4255320371063033846 -2.7217494121835472676 -3.8488031471364787528 -0.39299477256860321228 -1.0676452894772350266 -0.74785036031998708417 -3.0007395337509970012 0.42823620444263288398 0.44004103641590652796 0.90259887037988906222 -0.42053979463090607194;0.74004675148510357108 -7.8394464183353296249 3.8462677422487119294 1.1907720558292049784 0.18664960250065815162 0.7155800578071236373 -0.54196129547653271175 2.4538459943509964845 -1.0862432354325926021 0.10962956347107177812 0.67151900899868510741 0.32120315881895866728 -7.928566829575800945 0.71947504795792127652 0.92716862903245511607 -1.7247795129658316515 -1.6891130480655347501 -4.2621740711763909104 -1.9377300310860285926 2.4121471521753434786 -12.900990184531382354 1.4811439772297909645 2.0844979456712553478 -0.030441623789720269333 0.52245678065867839912;0.2086894485006856037 -5.8980291247478469074 1.5863111391853754739 1.7140802178709044767 -0.30179755815355940873 2.8489550732425641399 -0.39613378160660661642 4.7966080791223904001 2.3232055941779408137 0.3676548660207206165 1.9481051567785148126 -5.6914881825650471825 -6.718423631544150787 -0.2442731522551282175 0.30296616280779287145 -2.15360920302292147 -1.2904735278255365927 8.3867759187399464338 5.2916897479566502582 3.1422404469315274866 12.711945470338148922 -3.3528411719615092146 -5.7001274616107542315 0.20843403646760100267 0.47659488945053329889;0.14425546505382280671 3.6023657509111477459 0.025437438822427414081 -2.6585087823189317291 0.70401455458256467779 -2.6968828931140804706 -0.23846517141173359522 -2.5682014574870875023 1.4755369797472017712 0.58651853315114543808 0.40405301586157027494 0.62358738297278937246 3.237994186347762593 0.27102691177176241322 -0.25908639134066402399 -3.420317159104689253 -0.1170074352079413238 2.3395442323538393481 -0.50425316299723277336 0.23945937290343513593 2.8747927491611955375 -5.6088669211126749303 4.2798895076273275606 -0.77900723515818715015 0.65597670509305083808;0.33561600158918386549 -11.766027011848207096 -0.10894479682486050975 0.32063499326459266037 0.72443621873451025106 3.2358968433592734115 -0.51316893996680601475 -0.082891043797781727154 1.6673199691337086126 -0.018169184617075107707 -0.24578946198160886438 -2.5523713206865759062 -14.41993465326662438 -0.15121618763375110905 5.9003172106252765872 1.2825734241700557092 -0.26567558441690786175 18.585446068723278756 16.351629593907496485 6.146580002375428009 4.6425900790253464834 2.4163691701759790753 -0.97566690701448544054 -0.59548418527225244201 0.6137701916590203588;0.083371152022076330801 1.0214520663507660192 -0.74913137775035754107 -2.2917335335233004479 0.62589173976803613719 -1.2685187511432500784 -0.27492446052126640055 -2.0529659007016269889 1.0772203558285853298 0.51368120039747067196 0.12653460164389099263 0.32992839949320240667 0.4992683888621134991 0.17625570843210658367 -0.16694516554767568906 -2.9095040156392557584 -0.17841912779579791049 2.6521276115357399483 0.51791063947565607606 -0.59501296638870526667 2.4531260518871240706 -4.119403605794668799 3.8375487316114043068 -0.16756367422582432725 0.65116109095290553022;-0.15257289166433773975 -1.7927512362093458442 0.040678180499290679528 1.1899072066582632168 -0.2539505126355448561 0.019364336889285599375 0.30171144872212363186 -1.7292883186647716176 -0.29431378498004634459 0.11557744188881052816 -0.25213618392344483432 1.660132175653601827 -1.007971265664566296 0.14138878677791927307 -0.57281876178331347926 -0.1443311634107600494 -0.10558774481800700662 -0.83223052391910523617 -0.38266773365768230741 -0.084969070555971595859 -1.6973651466572929891 0.37224932186269360512 -0.78509904969056854007 -0.62311267427216210368 -0.51741403658127937959;-0.35236437234273010333 -4.169438625574803936 -0.053837917549038404041 -1.6804479214576708568 -1.1497071916403185377 -3.1932174589014277188 0.69997677186235562896 -2.5033543657812726835 -1.324271050343707401 1.1651976098935219461 -0.74804694422544382171 2.1490861695813752164 -5.8011526226365823788 -0.038978424055300900375 -0.76909424100008727532 0.62082005333130818592 -0.75868078630985935629 -1.7643356694594385381 0.36119758097333981572 -0.036660247084474247015 -1.6813453959032571561 1.359981576005315107 2.6012781481065303524 -0.11599540212443494591 -0.40344506509464245214;0.90951661710149567242 -5.1094325143001624312 -0.051527948970948422858 2.1121539327587965929 -1.4632553522976559091 -4.7671318611988331426 15.972852531953972033 0.80891647552099454899 3.7655443172591067658 0.50264383869678830319 -0.0021648473257842998363 -8.2356764906019126471 -4.7848020002919762206 1.9285160962493379522 -0.26212586844211854809 -2.257608349756203836 -4.9300388748033485697 9.5398838616672243518 7.2516084436352201692 2.0344831024170262346 7.5413011615093328288 -1.5086146624471776789 1.4573604259356793822 -1.7378288355799733633 0.70335272593583308964;0.16561534088293006217 -5.6718884755955070176 -17.560160426528454991 -2.8752642900079310451 2.311198185925183779 6.862781264196372355 -1.187241732345885481 -1.0880099493948367506 0.4640827195465656585 0.76309743423044074095 -0.55630198371545214187 1.6368394937668087064 -5.739009056251163976 -0.51211813392273297652 11.99504693376819553 -1.4002959162425980821 3.3228460389232439276 6.6991213583919959618 7.2061249586928646238 1.9792122636713496142 29.010320974308871911 -1.8064228932927537397 8.0457359069255431905 2.0124266074576446783 0.031408510605537995342;0.13960940440769717408 1.5388820483837590825 -0.035539946020904322754 -0.72945509015349196957 0.26415065235484319617 0.22264389664516506806 -0.28805455606531665813 1.6662779661734856695 0.33752598972479980199 -0.12999306596314008644 0.27880323748353130764 -1.6433103122401857554 0.90820992119976562407 -0.13767221407147051115 0.58868163187238009559 0.14526797893119341998 0.074128447248957937687 0.94830458194043054654 0.46150199383628492944 0.086599891718127763873 1.6508264431251880033 -0.37142221378045675584 0.30629987754914222986 0.54154445984107013601 0.4940829727636084634];

% Layer 3
b3 = 0.20718981077572873328;
LW3_2 = [-0.38544791205273587487 7.5907048399188798982 1.2967863850164647044 0.26137938871365179461 -7.6752335054021081362 0.32043583809130510298 -0.46662025607053636556 -1.6392600038760343217 0.44481430039019009826 3.3566969052910629046 -7.9105240163292718236 -0.45005392187170412122 0.49500654113350001095 -0.19196430031351074952 -8.667255995951283154];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.568038194888224;
y1_step1.xoffset = -0.04979;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
