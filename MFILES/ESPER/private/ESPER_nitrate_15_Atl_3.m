function [Y,Xf,Af] = ESPER_nitrate_15_Atl_3(X,~,~)
%ESPER_NITRATE_15_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_15_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.91924757150003988393;-4.6256699041058881861;0.13321699429917388535;0.85503765236783879633;2.8620072361911543801;-3.9261341067829444995;2.3347311742020786518;-0.27494991770092863659;5.0386545587622713072;3.918398024495000076;0.90033905599460772873;0.14272898726476021536;0.5713964308649797097;-2.7930028814116298896;-3.4983143213011929085;3.0302514286468760218;-2.8672328228467280908;-1.1167685680284424876;-20.48799267765434351;-6.6970840255693859788;-3.9349105070747039115;-0.53718686133456261533;5.0713300031936787704;10.83997215363471156;2.0926897944820508357];
IW1_1 = [-2.108195147546659598 -0.51862350094493558927 -0.43222655296336381925 -2.8323256945637558246 -1.1654879675115483728 -3.3792860973440523864;1.3131057327984523297 1.6230427452729714322 0.25852867614126096019 -0.32613024001195439761 5.2639144692054840036 -1.182858846182050172;-0.87514376782836944546 -0.69038338116982622683 1.2723362873561632203 -0.35853782335922257385 -0.72698159177244148221 -0.20183145233409349739;-0.11807938218836340483 -0.70609953844759054675 0.74039381828398098673 0.58164214614188980423 -0.38407897773374966022 0.37143794785353545507;-1.0711418684668998491 1.1520735321258284145 0.57925102766757841088 -1.276263031457840702 -1.8240924440182535449 -1.0284261026032737174;-0.30976629147633433226 -0.38204031880050631775 2.2420708875190675791 0.77276116437425801386 4.3988319086768044031 2.5884249963455148169;-0.037233830173654065832 0.019901742290539477936 -0.17802660011386695071 -0.62320480223598884173 -1.3209552300674418657 -0.89774717487363053792;-1.1784148594573586877 0.9350869017444957132 1.1871984602656293628 -0.33616999724882773437 -1.2275753960184185853 -6.5980797302736204912;1.45186867020597421 -1.911836228291892148 2.1463465812140083422 2.5347491582225356588 -7.8107960586005553694 0.39527561198962013478;-0.72351487614306075891 0.072861047274474247115 3.1089707138314279788 0.45105113322394280173 -7.8383244772101923203 -0.49925394248840271327;0.67944737345800299 -0.17153504490168189345 -2.9666595935252728644 1.0220299071268352797 2.0392857914580271306 2.3725178391608823247;0.40735589206371530802 -0.63923783067786499323 -2.7715083057236009623 -1.0452036965622304443 1.8925802973845136101 -1.7209567539446468665;1.441919521331303855 -3.1396185308042547923 -0.87035321909355634062 0.88182053514613523149 -1.2550410189753902213 -2.9374203886839724831;-0.62643630812471173819 1.7027075289865007957 0.94309638141512341925 -1.4105251401977449976 3.3884748350273548034 -2.6341156325738137589;-3.0811184148103607505 4.1364907227815157498 4.0580985579646897676 -3.2806068177357698978 -1.3747827734683775169 3.554271056712666077;0.56990173455303150263 -0.24779372121441350929 -1.3555692910818186725 -0.19224800977525582923 -3.6398705229337693368 -1.745388910196795651;2.3994600985130563053 1.5523116593991275192 5.23894321189669121 -5.5456608342659947652 -8.0658710356369347494 0.65170818104800731785;-1.2994344965966724281 3.8801760392526101207 -3.7292308667904450203 -1.8860278766536786588 7.8358114694914737797 -0.91409152374540880714;0.59976297252979815511 -0.45956643579691897061 1.2195475192691378474 -28.332977748577640398 -12.162642023162648641 -0.92195018002150175285;0.30673710144632038155 -0.5717562480443559858 1.2154207989266307965 1.8849541682776251861 9.6327387892958302729 1.1804105530263446777;0.31986521740888912424 -0.12017779309095417972 -1.8875192739963280175 0.78160690070315164135 2.2277538160736045647 -1.0560763945818143483;-0.20929647533605491572 -1.7923061730382237045 -1.0630268112346157316 0.0079830160483410940453 -0.43585890265627624807 -0.47167702660726629205;-0.69294102906074517279 0.42631194673466837886 0.83492415297599920088 -0.88471272313029902801 -5.0145296097598279772 0.14723170961204631868;0.16341129693800598988 0.22181677189599655065 -0.59619624997178499726 0.14471673667249515538 -16.613643301960969723 -0.20435798100393676169;1.6418235489690562456 2.7719710421752683516 -1.9629566892127590094 -0.61708768658820745134 3.7870907089193273087 -4.379421158784175816];

% Layer 2
b2 = [-13.713511085027455749;-8.6182842070561100911;-9.4165891385564162164;-9.1426295701601763;2.6374093040583175274;3.5669211447186977004;-4.2898446590109005072;3.7384728735365606589;-3.2397964564465602244;0.73843910506260335147;5.5075517152760085082;3.0720022499220713819;-1.7194734274620864234;-13.2009318220776386;4.803437021972597698];
LW2_1 = [-2.4075582502863750456 -7.9136203837668368521 4.1135904565172110026 6.0078702641338015411 -6.9513734323818967553 -8.9353361179609205323 -9.0688742427243553834 0.68015574036616599507 -2.3956313933339763445 12.08868519148505527 2.5427644490133882726 4.8539674641004371125 14.203202216606477748 -1.2240207668964833143 4.8678693061322553248 -9.9403252666053951714 -0.43651589195323592385 0.73144776395712207684 -4.1690327562392983651 -0.77672117894035597185 -0.18732373908741073443 -0.72279640755212970493 6.3072771302362609092 -4.1687695142918048674 -4.1086398098409926405;-0.73970115775418721071 3.6752891691034879074 2.8313045230729336765 6.2485355298640854471 -3.6601615382632362028 1.2216137544711378471 -3.9943272272658520983 0.5184370955831365535 -2.4807921849311647122 -4.9941648761591519445 -4.6870836258702528454 0.61485891635094847008 -2.3806856404274086003 -5.4881133592940019028 3.2725666341746397769 6.3114176859684594234 -8.4287397764354032859 1.5636367426319985885 -11.966921898472797636 0.18241657825877422017 16.848960536413063238 1.6096101337012731491 9.2408844971593104844 0.27036893248937277079 -1.5931954882786092398;-4.1102042457195899772 0.40790909032481231788 -0.71875979070355378031 -0.32891151332026014042 -2.1670209987594404311 1.2362748216558598902 -1.2585030203522991066 0.3201032489797373537 0.47617172072456903642 1.4246844556183781982 6.7655111349959042855 -0.033239107317255545126 2.4482317215144533407 -5.7547462452832816027 4.1386751739786520332 2.6822146062347185236 5.6154688761594107049 0.076329853989774279488 1.1265540285869088954 0.14841021289261488447 -0.30933790364966023967 0.36264682027789874041 1.0875622962388624693 1.0323446053405438416 -0.2927473963433089299;1.6660759988590323477 -2.9930738918929091774 -8.8658190192048280664 6.2584381204262706788 13.684592312366881117 -6.2747444857959244757 -2.2429090602902630458 0.058561752702887048816 0.22422639255011553305 1.3210037074677130065 -2.1833719241912676878 -6.241215610194637442 1.0818087223961132537 -1.9691951269715644024 0.11759372449075779221 4.453781558466168633 -0.28307651582848269989 -4.3819335477492682429 -0.045077222411399331392 -5.1515754884186932827 13.781421485950572148 -7.3935774915022491882 6.3168979997584697728 -2.203694642945171811 -1.2003838385500942287;1.7862933266799931875 2.2922214666492219948 6.1957074742162081549 5.357291627540479162 -4.1500374152296988228 -3.2023139812607679389 7.1939942043122799831 -0.53667944732443850775 -1.5738089225035327701 -1.9439060771816598638 -0.68646576300864425857 -1.037436743344994472 -1.9044009864321413961 -2.4851982166579906774 -4.8261471788105758662 -0.42832311031780317956 -1.2984388440905367812 0.37645011729269928225 0.021868400662164159953 -1.3776725387829982239 3.1799821298437387362 -0.40181202642010932502 -9.0227983178099808725 -0.87023945397866719897 -0.13621398366635714683;1.4765027335673930331 6.5246546665538991405 1.7189170190913742875 3.1359104118340090928 -4.8236799201461675324 -8.2210395989905222791 -4.4397591474096405051 -4.3640720953191083353 3.5276975844773876823 -4.1100356846875039096 -8.3142733095030134649 -3.6160463117125765109 2.1534233060079253086 -10.617034637586394652 2.2094296714346524091 -8.5515946597762759751 1.3032072689469333948 0.50095322381980478266 -1.465348341342415095 -0.27651016705719200228 -0.98939193226334742892 -0.12384803752378530095 1.0844419502166879887 4.4869424000578499445 2.2060653804143681711;1.6783287405722142616 5.1936387235124943373 10.777721458913138264 8.742557012362961899 -9.6137260738747851718 -10.467997000978296995 -6.1202142324268304918 -2.701727870053706404 -5.6680680997523333886 1.016018383036324968 -1.4391920440425964856 5.8882857780024853156 2.4214228218503488499 -14.907507260448896957 7.2773910087845461447 -1.0316384781995404651 2.2523114033816069579 0.62127176682269080743 1.3813789962830831382 2.1913346120367163117 2.4009839533099301967 -7.1190477077031140141 6.9078957995428798 -0.23358724438220637709 3.6791600831289978935;0.3387854735358502567 -0.15672834250267994594 0.82224987693279050216 -1.820599503917274653 0.053406839705320792444 1.7198118408850120442 6.1140276426393738163 0.4056544568881431112 -0.52800815989793015159 -1.6914284160110142352 -0.93505323012184760056 -0.11762898205554546405 -0.62003083271959891221 0.57298957480525813946 -0.17536142433665358187 4.2512959133296419623 -0.046015669099533619557 -0.78737764653058384123 1.0705498157042401264 -0.2940273828027251124 -0.60987801309237321679 -0.26048775955966424478 -3.3044417417551246174 3.5396139879370518422 -1.7320393244152325618;-0.30299689392503370566 -0.41186828501493399912 0.71816206701497764531 -2.0474452901222095491 -3.0581475470617935919 -0.30155239630176788879 0.89920300541520048476 -0.68458302611856447495 0.53166754083316225543 -1.266698845157693043 -1.4897789341829386078 0.1405591691716836511 0.19743627623911161328 -0.83854393272088290079 -0.084037193952725602886 -0.81377226409336234081 -0.30396853126701139924 0.21488066941480879479 0.0021457056073251601358 -0.93975412682661385588 0.92434971762883155755 -1.004966962659597618 4.8328244563633191433 -0.04212159262084868433 -0.046567832964233030202;-6.7259235775088752618 -3.4984515578628170296 2.5988737676501902918 -6.0389719735035010117 0.27469304368900709923 7.3384038988282096483 -1.5983999312065524379 2.2646471580038096683 -0.19104870418025399204 -7.9918916282565053422 -7.5255166927529764109 -5.8074747105670194713 5.6963454435135947307 -1.0891459633571272114 1.3487505669924384488 1.6080957248185066 -1.7006028865924265325 4.7946988412753137609 -1.398922537245030906 0.49859164269449235407 0.77968849464114942105 0.94919706037905948737 6.8973580842630983767 0.58622435200055911242 -1.5867716152129194285;0.37666700431888167078 0.35106316611039917186 1.6867926946511371256 -3.7452848358131691775 0.4794646901722129928 2.5745174337081024873 -3.3465861694884586619 0.73720279567556779021 0.42998806144058460132 0.83128879995519466828 0.42435989806595547646 -0.65887596677161852643 0.42851507535632143986 -0.20006319069853423231 -0.31377480349894665279 3.6750423419003408476 0.47905534537621846658 0.93168904835869148506 1.2527201701435213277 0.16404927067773339422 -1.583334197165535695 0.84698811160340636839 -1.5801600910625968055 -2.4914956619563470852 0.28117410184459479261;0.14742382537938295006 1.7729582371559216014 0.099861083119982554934 1.7663555479839334605 -1.6890783546187913 -1.0984423173740376356 -7.1675108591432987737 -2.5578186627885179938 0.5696900529702301208 -2.5166675114535816959 -5.8201214491954837982 -0.72383710537609480262 -0.63693971432586216075 -1.6586323467284327382 0.070706843555756862529 -2.3853443846855948429 -1.0644293453307482888 -0.69905620909216148462 -1.7205647573459750266 -1.7129795066670105985 -7.0782273805268056677 -0.34148784820683297792 -2.8025638796795204755 0.66281237563583217387 1.1744623080110052626;-1.6004220778037501205 -5.0003239963020718051 0.86311085138896559421 2.9473804552937048484 7.0029135056979416873 2.5524020648204643891 4.275054277641313405 0.44019869082901719182 -1.0449409459074865403 -5.6242873558567909598 -3.2168776389726057019 -3.1730482498342182929 -1.4195624546528622378 0.44264499183212319133 -1.1450129894051379598 -1.5271180174776639582 -1.0768393122202497558 1.0391995198617702822 0.80790534467936070406 -0.89656240001950193719 1.3920536251693860219 -2.3104225719177500231 -8.3284707055239657336 4.4031133200483330015 1.9916320169896528647;1.2435636458481940103 1.5528432689119127108 -1.0638467565042084573 15.027302759542319421 -2.3396675168891007957 -6.137657062285463816 -0.31239115976536646624 2.1503722961865912033 3.4674561377856454314 -0.29865985033193664933 2.1478002309004406989 5.0276896026102830817 1.5733900484453837709 0.16763913806441230192 -0.74763036461209420036 -11.913056041757803527 -0.50735053916698069632 -1.6715615432268902119 -0.18244365835150747057 -2.8752185031841115403 3.8454961071666482475 -0.8969099669132500896 5.2926429583816316793 -1.3826623927196501906 -0.75406591901440811476;-0.16164912549793419849 0.36080298743457667188 -0.75057798579943302286 0.70316549656950988467 -0.10045737413260608095 -0.56173932310701679693 9.8299270175541639816 -0.59881968088347736767 -0.33675504273757678186 8.7689998437168625856 4.6809000682712040842 6.5553134905225878271 -0.060778106755644843717 3.5897551197282155933 10.829594552173899658 -0.37099530450767875811 -1.378815481850441893 -2.3675778360713040094 1.1337579525498846511 1.2437269819061715914 -1.7889813830220109292 0.057917082287969295917 -1.9846888913039824054 -0.4703361919817471426 0.015253555565122971227];

% Layer 3
b3 = 1.2873055324855819936;
LW3_2 = [0.028296719831404186507 0.061881604614922279539 0.72142691955314230956 -0.05701879802668902153 -0.083190461282771230311 -0.03387407759187509998 0.02417331300447511308 -0.12379162511287337967 0.24996215493536336205 0.043654943383782937594 -0.1649784505251068456 0.14184024912733148027 -0.052143870863058543186 0.10378725533722928109 -0.67909759170077477197];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
