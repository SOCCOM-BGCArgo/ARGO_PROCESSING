function [Y,Xf,Af] = ESPER_pH_4_Atl_1(X,~,~)
%ESPER_PH_4_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_4_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.9028475946137934915;-1.7301861017540309806;-3.0232316864197463779;0.85196300150301906839;0.90724977472295298409;10.205892809816317524;2.5419047294805632298;0.39795959703876471192;-0.85328372655448503359;-1.2828135838883003572;2.7545087128110217201;1.4873795512064060809;4.1435995221403825184;0.22686098371709345622;-6.8200593610260433763;-0.81123533849961404485;-0.364041125210896932;0.47626296125255951353;-1.9560806180990550907;0.91301144067607664656;-0.95951832997508845757;-0.29934282628473601884;6.510818952385611702;-0.011013199376400479787;1.0132411998980237477;-11.422719704778627303;1.1522833653535695664;2.5571508563834819405;-0.60221443936357255122;-26.148183370969338313;0.030269779549524679363;0.59470423815361561637;1.8941467945352694624;1.9241547770600344602;-0.25984495213341540776;0.11255617330349568239;4.5062108197409145305;-3.6612475121451857341;-2.5902070597460666868;2.8077320474251012961];
IW1_1 = [-1.1828395319493822946 -0.7478109521826834527 -2.2638897039865364391 0.35157378302097713751 -1.907715290566278199 -1.5799378028207340385 -1.4503457388363427683;0.51110014567982731126 -0.23773395841676364659 -2.5425119915860938669 0.62622909514505420425 -0.019063593955172996458 1.0022516168571025119 -0.81879308401875905421;0.51851377933010078802 0.39064729591084279559 2.4952738991070164687 1.5698553981170935145 1.8294531194246081984 0.46961681611119726609 -2.1122128176335523975;-0.40825205690292099003 -0.50861021637491554692 -2.0553262941934371533 -0.99838060861681021674 1.2819037329663665048 -1.9837110293566524444 1.2280747841645660579;0.34616718044879218885 1.1606764400626654599 1.4570757853070752663 0.18670024911499583098 0.78544953341243040068 0.24148499820427743456 0.14930905782649239733;-0.33712590318673907319 -0.69756823501714515512 -4.7571207140129203594 2.1349597093961736327 -0.22811139717729361776 -2.2658564403271022059 5.49607936861411428;-1.1000130327289585619 -1.6461438751566375149 -0.37957419575575712667 -2.0339849730885637413 -4.3180266061256249444 -2.4205217029606087564 0.82172330603780652236;-1.7223784742905736689 -1.1976560353629883693 -0.55819032058611117719 -0.67814855804909124348 -3.6046276150117537718 -2.9908239289910638625 1.6623953774621726964;-0.12201211373572744268 -0.40595925099065238717 -0.89634148733745544479 -0.484406821150540845 -0.15380979265498082031 -0.45928580815392072711 0.21716895071974323672;0.26425125458222764596 -0.51652685629300765235 10.349639338658292331 0.87377679636304284028 6.3014595575366936231 -0.80050065334494668878 -0.01120689772081113339;-0.54535000768062102949 -0.36222915231839908357 -2.691264352194390419 -1.659562817632891818 -1.2961823521977022811 -0.49620356499194173683 2.1352704481508051337;1.0069664984299013799 0.11770809772157990458 0.33908712445901512123 2.3027182733121915881 2.1604592900241845754 -0.19194150818224656185 -3.0343855231666605476;0.4027321328798286193 2.3367130792896686486 0.31590089074495347754 0.89761556537239051146 -2.2996033337456993628 1.8349400366077504021 1.1315035027370146103;-0.12655524072815113601 -0.28095399909517543291 -0.73117680759438330451 -0.96690770480160392886 -1.0692620082237465073 -0.18504557285097611441 0.4288417077502710284;-0.43769062434330213707 0.51627196707667599718 0.1458720131279004073 0.37271553604677948313 8.052136408772557985 -1.5473106072160862645 1.1065140392857231166;1.6391888534100935715 -0.096229047380586518745 -0.85648412871088752674 0.018259467926061111187 0.15950582121951242809 1.3109405396400446442 -0.56603886276274062439;1.1403640237130021617 0.046130242017936383403 -0.63372683930421913612 0.0785542847972785091 1.535548198410033427 0.93150369440406022292 -1.050040691243910862;0.28784744514453614039 -0.087044469620693162848 -1.2607517257466933636 0.26600455878691475764 -1.0690235090390298733 -0.36967907297522223375 -0.1701364388577517317;-0.27810118294047891929 0.35777315376294549498 0.86157775816919401901 -0.28747494431506875889 1.0685225747122557571 0.53640214908673256033 -1.4175380436544564589;2.0192285937983331934 -2.6427031307673227722 -4.0682010812554523227 -0.41344550822617859298 -4.7609412510213235947 2.3489444882484376009 0.22513958046222945497;-0.19950574734793624643 -0.14887463479096324503 -0.74609619794259107728 -1.1725127814036013785 0.93303043332359025808 -0.25043880987539685057 0.54322492585132042819;-0.085180020877027681769 -0.33858306700438584036 -0.88559952722151236149 0.18832888924251409146 1.3814084242207778086 -0.80694403965387562216 0.57986490257108136426;0.99294540306335821178 -0.72769832236363640732 -12.674894199903919301 -0.2127487490746761134 4.0772045005036918752 -0.48631353325423143374 -3.1541204831653710805;0.065495189088692659651 -0.097929141420999607504 0.48839355854640909005 -0.11145758408208772394 0.64024472300947699033 1.4172875616842306457 -0.95161124502387961499;-0.08615538527537057456 -0.092228773782099149336 1.0143803861111646558 -0.61132821132549342025 0.81398265876137498864 -0.72644619005823485303 1.7068024728993647088;1.075966653095858705 -1.0105500853197584288 -8.8578275309638137003 -0.10898217696800098497 6.1506709840468269945 -2.6682143842526979682 -1.1022494128712496675;-1.1242878977750627723 -1.2145342450921121635 -1.9682487192260680331 0.60720456633596542328 -3.9640603162795469139 0.7018559667613044617 -1.5982170786451184163;-0.10880460279509537869 -0.25097706148500764645 0.85945465642080831614 -0.85895023997625419288 -1.6337119230442245232 1.6538766984625123957 1.8440032507090207137;-2.0261640684168247262 0.92643311300137309861 -1.7068608613473810198 -1.3032450682581582235 -1.9922141593843158969 0.66207953967149624219 2.0466165839923053937;-0.22851214966002472706 0.43363104862749352053 0.77341683393794236068 -21.277627403393612582 -1.942032978308118718 0.25723603060798816422 -5.3928540780782894259;1.822773061914823689 -2.4658449254602845535 0.76129622319603185154 -0.45626126575899084159 -2.9626462818044445591 -0.032216032388034943068 -0.74399588160710616869;1.5080207686276707602 -1.7470842787063711743 -3.5507601197437974605 -0.09507996192486574405 -3.3987090330980400665 1.9012501446369489688 -0.14939802124212209211;0.25475737548948718114 0.34089639891603867872 1.6173069689287655759 -0.10297162352480421221 -3.2055815020186599895 1.6635684204474663339 -0.12128944955600992617;0.71976396264198294617 0.050286748289664923162 -0.95743456651970493265 0.29441038967795984949 0.73004962631710401677 0.42950274861004461568 0.80689689569664824198;-0.28497616007433018703 -0.15103460555660577769 -4.0785281977802707587 0.77040222253227308435 5.7232890322715306297 -3.0459853530245899478 2.5611514770737868751;1.7907706864336647712 -2.4194421694271608381 0.75378267384030184228 -0.43848662258932291635 -2.8836995911205125509 0.0024421322186775661425 -0.66829382882133681054;0.55662567726848299898 -0.60206416665193451809 -0.42132393821938407541 -0.032681463531527545074 -1.5459759600572087201 -0.85156378645585584231 2.9218577510048131529;0.31145150220398432062 -0.30767902641440014744 -3.8128588839550916489 1.2363486436191284401 -2.4784387606456377284 -0.0087090939127044200707 -2.7787726686847928903;0.22586537919452209788 0.13082758444587139213 -0.23720258240692906893 -0.39261317719292426753 1.9130055941830388377 -1.4502511774423798574 0.15520168539284748266;0.44640372348584200779 -0.13470120276704272699 -1.3597553387270608916 0.47712762174210610056 1.0472328729281736859 1.8702701756902870844 -0.36283944185839406282];

% Layer 2
b2 = 3.7115288355525364317;
LW2_1 = [-0.67086486785952081924 -1.5596024270918176224 -4.1719061810579542993 1.2079116372769256316 1.5222011192748412522 -0.21500627373756148186 -0.20969790020948506082 -0.17641211069666237754 10.397702938185299004 -0.12142084171450462371 -3.5654752835426126722 2.6562102597824162054 -0.19739294558853417993 -7.8010891267537543214 1.091796878488861644 0.58114535296537817022 1.5862986259055202876 -4.0214347555648481958 -3.8829958927495735743 0.7086696883619733045 3.7133383217177389213 -8.5497149386329986953 -0.11863939813725664363 -2.8131943462052091398 -4.5435321140096318615 -0.15645903878730621495 0.30445417019377546408 -1.0743878122107028972 3.9548453006937331899 0.4281850471890610299 -4.4464134047144741047 -1.2187617267497210527 -2.572887690429153551 -3.5260368151379632984 -0.31844736884763052975 4.6429095835645091128 2.2377249386427187083 -1.3063083726587294553 -1.8637670075293129024 2.1483690268576451921];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
