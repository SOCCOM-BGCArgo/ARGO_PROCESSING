function [Y,Xf,Af] = ESPER_phosphate_2_Atl_4(X,~,~)
%ESPER_PHOSPHATE_2_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:27.
% 
% [Y] = ESPER_phosphate_2_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.28;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0470499670650231;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.4787663987880761418;2.500337312154137237;-0.40789587178734199036;1.7099308368281926906;-0.98267882124398553412;1.1487536103301017043;1.467274396641021994;-0.18037421815932525027;0.010242416622255664377;-1.1551062358846151401;-0.3752586422214972961;-0.93392902157454060763;1.2826049584207375176;0.65671479187407466593;0.93509709704040400169;-0.6139966184956732187;0.015573674715990899406;-3.0675814183169731741;0.89335725381960517932;0.28026482908763550306;-0.59817462011209887596;-1.5043368500101681473;-3.1138488128302301838;3.2444154696710727492;1.6451602246350602865;-2.4289936470276063396;-3.0294292169104388712;-1.2235815988030787071;-3.317637575975816322;-2.6982608017139142476];
IW1_1 = [-0.856085624277343471 0.44964517881056581539 0.30316297098008604394 -0.2283005485532808021 -1.3370870953925579894 1.0509353107181167442 -0.80570299144566426275 0.22443387677430939875;-0.93790087865546223345 0.95178166507015837805 0.84847604077994775995 -0.27912024845516769656 -1.0407473617043707659 0.56313887220350822282 -0.74167280053702433484 -0.055697381461883153919;1.5089026548638435621 1.4658959240895688136 -0.33354785406194475961 1.0111413366185126872 1.5052148340530062676 2.0586782619564729657 0.056860574097026432561 1.3906467336877108565;-1.1322538282009193544 1.0808025459650458799 -1.7351584802481077041 -0.2371395921503140769 0.38279435927906391157 -1.0861463096579879739 0.79419655173703684881 -1.3493610894762912977;0.60128394785186378702 2.0568131445990731621 -0.77018848323086319674 -0.16062083540957936001 0.46701373133125517745 -0.68817076175549429795 -0.33229569060660363311 1.0920211256334775296;-0.31370481167519076449 -0.23155861997185847589 -1.2095013453798904024 0.05436074814835949176 1.2458157955625608349 -1.1656823761062915512 -1.6109687313691829491 1.9852432255325580535;0.19356966245093085166 0.28681735846402850454 0.77187229585890115846 1.2561448047978407416 0.42891476611866202751 0.31117896421138901975 -0.79019317727385873784 0.49585518466612632515;0.80613469056213138408 0.61532553845672532944 -0.17915282480770275408 0.47221842606285330257 -1.0584461373166214049 -0.18968468905182533923 0.17505415008701571966 0.56514974405385287604;0.32286477738679841831 -1.0643224444071341939 -0.36284438257740125877 -0.11739471268068830956 1.7267708119085041218 -0.0057844101340250708015 0.23199739147580619725 0.44951830666557512917;0.54374727864796035259 -0.23017042917890037645 -0.72704818618154021248 0.41285788662368222424 1.6482322258822006411 -1.5270765203919056674 0.19409008573507305351 1.2599335154865998199;-0.05483432516617021274 0.19113079904379384755 1.5046658008897653147 -0.20842518855309682957 0.62935469219093520543 -0.043131123938276651197 -0.15322838058810933637 -0.90712759804924114615;0.83220166173936405141 -0.1380971747462029775 1.6454325434010061979 -0.54027655523756668021 0.50413902200672622289 1.7093320623107275402 1.0291109147178276739 -1.1506122783347554339;-0.10762636685734879027 -0.81475351152220265583 1.6875525264000779124 -0.07551723163391059479 -1.4802269071103375531 -0.27820155648173139351 -0.32938541254901709809 0.56816839113037409525;-1.0080341643063506218 -1.0680624883314646656 0.29125700939564513892 0.071017368996202590026 -1.0707442525181338766 0.089427278165541634891 -0.25349860695442411052 0.92687633106475775246;-0.84750084762639643632 0.65749180911250459936 -2.0139972716594489732 1.3115744114478720128 0.75139566704663462993 -0.80767240691446706702 -1.5891218698273010812 -1.515517781438154854;0.25967924098545108746 1.2962988592245796582 0.91983420793298376061 -0.46392610386754373764 0.48100615115117206777 1.9274995062231887744 1.4783039071508548012 -3.0966127800257265967;0.96434782070944358168 -1.0596366508241703563 0.77877703517528895638 -0.57162873268378788794 -2.8285774098263658516 -1.4125057697705083459 -0.27267252396753072219 -1.4498911847844002665;-0.38317110850009999945 0.17401028866103185333 -0.097727943286743834683 -0.26111840517944356899 0.2545158280768453074 0.043146425250665622342 -1.6861645078525147046 -0.2111629189936369555;1.8472479042325093967 -0.096418185950684451302 -1.8225313663662170427 0.18440219693807111123 1.9927292727173409048 0.49144153161188980361 1.5561943686758630268 0.17483983165173810903;0.66438803699767978728 0.77006323293544987063 0.32610692456232143188 -0.12421279005409162355 2.1364642458286868809 1.3571226510986273972 -0.26101411726557327553 0.55105997141194296152;-0.077417842455267935065 0.20906110696240490232 -1.0639027653346011526 0.48240833240543534721 1.3787254671520943194 -0.51723038454324710145 0.22251562422770260197 0.5462856090880079396;-0.86473630504521536988 -0.43004984383863947839 0.035793711395193994473 -0.84392792036444930215 -0.20297710442723576607 0.80380671129228620231 0.60717033396825093039 -1.8632915125206270801;-0.80073269561435100883 0.67453289160469120933 -1.2407311367194997498 -0.97653988958984083713 0.030640065152643166518 -0.042774620999067126947 0.57682729088822826125 -2.2088898197217097241;-0.06164005732681471228 -0.79071579026755522968 -0.83309343403064273215 -0.48006659613483859683 -0.8327067044138516394 1.9694789661265135194 0.75239625204799476244 -0.44056646340043070786;-0.48033902819223489589 1.0812659260126193939 0.02572647890929686057 -0.25258879391475774767 -1.0277653845947858358 -1.4876556443904318527 -0.97172979333997078211 1.0383797730376496116;-0.71764589138829182335 -0.79889083695210016955 -0.23567850726262903893 0.069183066800805589902 1.127388228366658085 -0.94874005627588464673 0.42785078287286487653 -0.78348457385447511925;-0.40301795162109377291 0.97105118348504992909 0.49285395428156536513 -0.0064167665745041369343 1.4376468742344503671 -1.0647551567036326325 -0.82712365701038847998 0.13509769582514977171;-0.18521620690120110808 -0.27137234572588608827 -0.53743682869033138072 0.096183519847714865625 -0.72499385449205344667 -0.61440870721299944979 0.40168322909838022339 0.67609295788666623483;-3.0079843097357255033 -1.2340226609492037646 -1.188010936302082321 -0.683973847013041647 -0.54337863084949267201 -0.98601093700034003753 -1.0547151653718258579 1.0626105875443645488;-2.7857362730917065718 -1.2554526724673711335 -1.4017680184671712507 -0.91183167949225640836 -0.71644428546098271049 -0.8378120701542480786 -0.64317816574866237822 1.2873274992822003604];

% Layer 2
b2 = [-4.1129204912600334509;-2.0901881466433631651;-1.7888556830493043126;0.3048553284956379561;-0.84158642699560881617;-0.7231754790925150056;0.26612043163482551611;-1.2400692406064266482;-1.1701803937560184554;-2.0191731664458525408];
LW2_1 = [0.20664293938809075168 -0.40007772782498185471 -0.26999393547156086415 0.21908805258366301216 -0.17718973684594838125 0.10665005427576662589 -0.0055814483268075542471 1.0029825318954477265 0.87813215509876063614 -0.018971612191642922562 -0.26636970652234831514 0.11118016521630842697 0.4485805138274412962 -0.80077991370409307148 0.22795766291832753048 -0.23564560722021699046 -0.32263241756499161372 -0.57713636888013464254 0.10659791576675238522 -0.26993563874554149518 -0.85217648963283276764 0.33835259965428615692 -2.2367396059030202338 0.30516424845212913874 0.067965083428646461128 -0.78860118306979987146 0.57083692506028482772 -0.72938035234089293457 -0.55827770467331327975 1.5882805642675645874;0.090777885518089018735 -1.384935089339767611 0.19846240831793324211 -0.0090338384380599812823 -0.49226524446139807711 0.28850536042618774024 -0.063100623281578130386 0.1186157545235827504 2.1741473235915695916 -1.2181429909107406306 0.46333690629417534357 0.36614459150276451593 -0.09300022584146142024 0.38260995408151737829 -0.15508064007645327997 -0.07058783213020669578 -0.031783567558369391071 -1.1137856615734009758 -0.5467187197338871929 1.8434423254479210819 1.0148909956240330654 -0.35566198505805651786 0.61439400815721711968 -1.5399968165608206583 1.4368615986262696094 1.9975247373195068601 0.88892430644845255028 -1.3006458392123689816 0.33266683765679627705 -0.97413157085833734783;-0.68181564876458988778 0.37927175711931437885 -0.35569928311227339002 -0.5493803722987100624 -0.50279130866969790059 0.83728546800835135233 0.36988915670873961927 0.91953759534055923286 1.0457450239469556763 -1.536414229730186376 0.19872751745519209865 0.808183480341457261 0.41158099810684706243 0.076058708350712544988 -0.18249648288986355937 -0.66537568503538224718 -0.37119711848521219633 -1.1777168157327868592 -0.56512834440867765196 1.7936575006110608843 1.0353357068294910537 0.24397065029279041415 0.086131651924029162259 -1.6508445728213732018 1.3188955515709608335 2.3253466771548625402 0.4775391600203538478 0.090003346579013182582 -1.17927333341942564 0.46725157414260332089;-0.68732852484274231664 -0.15228064804656002429 -0.33299994007553601616 0.042496383869975305758 -0.2399676772667324598 0.31142545084545358858 0.42958267303159880512 1.2602667786862913335 -1.5178315719745723023 -0.78952548305884717728 0.098472099181475925 -0.4600678581530395217 -0.47598919405969997154 0.95571275925415144492 -0.38426978388202670534 0.23890953502614845072 0.13423324472724906808 -0.25510687874253734631 0.38921997247841338963 1.0427178866105071275 -0.51839687629793940182 -0.19714730064132848786 -0.1786826447516378924 0.51020621613097061342 0.070700307268818735063 1.5381742752506835092 -0.4934719361488684175 -0.11114447293534054917 0.59389899547063751406 -1.1864408397007333296;0.22747162651819965995 -0.59966344264690663035 -0.41366415321455918264 -0.18149334003576819696 -0.07649463587016010202 0.20359203190060323752 0.65851016066371004243 0.27505759980391381037 -0.59834078637329579653 0.08862513367771759909 0.23795670586390579859 0.4168430494880771553 0.11415196408495016656 -0.65609807008550824481 -0.035540764045428975548 -0.32866630044885075668 -0.31680051542120257757 -1.7304173598238010712 -0.41231612417560864481 0.033773194517460761177 -0.093724274832803142199 0.40721154771138801109 -0.10528357693702700137 -0.45636542374841093661 0.40190093628924095093 0.3117342546312328877 -0.95905257391793274913 0.85919574698783263145 0.24195409791251504261 -0.90194444182019084533;1.3391753810723323603 -0.60382569716081513356 0.22810711994391122404 0.48174185473806552249 0.55358277914812581422 -0.94452071740813059453 0.21215944854528229202 -1.5985331707195840067 0.2543902629539599447 1.0742245357981263787 -0.38552830254369929719 -0.3190944219133843851 0.46168994617408343206 -0.24711335184707239332 0.012279161952838150637 0.054082773371318677846 -0.23531363721194964445 -1.0332260504706256565 -0.56260417205929080797 -0.6824751382090852303 -0.19450571258244034323 0.28028315104692508308 0.3158143563536362497 0.50048288154802411665 -0.38518793485146535227 -1.0139396926983041958 -0.22307828670967486118 1.4023399034359060877 -0.36231194088090595828 0.12064107700231951892;-0.3820888501473342358 0.65934416616354873941 -0.28597240529779538454 0.77438969696801396303 0.48037217680542892984 0.013920973558366408346 0.4464270882333339352 0.10152600968099539935 -1.094080203645753091 -0.22249360073990614994 -0.59241192058320801817 -0.56877348051952580921 0.3101845337506906608 0.05162924539168926158 -0.22694073212664153671 0.12882956673046661034 -0.14681419597772793484 -0.078665859537209087415 -0.16350244066802976928 0.036087187985511651189 -0.51307735050168634672 -0.082322110626022890201 -0.012013542640898929731 1.3298529262739857693 -0.44716049094043081036 0.5429396786792488605 -0.87174474405674817756 0.22197457972267861659 0.33313666313166745425 0.69477856707980190087;0.10720427386844880169 0.69918287301077075568 0.62424281273593840158 -0.20072381085003657142 -0.88413882302726998219 -0.1235278394745788072 -0.27767304030333522791 -1.7959601837071548225 -2.3943734891817731736 0.1231666724535038504 0.44125439663932419787 0.50074746869601449717 0.78796807575450900085 0.058832826262197823741 0.51046395286097634436 -0.52437739295077390178 0.43323499635030510158 1.6935715208618207228 0.26169453429005884448 0.22631198014047027023 0.69040039524997698361 0.87507275028990239019 -0.97295928776262774473 -2.0877512740070884867 0.56558299635545228323 -1.6585336305996465356 -2.7740221219610221581 0.52739773857612859409 -0.44136122478425510174 1.0454411201595719128;-0.41769624237082486617 0.90806317953338644422 0.58808884241350201094 -0.11651898688485007316 0.1639571095019086433 -0.53642074220050839362 -0.71502766206304824159 -1.3773976107105232458 0.52315452254588001857 0.10996964952563498263 -0.24636722379288070184 -0.8971574240128928901 -0.20035248632938151836 0.9145044721431662138 -0.11758087220861614119 0.35462961172921170228 0.30941448497892987124 1.1959754434121023792 0.69023643938880230309 -0.32332289597341878906 0.076077150371218468794 -0.41684713514340893115 0.020618689256468702986 1.8928124393717524754 -0.70936379111179292956 -0.87030133493303030168 1.1708882765989998553 -0.92096829385135403623 0.60299979702438011309 0.33817891906867775242;-0.97526002736203787347 0.39699395162933015513 0.25314765762677554628 0.77376448222298899182 0.34428631851946350784 0.3343608709879350438 -0.044344847703166968833 -0.96113626757285364199 -0.65596237606593199576 -0.80855416599793339394 -0.2666299785342464701 0.3571206882008403638 0.39245639427592782233 0.21454544769964351003 -0.16821837308423751023 -0.49568531420792444342 0.41176428354880911797 -1.6688675213171229039 -0.48745900826477572831 0.69134583046126163453 0.87388593065585074005 -0.40101220020685274248 0.23039626600249901722 -0.70129755306123220393 0.695890121519984306 1.1768699135457056926 -1.4059781791192433875 -1.0184637443949349223 0.16479675007668184716 0.56593747842337704945];

% Layer 3
b3 = 0.92844928282568994771;
LW3_2 = [1.6432297039647043579 -1.6173839969214061085 1.2479445048336545998 1.6360512792339978461 -2.678589852251926029 1.3974640288539401656 -1.9363003501922699812 -0.59743849314460550914 -1.7518598570117123181 0.92006258639593641036];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
