function [Y,Xf,Af] = ESPER_tco2_13_Atl_1(X,~,~)
%ESPER_TCO2_13_ATL_1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:58.
% 
% [Y] = ESPER_tco2_13_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-0.2178;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0461352500991908;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.9519185907780532;-7.220912724736352;-5.8353603985441591;5.010762844826667;-21.952756045975814;2.2109468875971876;2.205769781834412;39.384376522337526;-8.0976013963337294;-0.35077674436363349;3.4958130143394803;47.546370244070225;-4.896299973609616;-22.279032658324375;-15.773926152472024;0.49432484987469416;-61.989574477376458;-1.3119878448005211;6.2763198156101199;3.8443747117667062;-6.5721535076337814;1.668348234546067;1.6494704069254096;0.45630406885298325;-60.458515324737036;1.3627287972032389;-1.0395028541414564;13.233665367291108;0.67468102945003383;5.1970711131035001;1.4431941679544014;34.673727880529718;2.0548075557256107;27.888469704659975;-0.31453577439418884;-10.279389379958829;4.9229912210892151;-1.6270900540764495;0.082681626019729934;-11.598070920709448];
IW1_1 = [0.35970047635541458 -0.042514258237754163 0.86000005921927458 -0.062452921275832671 9.0578656916532179 2.1764408779676114 -3.7913783986339098;10.725308335469817 22.58808294412017 -27.241276602018416 17.870981864694535 30.80695204672012 1.3956686751940923 -110.35589333961296;-0.028259343551473828 1.7952753743373275 0.12002239924284322 1.3571055948535415 10.645895211912459 -2.1377078149304478 1.1037696946107227;-2.3890936235004743 0.82570663787976351 -1.5414580531483351 -2.9662527087819428 -6.7538576338395249 5.5102649975725297 -9.8445671519813089;5.1815347241448535 -3.5736023388938531 -3.7789218393407142 3.496974739026669 23.695771306217811 9.1461994491733023 -4.6989892426272153;-1.7822890268755109 1.3700838349072244 -0.0943524151003549 -0.9406980096624169 -0.82146962596480499 -0.78594307837759669 -1.9999040598682736;-3.7605468767338328 -0.20321002146317962 -2.4728245316226549 0.54080632631315306 -1.7827142247165311 0.84996545043010008 -2.8653972116007678;-3.8730516231082674 9.8813684205294177 8.0287899855473857 0.27965796500867002 -39.528106361422047 -2.890046795513693 3.9728182811637822;-4.7005474826452502 -0.12163071288923831 -7.5225179876723169 6.5699422306073538 21.794269981905984 -8.4952663324583959 4.6286640094338658;0.18452934993355366 -0.18516634947167104 -0.18443777975880982 0.14570556995499603 -1.0118503907858891 -0.41933689025622439 0.15302227770590973;-2.2863986543727299 1.4596902416265385 2.8291400949422734 1.3545940950021684 -1.8400707663799545 0.55084843447674436 -0.069053779791018302;3.9658877963412049 15.810660070969426 26.925948762168307 -27.800451306488959 -60.32632686547548 13.472137711887225 -11.716145210108973;4.2338248279825414 1.1460950719655509 -0.92771361406470698 1.5308955464742533 -0.91743292854312419 -2.7717467660887243 7.3228727976705761;10.872587795806313 4.0914446856629301 -32.110956728710612 -25.456689182478041 -7.4364362291364214 5.6331189445058714 14.072613717931311;-14.716429295974818 9.086944853779146 7.3181912730642376 11.371493038147765 45.796444025612786 29.666631010734971 5.5069935469882889;0.78499673460599761 3.6082507029494777 2.6052119385234787 -0.758581605283981 4.7494076947567949 1.5113410502830833 -0.55690218665903435;-1.7975776934426158 -28.974782574612988 47.7492240356544 16.952903825959524 59.414729662954308 5.1171519183791681 82.37437403142232;-0.32881406537722491 -5.8636398885533385 -10.066991767262477 0.2506768492905499 -0.96434631230280465 20.349179024955735 -41.188452998653041;1.5576034244500685 -0.29661234573257889 2.9775908077103654 0.79166982947389419 -8.3236982891039908 -5.0988284724619417 0.40107339569031814;-1.0821876567941917 -1.295927321755487 8.4234718841553029 -4.6060348559843103 -5.8336673732905115 15.870221644280596 11.593848631749333;-3.8189685976721854 -4.5050670000611444 -1.1419119069175994 2.3013243531476157 7.4377067598839677 -2.6547551445422308 5.8756474925714839;2.185754208490692 -3.2796048472175094 1.2759310459202406 0.18768811673982583 -2.7981828434128651 3.3182349270932185 -2.3614240134978619;-4.5876930068097055 -1.8799159147469964 2.8294055164015099 -1.6663649995990049 -5.9410200789250194 -2.0979587508608133 18.454286917006485;-1.5010462950621224 0.020475533150745392 -2.2046556364547438 -0.44392323083907737 -0.044190498867430907 -5.1698966081758249 7.6150526474652098;-20.306020966677956 7.1288845414554185 6.2627922035476704 22.9754211149199 41.015071272487134 -45.484070715112551 -4.7442994739341113;-0.93319568783388684 1.4773761704979813 0.77205897504360832 0.41520796355921769 0.60544139106808381 -0.11672825685041868 1.2776515544764309;2.5017417181658028 -3.9840277057188391 1.409923422708852 0.18138478792437565 1.9571896387121304 5.3700138832668811 -3.1734442895202042;-2.3769795944841854 -0.64464017609111246 4.0110416164891118 -1.9592860012264364 -20.643548712044108 10.755198389152518 -6.4618967394030058;-1.2251886138790462 1.6431128507547894 0.34907590049262643 -0.49686692746050887 1.8914782379237853 2.0373061013792255 -2.9238945180595879;-0.35735400996457234 14.60382426599026 -8.9649190374863501 3.359673153968056 9.1906312099639713 -2.0564882188898856 16.901176889166422;-3.0095244663398786 -5.7131294251015516 3.933384674354933 -2.0904675892948559 -7.9797458433285433 -1.9710554328676653 4.4580545603940678;-3.5655466862291867 -4.5667874495938676 7.8543336568494215 -0.20677450688955865 -48.861343332956103 16.781111971131399 -19.510475917770503;2.1280562431991776 -2.4570348991546558 4.402943316360072 -0.41761451982321057 -2.4119473526275272 2.2355286480999141 -3.2654463417314936;6.8669549146952189 -10.586206334169917 5.0928264344421788 -0.95048081710115595 -52.825693121587804 -7.570123486149928 8.9596578684428394;1.1370677057005727 -3.0865119427428125 -0.21239178813480036 4.2649291221116847 0.21906119305116656 -5.1299535470856394 0.18456911926184552;-2.1023447405550102 0.72043936040680312 -0.29484519053906399 -7.8821278161589499 14.820162454409378 15.092285996793764 -17.632939004281308;1.8358676541347545 -0.92302483694636195 4.1210712945017871 3.0645990577275835 -1.8406810208367717 2.308003522869178 -0.82832201130780336;-0.58449070822947402 0.74994565088264931 0.54205971335286052 -0.21471644188262445 1.6661252339235448 0.60820465422492576 -0.035758225188632344;0.28435670839074928 -0.32121956613371538 -0.17224865056283942 0.11563128557337501 -0.55466703979867715 -0.2763430776848399 0.11253759587170363;-8.8946236621246015 -7.5688950776853661 4.3440038442449058 -1.2169555679244477 15.933169631135122 18.245155420757424 -8.0009422229363985];

% Layer 2
b2 = -0.33658142500321364;
LW2_1 = [-0.047016835554701895 -0.0018299679108590267 -0.02872840329074745 0.014972432257283544 0.00010490342286888868 0.034359138301319939 -0.02089493437608413 -0.016401970570739569 0.0068268950245352596 -1.9945097326886425 -0.024386901229541208 -0.002247355374946673 -0.020439592814027508 0.0006650447121896285 0.00059186230412645402 -0.024428583491580804 -0.00015676679989727336 -0.0039150937850409174 0.0052641355277924188 -0.0015897518841597629 -0.0069088910916998 -0.11665580932838208 0.0017208268475781706 0.018033677759159084 0.0052396701183484804 0.24219149311361945 0.069696807100809846 0.0060865050997988982 0.098338644764606353 0.0052373093929014864 0.0035339348179075159 0.0045990220167680326 -0.028673987005766496 0.0081318244610110654 0.0061013000169305278 0.0033444903435620931 0.041661287355560732 0.48687978793977277 2.0820722012228523 0.00070418352610454279];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
