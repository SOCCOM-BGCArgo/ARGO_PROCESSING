function [Y,Xf,Af] = ESPER_phosphate_15_Atl_2(X,~,~)
%ESPER_PHOSPHATE_15_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:31.
% 
% [Y] = ESPER_phosphate_15_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.8462716306503170749;-3.4833789535973012086;-0.90276203215467887286;-0.79015610479011511025;-2.8408733751334116491;0.81709681725078819881;-0.041575748839421500236;-1.7990904453469664936;-1.1211899222216021865;2.2138524022657009027;-2.215984836748616793;1.9721456111954716039;0.12954827161766044319;1.9818109947628568257;-3.014165965259944624;1.5662891654841655242;1.9310787924079297895;2.1158263955154912317;-2.8292279174692018806;0.9386264353122976134];
IW1_1 = [-0.43404628396275657387 -0.096895585444720835899 0.38923423912954291382 0.055177984411833864986 -4.2061527362532205032 -1.3148376198392952574;2.1481464316094087685 0.45534541116545557138 3.4387252529380725186 -0.8161512665002284006 -0.94178499696414752496 1.0153839644011675158;0.86255435992618145757 0.94152690494724888826 1.6446225353217189813 1.3440381686058844313 -0.64000890356161066475 -0.14542704570294465172;0.34968732168023747287 0.24519570203942211983 1.0839284823522163936 -2.5617706478433079909 -4.9011120645961057107 -2.0191145223429063371;1.2580267118446621932 0.073484857720707286166 1.6310502107647462111 -1.8150162176758906085 0.29954146514625151765 1.2278483686868746361;-0.22137252853580094425 -0.39350599546838976872 -0.74004671895621321198 -0.011843060316310768249 -0.56845933017911720597 3.3387134387500942978;0.74176298636661330832 -0.33802501685750807603 2.8875976948781976184 2.8447623246138831199 0.99126254850229622573 0.66108234485826078419;-0.69233083952132268291 1.2951511747068265024 0.49090707495245650138 1.1596694174315946846 5.8726201263342421299 -0.022055876282387486959;0.31604889140194292185 0.18660240190600443921 0.29632767162792228444 2.6755445358648626275 6.5344075947865452036 -0.5675229871899970524;0.60665034901927727962 0.70800662804663616612 0.0041079850967403706841 0.98215014515139287266 -2.4514381876528248405 -1.3256819728343243181;1.6809672725215001332 0.24492511756412066459 -2.7035349948563096589 0.066713846889739830681 4.9265931457925216108 -0.88740913828808398733;-0.8186475334839817819 -1.5837402647205525152 -0.94027064323566567072 0.89342911149319537145 -2.923184469309513478 -0.75265337068748194849;-0.27362728272308461941 -0.18092749141975691951 0.38025282979559688057 -0.10511480509500070735 0.86470056851517962393 -1.2953088703323587527;-0.89496290064561356825 2.1935492773801468225 -1.0834078155141366739 1.3180668506667645445 0.035002831026969355444 1.7367896614266264965;-0.96030963791055856671 0.66154606344596045275 1.6052401536927169978 -0.14868192897767679161 2.4668714723074209871 1.1360089398048596188;0.18007510127033846126 -0.67200836645917694234 2.6599951264968937359 1.7222697263558308656 -1.6446172589782639406 1.9632265391267689214;-0.12446413303313894061 -1.5457625354460560185 2.4656713127638130167 -1.1767973857559435036 0.63793093293558800205 0.44924009969155864752;1.1385481800074528369 0.19535661930488690263 0.35906273460825932631 1.3331170083550194505 -1.1853702813860740317 1.4948567696746828393;-0.42351256939351966668 -0.10745173319146662794 1.4648408072601297736 1.6388304613410140664 4.1863598750884873922 1.6064111437885031375;1.8305731400089861882 0.74179322209592724047 1.5129188115209466492 -0.018453191917669642397 0.89062287499333669949 -2.480932806660731238];

% Layer 2
b2 = [-0.86119279673186244217;-0.99861383960339389354;2.2729301888982247348;0.91085878256227437166;-1.3051057372823555713;1.1827556936551821831;-0.61647802240958271547;1.5549514893121301196;0.00810153365940090818;1.1869873649864899345;0.032673950285842592867;-0.02205091590025489573;-0.061724061683529660161;-1.8943943272775567443;0.48756009955899404229;0.87672037503348454468;2.5100898485909044489;-2.1155505211401792742;-2.7545917647946160933;-1.9929132362030479442];
LW2_1 = [-0.073697779148142350536 1.1530511955433289106 -0.57088359197141003154 -0.26212176002321396773 -0.43387390067359210555 0.14413549151478632915 0.7055404492305372699 -0.14171558171559131556 -0.27051529936574814084 -0.39112137229623078483 -0.9271266983469186318 0.67006995428428339778 -0.43214867973321635652 0.12936777098584995027 0.87830424866593781452 0.92746379112402010936 0.88591271049046116381 -1.1723427252572991009 0.23958079101024251645 0.4562912288515721948;1.6102912823475750148 1.1602069207180891741 -1.2080250528653149189 -0.47876466112519378004 -0.18512240543579203123 0.20758745915423681971 -0.94427673723243554793 -0.54014455308772657549 0.87967295854501659225 0.99334030621066271571 -0.11647897060889043919 0.30494784061201118952 -1.8516629342273656089 0.013135536557712025607 0.65298059047860113058 0.46935005532732615441 -0.63003406073056200665 0.2969129663012350373 0.069329057036922103752 0.15926080267180522942;-1.1696093775844296214 0.38253690288850422663 -0.45289559632533127331 -0.48450219294120205893 -0.37735128383103744287 0.090605660537757495843 0.28821731994372884467 -0.62461627551845588791 0.46419829077831298303 1.3921794550591721773 -0.5742549039306283909 0.27570837368661771372 -0.12362921627967997373 0.096629333038917950005 0.12416521430409913074 -0.4944939006226775069 0.8026719052156678913 -0.16145066949508526943 -0.09900509795172507399 -0.22615374889658715341;-0.22457503680616011654 -1.4634781154595335462 0.19517774590932254752 -0.85629931700326955557 -1.4630653766965930895 -0.44889338113835081101 2.9139666645689672464 1.8816400714835055386 0.34190002679973036104 -0.75845949490306874274 -1.8055698694538766524 0.62393003155261295145 -0.88797191930143026806 0.83749625208465827697 -2.9638754467982431073 0.2577041988477810075 -0.58448778114318200583 1.3055342357504489126 -1.6682398754920610973 -1.7341988598227366936;1.0577847074043480458 0.49119210306236521513 -0.072680586474990843682 -0.58278750338180529411 -0.01868706230207350244 -0.10897187236290972745 -0.027797012804979398526 -0.079468534531147952404 0.692028221336114302 0.076820975067483435184 0.29993469198218963845 0.2163665743017009202 -1.8747867311986960992 0.12455196357815366548 -0.34077199962208737372 0.2778016604755425556 -0.0066437335495000415797 -0.2780238913427887093 -0.35114836355291190184 -0.17771525073438443343;-1.4436761244927360792 -1.7252132892289975263 1.4034878385210265428 0.78344324472947568516 0.63197008611375748988 -0.43410976709927850958 0.95654974220534827456 0.54253976964472461209 -1.3981021724609283829 -1.2784220955572280776 -0.23456167071431488491 -0.30014076372745657206 1.9796253746877763291 -0.1734743521652696574 -1.0258541115845747349 -1.5542741516127871471 0.77425066439712864064 0.49661071840633219665 0.96698573726848358056 0.055397263315487728363;0.059511661217980051097 0.021669572643140903173 0.57693602589329284758 1.1919918994717824123 1.0146706793274371528 -0.57425434994885815598 -1.6033433683043867291 -0.079315317069522842108 0.57295962348380291562 -0.31023991336801215457 0.80781400308555884049 0.3871562076418871845 1.7548136708501880232 -0.28837618259319230951 0.42799920226691878788 0.60746941306727897381 -0.45831820927384636644 -0.33691625940467995193 0.53909792214441820679 -0.15199821791151127415;-0.27993832606803970009 -0.80995058105703954254 -1.0409738008043196711 1.8972750597415357632 0.26585697333346575144 -0.43627536632861063648 0.2909185170323557168 -0.71374127049583580007 2.0703850519113355944 1.5601039394423439344 -0.23823000069012228996 0.56808376674544258655 -1.4026603542652491541 -0.98607447604704190347 2.6708405831831605326 -1.6039220339055877407 1.0999071151433774673 -0.62002061737161195953 1.168634952899292756 0.4488263503204016347;-0.028320395039965893386 -0.78141522639138938366 -0.081993973737183256656 0.8368448878282940262 -0.14884760952281758661 0.61256123972979004133 0.5145919283074791295 -0.35533159824084431522 1.3760014999982113082 0.52324396431508146676 -0.50119413956416047906 0.0019309565768823859933 0.10723609314950663385 -0.15141846666928387988 1.0552505556649738327 0.30497588959654858831 0.87875853590164032525 -1.3327692804342035071 -0.56204538499875822399 -0.17543382726979531161;-0.20925761637867143494 -0.18708754431353319392 -0.89340380931265328535 -0.027885720440866131054 0.066390879960451565367 -0.15439216130625629808 0.15217966628909623816 -0.35444862663105697331 0.6951493309878677973 1.4422008935707761879 -0.1135175570087876562 0.76360326002214506946 -1.2163656416467691912 -0.026790265658476614119 0.61087766139659760434 -0.34053094513356579887 1.1018742905699190349 -0.46424337508115187667 0.67364540997541544343 0.60738385202694800125;0.29376671828451739188 0.20985714984790360127 -0.39985389152412514902 0.4649949318251683783 0.014796913728056675791 -0.2888914142081073777 0.32644631052721662101 -0.26090772817532315031 1.0267173537985900822 0.57529572064192580072 0.20996451828550508067 0.22683761412972722193 -0.53365345702861677335 0.010512469219980790508 0.66287216714486918434 -0.11526572877870058798 -0.18005715806954650238 0.38863886900735022945 -0.45284820501528733061 0.13606764585411579294;-0.5947258744700200106 -0.90275533314869960133 0.34229568818416011844 0.69892308421249149664 0.54648897682938724074 -0.80044603634406552573 -0.054439383093733285934 0.18697747275412468504 -0.7881837314220236923 0.42532492039272440376 1.138888239400047464 -0.021551338694595335854 0.21504544283701992891 -0.058489377158953019531 -0.13953471810748044324 0.48391359411397411039 0.9102215740033808844 0.55804457938873608391 0.29855026296631559379 -0.16966632450831131695;-1.0267373162772068795 0.24851728827719596349 -0.12233197422435060364 -0.84737245179463394074 0.14855954684644706587 0.058201717225117015342 0.27154514503350607457 0.9948530402068964662 0.37483884120787280825 -0.0043637708780869099295 -1.2852228987950624628 0.28640253434935342147 0.98309770711061250648 -0.67611165567411601884 0.0055260697222132837414 -0.55488413258341362511 0.035546938712720188569 0.67177358782654683633 0.086951134922682624118 0.33893764390610225945;-1.0174033569489835394 0.29684119247259849184 -0.74924561359661900894 -0.61956031481984641385 0.17504979819602195512 0.140477245769224518 -0.28280385922777145913 0.92503361799944772148 -1.4940686667484659456 -0.24611624276356133811 -0.71208236058170204519 0.72068048173488741259 0.92928945142278696068 0.43182071252805909189 -1.4058364690257825202 -0.070364198697922791803 0.20164772944253600562 0.55831141857280441876 -0.022894041596957809964 -0.19469120291064637152;-0.25193820773468855734 0.042482848952740168147 0.71575499738437764474 -0.21578033416194453142 -0.27294580906149434885 0.071772588404660289663 -0.29593231960762123034 0.93205158071839555589 0.24544341419559850825 -0.86075798847905338196 -0.67466985120517575236 0.069808658677252333202 0.23264824095862962627 -0.0049678275647986715538 -1.2927529906278762972 1.0755325653632847871 -0.56589122811314407357 -0.17770250749615287833 -0.15965966544716075903 -0.22189607848061798645;1.1953031442497974446 0.46650960022745491251 -0.25495561141958344997 -0.096485275459101085826 0.79686627482843852555 0.79441576669813196432 0.051100988685214204787 -1.5749239001117987247 -0.18151796880449727611 2.2114799889252485521 -0.8468820691177851856 -0.067775975031299659501 -1.3382652652588118425 0.085002786095655744059 -1.1973789602618047923 -0.73327374712560278169 0.68808342488585383379 -1.8449947420645274043 0.27658062766211721772 0.087338592785656657402;-0.90655526196363089841 1.4149640097901496905 0.53982615700191149966 2.8312596346154283999 0.57368915871758674463 -1.1162174075652349092 -1.3233749906452028089 -0.088948548691766840535 -0.40708122903767440803 0.10479949494067249127 -0.88103325331003845555 0.47259451046371703242 0.60079611713051295219 0.61947487563984771075 0.37239897221925966075 1.0775522631552647557 1.5960489178618699757 2.1158464460630241888 0.80263162565432089046 1.6286425395812413885;0.17274998708080474552 -0.35989531755494291732 0.7960175738451871208 -1.5017187789473271931 -1.5170675516576805908 0.37015434548089137801 -0.004767380546031379715 0.84308517740406752061 -2.8663680210388351455 -1.1547901660290791348 0.043700262923898398892 -0.040823396253486674001 0.48153244701975578268 0.4475767116582927696 -0.69819281666951515941 0.43706341304305323936 -1.6842917652140902973 1.073804847103380089 -1.5109605460091040108 0.48526536823805621612;0.85453252750107777658 0.24616050671467831767 0.7523459144581384761 -0.92428269888650560482 0.26491096835853750191 -0.32680113815275280142 -1.6158482884758789133 0.94082577676631751196 0.48167332237601129252 -0.93992342467417144825 2.0583002729338488734 -0.82617647820846407125 0.96537568930459982663 -0.28215144448050255566 0.025268563979876982467 0.99096507105692932527 -1.8296246073577175917 -0.57515987677468305428 -0.24837418652851017686 -0.67565977210559036159;-0.83256624062760908878 0.58428194543358979995 0.23819029243728281897 0.79783154175477777326 -0.40658665903984297918 0.43384480393101571005 0.64233229359900656519 0.35874388090563746889 0.24543578681378261375 0.41483520257678296872 0.93789731052171887438 0.033447303669497260858 0.6969071924856975464 0.080813779952729022926 0.23017214949237493893 0.51098366461323163623 -0.52145628122400144999 -0.30720242061631808372 0.26367882948915205565 0.09357584499439425274];

% Layer 3
b3 = -1.7160390285600228832;
LW3_2 = [0.33907277072038799481 1.0713666944338651188 3.0658680338153145861 0.37041095166495258129 1.8420830352089050397 0.63827396063094121725 0.41123702494746661174 -0.24988309534477978757 0.51284627145026939754 -1.1441032777701445333 -0.92285253675680445351 0.44121903390106914644 0.49951115936583356802 -0.50660523157760206647 -0.82967278427539659091 -0.36954096740158359768 0.16592665208456303105 0.2584095611051328012 -0.39776813776312025528 -0.52529238634574126898];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
