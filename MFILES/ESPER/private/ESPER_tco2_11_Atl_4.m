function [Y,Xf,Af] = ESPER_tco2_11_Atl_4(X,~,~)
%ESPER_TCO2_11_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:57.
% 
% [Y] = ESPER_tco2_11_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-177.232103709389;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.79064193995745635;1.950803207832928;-5.0277649412752456;0.14555535563875516;-1.7217556739036952;-0.24351586528820948;-1.7448392800668606;2.1523801623942358;2.0687835359385973;-1.4348682602331864;3.4682580708035409;1.1645197260009437;0.46584799000975363;-0.77109175726893631;-0.53862116585355124;0.49548483686226891;-1.0508067485418566;-1.352110641023657;2.316977070904787;-4.3189897881496977;-0.1911254970841125;-7.5614858195513701;3.0812164906879751;-1.6877278900753687;-2.2946704539358866;3.2461360120831135;-0.40255370726941969;-6.4994240277576898;-4.8664797605724681;-2.6580231591526999];
IW1_1 = [-0.40521337419353931 0.95486201917449187 -1.1949154784088585 0.86923557978765797 1.7106390206379811 -3.8054743931007011 0.99861745505082933;0.62718864662161444 1.2257336148604732 -6.2239336490066597 0.6945799203083507 2.2240048613911716 0.30979846205964218 -0.98339781597996212;-1.8540866422044298 4.1289772500369661 2.4744225028613247 0.0020891175336728417 -0.30919759234788941 -0.28050281268536603 -4.0246608253727629;0.38372415999954329 -0.80122048018918857 0.95803514238183174 -0.83119125636324909 -0.76564042799799292 2.1995632527691842 0.46541940867557963;0.86104601698013461 -1.2848720503543429 0.31331389703957585 0.52730809373662046 -0.69411237073648169 0.71881067521560815 0.47826979948519904;0.61141455452776039 -0.16001094236062005 -0.83030842393730153 0.77008598592981237 0.17866343103177276 0.50914176823616675 0.86490735150465836;-0.42684611863344479 0.79172383849853922 -0.87510648980314887 0.13161093323981221 2.4859283704183683 0.45773770994758611 -0.51366614818788403;1.1777767178415015 0.23540991886826076 -0.35414808841540774 -0.53510855483445774 -0.22003703385287224 -0.402882262644917 0.6363047563488855;-0.73549577595326143 1.5439051474448091 -0.42130129773766334 0.96124101903044001 -1.0606575318303464 -2.842311525967026 1.5125209762905538;0.75493751221366601 -0.1387076473022662 -0.15993588820979751 -0.6571789518892085 0.79746183485511157 -0.36514151435253528 0.12169134296795868;-2.1632568015084037 2.3910937049703942 -0.94881204382137041 -0.66984350013817284 -3.1581888521130459 0.30608384602556293 -0.97627381226297028;0.16619254442903278 0.10189868948460311 -0.92102668961609724 -0.38432741634678946 -1.0682320809533976 -0.1887682025395131 0.17962644854937646;1.3890942233961987 -2.288960851043536 0.98006697251036856 0.50934366487052163 -1.280373693936286 0.099072758688986753 2.551601087065154;0.099425831686287061 0.80411744819627862 -2.5433513775761338 -1.111768438540111 0.40998430221674087 -0.93514907762454869 -0.43024630651956891;-0.70638809101513145 2.2667293906596346 -2.5464655789405688 -3.289225887023894 -0.6544791282389314 -1.3130865038864017 1.9427083832906855;-1.8282641854256201 2.9246399631186724 -1.1829876069224856 -0.28104899393171273 0.30206819539045304 0.41673731999868702 -2.9094368696574211;-0.81882149054728304 1.1668867056284011 -1.1749921325954322 0.70506388640115059 2.1488909910740706 0.11433963558193716 -0.38855333470035636;-0.8295088087363256 1.8891103332036172 -0.72433075825568938 0.31889333815930371 1.5163572644476171 0.33781568676724916 1.4514707872719403;-0.23732466446500261 0.14767998328109877 1.9016998932385063 0.34376154940192705 -1.8319775259422195 0.099665808180875587 0.57766168981357913;0.81562627967329648 -0.41237110497967622 0.078987883137068518 -1.9445496150350339 -0.96014724565531051 -0.97976919312986444 -1.1760240494371326;-1.8736332715756407 -1.6711474077192745 1.4342573035948578 -1.5716367732583758 -2.1357956386999493 0.77708160885335631 -1.4079674171508747;-0.29336210289486347 0.81971364246436118 1.1745018664440912 0.29840211869196986 7.6751797371628925 -0.26635049264749444 0.1711279751232225;-0.30116712243283572 0.52342126816231049 -0.23164397847701926 -0.73313657279783639 -4.0797995844785921 0.20894721628894775 0.59741155498884058;0.2364648481702365 0.081970542225638071 0.7855085145674614 -0.27997362815168925 2.0258450716589191 -0.066592607151542568 0.08994137605794722;-2.1184884979338499 -1.6706286684870109 -0.24779640796486899 -1.2274653658952117 -2.1282629235461119 -1.0211462031404277 -0.27220487815499295;-0.34117548542526061 0.59815288717490434 -2.6865531303187908 -0.58905612908554683 -2.7303606320340905 0.056740230122251517 -0.8715655264350014;0.88208711372218007 -0.16833500608358729 0.369086528246103 -0.23259550391106965 1.9775983662985961 0.45887900281913768 0.89293193810777782;-0.46517872485221023 -1.5744502373067577 1.5031294189211313 -0.73605922556514813 6.5388280307164797 -0.37890270704819329 -0.76965888411714078;-1.6568443111810429 1.5707638262989381 0.010582677734973848 0.10884301569024812 -0.78993567196765924 -2.1167262780993759 -4.4265128364841795;4.7790568936395514 0.38702330622516729 0.8259618713535023 0.93932153660662443 2.4951988256362676 8.035223006895027 -0.78323022567859579];

% Layer 2
b2 = [5.3463976708172325;-5.4230607144810126;-21.825027578578624;2.2615088162600161;-0.93314595533479461;-2.5882869687795815;2.9556173594301609;3.7427131554039272;4.9357088885252489;-21.244473453994555];
LW2_1 = [-0.80790654492493164 0.28486875614183826 -0.58673066112258032 -2.1594000598660883 -1.4181287827793023 2.7445340947593819 2.929956138344568 -4.0448249130593128 0.52143936738938657 -0.10305921863648645 0.69102502899043683 2.6543586457025037 -1.1229076499027133 -0.61571305483028049 -0.60968554401850661 -1.5970052786571958 -2.6663378110505045 2.1737684012463618 0.5062333956816284 -1.8607899205236462 0.45300360605656814 -0.36846388764580135 0.40002837895170096 2.1845255903622687 -0.62981744950432994 -1.3015890135972912 -1.0453434027147444 -0.11961624018350447 -0.52518053429738643 0.071466340050307858;1.4949795607155743 0.39786051968873187 0.88295357687506282 3.2846963094315718 1.5015091546094146 -2.2815946024158871 3.1051146430133221 0.70187241354038599 2.2899745121567721 -0.58137870665374891 -3.6473993426624141 6.8616318749567826 -0.31288146909727543 -3.9865383044887586 -0.056694313603891329 1.6834788270405698 -0.078037735599238461 -1.9064168475456675 -0.37809507342098109 0.7700602680939761 0.36061287359347599 -4.4127441183376908 2.0034594286337457 -4.6839798748123869 0.74695699057825182 -3.253910500444757 6.1866040085036857 1.2837208035158034 1.064742579135791 -1.06511546805744;3.8739445780446102 -1.9637026022688038 0.23753800645925302 -0.54020615375445113 0.18338150600943229 -1.2114752215402662 -0.035660579362665493 -0.71856102167683544 -0.56284614507381336 0.9186304147930564 0.14176150695416337 0.093403766636711988 -0.40514050272802676 -0.55131472814840998 0.67143920094185017 -1.1506740845498875 0.86118581877710687 1.2673631336438507 -0.34620340702055263 -0.33763634717698493 -0.4047583933613047 3.6981159686996214 -3.6981908054595842 -0.68675820292142054 -0.057719188772040846 0.4892936000552725 -0.38917070237297474 -0.14769885895779319 -24.387880717214173 -1.0333118875083636;0.75591485446415518 -0.062887561818290361 1.332926302390923 -0.18786725589739306 0.68609783302537308 -0.54882041149063343 0.37702669870860228 -1.0760874196385919 1.6984948975338821 -0.33888206522424968 -0.58361368055323215 -0.99608120224464314 -0.6711145433745932 -1.4525926828869695 0.097508789825964767 -0.77493749957472247 0.22446331189597848 -2.6940791539840085 -4.0243513774273518 -2.2331383366396578 0.67162322465187352 -13.361374294683554 2.1666856732120445 4.375203204244877 0.87588957855043859 -1.1990572497735088 -3.2793013293104294 -0.22971702793857268 10.744906904794735 0.12191404155931809;-1.9142016855237478 -1.8162021427096817 0.20765972590550463 0.85975108955111057 -0.18573977081268347 -0.92063220507284627 0.52561768250111751 -1.5179703411916758 0.55141872774107314 0.83616219082101373 -0.95501678119226985 0.68161889728193703 0.75819271001937072 -0.77026323492382109 0.067766106705367937 1.424491764399596 -2.2565912262067074 -0.37193616912616262 -0.056048305124970436 -0.57922302487247013 0.34022905121552566 0.87157515013923781 2.8116394633818689 0.68414420624350492 -0.28532961911804056 -0.072839012485151747 0.41727251188877124 2.7477549024206191 -1.3671708869580155 5.2075204680480889;-1.8286959313275182 -0.31238943204245084 2.1755380661995587 -0.61692216914353792 0.045611037618693888 -0.15868623825822492 1.1797347026897673 3.2907856012788517 -1.0695872788199989 -1.0368416530098459 -0.030116441428165233 0.34945342905248578 2.5546221296533611 2.3231431885039995 2.6699694407019567 1.3825622067830208 -1.2397355240763051 -2.4551914899644274 1.1938370234608942 1.1323375393449322 0.93562241882647512 3.3890732180326033 -4.1386113986625768 0.077642157608923734 0.48189145587138671 0.62672131751688109 0.69491234532280766 -1.2295597020711513 -1.8228838571637724 2.3960200177442905;-0.34819745249235262 1.06972494785293 -1.1763464873095568 -2.1419581965637811 -1.1145384317929867 -0.68258404162157638 -2.4821526112015082 -5.8255207473424271 -1.0698307506017319 -1.0490800256049524 1.7585957374490258 2.7286127735801706 -0.29726491818128126 0.67954502745512746 0.43715869287819709 -0.87844369993776772 -0.67643192862839674 -0.30302510192989962 0.12460232551004032 3.7185673116017379 0.15982169714249356 -2.7381134124211974 -2.1184052376900349 0.85394020571422691 0.19522043283970097 -0.55363245206191003 3.675962194948672 -1.2705342558081216 4.4727710523198079 0.58976823861104466;-3.9145236799711176 1.5651587813448011 -0.35492945002127746 0.96625381292371526 -1.0990966280575387 5.8283435256649376 -1.3754548439174996 -0.30923809301114302 -0.51762116802086811 0.28740847541533027 0.17208386898377731 -1.0513381624137599 -0.93450654852378789 -0.73093051849465607 1.9889445869003286 -2.7436009782648578 -0.81982204134603753 -1.6931903036984048 1.6300215693656379 -0.80821725067407824 -1.7790361534685981 7.0008459692658551 3.8208002709013442 -0.63912279852465848 -3.2881981743665163 0.003331327708000461 1.719091260188955 5.4924250838191435 -3.7817161503013881 2.4361772827244628;1.130350227108333 3.1943655713216605 -1.8823704855601888 -1.2365635473109926 1.2511850805028526 1.011684397694999 -0.60625973823721968 -2.2963164061156385 -1.0282531463450657 2.7166242262981553 0.51351658915602638 -0.56691237549540685 -3.7458522205330995 0.016448886015755063 0.38651056611176388 -1.4715304933666966 -2.8003420275340023 0.9844995116744123 -1.3394968217932661 1.5501433814255916 -0.93544981884415168 1.0828187364362676 2.3278405621540066 0.38615066301636769 0.84212655981744067 -0.90938683796656639 -0.034085463353853609 2.7729735934563537 0.52582188591386758 -7.5559294578940346;0.38412864874255576 0.73906952519336788 -0.7205052234436552 2.8675181546283115 -5.0220482238810966 0.20718013982490019 -2.9456727658332009 1.5054012984991896 -0.031392106490055832 5.3078740150989852 1.0339781313057677 -5.1809278764617845 2.1956658347135671 -1.3427482878517816 -1.0532885722543364 1.9194222087263102 2.3906947146680997 1.965275586516098 0.11188658020475539 1.9056890395197881 -0.50339269637213402 -0.83508348932296383 -2.5547479785923364 -6.8396364903974183 1.5078856300237846 0.96864344517962608 2.5855017298039988 -0.15919886924248972 -16.981403173425029 -0.0040256077214622325];

% Layer 3
b3 = -0.69210520747280968;
LW3_2 = [1.4004732680839609 0.046001989438839569 -0.015330764589629432 -0.12088096824396902 0.0032007519362468356 0.0082065290277267278 -0.044457365538365531 0.0063140287952944303 -0.0028671014481849548 -0.11804522306295927];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
