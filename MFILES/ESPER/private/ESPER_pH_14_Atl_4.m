function [Y,Xf,Af] = ESPER_pH_14_Atl_4(X,~,~)
%ESPER_PH_14_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:25.
% 
% [Y] = ESPER_pH_14_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-0.2178];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0479365703301392];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.5713353928187192565;1.8814488182095097102;-1.6733145362637540376;-2.0478707279496144444;-1.9161990546512861489;-1.8052616748571117533;1.513637831717683957;-1.2378273204798715401;-1.1953596477021202205;0.44277948565179975349;1.6409736264912733184;-0.52931608602393043217;0.53138521243614922351;0.43611884960816060808;0.15243156014005782017;-0.26460397327899837228;1.0581499695812066619;0.049792700023609234861;-1.0068700486869142097;-1.0227107722095456488;-0.73372597545691575771;-1.2311428828650403666;-1.1557556364043506392;-1.2140821059211577282;0.65424731095789412372;1.708483752712818049;1.3905674865150090547;2.4984629645850313651;-2.4141981574344248962;-2.5382067485006318819];
IW1_1 = [0.40092020246938225858 -1.2258305767620476523 1.1341323471884201535 0.4358384159927999324 2.0025347153715484794 0.73382487095872950267;-0.13470290744883156586 -1.6585557438363665028 -0.5955168030116666511 -1.6363981082047949211 -0.81514898017000192443 0.60844280371370229599;1.0669504340435360668 -0.89718450408090044679 -1.7187470188053235454 -0.58893489721052938446 0.33058256144196596082 1.3422594398424581019;0.72416521802947553255 -0.58684319377953964025 1.0616663228435621047 1.1646506886301646322 -1.2511058339670764195 -1.5403180330911117046;0.84337508579875519743 0.11553128750710700556 2.2919811391823561308 0.7638494463025721215 -0.29429417640134819534 -0.95036564978245308133;0.49269004384307868438 1.3213417887980016818 -1.3712749882292865067 0.6034277288011388185 1.1977181932280986931 -0.68270281627809425995;-0.8935522321660305245 0.96539736972576339902 -0.99665139332534291583 -0.0058509333341441906173 -1.2250728860024493461 0.43114505001746961099;1.0744051498160156477 0.83445706577200706722 -1.0676094937010860431 -0.054275911800031995114 0.80339631486059814858 -0.37192615078990548527;1.6015039188501256628 -0.49681713091135160099 0.59228989284928246217 0.40006742580393261921 -0.098988151472160973432 -1.0078028487526473622;-0.80088260185983284334 -1.933381164980627176 0.75976770047652752993 -1.5883851182948964809 0.10747643315563217004 0.64367030874053732248;-0.30050360635838946344 0.019556893929087135892 -1.01198207412489527 0.61034376699264802912 -2.4876225652553078938 0.12955386344401254028;0.42943472292240653099 1.3587396924718599944 3.2302287075855522502 0.71771712493896233642 -1.4350128506359502989 1.8531591924479962064;-0.42253020272284053105 1.2869568306794654244 1.3317488721971835197 1.1699010570425165678 -0.44210494579576170571 -0.77850221522042584166;-1.17324461337015018 -0.66106458827639580367 -0.49053829330777659612 -0.83629135938221188518 0.8443262788658836282 -1.3753046399835673341;-1.0846651573788097522 0.90971795957290280121 -1.2932111542798887527 1.5362661589789616823 0.088728650388820592965 0.79367101661406624924;0.67342855394499490096 1.2883690643993515046 -0.21484954590286978182 0.62668346104910377381 -0.66699471826745826419 -1.6744449964343528503;0.39672785196301224575 0.50095745459285756507 -0.55696264211244572717 -1.5349200259193491735 -2.5716887217500623564 0.11007749018931056728;0.28288892761483913629 -0.28108262403672923391 -1.1754101090372670591 0.40246991265164383522 1.5753798800303793204 -1.7382192491911570009;-0.25152504292227134686 -0.90929412328919922981 -0.47459351349618505989 -1.26350067534014876 0.93067820098240583437 0.30496379689411334812;-0.48133548275106252667 -1.3101253972685360516 -0.23619467770894905789 0.50289405215450222464 2.1567450981870468496 1.1285019817389569941;-1.6625143931502761596 -1.8208360593931247617 0.90348826110692526115 0.16616396071666217349 -1.7131747690040741716 -0.74064105047499240175;-0.19893905390046026649 0.0027803789865638792178 0.31118982379645671044 -1.7227868915693880236 0.61808555554877420146 -0.033386289528854765085;-1.2429586503025507049 -1.070997798153650038 -1.3516562128122273645 0.42079077248735280437 -0.0437501131112951816 -0.61606847798147179596;-0.11780862416366960632 -1.8140731940564325253 -0.50448121560049530299 1.0131392331064721368 -0.2059763969117133775 0.64530548987660862892;1.6636891572011354157 0.71741150501279948859 -2.0722436453585006966 0.61820590655927531998 2.4898877313775398257 1.2614289630893469329;1.7980131080806935895 1.9444627768324258543 0.015823464929288232061 -0.30133266217930798625 1.9151731474990529858 1.4158660231815622943;-0.48355598167998004033 0.84845675451832369696 2.1232038389527891908 -0.95990007574872238116 -0.69151587598051600381 0.46355943376308883508;0.5785139172696676102 1.8315968883414295298 -1.2919729923854079701 -0.66163858716112333713 -0.68057627840096002192 -0.50143620357785168018;-0.44047355633194507085 2.1604369709706223723 0.067199989542979191026 0.43482272114996206591 0.70957639429243390961 1.2038590524267684945;-0.82967054284312535817 -0.6839317229052057634 -0.7532406298568776748 -1.464673626363158343 0.79929873362855863306 1.2313615693251593886];

% Layer 2
b2 = [1.591814418206464854;-1.3929165854236773558;0.76893092271575791408;0.50730068969295005754;-0.090960161928687985333;0.0042835068294334215436;0.44851037331475201997;-0.50849976932477891634;-1.2973198154402614257;1.8438756986305477881];
LW2_1 = [-0.18297062600260674547 -0.29009102001796893688 -0.14229202066288712536 -0.17584386439514251843 -0.68758891188467941014 0.043147216069603908095 -0.095970848602422276219 -0.96045212672755020389 -0.49376384616417789974 -0.35177737082198640151 1.0756479316057232509 0.31342731558019404359 0.88078472975668020695 0.34466555975660767563 -0.39707016124502136911 0.10795312928128406038 -0.29625315603587837332 0.055693841126714459244 0.36424383825860873198 -0.21265180400166786012 1.1484975223106907993 -0.1151610058499545064 -0.051925003249560050533 -0.24141940308784332059 -0.12735693155915625563 0.15580317010956051815 -0.12402920627765290362 0.2465007800843436736 -0.38873103665681901786 -0.3003826951451002425;-0.16682296632675247539 -0.36324138988776860648 -0.87032314509784525214 0.11240092917065334921 -0.24976151353608924688 -0.074184583679256344002 0.88841792447302136981 0.2359189929050360679 0.016520067322332725873 0.22464238072934455959 -0.6953205438621188339 -0.59486322806925207018 0.34312937198092768876 -0.12474452620930925884 0.43781025086113123379 -0.31104517889211602544 0.3604822332775820537 0.1565995055985009432 0.061895547765069391932 0.38783149079611917154 -0.59748330361166146485 0.28109811218100694274 -0.18995672484591721862 0.3103285098735816816 0.73130332488825910975 -0.5791400272913148628 0.077850163198248625851 -0.31980743035173508915 -0.52253904975651688236 -0.12164978055351333142;-0.85710544545005329375 0.13072095256441340627 0.055137299419324582728 0.62994137739798883313 -0.48534042979423741571 0.86874032238373866122 -0.6587609335849030634 -1.3977917049347106104 -0.70417453501407845096 0.26946255011605158014 1.0903074853129686161 0.95986221232426205408 0.96397552416389575836 -0.2431649833341484046 -0.77077676925588123336 -0.41913695504773174072 -0.62744117687363976099 0.54313328929692927804 -0.15638552404453012756 -0.29158923822493587608 -1.3886411966071030566 0.13843220535448447217 0.058444945511892824885 0.11471128785839225517 -0.074810675300327617032 0.62759850462761046508 -0.24925251299704306862 -0.011459917532735574425 0.088524757071231058303 0.28287654692229530218;-0.60890992826065748478 0.53034412714834722191 0.058224310802079265459 0.33329710364255649147 -0.080045178149851625715 0.63013689435581921039 -0.21048136933407807225 -0.45961831045147588659 -0.17223550270947241003 -0.58993174093259448387 -0.36463717858632743729 0.11361730739083523989 -0.43697043513571370843 -0.28434670319019300644 -0.28457202372652112832 -0.093452331854524825494 -0.36903584127311622742 -0.036226410944324952124 0.20420054079925303858 0.15026169711420162001 0.139308821172131031 -0.13548807697519479887 0.40929737280236627717 0.12236152983241554981 -0.56309076105401090206 0.68126243704708611126 -0.027425330048302335589 -0.056567353601245776162 0.23285650751160230643 0.51723458156277668518;-0.17604652446983967695 0.09364506863943213022 0.16925338351541324711 0.036036902641989776441 0.16403208609824698749 0.64789741853501492397 0.15327200025500223313 -0.00058730505482142755097 -0.21268721603893300798 0.38770123152952973289 -0.5071269901270237801 -0.5229653666451865579 0.31236951349890196283 0.02957856631495393504 0.24291732906622459653 -0.25970136843463453857 0.84600046025717590137 0.13211211399107233855 0.82618227880124828211 0.36536262494618915175 -0.18833361726149464022 -0.53210665095732478935 0.30239232813841360192 0.59552327139964078562 0.23812573909038423081 0.47634434119655560957 -0.093430269480971717133 0.46385708327049751665 0.32384868592541959931 -0.57665110930787966126;0.66508421580244148075 -0.30289101197234802321 0.69300547255091016208 -0.22868046831330138269 -0.2253538683154648059 0.036900536094801143772 -0.42725024919298215664 -0.39931501509280958873 0.076023129188735591444 0.13087485719997504763 -0.96470884381936916618 -0.65277407662757824802 0.54587592132806128653 -0.13979179091388721501 0.07398726208158523665 -0.30364526549560061364 -0.091510803882653687924 0.010412412740367089914 0.50689405315978686151 -0.0027586700863931903037 -0.44385778089605321117 -0.27159534605478125036 -0.48292109023898477371 0.08846083351878701595 -0.52689731664202099637 0.31749557675642992027 -0.023887109234740935143 0.56600181153346129648 -0.0020211866905243628528 -0.33267889033783831776;0.032276555943223018963 -0.27795428590884246889 0.16861060749425882399 0.4347054959191511414 -0.24115893074288385911 -0.53357396414030122678 0.2411766251014797191 -0.33737984019052541518 0.18745848657317970565 0.20097456393575116596 0.1440405021087986237 -0.65921261526465857461 -0.25710138893658346371 0.40244228050677860464 0.18218959194172304472 0.451320526201059391 0.74528199544554352141 -0.4990353395644711032 -0.45790809360190753985 0.018744602579329448094 0.47937696432744719699 -0.43590758671407764391 -0.18340957963641335571 0.048633815376150676957 -0.57508229150107315064 -0.27927359007938429292 -0.066098544122505792364 0.29020737238801136426 0.16094256605789514225 -0.52531583150643490487;-0.39820711823291649045 -0.013750555160716536676 -0.016582444467955939627 -0.65270135912954696522 -0.4435463358478455298 0.16345495297019183023 0.46917833701967592841 0.23825847516924697489 0.64045048758005362899 -0.432273724590487185 0.22381149777448350324 0.3764432994249674036 0.058227033192531668648 0.56970698103126915512 0.57368478241534626161 -0.31600195177322076834 0.55303385581831032702 -0.44192001293710947429 -0.28681430441445321389 -0.20798961251046316212 0.28135124919625048578 0.70164819510907339151 0.47493878665407107675 0.18904961305414028083 -0.42968878211312133697 -0.39686752010115711187 0.64793432416047302969 -0.7261632186392834587 -0.66914270799016350999 -0.23998007194362050432;-0.88426807482719893549 0.063874133490462406404 0.28574709166833556218 0.31121888153072752026 -0.30030156018526205086 -0.23764681402994838888 0.77739740350676689307 0.012357063262602809017 0.59576302738102882017 -0.47549527951280901039 -0.42790274025080882181 0.031318269191321600198 1.1776447367505276098 0.33044846954529982774 0.0027840435875505736667 0.1767897201177550115 -0.14616556279644013494 0.24129386211537373619 0.47016823688157011185 1.02880690018377563 -0.06935843640144070954 0.43217330043745427748 0.18850291371560662368 -0.08584127007310761448 -0.65045687242809213657 -0.14163483447426744588 0.058389478937924337021 -0.30099428746601014639 0.14060803959027889931 -0.74852552099040237099;1.3148721031004122484 -0.5370040692947530836 0.91391463887004265043 -0.49547316499186672134 0.15695533378163020743 0.60276940231270481618 -0.25419306372881450562 0.46356532515996556887 0.27260669347601346191 0.058490417032231505068 0.039704542134816910026 1.1947746239665539836 -0.41817419419334339592 -0.032072821504501573819 -0.41300427128147654265 0.3409728274030931483 -1.0442234277945690035 0.79710785850842036382 0.33299466336615834994 -0.14620741948770388241 -0.071516200897840997985 0.54321566556931843994 0.30372544483286889605 -0.48320165787081170716 0.13265380189318207171 -0.09582647194838674054 -0.2018302117045329136 -0.088391990273574513881 0.14904700003962162436 0.25965259090215070392];

% Layer 3
b3 = -0.2952000593677223117;
LW3_2 = [1.9255365032719213847 -1.617945789905590237 -1.606563274053391277 -1.1884287216397966258 1.5181498834041036172 -0.68452724422837296636 -1.9951186538331100451 -1.1941447628699171091 2.0642161239358998159 -1.2199161768559072527];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
