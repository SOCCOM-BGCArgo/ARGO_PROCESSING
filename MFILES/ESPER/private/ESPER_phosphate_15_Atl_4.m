function [Y,Xf,Af] = ESPER_phosphate_15_Atl_4(X,~,~)
%ESPER_PHOSPHATE_15_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:31.
% 
% [Y] = ESPER_phosphate_15_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [9.1705065994030938725;-4.0938717250459033536;-3.7670789817728977944;5.9935126554212052596;-3.6295089598665457586;1.7786669305820561604;-7.2254892644671837587;-0.70974768411654620692;1.5574073787105515709;1.5601379672293667067;1.8109973437107718119;3.5977054082926471779;0.51071169233688196165;0.20041227855502524724;2.1502846904754355783;-1.9328568499916736201;-3.2315200213409007723;2.1984428047461745948;0.4035386159868050715;-0.092866356480117193128;-5.2871662971645800866;-0.75439921778777119243;1.4464051131191881794;2.9431341242162232241;-4.3726499528700930597;-2.4906804310700603189;-4.158320616567221073;-4.0334607381642539892;0.81979838446299679866;3.3615621489539089239];
IW1_1 = [-1.6527450663577432088 0.74576899272336849567 -2.3718230013220096275 6.1714642065899747436 0.41292741099477969779 0.63091778784140073455;-0.25634034999397276033 -0.27329010402988374029 2.6754378942277066145 -1.6094057543766449037 -0.83142790423345613871 1.6612641882183944997;0.35941409715066213737 -0.6196057072157560297 -0.56583110819317050666 -4.1661295879317759017 -1.6978240564955597858 -0.97443179743634256162;-0.17941938562192552564 0.49818983865262417288 -0.77561362519204346544 0.24488717541361201824 -8.0691033746797344861 0.017434207536667301053;0.32248993210648579932 -0.37784608170594646825 -0.22461169127546207203 -0.23975205349753270223 4.3326764695511474912 0.10360281425647795139;-0.075708452497450395846 -1.3034179571808830467 0.012882330025028303211 0.24675303997838157755 -2.2139757377209319245 -0.42948908726174939154;2.5741589035196450475 3.7839913060310057524 10.189763941495035837 -1.3226430086720390999 0.25874071618343841283 0.42751783657694480967;-1.2282245811046701434 0.965142587565258947 -2.4244424268723592242 -0.62062650749507741743 0.98981030175150430672 -0.9594777580101716552;-0.1374113096378293819 0.54676797471450533372 1.6854589907852242092 0.041734533222294901977 -2.0901923605550742913 -5.9425302644024613485;0.22094821407878795227 0.22335633993347750459 -0.69635193989665200576 1.4722293608200469617 0.67973217611868552712 2.25213610515279683;-1.6193734539619604185 1.8486865539476604603 -4.0500210589559015872 -0.40463809055001942472 2.1558736589973781506 -0.26639225089631335397;0.96805288444117587598 -0.084045242305937545302 -3.8073613903215393073 3.7700522951098647262 1.0407415282381000665 -0.3934664940939400779;-0.13868586717681263831 0.66279011076073657271 -1.1955333108911083695 1.5408226201245438514 0.14665239836357985004 0.49071788043277142499;0.09143776507711652568 -0.43446556092590299381 -1.9331215482362114066 0.30122580424051809134 -2.7258199654568335824 0.33217179685816045076;0.24597182335358125371 -0.12872637092911567991 -0.23310697988281567361 -0.29613142418507260034 -3.6676802560715300316 0.64401143714597219869;0.729093759316958967 -1.9269020003597252533 4.2666170567453693963 0.42363028846083317092 -0.62686467076735641335 -0.30400041782843750804;-1.9777315624265316973 -0.072737764104077812233 4.0204277566481216866 -2.0882767173012508621 0.58992478324853869776 0.58183203820161377706;0.1168025595113511006 0.032336281367854075031 0.86445615787216334436 4.9700261667551517419 4.5880397189083055309 0.51958757381090747707;0.99520454856514628528 0.19260244297219708542 -1.1636808394707653935 0.29582852913150814445 3.875132608732218209 0.17610555158388230268;1.0461787622855647228 -2.0193551062380774574 -0.13238007232240978084 0.37224031420621933597 -1.4450008945363235213 -0.045154958593896635244;0.55325524187308772195 -0.14079590731907878909 0.88211302333249919094 -7.6012035015884675815 -4.8692676080087240464 -2.6568883187001661739;0.20449198331281515095 0.29446228746487368433 -0.90721766778130763509 -0.41383666026000687221 2.7463484292056783431 4.3789744873802893821;1.2638641772012486619 -0.36544335409985234664 -0.4732650912679099986 1.4086350377567873338 0.92447475874663787021 5.2952253880499284833;2.8197668381831668682 -0.22068514027013158563 -1.2334612420507258257 0.159072712135701122 0.27391251531770965943 -1.6960090415886304172;-4.1723142306806284552 3.5361574343984045754 -0.0022070665867296845181 0.054133955092882504734 -1.1292543150576030975 -0.0028143407618040823005;-3.8595233429584476781 0.83199468831194611784 -1.3827870099238259716 3.6685427144527871235 -0.33541117040673451566 -0.025664278741387498706;-0.55873035661094327953 0.90015991260507155491 0.15437084619515037409 -0.84002341219460807675 2.9079755680695096309 1.2781642024844390715;-5.1223014623288598557 -1.0128906858656219203 2.0813919234438222894 0.32992965848946614882 -4.1203324895749986467 0.70568355528674286958;0.1502537160339888489 0.044368302961436720255 -0.89342915461258631815 1.714841735394863953 2.3485898423302447036 0.012502386441121279143;2.1026161857640155439 0.52665448832406691615 -0.37034778145637442526 -0.093595607986594525629 -2.4984944690902777253 -0.65820753068786008733];

% Layer 2
b2 = [0.73240972358102141015;-4.8674620687659002627;0.082625314451328563115;2.7003834765278802443;2.7524811372266784204;0.46162698804263690988;3.5640829074438524771;-1.9758473118048733852;0.33757398805857635748;-0.92525574799827803307];
LW2_1 = [0.33779061911609314928 -1.5402765491107106577 -1.3858576457720748198 -1.1057282195006943315 -2.3673839852253757421 -4.7549588889668807923 0.33582473715470367859 0.75739134116479822634 -0.71347724859598138369 -3.0909191821893697849 0.16204070607269807636 1.2259328213009061948 0.45545790748848841156 -1.3180685937583707101 0.97968487881250609917 1.1124164807419423262 1.0325854435274743892 -1.096915854811032931 -1.3621640778224122226 4.1239452022762197458 -0.32107921426462626702 1.5413247338059712366 0.60740580087087625571 -0.65641323229150261298 0.55812834029687374837 -0.85467884964787887991 -0.93807225598745114237 -0.465904624878306306 0.46921481552747557053 -1.6948324384627513339;0.04025156541728430043 -1.4990112001166826516 -3.5208252632872953924 0.1355708701654583237 1.7718732365526492778 1.0130030595414913908 0.16569732198864647876 -0.69759855009909488288 0.23875693443214798806 -2.4755491860177376573 0.34840410869402138605 1.5069506234499847608 -1.0123739302584633393 1.9110328203691757665 0.55185728473724071641 -0.36943677517914930153 1.2940967110858199174 -0.077142837852821666278 2.0811940302216753729 -0.16720539498946757062 0.66301818560520853207 1.0618602804637116144 0.6641382042137562447 -0.55023029909673093485 0.20129610903629518992 0.60135810579882398308 0.71186169923695918893 0.3065002373905661992 -2.6349988768128880245 0.098499009335768286655;-1.1513306043988775773 1.7304588263211171384 1.3226629939058482943 0.58872251221976035218 -1.1315619434207366822 0.93660038216864305305 -0.2280964482200495691 -0.48782560825343462829 -0.41641070452419132186 -2.0160001789279013984 0.11009433653032291156 -0.16073331952772287878 -0.23358382085502454872 0.72633082938398341177 1.2929967645450914926 0.37546643632460541262 -0.46903380578874248608 1.9688621918318418569 -0.56139787963775222845 -0.78425393141317112367 -0.15635957700901512157 0.86460111720005350389 -0.045017799610727729509 1.2366766962741724267 0.051924441616894120854 0.12647770231866689583 0.29330393890095718401 0.33820603333462734286 2.3694851062774735517 -0.48167012648801266206;-1.751720543388277429 -0.20341397608486752602 -1.8369270212100663464 -1.4235936378649798328 -0.061856181522778594384 1.0119146837201133948 1.3819199536468504963 -1.2072282089015007323 -0.40266193616648565667 -3.2594575828197727141 0.42864481816727950658 2.3133471963585736653 2.3855616267498618299 -1.1927690663759888956 0.58573825261245704432 0.64446105806969045116 1.4345352845904093542 -0.67076866078084917966 -0.77787495891462710151 0.64211851119519991471 -0.26019778968892914861 1.0213043053034860375 -0.32902550459447199582 -1.5385385576082104553 -1.352009418986377165 -1.6681782316833539959 1.1366469948778141763 -0.86773989362017456273 1.9038262562796077759 -1.3699702627239189745;-1.3390780898523524378 -0.90789278874818946097 -0.34678687722596829301 -1.3575546417588004733 -2.3855630872614477234 -2.1911629749479990537 -0.4565123272201914717 -0.54820489987066289839 -0.28648142286954053626 -0.029204566182776878214 -0.27743573474177762872 -1.4720007177875988891 -0.08292532507493127758 0.98345259969830145508 -0.62048174667702937768 -0.62063913213453059114 -0.81520632077342403132 -0.97779886118532044481 -2.4168724997508084229 0.93535050591768276185 -0.84597783668673565138 -0.53546000865780440936 0.077423080879102171292 -1.3387435773676323869 -1.3121124323668817979 -0.40546403950228526725 0.3266938812415479676 -1.2009751778095616448 2.3371556614575501598 -0.51481921577838773985;-0.66220868393209586511 2.5439286586155960279 -0.93272297346070665025 -2.08447763066681091 -1.8922254024231099923 -2.6851609662577087256 0.41797336678578933533 0.80509061919473645652 -0.4058805591648956268 -2.0524558414304285847 -0.27810791155904546201 0.33677047336272181166 0.52017988338673670778 -0.29812816442259426619 0.22366480091983020895 0.80723298512680219385 0.20939726473438280419 -0.47782894487872895617 2.2551775411836376684 1.4511190616092688455 2.7314108309637767924 1.7412779070016624061 -0.36084309025700067597 -1.4908126737743478962 -1.4998937040962583289 0.032642077395690465014 -2.2504113134739140989 -1.5915956741352714765 2.2540495054884672754 0.082473903044258681239;1.9450877493164620002 0.37799212200793386174 -1.4592791295785771943 -2.1937051376053302576 -3.009198533034013856 0.38698797927296713084 0.65196937231970197857 1.1705196308715470899 -0.24360313214913278945 -0.87685431951708303622 -0.90518149242800660659 0.53369253982630682209 1.010176449711744695 -0.82227324328120898755 1.7985604249651341302 -0.40879012483561422142 1.1875578336664573964 -1.1281149416819364895 -7.5521989435338294783 0.41113763168060551978 0.95366064577575737626 -0.16261452001168744119 0.29141252933753941656 -0.90464513897114007257 -1.2722405203154865116 -0.13253544186631971424 0.9508620769189286559 -1.8474928709083617839 2.0146584495670527559 1.8462344324950994423;0.15185915733565111263 -0.15417615207324394944 0.38694467426159551149 0.23892786459239542807 -2.2257028535432961114 -0.56192645368610283363 0.41483652687862021535 0.10734332231103015098 -0.47406505544562366206 -1.1831800878973814939 -1.4530248886852155099 1.0157996444032704186 0.41924559457621696223 0.24425990086880483565 -1.3734392689226362361 -0.76794100071660242879 0.9307736223407023779 1.4264745048683764583 0.8016154668313431042 1.0204274630345160357 -0.8354083697653879037 0.43532846874521097247 -0.26486511883223512465 -0.35868485068564409657 0.21707954666155890311 -0.98853774014891504507 -1.2115920595281817196 0.94889025247242786421 -0.65633057019453466818 1.0039259760680980804;-0.18972692211524658235 -1.3850762238838159046 -0.71576906435228937475 -1.1912983068654288132 -1.2853528553000670431 -1.8703116354129289967 -0.26934328619272090988 -0.12841283241635026435 0.23830991125478984127 1.86282880951494767 -0.66758702730847918616 -0.11613739639912327994 0.47861872084173356923 0.55378751421787686393 -1.7760692794193024824 -1.1248277384011067248 0.15182334734938995879 -1.33884117348214704 1.2769588927126134248 0.99944011497447449166 -0.44648084755932126999 -0.56012369102093628737 -0.55615455004434810604 -1.2390447719764934309 -1.6939256806263953692 0.062082138900453297248 0.25746459071483762671 0.3454135187390826589 -2.5179423228666593104 1.125240171746805462;-0.47018725464180494145 1.5646404004021232659 1.2219905651208751163 -1.5173972538837969815 -2.1257791740354483601 -0.10617300864668070826 -0.22455960263111937603 1.0169865734201246621 0.062247954881341868716 -0.92802122180226964687 0.94716774891414656778 -1.3926245254388756045 -2.9565129399047065384 -0.10690129513970625386 3.139713455257441943 0.076660474103518991273 -0.80851252164726139515 0.60588140035420101626 -0.088781902695589692831 -0.26338537329362010642 0.091846373689312282851 0.02113623143571515331 0.2503167575941085965 1.8350822934385411234 1.0771260918769167692 2.1551997864092871104 -1.784678182609567676 1.2798016070443185566 1.0995207186303714852 -0.50612099261559795327];

% Layer 3
b3 = -3.1752467751199704438;
LW3_2 = [0.30126517099637589725 -3.0283118769326442532 0.98730184328938364047 0.13036339311894759585 -0.60804855461520279647 -0.41232368874429992101 0.5515669161795302422 -0.56784674402828982931 0.53889018646342090602 -0.79535974889498284313];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
