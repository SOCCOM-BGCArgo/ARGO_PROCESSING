function [Y,Xf,Af] = ESPER_tco2_2_Atl_4(X,~,~)
%ESPER_TCO2_2_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:53.
% 
% [Y] = ESPER_tco2_2_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-0.2178;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.0461352500991908;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.2458729374299873;1.488845922093426;1.2433334097078006;4.5263932213174023;2.7613958722200693;-2.0338773199579165;-1.9962785737718292;0.13607612440572947;-2.7951007197155189;-2.0200961946906331;-3.2015929052335577;0.028844573822985844;-0.16950884626926077;0.33561421815069831;1.568631901182354;-0.88156565637998563;8.1272541646620695;-0.051288127606478384;1.5252790897200335;2.050101700001683;0.52876703298287919;2.2173049218576413;5.039583681214042;6.640972194537289;2.4792825489076393;-0.23405273562804024;-0.17645871360385387;-2.0512382721808899;0.22977754812234147;-2.5472688253963671];
IW1_1 = [-0.94616588463856433 -0.32748885997897836 0.33627408410907722 -0.5559209336116766 -0.0898451310200266 1.2340288933155437 0.083428405263443403 1.0534956269371387;-1.0058768329969967 0.70958996387689255 0.54919338016571118 0.20274408141165789 -0.5628001243054962 -0.032619730727005442 -0.089083412405053811 1.3466690732825355;-1.9074706729809108 1.9014450610769078 -2.8883666623244739 1.1870191249915896 2.1533512165079887 -1.8173402837993589 -1.1648013929615277 -2.7595627020417761;4.4143173443233126 -0.61813338058634615 3.2166100158783428 1.0387559798422434 1.1615444641497701 0.099919363322078 1.5475466121831476 -0.81938493817940083;-1.6887336146671712 -2.115668280748503 2.4437672447987713 -1.9835470147700653 -0.59686138052357041 -2.3037634759880552 -2.0723173744901526 -1.2742240188561014;-0.17306504025222474 -0.2167327714950274 0.13233741049989281 0.67307837964182649 3.5526625471946973 -1.4165309745614501 1.0654867219579243 -0.87615655986406726;-3.4306126647245838 -2.5026846368822073 0.16871379937775602 -0.27501756215813161 7.0204658695708408 -0.98029487565590012 0.52866876555626474 -0.51385590800596603;-0.038012415468004296 -0.67199673404858917 -1.3182075895008241 0.34146295992104986 -2.1763399501864229 0.38612809588776986 0.29034387076953649 -2.2973581531834619;2.1749949539440143 0.18468279998461018 -0.28362373337215951 -1.137684839602578 3.6273343427025786 -1.3227829397060964 -0.96916810029657063 3.2034469070836176;0.85385326563703146 -1.119794559529167 -0.17732865531535252 -0.54307408967085868 1.21671610834107 -0.99551842098015952 0.14581754169259095 0.020007464452250864;0.98107416752925802 -0.12249331937410166 2.9263074500620587 -0.52470214002750271 1.3921152048329757 1.1873327210597939 0.056587317265361883 0.67532827066640888;1.2400800728664496 -0.04764654058038148 1.4285926836652925 -1.2331795563066374 -1.4352726770694348 -0.900918675402819 -1.5979799207991396 2.5703665150538524;-1.5766435492431687 0.0074202175831735717 -1.7305506932606625 0.019227985634112488 1.362378452618533 1.6992007521490675 1.3974027601947121 -0.72926522612672795;-0.15297879969767134 0.31083778762793451 1.2043190079738377 -0.90279950077829363 -1.426856547881608 -0.086341108695967811 -1.2274390842580902 -0.31201522476166255;0.057967043139407155 0.49473669386738039 0.30788551795436159 0.33421610261207052 -0.98747538994533568 -0.30333420131548472 -0.93585255856063132 2.27767312874396;-0.026054458409956807 -0.66781559441713767 0.37186067241750853 -1.9200189116220936 1.6828227679498029 -0.17286490138128283 -1.4031752916712816 -1.0863867577430757;-1.2599176671953165 -0.19162061914653916 0.14280042452618136 -0.36542022890777809 -7.1997183327687573 1.4697093518036819 -0.27827631117809881 1.3954427997675554;1.9075355359999213 -1.9599335936160884 -0.67408211717452249 -1.0508470930056277 0.4625551660812498 -2.5824034174879373 -0.3215792855556654 0.62126190618072163;0.62801344479090881 1.2648498069136673 0.14760760193905856 -0.10489327431115671 1.572816783816831 1.0034087759463985 -0.13282493877091522 0.46596735949661222;-1.7761303398818573 2.4267448366609949 1.5442529298691172 -0.57361069350258131 -2.6892115488603352 -0.79447185637165274 -1.584480427125966 2.5632782559352218;1.6240602261833907 -0.23894920588543761 1.0156528333523205 1.2625498056588809 -2.5170272704769303 -2.1509553140958508 -0.85906211395566934 -0.17520881125521287;0.56889606775930857 1.1956427866067934 0.28781887397386469 -1.3035159143651649 -0.26688400419227865 0.37132073537036786 -0.1770603878665544 1.071730441696682;-1.0024929620241423 0.82691090331283912 0.35978109903653022 1.184404500397916 -1.8430196057492501 0.42710019219295914 1.249181736972752 -1.0044205211658319;-0.057150806099936502 2.2135784768231792 0.69958788943662331 -0.99381615327504857 -4.2861130859093297 0.26621953167435553 -0.71546283227354612 0.37891064246094991;0.008605253607526871 1.2229109558059306 -0.72931053263400747 0.95163416432106374 0.88034039105258777 1.8198680501816178 0.77915370266379347 0.013901736112982885;-2.1369132349490392 1.8511009457737226 2.0000031293144933 -1.4852567517583843 -3.3678615830546006 -0.62467536567456561 1.5228990720537294 1.0142347898174962;0.026633628740252442 0.51614359664679477 -0.604071611819049 0.49761965765903798 0.13690644951190717 1.2745832608914338 0.50375183339178997 -0.029561842662957354;0.20946026336351192 -0.044456024603831745 0.29639294615147221 -0.66351418629373216 3.5482104818587041 -0.25042196487133994 0.46049428117151742 0.69195599068231461;1.4510064287800326 -1.5859208281105637 0.00017778178624860107 3.1273300675027582 -0.67361255797273689 -2.4961073224212895 3.4202786441202782 -6.0908570832613815;-0.29229461494780301 -1.2750219227723827 0.40645234701556399 -1.567447431276684 1.1700381627501364 -0.36873378300985638 -0.95211299996779275 0.75106140724379988];

% Layer 2
b2 = [-12.972948698843433;0.12597462462283793;-9.2145417802471261;-5.2341770954784099;-0.17129193858346847;-1.7932731920110432;24.463665436278038;-0.35489558488977757;-9.619252574901747;1.2239771284433008];
LW2_1 = [0.64705959285809822 0.24151686319178015 0.13332174658565696 7.732826496167319 -1.2430943070073193 1.2627909115576381 -2.585970742761138 -0.32819094253098324 -1.1974178303694942 0.048048439124720593 1.2296517504727664 2.1646758166547153 -1.305616279146038 0.71038036818482941 -2.1787127876993932 -1.1801119938737303 1.3513211401596943 1.1296454547915622 -0.23057603458486747 -0.50244290259787705 -2.4518989246183311 -0.27439160944018731 1.0324173406822608 0.79028175395233102 1.0915284731156845 -1.0712317237627176 -5.317189014528485 -2.3192267392716501 -1.1895874348187574 -0.78199648602917726;-0.414797544473411 -0.11762502562897098 1.5406592593707065 -2.0830863938438839 1.2860450994755142 1.1267078241987338 -0.82934052596843055 0.33670323224638277 0.77123879687169938 -2.157578297286797 0.97575580952581831 -1.3400253966012585 -0.48431728226313758 -0.13800064360838071 0.98875040356495691 -0.12019691168889662 1.4044162301990142 -0.62045607810321868 -0.36588722907314963 -0.043725263440036341 1.1141523649969485 1.1538966483476067 -0.25168351042643727 0.047539580838229387 0.67682373611396218 -1.0088061962489847 0.94183174637361677 -0.14539771600294482 1.4362832917865433 0.5860490754635771;-0.17504728483073501 2.109067446760573 0.86572424473219656 4.8760097199993586 1.663862203558558 1.2975877619959375 0.78134920713751177 -0.2927662570660553 0.16848842419334245 0.43039852704055531 -0.90358034319811065 0.89480398376648973 -0.3964051854553422 -0.40999184319382459 0.76875402422632866 0.37542738797593955 -0.032956340739601409 0.63876846087760597 1.1060505458191148 -0.28793965023591439 0.75547689296479037 1.0529352721954486 1.0603094994163837 0.013776492908095871 -0.027145036508509864 -1.9429273750188873 4.658498943017678 0.13331315451191014 0.95605720214194934 0.027714426469634859;1.0341121866603811 4.5524809716530727 -0.75422296207942996 4.2000225491275049 4.5002649554904046 -0.93951022228044145 0.89848680463916786 0.16619004983670421 -1.3719935136054906 -0.75181633451378505 -0.12958316071938394 0.175332884609576 0.36800590669123839 -4.6158858165058074 -1.7968550977209461 -2.9352000189147009 -0.62170360889058818 1.8886051376869251 2.5897931153463727 0.64076130326774217 0.79405443702133871 3.0487308498914985 -2.0822371537512194 5.9038540734164577 -1.1244647762845925 1.7372794539366159 0.42210402672166264 0.57811814443951925 0.60223460347223312 -0.34719286201342081;1.1872331824339382 -0.44714257090046627 1.0181654525158699 -3.2365379290931555 0.52059193661622249 -0.45058682588417892 -0.63356424916676202 -0.037325294628589058 -0.020949803924768227 -0.97523868091351229 -0.67872457476841863 0.2400620218115686 0.43149971705684464 -1.2010323463640116 -0.080075139431154616 -0.41173502585408306 -1.3534022876596881 -0.42945816757542316 0.97715368558647531 0.15704431151957068 0.43415665088557764 -0.35968614081924599 0.29734414768310641 -0.390347320989819 -0.92404785021502478 0.025276075871957251 -1.5593482204286815 1.1597080065755543 1.2053871209150659 -0.042693577995473006;0.53468838414695696 3.1206689246702211 1.2804950535529334 1.47867734485853 -1.1752562313908275 0.39012256172223109 -0.38322623155609276 1.0214372649991776 0.56050233950162454 1.478557070956614 0.94196930117026556 -0.95913712356633818 -0.66141603910229307 0.22295008639196298 0.79285881870075792 1.0726897352069962 -0.21346858289957299 0.17231678600606803 0.90595142576932985 -0.89125239006159485 0.45993597297957345 -0.66342422366778619 2.8026046764462098 -0.11019583888519516 0.7878120458892387 -0.44849595572816631 0.81086999606310495 -0.10317169779623783 0.022943053351379535 0.5944979803232433;-3.7757994421323238 -2.4702083436814037 -1.111405989457569 -8.4576485095046632 2.5694718553684575 0.59872844026702254 0.49866441940323486 3.0858959077523513 0.78072277340284879 -1.3446521706269845 1.3498108705462808 0.85656553580418859 -2.0510702986097882 0.042115248296317916 3.733912391801149 1.2814646347586034 5.1785648203890124 -5.0848180537630698 -3.9021981368964647 0.34458296907479213 -0.54920499270858181 -2.123283882127688 -2.2053686297724484 3.6170324030628196 1.5368857972572632 -3.3295972454511666 4.6962941191782939 2.2226990610220474 -11.873755569867695 1.9722556582576836;-0.055786719592981981 -0.38211068280996041 0.89464769874471828 0.18282933788521624 0.28975136580350591 -1.0638871968815282 -0.63232633447938913 0.18319114956889329 -0.011387890243365267 -0.0770800033800986 -0.25354380536638582 0.72739907466051001 -0.119395654412761 -0.87005446809408427 -0.85291903165088523 -0.64572234823158992 -0.026024888711356622 -1.0336608041371824 1.5638503608149523 -1.6502217140631019 -0.28490537697786666 -0.081545119999781923 -1.2493490296352163 -0.99361234851850344 -0.67048178624218868 0.34726183174251457 -2.1845618231171402 -0.66351187552831636 0.089883012749630717 -0.33103421399166871;0.09683594108231805 0.037042784322943792 0.56038504572202408 7.0956413606422446 0.5108829156903637 -1.8182867507106948 -0.49774510280871248 0.31332720045307327 -0.1638268801558482 -1.2438493606373309 -0.19486040705052868 -0.77961003846852017 0.8740364754556339 -0.42329846878928257 1.2985993762831125 0.19874379901322672 -0.99037065649890677 -1.0092453876239629 -1.1040739285601631 0.58930554298326832 1.3019328465603943 -0.26211016255583325 0.068155351939720651 0.42929229218335552 -1.158598945297626 -0.89941072962604018 -2.181901605984804 3.3106124840202318 2.5513102564248751 -0.057591772045554511;1.3797880488233234 1.0491202133053301 -3.3689290861967671 -2.3977296651858642 0.35810536328316128 -1.3992973255838941 3.4966312170521432 2.2872253131631632 2.598590835067546 -1.7553286912478199 0.29553019795818397 0.34465894495884919 1.1918633107819783 -0.49247526908193401 1.7850664691191087 1.8258121611757969 -3.8895622538934611 -0.77643311548061211 4.9322527597623909 2.8189689005281893 -0.90507597671209916 -0.31106026119829744 -2.5838660746523199 -0.079781066642357887 1.0113448493571551 -1.367878777320003 0.65820475649141896 5.8729678522820521 0.0073233167866149709 2.835536089335549];

% Layer 3
b3 = 0.26057022815866959;
LW3_2 = [-0.020479801757124827 -0.048415561901322172 0.018866781150419249 -0.67073081603961759 0.13603408724837032 1.2254903098837906 0.0078048842673452013 -0.094857179802187802 -0.075920763901964158 0.0067363579839743223];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
