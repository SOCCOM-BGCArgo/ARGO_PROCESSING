function [Y,Xf,Af] = ESPER_phosphate_2_Atl_3(X,~,~)
%ESPER_PHOSPHATE_2_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:27.
% 
% [Y] = ESPER_phosphate_2_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.28;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0470499670650231;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.1482931667671403275;-4.4333332821357025466;0.87268936706839805861;1.3953945393044917545;-2.7493746469378343988;-1.4157306756512912926;0.80885628968667178107;0.97626312383845625931;1.8867496024139778221;-0.37025698950860463921;0.22173207859127491703;-2.10365840210273225;-1.0268589425400704851;0.69540386195431225236;0.73588768935969317564;-1.7901386699449060025;-0.9021400421295155958;2.6105144667666349001;-0.33880489899374316431;-1.9377081503406063945;-0.0060308469966994793232;-2.4856863999579164037;2.2555584973880504762;6.4537286786488099466;2.2770448971717756059];
IW1_1 = [-0.67264851504382550118 -0.63759797378046489946 0.51107423600133417008 1.2498561325469688121 1.5666452058349447096 2.4259595028026650354 -0.86535054192963722919 -0.6195841733530695894;1.3187533033574023733 -0.94845541551460121887 0.74252702587592356309 -0.8919913967791618381 -1.512504395611986574 -2.364948972117881798 -1.898775003240455117 1.8862150948775562309;0.90982147443134275822 1.238111606365018158 0.71635129961386445618 -0.31044561653808461221 0.79296158046542641884 -0.11110172156161897405 0.19845669836836282718 -0.074911545898807621602;-0.503855538646575285 -0.32701645021377995226 -0.71630478210627634983 0.077962846419842371515 -2.3752466568639438727 0.64605399689142606334 -0.23526231425501015204 -0.37385031139831481628;-0.16840782401214296482 0.48260323378062813804 -0.78285140633415972733 -0.20727826598364487709 2.9700544792952459083 -0.65460386451449170675 -0.47691251510971260918 -0.32619727505387441369;-0.077624752217575143654 -0.55961722046810025155 -0.7495738442441078897 0.35517769991175734967 1.2740066123404043541 0.32684632595579321546 1.104888441707321256 -1.0693018856384042259;-0.34728190928336832854 0.56353141728173306024 -1.0629091594970250245 -0.14501122719979508968 2.0274742934579332854 -1.4245558468611851932 0.54130284376290282999 0.72394827803298755775;0.70402923236803682805 -0.25006376503075616879 -1.6951837073978694992 0.43945835686774864515 0.99028739697872503189 0.64754402402552579954 1.1728889765713692572 0.90562800096472628741;-0.91351641649699011349 -0.38866954470820441747 0.38645614215809659386 -0.36566956012402140885 0.62090835337853722553 1.5212101811205409607 -0.55885447125066411989 -0.28358469416742482228;-0.47003551497212070487 0.982769097004674963 0.18548771711206479829 -0.88549548293089364037 1.3721456049408802258 0.75949896576114617197 0.45808446133989527693 -0.73262560063301807034;1.0069666695529977396 -0.51053939235680567688 -0.6811671906687823963 0.71071303403978036695 -1.2278639530685075965 1.9011669652811558073 0.51734895860156715486 0.47686486264309757566;-0.65519439104291088416 -0.14655695040018357211 -1.3248973513664270563 -0.42385861571059940678 1.3518849123045830751 -1.9910921690794205485 0.66632198105717099779 0.04118514017290450524;-0.041655332339094026939 0.03764388448089668604 -0.92647899354533747029 -1.5315400786601671701 1.2930495907245109777 1.4774452284996506535 -0.52176021302473785113 -0.78055759758242937441;2.0164616656196021616 0.67626657390517963542 1.500635621063650893 0.40718806064362017549 4.1772188348384888812 1.9067713693777346151 0.53530761619897326842 -0.49937468770932036399;0.17565432172104986086 0.60496659138970143577 0.21791737674324687668 -0.74981161610979019105 -1.0819404912335794933 0.91893318835753257101 -0.018377507095710836349 0.39698374396136965059;0.089320546275749507226 -0.022755412660541301378 0.82819573659413547873 0.61760677875957903371 4.1752501000935904329 -0.042394164246568014076 0.073351072966586397528 0.77827635871498324072;0.30218413322454740211 0.85591204243675156338 1.2701172230363579896 -0.7316968105234338271 -1.1644899856823818229 -0.62227353059552958925 0.34731316207434026477 0.42202307797456639626;0.78365262240010091777 -0.30328482510078597079 1.7604149469259873229 1.6625116679431428679 0.073542528211425373108 1.4979725652561430849 2.1905944450747623087 -1.7481310486167862539;-1.0604580652528767803 -0.28542678287133965709 -1.4794262092095833427 -0.049754591151590907283 -1.2725268843421471132 -1.0484818250996468247 0.33354679872021580911 -0.16687707005866539434;0.015378918225793201946 -0.34679650032279446537 -1.4518340200998063327 0.80017563762825616447 1.9058302464430447731 0.96569952603731301632 0.62104014135968299559 -0.75285343860817643957;-0.47072229632173995251 1.2760755625941111457 0.43508824738291368428 -1.1970769317124738684 -0.57594471738318253617 0.48923947133081591154 0.59182777066308489555 -0.94771827253377416422;-1.9045155154467929837 -1.1547146241984196369 -1.2742814730790306132 -0.65059849586815798883 -0.80980068602721266835 -0.91930383870924681222 -0.3077726896625099795 -0.44564900876248808581;0.87867982088586682465 0.923479964638091122 0.58671773324508746938 -0.33207275183931300733 0.22491735356916778277 1.5464196261115010778 0.40870519403925231749 1.0279272983254899021;2.5205060142307571525 -0.62708677944610635713 -3.6057623754538137284 -0.064271842178025645476 -0.97054602755316043972 -0.61181479760527657241 2.5044988745330023505 -1.6162696906647986417;1.7064151102692903805 0.18684283526535244713 -1.1267479693800404039 1.3263282431803020689 2.344671428023180848 -1.1878934057556269632 -0.7399339799339821333 1.7244466681093011395];

% Layer 2
b2 = [1.8669665970710107583;4.5457925364060765006;1.5547456206803393908;-1.7094409586507028909;-0.11033817766991232956;0.33815675483021229164;1.1175873436501508884;-2.9255647126973371996;1.542590877266974525;-1.6328064105268060846;-0.022222111953374042159;-0.80001284302851749519;-1.1873126473128499114;2.1059192428107924577;-0.094309995258009010621];
LW2_1 = [-0.4394779141291438318 0.45628272290322535731 0.10510897207654912311 -0.0090701561400349829667 0.26149151912245421903 0.17736213677552964407 -1.4268024932021046158 2.2544107363163869984 0.83996556970440972023 -0.46410392440571518469 -0.71165679899793610197 -0.84032053351268287678 0.34123036945526219466 0.16087780003702698006 -0.85677958672225562609 -0.24021239153956708279 0.24621111978371690299 0.33625217083110386929 1.2870381919741142873 -2.2359794893166591301 -0.21687326939406259552 -0.31757064272730400889 0.12734130474366001096 -0.33100364028950851614 0.56196598752975446267;-0.98775639421127570117 0.66259811854149941457 -0.0084192679526003469381 -0.2074788654295528223 0.77333952875559464069 0.0076064960750636158304 -1.3239943301613337212 0.29840435163942252705 1.7042179069599170393 0.76574322568165953395 1.0702084780634919525 -0.056197248172482089368 -0.35552514670238904992 1.2046879553213842851 -0.53444429594180387078 0.32008642350446542268 0.66592306923854849288 0.64250993939328104876 0.46044432054087020001 0.0073587594837090791744 -0.44484418400909381264 2.8319283931545680133 0.23282934177202047055 0.16167759494917716134 -0.46907036009821378997;-0.32541469298928910048 0.073324700165705788968 0.62857041801014990057 1.4708609086959774093 0.27521822138206442077 -0.43893485790255887258 0.70747428358446262653 -0.034274656978525587514 -0.21034258605433545086 -0.68504678802815355265 -0.14447576706997894425 0.37097903723918435048 0.27817334541331972808 -0.0089428841232446452947 0.48721635352588099632 0.7493741047989102011 -0.072987784950535886108 -0.84247394151026278042 -0.18964845521537598838 0.17203122227327619087 0.59082550185008231303 0.15976537745748442543 0.044684876196476930321 0.017688546646835619225 0.28198837167997675701;0.53485453390072767998 0.1359474765255201667 0.43339220324067645462 -0.91920482609511033889 -0.23146130897005268157 1.1099916831496394742 -0.11015796058212315445 -0.54757876034163976975 -0.71105230892349469141 -0.49455490698198217858 -0.46675510695226329894 -0.20527752762600867675 -0.071687617789427712789 -0.58777663190700202289 -0.13494750565974156231 -1.1060812090873433089 -0.16358094660313579616 -0.39214477494426175364 -0.49246983029005370058 -0.065702182607346865106 -0.029138764284811963234 -1.0986120758303874467 0.12123844579388683151 0.34472249834344287356 -0.32172957340222174683;0.4184235566872044898 0.93421986586886607284 -0.30335621758770103806 -2.6056008319934886863 -0.3670869561128823344 0.032306110518372885276 0.030408678799475834242 0.47511383934666828743 0.51257234690327202475 0.61560999477375566435 -0.3052351837746265506 0.39948321001343312098 -0.22258899322492112227 0.91546019081539142803 1.0465437794223937384 -1.4326517693346596527 -0.43128599054853644645 0.16752628310887557328 -1.2103073661717149712 1.4890222819354188566 -1.2946107899018042264 1.0299406758841733733 -0.10433546662343917699 -3.3301665124267016971 1.4591708945229309169;-0.0032591158212432100837 0.13468661086144492756 -0.0023446039412517698936 -1.3621592689935630993 0.29904142390533478002 0.061152442485235242176 -0.48481511448871250636 0.39527054999810906644 0.85958880617876143315 1.0125341447712838949 0.66087354999413228107 -0.011961659817288191471 -0.24492443031944383103 0.44758071192949583361 -0.93979028218434690345 -0.88593333858868361652 0.84807341228366883712 -0.50665604111809992016 0.45300008625850646249 0.013935231830306094025 -0.23803279743175576044 -0.66443684118824863916 -0.29229340504627204789 0.36027456397715285075 -0.8359772948718166008;-0.29101331937629582036 0.074673764915451759649 0.25704208678412177047 -0.73521178532935238525 0.39101678296957992353 0.40577119684678858436 -0.69303215786265548459 0.43295654307049386 0.33417822773079836063 0.23645342495516630255 0.46997462213650559315 0.049145734479847158482 -0.058992460019165894602 0.14097051741760996402 -1.0114990497455753626 -0.43708968973086054222 1.0649177588917442261 -0.29786536555744863586 -0.12098495090728496326 -0.21726514132956248337 0.18768964702847057424 -0.56259562817376407295 -0.41648474796604251225 0.26412021809963254215 -0.55282791788213025974;0.54798801991380008403 0.7671907739961203454 -0.088073847004723773702 1.7450722273317347266 -1.1233084315446135726 -1.822388422798588925 0.77866238733787074278 0.6285009849761985512 -0.85454347800754193454 0.81538086992093372629 -0.69041482999247538732 0.63245802132985573518 -0.11276207988941405747 -0.34873985449454358854 0.8994876465323621284 1.0815988253724573287 -0.46484144078727829275 0.5771397512832421306 0.58062510362182662149 0.64246963637841303374 -0.17806520175041654075 -0.58771945453059382114 -0.23923727642774708646 0.98448748373694128233 0.57581416039355626246;-0.021335286147595999839 0.58028342542120125991 0.068842777032770252621 -1.0451867261880849469 0.5664941810678691958 0.19698252685021044872 0.44628231285149166929 0.094337707512720248015 0.38518422853628436764 -1.3668046627110970181 -0.19861511072291940239 0.94941117706809619037 -0.6274536947558476685 3.1270050154376289875 0.4122999499773547516 -0.1734270702396993602 -1.1301796073807863774 -1.0189858590585196829 -1.3686296944104003881 0.51625582807424563736 0.81568722751310041019 1.8080414333096248569 1.3206949631099602627 -1.0924950683672525198 -1.5050866047004753945;0.20737657419334129538 0.27250323647211244227 0.96509515948746205094 0.49495537519229571011 -0.74574470466254094703 0.86682680702658720939 1.2766225359532206163 -1.0612954393150992871 -0.069514574563768111171 -0.82081399891212469822 -0.37199247133912644037 0.16653606496150089034 -0.067314382077352685751 -0.92820926733673492226 0.73944621826312773027 -0.93199254395636310644 -0.57578808166169404004 -0.70419015315777566677 0.30150490308211047585 -0.066923704491204660805 0.0083741504966539682953 0.36642013740126916366 0.99283290717336891706 1.0533627528381674932 0.13759826015922929643;1.0341536672422493304 3.2745287230784678734 -0.34131508538176447143 1.877252714161051772 1.4383518934537322664 -1.1513607147940447817 -0.36957129392694804126 -0.19029583158305021784 0.55138815179257161248 -0.11804478158436240709 0.48698696381940520528 1.1488062295129257695 4.9509348774289918538 -0.96136118899327416276 -0.13155993862038070641 1.3570626673274786 0.8150621028816191771 -0.8223958403503796033 -1.5924987749170276263 -0.73418061464296813234 0.26823632853337353588 0.28907218532153972079 -0.058645866428866877396 -1.9222764290410996324 0.94873175881795779318;-0.033559789327528767588 -0.26819950861679214826 0.041936170200098370209 0.64577722539563253701 -0.31959131910404431354 -0.036891802872404282077 1.2087310909344772814 -0.65807346026091761981 0.29522839634474545845 -0.45129662898234973456 0.038570685084243522267 -0.25435624738675466361 0.011879177218028896465 0.33966777390490004995 0.54984191639363022563 -0.66492584981976710079 -0.68824563891896184398 0.17833676507808110534 0.14359609832604855462 0.093335363213645480829 0.61283581385644214645 0.13176882296683820051 0.52308091237073517377 -0.30825291721703551584 0.77575724376501686841;-0.087009725061265433266 -0.18172037737000801272 1.1679235235705276441 0.27583178554239967673 1.5035190122111994349 1.6849989737099246856 1.4026791122604536088 1.6209108769352282842 -0.63124545192975167751 0.15935780386868811376 -0.089207418331075913343 0.58787659191444963103 -0.18495646744271901363 -0.9515205573623688462 -2.8071537794066885319 1.2545735681223013636 1.9167355268505954502 -0.24167730401307369048 0.58767673705278178353 -1.2471788272743609127 0.37691745626694483917 0.15536843144892983903 0.3571062846107869726 -0.10855875663611733173 -1.3712606323556473242;-0.65113587415825446847 1.0189226012976881908 1.9140791543084212378 0.73234089220565024014 0.75163999113191659607 0.89563880299931131201 -3.3072405919247707118 -0.57937470853876305021 -2.0550145727696667031 -0.96070013716875568566 -1.6429700292076359069 -0.35113534521211425821 0.077736774300672870086 2.4826159872049533561 -3.6756474165660719677 1.2762812837659205378 2.05969935605907839 1.9786207229298722332 -0.63402777577208269122 0.34356086714755662559 2.7450324357092532601 2.2221857253189352122 0.48913899423914336539 -3.3474767696264060568 2.3207126548562251322;-0.19452148743819239196 -1.1676510383752107813 0.9300653741943722963 0.037481094963519999419 -0.78358725246908311757 0.73592069809359239585 -0.063172880280448012735 -0.088517941688369058961 0.43410934382692795142 -1.3137513161661940053 -0.27449783864574450742 0.29806969874345073945 -0.15696660661323505459 -0.03706528971335031758 -0.14388579410952184734 -0.30334569962951130062 0.50019261433201467337 0.14752287843202657736 -1.324243063885529148 0.73648751841425963427 1.2030415570772101663 0.66982595861080129751 0.16421224206977133586 -0.10202217340251276689 -0.046507869475250020186];

% Layer 3
b3 = 0.99385407547100956815;
LW3_2 = [-1.2948535867554358259 -1.0326201724999530818 -1.6287220289465798029 -1.8523989534890672459 0.79851623165160634521 -2.3279033318603952196 2.6397774326204896944 0.80356972373096324791 0.32769761603058256139 0.75538618611350472065 -0.23639207670084882995 2.3416081207218280014 0.1923619178603642732 0.17994390796060177884 -0.68490390166126402516];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
