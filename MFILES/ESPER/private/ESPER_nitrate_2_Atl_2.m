function [Y,Xf,Af] = ESPER_nitrate_2_Atl_2(X,~,~)
%ESPER_NITRATE_2_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:32.
% 
% [Y] = ESPER_nitrate_2_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.03;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.604229607250755;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.6890105002598754247;4.4581642000129599879;5.1573700309688605969;-3.993406831656573619;3.7566179867928037872;1.6783046330140840574;0.05514267244725300221;-0.33716295897283227179;1.433082434749212819;0.54825331733381488242;5.0117844402841926765;-1.9475784307750074742;-0.96905265465513057421;-2.2683695866305639832;0.66137411090961895077;-2.3648087166272668824;-1.4223129842560813252;-1.1428034758314433716;-1.7563689429937310305;-2.6144493652568736586];
IW1_1 = [1.1662423884509147687 0.80506052373727576832 1.5909793514456438412 -0.51750881271277437978 -0.99791938866055396318 1.7593277800395499266 0.73061915563305179777 -2.1886005622082502775;-0.10652481824400375499 0.74608583356321223068 1.0586031195556808715 1.0028639638699694547 -2.8544749689024793149 -0.26410835946903366001 -0.059939139012885313262 1.1357175961651311269;-1.8628734921259137991 -0.65700075516983313939 -0.093406045297992970622 0.048379905744104979848 -2.5794347743677974449 0.3547989794687126941 0.045431190772034210634 0.73541539999893013047;-0.15781630095923801504 1.06224752282349022 -0.27240917278894960507 -0.11590906603121051144 -0.4902655709068710066 1.4197618801925249166 -3.1799911159216991408 -1.8971245507235787731;-0.41785987959733711383 0.87483178230468372494 -1.0846291089999771096 2.5595065945285893072 -0.98982515300723372675 -0.77826093792354811285 -1.533317538124583379 -0.20729456874405444156;-0.011271907602242213844 -0.43344231454442294638 1.540102175975048171 0.65685634350646571189 -0.34570972929117060879 1.7161633901444095507 0.30042364061960447064 -0.16813823434881658425;-0.085109748089834652562 -0.06679873701407683384 0.18197934444982372115 -0.16436398234727925272 -2.5665735211147748807 -0.53030958341425682434 -0.75327571927575442956 -0.83031408898573233479;0.57771063722347926195 -0.54210550514812150258 -1.4520162410945205433 -1.2410483774061020767 0.74882376393551386418 -1.939069667175095768 -0.37691083757638865759 2.66865901060244326;-0.74886364666653471023 -0.17116920554693260126 -1.4544743619599975748 -1.8318641511453248594 -2.7487760821571542991 -0.3299116492259810407 -0.73639344938624029524 1.8025133275346461037;0.73242554109596236245 -1.1940690087914012096 -0.75681621763669815195 0.5419956087231110331 -0.55073060829569953079 1.1295917878397354617 1.9130201078950803684 -0.69128278146494281931;0.019614259715915766114 -0.18120616020406044022 -0.57775851860765425894 -0.617440467073710475 -8.0067625856232957915 0.67216636768912774169 -0.90104083484372599067 -0.57020898727104885051;0.30810533335757600559 0.117008292656302193 1.259308086900370327 -0.36247174378379293236 1.765116050686472926 1.9450982884246261762 0.98204953781400261548 -2.2474739317117111703;-0.29825449153959521231 -0.018708684592724567075 -1.4394225246835998799 -0.70044980176895421664 -1.1264023405274745659 -1.6099337273993783448 -0.46547923446371258782 1.050496196054538256;-0.84129026373654181015 1.5637932054590477637 -0.042083310013834598906 1.225174401672827651 0.71573828396745364788 0.56884759382963900887 -2.9429610571478219683 -0.75830774912363829721;0.043460947212953369989 -0.28607379606155686202 -1.357024421274694026 0.41367669410588764345 1.1415527165311785129 2.6548609852796705155 -2.7101562472592850561 -0.33356051496924316035;0.073755862654944687185 -0.37295585253533242165 0.10285389218654056309 -1.0008802454726841713 0.14899708646110829124 -0.64265952242383017623 1.5164828989966594452 -1.1677702112600616413;0.40972766911486496744 -0.43185114673748858927 1.089719068717685424 -1.4736002063394326722 -1.5870109536389260807 -0.72867991982441138177 0.87521349516703217386 0.57990904980879387498;0.10187906070399239955 1.0733323723040346653 -0.40571748564187171127 0.31387899762491916489 -0.18418680504833118139 0.67263177612726920973 1.8993775243905957062 -0.21781078952304569474;-0.15590676806330444615 0.86982090545162649153 -0.63870469034226340366 0.29754724976328378316 0.82645320490918539047 0.69516168296171687579 0.3448044931139959135 0.20837715663659517329;-0.30738251896843121758 0.29923695522077964348 -0.030096513368212386014 -2.6190028676444829792 -0.1937531776305552178 0.74442476330509954607 1.2774460722419507253 -0.18300305351028370304];

% Layer 2
b2 = [-2.2568094725383462951;2.2675090869554712647;1.0121768964782551503;1.9754912063205303241;0.043502604956185152163;0.1019766606573588863;-1.0356530455298080806;0.7434819813541519995;0.47933743995189947995;0.68330118157754193842;0.1754503556367932593;0.4127630734495162379;-0.52799779746810771019;0.46291778719458148705;-2.4106292093173866675;2.3984713759790952103;1.9890523531682784419;-0.79457751586733083027;1.9305983950449205899;1.5571060551395021765];
LW2_1 = [0.71195164321884529812 -0.024491531324773978956 0.12882091216593483107 -0.9218905206170709965 -0.94666153583314061049 -0.99033475709299745304 -2.0730864041304140066 -0.99448601398879765689 -0.70709342086986870513 -0.19703746466936111759 2.7692924404739538424 -1.5345646788440350239 -1.3736293783602939733 -0.074605813074248072958 -1.2706213546518689839 0.15768258513204763682 -1.5085947830361681188 1.4369222333276967518 0.73086407250819052095 0.540223785648239474;-0.83564356663281602611 -0.97301358531974513344 0.50810447674111769434 1.54331558930792756 0.86618254316298926021 0.37175032385602158058 0.36939763296400857095 -1.8150588805846634699 -0.036706946348894001209 -0.6167150514232788705 -2.1362155223671477344 0.10512612422217301744 0.5387519055065711493 -0.81234699007286159667 0.88236963997251449676 0.89249251343683344562 0.92496718729683080618 -1.1039722673025798017 -1.0778946363219243931 -0.01856027572255700836;-0.72237359157771163787 -0.14081046818923761976 0.7796626711830445533 -0.062102094578811092851 -0.51565116838555413725 -0.98431078857044951302 0.74622433684716704683 -0.35187499580160663815 -0.43618437270446303033 -0.2694642501504362353 -1.1259582397059395564 1.0575954803837215312 -0.064115164586780695744 -0.70084353018636946775 -0.05426535069495360547 -1.3930975193664816292 0.47953725507754452195 0.34051712825531266216 0.061925899752209807858 -0.20239203806538327846;0.58754764695785588469 -0.18385455967213534811 0.50631444189847774062 -0.40399379241850802424 -0.69409938318181230166 0.53158552778878609413 0.94680617906719566346 0.63667668992648351889 1.121692153422618965 -0.42199008464969528509 -0.49515715515843405914 0.29644592592585627955 -0.07054412745373563054 -0.015399427120480894612 0.31318414932750088253 -0.80605825565142830147 0.72532073938436969485 -0.29411152161362486002 -1.0701149974008505872 0.35942890183877695964;-0.12916309299521547271 -0.28844929940186575523 -0.37800951658600312477 -0.60384475189944297746 0.37868638458797859725 0.20175319067193356326 -1.9435503423981663751 -0.35456626899410537135 -0.59906435286632397919 -0.46004747793781552989 0.22280354450020944945 -0.95959995781590834429 -0.2787402153515589065 0.12347165698300917314 -0.52124992462765529222 0.48542066174217785024 -0.060190048118235701946 -0.51648526832482677396 1.3279443005919222554 -0.52080638228381681554;0.67898454242739281206 -0.82013577613762222995 -0.34636625511829893798 -1.1071436486050205694 -0.3798200270618539709 -0.11834839830450799569 0.23667499989976473196 -1.2480972534693008935 -0.76481161206580727807 -0.73511439684900103941 -0.11390692801939789058 -1.1082985534675506845 -0.27624294731537002434 0.65789818727717874758 -0.59161866947089869484 0.32033934078656789435 1.1142733006743106294 -0.99067959600282873289 -1.2995680205833617382 -0.44704296259882636555;-0.3716775256794576654 -0.53961169939582576127 -1.6573481584599691896 -0.60294367747464250318 1.252772261737771009 0.032333899118189041166 -2.4744114250211346473 -0.23191253939608932888 0.24642001301034605065 0.40041388484201778653 0.84356222105819256285 -0.70086014288810194461 -1.6453557718435829482 -0.25379797021781069777 0.45003288551266623641 0.90044792004974638644 -0.32523899599254124659 1.3290888303220320665 -0.37947992552033227298 1.6378953805574869573;0.28462000927222891322 -0.72351467250972389955 0.27852378741678257557 -3.5867061618760649466 -0.053254171299172460563 0.4781504137887305772 -3.1256360277705352857 -0.23858070267842973466 1.4527716664447347661 0.71638493426408977882 0.45264103615491663168 -2.8599993846175877366 -0.44499459114254896752 -0.36786049678040910749 1.2430742683374582658 2.7941363588413130614 -0.93578825409780608258 0.010173002135233434259 -0.4247748562720838339 -0.9101905564317630537;0.1735504296242861566 0.45044142496698907907 -0.24479120714464358555 0.068948374130908665625 -0.087834301382943777425 0.57850846738572370143 1.3270446150208072833 0.42837960001835306834 0.60067176261280619265 0.75303153054338900496 0.16664100992565539228 0.33116121396249997844 0.21954932786648023724 0.25885970307156280779 0.17801066863810480201 1.1651938454784287469 -1.0602803237918763113 0.023832906661350732047 -0.13923045932571695427 -0.18896999265165917437;-0.49576029650487846157 -0.49171561972179728128 -1.6155625012483305625 1.1521713874115337983 -1.7178115985197595084 2.1296346171983500106 0.74015639862212723177 -1.0581382389979876457 -0.90300609053455582753 -0.78512106421236116383 0.57065442172895108897 -1.2857205148473225265 -0.48927480046671645297 -0.08028074256553494048 -0.53914878524663034653 0.9306491217639746294 -0.94682136637039293614 -0.21867209663995312852 0.067833304775420294463 0.21130743936909812675;0.26056854682136443291 0.42588928450213686672 0.91232378494147292614 1.0687415524105845499 -0.68015585823460811277 -0.079734931926377081157 1.139183043617669755 1.2460904028239134789 0.92800985147849779366 0.033602951249446823268 -0.82597428925020233148 0.50364866388119367002 -0.096188394528028145491 -0.36700604477473020015 -0.16145707924741395378 -1.3465458729591037734 -0.69827790047903892656 0.96920411761007263518 -0.32022158760244767706 -0.22013563234249727829;-1.0626580885373781982 -0.54811185510967785905 1.2794595819351708421 0.54968427463093927354 -0.50453710977188515052 -1.0386176814338989871 1.0795822852834850991 -0.10315219970507917557 -0.77902465321979974533 -0.45676022955030359807 -1.4827442504293066872 0.98117254159969791161 0.07641306825032988248 -0.7054750661642440468 -0.051989954436024221618 -1.4259842875050257049 0.38543836293061256582 -0.25082927538059557326 -0.254113009411360391 0.069019330440449708219;0.38092324163387614178 -0.19458239323760989636 -0.16524930028544676519 -0.70054522223056547858 0.5041907226741083603 0.28567857730761492263 0.89220531583266549092 0.87069506775253191488 0.76415842680107481932 0.53296053853463476457 -0.82606044801886457929 0.81773805194070270375 -0.70501803099986415369 0.14702307842605435995 0.354866866913154555 -0.67041340741346866494 -0.4952935773367224126 -0.1561511813020891315 0.57947035732226959137 0.74793125295502171923;0.41082689950479844843 -0.02099201977174944278 1.0686740585157006311 0.77631818477533598433 -0.66034105406942045224 -0.31835597686311978283 1.4327685719766749539 0.58044805358009565754 0.55889355751973612829 -0.18655797336191451419 -0.69291823141545572096 0.5141076283035727057 -0.17604636359689979086 -0.19711615568001994436 0.46070340588563590822 -0.37718871744867155105 -0.1760673539921387698 -0.56293392167406874904 0.61823716544163298536 0.10211920641705783674;0.31912224553618201428 -0.027860870501081234918 -0.25195585856903901512 0.052390386707525847532 -0.26160453316563225812 -0.6139201693541999072 -1.2051715618458491708 0.29537804421301827595 -0.33508092721101218059 0.76382071404114315616 -0.18507080533127628907 -0.0019268895722689485805 -0.19189653106883150513 0.15884283892723621845 -0.026084956369844227581 0.64048476271507226443 -0.99959542474634832665 0.261783060310589899 0.64015992782241193382 -0.31733902965853183487;-0.40346185847501619959 -0.84968053820100797324 -0.63200324729218548825 0.97827704682611860143 1.1069978099841224495 0.81630435441622539727 1.9158459620519052713 -0.063193077383085730081 0.088264793532422239353 0.37340078363025513974 -2.7442060508375063499 0.28296284542728361577 0.90447759478564082603 0.050966090900756856608 0.92852513452571516783 0.090153543055233639758 1.281440873824758464 -1.3684656547931968174 -1.8102100307554440661 0.13105392813692567922;1.0027561620750202742 0.45638856399183252988 1.2974683337828203378 1.377531808009972325 -0.52807762942287073127 0.55147802401004430983 0.76714223070834153262 -1.0269297062821787225 0.34525189018199353708 0.64567508015408692224 0.66933106605243242182 1.0292354620044663616 -0.15257323394787680737 -0.12721221171263441541 0.80572946980940662876 -0.72330228190678758082 0.95342666547285181977 -0.57764738229833267891 -0.43639606104989575597 0.61309848789728993435;-0.80579036427238903695 -0.29449173830379654637 -1.2113279211947449721 -1.2795339348957499581 0.15842727387243837889 -0.34358611062667127056 -1.0579674015847408963 -0.76845152747084533029 -0.39764340132313757969 -0.74452577902424743606 0.080987210708029166994 -0.73659645905757809015 -0.12634159382216963996 0.17217411524665665601 0.13957906733389216503 1.0764390003885140334 0.5902566169066487678 0.13014955948934070484 0.28578565483758117116 -1.0794061430864123619;0.94840313160334621667 -0.52436898408438792352 1.1529014548857190459 0.97751031464505155899 -0.97273794531694102172 0.73033945206481709622 1.2051850490639048896 -0.016402007330824010245 -0.15060182135674912707 0.57174643151045845268 0.22685110439985972652 -0.40217211947421560581 1.8338591126294581102 0.17556714726919309122 0.027111422495872138094 0.59858630526168554731 -0.4718094101329888268 -0.48679400477112877432 -0.68822764213077980422 -0.50974123886487099355;0.61866769243849473181 0.13545895316620987225 0.9835842527220032272 0.97228950011604364789 0.26269027485886503603 -0.28135430962428209511 1.4129469671757814986 0.69969705393956604933 0.64367205194594656614 0.46480821424155993604 -0.32194127581751358358 0.70025617156193242785 -0.52466572270238853726 -0.010759569788663950196 0.29733122054028537917 0.27298666172906510541 -0.54349816402957795702 0.83827357895351306549 -0.52827555492747702015 0.60477118502239568532];

% Layer 3
b3 = 0.25776054905592099553;
LW3_2 = [1.3738135267885853708 -1.8888700484788947254 1.5855979111185705133 2.0483116700078505268 1.2897505447391914846 -0.31117354357155385669 0.22731701345424545901 -0.051214877213248841126 1.0721370708642814495 -0.21694962542060466926 -0.58043334615202013538 -1.3708926809859229845 -0.68137310776817761049 1.5052028846316600763 2.5078458295731751448 3.1390873389580775665 -0.14444297018632426544 -1.0081008414997139067 -0.53268898611943860111 -1.5112555664346798423];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
