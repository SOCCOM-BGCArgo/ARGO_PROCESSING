function [Y,Xf,Af] = ESPER_TA_16_Other_4(X,~,~)
%ESPER_TA_16_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:05.
% 
% [Y] = ESPER_TA_16_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.0362683153536478287;-3.6416119129430062351;0.40809134253620871213;0.13831584000172053583;3.1011024350396367844;1.5720209071913879839;0.22499374960623949593;-0.73049113280854049979;1.5597734058528085477;-0.89621712660840280318;0.9441967881486889036;-0.047923920791882304582;1.0853820100901101497;0.68564371492862274948;-0.54264487121255688962;-2.6539832015802424792;1.0186402281992814611;4.4857071423169507796;0.45318376157238354773;2.7876663223604412067;0.3900783471980864836;1.4264662957491847095;0.48796363881580434585;0.4065229892084317731;-9.8474945626052381442;2.3876974947263991389;4.9091020475289486313;-5.0582272827675449633;3.0145894418248966318;-3.8031925810931497267];
IW1_1 = [-3.1050858352278969399 -2.3396418260729809901 -0.029477235022979535878 0.19684800395464979728 -2.0696127350548114698;0.36614957663223912654 0.40251033144911890771 -4.0091633953621466091 -1.1647823074137162447 -0.75020884350716499078;-0.50459703996058813402 0.62688192961430688754 0.46500575994452114648 -1.2031816466427494028 -3.5958714131085827148;3.117609309251772931 0.088168853613701164695 1.3322068697701376916 0.20358488297636298525 -1.4966582910586354593;-0.45039312818121673976 -0.59147679990103418923 3.031443613507184498 1.3201076689755628646 0.76324830945488664202;-2.2364122545128886088 2.8849323098790398134 -0.25933032907818726054 -2.5804685169853200932 -1.185093558132047642;-2.1377053815156470407 -1.2126432649335532332 -3.2456432850859737727 -1.8284750129658700057 -2.0961357050767008836;-0.59187071824482107019 -0.026798852664200734086 -0.79834814005138288184 1.3856280278324728528 7.3518967610030712123;-0.58366952059005983156 -0.76746289668132650075 1.7682783278465761256 -3.0462481054914460898 -6.6770928109126721495;-0.83772272431693051153 -0.2049640197622654425 -1.048201211346351025 -1.2284983200818841986 0.67509293074561615988;0.64280133563376162797 -5.7925754307564023549 -0.72325476609678007733 -4.6568966236347675292 0.48356742263625185352;0.22940246319890270077 0.19632791889563469545 -0.1445358824404743836 -0.84341341962894378348 -2.814734490736793493;0.95294909248009807001 0.059938523731979109765 1.0086322841060060274 1.3532596196656518917 3.7092821827826414349;-0.016337126973652086465 0.02147936233674627507 -0.48252793111398589732 -0.025667052956518460888 -3.1280020087999957923;-0.050190036758864013666 0.0037192569709117748004 -1.1244026216826710218 0.87926078899074266992 -0.23376071190871480776;0.91053853644691817859 0.68925944934277594278 1.3348751395304923051 -1.9117300357512425624 3.1795559512304962801;-0.088056524347868120328 -0.15450792206454835864 0.080930170405159623792 1.0032040455778139521 -0.63339230331746221303;0.30443457605109419672 -0.20927451504070895827 -7.1439569150487480798 2.5300900312072012177 3.0933295691023703355;-2.7401250125492846443 0.10475469639036302794 -7.2056545776870439823 -3.1883825306524520293 -2.0988229409474117304;-0.037524214736110297896 2.1041471529590887179 -2.0742739471276201435 -1.9219672929705970965 -2.5740572504873182602;-0.23462340596533132198 -0.10486342091776044982 3.1512954463976265984 1.9574659954147688445 -2.0310142589221129583;0.028325942289824782017 -0.36328439375794008281 0.29794646637137367495 1.8410172419961592372 -0.34795510172678961736;0.20000956216998397319 0.55051534957564085548 1.3138649082152655811 1.0262204520160391752 4.7198678386272581164;0.20531344060562428666 -0.45962061039132057205 2.6302548177218341152 -1.711226705570974449 2.6823111930844634188;0.32221974072910020137 -1.7930603339684922926 1.2202844424547460989 -8.0407628430369779693 3.075139695033716869;-1.3953833138099549505 -0.91162654629946504592 0.091951605472917682937 -0.78248884358093517832 -5.8478967865684836624;-5.1315474521131303476 3.0574422418146993685 0.098573874882959183763 0.16914941894435758796 1.1614271255709212038;-5.9204420338872703056 0.37894543230906574394 0.11534015618691381699 -3.9344868295330841512 0.9740972718959884924;0.94621159974841451135 -0.012555641238703932686 1.4795246884453887581 3.329221233135553959 -2.7675933448330005682;1.3127042486028803747 -2.8119557348381731821 -3.0596791091210193692 1.6887800788094149418 -1.4157770016270194713];

% Layer 2
b2 = [5.285895939683817879;3.9121094753685823342;9.3806373615024867263;0.50136295955493503929;-3.3134924877043676616;1.0667178195290241138;1.2145640731944702395;-4.6969672873597971829;-2.1112231287870932839;4.9640040820650748188];
LW2_1 = [3.2591815115417173132 8.0481096987692843925 1.2298442130273490314 1.0034174269672977431 8.4494304197463598882 1.2686980114790979979 -0.69997467517469702525 -0.26247845826414095693 1.4247114104385731892 2.3898348344185724734 0.14034763583222550909 -6.935721364150269963 3.6883445467546072116 13.733318140515155648 0.099583104953382420299 -1.7454008885016685237 -7.580054566674317762 0.57953821540713701399 -1.1996801915045465226 -5.9074629531306346308 2.0354552397388756546 0.41821433544492009338 1.5641959436214618595 0.49566472807886513552 1.599320272210995153 -4.1998352459615926335 1.1913510901586952251 -0.24304483062929216342 0.85428636373947108851 2.3476104660389829348;-3.2795392731959518429 -0.72702147393734439795 2.0726636103022109126 -1.0959772934993097238 -1.6507151323057493997 4.0150748521169967731 0.64473782304049431779 -0.038215926227569231577 0.32423308844786258298 -0.81795586146953958018 -0.93943336635381713418 7.530773732138767329 -2.6747368129881654575 -13.497717540597239605 6.205119271327009578 1.9827072164313743752 4.1165200973103264204 0.76581363223908860416 -0.204234291520186656 3.4616198758159404392 1.8127293410172169441 8.6559217707573736789 1.0271737860380569796 2.7255006472230625114 -1.9187261385346918718 6.2912070782363453958 -0.9223561202577974516 1.8647622968850030567 -2.4203925614643333475 2.0805032602140220988;-2.2837193027504936182 -1.3330540176127760876 1.9092546893642277084 -2.1715292595326909364 -1.8421891457276404758 -0.61240984168373202579 0.42651669231107131042 -0.044906247190613396425 0.11708368427238827203 -0.97943931254486060745 0.00022152114960399924178 -6.7198770571662160833 -0.98910394291332015548 0.83962200417734311753 0.43510661258024802001 2.3779673556173328564 0.14785804602688451537 -0.1098415116750097037 -0.086927546112798473321 -1.7050354714644309073 -0.98557398664984663395 -2.33089662338240311 -2.2378208853476397877 0.17244268570097934234 -0.13957299271326947809 -2.48429228118695411 -2.4919869756425905294 -0.24350811732466318138 0.61779929943504763301 -0.67245619077292251298;0.34830322300365840205 1.423777133502629022 0.75576714108415987692 -0.19060519240316181611 1.7121886700877624321 0.20531688531282518695 -0.054073928970134459149 -0.12667250906538971011 0.015675763838694914409 0.28253699283270095055 0.047288828543818654804 2.6489925019124704875 0.29356949391082787226 -2.631528767062069285 2.1003119299925407937 -0.043865233143197075727 2.8454686916794065255 0.13985486078886200101 -0.00021094987667833950407 0.0054841096584737130878 -0.17089289395754014844 -0.92672573104526656529 -0.17981755720157127643 0.60771876722041007213 0.20558888105772393784 -0.45777583734938837035 0.019871132884288000148 -0.1313202425171298704 -0.0076318416077133435088 0.13562037774669968848;5.2274476060549792678 10.397312059964477271 3.392619901142573724 1.5110827055028606125 6.801934222446945455 2.0068525159088057563 -3.4291659819033921686 -2.6666106099624062864 2.1886260947542734989 7.788837399548418361 -0.78933684076638366278 -21.969320243184547792 -1.1263695706989205192 15.545371933516832996 -8.9694385366311539798 3.5356357401100515503 7.3866540117457653025 0.034167037926233677358 1.5331338876587554676 -5.4956165179543488009 2.9612196877316110388 -8.6194894193092750356 5.0335518065758568795 -2.9969760944773531364 0.29970130069009476292 -5.4584731340605712191 0.94332759087076278881 -2.9700175727716668916 1.4170155729259683586 0.29235624881893640392;4.2825667761943666534 7.0951635909231365318 0.48137796231707324912 5.1185897747362067989 2.0280583350487169092 -3.6582028486181479288 1.9535594277204779701 -3.1703658150026523543 -0.22133518401189167246 -2.9817029751373560487 0.12882187086857249669 3.3980717188322331346 3.4580281295019563714 -10.35128787659368399 11.118923822336743257 -1.5029229979204554724 -2.6208078347443901635 -1.268744802841354602 0.86906776879587410711 0.91671177087792055094 -0.57926197176610794148 5.5498062999190063138 -2.5036145644697436197 5.1361267983227740785 -2.7081246702427925754 3.6801367060964946809 8.5336551318469648919 0.75654929612356658364 -1.2600600067493847867 4.0184783924228169028;-1.7555116275451159158 -6.1872102826202119985 0.50695892878188741904 -2.2508389149420184872 -5.1280461183396113256 -1.3054072891448100791 1.2666349703151185135 -2.7095427118665278421 1.8304745184632182919 4.6785094650586058762 -4.6634024345192006678 3.537963310303021025 -6.9094369924046397102 -18.68183166157956876 5.7706425149648863382 -4.4986198972986697342 -10.26040789454058455 -0.25921329817252630745 2.3393355504723429839 0.67947967533070341428 2.417744759946494959 7.0476507769192320296 1.2912501729428373931 -0.53307750605615411565 -3.5257941629414717433 -2.0493406557464219908 -1.3387612344172248324 -1.0094246458953659573 1.2294286294802423409 -4.9017946856365428587;-2.2010855423739927872 -0.80199576291584073751 1.0093642739805703812 -3.9887084700649038105 2.5439913527183346531 -0.29953213705040526715 1.574054844128104147 -0.60852403753157213728 1.7384683266533484947 1.5726801675630897037 -2.6653974493867154116 -1.6622703238768887779 -4.18663643769992877 -2.537213077223357427 2.812413226104716113 -2.4337206726262565759 -3.6424209542543271034 -0.32913720755246406169 -0.020762083625250862123 0.29423184519258210878 0.99587580768372363504 -1.3337934922861971465 0.60961597744061835069 0.060596284309824874348 -0.085776719992268490866 -4.5498986011010540409 8.2473361276331900171 -0.94555858221311273049 1.6795054337485904039 0.68687698758033166602;0.949221981542737403 2.2987123597717267209 0.4100788907199832134 -0.17437583032355152834 2.7475384387210763926 2.387709682345062312 0.29530566732703922295 1.0093352102626762523 0.31594955412239433823 0.58241082925303666595 -0.10667326886939601516 4.2434164192358725387 -0.24380364491500225443 -3.3689966617913653657 1.5777527371885380347 0.24571773909274557957 2.941558523425962246 0.21558404885980847476 0.30424449840019657243 1.4299762868547420958 0.76921232196952371574 -1.4078591452427631214 1.7019151641871528291 1.4136774383573362801 0.86150128632040579024 -1.1873540337080890072 1.1052134967112643427 -0.24437530220256267754 1.018646609555875715 4.1636122453095545382;1.9886092609960563937 -7.7102256529748771641 0.80012543560800375442 2.5648858687187554573 -6.0925516170575733099 -0.50085488432577207618 1.0475146623625413156 1.5143949048065608043 -0.80412710308658297276 -1.0629020586531914283 -0.19383336358199454441 10.623040499021136895 -3.1473757539126112626 -12.320679071789571779 5.4647043421403136421 -0.58659125780259946392 -4.7414498781314593501 -4.9733720127245044651 -0.38111315462016637223 -0.81324910416409879055 -6.213687188292656316 5.3185556039945041107 -1.9521946759972457208 -0.70488007332054158915 0.81841910238246862175 1.5715268495633019086 2.220401711516098775 0.13088751209862581337 -0.17595819644179563901 -0.31216135263663125077];

% Layer 3
b3 = 0.11206511478832731354;
LW3_2 = [0.16788416219572815935 0.057734581632634555948 0.26843943635485578714 -0.39327545403642416577 0.03352400773528558392 -0.043970085805390385358 0.054573749330204070207 -0.072536694208551494301 0.13007148244695418415 -0.086287160953912422912];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
