function [Y,Xf,Af] = ESPER_talk_16_Other_4(X,~,~)
%ESPER_TALK_16_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:52.
% 
% [Y] = ESPER_talk_16_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.0362683153536478;-3.6416119129430062;0.40809134253620871;0.13831584000172054;3.1011024350396368;1.572020907191388;0.2249937496062395;-0.7304911328085405;1.5597734058528085;-0.8962171266084028;0.9441967881486889;-0.047923920791882305;1.0853820100901101;0.68564371492862275;-0.54264487121255689;-2.6539832015802425;1.0186402281992815;4.4857071423169508;0.45318376157238355;2.7876663223604412;0.39007834719808648;1.4264662957491847;0.48796363881580435;0.40652298920843177;-9.8474945626052381;2.3876974947263991;4.9091020475289486;-5.058227282767545;3.0145894418248966;-3.8031925810931497];
IW1_1 = [-3.1050858352278969 -2.339641826072981 -0.029477235022979536 0.1968480039546498 -2.0696127350548115;0.36614957663223913 0.40251033144911891 -4.0091633953621466 -1.1647823074137162 -0.75020884350716499;-0.50459703996058813 0.62688192961430689 0.46500575994452115 -1.2031816466427494 -3.5958714131085827;3.1176093092517729 0.088168853613701165 1.3322068697701377 0.20358488297636299 -1.4966582910586355;-0.45039312818121674 -0.59147679990103419 3.0314436135071845 1.3201076689755629 0.76324830945488664;-2.2364122545128886 2.8849323098790398 -0.25933032907818726 -2.5804685169853201 -1.1850935581320476;-2.137705381515647 -1.2126432649335532 -3.2456432850859738 -1.82847501296587 -2.0961357050767009;-0.59187071824482107 -0.026798852664200734 -0.79834814005138288 1.3856280278324729 7.3518967610030712;-0.58366952059005983 -0.7674628966813265 1.7682783278465761 -3.0462481054914461 -6.6770928109126721;-0.83772272431693051 -0.20496401976226544 -1.048201211346351 -1.2284983200818842 0.67509293074561616;0.64280133563376163 -5.7925754307564024 -0.72325476609678008 -4.6568966236347675 0.48356742263625185;0.2294024631989027 0.1963279188956347 -0.14453588244047438 -0.84341341962894378 -2.8147344907367935;0.95294909248009807 0.05993852373197911 1.008632284106006 1.3532596196656519 3.7092821827826414;-0.016337126973652086 0.021479362336746275 -0.4825279311139859 -0.025667052956518461 -3.1280020087999958;-0.050190036758864014 0.0037192569709117748 -1.124402621682671 0.87926078899074267 -0.23376071190871481;0.91053853644691818 0.68925944934277594 1.3348751395304923 -1.9117300357512426 3.1795559512304963;-0.08805652434786812 -0.15450792206454836 0.080930170405159624 1.003204045577814 -0.63339230331746221;0.3044345760510942 -0.20927451504070896 -7.1439569150487481 2.5300900312072012 3.0933295691023703;-2.7401250125492846 0.10475469639036303 -7.205654577687044 -3.188382530652452 -2.0988229409474117;-0.037524214736110298 2.1041471529590887 -2.0742739471276201 -1.9219672929705971 -2.5740572504873183;-0.23462340596533132 -0.10486342091776045 3.1512954463976266 1.9574659954147688 -2.031014258922113;0.028325942289824782 -0.36328439375794008 0.29794646637137367 1.8410172419961592 -0.34795510172678962;0.20000956216998397 0.55051534957564086 1.3138649082152656 1.0262204520160392 4.7198678386272581;0.20531344060562429 -0.45962061039132057 2.6302548177218341 -1.7112267055709744 2.6823111930844634;0.3222197407291002 -1.7930603339684923 1.2202844424547461 -8.040762843036978 3.0751396950337169;-1.395383313809955 -0.91162654629946505 0.091951605472917683 -0.78248884358093518 -5.8478967865684837;-5.1315474521131303 3.0574422418146994 0.098573874882959184 0.16914941894435759 1.1614271255709212;-5.9204420338872703 0.37894543230906574 0.11534015618691382 -3.9344868295330842 0.97409727189598849;0.94621159974841451 -0.012555641238703933 1.4795246884453888 3.329221233135554 -2.7675933448330006;1.3127042486028804 -2.8119557348381732 -3.0596791091210194 1.6887800788094149 -1.4157770016270195];

% Layer 2
b2 = [5.2858959396838179;3.9121094753685823;9.3806373615024867;0.50136295955493504;-3.3134924877043677;1.0667178195290241;1.2145640731944702;-4.6969672873597972;-2.1112231287870933;4.9640040820650748];
LW2_1 = [3.2591815115417173 8.0481096987692844 1.229844213027349 1.0034174269672977 8.4494304197463599 1.268698011479098 -0.69997467517469703 -0.26247845826414096 1.4247114104385732 2.3898348344185725 0.14034763583222551 -6.93572136415027 3.6883445467546072 13.733318140515156 0.09958310495338242 -1.7454008885016685 -7.5800545666743178 0.57953821540713701 -1.1996801915045465 -5.9074629531306346 2.0354552397388757 0.41821433544492009 1.5641959436214619 0.49566472807886514 1.5993202722109952 -4.1998352459615926 1.1913510901586952 -0.24304483062929216 0.85428636373947109 2.3476104660389829;-3.2795392731959518 -0.7270214739373444 2.0726636103022109 -1.0959772934993097 -1.6507151323057494 4.0150748521169968 0.64473782304049432 -0.038215926227569232 0.32423308844786258 -0.81795586146953958 -0.93943336635381713 7.5307737321387673 -2.6747368129881655 -13.49771754059724 6.2051192713270096 1.9827072164313744 4.1165200973103264 0.7658136322390886 -0.20423429152018666 3.4616198758159404 1.8127293410172169 8.6559217707573737 1.027173786038057 2.7255006472230625 -1.9187261385346919 6.2912070782363454 -0.92235612025779745 1.8647622968850031 -2.4203925614643333 2.0805032602140221;-2.2837193027504936 -1.3330540176127761 1.9092546893642277 -2.1715292595326909 -1.8421891457276405 -0.61240984168373203 0.42651669231107131 -0.044906247190613396 0.11708368427238827 -0.97943931254486061 0.00022152114960399924 -6.7198770571662161 -0.98910394291332016 0.83962200417734312 0.43510661258024802 2.3779673556173329 0.14785804602688452 -0.1098415116750097 -0.086927546112798473 -1.7050354714644309 -0.98557398664984663 -2.3308966233824031 -2.2378208853476398 0.17244268570097934 -0.13957299271326948 -2.4842922811869541 -2.4919869756425905 -0.24350811732466318 0.61779929943504763 -0.67245619077292251;0.3483032230036584 1.423777133502629 0.75576714108415988 -0.19060519240316182 1.7121886700877624 0.20531688531282519 -0.054073928970134459 -0.12667250906538971 0.015675763838694914 0.28253699283270095 0.047288828543818655 2.6489925019124705 0.29356949391082787 -2.6315287670620693 2.1003119299925408 -0.043865233143197076 2.8454686916794065 0.139854860788862 -0.0002109498766783395 0.0054841096584737131 -0.17089289395754015 -0.92672573104526657 -0.17981755720157128 0.60771876722041007 0.20558888105772394 -0.45777583734938837 0.019871132884288 -0.13132024251712987 -0.0076318416077133435 0.13562037774669969;5.2274476060549793 10.397312059964477 3.3926199011425737 1.5110827055028606 6.8019342224469455 2.0068525159088058 -3.4291659819033922 -2.6666106099624063 2.1886260947542735 7.7888373995484184 -0.78933684076638366 -21.969320243184548 -1.1263695706989205 15.545371933516833 -8.969438536631154 3.5356357401100516 7.3866540117457653 0.034167037926233677 1.5331338876587555 -5.4956165179543488 2.961219687731611 -8.619489419309275 5.0335518065758569 -2.9969760944773531 0.29970130069009476 -5.4584731340605712 0.94332759087076279 -2.9700175727716669 1.4170155729259684 0.2923562488189364;4.2825667761943667 7.0951635909231365 0.48137796231707325 5.1185897747362068 2.0280583350487169 -3.6582028486181479 1.953559427720478 -3.1703658150026524 -0.22133518401189167 -2.981702975137356 0.1288218708685725 3.3980717188322331 3.4580281295019564 -10.351287876593684 11.118923822336743 -1.5029229979204555 -2.6208078347443902 -1.2687448028413546 0.86906776879587411 0.91671177087792055 -0.57926197176610794 5.5498062999190063 -2.5036145644697436 5.1361267983227741 -2.7081246702427926 3.6801367060964947 8.5336551318469649 0.75654929612356658 -1.2600600067493848 4.0184783924228169;-1.7555116275451159 -6.187210282620212 0.50695892878188742 -2.2508389149420185 -5.1280461183396113 -1.3054072891448101 1.2666349703151185 -2.7095427118665278 1.8304745184632183 4.6785094650586059 -4.6634024345192007 3.537963310303021 -6.9094369924046397 -18.681831661579569 5.7706425149648863 -4.4986198972986697 -10.260407894540585 -0.25921329817252631 2.339335550472343 0.67947967533070341 2.417744759946495 7.047650776919232 1.2912501729428374 -0.53307750605615412 -3.5257941629414717 -2.049340655746422 -1.3387612344172248 -1.009424645895366 1.2294286294802423 -4.9017946856365429;-2.2010855423739928 -0.80199576291584074 1.0093642739805704 -3.9887084700649038 2.5439913527183347 -0.29953213705040527 1.5740548441281041 -0.60852403753157214 1.7384683266533485 1.5726801675630897 -2.6653974493867154 -1.6622703238768888 -4.1866364376999288 -2.5372130772233574 2.8124132261047161 -2.4337206726262566 -3.6424209542543271 -0.32913720755246406 -0.020762083625250862 0.29423184519258211 0.99587580768372364 -1.3337934922861971 0.60961597744061835 0.060596284309824874 -0.085776719992268491 -4.549898601101054 8.24733612763319 -0.94555858221311273 1.6795054337485904 0.68687698758033167;0.9492219815427374 2.2987123597717267 0.41007889071998321 -0.17437583032355153 2.7475384387210764 2.3877096823450623 0.29530566732703922 1.0093352102626763 0.31594955412239434 0.58241082925303667 -0.10667326886939602 4.2434164192358725 -0.24380364491500225 -3.3689966617913654 1.577752737188538 0.24571773909274558 2.9415585234259622 0.21558404885980847 0.30424449840019657 1.4299762868547421 0.76921232196952372 -1.4078591452427631 1.7019151641871528 1.4136774383573363 0.86150128632040579 -1.187354033708089 1.1052134967112643 -0.24437530220256268 1.0186466095558757 4.1636122453095545;1.9886092609960564 -7.7102256529748772 0.80012543560800375 2.5648858687187555 -6.0925516170575733 -0.50085488432577208 1.0475146623625413 1.5143949048065608 -0.80412710308658297 -1.0629020586531914 -0.19383336358199454 10.623040499021137 -3.1473757539126113 -12.320679071789572 5.4647043421403136 -0.58659125780259946 -4.7414498781314594 -4.9733720127245045 -0.38111315462016637 -0.81324910416409879 -6.2136871882926563 5.3185556039945041 -1.9521946759972457 -0.70488007332054159 0.81841910238246862 1.5715268495633019 2.2204017115160988 0.13088751209862581 -0.17595819644179564 -0.31216135263663125];

% Layer 3
b3 = 0.11206511478832731;
LW3_2 = [0.16788416219572816 0.057734581632634556 0.26843943635485579 -0.39327545403642417 0.033524007735285584 -0.043970085805390385 0.05457374933020407 -0.072536694208551494 0.13007148244695418 -0.086287160953912423];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
