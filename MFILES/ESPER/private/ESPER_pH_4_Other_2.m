function [Y,Xf,Af] = ESPER_pH_4_Other_2(X,~,~)
%ESPER_PH_4_OTHER_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_4_Other_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751;-0.1386];
x1_step1.gain = [1.0000770825255;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0588888685539285;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.7181265839521868699;-1.126175625183139406;-2.1321769723744430358;-1.6488955452450817507;-1.2634287772980929976;0.053738987827705406164;0.96747738801363369898;2.5329344737166969992;-2.3931454409999846078;0.077140224263443551989;0.80200967826849067777;-0.31999700373185291369;0.050729308150783442022;3.0881882016573216632;-1.2949448219985515429;1.4294486577822165252;0.59876660675825721381;-4.6386967120833517697;-3.2303963873671537321;2.3600926095574950025];
IW1_1 = [1.2559063899396472053 0.6073118315642587195 2.0218423383713921559 -1.6146890052309696983 -1.7285572771601696029 -3.0459496294557468765 0.7779227639161131469;0.67570345707531997981 0.59515091052047486286 -0.92171061255591701933 1.0000020220437459972 1.5680085371298371211 -0.75242154537440075757 -0.18739669910810843878;0.14463322997794597624 0.24402008512799081008 -0.53910703072631427357 -1.0479551291861814999 -0.075249833782892155964 0.088211375771398425893 -1.2502457730639315869;-0.31016576251007577092 -1.3004700374453326273 -1.7077899465406474189 0.010248079918678673281 -0.12731212426105717461 1.6627249289557588519 -0.35733702680786105788;0.84450854800402164191 0.25458344126426168952 1.6046572605974405157 -1.1567726697088092092 0.61910507523526292495 0.77416752502844699002 1.3853489012824125037;-0.14967622548430511986 -0.19669530378176530716 0.64619308821170806656 -0.87876622066679010992 -0.014909202387654810901 0.95532441508961607468 0.9600840501944569727;-0.59403192696505435766 -0.298723686882120254 -0.65982105560621873153 0.95888823342949103257 -2.0749609878414161379 -0.15115022169509836902 -1.985843958488099803;0.30402691703041040405 0.055200513951168081461 2.2335213369129900407 -0.82747388852963332795 -1.371719896670320793 0.0715068142419696684 3.3839216660096060885;-0.4210004158833412502 -0.079518037190560761363 -6.0598092416506093016 0.94722682289178561366 3.9083382810072513358 -1.01035009566207723 -1.3907212937265303054;-0.28842707128407102379 -0.31398765604337391943 0.056309259163929550884 -0.36281004705329106264 -0.3926346874251105401 -0.90383664437626254351 1.3261129057841456458;0.054210763814412657458 0.077393849656050825447 -0.11394466640980741023 0.22820661775006712002 -1.034494923939639266 0.83905163177030750443 -0.27370114988746824247;-0.10823549498946390124 -0.2637257351281634965 -0.66739449519862070748 -0.55569858096691437943 -0.065348249401206912057 1.3053207699760520644 -0.61654457612442425951;0.58262766298586510239 0.2852984745880057238 0.067855661476093676043 0.4713421085421413137 1.2402704761135627809 -1.0941572566422657076 0.63761434283153828328;0.43539667421782812795 0.1423945236947724291 2.0394310635893919681 -0.88185519811574097915 0.77932903112840845594 1.5596418472510675812 3.4155357330726046072;0.32808423542948916829 0.36331019714267343002 2.5342237267728471295 -1.7087932632021760604 1.6106054704047314541 1.0370770262962931696 -0.16439111297761738184;0.12946575908663121579 0.26857791255811436226 -4.7093827724481922559 -0.52646454483395932478 0.14697824641307513649 -0.22232481891476094105 0.46853481801691099218;-0.018800711097211913331 -0.32269439665771865178 0.40479728476151261019 0.88259066009245068507 1.4406809231192585496 -0.82595800720287659846 0.80874975573288276909;-0.056117360749610413484 -2.1109035855451772079 1.1230443089807611301 -2.1338613532964378905 -2.3297125041085378072 -2.0470714544700148174 0.16686225878702107273;-0.98305934914849224526 1.1851858616942894109 2.6852674614962808164 -2.1728929738482465339 -0.38893482130223638871 2.2187221574010691505 0.254783502721151911;0.081410449571893098164 0.38243354068282037206 -1.0400584981060871925 1.242934160876695282 0.17767788021863667458 -1.4003821126470652469 1.1699437549854712071];

% Layer 2
b2 = [2.9277128542483845663;-2.9090987769312959266;1.386151623779310782;-1.6358792974990925551;-2.9117013133965130578;1.3435453209834957722;1.4708361097760167535;-0.8617854787505400127;0.25091494033915684447;-0.25739723511051876281;0.62016745415867458036;-0.5757893378703961007;0.18453478476254861484;3.0434390944518665556;-0.72981123308832962504;1.2788916740851727916;0.10847287094496625703;-1.2220832212297556563;-0.0765729362437864991;1.2127287679053961877];
LW2_1 = [0.10695771389413720465 -0.93147538376805338878 -0.79652795345000693139 0.5793336498518538713 -0.8091796560016442097 0.9158524557411447109 -3.5476728679095037577 0.72264865896569629999 0.17433929555727212257 -1.4383437426581104912 2.7318938563700596589 -0.92134507264680942651 0.79957409953424540827 -0.24972984928936184379 -0.79741829703167754761 0.33097726038797464776 1.521569603246727187 0.13715304639806530362 -0.1026683058208024274 0.51819103136843402968;1.1394207427593281423 0.51803217075997010088 -4.5117179144823955639 -0.44313796749444300804 -0.24837097686156320298 -2.1635227682642663716 0.57233268056199659846 1.5242034975490119653 -0.13421803982616281603 -0.07768777857458818159 -0.78515526107056510252 3.2403181226670767501 2.2717422727040670338 -1.7501629204910518212 0.54820595160747476182 2.375466200124813021 -4.1385009253294731124 0.88739640839129763084 -0.42996862296218962829 -2.0066689219920390563;-3.3032229992078421255 -1.457768709643704641 -0.4336298293957240868 -0.11397904091427990547 0.63062353427009909534 -3.5121251038278105128 -0.9428752765932570945 -1.1040481342816446109 -0.9702317708568533039 -2.0811463451598397612 -0.21352554321669819926 -5.4231222532634584255 1.3492787997748882933 0.81171510564294269141 -0.39160693840079252581 0.12521350932507230302 -2.0118838989248493121 -0.43103784434311515072 -0.008318634931525542564 -2.1974785304370554329;-0.13732983636939818939 -1.0106133206690053328 0.12415089587423271122 0.15553237924708376849 -0.94275594519995364884 -0.53322558442383660715 -0.34203571969481932902 -0.24223060891240327797 0.061165087165742655639 -0.17513388748881023038 -0.52309215486745219703 -1.3104839350598760372 0.31393339462975561327 -0.34327403606408030123 0.63964862159431234989 0.13722486310530840337 -0.1193229130325700188 -0.16561546105044674948 -0.0048370883776513717844 -1.33792664248430615;-0.21818564140677970675 1.0130919491368410856 0.87112770559826213645 -0.30530444436896980731 0.75431973321222678397 -1.2867247770527636686 3.1713656742619260598 -0.82608782906270150637 -0.13971697894006715468 1.645835461072780781 -2.9239444023075638057 0.87979385928428477381 -0.93741347586152412585 0.31693033248796920187 0.87350377123385447575 -0.38185586561262790939 -1.6596763911931255997 -0.57660870839186106895 0.18342881175986799902 -0.63077384779677148074;-0.39188049212186437664 -0.16793652361775021631 0.7435539240695753227 0.0046256258138244361888 -0.25851774478237038446 -1.7577981799250796957 -1.4639293713491738913 -0.50093846702208677524 -0.8704709377780048829 -0.11313273497916852273 -1.2924200731839392553 -1.4726787526991311772 -1.8617606012915401958 0.59759758515623861985 -0.65050278163439323453 0.41815451287322591423 1.8903547275400793826 -0.036941181113581342266 -0.59324570774685014829 -1.0311266115833206403;1.1832101618762336237 -0.060773242144005243381 1.919242218134076694 -0.27591345990805271615 2.1715203343538687086 0.15783313133977022735 1.2687850841584249473 -0.20951240720158437192 1.1413676141628859018 -2.1187615030471356192 0.51118490488519652271 -0.4204286546008254577 -0.48574946969462984292 1.4512690651476201076 -1.1042311031727145565 0.57492854116446878709 3.3748995547738256384 -0.18001725740399165954 -0.68268436743120364252 0.17713050845638222963;0.57715496848776803862 0.20007508500162621279 3.2940991897378069098 0.098449337743509987564 -2.3876455855748535129 0.54257038013808356336 -2.352773151236169813 -1.685325659732432424 0.39515212065479521364 2.0859139050913579894 0.98680751521098197809 -1.5165056250000839011 -1.5233005037753872823 -0.45592560670912851695 0.78305868471600326153 0.25793456996125097014 2.5249091102601810555 -0.22767664937712411843 -0.13315174307823807176 -1.2517803032348084891;0.11765825645621087736 0.89447797899859382564 -0.027865846570408997485 0.25727709803234172226 0.73914317726712852608 0.74500357448714782382 0.85203131125710829252 0.75728045810098376656 -0.65893909770280278959 1.1269786890647499611 -0.34126994210098970939 2.5765340651550205919 1.2075999431301958076 -0.33324712433840086856 0.26682311905673583574 -0.12157372510313821379 -0.73110543390654436635 -0.06580539065353607775 0.41921779060319097621 0.99417695953435913925;-0.022897920686075757396 0.33439629100805029482 -0.0079147679553428981758 0.088457559142420483234 -0.93373901988313745548 0.11534201468667712454 -0.33202873278238193011 0.4448332121321942334 0.13498713965692277217 0.4582280637311655358 0.54555756805086852435 0.35653666188363097866 0.056853411497401883101 -0.27189922938141219966 0.42976301917070725001 -0.20747192318556331725 -0.58696040412262162622 -0.43632695221064132785 0.39552685275630217188 0.4952129256741958363;0.34311549576469491107 -0.30467155131159695536 -1.6569778998691422345 -0.32137691841143450899 1.3012196784169551833 -1.4642651481911492795 -0.14427748331622719524 -0.38122771432529189983 0.21038026095604345223 -1.7028721012563634574 -1.5291706784807042041 -0.39592202449437674527 -0.38423897523642452922 0.86209944522406267708 -0.65955868216872404197 0.11428194691390668181 -0.45978492057571068719 -0.43429426266878917717 0.039715806281951031298 -1.3872072960221744076;-0.64856817177683057096 0.98406179142032279561 1.3466940859949005915 0.48623831140229045733 1.3843803133462966315 -0.18882626042579661596 0.37977544208236163614 1.5179257258254987839 -0.34550548015177251493 1.4851624333311168602 1.2040527186056806386 1.7121624871940444024 0.32157906749947395841 -0.87557842304903676922 0.13307475265669571618 -0.78827639327312470918 0.32627818032905409051 0.64135753146261065272 0.07302222816265088734 3.2429728966871835816;0.13893978927025990577 -0.20924328727280105955 -1.2192694197914033527 -0.4323692835922194333 0.69354786210996222096 -0.39839708081183894395 0.47503420222412695573 0.055609803453104698912 0.017381866807089134397 -0.89549494759414316469 -1.222923245828813732 0.35012285929618475189 0.38531160608303444137 -0.24536621849287598707 -0.10262205122169701377 0.074210142717205038188 -0.58019002854798307212 0.14411872096192429593 0.15373507343337972086 -0.60500170906199746135;-1.9560557772897340101 -0.04887223055516124598 2.5851684297981818439 -0.75644657788455593739 0.25773398834701022331 -4.8081260096939590909 -1.3431407217484085947 0.20212660349433184126 -0.052884993157818707687 0.024859704123039415291 2.7972716801025012678 -3.0868895584256463849 0.16521357015743273755 0.54778302743287088372 0.60800710177537165002 -0.81408476303915566774 1.7873623464269452477 -1.1701095560814493979 -0.84010771221450597501 -3.6093718335049733703;0.41645691575269649931 1.733801872930385457 0.03984913736056631961 -0.010303873825742344145 -0.83016011556965363383 2.4809586100727321067 1.0949431449768878277 0.79861529522235930045 -0.78280791791918802325 1.001972446474542755 -0.19350245627003564985 1.7000652215940079692 2.1749874215494950924 0.31916058045305439883 0.4109210184623192097 -0.015001877904036025127 -1.685911645007839077 0.48896630615307479228 0.46226235626405498547 0.44011915594570938381;0.78689555985703696361 0.51748591136474386687 -1.4932776664932565502 -0.27261711579701725094 0.60966346300063378738 0.6342408216193052839 0.45090179063156754502 -1.278528675656067648 0.42398645803879903005 -1.444865081398667872 -1.7269240875039910676 0.057205106220518511795 -0.70578470172894625101 1.5736125840602697146 -0.54153476661222998967 -0.19890566547083574078 -0.75736796714475040915 -0.47295038104971609538 -0.32874659801243555357 -1.0174506379571728321;-0.018034033383712951698 0.11995308681447909571 0.87517171506940016901 0.13293562238352843452 0.808751152365030479 0.50444820654309707741 0.20141897190879276547 -0.49951728383663540622 0.068904571624073138181 0.34515915409195646602 0.90452010357825796127 -0.078825373028314812962 0.051265696509480915277 0.52893392002043959632 -0.34444365431379009301 -0.048877816002374126214 0.66562314928468391262 0.41797598929789675504 -0.40227499469252925302 -0.034068315677534849462;-0.26903186464367329078 -0.60014514649404027136 0.48500163234036453019 -0.1062532426620151349 -0.19183490463408528481 -1.1882664297152010224 -0.53837876134356399405 0.038904527248055709165 -0.18671100964843670433 0.4592396440180303574 0.73343327337573549496 -0.96410720576805220006 0.053272002174986454737 -0.30033238155950314763 -0.041051437830772204152 0.10466283420172314833 0.3357138838214617782 -0.16059177990193523877 0.3421042997845792355 -0.3138298166192484695;0.65232490155030908863 -1.0061109803589689538 -2.7064937797441719347 -0.2485699840952808326 -0.84048310821483096511 0.088670280498727965801 -0.0059164177729146127244 0.36250666891969668404 -0.088285872138288506994 -1.295395713145865102 0.069540715944913830682 0.5944621958000919637 1.4491398961689603286 -0.02215755272420023847 -0.18268109842718138758 0.03805313964804971083 -1.0200020651484287271 0.8649289766629340015 0.18062554489588145135 0.65630019895742452984;0.069510098831900707372 0.50008507011149117005 -0.55779496538145156848 -0.29120167641316585527 0.43728813485000722627 -0.24233634546689589162 0.19156130217141331684 -0.13593221228461538352 0.21352806015010888929 -0.17943457815295660307 -0.53656010846957269411 0.33914212423272904751 0.18057727338933951544 0.053315069308527210379 -0.23915708504188218364 -0.52341497612527376759 -1.178340748037781216 0.25505317429361640258 0.33212071596132985984 0.41294159281544445816];

% Layer 3
b3 = -0.88703012286631344185;
LW3_2 = [-2.4915202511606384661 0.54730117511944953446 -1.6561833846017524063 2.461119138466827394 -2.7024598481487496215 -0.56136048832039642242 -0.52737242634857084411 -1.0288772843094147191 1.0666734468850489481 -3.2894191782623272147 1.3921149869645164099 -0.72139732269098477691 -3.2860275483540628549 1.6460257434401723842 -0.78361980756305349427 -1.1666081648863739773 -3.282409059825328157 -2.1584296656055430574 -1.3830883996329528252 2.1064924520869294788];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 1.90239167587468;
y1_step1.xoffset = 7.36300175998845;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
