function [Y,Xf,Af] = ESPER_talk_16_Other_2(X,~,~)
%ESPER_TALK_16_OTHER_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:51.
% 
% [Y] = ESPER_talk_16_Other_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.1821672873237383;-3.0877995332981327;-4.223575915407463;3.1562495658209229;-0.34563722569816041;1.2051128518907708;1.784893025235716;3.3893058718258149;-0.45522338726510986;0.71230131081071846;-0.68723558832839082;-0.49685803142380536;0.23932685208448606;0.053462191841555505;-0.54666302744406925;1.3296830420024413;0.75069684344885057;-3.0349123629819372;3.6276958529982668;1.6464845296887545];
IW1_1 = [-2.435259393889794 -0.23115156536278189 -1.72699919971139 -1.2658100110734034 0.22634375530558648;2.6416224588657946 -2.2044215211234377 -0.25448073036926111 0.99251256479902294 -1.7944744307065013;1.612612412129182 2.9429654460177579 1.4481877929832634 0.56380131444999237 3.3385253355817421;-1.5075370909521946 1.576949102116816 1.5159397122948326 0.34567903973385017 0.30172447285319737;-0.33008350999916958 0.32969395655833461 1.2946086265003593 1.6200791846316847 -0.89636736696543917;-0.43294144207300589 -0.11103914193167805 0.87504653647469643 0.066788798684455572 -1.8363741766385584;-2.8943123006405349 -3.0954553746112787 -2.1834944328951957 -1.0697286099185426 1.8709140630263157;0.10979799865459088 0.094548200984915495 1.1479695111666011 4.4708422771790168 0.053826311949288268;-0.20734749054613616 0.059198548327248704 2.0073780846168927 -2.467010321967166 -2.2791121673987846;-0.54222932724023298 1.2060543436978934 3.4800748693800991 -1.2239125425373172 0.15325296627319321;-0.66313995702536965 -1.692129447472694 2.868650031318785 -0.99531504104431534 1.1965048834498524;0.63349759677576989 0.50845408989184171 -0.30160676471970682 -0.57385858949753721 1.1627782993568796;0.23989919134199067 -0.045006566798732835 2.9766957644654437 1.6079989543980167 -2.0236942925289658;-0.15896718245608171 0.44600603443011005 0.075874750342490097 -0.23762669930531874 -3.1018636989271604;0.038986306365618194 0.10057273730749983 -3.1373057555049737 -0.9965798284107088 -1.2954382905199855;0.60978187284544183 0.50380805461713551 -0.28252385829007914 1.2750608987961751 -1.1112862110214075;1.8647816593323863 0.98676908092839244 -1.6126946027468452 0.44613804646981775 -0.8927568341945834;-2.3990138816431057 -1.8309975858339034 1.3299500121554613 -2.4289180300451938 -4.6238019499817975;0.66314680105212032 -0.61003575534628363 4.4922213827013096 0.36378904021587116 -0.60838465535087261;0.62358268553294538 -0.33083732837582441 -0.39563004896314979 -1.8285864279479613 -3.0296349989090068];

% Layer 2
b2 = [7.3371716726720839;0.60516227054603444;-0.57372226264884008;0.59409459309652746;-3.6020546398246611;0.16474871556867537;3.9727244720157424;-0.490526486611775;1.8269179821825177;-1.0822180397256007;1.1196334571736524;3.3717869669870528;1.8800381731857845;5.6683658147055622;2.6892767282081698;3.201786333115574;-5.2426667124420847;-0.43787480150329466;0.069155271623171172;4.3377552334928708];
LW2_1 = [0.67663654847329602 0.46352285068633126 5.5331317665703894 0.32210395725088348 1.9321534444051769 0.5648485104472285 -0.14413530225815932 -0.12887495063772961 0.24148115808323353 -0.45992678645046359 0.14208809510304451 1.3129383283880387 -0.3416020907745706 -0.43567456664648746 0.49340473549075381 0.023150069854994768 -0.22327236248826871 0.04673265023186627 -0.23117798350593405 0.65651251987223491;-0.24284785924530325 0.37477348181324122 -0.29958965530726039 1.386123723876586 0.11564249868978468 -1.0031571238920221 -0.30413809581096124 -0.099717627439949913 -0.10293826711169983 -0.14994671411949115 0.097177785052421861 -0.65058944024514354 0.83273230954568844 1.2422897262912562 0.15749353509969355 -0.59907334384873945 0.25195179967850095 -0.065019506628581247 0.34434255409681613 0.91093120901576441;0.12011486001143504 -1.2823658526708868 -0.35364046724455728 -0.50971116197561661 4.7542252048341274 0.34464729092501489 -0.25251190249872435 0.6515528465791296 0.64377500743999105 -0.22189262203071358 -0.14770049974235563 -1.0353253471108932 -0.32085934157795376 -0.13292724968064432 1.2841380863442267 0.37586610080297356 0.168510630500118 -0.038640841225927453 -0.35480363394298514 3.5942208290032505;0.31704306547717098 0.74017020480749385 0.42333135428918339 0.6472768495752822 0.40957389863233595 -0.99489533182004553 0.72796902832403165 1.448042645019173 0.72874772316853154 0.49245737390382932 -0.4054266759013983 -0.16039840508470868 -0.53354936822030419 -0.73101187149831781 0.81558530334494062 0.13963726195320561 0.13826372296724598 0.11709204214695366 0.30181961190441403 -0.087270414174851735;1.6923359857321434 -1.4577247995557483 -1.170523629415636 2.1394785718746188 0.80004281765590146 0.23495494091218475 0.004182204763511126 0.29437406124441273 1.1225932599557886 -0.87401401497496445 1.5919236240513674 0.025955954908355172 1.0964357548937687 -2.5157829255412487 0.51492121001209368 2.7917998413539795 0.80883424217004862 0.18802076003393561 -1.0716347651337421 -1.0089578841161086;0.054895045981928348 0.33985188738933969 0.61515023923687417 0.63797960578469037 0.071173032966274238 -1.8935722636101926 0.91113909759489764 1.332730132521901 1.0133387433990186 0.72022335646558699 -0.80093121017563285 -1.2697874362869244 -0.96363166756360141 -0.53913973860993947 0.57609433356717366 0.64206960894871712 0.0007954460676510523 0.054478693567704684 0.65603870561209676 -0.040484516889636085;-1.4332786164480829 -0.89050490825059769 0.89265680679162551 1.0774573359462314 2.6287690023305572 2.7271346222041508 1.0625684681658296 0.38264923876409951 0.61553069742385613 -0.18676895764752444 -2.7219703761763121 1.9121785363330353 -4.6288338103372046 -1.7732521205329672 -1.1401177737653234 -1.6489832206355945 -2.2460504902484497 4.5802822075746494 0.85253560477906587 -0.77845055736430591;-1.8282016399165584 -0.32984103219721966 0.82898062689071494 0.36545428890745174 1.141349363761871 0.81612489245746089 0.79708143308054136 0.59959239799657893 0.47801071604059647 0.63999299125537823 -0.4180754770582315 -0.49672175820235681 -1.6177049435356934 -1.5697882925407305 1.3001463416684611 0.076619937260468424 0.38589350652978183 -0.026562682918087801 0.555932389082201 -0.018585294645864663;-2.6671739130880714 -1.5246413605289397 0.17415476226618246 -0.44026025872208435 -4.6056782738565509 -1.2325512389437989 -0.68311138828855589 -0.57119512829154029 -0.279761311269899 0.52711284860924212 0.21458492533061438 -0.45262882215915695 0.62179560659293465 1.1836307465804317 0.3679026587844475 0.032800061350129764 0.0040013964692549231 0.066179949610451622 1.1501484335864205 -3.2664681311734971;0.62537491878451168 -0.29763841082855164 0.35199067211100166 -1.2124340324893879 -0.5218632114783851 1.5199136961593065 0.21444135888615851 0.12607288776256481 0.055398224730169858 -0.12568217871431428 0.012583308366112968 1.1076444225948712 -0.39829549513635937 -1.3744361786770125 -0.053714845452348017 0.48182393848561605 -0.28797651896546406 0.071308904592430902 -0.3446693210582833 -1.1193119749524274;-0.063302927296795916 -0.43274933776629854 -0.41301338289495004 0.23325537999496834 0.64845055384104011 -1.4606131539921787 0.057524391528669047 -0.21917871295591637 -0.21561306814192763 0.74734109642682678 -0.1836204834901656 -0.73261940136647052 -0.18368649126488379 1.4569081971619855 -0.0028087171769310428 -0.2517656747216892 0.22370347460052908 0.050110212929017468 0.080962543902664108 0.11836620571196119;-1.7630273594114603 -1.761530291842194 -1.70748463144623 -0.98708228337657389 1.9326454483863942 2.5756969892437254 -2.1530590558787082 -1.8130375981450899 -1.866974458702104 2.7311280758661036 5.3714056066317388 -4.4865888121064748 -5.0926745227298698 -1.2106221498598311 3.4058649016469689 1.373895312508578 3.4349017107281989 -0.25272686387115256 2.0006386798259874 -1.4440972056639381;-5.8660478989035783 -2.3921673406101616 1.9194283544699597 -0.75046846936655009 5.0380132171841554 1.3257076788575448 1.506955389066539 0.55212631507077481 0.89712020885466315 2.1632213128930928 -0.88483175761751964 -4.2201821337699865 2.459142341606944 -4.0091146824190167 1.5196871566966843 3.3697229507051101 0.70438345691429671 -0.37120955840947034 0.66890327955472795 6.1380706587152742;-3.4734877257780514 -3.015781183197622 4.9511386937395656 0.86689617856293666 0.22964330136164887 -3.3878965063130573 2.6064393555617333 0.16912938849933801 0.42010636748983521 3.0116436840391261 -0.36242799256271452 -2.9889969099196683 0.8137488728085146 0.83381231835003444 1.9939811432720898 0.52062851696780232 1.039434580043173 -0.303767675053143 -0.23695902378844386 -0.48408844027025127;1.4595724824503171 0.25901205235093422 0.35407383864897413 0.21966792291317325 3.3149100611317297 1.4316597819956574 0.62170186214471412 1.7893185017782907 1.1477155245449617 -0.10529103954283939 -0.14835718027204112 -0.092278087820041724 -1.2315241698441852 -1.4996885555409454 0.53691070182591349 -0.0051603544541085518 1.4029299325699103 0.12998066065432215 -0.57990705584050928 -2.048389248383188;-0.86134506783336118 -1.2332769710720493 1.3142499763008446 0.010031080142393643 -1.1108099992231837 -0.80059315589827096 0.87536604416229602 0.79365850153529627 -0.33871729902428421 0.41305360626028403 -0.041941246588610447 0.30387094701380535 1.8268631780763247 -0.47526035250574422 -1.7302793465078632 -1.1118397040320163 0.74367083013114355 0.03020386279326941 0.28458756430736787 -0.68382309779132622;-1.5396221382127995 -0.3630961109594727 -3.8712472938456255 -0.47369760702708974 -1.9089981380045882 0.0061322120516648926 0.44468369625284487 0.12305625186590581 -0.20065437072160558 0.34480360640651536 -0.033882275296914476 -1.347145177558666 0.21175763543395906 0.36203089161425139 -0.6233519072971706 -0.26348918880408012 0.30783049616486519 -0.10658724473373493 0.0077198048222718195 -0.91606290410042179;-3.0436688537116834 -1.5846187085933012 0.80215091380867931 -2.1807594407933388 0.67554770739639436 -1.4728434228262366 0.067357800082732441 0.14942455913320754 0.94765757856526622 -0.93924794632175723 -1.0261316804726808 -1.640561648646085 -3.2979341245268712 -0.9918092810368393 -0.89553258782595813 0.24080366187521468 0.2052170233259254 -0.23778427408400094 -0.020302033854408544 0.62824847129131611;2.3516486383450537 1.8336896287122091 0.44485451049826913 2.2731143637245292 6.4649744377219518 1.808400755220446 -0.050256145230289519 0.48548037879644479 0.24656412185041554 -0.17715588806310692 -0.2606588502085172 3.3564987531490518 -1.0717578664397989 -0.00084289258501525285 0.2503105460760176 -3.7993894020126939 0.99957172964299557 0.064855935818741273 1.139575782998127 2.1723984327528831;1.9909818255104275 2.4995945077245363 0.77942481644847517 1.9747591936312563 0.039033789054082321 5.7760171828625646 0.65324942542337949 0.51868048949230605 -2.4901869181119043 4.0184196085383439 1.5125829090817315 3.6053657492688833 -3.1526329436484777 0.97548692608631771 1.4877305516648411 0.85921439550557499 3.0070293206851746 1.6893271768224312 -1.1195380831815129 -4.6246341376590641];

% Layer 3
b3 = 0.69804992033531532;
LW3_2 = [5.4780707234727819 -3.2946615013483282 0.55798891009944462 1.9208163124085156 -0.17334852334409867 -1.3346966753357055 0.22241525017813524 -0.52897760642247194 0.27793211958554548 -3.3540780138236994 -1.0741008578934539 0.33123349895881726 -0.10981840759241003 0.12527968211613996 -0.31303289923048444 0.33704082085236275 6.7687460074506642 -0.34982081442099772 -0.18644648712351941 0.22123290309052587];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
