function [Y,Xf,Af] = ESPER_pH_5_Atl_4(X,~,~)
%ESPER_PH_5_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:22.
% 
% [Y] = ESPER_pH_5_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.2178;-101.945317545701];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0054210015363163];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.1926400469618001488;-2.473550155554339991;1.9545793112187843654;1.4207343087854142905;1.5175362448012685856;-1.1870957682469804872;-1.2909479946449040622;-1.3919902293019064121;1.1765290955891565261;0.59152194078282438472;0.58242494309928705132;0.26398230749333773115;0.93679400030013915135;-0.35397338871771455437;-0.27000340706963399384;0.048156887581798861475;-0.21932201649478957894;-0.35038345130772013958;1.0115682611202685415;-0.80530252936094637306;-0.26714600265622956421;0.57793999724312916655;-1.5148296582163207624;-1.7265645689257860251;1.4871142787567972476;-1.4769899231394707506;-2.4457138130859261693;-1.9667654432214103366;2.1899043035859016015;2.480529925281082626];
IW1_1 = [0.45510754655008228697 -1.1511633063568054158 -0.38624678646175852892 -1.1685344458869337814 -1.2088073829850620733 0.86230113575282574256 0.38573942310613634765 -0.10585427884091837269;0.13519318446593533989 1.1006512691724377184 0.65863593859249003337 -1.1307465552227851102 -1.2775859450129505301 -0.57665842872419870169 -0.25860567971460407533 -0.013770537814463069265;-0.251246962622325265 -0.15616075423320183169 0.61485174240839257642 -1.2738792137012724393 1.3036546827383801439 -0.48852018502871730199 -0.67172692034417158524 -0.043681015415128518486;-0.62961642774573745029 -0.43426849249174981349 -1.1865196823716575025 -0.44596363551923484669 0.86243521321539107216 0.86146489815239957188 -1.2803614826279448025 0.57086537974068896073;-0.30611707302156809796 1.1058880878340251463 0.446889250784578973 0.059846705572062210143 -0.28002285333122922673 0.43024302222376642479 -1.7886367844144017702 0.93190220960600700373;0.41346452992530285941 -0.19198511775420246117 -1.2860464846957297969 -0.54180728477549067179 -0.75623586521072561073 0.52546297924613549757 -1.0309469314299943843 -1.1112447583513691551;0.11955268558879812713 -1.1866895053618704559 -0.26397031976931445429 -0.86520116729522300592 0.71302056376786082659 0.10798435545623538689 -0.86264606250621811423 0.57669608490896806519;0.090851639981073178953 1.2176065121821693094 0.53677228182354064234 -0.8227111570130367646 -0.62411965517485246124 -0.91179348900263001987 -1.0286318716628903847 -0.39324761316507000908;-1.0631358067958915914 -0.053787960917040397724 0.4211962335796926582 -0.07915301826264248275 -1.9298819559083948416 0.22282367150636686604 -1.2646822157604538095 0.79012105230944085221;-0.64321887759007712049 0.83492811768766084235 -1.3079729285392336369 0.18638501788087172284 0.48884580800102711562 0.59364052114149989947 -0.5308150343576001351 -0.52796000905644435708;-0.12966879216033649902 -0.39836969482429207545 -0.28612665152623983911 -0.94191106460668438949 0.23113859905057973498 1.052709697131677169 0.48401006088745324174 -1.6238324792594589496;-1.7893472335102695858 0.10271423484929703696 1.284156495332425818 -0.48013012590379861022 0.96125067606724035052 0.55789008784228966142 0.96134950794231943672 -0.65349935762599786759;-0.19140847705191482708 -0.56635582132629713747 -1.3119483644604315042 -0.0070131933774371379986 0.47613969856544469117 -1.0572976113512693175 -0.12581211103281905728 1.9743374187172242351;1.1504735249766619987 -0.25120447272401325023 1.1660338204018994013 -0.036861766368758777657 -0.84056120408196799421 0.41978515967769058914 0.66390691606679086423 0.39706163090345869549;0.57627227908441558402 0.60528589166993029824 -1.2695082977050762274 -0.28899556407317567031 1.1204966504702464913 -1.0748917800056239091 -0.56860388714373166774 -0.27550146776943951199;0.24160437957492328365 0.31500560647155173566 -1.3999222555714694316 0.65090639581303677552 -0.22560173370989644592 0.83979891425665254001 0.41042359532136912792 0.52019013247045231552;-1.5183651603303773836 0.2575799887486822648 0.5194754197427546849 -0.4588651874777648354 -0.99855421302187263866 0.61468317943754302579 1.9048721154419891999 -0.63341358750755649698;0.32003054162732474941 0.35391986364291372347 0.68506100806513336998 1.1078324956525971157 1.5058721672005157544 -0.023881450559003557232 -1.3284010944353910055 1.4425192597533351702;0.34673526559493128563 1.1339186040708206793 0.71157069847151432906 1.2401802068669598444 0.51993355844156963208 0.80212363140295939168 -0.17030660228768676467 0.60527257336320083869;-0.71611214075552687142 0.66921555954852407488 0.44032257939029267879 0.19121879295506566399 -0.20276494859018498462 1.2947288301269053168 0.80868580791946442776 0.68285834759138286376;-1.1772273046631382964 -0.068481102603954610575 -0.90327818691928163375 -0.92320371625910546687 -1.4789976621475764418 -0.34739896893149951884 -0.42338470148010376448 0.73319461945958386284;0.33629033562114962752 0.2061047868106718195 1.0366954595426518537 -0.86986147873333519165 -2.0250359918432874196 1.3310680369524521272 -0.74212455608014105124 0.47146751795692926068;-0.68105367301255970158 1.1932850915398149905 0.52302250764272373296 -0.70301671136089582959 0.22908188709543544914 0.79130937834275538734 -0.59204056798267790107 -0.36672826360358573572;-0.26916267154226458658 0.216290562167424677 0.50922153345720311268 0.46012884430990608209 -0.27868332328067302317 -1.3678290295278863198 -0.81837671389839516944 -0.43409633633787308993;0.84749625260371397317 0.92392717691973957894 -0.095078663459146436909 0.66898952907793374223 0.50394380956653306303 0.51351465014236519213 0.6279364050544596898 -0.12855096627855297498;-0.64192204808273789496 -0.7432267481959933253 0.10187778481151807397 0.78670177882570957451 -1.3276634348653661988 -0.84121497627803676345 -0.37212385923008384214 1.0093257579279393266;-0.54333101931305693988 -0.7387282238104905252 1.4006447090222222673 -1.1368348907857908081 -1.2014874959443047064 -1.4575844054284601281 0.1023091086910524472 0.14279159679764116819;-0.64391503949135053819 -0.68467468821719390526 -0.041030092996312356179 -0.71956451632566520438 1.5644667325426024895 -1.0023432441538324689 -0.02177607037778014204 1.066422531736636925;0.57683114353853304213 1.6564480495695119711 -0.20396344394512178066 -0.34299867392115190867 1.5872330498402285048 0.60777224117469663689 -0.56869094404051512281 -0.17415885740623188171;1.453728109083411324 -0.75568433100677590009 -1.0400942795052228185 -1.0023544449963734948 -1.0586096256242585323 0.11785598878523419197 -0.43378811936467553956 -0.62111046654563573099];

% Layer 2
b2 = [1.3650867569512994404;-1.3002399984452110981;0.91702552739216169897;0.52885488058977159209;-0.34236945282162167814;-0.13692400229456833105;0.21455579268980765062;-0.72865364682996280887;-1.0212311457526817016;-1.5006043217223872244];
LW2_1 = [-0.43142890081489987386 0.56191658361126917143 -0.31274474167098609279 0.49625943124435878406 -0.27591396425448555529 0.09022973669391007312 -0.03612075849658841209 1.0511352900563131207 -0.52795347279218407532 -0.11271910572107669835 0.3451361833710001048 0.045186786078891649776 0.26236915155823281598 -0.54600626176789124333 -0.29352967475155766763 -0.6156008537631327826 -0.024991317885291450263 0.058714329007816888628 0.52994675980491579015 -0.025403298899297148405 0.36639714664519440479 -0.11487718755087665545 -0.33397989928727800368 0.90602420212655443432 -0.65398961609152705954 -0.086500229229195660374 -0.83598017322121986883 -0.22419974811623427646 -0.26795123767913803237 0.37373898850959935691;1.0853120646404188498 -0.63965520140709952734 0.13395914134240771709 -0.12244467629207626824 -0.095433859025009434851 -0.38069943226970431871 0.10606804543566825116 0.64581003749249421553 0.47276215246054170693 0.35635599698404119007 -0.057026119544154756091 -0.37619597659285847202 -0.19535946241140941804 0.48496897705975028359 0.36422653372873520228 0.090344731600018698958 0.42265495684817833144 0.34432719402866557301 -0.030883768229363690178 0.24957145523251464403 -0.63005442265744393548 -0.38234301891124400363 0.039132351975267015698 -0.47925973973797353356 -0.63706367969341515245 -0.083550800700181282465 -0.39736645542175269563 -0.36147520997715471003 0.16601632297555404816 0.63537539010974675158;0.15868336057194806776 0.82253224748296271951 0.25160722915272454303 -0.38838008843002841397 0.33879135828641399053 0.27785816890358178144 -0.10132914392814570959 -0.62344401843481267456 -0.25126236486582570473 0.065269809099678458009 -0.059813377711207142695 0.05816185775226867527 -0.55107966499093785639 -0.34880196922581252483 0.011136185332862192504 0.0024031885711497803608 0.17926325834628098477 0.2969876062446343834 -0.01607310113311902558 -0.43331420408043980208 -0.44556215680206640029 0.088824781867334931529 -0.1700827693968284815 -0.040562863728121012485 -0.21920319197229079511 0.61203513774595508234 -0.24124855448555479476 0.76217864687875203078 1.061798485000380543 -0.55598076021094877674;-0.059486692699046550548 -0.13135658880138220694 -0.11955868766632284095 -0.12773126832854098112 -1.080224195058615777 -0.32663734550138023849 0.26816309934241777668 -0.46292131567150984761 0.19519094240999018686 0.31666657115586116511 -0.35317514992449072775 0.089337751752952720974 0.1207335771870727964 0.46943294343469355034 0.40715143854860580408 -1.2139318319991330153 0.031149237163850134608 0.41390691091611009345 0.15141924716578469834 -0.012286360239706247549 0.48075095240401077845 0.61231212188258343776 0.53877479146421869416 0.86345848713403006158 -0.31128847791097180586 0.23231930138134440633 0.80901657880954713775 -0.43002127758606939478 0.21163562906129446128 0.16169974302913742159;0.27180497454395335932 -0.0059814369716298890906 -0.040934400181513265482 -0.54875674989789946512 -0.41924644184603748753 -0.73195717149082262232 0.021623790684024833675 -0.2203408840177299155 0.4992631827318356752 -0.098307418053583922601 -0.3847686577152909515 -0.25153822227196137584 -0.27609341435103768037 -0.1812310932420466425 0.95006917132334722798 0.40115333162453975513 1.4693945892051645252 0.81313963951728884805 -1.0217457824794631271 0.12570408331340918173 0.047467494810251406601 0.5180660641342629269 -0.49805278314125522865 0.71842329631130241729 0.19625178892180736301 -0.49254057677729268239 0.52044105853155520069 -0.75973438709511886824 -0.4137271090443347954 0.30465501570598685355;-0.2360892184694563245 -0.12625910791697228519 0.18243754983095733513 0.3475951618463866688 -0.028078285116607606953 -0.65582485478910190757 -0.26787699010976090408 -0.52146084297132055951 0.061820869838008191133 0.15510658875372229648 -0.64632793881935568514 0.18673710870570070508 -0.28780035603698178592 0.1783054964743319426 0.26431316776381502676 -0.45746087691836889721 -0.26720832685414847019 0.35134512524196509498 -0.13936618363576563917 -0.25490492940601583438 -0.23789725492138535934 -0.072578982009105855178 -0.42072792385900581458 -0.34452503477840962232 0.41966819741249017373 0.4834788872343102617 -0.13361693307739849756 0.24710816417600869888 0.41341202969870172179 0.11909649324267752857;0.37382080889571572824 -0.1828479836861226504 -0.10289179217125300758 -0.52017182332897893282 0.29062789547743789198 0.4115989976621446389 0.3858861349828263676 -0.39116076995951204465 0.38244466371336771626 0.017338464783301192618 -0.073067429529580341097 0.14034301109940214292 -0.58319915468477245835 -0.72553629365864935608 -0.22560274531937551945 -0.37063709329112171087 -0.31222766750698793814 0.18893491834564540843 1.0470291183824396164 -0.31977477216368388468 -0.41812260061888656404 -0.30079078011041776586 0.0099461541952611844108 -0.55029273511835108401 0.36587112218814010767 -0.45231380604874771301 -0.030333302679809527602 0.91899737630157862789 -0.52601780895125771487 0.026572162910893617344;-0.29991439120751645087 -0.61301609810568846726 -0.274404051225170309 -0.44057670053849146141 0.059801042786257384287 -0.31223179086862395959 -0.19119969878610135194 -0.45690863108140916671 0.1370012329242215332 0.73904353314482218451 0.093336623453024264441 -0.19548011772190621027 -0.86460540048173295524 0.25712612225124814591 0.10763991171099174249 -0.0069057930819052971289 -0.12329099979761130867 0.66854253396475971094 0.024385631520442697245 -0.087465923734909620246 -0.40099059616747234625 -0.49528739711684738323 0.21292328168020030477 0.90946402855533969856 -0.33365169918439618879 -0.239695717125599006 -0.047255211786204440183 0.44097460174850205972 -0.24301137635649469604 0.28169459038086724911;-0.23048607821825889408 0.53789892311621034793 0.20455085879873113885 -0.072534828037229479025 0.18106728481477610271 0.37996376569847117866 -0.5448124879082048011 -0.11312682038876142876 0.34895804013778164432 -0.44278732099294537683 -0.20111293223755133397 -0.47730404213532795499 -0.49385095789878796779 -0.35250548746994403437 -0.22921560423872411327 -0.4122237887430226233 -0.16176862978777431512 0.58910391045952070765 0.50890724259877895275 -0.4483773336748029803 0.51525990817384059728 0.44269539413149139317 -0.087778453872783532286 -0.82174919043291183574 -0.364630031312433045 -0.46293866216111856371 0.084636632797537789119 0.30217770851054481795 -0.87784846376457004169 0.12311268721373457014;-0.58097402801160458186 0.79962013677146925872 0.056690833443378642331 -0.31930022947427316726 -0.044943347912078941697 0.29952225505150675833 0.5361244169363287293 0.81873017767581979243 0.47314503557962217517 0.19934576742534079741 0.53345164775444164906 -0.88620757604847877342 0.073533720663006688079 0.34571367488283855085 0.48677366799906179873 0.62512554598502434455 0.24911204057684735447 -0.14060488426159473141 0.12004666516342515914 0.20046282118554331619 -0.37784508232198604771 -0.073527488461473777814 0.57309543157518094691 0.43041505648756084312 0.085016291256483453309 0.2809279430703685021 1.0588824118123696394 -0.23856868912677947625 0.70492546820137069741 0.15990948521742628929];

% Layer 3
b3 = -0.60291163500673561337;
LW3_2 = [0.94952273600089942551 1.6921891640450457128 2.1750571867166814677 0.92617491347144631497 -2.0142971815912580347 -0.78659670853815288893 -0.96894318368515586215 -0.67510855707884354082 -1.0199959499860422607 1.3448395209133763295];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
