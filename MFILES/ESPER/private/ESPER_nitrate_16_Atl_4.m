function [Y,Xf,Af] = ESPER_nitrate_16_Atl_4(X,~,~)
%ESPER_NITRATE_16_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_16_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.3228858894852750794;-3.7711691117450105715;-2.1623453074556397979;-0.5503377344862506737;3.248533922273451946;-6.8845354419443278715;0.15002705769086266407;-1.2124403213248056144;1.9491037314666370683;0.0014376913706778491481;-1.7932684104026654914;0.38649465804430993554;-3.1689699886410203078;3.1027535285354717054;4.8798243756994263975;1.8422313830884451402;2.2695808460938171613;0.8710675958990443668;-1.0605961802645589298;0.37755520261793551473;6.4422804729208920094;-2.0742852820957264903;-0.21160454084921856421;-18.348304612969474903;4.661289551085893379;3.7188068082613114917;-6.8902483436221553248;3.5473204661670973969;2.1107977578252015149;-0.14142897722867681098];
IW1_1 = [-0.46847438360602650098 0.4348022420557496881 3.6129207493584143407 1.014462785333398287 0.85842579371404392763;0.54451750120496122953 -0.20107611927577620503 -0.57303346761364559736 2.2818246464165823362 7.8463411201751958046;0.94055195638191868568 0.70297872359393742681 1.4628641754500657512 0.23982593643904945302 1.8802145742367948333;1.0140666504151514271 0.20462763417388035725 2.6987947950067248115 -5.7792423367930023659 -5.7523758426405491306;0.96850201975160044032 -0.80983941275199866627 2.4940994121502377823 1.1456002065617023611 -5.4280058046173689235;0.71669556407777523788 -0.72632188229487648634 0.71454649046405649404 0.15624071929006955184 8.7726993652427829318;-2.1362908870799266481 -0.52501643337809611456 0.52448370636476293605 -0.81732333048593008851 1.6052657152750711145;0.59366801657110834789 0.60489720073491182184 -0.081032623194838324099 -0.19895800004058944443 2.167797974168232944;-1.0116050112844292563 -0.6346712706135436699 0.3464838317500337217 -0.60112731989250933751 -1.3249841155448887076;0.11480445638302369527 -0.57524407257149345885 1.5655757936326653024 -0.82566864824323904504 0.23230850011488349272;-0.15336061673770989833 -0.33398908539808452867 -1.0644759829674743656 2.9621962036550923969 4.8945854201337262168;-0.75905519902363827178 -0.17150691059137804229 1.7937390591180890631 0.36914566666521303473 0.96132185507613265862;1.1408957060478044365 1.1850348560527121933 2.3461076528833970656 -0.43307294023175257891 2.8686302940271963813;1.0325902275334859493 -0.61180883245667250225 -5.4709447913299253941 5.622739685101092455 -2.0977541089824480736;-0.87278030412723184295 -1.6055559968628547729 3.4336436289814598055 0.68292463260227154187 -9.7199646871156932804;1.0105423293374371507 1.4071914341262354853 -0.56037521389964395357 -0.82578564161910195107 -1.919798814820844246;0.72644188048638602684 -0.48048901012754452466 -1.7320721343866662956 2.8098955849221929348 1.6370594287014781365;-0.52716625839524455799 0.26264224105587319347 1.9488696506215588133 0.10471095675255913393 -2.6827488822514848898;0.22129493151534471163 0.22314057634295783594 -1.4205590654158475328 0.015000199051603085171 3.1663970408861659145;-0.29348718684192304229 -1.6236649894413697215 -2.1754158370731864203 3.1075139531962094885 0.136112669454616253;0.0034599301648724767322 0.12873305568964743539 1.3926502876892912219 7.0577556538354100368 1.5359567104123299508;-0.6754675090079320654 1.0501658325702292185 -0.13273343250293681561 1.6246895514702264229 4.1253917387561003238;1.6810830115961721276 0.59729257547233760572 -1.2941568895534256711 -0.26427612227040231385 3.1386347233186446815;-0.22552489770597955454 -0.20299328461587015648 2.3599533397941305779 -17.733643177484111675 2.4930644515828253027;1.258522263178363243 1.5721783665510948858 -0.39539138131242895779 1.7202659046916830565 -2.4481092695742114884;0.48941735714730066897 -0.45653655285399635799 -2.3158939921482559754 2.8036843015386057054 1.2633600571539147506;-2.5258212411860681001 -1.2824095344218491288 -0.31120421159006050882 0.64795346114791074754 7.8123064349485655811;2.4073397813445489568 -0.73984974288444149693 1.2122666247326336908 -0.0025862172667523719571 -2.3590899193971717196;0.60207086462457970466 0.55677140681495118635 1.2132998932135661274 2.2350179547074655595 -0.70723419983520419141;-2.6762159597694612501 3.0029690164527438334 -3.4068916780732423355 -2.8650039850889381654 -3.8325913291335176325];

% Layer 2
b2 = [-2.9745914768061023636;3.9741228412636093736;0.89022379080351499159;-0.12960053763640291824;-0.98950495680687522437;0.68566873280158791015;-0.69335149145410779337;0.58205787399435926499;0.48188653161911698675;3.1463290980840739053];
LW2_1 = [0.57385908924652784258 0.47506243949566256957 -3.1234620889847537484 0.55530637131837501386 0.51042768291837881112 0.24260256366684782026 1.0285748809552799354 2.7357092329941363751 -2.4314405126811013957 0.29838253903636197117 0.65352430154386942363 2.0128049165955217426 1.2239755970544259345 0.52161990223951792967 0.78013011577332480595 0.49897637873111572171 -0.83967611447283507786 -3.0012829681518473635 -2.2799971978132864692 0.18546619577541006985 2.7131362438782731239 -0.77944521493538421186 0.78790134446348836228 0.053170196287047687134 -1.222986237236002971 -0.23810215840736198567 0.13368816087567428341 -1.2412941584123746708 0.5408283893811967058 -0.17734196903785004462;-0.46291477901282629404 -0.74071558966293937765 -1.0689053885136181599 0.48089373631436027612 -0.59074090184852734442 1.3451899282374508715 0.45629125559851413385 -0.72354948506557414944 -1.0116007987861368456 0.22617436506291210829 0.89587226790774898699 1.1739440807851591053 0.25556349921275306469 0.26727509837528273806 0.58472904479898668573 0.93733344526051720624 0.76812010858833057458 0.91360518444636873436 1.3447154007467232439 -1.0715578345015388528 -0.087085716695598475168 -0.46513746318844562122 0.2590415111042067009 3.879675784618658696 0.0013636926275677838799 -0.95204988689797442891 1.2841444333082254747 2.8149311991506138497 0.54805453963431260966 -0.15457902400965514711;1.0169720011859977316 4.033236466394197528 0.49775283499810751842 3.9019052881663869314 1.3118747543362565544 -2.8393119092130971737 2.7290008604724738106 5.6958156567966744532 -0.35028789130651966088 -0.7891958304201537322 -1.4929104867347144925 1.89224757528624421 -0.35613998373545568965 -0.57235130184897331507 0.92664074078704561366 1.2187581699412071146 6.1672739130853972966 6.3992141652075691383 0.55140602525227755404 1.160262119094608968 1.9758357673351059081 0.31703863369686596796 -0.019951482363595826608 -4.0150034590913064036 -3.4009073387109185482 0.90778410774721329801 2.0215226766891269961 -2.8244964461339270301 0.44732824064180543022 0.56312896505152165716;1.6737547088925004424 -2.5153939061342627248 4.7901462852265490611 -0.67093835991051786749 -0.82862912591391202355 -0.16506652372871161161 0.26091804885724967367 -0.9434659973503628505 0.093824373506874128581 -1.4236764183313082022 -0.87895546299601923224 -0.55009404474058531953 -3.3343120476613461456 -0.053385793278755637459 -0.67069975910879997549 -1.629992772557677938 1.63457544856057857 -0.97670511661635772693 -1.7185811878038013134 0.23194486899535898816 -0.20978167614450218825 -0.050285711071263346217 -1.9198535103860838724 -0.17173132053122791563 2.2800453008595042981 0.5036775481414972333 0.0034540405373963273261 0.46484544393348598001 -0.27915930868448191049 0.65043306459357719262;-0.031895100101054667252 -0.51401817811377004119 0.09164477017921467128 0.24193454697168806367 -1.2261456267388053387 0.3216436689429432727 -0.74194422150207783861 -3.2491559181969846826 1.0873866268770164822 0.21695396088960855474 0.78953648721724722925 0.50064730287298853106 0.32488880378229589851 -0.051735647119564055763 0.71045392956392772188 0.71122405784941533646 -0.48556477549446480646 -3.4594968945144226602 0.14950812651464975844 -0.33945476262831603131 -2.2742127767952879935 -0.83001398863749165091 -3.4353753657824759316 -0.33323987447980929488 0.83348355614571378869 3.6788458468350309083 -0.47444721778863535588 -0.52345989061006337195 0.45503422256259173917 -0.1781628221674769752;0.93262154420396259358 -0.28430293850615750983 -1.2127558851953452734 0.12147339907549860316 -0.17171233267458430038 1.0741673556435185066 -0.7909062292892341528 2.9703505826968559234 1.800184916770582122 -1.7922912819679628349 0.91992704235001865332 0.86111132028469405952 1.1010980006246493534 -0.52910408900535033094 -1.1387001611144556001 -0.64302534241778763757 0.0038282159824576250662 1.148249852069812782 -2.147368365065099205 0.65431083591158234469 -0.62997676460813689658 1.0361167068670014135 -0.98099741108749172191 -0.1450372534268596636 0.2192542310946361539 0.42232502373503083559 0.13901698080652294398 0.60054006352309174943 -1.8790596028984305477 -0.18725758598834804647;-1.3208321601562627023 0.95756082908400397269 2.4613085350170602617 -0.56323638581087898114 -1.2689854358492274056 -1.2247360663361963606 -0.014155003548240160938 -1.3883247472061737149 0.47678810148452144269 3.6924309042830931737 -0.70081310790528550392 -3.2226103036565723059 -0.16503025395316006652 -0.31763061500999462128 -1.1016816922562104875 -0.50722563413970345181 -1.0397553242393755557 1.0737584405252587061 -1.4136099473116892078 0.35087552040073516357 0.8317764608628473999 0.32710897065119215466 -0.47230801855411291834 0.24230204540421843018 -0.35777108623607167814 2.3588532460000908308 -0.44589584578632218692 -0.05113082692361606979 0.8313905243484872587 0.32476411488558948326;0.80395300496059440842 0.74256156742465095899 0.38652664018315396888 -0.45796650723578141706 0.42334009922078252863 -1.1297370983296333158 0.52406205499784153101 0.43357064634731956598 -0.24905054247155586356 -0.32968040100438011919 -1.1378065920040487669 -0.77870810308991056381 -0.49742881954404227773 -0.096147089398308654973 1.0979661118052843616 -0.0036548389485494296378 -0.19836835762744392531 -0.45520407919247640738 1.9737691554740817157 0.27871301294045880415 -1.8967031949575579031 -1.0658371036140330546 0.030767372966005991641 0.10329959907606846292 -0.37801088988893144505 -0.33229188820351474032 -0.03841646115960824226 0.051660030642589560568 0.89106636948738615622 0.18552074175751492868;-3.0319119932311364707 0.80689919563018919213 0.6858317415904672254 1.1688706326048912132 -2.1621013551598373681 -1.1944491836714514754 -1.1748767840784004601 -3.7934229605750382497 -2.2010267034486932225 2.6551348618794374801 0.42437757958810623515 0.97771955151279077434 -0.038747566236044306276 -0.78536596983583006892 -0.10016182723125086063 -0.65239133338667287809 2.0114706191020927939 1.7618165572265298557 -2.3669235619591844078 0.56745910152334533283 1.805575169306425698 -1.4970307095719932455 3.2425829309212037543 -0.78363359278566979693 2.1395457305338245746 -0.59279869552143882316 0.1147726390969609489 0.079331913882066229515 -0.33655663780584554878 -0.15141492711668239068;0.090213315640395821959 2.0610733512789480848 -0.32887945461105311251 -1.1615571742081822748 0.47407242696073248478 -2.0328020462816009939 0.8982235054433186372 4.0291775989555240756 2.5157353766574321874 -2.2442044048941096612 -2.4609529804786496321 -3.0465696284161185581 0.94122420480854696034 -0.56295280306670414383 0.60990854839640162854 -1.2079640143718264333 0.75530206051126203004 -1.094573728128054757 -2.0864831655482873884 1.4122643319953689378 1.3133596614699387661 1.200103871938979605 0.52028188944354103462 0.76045075877543377718 -1.4794800761700219738 -2.4011489985263416713 -0.36498134834337636612 0.98312148084889294797 0.48120042298742898845 0.61186891481044825003];

% Layer 3
b3 = 0.3763323846510715498;
LW3_2 = [-0.94801733364271456583 -1.5526774420908464602 0.6926245912051497422 -0.4526496542067809381 0.51115392606660947639 -1.197958952575528313 -0.73796342487086807882 -1.3451089301037866264 -0.484235077283037052 0.34551305874555204856];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
