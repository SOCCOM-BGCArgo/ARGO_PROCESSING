function [Y,Xf,Af] = ESPER_talk_13_Atl_4(X,~,~)
%ESPER_TALK_13_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:50.
% 
% [Y] = ESPER_talk_13_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-0.2178;-143.241523403244];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0479365703301392;0.00458552991639557];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.5562635854724454;-1.4427011793249385;-1.0063335929923409;-5.7716383915781284;-0.27398832226332726;-7.2240087158919959;-3.9627415594723412;-7.1448067183253157;8.8912781402594963;-1.4138783291484542;0.11599189099786336;-0.48608383304458919;1.1259895504771014;-0.15245765847882964;-7.4096847210592607;1.2575703161078218;0.37424195587389153;13.774840953784414;-3.115416467737349;-0.82359433315570774;-11.437285707688339;-0.39337589436756221;9.2206712362410563;-7.6667533088486302;1.3068384515424241;-18.513880325970497;-0.43921474122298015;-29.801932720689091;2.9111500453543173;6.4616535808356819];
IW1_1 = [0.94070008865472066 -0.25362863833467952 0.49147402178421801 -0.37524808746107391 -5.0266647364308961 0.75347050670459825 -0.63387878364892758;0.78556992810450432 -0.19207949836121513 0.79290709549249827 0.4690998437854576 0.46266040535659203 -0.6125898206699858 0.4169863139078992;-0.052967311260442039 0.98686937807401864 0.38414647727272494 0.18528701299708267 1.6331996231757795 -0.20603364036279434 -0.49110236420578257;-0.85592453811287872 3.6666691224539552 1.3616847183093559 -1.9587591571031222 9.2748994355522463 0.71937779500849786 4.3070651483300644;0.65119828262239732 -0.61295065364756496 -0.51315779208237744 0.069218254029525986 0.8104820324317622 0.19412791512597843 -0.095960027725316949;4.9510376260989561 -2.2029411533533807 -0.6902523741207619 0.29866730252783485 5.5570248783634293 -6.3014596833374661 7.6746296907617584;0.45989463235870437 -0.12735601025031051 0.58100461646662949 0.26718356775258167 6.2417536586941971 -0.261681682620798 -0.12385894228008899;-1.5885401230962048 -1.3827048255079135 0.22712219692610705 -2.0281876789746978 7.9147628735788587 -2.0231265607243394 1.8259177878503818;1.8508492506351666 -2.697582888353224 0.66704307038960897 2.4914479744459297 -11.443337182446367 0.034084711098179135 2.0298047812423423;0.20957774057539946 0.17979063096864037 0.35034343270805934 0.84625627661752922 -0.35730169320989924 -2.1761648987537763 1.1126280029362159;0.73271421606399623 -0.66660262516603785 -0.64803284832050823 0.039143536468341608 0.27649015924288217 0.17174346633522419 -0.070142407869550241;-0.93962657117035919 3.2330407446582679 0.011792835534831729 0.76077897480942402 5.8905049329646797 -1.8131367175906137 3.2764679202231197;-0.26075390773693624 0.12303329329409998 0.082171932551302312 -0.076431133852208774 -0.5348235255074445 -0.0053603374167578623 -0.1078387509361905;0.045000607284625599 -0.44640459508193953 0.89115201548059875 -0.02003446062020358 -0.23358919501839043 0.70175987157998709 0.09476443246677263;-5.8169751543496009 2.5302532176252588 -12.699468828742638 6.1079405318017743 14.05789562055303 -15.640339825025496 -13.582645512048266;-1.3032416226609518 -0.77425698517038688 0.032738589985110922 0.41569974123287812 -1.1955618589418029 1.2748319698295678 -0.83193773269241678;0.60664609110854972 -0.052352631111026691 0.24836905098068016 -0.008067277520996629 -1.7571936000456654 -0.067696220371628729 0.15685632783063524;-1.4069925113067292 3.2939928330412176 -2.3583360900299652 -4.0042172136635088 -20.905292615968804 0.37865623668451737 -3.889673822671762;-12.768461323698215 -2.7642104279641098 -7.5083152414503029 9.3568801510988227 3.7807710786494746 1.7425013445739181 -0.88891957601439231;-0.66994450445079057 1.1076187797595893 0.50900937390838874 0.39473348596016083 1.309810274408219 -0.6298989521104974 -0.31249419040518556;-0.80451430691642711 -2.9014706470844045 0.17055502178817189 0.0049610105233085008 13.696143348366199 0.41815667484399643 2.2640646996855445;0.61224210685897928 0.21604563254642523 0.43563341228295605 0.12546105777719954 -0.17661871300074464 -0.16283586759450905 -0.076072220881265848;0.91681124700941086 0.19515440546387677 0.64547534698689357 0.91351914918018995 -15.445746670714687 -4.2351615207555637 0.43686721058655531;-0.90802318063676635 0.46167646590331901 0.21239676148837305 0.29590359183210863 15.207980610392505 -1.2968747305215751 0.96055861335838744;-3.192983850627376 -5.6453033091584839 -3.5617980892572456 -4.1578922187357836 -5.0483911797704542 -1.2695061546070572 2.7155358639979403;-1.734920885608463 0.87826319715284284 1.9441609584215349 0.19239400029659282 20.787184047934176 0.38192590005534266 -0.21774073337811833;-0.10055247782461996 0.034929947913847979 -0.3328238717924471 -1.155804016477973 1.3129864943467162 0.45421441788552819 1.3697476930510275;-7.8729961001605364 -8.1684241055714786 -1.3343128347614344 -20.210640971834351 66.468568339085806 -1.2402991166785828 14.6455288350729;-0.054451735278328944 -0.076023980562209825 -0.37272656840799795 -0.1459921649428062 -5.4733946884071036 0.020375807689042381 0.55012459882509723;-2.260420138879097 -1.2542447734024582 -0.11338646070580148 -0.36421200370950013 -10.81113706415902 2.7755247905735692 -3.6688509693035938];

% Layer 2
b2 = [0.45875606266557362;-20.558358460084353;-1.9917482465460716;-3.5192051533505584;36.725116566525735;74.656653666056698;-20.283213353657022;88.678864003510142;-45.664805509401312;-14.992025557556376];
LW2_1 = [3.6233703927202443 -14.449920152220869 -38.783627212211663 -3.7245762883593438 -24.808980125347006 -14.469535309130787 -7.8318202273100477 -3.517618153523451 -5.7537786126342887 24.289043545895403 -8.4043474407814323 -15.255423520402296 13.628851135876896 12.738386938692944 6.8507509657091274 -12.363552998854978 17.996381881208876 2.6576082159246699 -3.6191257141151212 -4.4504963908524626 4.1107679404067721 -10.923646004545891 1.641247115934928 -6.394703512370441 4.5280814700227419 -20.784546268748688 -1.6476719532545805 -7.9296471573035126 -0.025121275846635909 -23.953467386418119;-5.0824738472466811 -0.39853297806435461 0.40251545328220184 0.33441131883160174 -23.606379562472888 0.24269525346288665 2.873323113838524 -0.4128015997395526 -0.18579312904729178 -4.0429591374141971 21.575910899524651 0.53066001474916125 12.533161947008448 2.0735111466360312 -0.02413039554551127 -2.6730551097774637 10.474739183960889 0.11674156988443153 -0.17676373598516154 2.0946878235531843 -0.34859150648215009 -10.70300657122349 -0.45093468239601742 -1.2366570035511191 -0.32524371711220407 -7.6702266672013923 -3.2779615375654112 -0.076301352715422821 -0.29229731885241655 -0.32880670631273878;4.4985814112010605 7.6513273565997775 21.591111761839969 -0.11456579786436571 4.8040489494279566 0.61521784460411055 -0.77051805615292357 -0.69374995619885127 0.39290467121036943 4.0364722327396638 -2.7048454640149453 0.35797119479661438 15.036050738991181 2.304713526579512 0.075413969003684814 -1.1942580445771231 9.2863070686101334 -0.45095141152226736 0.12696388122248153 -10.492718458059757 -2.7080572858384766 -35.818794812029473 -0.41925749703424264 -0.66172890624509817 -0.33639441006623616 0.5174969368465715 0.65685920922164065 -4.0725864692050795 -5.5143343344910258 1.3070954461616269;33.810857546123508 45.30494478479816 26.259625929233749 24.58336057311443 96.505983543203243 8.4301255136878819 15.789255460754193 35.322852772787229 -27.361593739641958 20.460098243628309 45.291222013593796 8.5216768556559614 42.438889287446884 0.48876851730409926 5.3268324012898649 54.015632746606478 -80.757623103083958 7.0453273093878312 36.349064533659956 49.578776337975448 -22.088411492018594 -15.995688635907978 -33.450038887144444 -4.1853285443303232 -25.449061230282272 34.406950195471623 23.045180923118199 27.035513560428804 -3.0600725269736877 -17.601686201536335;8.9384419461730307 -24.878353127251867 26.786375297865419 -2.541269926579476 38.029873136146577 20.212790174345933 -9.3908620179958877 0.16398198151596871 5.9321454353299146 41.457763834941048 11.282954158664378 6.9810948790048224 14.40236124192443 3.2686618702705439 14.882955801715445 1.0925372384666903 -18.21829832842975 2.6223179756007164 -6.5280192005822801 9.2547452799760919 -15.193848612560602 15.346381978426953 10.193910454954622 20.366462504122936 26.081685837433199 30.265628633798404 6.4154261242754282 8.0814982566475191 -8.6307724136434771 22.915696647505296;1.1947492742320389 -13.639239351108488 10.546715387779473 -34.14687243649167 39.334989300482945 3.7045569065063408 2.0862689898398599 0.073039875578759822 -30.905793722035021 -17.636569541142674 -9.8303661178643829 16.80477793280637 1.1381655556944799 8.7700996882658391 11.022142484281735 -1.4547024934803265 6.5235574277621744 -8.2813684211644745 -1.0618073325767559 -4.7756232632026121 75.800166907236147 9.7116887169826729 7.2648809949176139 -11.321026704536925 -16.825730765913899 13.453293704133767 4.0159074405896593 12.864016582658728 -1.7253209394586146 17.476140534085072;-18.313026150271021 -4.56977904189662 -27.409378653014169 0.19474496483395939 16.944723857187487 0.98006252868225652 -14.284105274827729 -0.91809851279201282 -1.6707211750716979 -7.2672190829440524 -0.44835282637610324 1.3905708554451943 19.46526323018249 -1.2040794413058098 0.062959288012775935 2.3020971638645715 12.577934916309909 0.34893991348202619 -0.40332116663233797 25.401583671630647 1.9795736536845974 31.725154129869189 -0.59489292145144335 -4.6521550323869132 0.66505548090678168 4.5893252812967136 1.4670492035820877 -0.15393607686829738 -16.156280823030116 1.7042213307819034;-9.9987056330482122 -10.65270639471524 46.9172882003596 2.2871637470638979 14.875285408995463 -21.571130252770356 2.0641643444548747 33.801130867729597 23.742676133111289 -64.586094583458603 -32.104918570666165 -3.1678501924779958 -16.565113619913131 -16.897028422085981 -6.2306787331969886 -30.898886694104476 70.640272622738593 -3.4231806824057762 -23.568324738588334 -17.010991098568578 4.3437530623492489 -0.12427232435635595 -13.082928803763057 -2.7443733012685287 6.0422886341139943 142.96952638197581 -28.669238230099516 -0.65711518873147257 -2.1727461025178112 -20.680403822273448;4.8783426396982437 10.543220037169093 -42.573063997509983 11.373055750701305 4.992367876238653 25.787820488403398 24.116393959361783 -26.977880903473345 -44.008249319680182 11.187418573097959 -41.05298497420786 -11.980309531555337 20.19538140539829 17.50797036800823 -11.506766083516048 -25.231550210659758 -36.407644133756818 -15.445004241957577 -2.3625006930733794 -16.711085354220771 2.9824519768875688 10.249338910269461 -3.0254301058074242 51.458146175655543 20.707090993198683 -19.675300487741627 13.910735276733735 29.984582010769437 42.642665192323214 3.3541936244313262;-0.20151110735137395 -0.37746652766959177 -0.3322475738878834 -0.012439108972143124 5.6175690429600786 0.046262777324393128 -0.0094772211608346296 -0.025853798140706014 0.053720935150645292 0.15303021019579727 -5.1381936338687737 0.064638366141277853 2.8698817027888062 -0.25887734819147729 -0.0024635961001907999 0.13665477377840568 1.2742990322974719 0.0084637051547203045 -0.024492560737508415 -0.45094989384164491 0.091939486742423207 0.55007287807645289 0.046010979039377738 0.07812371105653676 0.045945101138716297 -12.950782659497881 -0.1186517590328867 0.047337190775822394 0.18983661248746014 0.068819663152267119];

% Layer 3
b3 = 0.16079608705967641;
LW3_2 = [-0.0002934730468543425 -0.1359554020325113 -0.018309852071287328 -0.0011575839649596343 0.0027583415552753406 0.0031891755597089943 0.022807184101929889 -0.000553831167160058 0.003753920167609566 -0.43139305065273248];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
