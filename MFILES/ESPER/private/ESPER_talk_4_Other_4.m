function [Y,Xf,Af] = ESPER_talk_4_Other_4(X,~,~)
%ESPER_TALK_4_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:45.
% 
% [Y] = ESPER_talk_4_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751;-0.1386];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0584431850247228;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.98572588067678613;0.36790269872329445;0.73720740681112029;0.052964930419366535;2.814847757508701;-1.2362497124539129;-8.516230092184303;-0.70283669714676111;-0.1502549150813515;-2.0279885400628488;-0.30961086764942963;1.4964324237812852;-1.0327108434444119;1.2090613942658752;-0.52156595646775128;-1.1214641425730945;0.66962552046110602;-0.22294832173967777;0.4326327987415593;-0.17679826155047321;6.0939275400213058;1.3803257233102837;1.6854898618608172;0.2068628555796484;-2.7215610726520039;1.580166909575885;-9.360527244687896;1.5728972399094998;2.6909415555386471;0.70977142290187856];
IW1_1 = [-0.32976914848270938 -0.011753186784804377 0.87552400972059563 -0.5657745296601594 -0.9947276205122898 -2.0001145114461454 -0.87221351071059727;-1.8872802919646747 0.34240799197365301 0.0097934524707553386 -0.14702406001643012 0.27274595160020054 0.03297332443169531 -1.101542617686216;-0.17546164741804682 -0.19736777039007056 -0.44338769834153358 -0.29799829848373127 2.4703223893224684 1.0309544722845676 -1.3303581731081093;-0.75809320293061033 0.65005614265722722 -1.1071999173339844 0.24201213498801602 -0.19416833182405394 0.22504680579332767 0.29492715734456637;-1.4821392719353963 0.72888340318765787 1.9019411876118129 -1.6018223237408094 0.49277288300144312 0.37728729061343608 2.1027310083086936;-0.18779985009491204 1.6442240506821875 -3.3583820423335404 -0.16078327020061844 -1.9070393468200428 -3.2773102021383926 -2.5121401267616585;0.29752068442351487 0.14077619357727686 -0.62994664054896554 -11.191751630574061 -4.8858364068926301 2.319471821317582 0.83752255924845409;-0.28179678184907259 -0.039249371222291544 0.02975313615498789 0.39364123929338535 1.0513644179601795 -1.2516762577653762 0.26897459882036323;0.37463527802157509 0.51383603473091177 0.64180484555461192 -0.0041336625837823928 -0.47945447577884159 0.322346857187506 -0.58802923666099383;0.66926205637785574 -0.035485711453659897 -0.1062634792361285 -0.81447706915680262 0.781654484336192 -0.81526795051923662 -1.0448862821076146;0.61176350786652645 -0.14096503227585011 -0.12316236880719565 -0.10286399807713094 -0.72659817744865929 -1.2144275038953927 -0.69547846651986944;-1.0301705339539018 -0.0019217571029801885 -1.0402999618391995 -0.34369540684720246 -3.807880880706394 0.13577807203082451 0.82739945727407227;-0.26027307016083484 -0.20050513378328036 -0.58609010168248432 1.2309091772743532 2.6631804835604811 -1.2004673211342021 -0.66439896051498404;-0.1704586592659538 -1.0137649172251044 0.88613637569398873 -0.60926724311481317 -0.719570681827989 0.64889954306236952 0.16025296333314107;-0.97383145707256968 0.14539287818574201 0.53470579430976639 0.39353795518430967 0.043194468710907714 -1.0303580968056159 -0.15247267874470494;-0.30038506184656855 -0.068048885308685997 -0.0047045580550430163 0.27797917358030544 1.3325038486868364 -1.2954507553555779 -0.057638497960846795;-0.94930742706314397 0.2290240574209646 0.27340326707698792 0.59341966648269939 -3.9133678915663239 1.129640723086256 1.1981553226451052;0.23394357371067864 0.019064550671231948 0.32077019482921254 0.84140137324129871 -2.3026541888286034 -0.37211358008227624 0.81619832833557515;-0.25416733099128486 -0.71725374589365321 -0.51735437107323723 -0.080046539204454023 0.59883027109022746 -0.23471953563453135 0.45172062848705136;0.63118219094313321 -0.23183651564641145 -0.021955682993212992 -0.22964075695353611 -0.75201602840081694 -0.89932958269497587 -0.59449171819898516;1.2415045628370018 -1.020756615486976 -2.5174419863111002 -0.31904940145246657 -2.8814922999578951 2.5873687008076121 1.0426912551478489;-1.2359363477436018 0.048588077887284191 4.9242625915151228 0.5032980412262622 0.017369059765946875 0.060184071388947068 -2.1168958003550831;2.0152377535077144 0.047280069156302326 0.24464071297327017 0.57039000344119628 -0.12738501924699963 -0.321138635705075 -0.59868218105515991;0.26307815103069865 -0.1171594301872638 -1.7850556239829309 0.029838072255085925 -1.2866790145439011 -0.91008870825587873 -1.4242409389414106;0.63589536688084636 0.20960881666153314 -2.8110487295119242 0.35390735849405403 0.93144938932311083 -1.0633397027192963 -0.42972412822676825;0.32831420882569723 0.30257939886912399 0.051096417636825688 0.14548876330930913 -1.6173677073390507 1.2689454530232553 0.19589710300892343;0.84247213484710459 0.63587658046500284 5.7264566771905683 1.3840424867679035 7.7130260898374212 -4.9512035125716141 -0.85591749939944328;-0.67426804063195711 0.56429874685129555 0.2194125933315291 -0.11683733656221874 0.42314970355438908 0.063334065265547898 0.42309050222895367;-0.79747583626034191 -1.8963082721181446 0.8595225874633472 0.17096798949296202 1.699188904720297 0.022309374480696333 -0.33639746631295347;0.8290487981927932 0.1217351725310408 -0.1543286045972404 0.1417881141476684 0.35839799335021261 0.17946314413826159 -0.18264930283278702];

% Layer 2
b2 = [-0.12114053933624677;-1.8323263029427224;-0.023355523577766615;0.87852579815903176;0.45369861342874129;-1.1814119241503647;2.3856287191505423;3.319723533995552;-1.4151339735237261;9.1421190393207095];
LW2_1 = [0.18311996855168519 -0.060206289718467164 -0.92572954855980294 0.18152206890380079 0.19131399701010626 0.054256681294977384 -0.0070472016480601397 -2.5961268980521917 1.0396564655335399 -0.75261736908722054 -0.33435603844411937 -0.0097648746518312485 0.03687093391498291 -0.030588614740684125 -0.86457240336149066 3.2931145344400075 -0.080004351802557813 -0.76002437993602889 0.74038078951313191 0.17811830865537145 0.2978707012036339 -0.10357684935417555 0.56624565362562163 0.31305815654547492 -0.19314927869894821 -0.076076458531315436 0.14523688593556766 -0.4579826178447795 -0.44455597176974737 -0.90546219490663915;0.4299770798897905 0.18273375245544451 -0.45880722466331025 0.41875138727705907 0.31580699745690149 0.060429211586594339 0.066444805088448494 -1.2379803660876754 2.2253131351035225 -1.106140087491565 -0.91253179221251712 -0.013405895250788379 0.094005673355008076 0.0703075001269092 -0.71504565712596135 0.96276884408380703 0.032485317690381807 -0.15967380914959836 2.0023603840066602 0.94319069915345199 0.79440217572881644 -0.0059839370744455798 0.34849905803405196 0.28132080145622018 0.2259290097954183 -1.0531338271355406 0.1931688314888545 -0.37083052916921438 -0.20220765143410591 0.50829295551734388;1.6035012658146262 3.1256532883503652 0.80463652009707176 0.04139980669657059 -1.8630942606495198 -0.3414776357946589 0.44246345434310774 1.3836633829483542 -3.3151926399608618 1.7593566316285738 4.2850898487168427 -3.0091915149068766 -2.4894905607861446 -2.5188773340735828 -0.077440444687035981 2.0960588353446297 -0.15163776423634637 -5.1114434999766951 4.8325045289401842 2.4297358646464868 -3.8774520198887941 -0.69737491592943879 2.7728532079789727 4.1530258220317187 -3.660359332161605 4.0714146439388772 -2.0872661021786256 -1.4720959264391984 1.4578804114046107 -4.9036123434696552;1.5927029966394983 0.15304447443333666 -0.54516961936405128 1.1214009556749582 0.43194991273555783 -0.071293061409839112 0.068144129528005984 3.5653349399065601 1.5371236586520693 0.18775460633425936 1.5546774898722591 -0.11444630354979386 0.95085817312127607 0.057630978221660849 -2.2553036669206374 -5.0743470158903277 -0.52747021165521801 0.63025276914276274 2.8352319332557832 -3.0142921292148359 1.4753214107922186 0.44168247025990109 0.92127246033081223 0.28733842690103384 0.63927783977124519 1.628716582581065 0.87129410235836835 -2.895771535980161 0.33222505316030027 -4.1769701859290498;-0.050264763873134929 -4.1017996738623568 -0.13087397591804076 -1.0151447225345909 0.34035717774936647 0.3479416119945738 0.67121490789688687 2.3834759903377338 -0.85325812971380743 6.4172042058081109 -3.6561304925138298 -3.1697655862946923 0.025204578707384209 -0.50152045782913213 0.085843743061337352 -1.1475234139912154 0.59922291353453372 -1.0593895455413114 -1.34085147280532 0.29773556706316867 -1.2757377679640924 0.81078809406617958 -1.3582765466077253 2.0157825704837071 0.54632997047245424 -1.2736133469658522 -2.1348130018425628 11.272575412456758 0.40956259657815125 1.6076622470360697;-0.70099495047216254 -0.5912790513795827 -0.15010240409814291 0.26818422640986511 -0.68673161276000694 -0.081774197628153786 -0.48534577832826925 -1.7572151279251753 -3.4752784716270901 1.8450032838045476 -2.9465488511505824 0.040939725847670069 0.07922961278910215 0.68324557878949332 -1.5226003887166553 7.9880349016354062 -0.71462059350557761 -2.2525773422106425 -2.1738368236978665 3.26012485990818 0.92036055840671738 -0.37795998802941011 1.2199419312460438 -0.72430687817042361 -1.7773712249933571 6.2959698244356792 0.7730973693102684 0.92654965277303869 -0.94359605312379857 -3.7987775561858359;0.66547829836971195 -0.75391222974394323 1.5314207552806103 0.13631181491374753 -0.2900597770822736 -0.27588089945329441 0.35547357415757475 -1.2343366168039278 -3.3208448745927779 -0.42148421334511527 1.5884922795099918 -0.70773231114313928 0.61894572060467434 0.018450257071272371 1.4991947586363272 -2.6644157302348854 0.77722954718121562 0.080559473941723719 -2.9814430353597685 -0.46576890862266063 -0.84220507750027584 0.11264393120422289 -0.22739375988618943 -0.7236040942030002 0.41087973075947559 -1.9935736668941888 -1.3336361969951722 -1.5516003162899734 -0.62686092655955206 1.4017870634055254;-2.9787625175702681 -5.2918337476133193 2.1232315165299975 3.2837175300683326 1.4769294985974237 4.2518678957560079 -1.4207342781470333 -6.0078377759042887 3.5849696871414412 8.5963042863196062 -4.7137226884342276 7.9947660951953594 -0.39483089329374077 -2.767840520448122 2.3176715845703089 -8.0235716773821011 -2.1417706772029756 7.441804569860313 5.0879501353581462 -8.1380445721150725 -2.2691298623318632 3.5948588104532671 1.5732883686226944 1.7623445410423659 1.0070718684777604 -1.6367174069638315 3.9702181062093298 -1.5764898034731654 3.6546273995515111 0.71110258808363169;-0.10679014765725021 0.65196910069038227 1.8930527355231108 -0.055607330913715024 -0.039493112212823915 -0.014605739358391717 0.054475112471780378 3.2581931790111205 0.2406799977553187 0.32535915804884552 -2.4835149519712925 0.22890976863150891 -0.3620228680150499 0.15160807886007993 1.0792622714012041 -3.2450424821668578 0.6031571498932804 1.6478850149639812 0.60820442345581205 3.5753906236669404 -0.65161815415315594 0.26795227383521386 -1.3991766974169539 -0.50693576256889128 0.83828242656808905 0.21519976481318301 -0.35742981779420885 0.0080558765472657796 1.1791655387322582 3.7335146969638164;0.4228749810729181 -0.02543772868469138 0.57045676741121509 -2.4066508527226014 0.76413713535101124 0.75781265820351862 0.52734809988722864 -5.4548815510466779 -0.86361734674689628 0.045296421796930664 2.5488162564648453 1.3449325581679112 1.7836863446132101 -3.1010105802148855 0.057109869509468329 3.3390064668154449 2.1236921114612786 0.92911628400531043 0.81078141849357366 -4.075757860968519 -6.762229969006623 0.029414464373263179 -2.038190213997821 -1.3591608278830791 -2.1714245554590073 -2.8734624189026037 -0.5058850136734514 0.27273537353296795 -0.029802540985344843 4.5561099584902633];

% Layer 3
b3 = 0.022284415750518819;
LW3_2 = [-3.6598722065435183 2.3347355176524767 -0.012810480002667008 -0.18749574083780551 0.054381162255753297 0.24682168725936354 -0.16825457432333557 0.0060923416300774167 -0.84573712417969327 0.076262132740024399];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
