function [Y,Xf,Af] = ESPER_phosphate_16_Atl_1(X,~,~)
%ESPER_PHOSPHATE_16_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:31.
% 
% [Y] = ESPER_phosphate_16_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.8583897140708192097;6.6145627556788877399;2.7282729668236997966;4.2845448486493040718;-1.2332708359705153445;2.696939818985275128;20.110703034137593193;-1.6415451936514395825;-1.7130541823215226227;6.1444711841770942584;11.07344862079980885;-23.213561973884701217;-4.5385059034806563005;0.66006548020235367158;-0.3297837688753333385;0.14012162336503675153;0.37336841167606743541;-0.78676793869599193076;-2.1259818597310435884;-0.57484035366881647278;6.5763070599569140029;2.283791511796986029;8.9229485773033641038;-3.8722707222044085995;2.9751419455028225158;0.30679207281680059838;-8.8163485445520901607;20.20109664076389322;-9.2852912077458320539;1.4915359215449144337;-18.310722605262014895;1.1016494282246276359;-0.6159189770068038694;4.5546675732407493342;-8.5722464777193465579;-7.3838057793995739431;2.2753723082006973577;1.1197137523386990754;2.5708737909205372496;-2.7791358324676527225];
IW1_1 = [0.50831310565873721874 1.0831999050289213837 -0.69954220291417190669 -1.1772612797009753827 -0.65392092693048164964;-2.5168415919796047753 0.94354315341646299853 -0.12175452262013523874 0.34419536814209333864 -4.2002818963469188418;-0.61292263421401449452 1.8529521616388660021 -4.9149636433061267837 1.2365634575987567434 2.5834394760861258966;0.83890046637359771964 -1.4530041609085551091 -2.5102637683324440232 4.1062678406103758633 -5.0305204247473014334;0.91977487349723707766 -0.42921019913183033889 1.3177689009722575175 -6.1737079376079613269 -5.5577967646575023863;1.2776336815733968511 -7.8984670214047456582 16.46890811651173081 -2.2278862558641892022 7.0221978705801193499;-0.97016423282129848893 0.67335217476136310921 2.1051932567823801179 5.3071089534230448947 -21.458250849755259537;0.26587631690402296902 0.23418986943110156607 1.9539021900830264578 -1.1819846796559279056 2.1032203739196311254;-0.21742956148936368188 -0.41380857670254095337 -0.53391871732963058772 0.11707624439727011556 2.4944872261259396495;0.027530980214944076462 -0.51990250474169830142 -1.7776902280245276966 -3.6202784615789669331 -12.477071812616106428;-0.47453565673121667068 0.67646819926777179699 -0.23662969555972571123 16.59548261378606071 8.6514359135963143643;0.73211370468332714889 -0.29916975604587220383 -0.41897318073253203563 -31.504170762537892614 -10.529659894742872339;-0.32251363253751713644 -0.7832722864118698558 0.57635979977935258844 1.9798342437767344482 8.2770240660143450384;2.9495567403535138951 -5.1748195202983655605 -4.8383904339889918234 -1.0058570009861180772 -6.8374365902857947574;3.162638593183298763 -1.3940838196885103617 5.2109068739867723252 -0.52366804634641639371 -0.78395403865365931306;-2.8522953976798506304 -2.6383405363659782061 3.1030717032797365817 0.73611600189153547635 -4.2588695163465715154;-3.0316640762520212782 2.1021504965405282128 -2.8401933306873790031 -0.35438822268493103129 0.57366636153322314584;0.779140710908900469 -0.14639203145120366356 -0.70023425341266298805 0.41825519867468780033 2.1911264737593478813;0.2605599188600979943 -0.37880860583308106904 -0.10813789434720745553 -0.26207611256820090295 1.9355419603840819942;3.2960711032705591883 -1.5425641481285874423 5.4257620021519619158 -0.50320500601850493005 -0.56686035523393307756;-0.057265040786054544064 -0.52198713579600519719 -1.9799427554829316378 -3.9110839044299048339 -13.207639808741244991;0.43784346909447324769 1.3766564146804540769 1.4255630792158120457 3.9983227150707278952 -4.0670817211953433912;0.66410978165658340888 -0.62352995477160910731 0.91572877673784147667 11.929453614009123186 2.3626771468956992983;-0.19976885897530563541 -0.5762210220671718508 0.52607366704860836215 1.8565882421439579009 7.1303178229580144176;0.48412502876233293181 2.0930586826258759103 -2.3135807716489629193 2.2429816297112936674 3.5650218647010039064;-3.382956429056024561 2.3586481920471507046 -3.1243629257544491828 -0.42411064700153178197 0.74173930963849954434;-0.68170577747598759544 0.66806196689557995061 -0.9135878395257691631 -11.682445538669552931 -2.2314153805621539384;-1.0325993128698198742 0.613800033716870308 2.2414884143001057026 5.4168203681200921551 -21.481625058386210725;3.9484734706353115108 4.3936630350554910507 9.2552012359934749952 -1.6712823850552591676 4.2133368307554679433;5.1071011466904465692 13.879618499672286447 -3.0045209150802327791 3.0734272442556047622 18.789700434462069722;-1.5218587177538640542 3.4666196421524464455 6.2285842418274430798 -0.98525079646994484506 13.103484594976203326;1.0364933195741516947 3.2002320039131921803 -0.96810864673107466238 -2.4965808850253976559 1.1107087641047115323;0.1086061946635424047 -0.8020659490338841735 -0.88965852853414095769 -0.099534846338233118335 -1.0194149281896796033;-0.042660870544014899142 0.043181108204862948818 1.3957622094183896877 4.3605493202155303223 0.45301640383623886787;-0.45143307416705868995 -0.70366364739603803891 0.8783796940714871937 2.3589654085030824504 12.383603851333363721;-0.17724168751359806184 -0.87079675332384798292 -1.501268624446760791 -1.4856815856746550253 5.2227484026176060894;0.41562702721288624641 0.27036767627815888604 -1.692718119119168696 0.95077762526517040076 -0.36889499354497778949;-1.1120991826911166278 -2.1514107056747930891 0.19861489733099574329 0.63340620577953477 -3.2216010653302018518;0.35180699805744658493 -0.59048550870880511798 -1.4144121615963665128 -1.6298372378615963996 -3.4208410858699087598;-0.13551626167752345298 -0.33679245557306669578 -1.187960650952578856 0.16598977315215279749 2.1939613571213598675];

% Layer 2
b2 = 0.85583863627548006914;
LW2_1 = [3.3696242462486387659 -2.4242006176455821453 -0.27477293374626049483 -0.24462020085986596607 0.19814586375846535149 -0.032563412880428473095 -4.2084618710824148735 1.5245288770382692256 5.5384157970025071904 3.7277289603156233966 0.64109332631349613685 0.16976656887014410224 -5.3415030594962606969 -0.15378269233182667586 5.9569323003400347361 -0.11485262636538846881 3.3065882977655962627 3.9940113772367635825 -11.397407338754012684 -5.6779948740316692479 -2.9429212865740699279 0.1082910542245206359 -6.1098664873505681427 6.7365294118144340985 -0.81891732452214394122 -2.6623666040732612004 -6.252767631104047652 4.1298775504544202875 -0.069135823759984976755 0.058783366084154520248 0.28993141878725436911 -0.1892132347360283573 6.7974515074023331707 2.2774712515786239564 -0.48669324893828336265 5.0203883286755548454 -2.262638765031128596 -0.76124768124368047406 0.63744781823493645856 -7.9607573167738001629];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
