function [Y,Xf,Af] = ESPER_pH_4_Atl_4(X,~,~)
%ESPER_PH_4_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_4_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.9034958629231790717;2.1977411126479164949;3.8909004666778068682;1.1041424950850311504;-0.66216783980677584864;-1.5547750403648448181;1.4568031041612170551;-1.2858612426458788658;-1.1742497563277831674;-0.44226685340642002409;1.2502059512371137551;-0.39296063481077203594;0.12360173618918043892;-0.21806693869040574829;-1.047356005132498602;-1.0427829783337323466;-0.06832262413376873067;-0.51873741106557624825;1.2877047251554276652;2.4635943599351413091;-1.6857517072700396454;-0.26072967173500694038;0.74390360768182550721;-0.42231342823646383922;1.9518864843436156686;-2.1204788353868813111;-2.4306933911186923147;-1.9600354259539374269;-1.9396239938114372414;2.0523116275330375302];
IW1_1 = [2.1171231375493593241 -0.33157222698067495559 -0.14580443429323425297 0.35668647996626651198 -1.2285898263444670064 -0.45004683278249157929 0.61233594105845579048;-0.48549708113351514038 -1.3688698228475892904 -1.298947869019759116 -0.75785550874260443344 0.82861343653669727871 0.007539216467718991635 -1.009287167301399224;-0.36034910802467562396 -0.48705607937150485753 -0.67559147567625177366 3.227155023708156989 1.9225507805257082694 0.33849066853876796923 0.65758621975131981152;-0.17841869802245263754 0.7136831378014324434 0.3934788942011872015 1.4905241723934155029 2.9887581199005293087 2.460506318172408502 0.89939878041924026242;-0.35516627477332629592 0.70063586021140933369 -0.097420328983959636471 -0.66048852802150270769 1.8207247111558204633 0.71653436178362672759 -1.2155771665969634654;0.72532435017757357354 0.17608934625191977053 2.0327394648617111983 -0.96777831043857731608 1.5005143673264300652 -0.60842456360625196687 1.8653981594631641183;0.54698607726874992618 0.81296874142421948761 -1.4828612817811126501 0.60257025125739149818 0.39912697315839495982 1.1664470248835920874 -0.98123597862728872965;1.5633816946329730513 0.74056519594613268165 0.26704860369232485962 -0.15526590547017388166 0.29231127751860391806 -0.45096596796476823288 1.3446115054298690694;0.62502232159828963187 1.3261223541620210664 0.80170600958615367837 0.45974385646872256705 1.9100459264590912145 -2.2649134276797400211 -0.87002838524968406642;0.22394654076644018859 1.0747712250086010055 0.20880224116159554204 -0.025649450159592017406 1.7817798414416841091 1.1807167034686769647 -0.17002681424685811562;-2.4399750545397664858 -0.14523771072239996527 0.43301807533547731488 0.44781049009497952973 0.45475821052467896299 1.0288664600586774345 -2.4676555793599015409;-0.75676665041368740283 -0.027071907692840267018 -1.3627596164980189108 0.23303689413672298847 -1.5956773533390002928 -0.4988430964702502135 -1.8351158351376588573;-1.1722942494106576294 1.5617811722710484013 1.2695005532951975091 0.4587383910886586591 -0.35859291797278936009 -1.5988008610020825184 0.91211509446359728681;-0.77887956084622622654 0.095543853722478824797 -1.6417400796946057806 0.097908539715848064144 -0.33191842619704176043 0.59361745557562073383 -1.6302117809902445522;-0.088825208219676224375 0.3423125814559717095 1.9329673331966614747 1.2592021680903098257 0.85348949303394638921 0.92765695594611941033 -1.8298570021133724328;-0.0036085937707693131749 0.84471342508535118832 -4.998050414785501161 -0.73575118885961088289 0.44160361578384876857 0.17721766546817235843 1.1928748594609994704;-0.068263782943094736266 -0.024230683379579943254 0.89738847092560769525 -0.17289134912753312268 -2.6253691270973940064 -0.60210348181073491958 0.52199986011883803272;-0.41716881186370130541 -0.46406434195832496625 0.26084556314605411576 -2.191141813533516558 -1.2342756518363506846 0.81716428526984252745 0.12048352499118333836;0.48825667039260634006 1.5191680625386780878 0.69145163233456863328 1.0724894413190695364 0.52400940972506848681 -1.4550589948071972479 -0.52990319062569501973;0.1479674917966534442 -0.2163391856924063994 0.10549980314285373195 -0.63164402607743663776 -3.5161625932142093198 1.8905843207247046145 0.8320888643016838282;-0.46136169051959874388 1.1913809814880973459 1.3712885964557213203 -0.033596157555638037073 2.1715589491481570583 -0.47151423118720825478 0.62884573105532715065;0.80555496173890939193 1.0083866803575649573 2.1654559730330666945 -0.20986771297804990288 0.48723405948808296007 1.1798660944053884769 -0.37240814973529895449;1.7632459389899883817 3.1450539453708317161 -1.0474904003659928353 0.87735346403035019414 -1.0158171092271235381 -0.18974515313407042116 0.16007109660162713305;-0.14472873826727941649 0.097837846988001284099 -0.44734972242145548682 -2.3057948857673049581 -1.7205754186789368188 -0.30231808785004443685 2.2237236016148513862;0.22839730038913719223 -1.0442582962574007421 0.039516513927966137598 1.8971640585003102242 -2.0670408914134208445 -2.9496551603517375817 -2.6781326508617673277;-0.90922649450709303043 1.1853232162908797775 1.9591594935942893141 0.24711047333456742647 -1.1849166009382001707 1.5040468557731174748 -0.1257261548177765198;-1.1135184203173027484 0.084435076973171013792 -1.6426387692574044852 -0.048276275413416308568 1.0951788939169644355 -1.1541331671627972355 -1.5679713665022443347;-1.257307364877627176 0.98614084368997123597 0.24432538336249728927 0.21019820273585759773 0.84881006093795585699 1.6624946784754703888 -1.6166043071657532071;-2.3495800074387531708 -0.67708387201492614693 0.97774735256062650368 -0.34996432892332834941 -0.96059899322373298869 2.2356661896487715069 0.053834356230027073653;0.60134665911953533168 -0.017057868951124165874 1.0293829335681254911 0.095354657557080918506 -1.6507947669441158656 0.08276763056674148189 -0.46466525196999725056];

% Layer 2
b2 = [1.8351664306842556673;1.3384710314772607642;1.2506691139556913583;-0.43514333420233941574;-0.76162211213926733766;0.001635524724491459192;0.70472308707799258265;-0.88442153505609721886;1.3690543992230781445;-2.6406329226116782571];
LW2_1 = [-0.62545268695296418748 0.4419118912970508295 0.47759606227280620994 -0.5378630089114710966 -0.20003020031263696321 -0.27995652383498326188 0.7421436335147661989 0.30293997408422046469 0.18794492122021311253 0.068338625000729902315 -0.31313188521478296789 -0.084291497945688215188 1.5075276199655542886 -0.56897580369576072901 0.47763077700729761332 0.3168896781285184816 0.12715127894040403889 0.60252648542593123526 0.78603241560387382414 0.76493973324378672363 -0.92637835290298420343 0.76445165187678842944 -0.22573650724812657775 0.52826292699356969251 -0.44321353687651304787 -0.097041733295927912195 0.74487457399289924709 0.16083420744252288626 0.34025667153286953681 0.39346255427286586093;0.61263913987614704304 0.37529165437521055937 0.058290246533227813019 0.24875404662668920697 1.3664109679670930486 0.46171716974918819432 0.092668273666993275506 -0.22473779995863180092 -0.44578183073036758977 -0.90884124521224907145 0.9406615481161781922 0.45506910681766132853 -0.85240312822120489766 -1.6031707446579512855 -1.193368573380679365 -0.17391328131020852843 -0.21761185161954807454 -0.062437215094538707494 -0.83156386425011552532 -0.035299045113643040539 0.92500992686822003375 -1.0326644567581289014 -0.092157216628811988723 -0.70162427632689594592 -0.10943526370053704988 -0.41340344279287538631 -0.89585554717953885806 0.75770009517501479834 -0.52097902254354022666 -0.64281573881470432941;-0.37193101939931666466 0.09991457888787785846 0.93999307203917881193 0.10740446479739845786 0.042726450412959929293 -1.2360940377005433799 0.71912082788641984443 0.73829056257516245676 1.585586321950807065 -1.5646985944695892545 1.1149120533871803573 -0.72809858158157703123 0.67878891116179529419 -1.4775968895422346705 -0.51906703799522724285 0.36745858255198998732 0.4827566935983760299 -0.2039407917707029283 -1.307083797724718055 0.49896951578193027288 -0.57961411822118646953 0.5958343529098725222 -0.33404667345734184725 -0.90769464073902295098 -0.15330020702305738323 -0.13502721774179204939 1.1052294240354341159 0.63323124538322350663 0.71631846294649725859 -0.21941191150915401176;0.11692187133108286612 -0.24152343272144211062 -0.074076283770714249077 0.37321480582635280232 0.47194003059935518696 -0.54811768506543301349 -1.1189583547864045965 -0.33503847561199329164 -0.2450847779899392731 -0.4452738192376549109 -0.32788489116283842106 0.67219494052439610066 -0.33901263391430863647 -0.7431157552584430892 -0.72807399894627766734 -0.61210534369485902761 -0.98115933436258850886 -0.78784730308362216356 -0.025852113524149691881 0.7971268436041104577 0.0034702846303846790477 0.83904904262323565245 0.23892643149339107267 0.29021242477898784307 0.31996912508630998007 0.57448862704401126855 0.74522938541004213331 -0.029150411741351738015 -0.1414355792094363351 0.39834000729638008309;-0.32279158942446228853 -0.41283443887424020602 -0.38460974728840147119 0.48068666574717083817 0.75088105192064547033 -0.56826793935086317155 -0.99261239803513079405 -0.18555619676999066114 0.83856474422813342962 -0.84198923356346100366 -0.40555030341589209941 -0.093214901695713281438 -0.11065636019146754543 -0.3176386938137425453 -0.82789850591485081299 -0.67228356028779390208 -0.50673261929407675819 -0.82825562342440217645 -0.84008111782567895798 0.28948165054979896338 -0.26492214020514615047 0.78745182472295860432 0.23657053468637515015 0.16621794920124441375 0.35626281522437686089 -0.084082893532091695921 0.77709140334900050906 0.39660279760137406857 -0.23132884153307167741 -0.29706695590482451452;0.62932985303646249431 -0.79048075317790855721 -1.3832503437690741865 -0.061720257822690478833 0.805132948614985966 0.23994311373079421634 -1.263672361908695807 -0.48632214209853374953 -0.66245637979740135126 0.62893894421485696533 -0.06787338676625456757 1.7275617675456245159 -0.18428152576647643945 0.41780422670886518954 -0.026830700975422724225 0.22587230460015075839 -2.3652863760428002315 -0.081075767916414034908 0.64454965768628658118 0.47304038111320984017 0.094120601598501898999 -0.12276539355894254546 -0.1813053526402202964 0.60702056736492238098 -0.91375379341108953213 -0.7029683340877352915 -1.781629065435173187 -0.19204155743032072512 0.17058807248688973024 0.32278123203475378444;-0.37411924959461723139 0.59263483210252632105 -1.4847171705927795227 0.14445173261999480485 -0.47799269683799533448 -0.82575384558894426856 0.18668489388369674531 0.012710742646607032375 0.85976200475851549676 -0.71883884967541056277 -0.25303810903865048276 0.80090501599615460115 0.34353244658159304281 -1.5540094131751305273 -1.092436525886260279 -0.7417179278100010098 -0.91828125972744789607 -0.2398441036900992307 -0.90665248167726808504 -0.025805875357212189336 -0.0041268312794790693032 1.6359094040293693517 0.14408684065881138814 -0.15508746886715268909 0.500171925755825586 -0.39587603699467061036 1.0489848455145789341 -0.053954364150118686028 -0.055371437359261400923 -0.01591904559068377939;0.063373063428686884913 -0.32105475116427129034 -1.8559843520045176124 0.46593709512003389506 0.35541294287811092678 0.026046686753508376672 -0.25951490762275097879 -0.14529695095792918846 0.4641508696900485953 -0.63386970164730394028 0.13483195454550916947 -0.50215718996532709983 -0.3371962851630632696 0.98547891937101583792 -0.44289034750849537447 -0.257875007990289562 -1.0264385445535972874 -0.077176487524200962365 -0.018335561662065555377 -0.12787850417546359205 0.45521888786983799591 -0.25110149422661609542 0.11974124782215851692 -0.40113955876455381633 1.2351450803342503004 0.3872031641556645809 -0.94594731462875825123 0.056092971498607063774 0.4823688409215963202 -0.69753820082800455094;0.32929753852339704867 1.0043976164482155689 0.16051636126176785369 0.60536858122026271367 0.64044933206819987248 0.0029148839476543556525 0.9485586131907629559 1.1651330994935991114 0.47186148860061244426 -2.0352063498123262875 1.2840104489299644097 -0.064293550033278606959 0.72361217926339926887 -0.61691408161408722854 -0.0078317813207831321609 0.72657186896927894448 0.059421072013442828574 -1.0721383588253581287 -0.98753869606526079039 -0.17061897098726630517 -1.2446170741720443687 0.84879230799126070828 -0.39974093155806350586 0.49190277353970340846 -0.24666083347721315389 0.045024103359926404 1.0987676768967840069 0.8763722397284826604 0.35754549251784661923 0.90429441186086434445;0.33747001821766370311 -0.87770235899534199131 -1.5952429648587493904 0.50881378857460546339 1.3439796713492413449 -0.33967658622192570261 0.19318981020893299938 1.0810119263513588983 -0.070472190939995613124 -0.34639730468220619741 0.93190939438368147751 -0.92684666269299964547 -0.056142633706577481367 0.66383487788032979893 -0.20420095222648285138 -1.9574995367609810959 0.53771555406822701961 0.76065544976044074943 0.89094550240668102248 -0.77048118382360586409 -1.2479347287290154522 -0.72409789411568381556 0.23459925772974754565 0.34424283454645654423 1.5570345555684532712 0.7276819208750912038 -1.175542883168710695 1.5261133311945205282 -0.46236415066899028137 -1.1051615569341655121];

% Layer 3
b3 = -0.47846777117225203213;
LW3_2 = [-1.0413514889490578241 2.5570847681505388671 -2.7676559899441799395 -2.3030034611667558053 2.1524688604185024943 1.7697193152464112398 1.8303724416745286163 -1.6594358086661669116 2.452562730065455554 2.2865426377629787247];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
