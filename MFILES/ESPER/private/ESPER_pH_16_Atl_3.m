function [Y,Xf,Af] = ESPER_pH_16_Atl_3(X,~,~)
%ESPER_PH_16_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:26.
% 
% [Y] = ESPER_pH_16_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.547479095471988586;3.8204771753566153514;-3.1401488278654419162;2.5919047306355320615;2.0546239631665170755;0.097335729475450410986;1.9420522798167525469;-0.41349447703145003619;0.47640485656857295416;0.85589317209101856143;1.3076979516755500299;-0.0025054698692809239044;-0.4742109096802851198;-0.087772797703631999511;-1.5859047478173067258;-0.079213436618510532639;-0.77625863167718223146;2.0237791427859130877;-1.0090830042543661449;0.86906646593372738341;2.098490008226931991;0.84949016936753929397;4.0924638593513416041;-3.1332227192365667001;-4.610589594115772627];
IW1_1 = [1.7897208785872913417 1.0401353701781921313 1.7382309734045953142 0.01868199324360938704 -0.76370798678216778033;-0.93599731322718326965 0.60400064066452985312 -2.7342486238912706575 1.9660135303886123737 -2.9574408543320789278;0.7290789957098112728 0.29837419705492296274 2.2697110831699349731 0.018077564596452010137 3.6350628308760710716;-0.66586352364424916672 -0.4725865310820160925 1.7551579017123219995 1.9725608986283238444 -2.1280599615064588193;-1.275275313275658462 -2.5369329497933916784 0.71464329405501303416 -0.75746957735934927758 -0.1120631253828720808;1.0454287026913251513 -0.57865487738785303939 0.017212566379450004728 1.2234009211885066293 -0.74135602147334345169;-1.7366455321812173107 -1.2687851968827106308 0.4265024841716686943 -0.21118607258550903261 -1.5008310154628199395;-1.603465053530540585 -0.18592685893188037882 -3.3013688049447340589 1.4657846481406915373 1.7411456361942869719;-0.37867422585595023055 -1.4210652190515205007 -0.41442230147145708852 -2.1498370438761305046 -1.6979013572590713199;-0.7171448859350495475 -0.88835359569359573229 1.6296956696656190733 -1.4557831983907292273 1.3764736729539903681;-1.1574177964751952707 0.64842446047992052804 2.5838593311142474818 0.18699536954135118072 -1.5587188740860635772;0.7181724955088918394 1.4342516291925688776 -0.9066591665734512473 -0.99098334075607663607 1.3525363008912345553;-0.44582326110803582875 1.6220593762964021778 0.24853653468675690474 1.3045195144863417358 -1.4080382563625599701;-1.4479276152625741858 2.0577110739844739484 -0.76015200720122000355 1.5965648958123428436 0.85083319979776073083;-1.0372381858615111749 -0.44479691486307915138 1.9189325555012701763 -1.6094500968278087072 -1.1484483900661017763;0.84220653695997793609 0.57062394812111771891 -1.7757772200657397921 -0.30015211795182056287 -0.78010132305915746986;-1.7255552826873785666 1.6241798972440393278 1.7583271361586600978 0.1015760207993057912 -1.0632930657064703084;0.89701701356957053157 -0.022822331854386604388 1.8350605479944170906 4.6743223767040236183 1.5759912882405961998;-1.1068633189454903931 -1.8817277072885165712 -0.25785301040161900943 1.2223537822273959907 -1.1142335427903835576;1.2306133293816927665 0.95896249050045290208 -1.0389507957430090812 -0.55053557047071077779 2.8934437896740132778;2.2219886149450385204 -0.70757768389312691859 -0.34865398065102654046 -1.1749750276550519068 -1.7624444064603428384;0.66650699833821402951 0.61515496931418767179 -1.937752778494148842 -2.3973059439057990971 -3.0324664262718914465;-0.16253934098423369892 -0.47857262226761643209 0.88753967609842276953 4.0427855470369520319 0.23959337360392965466;-1.0295337820554213426 0.86304388708936807806 1.6488253387420119811 -1.4920505475679444185 -1.8936683629196850998;-1.0201216394850067815 -1.1337710675877217259 1.4423182081895216111 -1.1048216926287826034 3.2220190774434791514];

% Layer 2
b2 = [-2.002824295944868549;-1.387055776032876997;1.1181614790934801817;-1.2114437226081031795;1.1880501566532564173;0.033619227358250819426;0.81794038599252483213;-0.7911186585117586656;-0.14101009519576682139;0.58109010540843730741;-1.284704622462796042;-0.95157472204986848219;-1.1886100081486414837;1.3349864742083223934;-1.7279129371140451443];
LW2_1 = [0.58250608856060370755 -0.45749987720615220566 0.8796373711794547301 -0.26959340377260920807 -0.25737427018929837086 -0.34562018615759843021 -0.29900026663631873447 -0.36788741808327368732 0.44922559838954095879 -0.11936763879673024935 0.34313092400800382364 -0.31559475963948374622 0.93532183244003941347 0.26446642933136160769 0.79351888142061899334 -0.47038353243602193388 0.16060987318155592329 -0.3610988350777633582 0.17880368380225661329 0.21033842527179827386 0.81083420805229700079 -0.31048283695490541678 0.067778544617457733845 -0.66151790768397877862 0.17282250578878882719;0.31148964843936199909 -0.078324698691003419304 0.3179234656739793885 1.1034223758171926022 -0.70629043393221035974 0.55947293393823471774 0.47378655296858734891 -0.23952789777317792796 0.29661104969504858975 0.12015229021120436836 -0.026497201547772165908 0.14935816336852689168 -0.046827130393645499673 -0.46692049902852222898 0.47773906094512330611 -0.93546268773180674128 0.010950084048996191338 0.64365694687756092041 -0.31851736471658131933 0.33102844042269324865 0.56923404117068610031 1.2596819316183660575 -1.1759495877562868849 0.84296193319074608219 0.56551386164902850417;-0.30030796564527240111 0.17893726279588004213 -0.093314593364822645549 -0.091648928430308224113 0.019047560719293823994 0.3126442275984239183 -0.54274465299432561594 -0.32732676008895217334 0.46952101346159363926 0.30955922651907846754 0.20734548319824364082 -0.3874556193344699806 -0.34277669539623240036 -0.84532020759035531032 -0.021020262047790925358 -0.1701005711724065117 -0.50992611033278534283 -0.27900056950380314191 -0.16649896661696006461 0.16829144691487790686 0.57691117924257140359 0.27496092264011917639 0.18025600211395578776 -0.22718392389063404857 0.36821923157048963571;0.35688529231910648409 -0.27734000844645023687 1.2773867726893199936 -0.78325192753379346833 -0.84534842808900312328 -0.032764638930674015727 0.025013663131269042728 1.04615776359810142 -0.15253095940521252394 0.15995150984786776771 -0.19946809819726338264 -0.048788071043722291975 0.16198295362589226754 -0.25213618867827841674 -0.19815864182420414585 0.57043758104202113568 -0.55397399849417228168 -0.23849089044530161208 0.15490088160907325432 -0.189185161722520645 -0.048716945044492324102 -0.46721857592402410431 0.92443557065275316909 -0.042702809319070333949 -0.83730531589771817202;0.56963192986542143803 0.93018840321874174393 1.1942727512784629962 -1.4597246276552184874 0.5689994981561117271 0.83893393808424954194 -0.48590345802790396723 0.63455766818284853326 0.15896136518003814442 0.24058124454777396473 -0.031773032940911744015 0.53443304137143987642 -0.40499630715136059056 -0.16868146707251976957 -1.5814797358082459677 1.1124347161597432088 0.86857355691031823408 -0.52470956215389752408 -0.16173452209180236294 0.56382725002744871201 0.45212884929951552282 -0.68177177475903016912 -0.57938809040776151349 -0.35373125068847177666 1.4835406037537797186;-0.57910472859652972755 -1.1756096737067718294 -0.18617625202348339619 0.65310324586704204819 0.81774450805001375198 0.33100161515860987427 -0.46469075776942098122 1.6563464188883481043 0.73719585845374213662 0.69302604706053494432 -0.0087372762211457219439 -0.30115620388345959446 -0.40261636099221437268 0.38181437855935707049 -1.0050036593047035893 -0.46864769292041130733 0.95439798010309229159 0.73099726833309830454 0.11409317497008263087 0.2491446994761681577 -0.90682159500384929007 0.15967694776061194806 -1.0825961830857850909 -0.0093712353329877002422 0.1052188591541422108;0.23257584450961002465 1.2399852093011363152 0.45482569201950834303 -0.14685948499542517132 -0.37888993765400258429 -0.66301237888383501851 0.44556457893762063671 -1.4603576102253612579 -0.71816005932117532584 -0.57218463920897655317 0.25365264102256612766 0.31581663924823943912 -1.0210659051775523576 0.24002686716213378348 0.72926922400081783948 0.70032269530539004165 -0.75401903662672753459 -0.4754701205400927444 -0.096917567542497570776 -0.76670186143060814477 -0.59350578940752174439 0.20986261908933906417 0.22922403807047989077 -0.27125549255052161524 -0.26860123879357322707;0.64841184808946061846 -1.5923385222405370687 -1.995810107456418292 0.60010718739550528156 -0.15999753722582216175 0.47498038531828407072 0.99255676561760985965 -1.1708877092632499206 0.015253786183499647849 -0.72053265797260757086 -0.83031389534590371859 -0.51901975726825000379 0.48920349178039379545 1.0257147447780672334 -0.77905653472951941207 -0.37972948404323086935 -0.32714377649107528878 0.63658363419017793827 0.1994893553860237756 -1.0054259661851976393 -0.49807368803219448372 0.1056133084925892085 1.5553703571928214622 -0.21321611498052131517 -0.97816048986804504661;0.24821243576064422331 -0.2365749386248266195 -0.40404332578420115718 -0.97125134505024812714 -0.36396651283106296049 0.67418311851637213739 0.56216564496698107067 -0.61471586257218191474 0.47261337583573115317 -0.29810689238479204377 1.0580685450233604517 -0.9435185208962011405 0.06525326273730676363 -0.2544209180051223429 0.92337786385683284784 -1.4676019795211623364 -0.8410340861630540843 -1.0142579310531500969 -0.57422041370077392397 -0.92207076495130924076 0.15693057442502761356 0.19502724130933196678 -2.4985864970341595814 0.87316156330929584062 -1.0077715319555826667;0.65905619348341681896 -0.25642832360519307588 0.73414910779548092634 0.092233575107288606754 0.20140226959983315025 -0.098355415402313878248 -0.63557377124821123893 1.8645789763794979876 -0.42034203106824080676 1.0592688505332521487 0.018400986345103922254 -0.095500527315324351685 -0.18559944643068357339 0.11201352963081331882 -1.4970542424867807618 -0.55147158962772990787 0.23211336957750819399 0.47667383054206430293 -0.13591998239324620812 0.35823533788859746041 -0.65329081543917266739 -1.0929843680769424363 1.117081690350995471 -0.48548617611666017302 -0.26535718861452428641;0.17640202453062958643 -1.1075066327773521735 -0.24520959209915815791 -0.58949270590281366289 0.12234670162086351552 0.90833665437723709601 -0.10900908637856095151 -0.031303731969051500073 0.32050505535140927371 -0.0043168364860216943552 0.59728675405090347894 -0.36507548406073581093 0.6208277231935204199 -0.93821632087385842258 1.8806227580680487943 0.62977746470361750664 0.43933741175408874691 -0.13635505092734009902 1.2307654657540512133 0.76230879400867690432 0.53397039084170461187 1.2873861853357921881 1.1951211096880918205 0.61055161347584008258 -0.24954629930216015721;-0.015754003276192293792 -0.23894013109123446448 0.3861844201766517215 -0.49843507771053907618 0.024565173408104684638 0.35144082429760131747 -0.1800518225791565563 -0.79888859494997632726 0.11597626526439509809 -0.32947593396921753817 -0.57994251762786763749 -0.47039929318630147037 -0.17418745002113153464 0.15378846508042123831 1.2907934325361263284 -0.065195780173356032705 -0.56263678776092429512 0.4572757280921850298 0.57066229767245868487 0.20465542252833557324 0.69613664193985447248 -0.41005636239789622355 -0.41053727134596207371 1.0371029075195339342 -0.34941258254430490604;0.66341089123349838985 -0.020544564641515977027 0.0065718309825504635929 -0.83953241871592787504 0.061537180732474786038 0.5023960006524571531 0.69621570631360107928 -2.7318373120577503776 0.16775385619260063663 -0.14901791476890532961 0.86847257063051552795 0.04180094425949899134 0.60890212088653150602 -0.088182341451908938246 -0.62102286063791467541 1.1019940772983174426 -0.21747446752418447824 -1.9236928253143399381 0.69247952795390022018 -0.48249787812125355391 1.5544486813789251123 -1.0825116901144244963 0.60727157251768659751 0.60842315279655001525 0.38295420852193240435;0.092802089465057024942 1.4484126466192588367 1.2458777493815580417 -0.2742016627474965218 -0.042521900085814329229 0.49714265345343600089 1.5725883023702114105 -0.09256567163962765854 0.30801312455494922471 0.38992784538488350909 -1.3884951769357678497 0.082346915909423321067 -0.11930563099374189018 -0.18434692343584782592 0.24537391479046513632 2.0423032971343966224 0.66508649723468837855 -0.30326549082023879222 0.071570722028016744987 0.13344383541638313306 -0.50359395948503005158 0.14275189540759175566 -0.38795173464621990345 0.6456981279094838877 0.21704400399950579681;-0.27936802454798881357 -0.19086847960710276451 -1.225739461023682253 -0.46711880895592022833 0.46091850212851981361 0.10477411922375672038 -0.019139154226032531469 -0.62314626626880509352 0.1461974018534950015 -0.017546679500485464626 -0.068886301346388220668 -0.086894007764180242193 0.37508956285121747287 -0.08720641705410850375 -0.043278625707046533555 -0.55838150862427771148 -0.32922937013277037144 0.21544359177098115765 -0.06584566468778353665 -0.482469481359606156 0.14368876835695013061 -0.54202779341023243909 -0.26413685482622961676 -0.79122834059448621247 -0.40440901245472654635];

% Layer 3
b3 = 0.1580936510580587262;
LW3_2 = [1.1084193246210791717 2.3913362034171492532 -0.19113839804256793631 1.3745447925870688533 0.43244188531686006405 1.4603717924400425598 1.6150076536187671916 -0.21605402924345173954 1.747298780656998618 1.0186885837883061789 -1.9321337371437350416 -2.8701630733856471345 0.46392219625732455945 -0.35684646963113564322 1.9759657686232299234];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
