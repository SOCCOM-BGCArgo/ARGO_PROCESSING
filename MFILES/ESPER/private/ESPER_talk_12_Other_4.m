function [Y,Xf,Af] = ESPER_talk_12_Other_4(X,~,~)
%ESPER_TALK_12_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:49.
% 
% [Y] = ESPER_talk_12_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-0.1386];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.8413103955003882;1.7373988457038909;0.84571198004381842;0.43756762941509481;0.044681556857401328;-0.73266025244952349;0.38548067677978687;0.13316593614279831;2.0711628291199169;-0.051556547979908503;1.2481669489885496;0.77512478089610881;-2.2160832982264704;1.3032393917548004;-1.5733856368288663;1.0633306606253907;3.3685828758232974;2.6586107148937144;-0.42940925234689548;0.80682334122329114;0.047648430622104956;-0.64270662659775779;-1.2854785032239147;-1.054820402151841;1.1552732040550098;1.7412250267089457;3.9672318078383149;-1.1803253887686431;0.93363880408119648;-1.7421674613834801];
IW1_1 = [-2.7289443604795527 1.5948880229568712 0.56016067708249473 -3.5670607015657541 6.2232311725818121 -1.4367863203315154;-0.25799197908548438 0.0040741998092300074 2.3128365966781219 -0.07735909400432936 1.2407208768914741 -1.344582172572875;2.7743025764146982 0.024230029404746965 2.2404185408030415 -0.41673121675028557 -0.48015578514198692 1.8811649792805674;-0.93445907760927238 -1.1145370709442499 -0.087975959628053838 0.39381992821404571 0.62545037795673519 -0.34682197974409046;1.451238538258564 -0.02157743541058426 2.0886603992203461 0.60738030604227111 2.8032313226145833 -0.37455390618581785;0.12586575109013654 -0.017127861414353514 -0.484669417449131 -0.39390648516910853 -0.26237785105952943 -0.12797321366795417;-0.01646077431887422 0.014306156170694764 0.042500677841453276 0.053528477422346767 -0.045634422286582592 0.11878992300436218;1.1626101479700297 -1.6586397798071506 1.5377423408029005 -0.55215906178543639 -0.33066887776852755 -0.93325919279642966;0.04572542364598018 0.095350303329364755 -0.010268014826529677 -0.47900404133153968 -1.2558809468998748 -0.10580340543603042;0.26023640974496931 0.94777932835247836 -1.6497967218508103 0.70711403829853803 -7.046142865636666 -3.0710052905029173;-1.3046789491737485 -0.45331729210897226 -1.3015132554526103 1.1205128356133403 -0.87006620757119857 1.9506506872332907;0.061119963741677094 -0.038380371259920242 -0.67503452041912937 -0.43988718008467481 -0.52704104693210718 -0.53916727849150758;0.093230936228145475 -0.54797345993186386 -0.27909073096276549 0.50140003866993155 3.852628058701594 1.1111176759405956;1.2973662821138869 -1.19919323615244 0.98564918951912761 -0.40062521096083864 0.78251778147643747 -1.0618514722413888;0.92765897740179415 0.70543654167010073 1.4111374077599628 -2.1524801353683851 -2.8989287691507504 3.4422626507939462;2.3753584481365118 2.7372128505118094 -4.2174649966363393 -0.12459724300752792 -4.4563409403977028 -4.2904356848011549;0.93557268366819413 2.1105214958407994 2.5517760499516844 -0.29057215332496616 -4.4287196714338828 0.39452338508307166;2.8603936572494155 0.43019036493030594 -1.5590650575769098 -3.7292325888354325 -5.9490177062882603 2.4109394451869872;0.79465204031395253 0.32105948660840306 2.4543280359583499 1.1033975194896786 -0.0071759895691053573 1.0669412252515935;0.37930436437963289 -0.35984698963482886 1.8075816847594501 0.88728466627926539 0.93948305855787184 -0.78775299647327846;-4.955472049672669 -2.4730159899330904 -3.4758506018443573 -3.8161021817655496 5.6502962925622029 3.5829686934813973;-0.011341791081391659 -0.12220154126384064 0.041130305377169607 0.065778334400962882 0.62857699445045456 -0.63997911291057252;-1.8349221588230296 1.5680449050792458 0.67270824930860418 1.7969759018665681 8.7338779508274627 -1.1349922544639737;-0.68545759971864839 0.64700998641245322 -1.4512446695649384 0.0055183856616219567 -1.7531334654216411 -1.0902472815645516;0.16888428672190703 -0.49906399068076823 -1.3015991020299282 1.7026841133158308 2.6190339456619083 -0.48930061466673946;-0.27518774124196255 0.028362251610478683 1.7478905447263033 -0.14140976618908871 -1.9333598146066253 0.57634417218687606;-0.46972459360567254 -1.1184974417948004 -2.0918792757997924 1.6079417305066948 0.099604751569591504 1.5430846879995621;-0.019820864865802094 0.029623273280594442 -0.38640303880378218 -0.13524004314661092 -0.40739179947511417 0.53863821620034091;0.52173364045353732 0.22085739236932281 0.1540535683162618 0.93997640908692259 2.1008603425209129 -1.2624824076378363;0.28114717620319851 -0.020782670377998989 -1.8227755737269746 0.16145946428032648 2.0505009684276199 -0.54626065444004446];

% Layer 2
b2 = [11.685813726407144;1.2675897911414884;22.734348093885348;14.513372821038097;-17.766264572161614;-4.5962056620703802;15.523173182233794;3.0455406026031566;-19.891454845973119;-32.71299936385951];
LW2_1 = [0.0708187756560507 -17.420111987551866 -2.8165362112044368 1.2094045823867219 10.595510193333782 9.7541300191560314 2.2208358136276747 -10.137372014724257 11.131132600702493 0.14478320219984475 34.271344825210356 36.282323364867949 -33.929189914283896 -33.981166900170528 17.720136745972972 -5.8690991940092916 -7.7009704863103581 16.916784963528386 -11.87159978008629 -4.8914844437113345 18.572299628022535 10.16173186988798 -6.4888625817731347 -6.3153861718739543 1.9901350865189726 -7.6373323952661396 -37.140903668339632 -4.9456317177980145 36.262132102578725 -7.5400551464453418;-3.0237003529381297 1.7006744289841154 -1.4993991349197329 1.2362345766797791 5.2919479376688985 -6.8382709058253512 -24.070597937154563 -8.105673293530943 -16.13081707100616 2.4666878903019356 6.136873821152963 37.14840883989477 9.6064639830956118 5.2704671869516906 -3.9686971117311414 6.4309619744523054 0.90483029877740684 -3.4565215507156926 3.3880557017638178 -3.0903969434435941 -1.961932933810917 -2.8577372265518037 3.1890389973291238 -16.320103323704728 -12.63193042575702 20.821117425877055 8.2047178053251528 18.393219141450071 6.294811352486521 16.299278698294543;6.6187131748051913 6.4777760670293887 -3.0642592733135987 -8.9419945922447788 -1.3290403348891759 7.8254128841139536 14.877248870862593 7.0326675769030285 2.2281026355722484 -7.5837499839852525 -9.5442441052675928 -18.452482774145043 5.1753063625262605 -5.9765960162751144 -7.7622638066598695 4.8673615636606886 -3.502539347996632 2.7363788938638702 -5.1778294706141166 8.634642677487518 5.5018228331973429 -12.414797082506567 3.5599686427243937 8.867594482552029 -3.1827206541962503 -9.0687089042756241 -11.226171184740744 12.777382095069092 -10.740283597434095 -3.5943918603892464;16.141416978362312 17.380358892979825 23.592183016485727 0.54275894412300962 7.7399776116779435 19.163797819496036 15.64543966702715 -15.203039124422322 32.590065002836937 -17.263382839398023 -2.0051441423903476 -23.691043236522393 -2.8239130915161117 20.741002233669619 -5.3487300217217806 -1.5477436389054233 -17.998401967273704 0.27415627538216542 0.86342657654644017 -8.3872700146487968 4.2257962238633464 -7.7162790243923025 5.9935027040278106 -1.113306891683979 4.648871566226898 -7.4094867531484239 -38.193289700428338 -14.291748171821716 -2.9050704037063757 -15.77278805938513;0.021178606764274938 -0.31141518914327959 0.031517950218098632 -0.057279772247677364 -0.029084604619558484 4.3887491169074595 29.707630454236561 -0.025122905439780074 5.3177697764147815 -0.0036047168524611082 -0.020933808756452479 1.8193810798043328 0.30853574687483715 -0.07743872181324693 -0.046292045656742456 -0.0055180710331927812 0.018682269858074634 0.0060317273678994979 0.099005522705398932 0.04602050494787556 -0.0074440503345585499 3.9331952681253988 0.012386420411485331 0.046516445842604288 -0.1232799958528584 3.7090690513588767 -0.069705098712291691 -6.1730690901633745 -0.23666785124842396 3.3462515730893552;-6.8631987454757599 -21.197397380762617 -15.452861207233276 6.0021532181153852 10.216785719652348 -5.2370058589960822 -27.792283848154433 -5.1444570786407482 0.011887510858343645 -1.5961415788252091 1.6792834470390634 5.1546870325664891 -5.6944424534698905 -4.4536215404970925 -1.1519201432949873 -1.0067308646826301 -5.4727352721103903 9.7770072116044879 -0.14959294326186554 11.295163479435702 3.9999365504254238 2.2758768131702518 -0.064247647196769717 7.9805057517358788 4.4831339823751248 6.7564730458063833 4.9366698467297185 5.0229306919409158 -6.0765863312964443 21.703077297705171;-2.801156895703786 3.7959971734544702 -74.848112838587923 -8.6865279451691109 4.7037657989207915 -26.62548909183182 -52.007546608293204 -16.807286989304316 -29.585620166377652 6.1953132740424115 -5.2752600885754655 23.127128157945307 -3.3124542481051527 20.284859723037343 -0.20646821899301279 -8.793448000318028 11.016225996170986 7.3644331015981459 -9.8757912699508186 -18.286207468947865 10.355288686601712 2.5271010104554947 26.023055695297078 9.5282723479145144 14.544262298576628 50.085963349965951 30.32409318212547 24.450036988942326 -57.837667200693254 45.4034387395455;3.9798081213109326 17.869663820936353 0.014736950523460976 -23.33097230870866 17.815693002412079 -45.859912056033956 4.3485880571341262 14.749624021678393 8.8600260165005569 12.281808618594001 8.1150948705811619 -3.9781147171787525 15.576366453387301 -1.2140798456450796 11.538558221660089 9.2998230566094513 -14.638072313279684 8.2780123001750443 -32.269774349245594 32.182770032313535 16.952653596956292 -33.956548834008679 -8.6492883220355097 20.893449525862579 -33.167732136629091 -17.492438500913021 19.906395990426837 44.845956465931046 9.6271575574756927 -4.6051818465105354;32.131470323228534 -5.8734599004857735 -12.742849911863368 11.659076303079681 -19.603980118194389 -24.33472264087008 -31.628294194095613 -9.4156238858774177 -44.058230526478503 -16.684632742523661 6.562268737800899 22.866494751408144 -48.072883102353529 11.561542536347089 23.181616752967486 -1.4500450607931235 12.245949672200474 5.5176310299022884 3.6112480864836907 -54.760831342124568 0.92843600194014353 26.364440263284486 -3.2088013696817752 -24.669958806155535 -45.13504509802825 25.853936525858714 -48.191153855249375 -18.669970013011742 -2.122557547318344 4.9055915972326876;3.4465416143239094 -0.026158885402408408 7.9783779293983557 -4.2006706703982566 -13.874435741075096 14.977479082358119 16.897180362748681 -3.3999040230455306 27.497581254421824 -3.5352160745049628 17.147270458940849 27.117318323104634 -16.519475300720913 -1.5897368819027369 -2.5258343804150956 -7.3925765801142935 5.6956256854641705 -3.3849627792249879 17.701243549992348 25.017020468814113 2.3342223126980013 10.79243180221394 -4.8652610122892881 4.8431587306414343 2.3876072028801141 -16.976908008288905 -8.8009629745354729 13.086871478457184 1.5459490419030315 -13.312875814922807];

% Layer 3
b3 = -2.7388213545944473;
LW3_2 = [0.0042204059872617836 0.01375653646992875 -0.0087093294567685206 -0.0088954001092862809 -4.062947539326097 -0.0049623225914514311 -0.0011351320448771893 0.0043252951756400006 0.0036193638423146716 0.010787740004702475];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
