function [Y,Xf,Af] = ESPER_pH_4_Atl_2(X,~,~)
%ESPER_PH_4_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_4_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.4185078912497792736;1.9178303521439408197;1.6225763652000209092;-1.0548432857992229295;-1.384915956153785821;0.64291303825385670567;0.0083309405855972427923;-0.8594282481149121411;-0.64246005804434547226;-0.27278995588940280204;-0.4273787960753865911;0.50600370089750501545;0.63216868514721225036;1.41833853012231903;1.5579595642274937095;1.3392007305759732194;-1.6418106105443932563;-1.8541447395271268839;2.4972909956955384736;2.7622200278283157715];
IW1_1 = [0.74152670391639441405 -1.1536767710795292619 0.3399662917577951915 -1.1140323083517733593 1.1726920430987417543 0.89577783513719566599 -0.6027643300572377294;-1.3494534599543546172 0.35119870017568100007 0.097969703777195618621 -0.33648130137995607702 0.50176324372543423813 -0.59017110426847274596 -0.61838249135414846691;-0.11534030949390280951 0.46265617641342982047 2.1342170164817608757 -0.83257693340545013694 0.4617614730516646504 -1.8942426957980744717 1.3926161690030915974;-0.24101209733870493368 -0.74095075324998882493 0.38753485472475618367 1.7516993787345105371 1.0528306085145884285 -1.365200772558849307 -1.2725887938045763459;0.51617792043488430753 0.83585797577803189196 -0.92636057693300510874 0.57323390147173902687 0.60055447718812737801 0.047832612972014333652 -1.6312417990271173007;-0.47951618029485554295 0.040343334825620254247 0.09563626710157902 1.6648355180071179316 1.5606794669654711072 -1.2869996878785734395 -0.69142207441188885397;0.56631645455687373847 -0.47803672714411110656 -0.052665480225936485426 0.4303894542271139434 -1.5620854827014780675 1.6894215073985126008 -0.023433954375465894382;0.18678947181552613133 0.56045786033868605358 0.32654495767913938042 0.4121272673476643611 0.93699635799860281349 -1.71204082153742565 -0.81657599541806746846;0.46629667436258709357 1.290334074240929052 2.9392243133830606716 -0.86939304637032399636 0.20523951227389650165 0.15708353221226578622 -1.2646505528782174821;0.63083925811139929252 -0.22559422142614721229 -1.1039289882120986164 -1.4944393474568808955 0.21649323297417996659 1.3544576496209641547 0.81021035330940005537;0.37841373590323845733 1.9758193398512675643 -0.60783534570885089376 -0.53574536689565699366 1.3381279988811238812 0.87718678664625449048 0.96898204276320976103;-0.16117287760615409131 -0.32946009811572835035 1.4483609495504510267 1.2963840221394766772 1.2459033841700306589 1.2138904607316889361 -0.32336279492711916816;0.16122038221984225093 -1.1294737294356762547 1.7796020165674193425 -0.55768505488804975823 2.2346299489529695137 1.2392348407359854434 1.895385643002345688;0.57310477011131200076 0.91311208978734303976 -1.7572778709350440618 -1.1739251377479180682 0.44394712800924973628 0.89183737274065721934 -0.79233394303794901781;0.36159510008036932494 0.17464235629456886789 -0.69512359889109054389 0.97866423810321712118 -2.0103059563280516464 -0.32756010073865388099 -1.6542574479455554037;0.64043043909739560959 0.97030241568615671621 0.71951325872651805682 -0.81747767961774764345 1.3715760715392537605 0.028727779908590583141 0.53951146073463951414;-1.0256398533374231352 -0.42425320735681815165 1.0903984973391944724 -0.34910907205466978898 -0.04718214459419454998 0.22400897049013573925 -1.4099503966559372437;-0.19537660318418434424 0.0004877285745550829707 2.2459338967067958848 0.078470914656745091587 1.4854074557915899479 1.5948225613906747977 -0.22150956708553964924;0.53957751350281091263 -0.023909328751843577504 1.7325787980147870915 1.448023931979159018 0.17066193802170720462 0.0031796238000965570611 0.32767341630169011246;0.44467347762642445153 -0.16492742896094908511 -2.541433473070710658 0.28106130371045739968 0.37403366697935136465 -0.59899124140616799572 1.5026056440998918351];

% Layer 2
b2 = [1.4860416557149040973;-1.6260980495930490441;1.3041494231016779182;1.2962008807563958346;-1.1615130921119418694;1.0873423647539326442;0.71853563972321354836;-0.60595609647075332482;-0.71385916855145947757;-0.67893275887084203468;0.37442551142450558599;0.26582474548616635834;0.17841629106067685706;0.92372439587093380098;0.5182224540371448418;0.83459661078117619581;-1.2430739284718228532;-0.96297495909410946169;1.159516344995754622;1.5954033603253288121];
LW2_1 = [-0.24667872992265196808 -0.6956569645121516432 0.48363362641373514039 -0.51027124780896648826 -0.46185445521132262314 0.57373149006845036713 0.57212743297201751336 0.57901259758905487818 -0.29823438834242455009 0.23986377978363795926 -0.36877327096351170121 -0.15714645484127906516 0.36155610852696895563 0.4251157183531976691 0.4398112859865315194 0.13274539504122942479 -0.056226655590835235288 -0.28531191538585365386 -0.52301200891869292775 -0.18411617151092871114;0.67442685764087473288 0.072918494502697578374 -0.042920323623786317546 -0.73269807528384656159 0.18013262915765002048 0.051326254870165718969 0.23669918134739090232 0.37712072523075684805 0.38816812950548124084 0.40942217594176033568 -0.62864665496435900849 -0.91649718104813693298 -0.34214170243428060347 -0.21015092426338990994 -0.35655746030934226676 -0.054938449035281229638 -0.032891197509406652766 0.28489499951140451195 0.40528058679135836595 1.1044315691601778173;-0.28667451545062538898 0.48694941538196051534 0.32055575130853258825 -0.5003989684736278587 -0.37808537727499030856 0.50464481711472974901 0.10382380326095751177 -0.081631365316330903315 -0.34421412586424077196 0.49202197162511884798 0.1078447915822383224 0.22713157810254730462 -0.51345466809089568283 0.48502886921515253604 0.27535532669444856557 0.52191309684650910583 0.17044045008129793395 0.34564473503480819261 0.3218739694277111818 -0.0031114958418300814845;-0.60033170348781539349 -0.41568903487562153254 -0.3754562629773943172 -0.17762778120119845915 0.00048477385205765964604 0.28776971651430338639 0.12043155603316513247 -0.2342711176050080446 -0.49344575423775605127 0.72880461100748561432 0.60942621194097967852 0.40137564387195456828 0.696132248826788258 0.11913427213559520113 0.23595055664965844389 -0.44436879538005608081 0.26580162452981115351 -0.37425940673925361946 0.14861021287734491048 -0.92658139188207988557;0.19131102770063557195 -0.55446364117476398814 0.087060954519592795298 0.078260931013672110912 1.6497689260767969266 -0.28260616170660940449 -1.039094040541658881 -0.508413953610099556 0.74997686608816671594 0.75175382762147291427 -0.45990704766196599529 -1.4400242269631340353 0.69568416616779504835 -0.18435962467679306576 0.42098636012983470245 0.033183936360892486717 1.3888676591275994632 -0.26354493393813183122 0.099931301449673229365 -1.0155843717501216172;-0.33846048687543384137 -0.074761446824587560189 -0.80703405106067926944 -1.1070289919118472266 0.65917423814506170832 1.1644466122668533092 0.53731852976499572261 0.59513927736658245315 -0.12623707614024601287 -0.52415060586831496714 -0.88936749872121090288 -0.63340500637872876322 0.04365674531002306652 -0.04891150002448046985 0.52481621928829336188 -0.12776108510812478336 0.024897026798632451022 0.3078844916822772726 -0.41614777016891202344 0.17476679679618459251;-0.028572872133171885872 0.013663795953283781187 -0.77439503442420853929 -0.73723505481584539201 0.67603923242302454977 -0.43140680516324725335 -0.50762191214527341288 0.69292238696600083614 -0.66573609129703659182 0.81001138447224751982 -0.0068838613279577180737 0.58275375435633758325 0.83317945496995160504 -0.026361230728618168656 0.26200137957861174831 0.60491467413294064404 0.66666673386433361603 0.21368090457532704085 -0.3122925968804680652 -0.79209778970592448211;-0.34825193127488390799 -0.15423481115852011314 -0.97240882041257181712 -0.1134790328173598678 0.20389396569850207208 0.24850144705119450728 0.22184861454738225017 0.08943059749333603925 0.74165684465890391319 0.25875510798186085459 0.4530561326488791174 -0.18515597363786828744 1.4262623197317458867 -0.35323354306920257129 -0.42861814838745515566 0.13780474249012844568 0.41021093151107479446 0.6346267850346363204 -0.25116866872003129618 0.14610633555285418295;0.08393444384683511339 -0.41953648150499961433 -0.66417158963118316795 0.29663144716436173898 -0.85067161390160872525 -0.60457112186949246713 -0.028099861183126753628 -0.12829476963490718533 0.35259212771897335825 0.64722012324835487274 -0.72433886822803816852 0.44296659134369964494 0.059727296395493387204 0.1668741312906916463 -0.3341200793304119343 -0.63464171077874964588 -0.83532323334384805946 -1.0276060679179763735 0.86257456145950528459 0.096878739739757857574;0.30297854802463125568 -1.0780849226077184877 -0.11091788599387537861 -0.083061256769321495375 0.76152761606662788818 0.43796517627340703083 0.020356121928058617393 0.29441219911864291436 -0.50545428057310204384 0.2499260584125124196 -0.66423124997982085915 -0.50150994044845198516 0.66806767082143458936 -0.12111466485793498382 -0.015047102033355989545 -0.39091052793386371622 -1.0692986145128362541 0.75771678842648715335 -0.0029547442695866399376 -0.53244443860244905498;-0.61568684901308534663 0.50551420244518319169 0.096518034335193847451 0.29184985656851131219 -0.23408607062087946615 0.78779627492621795426 0.58509997629888721438 0.35198397194917463437 -0.37917565865247571111 -0.40249675016814012718 -0.21829059583138046841 0.63387001209819260339 -0.02278752687423967957 -1.4738707123450607295 -0.19642947775055943915 0.45646819351620793181 0.58020491501033732984 -0.10591932441307905233 -0.14655767430730548551 0.71044139471917233664;0.57254751240425860725 -0.36344550438152756211 0.12210850484599254651 -0.21259465412474759516 0.94732531158121491277 0.25701533468194154297 0.18899950727761058444 0.66314583892324863168 0.050177612097139730196 0.34465295990714917007 0.66858118518428655275 -0.021810852575371221518 0.076762723648973962831 -0.30129652217560848326 0.99603639624632622773 -0.70726303101584531152 -0.27710395355212352753 0.34515045602871002872 0.21042574977600222996 0.29913399306716792481;0.34121134110439227394 0.19395705703152479882 0.048688114211892757899 -0.571636726153366026 -0.17945768005232343167 0.16110355081010360734 -0.085575161593222578982 -1.001090425093044578 -0.032732674871024110275 -0.27103354241292193505 0.27249323224606203375 -0.56870483585152420414 0.58243162488568533952 0.26654755667711266254 0.6874199939056565567 0.14992465406645408277 0.017794037600669228294 0.31320242925804414602 -0.28135032746960170202 0.53010980969441789945;0.17199490001189249311 -0.31579103752141696182 0.27002470241742809742 -0.021419328821077353309 -0.56865787831159242405 -0.17826708219998035898 -0.38456415470314153637 -0.47941871498957494557 0.23881417819423694793 0.26072379146209534451 -0.2618446875931516038 -0.055324724366518550356 -0.19340138559318709177 0.41868242028786062381 -0.37224314288783050264 -0.48265083476410525209 -0.37883453678888145966 -0.38491972837076798841 -0.74347518993271843879 0.13684272387704179974;0.38006074779102133609 0.035241787997163723234 0.95534164970208623746 -0.45226932495533894718 0.83314091928784828056 -0.76963264089013994074 -0.11651016956902351951 0.32214888203962449564 -0.076761307849141161008 0.68675772854708905246 0.2048258413033382519 0.24511692829219541845 0.82558173174300653052 -0.48042845298951075694 -0.18937799601768290358 -0.74984463221522912324 0.27884718826991744534 -0.19057215248201631042 0.48684754180252465261 -1.164495286023377485;0.54340334338887530397 0.21008835017932753209 -0.83721449627658861559 -0.61946364804975706519 0.19261236569043435618 0.58027449719004775552 0.82892654326887338367 -0.98002497872885596664 -0.051315011691751066802 -0.16526714334060257916 0.25415053962356720652 0.14717403753831881374 0.14907050657279766193 -0.16368197817103496972 0.27377967689881899105 0.74425917464896140796 0.06976712233929384388 0.4769336483138182925 0.17192692691026173479 0.90079833865915714952;-0.22182189226001294835 0.088500811626263511944 -0.17397337183595221188 1.0443559026134556778 -0.63103974933440953876 0.21283222840513110752 -0.30153121847486424878 -0.16393886866734008745 -0.37027483862852700325 -0.10534993459879855859 0.13358388521723907338 -0.58602764558610109802 -0.37535132002917559468 0.18787852188121823005 -0.38013736679627702086 -0.62586731321819644158 -0.54103299392525328049 0.055978585484539794548 0.19171037085306363856 -0.12495940972735994356;0.50042973202687690559 -0.044112182305574454411 -0.81259665597483876631 0.082245145778289174832 0.31945321881407312548 0.97702743930452906618 0.016664121904215411368 -0.56432910085927778798 -0.83518399019758005064 -0.00033784285801635597149 0.61238930900677845948 -0.52693565165040934239 0.39329549293672649846 0.31799646366300077238 0.31327983673090192829 1.1123690605875740101 -0.5415425675235218117 1.5357382020585377269 -0.46051017765531360171 -0.5196988848903444369;-0.16348747874074462394 -0.37164517868979135562 0.14431159527961306965 1.3582335570324446383 -0.075709228459275468293 0.48991970623563213527 0.47512929339662440809 0.55468819431813543019 0.67825226688663409202 1.0137190349853382187 0.015667101037457706325 1.3958969088342101372 -0.89746147892954808434 -0.0024256339871737593594 -1.403552512215546777 -0.43915987323589145142 0.024546978206391643906 -0.029285646156142916552 0.12055915768540979849 0.21423571898225979293;-0.22482004679180400686 0.22606834892023552896 0.74888529844495199672 0.94258228708181601707 -0.14550877237769227479 -0.07897914878556817897 0.71530285914614988307 0.062372224456196140308 0.56731158233952605485 0.54123434372910250723 0.38891607163235852873 1.0396026469538175441 -0.73081413188800925518 -1.2919084595565890616 0.056260542860620252337 -0.0035566935079739650689 -0.41375186787281698075 0.16572141952306079782 0.24786339847870442199 0.18579792756800450615];

% Layer 3
b3 = 0.88316447885160598297;
LW3_2 = [0.69588465440969438092 -0.92935985729694026158 -0.035428656449439800691 -0.95751329166101728507 1.6296849464510048122 -0.97506669355494479667 1.5674092119083888885 0.88659080753995345159 0.65081917581070436452 -1.0231314271350295808 -1.3129951428972974625 0.53192826225736278278 1.364701372641483168 -1.3627361364999959203 -1.7624725477432598986 -1.4921189484165531258 0.75561234231197116351 -0.908208683876712497 0.63029925489600180377 -0.95919808018671426364];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
