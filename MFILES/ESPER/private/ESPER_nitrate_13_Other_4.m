function [Y,Xf,Af] = ESPER_nitrate_13_Other_4(X,~,~)
%ESPER_NITRATE_13_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:36.
% 
% [Y] = ESPER_nitrate_13_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-0.04979;-138.904784718693];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.568038194888224;0.0042772329208737];
x1_step1.ymin = -1;

% Layer 1
b1 = [-6.6816333143258477278;-8.0904890829489684023;-5.9761938170245265667;4.160481394987701087;-1.0870523180187134926;4.9674673668785844782;1.0846273375536665817;-1.7670752293936693444;-2.389927017190474956;1.5107477190218774332;1.3401580955027616593;-0.12418990939930163453;-0.011262363728534049989;1.5767820423016243314;0.66292312545182541239;0.093812574457077801959;0.054539379805041407479;0.38827315306354309721;0.12352386730434980477;1.1261327066413633347;-4.0592638174475679236;-1.0828180530264772674;-1.3066358604573791169;-1.5726247169517364455;3.3011092823751502223;2.8878721947009289295;5.0393075261395781084;2.5501820999296231918;3.113826315137648848;-3.8246924458926470081];
IW1_1 = [4.0219276964572623356 4.2053484671904115544 1.2995003836743930226 -0.72617372055024054234 0.564747148595496129 1.8346859675435627235 -2.8881907774603678973;0.45060139376253632859 -0.14429967763541406978 0.41373529526209829044 -8.609403462115020389 -0.92013548320559801486 -1.9264524758769228097 2.7936066776878631934;0.59323171394909890441 -0.037434493762511011905 -6.2039397064720054331 -0.83124761550555925638 -3.1519748064002759413 1.8165445540678721859 -0.59723836047089240431;-0.23980479980013494345 -0.62156206100431665718 -5.4676855195051601299 1.9743412606512846796 1.3223451608607641461 -1.6900760146441700105 1.0239338130396709037;0.23937258771940628232 0.42533027980549276137 1.3969514738131130205 -0.074825330640749254663 3.5113501373529310001 -0.28823975572108356813 0.51942430100392422698;-0.070801550758642223249 0.067673641743103418733 0.099146708066434635631 1.5823168697809990579 -0.063824554674534836329 2.5067758656630276803 0.81493423241736961948;0.044310321544002308214 -0.014042623660419967582 -2.0147602025556130556 0.33509157317806859133 2.397969943647329405 0.65513768808687888878 -0.79152875663940913675;1.2059220556020966431 0.10139192107642888696 -2.6425441209648727892 -2.4241570182390059784 5.7452977853003384112 0.40523151183682265541 0.42372699026680776813;-0.043240832571109652505 -0.1044572857536329169 -0.39457158028620509249 -1.9401291097997528379 -2.4793632827863536505 -1.0666869959888261032 -0.65861896356928006924;-1.9296336954456794199 -1.059574793033921658 2.7815806109569902738 -0.7844231801859374853 -4.7302403901822547283 0.22975753267790224865 -0.55598715556593769627;-1.0250764955921514154 -0.55730961397847267325 2.6002954590569902216 0.14457517827169294455 0.18718437769515830493 0.11821491144423017239 0.40153956167161436452;-0.027873695049570254567 -0.11601434410015258603 0.70091536418101885175 0.59040485663910258207 -0.24435605269675636508 -0.39609344704634646961 1.3170795008532796277;0.10358570311633087668 0.16948318936340564522 0.57787073454225978963 0.51926380814843176026 2.4569498877994364605 0.17689317581487642994 0.036317590959481053925;-0.13010426066616043173 -0.44169622324709101324 0.057499329199268277291 2.0699851940108198178 -0.72748614380743981123 2.0485363181004214717 -0.84163885229151658152;0.43017576274515867407 0.28485730244946311229 0.99718911538557641894 0.39499290142396303871 0.60279620511042020237 1.035929305729174521 0.71200017815403260357;-0.1311406328529475529 -0.098584038608588178687 -0.66501044557807376112 -0.51549174415258236515 0.87737801745063925818 -0.34910261950988286106 -0.77151573982555110565;-0.25310805230378463637 -0.15601773661451343034 0.22196853060530807866 1.0178892700482937705 -0.43482295059490361222 -0.63528325399579310684 2.138057540938781198;0.236526311823984009 0.21572410687628779113 0.58840498921269412946 0.1692430285347475416 -0.50722037383037410496 0.77887855525441940241 0.17426006384666647975;0.12175651986803370797 0.21313161407368833022 0.46751806366972220586 0.55217280335861185225 -0.49798670167908198891 0.23521733779409520482 0.80338503496092616984;0.062865496196483031111 -0.040083444810145155146 -0.35448784977403885454 0.48201935651457733512 1.3010090977426773673 0.53519193960284638933 0.8641439825471720626;-1.2549165272408422389 -1.8109878672397505817 -2.1427000900798178762 -0.39034919918072541467 2.8349827012963366712 -2.7961603928240483796 4.1676285690180581156;-0.19180244359269810195 0.006075410075418993805 1.9983750402268389834 -0.61164282530246838476 -3.2064419564878701152 -0.60113417254583456639 0.62967890384619429334;0.025818889735061439916 0.1511124616926614872 0.4786411284683210754 -0.35085986757172304973 -1.5167371574658168321 -0.31758768953341520724 -0.52542959771805120006;-3.0747881547401805236 1.83885790785116221 -2.447083713160336238 0.61734115048233118017 -2.7586734586908860933 1.062006037827063043 -0.78257380167710977048;-0.097755725663930745362 0.44182898018073429869 2.6268359373804441859 0.64545609892950506215 4.5173536388798263275 -0.98384862077965162808 -0.44772817808020398678;0.60087389161749915623 0.059928289626491701436 -0.58165162888206101144 2.6350830384551748864 0.36374528821572088555 1.1520968051284894429 -0.86266179559663680454;-0.27583345399724767955 0.31815563031343130351 1.193493336197402499 3.696680893246221622 -4.7438659363514421585 -2.0143756730527462295 -0.050088006253426152481;0.91522908052101248355 0.84871094460373619484 -1.769374563159920255 -0.014713022500749350918 3.9788542865950584648 0.46025391637039370085 -1.220425877250291169;0.28879735057887678806 0.60089772469995927917 0.25404361193619090509 1.7629655921693316856 -0.46936326467509503768 -0.13231025691204711947 -0.17049041701769337975;-0.19474481148199962455 0.29374713318085937663 0.34136063867148580542 -3.0770681816388649743 0.51039513200118491465 -0.29554423746013758212 -0.23732504914977481381];

% Layer 2
b2 = [2.6837409253161044198;-2.9756091932170098957;1.6184548616258005449;1.2070438296409990997;-1.357686703884380286;5.7587601027059314163;-2.9834826327720826988;2.5274200724176751898;0.72492876406211981255;-3.1465674424980845103];
LW2_1 = [0.35245701622820585497 -0.31224890799990012713 0.94159034314006651023 0.082212137351331149304 -0.72785615707666884155 -2.4347375704357410164 -3.8266611332906586007 0.061541874546813035707 1.1094387825555698246 -0.35563140573660689814 0.51037491362021025765 -1.8827409207993208717 0.03045467999325343969 0.28799461611372395575 -0.50307857999204275146 1.2546575496446839004 0.99224796940831572201 0.91094331901551328645 1.0837555617875500591 0.54095926594528520592 -0.1273433793901289357 -2.5798072515238357205 -0.11148149084909358963 -0.12653726638335321963 -0.46066699702353447465 -0.10017305390032521517 -0.74814073537287562043 0.007027626479569373287 2.0325795665697419246 -0.3662010589475921396;0.55140577730914974719 -0.44465680684609404372 4.8504450485195196308 0.65047836654281221413 1.4917313497422044488 0.31030668012645734599 -3.7710722190672498755 0.0024117660078545495594 1.5000442550503392258 2.483482409539048863 2.385381142791400233 -0.55083011411481663799 -2.8916716229514118908 -1.8705213845249886173 1.0191719804776271374 -9.7270944719560237246 -2.3335269574667854009 -6.1462892065412955134 -2.3746738497544330748 1.9990351134820123491 -1.6917961823801641597 -2.4176241243679399417 1.1603443926684404719 -0.3256357795640849595 4.638386155641233799 2.2898558060416474014 -1.5305048224897075393 0.17745052539254724255 -0.56867553030061257502 1.0277951939116436453;-0.91490056088730176143 0.22893941751025476128 -0.13342151260954066005 0.775238778731806355 0.59028266287320685368 -0.25334638631141565002 -3.6937511879994979758 -0.47727110475172473958 -2.2802655186793230335 0.029834779559397568705 -0.093279212338279363093 -4.6330862389733464823 -1.1825180030725768177 -0.65589579453456692271 1.6840987817767987256 -6.7682454181769697854 0.1830779898762790181 -3.8672586835183966336 -1.8637496727017801579 -4.369631903483250035 -0.32862192104184012598 -2.5677190853224245437 -2.3813140795343006317 0.025369454614570286638 -0.35202451389358729861 1.2427908692375533306 1.4501919198515933473 -0.67863639470447589819 -2.3625111271105545541 1.028886868492523865;-0.27293895556951458525 0.32286563959888753272 0.84968128216103855355 0.062077979006016005548 0.056696805320476412193 0.31233681726817985602 2.017010540934349283 -0.15078442708857414667 -1.2195686021652227815 0.32888506001537354262 -0.34441002060665321105 -0.50214233003590369453 -0.67664100198611953907 -0.2258314137439815239 2.0553103189486146007 -4.8116411684440096863 0.16262251043023068231 -2.7344972517003722778 -3.3049205546712907555 -1.8326905141423377454 -0.18152682436275030531 1.8237863657724120436 0.1958111339172024512 0.21306960044699332912 0.69379324587497326338 1.1714996550589518165 1.3562038410491448204 -0.27963262379565001492 -1.7233827067652753851 0.37230556124313646249;-0.20981346173612422379 0.25342907469583103586 -0.8185591043631196273 -0.55091260645610473645 -0.46620262065611972613 -1.350667579456554579 -2.8912819672175200658 0.17460843598822323175 -1.1923152631267486257 -0.30789071004291657108 0.40963225241203460314 -3.1390343773197475485 0.30016017803241512585 -0.18902835250740931961 -1.079072172324813117 1.4084927152748010215 0.8612326392942049047 0.77578916494746574806 2.7457520604459468849 -2.263463356401685278 -0.024958647150360831896 -1.8160740539770678925 -2.315782655842012705 -0.1637371713020679409 -0.67220901705102342749 -0.40552273253938181385 0.097821797661243686806 -0.26629079328920240988 0.47585557143822887483 -0.24896356435075051028;-0.040578042616428583456 -0.97358450630202697518 -0.14607646673732013753 -0.68726046942828467046 -1.9243482283399639954 -2.5567862449874976249 -1.1147157997453656098 -0.48062830897950298281 1.0060982056961262909 -0.1645835064866302544 -0.049739287325404661633 6.3181366703304098209 -0.2241931677515314747 -0.11315098984668454929 5.0732465641537087819 0.42113256313407265718 -4.5396501963042990013 -9.3476000276916249021 0.66546410041651071765 6.5574499435110320533 0.00087778240385596659201 -0.96565313626925308732 8.0808399792048852817 -0.2691234873952590978 -3.0307630028856507032 -0.26294357813720692363 0.46989714580618979767 1.0100265796018585984 6.9842034062592741606 0.35182381395581141525;0.082404855913297242465 -0.094646336289103030759 -0.085961513165359035304 0.47811969255600395012 0.8626058182940792296 2.4166982913560270951 -1.3975368685224982546 -0.074561551014108495838 -0.40131452594772909492 -0.16079196031285061808 0.16479814188904964856 -1.1994118476746009616 -1.3810217727170008839 0.0072429412772724802855 -0.73503771983784382815 -1.8094224901191784394 0.25982873227209651867 1.0541458091276947329 -0.41907265104735302863 -0.95140023050237931823 -0.090383718190320469499 -1.3082795876685182623 -1.7526912773319718308 -0.05288607526707132106 -0.097787602837414389079 -0.36593004029958980938 -0.33497851633728736864 0.31751479750555766657 -0.14876221535693021081 0.18689226399367550591;-0.59791111427198928574 0.2583288031311763433 -2.4906087445184303952 -0.69323737781794503299 -1.1521584109288209863 1.5034138359556858955 0.36418524840442656476 1.0179268548368201053 -0.66116738620244708269 -0.36359731139760287366 -0.68392994048624311532 -5.0141695883618764285 4.4356834655834580516 -1.0385700028936146744 -1.1168876127322999725 0.6380297836234897213 1.9271769042150626028 1.1405493824488941446 1.8595077397784463002 -0.89092165864372263595 -1.0204263306676892853 3.1101975931873662162 -0.63176540643843959177 0.030067102380231129632 -3.0490383559520592982 -0.78173252650851088319 0.14702601820651062248 -0.70045073452581962936 -5.2462962463529967394 -0.17689797532483841902;0.52644908404514811906 -0.24902979753030174415 0.34506352244636329107 0.3070091414553347553 -0.40086072114394621924 -1.6517836329180204391 -4.3204078925824029866 0.17475119156466131787 0.67976452224722194728 -0.49193032768691019596 0.761402638827517797 -2.1145791820178270193 -0.59925625904461476967 0.36832321740468243476 -0.97545216014517355241 -0.15207155321242182833 1.0933843286525273264 1.5123512117450970127 0.052749864360928912232 -0.0088445307069961939805 -0.18802252138463448894 -3.3244586467756964687 0.45478826471098254824 -0.14888636922053402611 -0.07785434747949229739 -0.90836655598657634059 -0.99132883730726106819 0.69896673481701465658 2.2782288339081002704 -1.1041765868724331412;-0.8494883064969112052 0.85931999870990383172 1.349438908773826773 0.37982222008429072924 2.0075499196685679948 3.2998264197223079464 1.6577356027290464091 0.39927004889661993348 -3.1101404616143009108 -0.69609130841696076342 1.8640076320689635825 -5.8422592765558114536 -1.5151514680617668152 0.2324010002347594861 -2.0001467063785147715 0.30135123377056710625 2.5785784342364981292 -0.30931714371856228185 6.373274460441856526 -8.237405313725519207 -0.41679608488479119588 1.8930070033915182837 -6.13024241964338934 0.14791643975360346808 2.8350152278702607234 0.59482375727422942546 -0.55687461686045813813 -0.4108493017368643474 -9.2864259621035341041 -0.74635114812585545696];

% Layer 3
b3 = 0.37554288804753727105;
LW3_2 = [0.84390572490476822853 -0.21473736949854624334 -0.30218640100554544636 0.37771412500146533953 0.59254765301081646633 20.087094680288096527 0.97218100951640751273 -0.26590538665889595915 -0.87496257180187442248 20.423511895205347599];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
