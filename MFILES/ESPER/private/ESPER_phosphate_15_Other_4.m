function [Y,Xf,Af] = ESPER_phosphate_15_Other_4(X,~,~)
%ESPER_PHOSPHATE_15_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:31.
% 
% [Y] = ESPER_phosphate_15_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-138.904784718693];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0042772329208737];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.4274099195261520379;-9.1059243469986430597;-8.909132661697807265;8.3806296188558828675;-6.4689467874836905636;3.7096804044326918692;-8.4567042307402928714;3.6196109311854054447;0.50809837766871501774;1.9184970938414440678;-0.62824070219968508599;0.14035133279393163797;0.12056231478250375999;0.017125247054817348269;-0.054880670912765203151;-0.78220994771086316266;0.13330357831894468212;-0.96988802920281291797;0.19335570039417160348;-0.33944477590815685941;0.83405466555307261611;-2.934919263475750828;-3.7515092461195611584;1.2228418551169064621;-1.5851725079392815498;-1.5744637440945845608;-4.0204622977801047767;-1.1678705805275204632;-5.263582822651748927;-4.5912907712543029604];
IW1_1 = [4.138480279479496815 -0.54248122888100225314 -0.13213545380674851515 -0.39969159350203670167 -3.6822028859893300989 -0.26303084664344478227;-0.014746701366965084268 -0.49496832495787784767 -2.2634584199796683457 -7.1866576980707987943 -1.6336874291241318957 0.95065164812797742222;1.2298778461987094346 0.04574373043005822842 3.577158677952049004 -6.0636296658630985945 -2.405079588924517342 0.26614512559065395259;-1.129226811655606566 -5.3286249348702590112 4.3511109505445011436 0.076520776485706654135 2.4552509408594258566 -1.4564830214490718241;0.86777820022238771891 -0.22629920333460598614 -2.6391210968304448237 -3.0780727444672599802 -2.5612467875768039072 0.11895590737033585882;-0.17983614346511600512 0.67061795865311180087 -1.7144940922260556437 2.4633969619706368448 0.029349582816404689439 -0.20565312974090854681;0.11315431269603533349 -0.31964971473747283426 -1.285834187788117644 -7.6365463751386970515 -4.5350425545472932143 0.31304541640965477534;-3.2734087902055017949 -0.86650227754409447911 1.6313228377735369268 1.2023931028407213173 0.39653612791453546338 0.38668628598898746596;-0.65387608321104206954 -0.080907900627046322461 -1.0461831458785950666 -0.15795362384112526799 0.21309486399795438127 0.11569915431862744237;0.1859569554355765264 0.51456085364747250477 3.0578674827120928548 -0.39048431304611624926 4.9918758532371425574 -1.0260217556578665743;0.68560476162289896163 0.29321844294129212338 -1.554699508893253368 0.32551425739849165764 -0.19408775315324319766 0.35465024295775249286;-0.50006418524944751258 0.41247636600241521787 -0.64281103653103854878 -0.98929333013814768627 3.2431801289437149904 2.4021525391160714058;-0.46424703660788030346 -0.10778210137965435478 -0.96291527004275112578 0.07968294738032473401 -0.23394717539035764231 0.67913359707433229584;-0.24516052100423765814 -0.34080502268465223681 -0.2261188657365965915 -0.51428066577967923578 1.4728385120656688478 -0.76505038201986108604;0.48110280899899615648 0.053343822573379148788 1.0817039021176371172 0.13026277187315896122 -0.30773460436513988547 -0.54778722809374558178;-0.76819337037587509531 -1.1890055788976907625 2.6010409507768859072 -2.539216678257248283 5.7664039679040115516 2.5074497003882330048;-0.21772217521891062963 0.0477482815725221027 -1.7397236164962568417 0.66515984277067818908 -1.3738607892640022357 -0.17854897832167873628;-1.1101336899268543501 -1.3006844880767198802 -0.74314064300323667833 -1.2763744835437684788 2.602068015757101449 0.38042631825018835556;0.14004235846817389421 0.26792528469795262591 1.3527196086318216128 0.089873781867162869097 -1.647898908286928199 0.85846122164605620508;1.1338157359943736857 -0.56301557267925972372 0.52454480119261881477 -2.8500996215454263982 1.359638496223407822 -1.0444345806722845627;0.43248963517285776703 0.67730344991925295339 0.079372091081113246847 0.30003670247878722055 -1.304174403886113387 -0.70627874806269874686;-0.69292493894891060702 -0.77938226644457064829 0.15512513941625113989 -2.023931100823211704 -1.4313853535846485787 -0.5132254665115559833;-1.8110321703764782342 -0.30801368611247159635 0.36607921654626990327 -2.6071605981891985415 0.8591704469749750217 -0.71449393758782808739;0.4996224377897691693 -0.91385705212271184372 0.77035790290764161181 0.42185466106522473417 0.780764321524276661 -0.64927603157904478781;-1.4689329688108589966 0.13260205453617615601 3.6893736372741834373 2.4705762726933184759 -1.5429014045755420348 0.71405297670112621855;-1.4423489875153103768 0.11433298674583160237 3.6236427832296458362 2.4199921938979258584 -1.9205117991141902323 0.66404328165679771256;-0.6840744183020841529 -1.1621376264448273208 -0.91218051469590077929 -1.3332071527428894786 1.3958970202106815162 -0.24953566091277079586;-0.63432918062735632603 -1.0448362693981327887 1.2808580178354447288 0.24192547182159068742 0.22529517625631417799 -0.050925506730311445591;-0.12669175377672220462 -0.21133478786951473416 1.591749982364734084 -4.8087930905654570068 -1.1520247617799630468 -0.68632549831242384286;-0.9360428643819304062 -0.38711253707987258732 0.94403435213065278742 -3.7482796400866802422 -0.23064188696272988621 -0.85708051751906044746];

% Layer 2
b2 = [1.5130389549984917252;-9.503809577289686672;-3.1580882533395802092;-2.3390278306539431519;10.387676533321739569;2.8069639321678141464;-2.4956348265081995663;-10.233334202048480321;13.021563869183379936;-2.6798999467965840537];
LW2_1 = [2.5774179415685281036 2.6784664019181949612 1.2770288166427679055 -0.13214779797797943095 -5.5510846704597565093 1.1481223848198927051 -1.0181031987806341554 0.16172796708968323331 -0.05904853311595578691 0.16428799084904316397 0.5999739589463680689 -0.15448797674337694241 0.39423206240209091034 2.7581202298483948887 1.8149155847385314289 -0.048404470433688437381 1.1593643922866074814 -0.81504617044583438368 0.33573745467825000244 -0.079495359361618292415 -1.5007273786707246988 0.14654690260955624548 -0.84168680722558408824 -0.64134347859455975716 -6.9997229712036324045 7.0042321716202282644 -0.048073817806621885196 -0.23371370254734993854 0.81987547754699907632 -0.085176643167381271837;0.4089961549178268152 -2.3508637912352172705 3.0867176220521796992 1.0615710688671966544 2.2877003171916197033 6.2619662832255373885 0.77085689080177155486 -0.68188794007836373012 4.2241405792338690972 -2.4336958813004692104 1.7126828127046644923 0.42308480967489398017 -6.108683307650263572 1.8885997690787377223 -0.085898297039637597217 0.40668550348031323738 -2.2535319912272671061 0.80784534959376741448 2.008723686376245432 3.2910893642547662807 -2.2750453487257309426 4.3145590826694091291 -1.9840888274822627846 -3.700207191802179274 2.9659091237481627346 -3.8735089954238199894 -6.1325444291567130506 0.14877013696093249751 -0.87205870771144777809 1.5459093412524131939;1.3395592036363368482 -1.5666392481428619288 -0.70577526012801650168 -0.026199947518228895033 -4.1561452257805981958 0.70223822416024606063 1.0005748307711972434 -0.10877360108574829489 -4.6631962183731543448 0.74609539739586161478 -1.2041194955905705211 0.44493398279480272928 5.4825019076866752243 -0.13324628476913805142 2.6100832946021972347 -0.075472954243576181876 -0.58496296329432684313 0.47361351129824569295 -2.1520081482756001634 0.89595836922092719767 0.36747431811210617969 -0.10571449867701739056 -2.0654415214539367796 -0.92961350020122823778 15.943511570148196199 -15.990721306855450123 -0.85315680109920044583 1.0101079256017855279 -0.34386731348811483411 3.9241910926195084919;-1.5146849798680102062 -1.5819350268271952231 -2.1484763433896314488 -0.3475724695379844853 2.3199178632402843725 -1.0189392017977119131 0.69802070091014767339 -0.17091115707012138891 1.9861656938684000284 -0.10617689855154155421 0.43084349724112364077 0.47924646527426462139 2.1778929273793203869 1.0625454882305604976 3.4537776692790695954 0.056113392535263525995 -0.14657269056515095929 -0.12495825814206967808 0.20286705092708035014 -0.53011542668277733537 0.66443224945161483141 -0.47716212155859161204 0.50000141664233888061 0.5881974510463211514 -12.75998938321942866 13.260508135340462132 0.72778206504746811856 -0.78621858619706930238 -0.75534200781237337274 -0.58364768275044631718;0.087212204173940002794 3.0141943748900215105 -0.42809875793034374292 -1.0308467332316166853 -4.5161852240366178179 -5.3611474450319471785 -1.0371817250136572408 -1.1533180852048976472 -8.958083801548475833 0.87548634188429352854 -2.727462239235470598 -0.84097029573010639858 -0.67632533983380727083 3.393348679275945301 -5.0275502784638632647 -0.049652063999521246773 6.3022264661977747124 -0.55181368978344702558 1.9945004289180336965 0.070685014191193981659 -2.4198300436217983211 -5.1896576874133772961 -3.0963489502561518663 -1.1812932804504752138 -5.624165382770851096 6.1840890862322517307 2.2903160171395295919 0.28226813167969805329 -2.9530612159614371137 7.7418682240213909651;-0.7924107879920870845 -1.151099716485026736 0.91164137016955471005 0.023457875060239146564 2.8549840004322790676 1.3608169544903880865 0.25601442677197699949 -0.0021866683327091021409 -5.0368566482793122319 0.17256585770948579261 -1.3845983785837101543 -0.13929435837246159635 1.6007098878060732616 -0.49232570533479880215 -3.2045633808387141706 -0.050457887251990615751 -0.78463898618984462274 0.26154094881616474222 -1.37456461092960458 0.70565351332394798956 1.2683733298728365746 0.058400838599184483335 -0.92781793329388972946 -0.23599781295831392947 14.982428112493755279 -15.252582467602282534 0.044978290332658127371 1.4143376659712429966 1.1407292588028763447 1.16394381801161928;-0.65067262907858269827 -1.2070037226894829718 -3.2441043614736218004 -0.26979858797834121997 -1.5435138856281642727 2.0948283091181565396 -0.052180789148754916362 0.026612469608976396795 -4.3388972036027375623 -0.040631206459616660276 -1.52369887674814386 -1.0259145051588312025 -6.5298830095121029871 0.082921428441917077734 -12.999126820777172853 0.47424662878872753113 1.4090938962767880493 -0.10836595870603275837 1.2272001010285720213 -0.39930945157679970103 3.0945674060873473721 -2.7893801776384457014 2.0100638825113770203 2.064567596860789056 -0.53963268128627539522 0.30431154665107612578 6.0050567079475554166 1.8810774025903598261 2.9451334888268099199 -2.1569284603764971031;-5.8377708289240048956 -1.7775927472374823957 -4.0240402722550729919 0.0095353829541872069109 1.1455907141619143808 5.4412592138694755306 -0.051353295255032509192 -0.090581956204794561449 -5.5192584908297961377 0.30651486647783199313 0.82028487079690826089 0.016108857138477684912 13.581339483991948569 4.8890049344743520265 8.075816057199734388 -0.1536703753043547338 -3.0656704630943032441 -0.49812014987925795628 -1.0484678434142911119 0.69385116789173006957 0.30798354167755581656 -0.38399041137066391993 0.13278237930802222477 -1.5888798345220205288 -7.4508469070557099556 7.6770473634239397853 3.1647710660533308058 0.75499239988893562803 3.8160590532434945921 -2.0415090799539514776;4.5851324467323006928 -0.53883892084226470143 -0.85287087989278753675 -1.7624113515086474724 -5.0701992946987290978 -3.0525582354617690761 1.8378041498997179648 1.5594661247193659648 3.6077373279656552718 2.2078690129617086768 3.8110706921786876578 -0.31788039328003198092 13.626221445405018784 1.1131430672177404784 16.390709244508077091 -0.12531597988548542899 -0.51585642157324462787 0.95560706692909014315 -0.6145241881179024368 -0.23148730951635776432 -0.88047092755022271504 -1.0620287592570025748 -1.3645401450317080627 2.0900592127093897687 13.924869486589487977 -14.831457721331803512 11.792423757887565472 -3.3485753878537667383 -2.0457456912877067801 2.6146396845487842597;-1.5160698041741778042 -0.85139479117581873258 0.47319162889649746262 -0.28469424026685258289 1.9820330858544905617 0.58611059813375909755 0.21320187002120816189 -0.096871137069017704269 -2.2929646456480585748 -0.62544732355112264699 -0.51771020209330664841 -0.43534441803552903494 -3.39928684798925973 1.0568946770802638557 -7.4001722766138824383 0.22475034715025529741 1.0622103451615925174 -0.2171836753603097192 2.1684938187989013514 -0.45549624513236630641 1.8105582162033686533 -0.31323083152827990716 0.61144546174419356355 1.4290738089552350587 -4.6406819125410345706 4.578048905722893025 -0.45235975480228274304 0.47828430612859340609 -0.48861364123990358443 -1.5364955639620834216];

% Layer 3
b3 = 1.1802239480131120342;
LW3_2 = [-0.52979158403479276185 -0.49148681651095549316 0.71756361854515426923 -0.7137313070981826657 -0.33441154709809273182 -1.0340826274257854944 -0.36462144537029478331 0.26569513565263630506 -0.50836711594371053469 0.99897474795584961793];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.568038194888224;
y1_step1.xoffset = -0.04979;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
