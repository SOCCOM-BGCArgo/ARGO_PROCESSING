function [Y,Xf,Af] = ESPER_phosphate_12_Other_4(X,~,~)
%ESPER_PHOSPHATE_12_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:30.
% 
% [Y] = ESPER_phosphate_12_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.8999299557377917758;1.8482910565641275102;0.39575775294938964066;0.095287824466162102111;4.3366676395868131166;-3.50320098199211305;-1.3302682400167171739;0.78694427823856993864;0.21792818005810490889;-0.47396678455653362683;0.21045335699141057284;0.83543218141871744553;-1.0107011211337959544;-0.31094099526205448702;0.22449802282417957722;-0.26566742687035782566;2.1892188656685926951;-0.9989174551575522587;0.36818705630268078188;-2.2193501118390490667;0.182048100363402382;1.6983769274050657394;-3.247474099644064971;1.333710029925892826;0.81435746447929369118;-1.0535582828983562909;0.25307153875904686569;-0.25467179380736426619;-3.8548707231388394945;-4.0244995391453430855];
IW1_1 = [-1.2186401060623399673 1.6451098212289474443 0.13034382560201068779 -0.18200700399268704421 -0.39406802048599726129 0.16698371846550719155;-0.020898056664545153205 -0.31895449991972946169 -2.1012131085602332448 1.4681389967920823736 1.9511278929348647715 -0.53854635458424715555;0.042488537784363386574 -0.09454278877210979537 -0.96537475151516571881 1.5850935866621373993 -0.93582386261063466026 0.33960226329750109464;0.59541300471689850848 0.25652968354801441997 1.7949107843101659299 -2.0066218119423058219 -8.305415584055182876 -2.2972856202470182119;-1.891840093983163662 2.9811584998712850059 0.61790838897191557866 0.68239129953380861515 4.0837572593977835567 -1.0536491969857813;0.23261625280137399052 0.11799269769253725726 0.14744314728752638821 -0.28626709886215706558 4.0159389143896220276 -3.7060720974884140411;-0.27859875248133286751 0.41852834321955695307 -0.24761221278153158765 -1.6852589051943094312 1.3148875265456498873 1.0847345457072739006;0.69250216298667766068 0.37887884384949427341 -0.71124425411275737918 1.7566161851021195872 2.1698715844298064326 -1.0048035544479940739;1.1700769040750786942 0.58995154838147356724 0.10658829968071859007 0.36724947035426430686 -2.2915649909078292801 0.11692126346520907709;1.2798090893115581235 1.1351049938254373917 -0.005019226582116134705 -0.0094567447317662912259 0.30962429242719119449 0.54515435457359695537;-0.66073472149468370773 -0.11129948527397773295 0.28723993792274338244 -0.42512590871144101401 1.0915978454825174815 1.690563941399646497;0.15996468979729341897 0.07904340633246360881 -0.1819107054510702981 1.5227194658669105376 7.0925658791935397574 0.76847245756820936613;-0.2111047799219898935 -1.0097435340022471451 -0.62498218906194957789 -0.26203450618804802197 0.022055273563011054683 -0.13468695943352657074;-0.092547790701412183112 0.36245784804561009818 -2.6973986639214793115 -0.75426409643623704149 -1.496820873122413742 2.0725718165384154901;0.23903995743562747589 -0.48128483946288941331 3.1340644731484736951 -2.4926630810220204992 -0.36040628662532753212 1.1000885782789766587;-1.2169484792169840137 0.30521313946954942153 0.18136450333000145307 -1.0800361228619237419 -3.2745595605019519603 1.241145280110818927;4.2121037465751447471 1.9779058184456002056 2.3144352209691905209 -1.6638283926401835622 -1.1373834172607539816 -0.52967336945463672215;0.11398379244491303741 0.85018078208030689602 2.5910885057940715726 -2.1479602287435350938 2.6302626358179450605 1.6465376890846272762;-0.037746813527236168506 -0.29637691596667992133 -2.1840105983060826844 1.8519332476700907097 -2.0229958236615681599 0.29079350456540070669;-1.907994343459387343 0.9073355868932319046 0.78374401464056508981 -0.85128707388690194602 -1.4488642910366678063 0.39669439872272665992;-0.11773311396569781373 0.939332443204973222 -0.80754090101088793485 0.80778945465093399125 -0.045133981673409283297 -0.44047317883880265921;0.44932110622056919969 0.17307968446154006759 0.66775375665340241937 2.4784815500242949327 -1.2064825245328092418 -1.6558474093369093261;0.13429478623897841971 -0.62749680487299475118 4.4631275252467297321 -1.8690755567884920207 -1.3536088932403773644 -0.9924323872260316648;-0.30869999944416426363 0.363413748393807301 -2.2582426855911519326 1.5481920966158573272 -0.21683701886739115139 -0.90043701896687278197;1.3109861965867914968 0.53267063808213721554 1.1950250141932705628 -0.22566288293913949747 -1.1532839316429290832 0.20811698778616741223;0.23024558833489766618 0.23118778818352070381 -0.42839426868915037039 -0.14784566663370715678 -1.0792095188166952457 -1.1605704839111452564;-0.44849296674473859703 0.82668875620152504347 -0.050808682146254710577 -1.6635811460134779516 -1.3544605383998273851 1.8019250547228966575;1.1625052202345185215 0.96335762603192365283 0.23334744288293651771 0.13741334579398023497 -0.52031689749190779271 0.38794743861224151305;-0.81971439780069599301 -0.54723221331062144035 -2.166036873662226192 -1.1453573664754292949 3.2671216570070478191 -1.4875478026936457265;-0.79247680252373220444 -0.44363977557641326444 -2.7123174966314773648 -0.94429650615608240471 3.9372565227573974589 -1.6871959040386657058];

% Layer 2
b2 = [-5.1601624111965618269;-3.3559248554916996099;-1.3707956116466732954;-0.38167232294187358743;9.8660794880460240819;13.268380268369027064;-1.734574727960389362;0.57181445065559044494;2.5528353876655147658;-8.3809505954732461674];
LW2_1 = [1.6996269466475413257 0.32393329503485746024 3.0563835119169544541 0.63945533047458524845 -0.35032734896061623608 -0.28969197179982025814 0.83516149205690903834 0.22566451242523527521 1.8283342038096392912 0.74888309643818418149 -1.7171655121888607098 -0.48840635168333196292 -0.04319718546070457077 0.47680581616280992563 0.67020793025480962513 -0.065538124823148719011 0.35632748908700445645 -0.9921618001198160286 -2.1432620918490772333 -1.47831394216817813 1.4305181784202571915 -0.70273716112595030481 -1.0671650674929746838 -0.23840761270993823806 -1.1943838010091298862 -1.6623562965391334156 -0.40818939534558629223 -2.9173757651864664631 2.9521589947610547 -2.8052592084995278121;-12.978194980924838475 16.361875714328235176 -3.944309677572388928 1.798580792985152943 0.4744600159966764763 -0.036140644761392920481 -5.4295927203758145296 2.7017342173815523942 6.4158748406398311559 4.6447534651315303122 5.2252445779969889372 2.9710472063639499218 0.32640161205421713841 5.0042844257522203222 5.4552373460619083545 2.3216866488207079655 0.6305847581636802035 -4.0388333504266400453 0.11516002449776011063 -1.1874328740871888943 5.6458651595475686236 -5.1780038449797389788 4.1332164242949760435 -7.3601593616455014413 -7.532593620493368114 7.773395473513469156 -2.9359724381855221154 -4.1944527446725050623 1.4716737017313892277 -1.2655624263459595014;-0.14899492557145943561 1.1028169083100547443 0.15705663495925667461 0.12490543879794115123 -0.3626715394981422369 -0.67728423292198247641 0.57669042670229575531 -0.061145496894914677655 -1.839361318643848886 -3.2117878206003633856 0.63939346326681201216 -0.076026668909853004075 -0.41126309180683223721 -0.25283603769879992029 -0.44196075463673306638 0.14288287235200794467 -0.25820268537632395933 0.21006209983695756094 -0.031740728462243766872 0.20736689209424138958 -1.3027197814579838386 0.81749306528076459699 -0.32031736447038161586 0.36337804050332550565 1.0500533104174993859 0.4752328530975124532 0.48938964234346776783 4.5253119626385691632 -0.96847568373538739372 1.0392217045918481499;-0.76582762146536109693 -1.9755265360579903344 -3.3160424245401398657 -0.20564755755742381016 0.69869545551859746357 1.2536801098695340428 -1.5065061466131379753 1.0170595301677589628 1.1997696843774532383 1.6190245305315540403 -0.93552030281280085244 -0.46255916042279865419 -0.070457006585889145334 0.3933653617932072466 0.62423666039306657805 -0.47067404426556452846 -0.23087079251048617246 -0.80224112998225405313 0.71199178787766836951 -0.87513664351401909691 2.260394313022546342 -1.4919648389950985745 -0.40908991902515107197 -1.8797334049766281083 -1.0079325121395066311 -0.70880485016417493771 -0.39478508130336792403 -3.7406850123631820715 1.424517956187825396 -1.590356435697044768;-14.263486892811647166 -2.4469899042176299631 4.8696745289749978625 0.75114633947069719966 3.145096645109777711 0.8634926533759148537 2.3877830319996178332 -3.049007383127383175 0.01931463621198204611 3.2780714267770991732 -2.2583333397387201913 -0.1681180587252373293 3.7475956745177589902 -0.50253031992761509894 0.0027247762371518050722 -0.91951671065486795253 0.29792997541405563666 1.8602146605590459405 -2.031012376668710484 0.39771387404351160599 -2.5811184151338242287 0.85355073247085455623 0.50102854410158514931 4.235561287863379043 0.038980158100322737091 -1.391206162143541869 2.8868989307522929799 -2.1585035403724082137 -0.79247032616306845032 0.041532514865444132568;2.9888835405867664186 1.1575424828765659147 0.34226733650490326344 0.26428871684530502728 -13.098180076284290152 -0.45334870723240000556 -2.3032660607783843609 -1.6420269487540142261 -2.2997587854920045203 1.183981681463419644 -0.84908284663440491968 -0.16590096056329739493 -0.84252711076328046236 -0.12532393100475802683 -1.9755765403479619291 0.1127844004989816129 0.019171684709525849133 0.31409875878561166473 1.9919437017553152103 0.49855172559998467419 -0.44080885041151346426 -1.4450257197718778812 0.26617916983703876488 0.47156098857483602638 2.0500199842849391452 -0.15802145310924245458 0.037200950316615882807 1.2150224125429809341 -2.6450184811732890822 3.7188969131078168928;2.5711816095156221351 -1.1677088417530396836 1.4899269938658603607 0.22321828003264146401 0.89075818840021747658 -0.4552937849485983457 -0.44459280915612592322 -0.2877067205933881433 3.7136049665759336413 4.3742431808255144432 0.37984355192165014659 -0.54084246908627464645 -0.28011451584740848508 0.74692015757386454045 0.28468242957974287943 -0.27559802134600863699 0.12542173558795269295 -0.337540023771978559 -0.21664195528952667757 -0.29200217268389488945 1.1848291750614345919 -0.65276140628896239804 0.13532061680494053557 -1.4602410990263157142 -1.0234122502109685993 -0.11792899196105458004 -1.0725886878753405629 -7.2270382281047158557 4.1924398978377475089 -3.4766397198030234428;1.4506772988814931047 -1.3202583358856576634 2.2394695467939369493 1.2719817672091591199 -0.85244507361909627186 0.68666605270671488004 1.9961450174183770212 0.25370955492808211496 -1.7414504104633703463 -4.5058313549347488447 -0.54304223091829817438 0.77167359668247059723 -0.80680637325665682802 0.096416181085073091039 -0.41429649121527251099 0.81500251619859820362 -0.36631082695311339981 -0.82695363060477311556 -0.6008576055646497327 -0.19052527669473967586 -1.690257199927205356 0.97267400684989924198 -0.41719776066327546316 0.21142492339834040305 1.1670154464952298135 0.40334998367697066923 0.34413767324232730216 4.831433343063505248 2.8328002147399637956 -1.9381958099445559807;-6.7491624868024375772 -1.6573989538673159494 5.0916485907176989301 2.7059251512315336541 1.0331899119291705347 0.43966454995724901789 -2.5038916704282856429 -3.7721860978951049503 1.173240454107678854 -2.6647028471927720616 -9.8605185359250491217 0.19970694462155375026 -7.9135761747098491981 -3.4260427851458223891 -3.4878351342698530324 -1.290917156153397416 -0.43020012274322005918 -1.3691434535478321788 4.6767919620807907322 -2.1327749837667515642 -1.4401302048886026608 -5.8283017720920211602 -0.44420554713235255173 3.2661652036156345602 0.20324716935814768348 -14.566125328439833098 1.7125283976105505346 1.6198383751010145826 -5.8397987677481459912 3.7437925533813540824;9.6529831463569273353 4.1395872350515343641 -1.6853568925150379521 -0.76903118354978339255 -2.0096576465115041366 -1.2780547295976232292 -0.92044310002742046883 1.3279363209807459878 2.7333655578705871037 3.5292757778115357858 -2.8520776709293595985 0.058088074593444019578 5.4709038304076722525 -0.6170231394364907862 2.8575083323328289708 1.2804590094795378352 1.0445163412092850486 0.92787604973718473822 -0.47031251824194070243 1.8146776007671010511 4.7640193495348421848 -1.8021879886102234458 1.0330147877967692516 -3.924153797412927247 -3.6627503770056963894 -1.590322368489685223 -0.23854849246033965615 -3.0290761189278132548 -11.162259718642625117 10.250640229949327775];

% Layer 3
b3 = -7.5590060471905706763;
LW3_2 = [0.44613227323407600444 -9.2645408435146698878 1.3328470177771880589 0.41327018417041705423 0.29448171304108794466 -0.87843093541945205249 0.47893785060303867285 -0.34983772436218202317 0.54599632436656941881 0.29595174047183087085];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.568038194888224;
y1_step1.xoffset = -0.04979;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
