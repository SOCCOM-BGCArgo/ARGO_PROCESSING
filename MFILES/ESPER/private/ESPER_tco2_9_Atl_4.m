function [Y,Xf,Af] = ESPER_tco2_9_Atl_4(X,~,~)
%ESPER_TCO2_9_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:56.
% 
% [Y] = ESPER_tco2_9_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-0.2178;-177.232103709389;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0461352500991908;0.00425400504498441;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.5282312237882016;2.5702907213454913;-8.4464793884570177;-0.34448969649704891;0.76366669759743622;0.011632903893131243;5.3454789132226583;-0.55835350508900017;5.8689443904509035;-5.5249822991648045;-3.2228547420296878;2.7730067459264456;-3.5205749717651744;0.68951744009791782;-1.9269597067926032;-3.1796666095034793;-1.3501477954839147;-0.30332283202540683;-2.7965597812683556;-3.453971193209409;6.0215359601080154;-5.0343924969495024;2.6342783077408658;0.072021630691596755;6.3519663963553787;2.5125173352521242;9.1614766873240647;1.4672990919794695;5.4887718589667376;1.4138745546587741];
IW1_1 = [0.19096887141525642 -0.12538186720217631 -0.48759256164173476 0.5461594330686218 3.1249435358246287 0.11330469834229419 -0.053372499848989702 -1.6777787259944279;0.92264534727949243 2.0506626720962333 -0.33601316288355892 0.31332105097622903 -4.7251328900240415 -3.2014070051731967 0.8462829350012876 1.6770521014150952;4.9656791888473784 -7.4517331679914491 2.2917331178823499 2.329186114402348 2.6782193730703434 4.8307864012662263 -5.6888711672560719 1.3293717717082592;-0.37132276341081238 -0.8610607681762048 1.1581628298647697 0.12952732227817385 0.52972658583262688 1.0322418508211022 0.2001970050699437 -0.94849487326545268;-0.033343536686442431 0.098094736675603908 0.88053488392638268 0.10253239065046037 0.40220470907237438 -0.40721432381364175 -0.88579546464177761 0.34903258024454936;-0.3484525678530232 0.75304175833491283 -0.51781506035432789 -0.045154559958819444 0.37927357761938557 -0.3091408714606016 0.21308523675818419 0.21924233432216053;-1.8686708701165851 -4.1798861153299507 -0.5269794041561392 -0.97467379832946055 -5.8201690313500922 8.1903414537057451 3.1528235269532217 -10.160950771549055;0.41329611396450044 0.22282333019188294 0.19780117894479959 -0.65777732138634382 0.35495620873443262 -0.72063270640697719 0.60447476073532436 0.66969234923001586;1.8004938720187862 2.0992983759289041 -1.4125184519707015 0.043638430705382772 -8.8062731160586409 -1.4790049112868402 -2.7215812048821064 0.65038781837716275;-0.96442269860387952 2.278534800320994 -0.1079295509631199 -0.75685653756412163 8.599550918273108 -1.1288873482076673 -0.48369092478037268 -1.1560416733834913;0.74403747965896616 -1.6390690493613804 -0.56246327280692288 -0.4019159702368566 1.5431626889815524 -0.29776235294560005 -0.89327896581289501 -0.33369201303563539;-0.53237116262216111 -0.75780823525877228 0.63590261506167967 -0.75109138193772795 -4.7028563882423926 0.36842874858653141 -1.4462681249669522 0.47527601288495475;0.36054335159506351 0.83793280379102286 0.92284661191558692 0.32434699029576686 4.8673150911798135 0.75751519411654578 1.2001251950992593 0.49318045754610373;-0.55869993937987061 -0.11392384523117818 -1.7167316405933795 0.24237567914031333 -0.68613415576722148 0.025965666909756113 0.8696322032610011 -0.49533849564718857;0.41116248443080466 0.28868837920171186 -0.014181923991918604 -0.78633401558747429 1.669288328060859 -0.79300050600818361 0.064593828064728562 0.050208978424496543;-1.221202028544361 1.9546217495855913 -0.62868550368993126 1.0458852385546893 4.8805657125397763 -1.7963297993469973 0.76317617841347085 -0.89879280827815311;-0.73274285347778867 0.75048932029226723 0.57167568713202044 -0.21380583870251757 -0.49306631991864558 2.3732600510171045 -0.97702438391908775 -1.845311255452061;-0.503530555484339 0.68954971280950261 -0.33263783827747406 0.4287195365238276 0.1846529383537098 0.38718085145691455 -0.41212243466420967 -1.4660183770218225;0.50002704328374392 0.52285793328598307 -0.61020823095116017 0.61201542828035493 2.5334260106475384 -0.68129153337864323 0.89129593801247875 0.033926833624772709;0.20850072334722711 0.83521358753251285 -0.15421801537709434 0.25213968565470157 4.3728502067323136 -2.3603322899054571 1.8868225054101289 1.8124955068280881;2.0972978361465895 -4.2688187675608207 -0.33930637053252771 1.7460979088383857 -11.766451319470548 0.99854001050038499 -1.0748508386387103 -1.4249927543112855;-0.66327519983616035 1.0535218676012823 0.24336377865207334 -0.34318732731342766 2.540896414433349 2.7376967773535581 -2.6389174471078474 -3.862701895354959;1.2102481364012982 0.42927150474824821 0.8465729844970189 0.32228867315727588 -1.9507648469644361 1.3010299072863669 0.073090735571609625 -0.79839391831149586;0.72262230216689305 -1.2915983205448454 0.82295737358277354 0.23769139124699293 -0.034982700409671191 -0.67947787021937334 -0.55577138833517004 0.50263121386554743;1.3642456752902248 -2.5427783348030228 -1.8363322582246093 2.6658497657974167 -1.2044782528327085 -3.5427129384525169 1.2011185127767732 0.13557408470746024;-2.9655917612129006 2.4754626308938499 -2.1269076052910005 1.0562873289151864 -1.674645647221868 1.52706240925787 -2.9748035949447167 2.7548772967187309;3.4890000237985652 2.5899391783734225 0.26342482176455667 0.42389811892516865 5.8850027651904533 1.6360172664813941 0.56028852981718069 12.57454209891449;0.62852313138216209 -1.5029895944561833 -0.015005367292896702 0.0059583209685970442 -1.552173417038073 2.3136505786528758 -1.5084586968508469 -1.1757113955615153;-0.5449221692926246 1.0367535072096206 0.85596211249248333 0.34834949939581367 -4.4473857545388702 0.89532771627097085 -0.31226468868562884 0.37064395922444515;2.0059580790607465 -1.055725939916603 0.99097337265584917 -0.68430578140482312 -3.0526048132560422 0.18313100808281954 1.2920587286333367 -0.67547799278303877];

% Layer 2
b2 = [12.985733894929172;-141.8302809057177;16.526365698671952;-1.1181902951851119;-65.696763168114458;111.91073807918983;381.5731974837405;-39.401906529642034;-304.27271085175113;89.881864205949739];
LW2_1 = [-10.37885633817849 4.9922978020714783 -2.2464167407375539 0.90922492913486896 -2.1516548566505524 4.6819135490998001 -51.583170026171416 -17.257233377160809 -7.3355074613552942 -4.2670712374879987 10.275321602556982 -14.613404399411536 -0.80978681858224166 -8.0112739916434066 9.8523786151796777 1.2601697301220716 14.66884947363261 9.5696141430307726 -6.6651453342608731 6.7649447452388261 0.59889184815390584 0.95435659269794026 4.7302656888536196 16.298053525302361 7.4228050106628505 -11.830357400518503 -2.6068858752105566 5.4168763829295665 -6.2019574520119418 11.536362123609258;-63.875570217392713 -4.8983392299209854 27.039879742450182 20.943152878256253 -61.62269598120195 -7.0714354879229049 141.99262982480499 73.737024272583227 26.765148100184785 2.5867627471406691 8.5097650828881068 -11.42752973268796 -36.278159141114948 -39.365436518150759 -41.675386913873105 56.676265224058881 -34.887032571905195 37.757201808780195 43.047622636181849 19.637812939934122 23.045312112475322 10.020257434109407 -81.538632091014549 66.141748682490842 -23.682192699045515 -109.82560943565268 -0.46000944536436655 -4.2621797592072932 12.379709980978665 -30.074002262212236;9.3368055176091413 -2.2578816632836656 -0.18094963516241505 0.42258529959170804 -1.7007842944915552 3.1087222455433565 0.52306569267183978 13.209539181782111 -0.051462409879726431 4.7004268729081016 4.6602234609688313 -1.2403067537205104 0.16220437368283794 -3.4656506058503376 -9.2606650845328673 -6.2678637333976237 -1.4573834589972032 -0.93588607283737868 6.5681361677674133 -0.048243509204429047 0.54921366874637256 1.7578210277600892 -4.1744561293164217 -0.42205303143241779 -8.4369046311778639 -0.56926319755822419 -0.12583070572916974 -2.6506332091317706 12.514081650990397 -2.0265560599431041;-1.1680595778247251 0.11566260172120604 0.0023289822336701013 -0.6100233284828267 0.67575784845454401 -3.1061942061395049 -0.062012821038473526 1.4687973214468446 -0.056896067898776763 0.07636599120233345 0.5261871901702071 -0.4853189983936313 -0.29516480650671373 0.15172558012827736 -1.0579805770483615 -0.37444960222225848 -0.41223590018598849 1.6378131391923094 1.184354934396775 -0.5183499820697236 -0.077278460161219267 0.32897902748810459 -0.64249358526210942 -0.79285219117812766 -0.14505258632047777 0.14401070363550564 -0.030139105343189091 -0.40599206636803375 -0.39029467834974663 -0.23259274061443963;47.606803904668894 82.716951209737758 13.173603584358789 -70.091206804591565 57.198140592001991 -271.46077496274967 40.373467876086224 -332.60581370050846 204.02060088586711 13.683538468270678 -136.06366034204811 167.68649177673956 -40.446023356603192 -10.006283043345896 70.901963137861628 -42.334010743793051 75.265000132582912 30.158960843077519 -211.02963379418622 -6.5790727938424611 -29.191311013317399 94.796914880779454 -361.53901490387045 -99.077899356667984 -106.95340492568442 44.181117658975452 30.355964699323756 5.5163430744116129 53.863269593539719 380.17877578780781;1.0158221744593261 5.7566060528550711 -60.91879754436588 -51.368246554861159 -11.827601383063692 -69.877486506787349 21.826513291498863 7.7336496985549807 44.975162376731539 -29.594530189309477 18.907437286031975 29.004485760881231 -19.389470487016972 -53.807252905941866 -90.925495077157137 27.677199302351845 15.708691531938198 4.8030813648943305 -25.642239691701569 -57.570948140449772 2.1248905302141461 3.8732162755588786 62.096659310515165 -25.83294114280454 -188.35003543816191 41.409958971620334 7.4405797744146369 -35.690579573713073 -51.254245342247884 11.440637473191359;-127.35659481100276 159.75741180491275 -30.698875277137446 9.0029544369675243 149.4512243730818 75.655690254183952 -325.99999371642241 -217.24267906527024 -120.66635638298131 11.474907036464019 -39.493084426225643 -171.37023185849486 -206.78129527959499 -18.975204350393224 -34.393933570939517 59.796429785989076 14.690403435709747 41.004618010745233 13.362497174976776 429.6487064072208 53.139815289196022 261.80486290799735 -115.67439789529307 -47.470254336079385 -13.101190357721993 -137.03968035931234 88.564301014258163 189.84795023789047 -11.568082340935389 197.686269124407;7.3845282890064388 -51.457761158651209 1.3040385665646519 3.8607751667554386 -78.031347205121889 11.420662605099235 10.67558620375811 -49.417976420901248 -3.6038424125598918 38.981401674052641 54.286041041026635 4.0109822197036067 38.621147774556761 16.131872582276227 53.006600061296169 -36.270455926050985 42.382653561953049 47.684441911328584 74.064119282709171 -53.731826516517309 -8.5367475615326818 -28.835379974459908 -82.347829058015293 76.435344354129512 9.2542101739091791 -56.880566824391671 8.1400724507901252 -16.56616531363796 166.19597812712374 -32.844519521421809;-50.323557282003115 90.294189569212563 1.8548884751484163 -7.7286285746687398 229.20971065932332 -120.28324265911408 157.4015211184412 -310.29681938234432 -60.939391255975949 15.08495164480065 183.94690288445798 -61.482594174818537 144.21679443936765 145.9028819597865 304.73654124603445 -97.711103772504245 -203.99293943741407 12.702985766995067 -16.183114959626518 8.2094188750390771 -25.067789498331237 -96.174573092363943 -13.922767202970771 -190.90174096572662 -193.1408944829389 25.049085416608587 -39.048619217103685 -196.22811132446759 322.20323091231472 207.44919222329509;17.567778109145063 -0.52694078966854541 0.71640964811804042 -8.4049186707143857 8.6573166499218601 -28.879827489044725 16.88211590536476 -17.009233032829549 7.9502956745346323 -11.449717632458428 33.780720122012816 -3.0169781093799859 0.099224855651171617 -5.9024228538840626 6.4226997421028251 -7.0026869160992149 -21.644519387290181 -0.24580657234652059 4.0484039628409212 -8.6400524845559961 -4.6348348556681396 4.2731861114838932 -7.4445677882885217 -22.588634657614151 -75.843432173753982 17.797659630891648 4.1499775406580479 -12.617320102774697 32.652013413794073 -1.1322903335659986];

% Layer 3
b3 = -4.3991027453059237;
LW3_2 = [0.0071820771056210738 -0.0025714572881164271 0.014954026018242236 -5.2769239356077877 -0.0008103101503934071 0.00035457688983203727 -0.0015911819984199464 -0.00078873768647623704 -0.0018089441139073476 -0.01082569152710525];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
