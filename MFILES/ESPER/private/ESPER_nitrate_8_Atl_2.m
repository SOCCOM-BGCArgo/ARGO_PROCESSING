function [Y,Xf,Af] = ESPER_nitrate_8_Atl_2(X,~,~)
%ESPER_NITRATE_8_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:34.
% 
% [Y] = ESPER_nitrate_8_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417];
x1_step1.ymin = -1;

% Layer 1
b1 = [7.1970398775814476977;-5.1422442545609463593;2.2730835563020255208;-3.3130235795090654527;-0.38711990719098010594;3.596788496213188413;-7.2540537773592816961;-4.6318249138452110003;6.1953674485312530962;2.6658939677932127488;14.788918313654017211;-2.2223352642122295997;-3.9740645912247063443;0.2421336651111378746;6.5974753504107033208;7.1145311088006772948;-5.0880766899547476001;10.432557397562659318;-1.8940778201966967931;12.782197426039234145];
IW1_1 = [-0.75982940973113732852 0.015414786210487991386 -0.30815019206130578322 -0.56624034906525333444 -4.4247888013414762298 4.3588801489214965557;0.34054227386643254327 0.022685962163226228161 -0.20071659905884109421 0.56173616889693145371 7.3686897312707300145 -0.012176442587924911007;-1.6210895915520155963 0.0089845842785180613649 0.61129119984724344938 0.68039253613336703186 0.22751706776917912656 1.3073903283783001594;0.049096296609751004236 -0.033396795726767423973 0.76881482763058650587 2.7597848761077710122 8.534799113209141197 -1.7171832117728815792;1.0652102168065851195 1.3170793384834660333 -0.59017076442227967004 0.12943130872517516483 0.91984924293218661706 -0.71980309509546591684;2.5242794462130651034 1.0252374633607566068 1.2767396803474087008 -2.6738965725048711164 -10.747995178727164145 0.84573135242534380751;0.1639596905255679693 0.40942184747022886127 1.8574966695114494275 -0.82230790138180187565 8.7536327438512504528 -1.7017200800136347283;-0.051945637796549579135 1.6101683457260143051 4.8295967798224568313 -2.9009419698736573778 2.0796994019068621995 -0.74513767060601787673;-2.4679990936806959212 -3.2221233373030604419 0.82232395289807613814 -2.0248936433597162221 -7.0140165417228557132 1.8610879954468437791;-0.28878274467851605678 0.088024340780448295796 -0.0088078938365845488301 0.21013557199444413137 -2.8568800098146973632 -0.2222260866400901369;0.023121452726773801534 0.025613634771136005452 -1.9900864375225957303 10.978802957858341927 -2.5843220382618481423 0.93306046761387584354;0.54504835235328330523 0.12915650639177289616 1.2399724726660490415 -0.68091117627113340038 1.138308858494310627 0.45541168477842064455;-0.6719888109227644124 -0.044433439885927690505 -0.23934131941564551482 0.7925408514098408741 5.5263823247784706894 -1.8367025964560852458;0.025153486421981934712 0.22482314766811811735 0.18532680747851101866 -0.3190413958323587984 -0.23923086798261450348 0.034721380183132075081;-0.075212152391740144664 0.05277345141682109747 0.92729153204177139358 2.898734569609859868 -4.8679954237152740504 -0.39944527212657582327;-1.9231094071302619053 1.6364387122385024576 7.3864169277640634448 2.5609887030229070426 4.3124846135707510797 0.46024235183126199766;1.9927007453282392646 0.65922402284832071206 -0.39010132616753845358 -0.37681827127351230633 8.2070388024849254549 -3.2469444354448269152;-10.48879498050213499 3.7362602031756111387 -1.3961992988882829803 -0.32851196508172730848 1.2760281448035011298 -2.8004005198398260745;0.068558500148393805573 -0.60159470482899379817 -1.9298792180053423451 1.0916126274749384795 2.2221031342973485145 -0.44432690690682763446;0.21397657167864789218 -0.025342720788256067194 0.69319802418127085541 -0.89732562632660817226 -17.647660108163108816 0.33503673152071883345];

% Layer 2
b2 = [-18.511759088681497332;0.85882755952324207893;0.77008257848805439227;31.262626467638440886;-0.52121691652464330335;2.9673093128224956594;13.370714028389871331;-7.5503552194506351469;-1.6987879538170707061;6.1198087377475340887;-2.4516963689259436698;-6.8213361243327153005;-15.84259613971795666;7.5362862347236365679;-7.8500169898988279016;5.9834584812433391221;-6.1985343799415888455;-1.3498153284062188728;1.4089008197922792132;14.675989151316846559];
LW2_1 = [0.9913202168626371602 -5.02923245784424644 -0.16378367457795392492 2.3056850621895903508 -1.6704288973938006269 -0.84786709978981134039 -4.0744595248810462351 1.3761748299480225377 0.96325516432460389638 -20.616473386903219733 -7.974997132864877436 -15.149586196964278884 -5.7820629180092337762 11.018972897515286746 0.33563273758833389593 -1.3848860272111311875 1.8519824161121063444 0.29242966457902991317 -15.758841227791387851 -0.52507346358357587235;-0.69303879966151682446 1.8632372784371511454 -0.45796693250089781646 7.1939767902919786735 -1.117689649133823071 -0.96020719939312304536 -5.4749277128131215164 -0.96690573424799830526 0.57234149456947569501 3.5168900393545592387 -2.0433737815911605651 0.69417443141773260695 0.57307885401076863463 12.29562965112966566 -1.3672862683498030467 -2.7561054881844579967 -4.4427200019823827049 -0.60862461576627802096 -2.31141513745482996 0.66603547777142213526;-1.1296228690204319633 -4.6901698750719731379 1.8913233717160919944 -1.1664441402002423409 1.2099750051134456896 -0.83575226743611785718 -2.8110875341630645607 1.4220727322972905871 0.090030013696953778424 -5.004662078246046697 -0.2524518249334667952 -0.92350048484523239445 -1.8900229634339948959 1.2147601461519128563 1.8008781374184621438 -1.3578760206297415536 1.7933325169569007684 -1.2080990589825186809 -1.9301003257838706961 -2.7503192929675792655;-1.2833497225475420933 -3.5070350024885450502 3.679285614727897169 -0.92808795547936950854 2.2628701507556878703 0.41094260073666161182 -0.88264839795652705323 -1.0936415205082044011 -1.0095560180615008594 -15.710215201355936188 1.5502858236055627739 1.1620562226537134443 1.0131402452497220157 -13.172770082926897217 6.2393550373994450808 -29.814525858853151874 1.1867373458732344282 0.74333247429842219667 -1.2460591380070344947 -0.047091648871087792017;0.44650492538497499329 14.815584496059180708 1.1109350418705745689 1.4255707570834772469 12.222753276224601393 -5.6143187598902564162 5.5115698387835614369 -3.0375586768496138923 1.7865876800492921372 10.86537452475376142 -5.5314252999649156095 15.903846963795936986 10.327321014438425095 19.58095803310323646 -3.4581367870064916303 -0.37910806793075702004 -0.363023176984626883 -11.946816920336441825 9.1203167852513207237 6.8693922252677026563;1.4279311311724307565 6.8148821723652712734 2.6199160361129174568 -15.612494251894151631 6.6566027093688031613 -0.58217250611922011228 12.659060892035057577 -0.42325055384680720927 0.37662707266984052357 7.7385665589083512117 -1.4244094618495830584 -7.3302021223996938204 -7.8727045316765495997 -25.884976547207898534 -1.1008889689457823646 5.5029076914896215555 -2.2393808479824905966 1.4351997579387851811 0.34598559505688253335 8.3882212823479669339;-1.9311556691721849521 5.6370449050150215342 4.6059736017253110063 -5.2205967638520993646 4.2136815449158460112 0.85743280961588874689 12.878328465997661567 -5.4513909601106700364 0.33941382813062492829 10.391401985010174869 -1.2124662049814500797 3.3968582064713466195 -9.0535316837877903851 -17.991657985645009177 -4.7149543484626024181 -0.76441983435408933367 -7.0697549876117289358 2.1677195792004342323 5.5250998484340039241 7.0169058246095179499;9.043322166733080536 -4.5971607467896875576 -6.6416602990257578298 -2.3438112592385920152 -1.4401857370514627998 -0.95144298481925593247 2.7031708440291168927 -1.4903163812904769436 -0.77015410827891117584 -10.675305788282448916 -4.2674291057960900275 -3.2352694550337295354 -4.0517600666176374347 -11.416035263684788603 2.3307035108417326619 1.005647670546614636 -0.62944724125752982147 -0.23047895925412606455 -6.1445117967323410468 -3.1753979205343276782;-1.9828346269277872249 -2.7220863556828245322 2.7623922635360318445 2.3596981212845160591 1.037372804187887132 -0.44285241635737099264 -0.15137097207634500617 -0.022860359821359681892 -0.98138741002842255767 5.2409742496699509573 5.764830592401919418 6.6855507751075995415 2.5840661655633994087 6.8993452243776616228 -3.0183184866975496519 -1.052758022754561873 0.97090444543737774996 -0.19870477995177962538 -2.7441540792074836652 -1.8514808675976051067;-10.347917139561724653 3.8148335289938026804 4.0781429282713128615 17.817558438791593289 -5.4142542184729567367 4.5569161427710405121 -0.49444969080066941691 -0.50957628395847875957 0.80918877343145645398 -3.8688721524942697449 -0.89825824742155380154 -5.770885081491938351 -6.5062512633410909402 8.04123671218685665 -7.6270740218823078749 -5.6342964770503352057 -12.883433961232647391 1.9114479810477222887 0.88763739153400988968 10.287817927067720802;-0.73955759169539392328 -1.0079059701540087346 -3.1383358112380004279 3.5226925302021152575 -2.3115391864852639081 -0.24054350477572422617 -4.1353046693852659743 1.3491540624068834031 0.26025214425438919497 3.2988121200425339907 1.0792771951185409218 1.3043003258186585125 -0.94328968964629400507 -6.4859692393700631996 -3.791269266421849693 0.64695355451364144894 1.6088900372056063048 -0.087985088654383161733 -2.4325623598339434217 1.1384209770409086104;0.65178735594438919065 -5.7506463235705416182 0.4050861684090659165 5.4085779189659479727 2.0487632011793261988 -0.43583213112220825503 1.3841268839964502302 -1.3333160492090059268 -1.1622575231484653102 13.30209203022495501 -1.4298333051110700964 2.0287401997134679732 -4.1365429028860365435 -10.042251682992763051 -5.0341459286251026839 0.52363916201008819939 4.4405498785440356002 -2.3211437892996467092 -0.23158384976663243249 0.21255261719965529155;0.1860366293174849639 -3.0326223904097777684 -1.1407201616002662359 3.4501885031565797668 -0.24344183795851681573 -0.97154747952173858838 2.975117629182395973 -1.290717785423688424 -0.94794863353939928796 15.658631084273245904 -0.52445607371347069403 2.9377514122480996583 -3.9954988667219564213 -5.0638917652843389305 7.4291602878148150779 1.534766548146666798 5.8032601824219272046 -7.3749282275692902289 1.7946760504459933205 1.1657363726264933224;-1.929624358864270306 -9.524792999400446547 -0.74699504530339388975 8.7533169532303300997 -5.0071743045973668984 -3.8789717218588060099 -13.430670397394559146 -5.218304462051886361 2.1038471835219572093 -1.374398545565299834 0.37174493617621912067 21.213461399167552912 1.7523810689982461941 17.408297241538939204 -0.26119325223693018456 1.1836420075569222821 4.7755166162072946179 -8.8659651265002157317 2.5062722304770463921 -3.2478394385316673443;0.62432470712898135989 0.47922529413304654211 0.90555444637012416642 7.475125276146392217 2.4046037393727197617 0.40031902468319963129 -4.0509454913979245916 -1.0756416789074885187 -0.26609046644244516155 8.7655404345840413072 -0.25265693696553948033 1.6954385951296204738 -0.20409732589785836709 -7.0565947754892430765 -8.8896402545160082553 0.63993251466603806588 -0.32208148696182642423 0.77241678834805171938 -4.070284364124771237 3.0780267566413948011;-0.7816431405356895068 -4.0500282960767970408 0.43601336081814101586 0.49334032011077560975 -0.50706000764987635421 -1.6755915641166310159 -4.0202138539186060839 -1.023724885885601843 0.68396195205672372097 -0.64658877226678856953 2.3132778046590454224 6.6479040337543908734 2.35450309335980279 -1.7300135253105886068 -1.5824887305579926622 -0.20239566832264535567 -2.1586912418948465131 -1.1699121286558733512 -1.6526297334183817078 -0.97985332689076731771;0.82680999474585370468 -5.3442882061776311176 -2.3073435149224668095 -0.022838298927193606547 -0.82314405327654494027 0.65309258092606881085 -0.3617996238750203486 -0.16548265188548411109 0.058294723678289799007 -7.3357825823140307975 -1.1435100204572641314 -2.0574573318722593207 2.010621436500714676 1.9247401344615473473 1.4272041856271246996 0.35820886059659579059 4.5176137970052057113 3.2418931645773718664 -0.14152420316650615728 -2.9592772781515543912;-3.2825214474655952657 0.38513444200684310292 0.7332472437262123055 1.1913783849484267385 0.66826441200969610712 -1.0294178720670459359 0.1918433677025789541 1.0234322348479547582 0.91378678147871927884 1.149942916724722819 2.4426840688329969353 -1.2948661884429257807 0.57621958430580311195 7.0656015979110033953 1.1469213390318517831 -1.6147057179371409052 -0.44849969772441194982 -1.0605421255806481984 -1.0307125464743076559 0.11402553633196745031;-1.1605460755281833407 1.7780911156641352466 1.939664399248878901 -0.77236162272432196119 -3.5207618418528907611 -2.6615931185421608518 11.616627809465940757 0.25470224753904441295 -0.22090948574480365196 15.982534613689171721 2.4859997973922771664 3.6928177948515887863 -9.1196315147913740162 -1.2801122653545591312 1.6259651842043298942 0.25250851770191112822 -5.6106953331061779622 -4.0634045505465765658 12.749893497162561928 1.0861505065495533628;7.9610782765234056058 8.7160007626731506036 -9.8171410836076873352 -0.18596582989355592286 -2.0294941422311554291 -1.0435115725473382842 -8.9589645775149691076 3.2327522057378650366 3.4982860946704708027 17.959358368704350539 8.0692601367471379348 12.240339600032681844 11.978839420815496908 7.9495911207977956181 -7.8310721905288183109 -2.0246382027614826526 -1.3824804887897452765 3.528548407442460455 14.925981622134576909 1.0970201368586023349];

% Layer 3
b3 = -0.18296629777561310148;
LW3_2 = [-0.14679469673297435017 0.12270895409627437245 -0.27078159509015242712 0.12479156597290536057 0.04086146055079564049 0.044156553050765691426 -0.060805553313721234787 0.16855936530130158357 -0.10127422416251669057 -0.056520279337248159612 0.20633254458959512934 0.12610040177279005502 -0.098510677803392482366 0.025003281846581106029 0.35875019638518490517 -0.07977669601492684559 -0.20771933341913928484 0.17952311906716139633 0.051017027879099771659 0.05875157912044942643];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
