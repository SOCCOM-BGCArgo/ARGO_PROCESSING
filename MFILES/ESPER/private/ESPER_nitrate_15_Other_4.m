function [Y,Xf,Af] = ESPER_nitrate_15_Other_4(X,~,~)
%ESPER_NITRATE_15_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_15_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-138.904784718693];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0042772329208737];
x1_step1.ymin = -1;

% Layer 1
b1 = [13.090492281061921531;-1.1506118982737134626;3.2510423700473780606;-2.54645963099601369;2.4312448068182370697;-2.0495538530027275215;0.91054208476661169236;-0.40340601459453523381;0.10181262190907058862;-0.45685699697248494111;0.83603857074129495075;2.9111325033183415023;-1.415045422128385022;0.70027324613984209822;-5.3925478357276848129;0.87619630162955819408;-3.6936748523131099908;1.6415059557179070282;-3.2068289638685545384;1.5815326717427184988;-0.042736710445707808137;-1.3206216132528327822;4.93738672317688021;1.4378732396639630764;3.3899447625146201801;3.85790948453310234;-5.149676581551412724;0.22820777433384634159;-0.84260275859401523313;-1.101479406464894728];
IW1_1 = [1.9231722457009938765 1.2902113283619474071 9.8160199015327744831 1.4211260215669789808 11.120859303945064056 0.68801980924900640879;1.826597966504287518 1.0427935184151895243 0.80653738079021297658 0.21523873184510708412 -2.342127097842913841 -0.68099105056341691089;4.0153946594209406484 0.79462889179727291822 13.223376940835009918 -1.2730102871213608839 -8.132780201312472812 -0.74569025869584049104;-0.036728121566311715263 0.78783163791470800508 1.474107913827015226 -1.3959721975706087527 3.7071314052435582198 -0.17987868263665074409;-0.85842116417368630188 0.060117395521261648983 0.61164873639741335065 0.62998049265515165818 0.91402909368481866093 -0.029452517235809782398;0.35456724949970797045 0.050316206289052214928 -0.98307658226671901236 -0.32485970716829015714 -1.1914111404868132915 1.0819367165455697766;0.35937654917664452192 0.34690155291044083574 0.57393458185371326596 1.0855041524850435053 -1.4991083972019183523 0.32675166361133339832;2.2206689614331609484 1.3301856118924508809 2.7486897901892417551 0.078402509743711795709 -4.6653063685874949229 2.3351055918845946557;-0.098578015132228496986 0.082891564784750473849 0.17150936162974161903 -0.140042477500892798 0.92104006473739341576 -1.2888302819438244295;-0.45967287513873356097 -0.85599245696555381624 1.3596398369471514034 -0.76023407190605740702 -4.7856103614408871394 0.77682771898273961231;-0.61673932860480595863 -0.11566201652277087464 -0.1886030114291763482 0.046758726924873261765 0.10200250747810953034 -0.86715724202611821347;0.024144619804826374793 0.44066535295306191733 -0.17728801642512884151 2.2515235177412207257 3.3427642156062811196 0.092734426916933690443;0.014944061733798084599 -0.44716373740283998917 1.1410057772202339965 -1.3256592560674018699 1.4534137551326196114 -0.28813950578233765709;1.0962066569913750946 1.3136734407252066426 -2.4138332749819189083 -1.979278584155715226 5.0526942219113113453 -0.90032202508074155034;0.42815157307655632435 0.22114833779133777347 -6.5208705817202092803 0.0034735274249796618297 -3.7749831262320490133 1.0735788184851169369;0.40548142239195983372 0.36380517123841249472 0.30059262142960735398 1.104579092801984519 -0.79684792220609879099 0.15414311911830891333;0.30555659116993000302 -1.6320697241977515368 -2.2117247351555664459 2.1762215378772720165 -30.712224771275614899 3.1103495081207594986;-0.41689593201834795888 -0.026349970242595659176 4.8115650210227896011 -0.78868496482059535779 5.3943030761029904241 -0.88136809452929310016;0.12057844947034103422 0.13022637487583732518 0.65679051907887475714 -2.2845237432311447101 1.9274548375338345085 -0.90756822048154428551;0.42353242743744634602 0.043803389009396800913 -3.4502766766561974165 1.6589420381566690743 3.4214015223882410233 0.26823735428037159823;-0.052726910319434446006 -0.43445674863905181518 -0.33582223560500285009 0.080373131933020772188 -1.4957162564701427243 0.69193823703490531241;0.053215848111565086653 -0.41499799072366744257 1.1612420389886033423 -1.1601378597632086009 1.7336408883415102 -0.095045853981977651559;-0.32391881874365746619 0.839910927663654161 -0.40116562723889565012 3.926132166580565741 -2.6116081484005282398 -0.24699576771528986008;0.31400078278578696933 -0.2261408898441162052 -1.723496529024358237 0.84443231395935924866 3.1897904539346337849 0.0072987337481322227956;-0.12449274826388613546 0.49801572914736819131 -0.0070695333203868934713 2.3980329368082418107 2.9966964458566436313 -0.26894489056244863523;0.092311043820246255209 0.053360997625222131302 0.31290166094836768806 2.319634199426374721 3.1231890040944634279 0.95953399449747878158;-3.4741860979321250724 -2.8262567567913405853 -0.91841942893308925466 -1.0590194017436020957 -8.1499643775196535245 -1.4564248894703741843;1.7598026145239962226 -1.8592001909456872255 -0.63407209483770965441 -2.6054468230823264463 4.0102281159810129196 -1.6431323824802692712;-0.5625684623123958783 -1.131397771737076674 -0.86065959934330449332 0.11238528120289913159 -2.5669275128110005113 -0.41382203143625601038;1.8663419153065730072 1.0137953415060645401 0.99345355228424658822 0.21300981684828482199 -2.9825223795987576558 -0.7651348582215656835];

% Layer 2
b2 = [-3.0468177934259883521;6.9493419957288775635;-0.53486332358795396491;-7.5624968051696486171;4.2900562958347761011;10.973611806026795534;-8.2663432627147024334;-3.1116932315423060373;-4.5405397747658886587;-3.4636504390222158101];
LW2_1 = [0.58347511916834282619 2.8444938716535026479 -0.048895720652197327549 -0.90258627630647347839 -1.4306076134855916226 -3.1690881501612429005 1.3485869320379102465 -0.57165656654454155561 0.64843080591189916628 0.48522865631087191973 -0.25390569570251064757 0.051262034300882837468 -10.911319145465904867 0.35034631768043894562 0.73478516163710383413 -0.005117815114074857584 -0.16690558472364269704 -0.090572011544495581448 -0.38934350954784580079 0.8012822642448910182 -0.34767916101354173763 10.78973192376637158 0.38623931527290589205 -0.11840394855767312488 -1.844013359919685513 1.4168641127326462303 0.19481060831761681795 0.17015558172465788944 0.032346113601176645913 -2.9819725816575592958;0.030061250376852147875 6.0741504739725620254 -0.048297171983395489891 -1.6816395589157080437 1.9180507803339033046 -1.9417128348262679971 -0.11504263198303954496 0.04796634966583657872 2.6808878941158740261 -0.15691201219688810653 -0.86729377680297281561 6.9496804552633308916 -0.50976404284701015701 0.14642600461736124395 1.5580754465816977206 1.1025463300053950366 -0.34247541545496923421 -0.1806375083703823381 4.0040339145656949071 1.3594311504173097749 2.6037985286345919356 0.7887129250428034366 1.5197093196120809999 -3.3445134954909838676 -10.294298079524194733 -2.7829250834184953156 -0.096540920556163561939 0.1677243940248170917 0.18211357848563480832 -5.9799575018686468297;-0.72679929647268382009 -4.9485770441313281509 -0.13889832996487919137 1.6591572485539356485 3.9457088850895662979 -3.1073835408145584758 -8.6228024536336143058 0.88041105342106462661 -0.93860645473286852258 1.8026236340207855147 4.468414694910056717 -1.2143207266301860869 -5.3846795338924291485 1.1324944238429426324 1.4503582275423021475 10.144211076435974306 -1.1665920490655079522 0.17945539908019345066 7.6020873929125185597 0.50008834708675864444 3.1800792781726738845 4.0063622870513837526 0.91887912937315685546 -4.9800023729824260954 -3.4923527015047697297 0.36440487858624709405 -1.5103690987624360798 3.4583402523577828624 -0.96332491705648704006 4.5007606680523428722;1.7635446123708298227 1.265301147227045675 0.19733156393157852415 3.4354862864081159302 1.1882421836605221444 -10.342443623222521865 2.2822000265142348141 0.62351397984651724116 8.1022085896077005174 3.1682617353997484244 -4.9921195168254230978 6.5994303287169993055 2.2012709146788163039 -4.249146220286576181 4.7522774686802939925 -2.4777747367274796098 0.70058238814424689256 -1.6312946453640220223 -3.8571321423373734483 1.5189361904538802861 7.8610867116894409534 -5.840934231915904995 -2.0667860923936682838 0.34677980410836750647 2.0648352220407084623 -0.11154926696440811695 -0.90040982336334385305 -0.054955681697981415001 -1.9161317519103944207 -1.3701460572506318769;0.6909333565370774366 -6.1860391768266618229 0.56438698463021674812 -0.52610602490760238759 -10.659270785766631562 4.7027132749549025448 -6.2828879060572475623 0.14460419619527303814 1.7590721782089613345 0.46101427326246186 1.1393769746751021277 -3.1305424719587273685 1.4863287393338515674 0.24841480795428730333 -9.8142526804909842042 14.186374291116921498 0.66825542096419388027 0.62297376184966146706 -1.8275016245670159254 4.6349831114515183117 -1.0931960777118443495 3.4418654706794402642 -5.8634480405699411776 -5.3849710563991637358 -0.26876087677263998943 2.2005808811934075564 0.20231410317983941627 1.8919480647397213247 -1.8494461152141206117 3.2875511207027363625;0.25411982408572270087 7.3407631530615837789 -0.42575526151079357007 0.022128754772334936068 -4.2369337361599779257 1.2736607636752024231 1.5982893163821316751 -0.21290173752819785413 0.2605837334946574102 -0.023480746267453805887 2.0197462852010055201 -1.1812719711939074774 4.3326777131871816451 -0.21639907895783846992 2.1997035998814307156 -0.2207974064574571571 1.0949463868178062054 0.60219080282747772248 0.75433178175391724096 0.57393823282773048788 3.5573052014329529236 -4.166172623549428522 -7.7691525348593932776 -1.6389585264621764349 8.3288978902241996849 -1.6745462837737798978 0.47583232690096122219 0.53919370444706948842 -0.92867227557510423352 -6.9659133563239183928;0.82773481779105506639 5.7246497262850484233 0.25658747672882570301 0.46888671600368070358 6.540556997799421346 3.831354752215609949 -15.599677275517853658 0.14456025093256963387 2.7940289835171618904 -0.62331198510228136289 2.6419456732048645087 -0.17911714317643695482 4.8161632978026940322 0.43179478499355872234 -2.5744561981849516386 15.246683480472453809 0.21013154202587194797 0.90642834970955676877 -2.7322336778733289364 0.99795691554143695079 7.7097209065162459751 -3.0617438295016610184 1.0961237004776722692 -3.5889152625633125027 -0.84896982357275196929 0.45963029228417928707 0.30364103357773841729 0.43465116605192305466 -3.2133266576512782287 -4.9733728979614317822;0.61598169110730460751 2.7342049243626274091 -0.060214393244510527881 -0.84809281269966418915 -1.709532911093248897 -3.6449338453284703121 1.7377714678019353656 -0.53197559170067876266 0.68938400700765212203 0.5892531176355682021 -0.44903737682952415966 0.34055600923501855304 -10.287390278172685143 0.31884195031564249723 0.8196302874269231209 -0.51544188544444691225 -0.14714894944178652514 -0.13299636330468539436 -0.30880170179268984221 0.78555608428646861441 -0.43895113254412770898 10.137345338998205335 0.46188677252271764795 0.10266985866565879471 -1.9076897702929858092 1.2124208845802275647 0.1962233186179300759 0.14809489442670678572 0.015181293415202088207 -2.9025640820266285225;-2.3157973357785386348 10.933085472130724014 0.63501566102655704338 -1.8247362446903956368 11.125864466986662649 -1.2957214308056481666 -20.341167331663150719 0.19905223041855493737 0.8133753952000742915 -0.91708262411174490403 3.3854544382975255701 -1.2712572288945687138 -3.9554331700105094249 0.96498539928058701953 0.6649225137562128074 21.00481339223545163 -0.35856819189281396998 0.37784978209896058488 8.3324765350960614541 0.80995718058751664525 9.4083883773467906764 3.3909063637366547717 5.1081049094417902978 -4.0225748536324879012 -7.205016639349246077 2.8444617633641491317 -0.34479195541278784276 0.38846221908892314412 -2.8666700949856305236 -9.2800133084627081104;1.2076995841785889141 0.20628529174885049113 -0.15868133089029329286 -1.8264840430697997231 -2.2711725718918400752 -8.0610091978660634027 7.4413834071243352142 0.019643744336986165844 3.03457201358952533 1.3662456285424151581 -3.5016396711529744756 1.2406257259440049978 -12.267164571846914001 0.096153201331648854855 1.9954390109876805059 -6.636891435589529209 -0.095511607674958434733 -0.75512710404551319776 4.8483421449149552984 1.9309905833528757668 0.50282983457030672181 11.159913668847661228 2.5525728245510572734 -0.60738295951005827344 -3.9824449645225583616 2.6913216346028154824 0.23714649695895981263 0.01300959508214744563 -0.15299886897120509865 -1.1457485278598724676];

% Layer 3
b3 = -0.19215800084051404273;
LW3_2 = [5.033847465308578073 -0.41980173268404996634 -0.092996954544818183352 0.21032315062101353265 -0.067210979306415216672 0.1219057272781733231 -0.22682803724658465172 -5.3612002577305375439 0.11587376769515186914 0.4638465138356674955];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
