function [Y,Xf,Af] = ESPER_phosphate_6_Atl_4(X,~,~)
%ESPER_PHOSPHATE_6_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:28.
% 
% [Y] = ESPER_phosphate_6_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.28];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0470499670650231];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.9492313485336061341;-1.7100579310040626702;-2.6901177082096228155;2.3451254642671504058;2.1270776361602639071;1.975144115655601551;2.8083761868194292433;-1.9451394719988785997;-1.7927701023346171993;1.4917167061925291627;-3.200153263222414779;0.37592582356363207774;-1.8268192897086903415;1.5531951245943140805;3.178534849323766398;0.02858771262571274327;1.8665687222768303499;1.6511696345296138499;0.055738091505478856713;1.6754337555614899902;-3.0494168637850478376;0.23484661561880698644;0.033444423462655609169;-3.7167947184995093757;-0.32931600469666955089;-0.99044528169386381045;-3.3477986815990075087;-2.3577598620114228467;3.3763903106579968849;-2.1210998288737754613];
IW1_1 = [1.6638030825175949001 -2.1503863879304532247 3.5522883505381970259 -0.40656138281564779824 -2.6052786087519690383 0.70707184794315125487 0.60006308018663490067;0.6255531950294902499 -0.40460067060844434605 -0.5448450646559441779 -0.53818453750580796946 0.39727042656891425887 0.53988431482561582975 0.60442181322310373215;1.4585503581669316819 -0.078661340081343678055 2.8287572229036253013 -0.5690287297402270017 2.0126928591376223032 0.36318925584795763717 0.62200468930291985536;0.13231345366301083821 -0.0073920950692136890361 1.2798004533516693648 0.12781410202497892059 1.0247100776126800703 0.66765999643949225373 2.9681068075816141594;-1.2418268525946474234 0.91181478478035893342 -0.20968104164078768537 0.85320533413809374057 -0.21189235882699036795 -0.4636415846040405353 1.0622825133675024567;-0.43949679524106843864 -0.2843391514183222224 -0.025087428679076921589 -0.82810581393433735364 -3.8328468142872198499 -0.23918133596040833111 1.0386740711284669914;-0.9099843045602905578 0.4058956294981118651 3.2441496642050853261 -0.015595819475049087222 -0.16357599811303352721 1.1037068005507235657 -0.37749073502486912846;0.72223978901629071192 -1.4631818499184767735 -0.21636521392423108123 -0.13840003109678766791 0.22819665565230812243 0.25966617992668039605 0.51972725447862599957;1.5277540324782186154 -0.82811544889936128389 1.1095302704567049368 -1.0721915463086464371 1.4911489823776726826 -0.12539827446070786476 -1.1034951368543561845;0.43285389483866726357 0.29051998643938675704 0.99580799754954041347 -0.29128399583670672168 -2.2662641604071764867 -1.3022861655341642084 -1.1672568694346303619;1.7179601416773824241 0.95670256121312791109 -0.36820322107532504896 -2.1794450122877804255 -1.2343004511304309645 1.3386965588324351017 0.54402366405719781994;-0.84507913566405790107 1.3429881028313848113 -0.42852806530835774179 1.4541002904660540462 0.97032802656689631782 1.9254996340144447942 -1.7760383112777222703;-0.74896853932443341328 -2.7836398471275205502 1.982750409532064495 0.25506885401954659809 2.3420341898558270088 0.074394832483805947709 -0.10422352899423992234;0.3403967689730039714 -0.43927503820196289741 -0.75731161410049918636 -1.5349766085299230145 -2.4945400937513584338 1.8787983979946656365 -1.2190162073326928915;-0.77487753123079483597 0.69935225429838332456 -0.71943012131629968664 -0.3503004020964402554 -1.6033179262739876147 -1.6165031253373634001 0.9398429267558309208;0.32008996620404334132 -0.16266058074620287632 2.3025723505755908427 0.087895244005511186103 -1.9605898827750309898 1.748288867231455157 -1.4738912460622066725;-0.40830477926936031841 0.12129340065399422943 -2.2490971895543343528 0.53924245627530942304 -0.81446333871470710797 0.7423788753204708657 0.24020940510405106028;0.3042017042151379802 -0.551813108938855712 -0.9778755304126894865 -1.4411902765434256857 -2.5622661843576119978 2.0659438527914586459 -1.1368174906193704299;-1.3335424712989336626 2.5692983973625831418 -2.0084392110440947299 0.52816266229217201378 -0.52520180638572611098 -0.069137848497099044232 -0.25622445950127425984;-1.2587217800155341418 1.3549850670304737221 -0.26595111835838608494 0.22712911339211785955 -0.88703992850857460439 -0.93102000834452647293 -0.6688349659026400218;-1.1652066981604403129 0.54649419588501313427 -1.0374556490901318817 0.58027448708141993183 3.0252022989005813436 -1.6076298212693682643 0.70457015529442101887;-0.87947611594422614445 -0.3457504888030388801 0.076930363504575119404 0.71721565147235999405 -1.1944631124640849862 -0.45894318817364465612 1.0159629855237617413;-0.19075777017556855286 1.7004362074569292496 -0.035663599639668912278 -0.10431503183200893647 -2.1321722285775575045 -1.4728910404744013363 0.24872346056957758687;-0.76965432010095025106 0.97550755523410681569 -0.18193564894222710726 -0.57532664445328141056 3.0342031960797042345 -2.1885777044740399866 0.39205412955994162205;-1.5844544737653791788 0.51649411080774565441 -0.99596240567499516594 0.27031437127411195309 -1.9108562535983701913 -1.7852717446884047714 1.1902325790901204794;1.3919401549437584453 0.35610273932389691076 -0.58338708256427240784 0.20891306554666855266 -2.4421469296784206193 -0.38290172959403634412 -0.098905564251033153966;-0.98502377191060719319 -0.63192689813228208884 3.4945539664428237892 -0.41619795622436622784 -0.38777919069896515936 0.99130442732390544602 0.48479449017640396935;-2.4288330989054722764 0.01928953917915946642 0.42987578160983896947 0.7409254337241899524 -2.1787485252769522859 -0.42673337758615448312 -1.0201692608719197253;0.77836683643334469984 0.29540601862952292622 0.33685438155928010273 0.13949118253913875276 -3.0705300338262349058 -0.090399000477195803893 -1.1830420124405602866;-1.0313975352025497312 -1.1885926261682113747 1.763251323152145611 0.46554566038349604051 -0.21229547984225649593 0.22358065796468262754 -0.20729414846124841199];

% Layer 2
b2 = [3.757687932034084799;-2.7368195718656460613;-1.9690197256557988581;2.0351772183957193008;0.34628011484504322981;-1.6980534939970706176;-1.8723973499164212608;-0.30580536218250642388;0.28047483070803652661;1.1026416397157827731];
LW2_1 = [-0.023054940548464755712 1.972723056138420139 0.28506079048015475763 -0.11768879394961306861 -2.0999021821524448406 0.52880058955088504735 0.76249460382923306412 -1.3958283372422488622 -0.44723656263232358654 -3.1786144014307828876 -1.313007931322834887 1.3717722464042376718 0.028966834815421556998 0.65059477684190269997 0.55522276277026749725 0.39503072793747429081 0.59601806709446680799 -1.0054101007840934301 -0.04301186633290907807 0.70132517570208885438 0.042095516060597831798 -0.86488105559725814153 -0.77200377181762624978 0.82491073311806017987 -1.3791534791755788447 -1.6061113620584193118 0.010814002144854648751 1.3955562641659475798 0.72408548938207428769 0.66292917494611069973;0.18348899701889470615 -0.62555198174840676018 -0.57543966168147864249 -0.34796305035686042606 0.15637050968206261947 0.3199255689826912552 0.085648899149379315032 -0.85318569050627046657 -0.41023702290606445242 -0.39838729347207718634 -0.94675788456871778909 -0.15209015697983011006 -0.2052409676542644168 0.098007005333896043964 -0.22058059809043106814 -0.27530422873150323104 -0.92984382264940290685 -0.4201688145367312166 -0.54917064613819965846 -0.81363023730448058579 -0.35892965246157737536 -1.0355286613032435028 0.031198187291072973504 -0.24992125157883857134 -0.48527773767385717907 -0.57147872479158323689 -1.0665107587551270196 0.58777169575606036389 -1.5473664287902448855 0.36479603882337274801;0.44062244945969519794 2.3636633455793609748 0.042897344011689500509 -0.62563994279315571223 0.69770604363367583201 -0.28946419947344476098 -0.077772790828832275012 -1.406733541854808367 -0.96331088668856112989 -0.23538192527276519117 -0.088681677817547405196 -0.21239026379470835049 -0.39321643222065072454 0.9641423616355614401 -0.4637420840021870827 0.22292078293971567815 -0.95017166223952598259 -0.590045127745546516 -0.19596120312564663246 0.30153925260732639124 -0.34510893225348049373 0.65089862524792596599 -0.80775154128835136014 1.0644877442216413854 -0.75627639539101176869 -1.6847154586650534558 -0.049248502149522553617 0.51151669209696759566 0.78410930619154450838 -0.54386078944278382075;0.74962728330605854499 0.37793815026635635412 0.2902738445594608141 -0.27381213281310712304 0.2899882728138182264 -0.21344650691156469291 -0.31284457561562123429 1.4450229078335343758 -1.5073360059194855776 0.17427365789985502231 0.1332010884357461844 -0.092167687516475235721 -0.092636471878355303167 1.4083270652184247673 -0.8250652415894570435 -0.52808318872051696058 0.17074232269008837726 -0.97621457589471405392 -0.51643050645955312916 0.60420935919673179892 -2.7933273969918337443 0.17810448558049837842 -0.08461855815227446731 0.16574194958608928774 1.3768537547498735929 2.2346797573850896157 -0.59194242441942124255 -0.841431305949176922 1.5944489111508588497 0.81991730623299940994;0.065521195824985709044 0.69388776428943699237 -0.8237021549046168456 0.45264640438989672822 0.21732078786884367894 -0.93278859279516979086 0.48371168717359813716 0.88098061139574834755 -0.66394090286273266255 0.60829639595789997131 0.10380236943161416652 0.37916881646328959299 -0.075528921949465685493 1.0530306815389407493 -0.10203472033706915967 -0.30200842600980143393 -0.97621145182368529447 -0.98172625356902210036 -0.32042315964756501456 0.41419320045515251039 -0.40835273653332854193 -0.83666768745278174979 -0.41934217237099929987 -0.17964081088782543616 -0.48173686516181479789 -0.12017713276253662313 -0.043016296044943322374 1.8770292321331318863 -0.76415689254068230873 -0.16707944727772716664;-2.111417086100737972 -0.5484996696623097856 0.21292515702787626064 0.049556190251471114727 -0.45274011215778398043 0.56435573704948616136 0.4171901242970538215 0.47625890382676300261 0.7178015828725863301 0.88440614416310403545 0.47316906573303335604 0.14181296011229513332 -0.0083795093338553307966 -0.95800021081786801425 0.36397509468141925337 -0.29838320053682093613 1.272533991127390296 0.51167639464904302038 0.065173311394732882929 0.46964994458980563463 1.8392328618997146883 -0.0069965363144542137841 0.29212095275349719836 -0.22510695655705231788 -0.94709689089273985108 0.11263160289094742428 -1.2431683617562714339 -0.010620994730995543531 -1.8628285288877479697 1.2286320544348703354;0.064379495279295734234 0.58977153119725223007 -0.29892389292495386011 0.30854771695805821574 1.5587618249301782303 -0.67801947196040845967 -0.03220095031685637349 -0.70851896489893939624 -0.036164579417749524726 2.65498116710326304 0.1728537310025878293 0.31833961732609394879 0.1611284668377732654 0.34725870841958178525 -0.70368987431812313194 -0.81978089994905001259 -0.0082061701807378973489 0.24554310597439601982 0.051825738486866029797 -0.96041796364106746253 -1.1176657552406548124 -0.87309757092170126036 0.98487275567303211865 -0.36207359708779152108 0.86371884386339559114 -0.77027981262524825024 0.21281565456621567844 -1.6092614821614779075 -3.7249253742031478431 1.2262667458064193671;-0.18816675224567111502 0.086701305426879385352 0.38364900542930113758 -0.55629437957835081718 -1.0120060139164808177 0.3402865891046701341 -0.14412177774479381642 0.20561338764133021972 -1.6067926839480455303 -0.72095618636339253715 0.40598749281322427107 -0.40477992150247160685 0.044718362139512787823 -0.65001166573493185386 -0.14217019561399066307 0.45389330575836089876 0.16946560707219010533 1.9794355041859930111 -0.25244587965226628068 0.46240238196853322705 -2.4067656350542345756 2.4215050296450426615 0.021504930521321016096 2.2067116374084978503 -0.1306585983422799413 0.91643436020926005714 -0.52210750074076106575 -0.39234578977509165787 2.2162601499083738332 -0.10926060748583529825;0.32173792598299244538 -0.74510777447045395405 0.82317251467013863309 -0.53006310574533110902 -0.18242602336472377167 0.90185894789141363148 -0.58848136571516340698 -0.7751518487017294845 0.54785785633923356208 -0.41989346623661327751 -0.17769800749851236144 -0.39185073032001749294 0.058487918624517000465 -0.41799631396150188634 -0.29741735676984809578 -0.018578957930269719007 1.0012075545199659032 0.4141319346512020716 0.41860132316518999795 -0.27859862010161956514 0.42245119327664748532 0.66227490340269556945 0.5489657533059065786 0.047236876840919775344 0.33495458397136851358 -0.32740344648289487761 0.11292878261885801183 -2.0711154235241377997 0.13504079979372998754 0.36819838717681457885;0.23458016721484914457 0.28318194857425227351 0.62602232866111451326 0.32083757564700343679 -0.90458527116153053527 0.31830613522761486145 -0.34595043820939197499 0.57979837175344639544 0.33745892812322159093 -0.13978027665957115655 -0.061218609603931634089 0.19146002897094072104 0.54715874051882706919 -0.24479568467246476393 0.079128544386185134529 -0.1016789040100845587 0.87200297334561693852 0.14799978820280099145 0.44653628036681097813 1.0357919521912819505 0.57651061798550962134 0.022472371775710521524 0.29521207202356208876 -0.42896512404078385172 0.1508011011378520283 -0.89747498029551331378 1.1601090257198152234 -0.10766659275436318843 1.3904131914110782198 -0.55776548062941033734];

% Layer 3
b3 = 3.1406197606856864901;
LW3_2 = [-0.76214412537870757092 1.0609922161219520476 0.98782749883371279154 0.90977721804649147597 -2.8779437660089470796 0.68525869451612808625 2.6278848765109730223 -0.90870600064593987089 -2.7104272609688533358 1.2565546827546369979];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
