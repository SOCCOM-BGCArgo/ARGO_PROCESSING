function [Y,Xf,Af] = ESPER_nitrate_4_Atl_4(X,~,~)
%ESPER_NITRATE_4_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_4_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.63726239593702060926;-0.8262776093723074311;-1.1138664872577908049;0.79967716991276593941;0.33267383965548097402;-12.217022812361554074;1.3014591637867969354;-3.0109612590809531341;-0.96813251004102118813;-5.7202672731999513189;-4.8367612197727840595;-5.253367326698154649;-5.5292185672070095492;9.9077085586261368633;0.65878590926680025142;14.957136410945503613;-10.503101545788785742;11.081125594171201243;-0.51911598880803988543;-3.7382671014735029402;0.37247528129464596569;3.50401089269070809;5.8885211550390446078;-3.5004789291398719087;24.56055846581667268;3.3112810884038115233;-2.655137302122434928;-29.489001948697602273;-6.1170102364397047623;0.54937556669180265256];
IW1_1 = [0.19517971281666038341 -0.050633435177480444478 0.098303113037441547384 0.32164094452981573102 1.3152892938282392254 -0.44188346831509706103 -0.00017054198542876394459;-0.72722466719533218615 0.76368244634517712388 0.95978261041059498293 0.61188438049770177418 5.6895062996723426707 1.9664181563660050323 2.1424512910654480713;0.26217033012990642593 0.62453200636615791019 1.5097800716329405901 1.323405195424309122 4.6891959374629861301 0.7139550168520391038 1.0844132378273285688;0.26347660510613846174 0.10029071620491479544 -0.27386523974795062841 -0.1909863272778520582 -1.4319001267216611151 0.94766567109273136538 -0.8738569977651479137;-0.20713740591241205924 -0.52743343220656091486 -1.1798210703497880036 -0.24468575916825066607 -4.1709716595001946615 -1.6401009441761276175 -1.4118174987884113403;6.0368215010920707186 1.4691695245873666043 -3.693707814792718036 -11.536917927446994625 1.7842565645283685605 -0.97224355346357171914 5.7282436199552684286;0.14870858259166871984 0.1005892085168342831 -0.46814255853381026018 -0.14043246788803911973 -1.8946287713853238177 1.2519562062405600322 -1.1555495046599684184;1.5715257481616737856 0.9527455641164239708 -1.4003964691141685961 -1.8418397049404147126 0.050237889131323647252 -0.056795970152094914229 -0.01261867096590741158;-0.18077432066234552788 0.13062055451233389736 0.33777679333756366331 -0.60828747490745171955 1.5116921580071898124 -0.25373143102206047184 0.82848794023256022712;-1.3565083263506156896 -0.10178378523293613034 -1.2242101717632298818 -0.86842853093389349439 4.8382914215599823748 -2.0708274749871358189 -1.6072462936404627865;-0.29594010011603189003 0.046258490052489151245 -0.28235323368118542264 1.2386762625916178937 5.0561094568479951761 -1.0851401310978641135 -1.6681077442270317857;-2.5912209687732743468 0.45685295622064836518 -2.0108839795173496512 -1.1390777378082663773 2.6870600279006482403 -8.5892531415580624099 3.8451810365533343194;-1.5217174034378055936 -0.11381580864945403664 -1.5852989771323660051 -0.93684070896021720554 4.8254551031908254899 -2.327285216418057523 -1.5086219231693442921;-0.55107673330707895865 -0.43387490584826238216 -0.20268554767821156393 0.081892742010782199058 -7.1385710437007583451 -0.4313133747316695854 4.235417839088347236;-1.256786252388952807 -0.87234952479599092712 0.23851542346728182853 1.5349438230399354843 2.6973615786101912128 -1.1956112629348516485 1.5624735518781043275;5.5538201524036647783 -2.8438272166253164563 4.7768781267275981506 6.6323924534133960051 -5.2492245142301792171 0.23871711367908815538 6.9942722279564044641;1.3948248025746166068 -0.42415562021745967236 -1.6284488490200581534 -0.20201863015350199348 6.9535272700386077105 -4.1314842292947719926 -2.4323731948221585242;1.4968433746556359942 3.7751967663513927853 -6.0751354354694706572 -0.37361616568564653962 -12.998243611173434076 -4.7044574419693239165 -5.9064219747507769043;-1.5403463196813680369 -0.12700247244857271189 0.099074633874097400854 0.25442097056699952695 2.4377734998921121168 -0.47439519387010853357 1.0233073560800272084;0.095804343345609180305 0.42375819212639898037 0.78674142615173370263 1.1007521837347409299 7.729134917697085605 -0.27809259525023466431 1.0373973752987819541;-1.6539955292170440693 0.27052253598221503994 -1.1609028892575978809 4.6671980911531623093 12.285665508456093065 9.830142957086014377 -2.1671209871850778406;0.465627645201968976 -0.93034388543188073495 -2.4359274038169531629 -3.2388652182585562223 -7.0151911098217523133 1.5488353545600921368 2.543111612174209224;-1.6587026056240135041 0.69464754879210144356 -1.2504029749671670135 4.0432918473849515095 -3.6724786438469063654 2.5739861148190148477 -3.1620661787744270832;1.7777813700934921304 3.5043308348774613314 1.0514400217794646064 -5.0764510827315385555 2.8050452263637821737 -1.7213210698059355774 2.5192075095877894952;-8.7835663545026374521 12.443003150549742486 0.40504768499338300591 -1.3241372053403359654 -12.961249623496764016 -10.171649887807715729 3.9058587999323752804;0.51236842162441242898 0.30801756165548876965 1.2971446555140306867 0.57314881955566432392 4.9227354945740922076 1.4555256767636841619 5.6543260140824918025;0.090496350742490891395 -0.21171678041195834963 -0.83822348976519545083 -0.83870780364215757885 -2.5772570033880746188 -0.172544562033229959 -3.5858319714170217019;-9.4095250440873936526 10.227063807018437203 4.3550333191575241187 4.5611970188138686311 17.615002355387034072 16.363766048359902783 -8.0583097434230701595;-0.97487605764713525236 0.76063100185788090624 1.4252984407817312906 1.4275853481352231977 4.7152561641194754571 2.1005391755032363221 -4.4348238753766437981;1.6523919008042196044 9.0967138292340852246 -5.5426146887777703043 -0.65553944777068584582 5.3145957652806217197 -4.3697787729299193415 3.0657479147600588121];

% Layer 2
b2 = [0.63037897112447105474;3.2443866034530812748;12.12971240209537882;2.3786050747028513186;14.68540675378959115;4.1632351256974766684;-10.336399355131026923;-1.2118945324582441891;67.140513250177065174;3.9303540004397667929];
LW2_1 = [-12.446238740182657523 18.89920441796207129 -29.187170077493004072 -30.213859789452992999 2.6154666670457076272 -12.116978658703636995 -57.997241684646880344 -44.861756256125971731 19.569455701630104727 10.007261427581582325 -1.9235522846034756039 -2.4503358793871683474 -21.630851090062240161 -18.418635546044995976 -38.183314402350795547 -3.2089510099204821003 22.813265368651173048 -9.8926029541828786051 -30.161311782787400659 14.946250028014400613 21.112039776277047309 18.450328912718727992 20.803801238356125936 30.627456512224700447 -14.439742459156983401 20.341426180068271634 21.463656341867938693 7.6521715089485580208 -2.5026598016460490648 29.451643468665103853;-19.711812076573050234 17.454853641205392734 1.2365212744633959918 -38.626533041271500224 -14.123236932996979576 -1.0756226032924041114 9.5239952140189387819 10.209551455506895579 -2.0593231256987349909 8.5712400721069386123 -12.027099965789050273 -4.2751116519806533489 -2.4690593874501676197 -2.0785503059272016912 -4.5886903642064131859 -0.44180832683584647658 6.8991232511086781898 13.161032604379837352 1.1033561456671570067 -11.873635310961983436 2.4689610742970193868 -3.3365855795434371522 -5.0201146810833483514 -10.081554950851836949 8.2724094758700630337 4.9886034691427720844 0.75429479298600732307 -3.3281931378327906934 3.2599304591136468723 -2.3666686814448802956;12.60577514646586117 5.9159322487585601635 -49.805511294217957641 -24.701368032029471067 -24.249484384322578023 4.6718322998308252636 -4.9885164794372274244 -1.455680658284229434 37.257843201763343188 2.0192893634271813497 50.45741035144952491 11.969630951388193552 -3.7902067736454911895 5.8606519152114815441 -18.193169211137956154 0.74175070120317276867 -52.623184888327216413 -8.7577066986185041486 -15.879578878777881101 19.274107728530641026 -7.0726180882024483054 -6.2794889554604997883 21.996688189702688021 3.4411528559526249893 -1.4990704090144317817 -12.101971015712319257 -9.6281970203001865372 -19.284116499177272885 16.359972584859953315 -3.916622244937569608;-3.2751930706950669325 7.9723180022292075009 4.2525492784875433827 5.7981328540995429321 -21.243781873106566849 11.498381645307468091 -14.71765251207742331 0.59772841067812865212 -8.9331830611368285844 13.941577073538651277 0.82436073009539279077 11.865112107168117817 12.870258538098086731 2.3965660800937254038 -14.535051529644825052 -21.283323783964000597 -11.27581452963787001 -10.077339093165015527 -11.362183653178254517 -4.7387085957003884928 35.87833795575647855 -9.182564597094684089 13.170044774183594427 -0.55524989391157897334 3.9781654031740707467 -18.034452343468693414 -1.1857375487074208742 0.92728863145581985616 2.1664323142294859004 5.1759414682735442881;-24.003129616746555541 15.136854234758317261 -2.6591338247780100801 -20.448597829343491128 2.8987047284880369524 -8.6341735674691353353 -6.8547477664020579624 -0.95831164090724829663 0.38611833392728883707 -16.989883659293440132 -17.679034402865802633 2.8910070350111678472 -12.416870311597417498 -11.218726039879955536 0.67258950550606921848 3.080208154520594821 35.024673018811569136 7.0348725652850552237 13.618504570724965674 -5.19747069545785223 -5.500340434251917543 -18.275812950932333933 -2.5674216773236819833 -14.25672301305313816 -2.6867398304562901679 -2.9876102500853165544 4.4110554176941727533 -5.2109184288600367552 -2.3138850501625451983 2.1935194396134987116;-2.5065303413596287108 -22.282988572862915788 26.787808316846870582 -11.369591476825480214 4.8708314977165123594 -21.805151198717364736 9.021464665328664978 -6.8924987954660101863 5.1667564136426165078 1.941622084428489714 4.7303393765195371756 -17.313580697490717597 -17.420125424385890511 -13.119765766784553307 20.384051367476246241 14.666216196845299535 -14.193683181949102945 -12.566426581694640774 -7.7424296239879728532 -19.615221183188904064 -9.3680214607940506255 -34.804773485765942098 5.5042175169360989528 12.239730037912426752 -45.795054487992743475 -0.27322964677432576286 22.085460459987579895 -4.8271764549228555197 0.579170582393449207 6.7810948291218435813;2.9877307549589984248 0.64855762137673789169 -0.48495434226443129289 14.228775164346059157 1.324101904831541221 0.057335648776029007889 -8.6878504931363291774 -0.10610480562141724747 2.3453196447645860978 0.80511809718429028226 0.561860508142293269 0.091177428074409899716 -0.82912852654068369684 0.051041520317792826722 0.68766014032853672866 0.31978222559194396935 0.38497847660231526712 0.9330760667322378632 1.3453283294946185578 1.1879119771425825647 -0.11742741045720013482 -0.049745868300832718489 0.34143319003854444293 -0.074084327767183627556 -0.10947462753404207936 0.003252779426595429034 -0.25030828846381153463 -8.3698511301568476739 -1.1802102668116432049 -0.009154067536081970588;-4.8194041172062211942 -0.791964192115951926 0.47392749104105197366 -7.2379104513294914014 -0.92077255607156294204 0.39673733220940538002 3.5377589460213259009 -0.74939490180270906805 -2.2593760507000766324 -0.18497396384688805093 0.4409416196482271455 -0.031165112125334772097 0.24456629020742365332 -0.45978046926696986008 -0.63040797951338201077 -0.29006123086580626325 -0.5162265280146457469 -0.94429064494326631074 -0.94484585320740410719 -0.65736674278143936156 0.16173134094000898853 -0.6168721670134154067 -0.45726851243508481737 0.030658417081300598506 0.07687114313788220854 0.12806523263054736539 1.2261592890608916662 -4.2135604128097030596 0.98987687007909253012 0.017865245807831525715;7.1065583364992654936 5.0902166097550063384 -33.389868510822140024 -31.887523145111607903 9.9368128818098195865 43.874397879546933154 40.887033931202800829 5.3710573945877735369 4.5450688911177481444 -7.1129178816873963598 26.025075918899251093 -13.422695911728885321 10.37804587520539279 -13.677215844820819868 -45.992903909179318589 47.444805375713954732 -1.1301095524416757687 8.6895057169171092681 -15.72246397849126609 20.061930796157483314 2.9085225269928463021 -0.31750508849750153084 37.449206936870425011 14.790374907523432313 31.055785476635616504 -13.349862342044737318 46.213104412567346913 1.7741064787501135136 14.859678707031427791 4.5820769967953793866;-9.0005779088484985095 -0.20713543346908333542 5.8752927461612376447 -0.48852744634989769823 2.5055504435573219268 -0.96809217739437603001 1.1470131315625773372 1.0364244972337119943 11.179302879134890958 -14.670303058183570499 5.3248179578767169673 -0.00030811002016744399798 11.213494352893047079 -2.7014690008797579424 1.2400497094465108283 0.03823175162283883044 1.2178118604075180986 0.023913074502578741953 0.17860245099629304399 -7.0746934173014777159 -0.35176699774355113526 -0.091951942315526571936 0.33057198303654622418 -0.22476273535549301519 0.042466677755192833166 2.3066745719535002301 4.3777656061744734117 -2.6186792707046855355 -1.4011459919034685573 -0.19967214130778035419];

% Layer 3
b3 = -0.59987687442233950108;
LW3_2 = [-0.0069145561936390367505 0.011021064597722608075 -0.0077935975264677558733 -0.0093882303113018046592 -0.0078520388127154561175 -0.0046805157689248384073 -0.68925104433289230421 -0.79551730266172271389 0.0035677337383355507 -0.26123651061497243919];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
