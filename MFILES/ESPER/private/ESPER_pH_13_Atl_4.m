function [Y,Xf,Af] = ESPER_pH_13_Atl_4(X,~,~)
%ESPER_PH_13_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:25.
% 
% [Y] = ESPER_pH_13_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-0.2178;-101.945317545701];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0479365703301392;0.0054210015363163];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.2089063422733974384;2.5838622781076630019;-2.421772637331348399;1.6919131727895588835;-1.6546181586029000687;-1.4900428205146514227;-1.5759726253440928812;-0.96556395989690868564;-1.2709248429122677049;-1.1077005689875829564;-0.85590081920347993449;-0.34800091167151642191;0.88760446040877494234;-0.39025331938962015688;-0.231360365863486378;-0.10298788724991654597;0.086948043237653663273;-0.42229590332460625879;0.71199908267007350204;-0.72957113465105571937;-1.1635303535610019843;-1.2914556719949545904;-1.234889905772702301;1.3328644851916608971;1.538833845812354939;1.2682388026621276289;-1.4371469485662122789;-1.8071640372832609156;2.170642586979628863;2.3202945618675610007];
IW1_1 = [1.1531491414585788302 -0.010415282132818459021 -0.73259349220583369622 -0.56319705492800253843 -0.50146420614489950474 -0.20215377987562629936 1.6252738446015393414;-0.68097088667490657254 1.2107410339572490798 -1.6999082908286893279 -0.25870727173880059269 0.9055940984069473787 0.1639060425310105984 -0.31536787804063109997;0.017302739160275339148 0.25023082135246210722 1.6818085125937698443 0.11709948336691435034 1.126513048867718636 -0.05866887993242776711 -0.31028735552240432893;-1.6640694589894642341 -0.32983456605400596207 1.388250181221243329 0.76764274555054268223 -1.3539337403506996882 -0.82909825414719073855 0.71582412223311664423;0.99475018143710591811 0.43463171206688050452 -1.1259454052676205471 0.68853874964874439701 -1.0995715390334486194 0.2554095110162518667 -0.69691138262722740482;0.94335518369080750833 -0.030613437643828199375 1.9074839918373589498 1.0356905670267806396 0.15829156356995302546 1.0840689944398114175 -0.72511052799908792821;0.97765740478763984989 -0.44052645229043352337 0.35188839360259310807 -0.78606173555006630949 0.1595363805712905203 1.1196150101124653364 1.0368559006184037141;1.0363256781528127348 -1.3379796397080760961 1.2434718187174853554 1.4056881710514377293 -0.35024760110081237796 0.17290917414702905441 1.0530225556695804734;0.64327164679747728115 -0.095168799170850804092 0.047734340589850848824 -0.95843806977464940378 -1.6964653676724286147 -0.90198839565253874362 -0.60087038488104260736;0.52930206023891501754 0.89703615799835889622 -1.4474948765714743537 -0.10167713623668409029 0.87413827926392206891 -0.40090407875830080808 -0.81462796298279283036;0.38333220168159293229 0.20829230355772496153 0.24131096862123807556 -0.96632200590894612446 1.9460850323466392098 1.0090504182555821711 0.17799872381868075966;0.12825185941448766225 -1.112228301418934473 -0.37676581782588303149 -1.1118348609417783024 0.24119081181326976204 0.65527454291978970424 1.6888266921765453521;-1.1675118361585927751 0.55060432185277574657 -1.1558051896679928383 1.2991641643773768067 -0.66389367631787232771 -0.28387633052023897307 -0.26926464381612602583;0.91383081928367515534 -1.3685133879447863858 -0.079064856734703495289 1.4569609288339153697 0.85213788904499843113 0.49497494241648071212 -0.28198560887118612195;-0.3830942619081627587 -0.29744268577749144455 0.74745269314483064882 -1.4013848968270103956 -0.31405255381108054813 -0.20826961936157295519 -1.2272662750249527797;-1.1090794276333284518 -0.52451572148809144647 0.29758749303246012641 -1.2752269660240769245 -0.64180077038789362653 0.54851226504889083468 0.81364687842611171931;-0.55505351286167514679 -0.029771441362615176651 -1.4145374181754766241 0.74745238218887966042 1.4932593513834990784 -1.2257276278562136973 -1.093519112964036033;-0.51190914843869650408 -0.41659815157787360995 -0.28798849318117020202 -0.74596126270585061402 1.3223498405662905686 1.4293790612522019323 -1.0694585163473522282;0.85429195231016075152 1.3455909145263693638 0.54573083246599374263 -0.41629722627675408431 1.1202170589131841272 -0.34796332811323071876 -0.47730160497784407392;-0.96382498108002889747 0.68621092363377811374 -0.84836647638826001572 -1.2222122193181175209 1.7253416572242030735 -0.16108452670084716374 -0.49513545263709768385;-0.46575109466621261722 0.63818715281088900237 -0.67206306591108855297 0.081778257992812242172 1.3909138656385886534 0.47051480542869150714 -1.7132384150191337646;-0.19668894159222902185 1.4031708159824496374 -0.74254869207906182282 -1.5436336722990753323 -0.45527736290900810978 -0.28271794236206154727 0.46769369025051610311;-0.98040215931576424335 0.92538140998827123074 0.71751507446773998833 -0.63247067618965413516 0.91605285987699314187 0.28901716331856996955 1.1211987644587106949;0.52950405099577269041 -0.42334755471997054244 2.0662524690101533587 0.79723639498829435013 1.3627192180536096267 0.52333450319035934584 -0.06715400810671520726;1.0355563416627469042 1.0976949152497981199 0.68067059960683684583 -0.16157915781320086879 -0.5160717229366729164 -0.93721006575373810854 -0.73545327644670654976;1.0580102058556226652 -1.0257728458321595522 -1.5984868750964120743 0.10577622520918100735 0.75323454181274485109 -0.39023981839773036473 1.0365541511410403253;-0.041205486510172827097 0.12635871373013388141 -0.77900562346065072017 -0.25733983845834107473 2.0870320242549449397 -0.12763206395978518581 1.1109840837723885532;-0.49558428235847334919 0.041735830425989703385 -0.82499373998921610163 0.21324934845911980297 1.7577176086590027282 0.0041959439259151801865 1.3096571977180988533;0.50972921811027738226 -1.1388621466515573832 1.7307305599711968469 0.9204329014929447661 0.3965345724282753892 0.61919971518314720349 0.65438553132931720491;0.79422554123192923292 0.24581440552213446038 1.1125355899433981843 -1.1323303934931043813 0.44372901262981867543 0.33154277430682110861 1.1947233073095770983];

% Layer 2
b2 = [-1.475850256710909747;-1.4356475905915513369;-1.1025323114219911513;0.58290857615142011028;-0.046924407587220925975;0.12377789801684248305;-0.36611679300685645577;-0.82108923832875058135;-1.1112502398761845424;-1.7021971301072253979];
LW2_1 = [0.24231877471871887675 0.62149895276013000789 -0.57987677096971967927 -0.48442162267910021667 0.11492734554871750219 -0.073658631913126423885 0.52584017735967325535 0.055934685625227249794 -0.27861886058436413638 1.109040802160331296 0.066910093719515548183 -0.11886003697125963052 -0.43372381000486615044 -0.25644898814520000752 -0.036153781138782037363 0.050069670564087377651 0.60780524395733070975 0.70815915634396953138 -0.13525035082951233911 0.27880909446799090334 -0.7617680224504926878 0.10002465437416344085 -0.051494851164559533874 0.29968608227359572194 -0.40951528110341844924 0.55105590086674083317 0.23048686357582318096 -0.15486700947201476053 0.44034752472978183624 0.38012852288141130153;0.48212795673367148108 0.069088976604461685427 -0.87604324305650960181 -0.16418339547417687418 0.23754442950700810355 0.082229984920241930291 -0.64009452276313316688 0.28106107944080155336 0.52016482696920374185 0.065886237306962469606 0.24016340504835737013 -0.44565403689170479673 0.41777416364653441327 -0.44700692475311537555 0.22553995257552811315 -0.29540721173234757435 -0.39842196977692173609 0.22411231715959456512 -0.076528378499993859885 0.30045311104979621764 -0.059975911653699170989 -0.50618457014060558308 0.04518417360816753825 0.54864024634529939828 -0.23378601206572988125 -0.31300282322962674764 -0.1255603207212196426 -0.30397273612659986286 -0.68195915931728146031 -0.31695240544905628477;0.35679906890106360962 -0.008582944770056066125 -0.46015197516452854831 0.64863297292872257316 0.43648565479453371729 0.041512603719020664539 0.083664751557405575566 0.33491154954090024409 -0.18768002775649808567 -0.0052233320145010486008 0.21748000244290213723 0.59701330890342230173 0.071337246392793429717 -0.17745262792099661397 0.079449084882513759664 0.078899124399311182376 -0.2515009524960279963 -0.40971269686502570506 -0.48662479717977080718 -0.13507968532957684293 -0.32770651557957042321 -0.12876063551719379996 -0.24558131481745426594 0.34828910452717581903 -0.014099927097039315765 0.17921179090345018547 -0.020401478974647155318 -0.62602237360365275975 0.10448372164021675623 -0.52817559088807120027;-0.26682512610291009292 -0.66410269777159991467 -0.25653476322399554332 0.40928058268992334456 0.22722893825468240547 0.24743520485062012182 -0.52693647839516410958 0.28846724263632828045 0.37013219856506596184 -0.32612733632667645356 -0.36161087898054877776 0.021173892101252572012 -0.30671249976323183839 -0.25487055637767702665 0.19481597282576973429 0.42265391766487436787 -0.062096477575463236709 -0.79335738218019224988 -0.012877261554463483029 -0.58916151199171107322 -0.13752886966409669234 0.37122979431795222194 -0.024341858588067949443 0.17624019643925606382 -0.046028278769786684643 0.015168062856353243043 0.20555395537301476838 0.44104534993429744816 -0.15575576366850787946 -0.18239772130529810501;0.27419986008169172642 -0.68368331407520444021 0.61721209635626450574 0.86373185516832107211 0.29354401542624308785 0.18418274950011104263 0.41615912483844985648 0.11209075148168626268 -0.38048437629783021796 -0.49415964634056130933 0.79413449435196203918 -0.23851351318705751869 0.50491158661654345075 0.47498563206970295658 0.26620540500939193773 -0.3731316774690331961 0.10550228697217696461 -0.28159950767751201761 0.20086401689083932531 0.40631366102090532566 -0.49682851707046254974 0.015668477067832909527 0.099082202456202583818 0.30110871388759363754 0.014338196108154109901 -0.45592209169306840977 0.021630979993595367272 0.28347270107535799122 0.11248764516616294173 0.37945962552807338541;0.53484272531473797674 -0.019871000355913895352 0.029960205165419299955 -0.047387058557006998816 -0.23059619276522810849 -0.31346384080854106102 0.39012574482477652138 -0.31228693194081330597 -0.23719464583785815348 -0.19871251604837758542 0.31324987881668509004 0.39412452270572873037 0.49354356236545721126 -0.0023123631819248965935 -0.32245416934685627863 -0.1942698218315695724 -0.45932940595326388067 0.07458349442050742073 -0.35409407998328318312 0.56254362861019269193 0.21407297313702378094 -0.58244416724510506 -0.54524286023571433279 0.6543484607006200271 0.65542831742408058648 -0.2610557762777280244 -0.11775852171883589847 -0.093861488646357946197 -0.68362044402158861356 0.3204963842876045188;-0.37201053847044301959 0.43963045926010096975 0.43715857353522574735 -0.099952275194294906702 -0.40921206528566234084 -0.068504452868423937328 -0.4710329282070706558 -0.28272408113933994445 0.61119577735721497547 -0.076336559097908041061 -0.25120218321089149427 -0.46426480894839899927 -0.45435915601062998315 -0.26292004015691200491 0.026001877573507456431 -0.15589018156292686057 -0.15917708195076329947 0.41620710726358361997 0.10100639177653519818 -0.19601840332199632622 0.65970507822259594199 0.19804171864499578448 0.0040661805223649993141 0.51491650515516484976 -0.1403495065312468093 -0.2120038104312927385 0.20516388327056175878 0.16913331848419055348 0.53203354346626374749 0.36365849923908272201;-0.11549268658300985979 0.24391465747693674704 -1.1464595807846595932 0.18787599438746957481 0.53258235321160163345 0.18863473400900379606 -0.3336924323880424148 -0.15685151441866609923 0.61441934855443469665 0.27515271196867269188 0.33113945363115310228 0.71023829814833272511 -0.78305084395441604261 -0.62915434082084742418 0.03276105277395269938 0.42489567454655252643 -0.3078549012264579221 -0.1200925467097331556 -0.49900874259328747984 -0.89126199434482678008 0.23590530486495869811 -0.44360937093239255491 0.29947117138179479845 0.16533970772908904157 0.34671602401490120293 -0.22430115319196308743 0.4742962758842447224 0.39414894249039011953 -0.29509902867625587009 -0.33728669535360100706;-0.064784343698516821952 0.35824223878673666643 0.31562794396734483726 0.63291761041239036345 0.12042246661641294037 -0.48953794324353216982 0.28789169308701517691 0.10283565412313926124 -0.064753187045279672618 -0.22423027979449014491 0.58057048730041227458 0.026299694794491908223 -0.17609823749556582917 -0.29552964527379932402 -0.10509035542713640599 -0.12204687074338062269 0.24340932363006867467 -0.027171923984171161837 -0.092568718106825598202 -0.12612951025914750924 0.28994296530123020439 -0.44289785042209345312 0.61179980520913934683 -0.19686419681604644394 0.33612668532145933975 0.67831586419866052307 0.58355501895398809165 0.28810970898338317259 -0.35311100137034356905 -0.51212896932651730264;-0.10656342211017119648 0.12512082829137591289 -0.11541078468148820158 0.38225632542604642827 -0.071855312391615716594 -0.37467977924052775496 0.0041867221776438687253 0.61477953125635320664 -1.1375403070097647173 0.24122927752992925909 -0.13241595484872467625 -0.44455790296030256448 -0.46220659079707104855 -0.57555697658184079568 -0.11940826519803665606 -0.12373579198143902502 0.22224457445612799678 0.34005916232760269313 -0.38660031033257385991 0.0030908970520262951664 0.28241313114727628619 0.1832175414444703887 -0.15475967643248694783 0.19928758690725262293 -0.10888435247797639827 0.3940741470709590577 -0.14288979121102995951 0.05079637507736708274 0.23720698339088919226 -0.50251614512900222298];

% Layer 3
b3 = -0.59300908949395869652;
LW3_2 = [-0.93073655887718464985 -0.97253177866718965028 1.0235621825668610452 -0.85396433110843628089 -1.1098441640236524908 -1.1613719945493210517 0.46226679484037147549 -1.2227989311537006412 1.4358893455561345665 -0.88758434688482334973];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
