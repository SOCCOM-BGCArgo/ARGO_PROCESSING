function [Y,Xf,Af] = ESPER_tco2_15_Atl_2(X,~,~)
%ESPER_TCO2_15_ATL_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:59.
% 
% [Y] = ESPER_tco2_15_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.9239541154165205;1.1268630782148021;-1.5160417675634896;0.66246171340614823;-1.6916201853613113;-0.97541430350248759;1.8209427705402956;-1.6839731381119891;0.66455581546071107;-0.54014527946878121;-1.2608080450753223;0.32810237818685395;-1.631338137990703;-0.73592821561657207;1.1126645662211088;0.36201943362529443;-2.9100587316513513;2.6608199878031997;-3.0517043735285729;-2.2015882166550562];
IW1_1 = [-0.61829673005309205 -0.29829043062635208 0.5233141602398671 1.0575427951960141 -2.6077765942081199 0.17799302337646897;-0.47671567725591829 -2.6283738338287517 -0.9506451484162145 1.9216480377038836 0.34310847054847343 0.4571528232851918;0.96732662392653779 -0.3597499485761641 -0.25628177352262627 1.4361491857704356 0.13045778380424872 -0.6546841072583699;0.058329336139326768 1.1357974559760355 0.36204052970176698 0.58901628313177357 1.6299902312001366 0.099499926693180224;1.063939514429121 -0.80003598906829332 -1.4034561935306147 -0.66428422912992802 -0.76660125872755547 -0.95845198500408402;1.619555216308181 0.22584846546120582 -1.8654886014294043 0.032803585879816542 -0.99378832230422509 0.1120967310880409;-0.41196742812351039 0.19827017549293294 1.7706638046973873 0.1279847212982759 -0.86863829169931139 2.2709501115985815;-0.031196317546309912 0.47058287597243648 -1.402363637204604 -0.37122398393119344 1.4974590098788669 1.0995334715941407;0.083475081918132341 -1.0397416531803154 -0.58652849576140353 -0.81499686904195312 -2.8443333670871853 -0.48617445500552392;0.2527256995584089 0.1880162244717396 2.4055840697168982 -0.028834094978272301 -2.7649778078865901 -0.28464591541993189;0.98202793808244004 0.69079584757017276 1.897616750017264 -1.638149945052116 0.95489768067476277 0.35528596928354211;-0.21794196821445311 0.49158686645088984 0.41073269700642429 -0.2975333010528074 1.5309182145900424 -1.4972249860951405;0.28518821504516412 -2.5163559677862759 0.26260392544822325 -0.80490526523463002 1.0304269909547519 1.3547830118710877;-1.4883900263656997 -0.18374455425379779 -1.804589168981457 -1.335178658695207 -0.0039225468947036114 -1.6426660301188318;1.4725813582053258 -0.47905804612339753 -0.42334560350616302 1.1901845786483127 -1.2269509902296389 -0.19542759951592545;1.0130058581224584 -0.99885919783568944 -0.073532572504493923 1.6506581097504143 2.2653816062230003 -0.37241873733284719;-0.93671030116854848 -0.52715342707888202 0.47399019332004522 1.8115705234564945 1.1048828967448905 -2.4975913503743619;0.9138130938563106 -1.3061950260644211 -1.4387682722703292 -0.10542070975916143 0.84720150483711987 0.3808661927553878;-0.93049026666585477 0.26005129519326087 3.7348428919826366 0.50992943800093971 1.9581225159181721 0.26594953664898019;-2.3108922669224143 -0.47477349854384532 0.10058602246150028 -0.30615412946797954 -1.7192105791861574 0.95899826457065507];

% Layer 2
b2 = [2.3885765914946973;1.9125500564449056;-1.1121375339430941;1.3730143022969095;-1.3663425108664611;0.66976455931738432;1.0228135361146473;0.31786292562242635;0.017381459187850393;-0.26357407135747402;0.61287139311552064;-0.67770603734214385;-0.17020580339857364;1.0061766657790905;-0.82640253817755649;-0.60011047730702838;0.76077979166511156;2.2826620146799375;-1.5012139055907647;-1.996764175973613];
LW2_1 = [1.7926717004080142 -0.39219807433803783 -1.0689511517428882 0.86943438949051433 0.13390171806640694 1.4826973934447298 -0.36213827448899266 -0.36036852001421898 1.2256509202667556 1.2512058012166214 -0.71412674645758745 -0.091570007775149564 1.3719489017536628 0.60680125077604452 -0.14693303541001534 -0.44928032480701785 -0.19223842686074372 0.53930639514280554 0.78743804303512444 -0.78159737807349328;-0.084186073503560041 -0.26182793857154518 -1.2649143750495779 -0.13288073010783616 -0.26602037166313502 0.48181857199313499 -0.35112027474624197 0.16547807829174471 -1.1124540932762605 0.44317382333575639 -0.59460832261554941 -1.1735859541452578 0.82014613144517168 -0.41903700533836169 0.90280787947824437 -0.69361317319332993 -0.65819137684543594 -0.36922631535616179 0.55261484451342657 -0.92889772314380725;0.24467395598841818 1.3004040359869473 -0.067290610446680707 0.16758285232985257 0.15357522068573132 -0.61428853637803205 0.12933796350899618 0.83697180953466577 0.6474193364481009 -0.7020087751846984 -0.27418351182537881 -0.3690972102071835 -0.75892500221515891 -0.2606180193887635 -0.71475649689002008 0.33396815990716833 -0.079605077470014232 -0.92230437452715097 -0.0070244796659151912 0.066708535716189801;-1.5320520072801032 0.3097286189985875 -0.0099554102046113899 0.78577208540544941 0.89815292509476896 -0.84531575255075209 -1.5806384995127045 0.76649787013318216 -1.4268601309458169 0.85233979640569346 -0.2210853555492697 -0.88654946327899475 0.31397199801724518 0.1572599313586793 0.35489644471953907 0.308942139810987 0.22105756906574472 0.10742462513173788 -2.033901383655544 -0.020461605146819585;-1.2359482717950745 0.12979264299972218 -0.029321435343650643 -0.0012380999388394553 0.3202772674093004 -0.88364743315279226 0.67449902362985192 -0.49022813024492434 -0.42491082356235099 0.95331831832978253 0.54799005246344445 0.69340417280915123 -1.4623378277700525 0.63975434969726597 0.0048394025463523527 -1.0954239659271574 0.14570565821439557 -0.16398851916546722 -3.3139881060345719 0.43842567496680623;-0.25579545624142647 0.69155812188761545 -0.44103124374478869 1.4491987492458875 -0.9174207153911178 0.85783771930881336 1.0919582140570838 0.87754179844701685 -0.22274076287766353 -0.78580835843177188 0.32171379106361747 0.29010356168907897 0.27048107573233637 -0.57191943916824095 -0.19178751080594825 0.30151717643123821 0.7728687318449643 0.55363427290994371 -0.35786367334417485 1.1926877395914064;-1.1237019710959522 0.24696631710118266 -0.33732494031964655 -0.43276114785164621 0.71276586370728501 -0.67191733100468276 0.76208593510608591 -0.44041744726259452 0.77088624055885024 1.3000472955429172 0.3045946487914224 -0.34875152522380859 -0.54173379300356983 -0.45813619203328865 -0.83306652524148739 -0.0041515396591686946 -0.20294613182909077 0.10521249806923352 0.31343867769728512 -0.1273316983151726;-0.92147633610543467 0.1137871897203124 0.10493969141173655 -0.44697684996814557 0.56857597138490545 -0.97896663895727776 0.29381873197091773 0.3750672688868586 0.84881442347877434 1.0557555628490991 -0.21157153070682563 -1.0357564205913823 -0.49625861627850137 -0.014963439086719276 0.58954067422700585 0.47951495406976247 -0.27234727846456652 0.4393420398901941 -0.94420550318184227 0.88943151950694377;-0.86818860779225082 -0.28640040323565763 -0.28259019368103405 -0.89163498883365666 -0.48939134910718901 0.27747583146078231 0.60049593260461809 -1.2271143643381157 -0.013647005800464004 0.25548259539740914 0.91862824888130579 0.077806653960575137 0.55053239172704493 -1.1037072285058454 0.96279020769827328 0.48459901755178486 0.48984105945622952 0.39635193581379119 0.6240299484584626 0.17828655655209191;-1.0641509131436129 -0.061994369962298172 -0.044446462131184777 -0.2854948470596797 0.078263648665101507 -0.36377077793401397 0.53790866991930808 0.11652135566180279 0.28149799485771138 -0.72902826684760247 -0.25906129248534354 -0.32042265160496042 0.16659976738820712 -0.075624979967191433 0.03903906274976672 -0.42066290483232982 -0.042848155358725243 0.088281465848138826 -0.72666510315948984 0.22946863597026418;-0.27633603948421936 -1.6286159944380136 0.65340071648615472 -0.90616395259311844 -1.3021393778164636 0.8206412507860783 -0.56833000232121922 0.28781971693871028 0.90686191908495439 0.56578050613481279 0.071161293369766523 -0.21500339957175288 0.36927650389488981 0.075282683759977861 1.3055402446879378 -2.5156897048936853 -1.0329532323747905 1.402819611303775 -0.75017597435277217 -0.27713011665984988;-0.1010052549413234 -0.6110725760697594 -0.029690329628484571 0.40607031960342838 0.7251642795463239 0.39490397006707578 0.90954910335849459 0.3722147230943082 -1.8003326275189744 -0.36126502503269342 -0.27803905586188715 -0.43525269721449944 0.6305241093016879 -0.26553637131999935 0.44095969485842229 0.91120993677903295 -0.6119485619335514 0.16308423395787433 1.0143857638564471 -1.1844799750079613;1.4832965086624765 -1.4289728921762648 -0.50494924556913556 -0.30228496407239241 0.027982656699973789 0.39451304951470412 1.4394134071857587 0.88314169735163406 1.089794826260051 0.24103500845929113 -0.48463922975910811 0.75391339389353307 0.66862940150629513 -0.66470423744977303 1.1282905440815079 0.1934379886154298 -0.37983630582475192 0.37435972898087033 -0.15118883472039324 0.6359563368573935;0.024687466641633894 0.26607867270221852 -0.85562582610158411 -0.092109496475011113 -0.026929091815324425 -0.063243828013763104 1.0537408585249346 0.22711370527392527 0.073011189306944654 -0.069513803366412302 0.71387245424698498 0.36122294919327191 0.16929049812856325 0.57999107879917888 -0.87433246689465005 0.51069716930544007 -0.096867152282359134 -0.24842353870863146 -0.053413552622286843 -0.85265401421233078;-0.019693278844507549 -1.0155931456596419 0.36535541636361679 1.0657337653747083 -0.27866047029846303 -0.54635778047041039 -0.25590094201918528 -0.139104225563632 -0.73422592687991906 0.94384483326320634 -0.46049112006889142 -0.90209877087893797 0.31002232746585573 0.43334643653786992 0.61808105304032002 -0.31017564162714217 0.36914952137601842 -0.71522314277883858 -0.7264374153967923 0.58670523189715917;-1.2264248009110787 -1.1729715632193152 -0.22552514254600758 -0.44135239866307724 0.27387022731542765 -0.58085933210641305 -0.17661416008963043 0.76142584646954103 0.38051237078040179 -0.76340832387335633 0.60257119071758114 0.18419061953898769 0.54150059789491323 -0.069566668735665291 -1.229297959246781 0.098926059131719479 -0.81775458028334547 -0.98541973551431972 -0.42269980378021488 -0.54396287503792096;1.2021969404442068 -0.088349237807476402 -0.13777146982014898 1.1719451000068222 0.096937359056727873 0.50459232538574372 -0.43062359574993342 -0.62862117982228694 -0.023841397310136202 0.088806387849031332 0.23447349584835611 -0.39543433232100245 -0.49993497853442359 0.17350525154283797 0.1419234352569817 -1.1085932887087635 0.0055424782326141189 0.57086742643972066 0.99786148645815465 -0.061975551216952467;0.99646321372952518 -0.56618890524794419 -0.69934236675537453 0.0033300379075998868 0.67207046797264225 1.0545053322282436 0.85356867168696782 -0.029456269355526577 1.0561172388936573 0.35894310292636855 -0.61060702510132392 0.76920093880545226 -0.56978123276079662 -1.3469774650382713 -0.9723614423468161 -1.1243736745519799 -0.7404112649891943 -0.1799214298738398 0.26131191859984881 0.016823229625112766;-0.59579745290579567 -1.4495087720937054 0.082601248883177825 -0.68831602564314676 2.4798997628018014 0.5522961845632457 1.0512485433918139 -1.6682623570991688 0.90992002528401772 -0.26881522621283099 0.39389480391684994 -0.3879145843765216 0.73400627081603131 0.29031474537391011 -2.1003092054600714 -0.1245699972486581 0.71371702179828456 0.31497680714255161 -0.523416511126927 -0.20261628863176737;-0.49550554221427234 -0.22046578562116811 0.37065563335297347 0.22247095364359734 0.18001062332223655 0.071556222093368718 0.44068640147956206 -0.85024818908896083 -0.89195219701974948 -0.26943668644605828 1.2718576706368998 -0.19412196963990636 0.92348271041809415 -0.38531627189191986 -1.603511451255103 -1.1827000519177293 1.0879964608259374 0.22294297683238287 -0.071266686965011428 -0.60436672159438876];

% Layer 3
b3 = -0.32827866657679294;
LW3_2 = [-0.1479438923825285 -0.42895969461690975 0.054127185088047647 -0.042794235445646901 -0.10067185355314331 -0.16948465167017018 0.053098658229408811 -0.057832175424057206 -0.0048464363185252435 0.54250452417822026 0.05390223146626464 0.10478125457375125 0.080714290783755846 -0.049705207179181081 -0.84723487470840997 -0.05177188505179893 0.40051261289825713 -0.17530354966055775 -0.96788272439560941 0.041902333898535982];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
