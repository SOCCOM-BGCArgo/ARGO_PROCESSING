function [Y,Xf,Af] = ESPER_tco2_6_Atl_2(X,~,~)
%ESPER_TCO2_6_ATL_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:55.
% 
% [Y] = ESPER_tco2_6_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-0.2178];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.0461352500991908];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.47725936075680919;-0.13287640453660254;-0.22546845349954431;-0.39227494529649232;-1.0497707992638681;-0.20144988554664445;-2.2046380414579074;1.7749086097414011;0.42003266825622976;-1.6458293042837429;17.714922344149699;0.59718135200375555;1.6848584857429332;-8.607985405723511;-0.51755287362109581;0.11984436306120484;0.50355030922208599;0.12071127933597781;-0.14041057521393377;-0.62535736438521305];
IW1_1 = [0.11360597086753119 -0.054402937800211118 0.0083735550694193604 -0.047252534990840048 -0.66018317460006704 -0.021886492963664742 -0.031970008988737683;-0.022980143053150374 0.038184294143234661 -0.17461370142164545 -0.072058967819750283 -0.80092196208374822 0.17172974310932651 -0.035774503327536518;0.077366852672111033 0.25131157701275159 -0.78921536900626255 -0.069746510266701464 -1.7040211181929759 0.55841962386533761 -0.13317733696438916;-0.31350146219982594 0.17450725896726343 -0.078132680298407836 -0.27531479576200379 1.1839558637938874 -0.16984182695446517 0.22014473755966835;0.18415317905930637 -0.12152115407647363 0.09200064871255903 -0.062144717408735388 -0.30328760335427213 -0.39156956970531465 0.11918284604902771;-0.032654761476357728 0.062420870400772439 -0.23323351178983145 -0.09640220516685459 -1.0267900140966371 0.20703179920978229 -0.036158379748976968;0.43338306006715926 -0.1565295230707156 0.092322345476432255 0.032368953653167117 2.082737050643177 -0.69216413965640788 -0.24890232949694807;1.5375932781981791 1.4952842895909484 -1.2857878928509219 0.87786360099918426 -3.6392429520227054 0.69333530046693037 -0.44907908049494816;0.065907364598958462 -0.10324805725020832 0.1919520459297151 0.02861869416736738 -0.68456144496297688 -0.050367305367202679 0.0047232433116059696;-0.45747097719005753 0.28214144765012472 -0.73480875446882365 -0.60452632250030613 2.7482199737835855 -0.025544805594028972 0.58868514860338739;-0.29534940215975697 3.081158687735349 2.9936121874075265 2.132098088211138 -18.077207142030446 6.399008847428524 0.69797550680441567;-0.39266700892749579 0.047221407073911606 0.0089338168524649274 0.082488897602442726 -0.81433730149064498 0.53474221428550717 0.051717146709051164;0.71229379625449241 -0.1902410569064838 0.07811218670586384 1.386425882821064 -1.4527612811775528 -0.69452009412821092 -0.2389667328727948;0.2600605187778936 -0.12813626694338484 0.36999778533065564 0.43399428010613472 12.210171570262363 -1.4466496776608728 0.22724625023755035;0.2588018469895938 -0.047424758906416925 0.005680262766553295 -0.069863773129945114 0.6465029199320671 -0.30124724867894365 -0.062033465241409076;-0.43075436340875223 0.012118938093468814 0.22297909927472359 -0.59585683270650069 -0.76789422718189915 0.51395931807530804 -0.071794298116211741;-0.48341031199435919 -0.19109546303197747 0.2255738469679355 -0.74789673322603822 -2.8986343660143485 -0.045331419421072196 -0.001469017450059713;0.076943771580079562 -0.21786006579687073 0.15363255736072751 -0.036771409230875574 1.2825181297397197 0.22475292401220898 -0.16661291604916484;-0.081285158119556833 0.19852725411332808 -0.18017813448953912 0.010170571780002753 -1.0992751915053407 -0.10171134739276629 0.13281114231359784;0.44444473300566339 0.22610149432969662 -0.63300933414636396 0.39909037030051081 1.7384762658115229 -0.31940722396591481 0.10310648510046816];

% Layer 2
b2 = [27.222469661711074;36.114919717397456;-216.17290982126002;118.17804573998968;181.33846468856484;-270.85837521343092;-175.94337522324255;-317.14685597358158;-3.4395279030516934;-15.619056994246565;146.52710408864814;-119.18760031603554;-167.25464111018687;20.977693028036182;-39.308931118858503;-5.9629163209117788;12.6131522370839;-95.004880434056162;-150.81995276501451;-282.50829067293898];
LW2_1 = [29.583059458095327 -146.56791851079203 -19.589122104481614 -8.616003465608074 94.781888920943544 136.29138138967153 0.2941297188404276 2.3723909284321998 -51.339628972793562 32.004784892735046 -2.5821828942958049 23.509012385109155 60.780957908951443 1.5057716180619241 66.642556873333064 121.32563453442356 -10.685898459220407 98.876372906680956 77.66390310519607 7.3596387152135492;-149.13063304115934 29.02575920263477 -51.782386431123925 -91.629324036299522 80.736552840810134 35.367627272380538 8.9760206560053017 10.579524265576595 69.748539154370022 -3.0868794244048701 -2.5407600282438683 -22.483837160426052 -76.387973955940765 0.62913230270290077 -16.003661080431097 -21.71565063928896 -1.9739497365998042 142.76279877073625 40.535394041591779 1.3348451147576621;44.819606476643507 16.739427215049478 10.654316052181557 44.652484688752452 -118.91710993249879 -120.75410016990533 -15.965547496276098 3.4829526054542725 22.709140795925364 12.886290989757063 0.56126425426849946 8.3418783895263751 22.792346972578027 -4.056425957053543 33.843294807584549 41.69575457901297 10.744743022297955 -4.2317347873925142 -36.170039242929164 37.928201695585599;14.75314674289033 71.205125824848736 255.33514508217405 -45.128209292173949 -258.206149818065 -31.556802709271686 -28.40690437484179 -6.0769593248072384 -21.783195375354509 2.398456401066059 0.81776137147571692 34.489432776407703 66.547462596120582 20.74745247793653 128.29548166784951 37.709622984732121 -44.802425948296936 -64.171757440567418 35.363970140627664 -26.316040446160144;74.285771056201838 -46.551995415965848 -58.935306669696537 -107.5410787093859 -73.265356625046905 411.03748059141191 17.089726144320768 -81.847106265417466 -92.279715611973074 8.6898516265701584 7.6495005702478691 -56.892935608718695 13.181625087966582 6.2123200794242655 -105.77730197795205 -40.831485067804039 14.790095093366382 -38.429570181153572 -25.901007305081716 -18.529347704123637;122.35277166234667 -176.38049978336292 10.782379276375517 -47.093954539390332 -108.63482449889575 -407.66958057483902 -81.893433309256039 -14.782144976473598 -91.557039757152509 -6.4452065164176657 -2.5076749732637182 -4.4486928818036153 -63.375283265941661 6.8390698560363274 32.983729365381784 47.768435402677611 301.30767717323818 195.2947733221458 201.63313921238091 137.74389064332246;-138.42861807222781 -120.43303969382082 -248.2385983169529 -152.03457222352614 65.530435696501186 -102.20065604819938 174.78730206360532 -4.0924901534620108 25.513896192039773 188.27192319018872 2.3940129251996942 -70.740955473560703 56.97938449342147 -32.273930547220772 -233.04269623539992 28.656845535758642 -110.51069210166888 -10.807471501180949 104.24515939881341 -131.38536175730761;49.169483710885409 119.73705514488772 10.49739672672413 68.951303810138938 -135.52990201852074 -229.13798986761682 13.638937975517882 35.903484943899286 -27.720674455791507 10.808388498107345 -8.4452149677793198 36.127187665602406 38.567392831984023 6.6406463607343618 2.8389284921352878 -171.15004276212665 92.333348811883155 114.54043025373403 7.8497245752139522 64.477081379716466;4.0020732178028187 3.8426497716018702 3.7942912406932656 -0.90388298459822503 -4.1355488082752094 -12.220395647014383 -0.12199967035177649 -0.31815575069534613 0.16393868207485363 0.64793103806779828 0.015019539604460404 4.4590936521176152 -0.42068074964300667 0.017092928601140936 6.0972253784143078 -1.9656059953288527 0.21230394323613982 -3.5200651447209617 0.65554773946980216 -1.1846532810555537;5.6701387792001325 83.990881592618422 -14.561217661078583 -58.425042000060003 -106.78833836421826 59.16374105719251 -73.512189819923066 8.5264752634946284 47.040085420232742 -16.604641392713958 3.5038061442564139 -11.267415644799712 109.50226783815503 38.365990289640003 31.902254572928552 84.467999131181742 -207.82728784759925 -44.145340022178395 96.938459112805447 -106.55949042060091;-122.64516380627708 -151.1069473321165 -87.604267730964963 -25.291936994173803 -63.349323945644514 186.7802610300115 76.140652532491984 -12.882916721592702 4.4650210679768154 15.471442622160037 7.1107869000792023 18.479765400055321 80.864995349535306 -9.2359142853016944 65.59520872414717 106.46281871051853 200.36363506874594 -28.77660160176465 56.998445942932435 34.484087197220823;120.90619679250642 81.77769149801162 -12.480424735859792 -23.748871198587263 -29.359246778054789 -135.73089482451019 -55.819265763128428 11.050857125187685 -23.407626760928334 -43.304603015149503 -6.5979795972186244 112.92634501426532 8.8847760487767093 -2.5995499299312574 83.9838497852692 -40.122209444678006 -9.3606660317523289 0.099245735973344879 -78.198576847805356 -17.75487549538969;5.6992185035475531 -153.13357414235995 15.433358159006866 54.770741393321153 -135.79323692894178 161.55586978689459 6.4508896702881353 -5.1397620605824175 87.170002261287479 -19.074591101182204 -7.6458748483712293 71.582686298706449 -65.842856653333726 -10.532134076458668 6.5090098702345234 -137.76422177786833 -20.982549259555526 31.129601499302193 25.034490114644292 75.171454043463285;-73.505791414048659 44.854631276682852 -22.955090107947797 73.565995109780445 87.962335957406253 142.03296134126617 39.549204181563525 -0.23290482500337656 40.80694486393309 4.2188942296804974 21.010842011795585 -57.512499363155293 -99.810660850302597 -0.51563057057282602 -120.26638507710611 -157.51507164181967 -79.309886396425284 46.487124265316758 -44.708868002938075 -39.127930273329092;50.527426732100182 -7.2106768798128185 -5.2758146664009935 -13.620124488060245 -36.564480062474679 -48.870707547152037 -20.099802621117156 -2.2797636302355664 0.7208079372024887 12.14148592843244 11.610868658809061 -28.001233285784135 4.337936348705469 8.4278625478278766 -20.794444706619707 -29.040999897619006 3.6586269502349889 -20.983811209116585 57.390772449159812 -11.544343382800552;-6.8854401231766795 127.2370333871885 -71.127966665780818 48.160897634624483 12.125397815649489 -42.139532503589614 89.795207320032731 8.8425646105761544 6.7781444246075093 26.5587664700735 0.83153132279876418 -21.695198087025513 -95.260575907840746 -23.714632734922901 -92.582828225793904 -147.65069486050183 -159.61605408898376 -67.991272714089703 14.030003510507791 -105.37735530264378;-20.468087601233325 26.891099496576764 -7.4247187726956652 2.0281364376218236 8.5452727298144975 -0.18190522335624035 0.66975008027804661 0.67783999912376025 7.8678654029758546 -1.2713979676740061 -0.027719676310269215 -7.9848848210258376 0.87034771184790505 -0.014091429438161995 -7.1861430977024225 4.2572710523614097 -0.57146965944526462 12.567774954648865 6.806298502080427 2.6308067854073913;480.93371133319965 305.03936951823283 86.38416974454303 -327.24661369441719 48.875058925767114 77.095247677421654 723.98024252866878 -169.85175453604361 179.86178743231736 184.23053955579542 269.23168355724465 421.36542034599239 124.85420373161683 -55.153774425143737 308.73990455528661 151.10643711430941 -96.687148923681306 201.89762810875635 -136.98040802865012 540.86235290920501;66.684354165398915 -35.961276209162889 18.018588135713085 33.877752248709903 -42.153630735993232 -58.411163326571561 20.392524078203547 -0.41441429195873403 -32.883943858939119 -5.6418226734062573 -4.7364656280383102 31.883432553405878 -8.2732577562274994 -13.30011730551267 6.0963721125252341 -12.675543579103907 -124.10355501912179 -20.451191402330512 17.254939628508232 -24.173519548430619;101.74526763820674 -106.00837005949246 -184.33970838368907 32.704388291150167 -98.241915694367393 114.23001404314718 -43.823265240732134 26.256983397140296 175.55666228156019 12.04890962390869 26.811244243510842 83.090366217980204 90.958056495400371 -42.74517178013339 87.932057264775821 195.50169754241355 -145.46696353413611 46.739978527414664 56.287722443427057 109.91171549165789];

% Layer 3
b3 = 0.47408860341698011;
LW3_2 = [-0.027859528838837213 -0.0021068304739404607 0.0084813576602630943 0.0012232573659242171 -0.0041064667621021128 0.0015617884546659901 0.0021354589563011023 -0.0001730000675561874 -2.2877846601722025 -0.0023256261078783516 -0.00056213374756674541 -0.0019012651743129858 -0.0016831743567767665 0.0030012436770278229 0.0049129553484665838 0.0031326150317189678 -1.1738702865946991 0.00010289976344708042 0.0063727319186295331 -0.00027681085078488108];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
