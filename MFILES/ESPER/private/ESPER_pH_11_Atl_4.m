function [Y,Xf,Af] = ESPER_pH_11_Atl_4(X,~,~)
%ESPER_PH_11_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:24.
% 
% [Y] = ESPER_pH_11_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-101.945317545701;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0054210015363163;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.5970556476739612428;-1.0878172969223030009;1.8082338038480871845;-1.5781357555102539791;-3.6937798022997032632;0.46689599206371429352;-3.3761125519776209458;-0.18270330536837040003;0.681117295217131824;-0.71749966318898972251;2.6019705381474200756;0.64782033130330574089;-0.70127151354879813105;1.3766905814571606115;-1.5976800512875044546;-0.49706116935201022367;0.31079421302881965472;1.7590233755383808401;-0.53394845139276148061;0.032953249415076761586;0.042164294110558095396;-0.92474565227548899404;-1.3524634078419408567;2.9177877685825452936;-1.3541767879674122543;0.85392819004591336007;-2.5784372448852383997;-1.7538674894558234918;-2.1961232793567848631;-3.5718783140546790378];
IW1_1 = [0.75784125698379589675 0.63752327437529765497 0.15434914347386927136 -0.467065233505341737 -1.1450364107828598925 0.16036893550958292165 1.479847188443126571;0.85225016144001985996 -0.22850283779116123406 -1.0671889232313973572 -1.4240390646450198364 -2.2024594319649897223 1.1630288147914611407 -0.46140575792552784851;-1.8526746509547895592 -1.688028085334302375 -2.2018209801947361548 0.96689637483719403921 1.8637735738353080617 -0.14247657101070979047 0.31593936224357677123;0.12533086161466047703 -0.76651513498114787204 -1.2474021146031477603 0.65921046706917352243 0.84831913672942571569 0.10136437570308905187 -0.34967857214963532497;0.7391179276762229744 -0.28466981569508931216 -0.077681175822888498539 -1.9867657624858796606 -0.66508410898776437747 -2.405503981278287462 0.21674350710660092445;-1.1183288092170378114 0.32844661774569705592 0.57291229361988349478 -1.6838815947874807843 -1.1963540931006437784 -1.756448470435510778 1.2727143683314874334;-0.41710543601141431003 0.82050429355926546293 0.20994854539828211593 -1.4500177277978025803 2.4548895784125797093 -2.5379166926115792613 -0.62260714587557419719;-1.0735753453925556133 0.076566845911080094744 0.44608541605670298802 -1.7473784744937794766 -0.21341437536778015693 0.57020064322201968743 0.64996113791674203775;-0.15886097097195436834 -1.8376130372512653466 1.3514596400866059067 -0.45744994478715139685 -0.80173968039117282647 0.37419810564272348863 2.3033222162489948026;1.5497547825187383275 -1.9435019111519136192 0.12297217085581022 0.2646368859841051191 -1.3848172782223995281 -0.71508768200899708312 0.13282042493940077188;-0.24852256301690889284 0.2300059915941184141 -4.3573559486522519535 -0.39047249790052274143 -0.27173216678284234371 0.39364182615981746505 -0.79335112298863430524;-1.1783814372414684879 0.63708061123560588701 0.26282979977538623029 -0.24044033294417729851 0.89787029233043247345 -0.65717268810258611111 -1.7648140028636678522;0.06342854420699624296 0.28451905525465903679 2.7428807931669560993 0.74388340757210535958 -0.16141200909296937738 -0.22035007162814168602 1.4454768004678686388;0.13537512994564981916 1.1567941554273948324 -0.64478716124091173256 1.2223811579319521226 2.169129272655588192 0.32480816644574256324 0.064055550144179462801;1.9008033473319578821 -1.9199976154936337913 1.9904897682023292571 0.081530775724026630091 1.8356289191780694736 -0.055030590112246181855 0.37028966767159016138;0.23705270908166178878 1.0125134391841559278 -0.82364239011477824448 0.70399802880698136853 -1.1953521561623727809 -0.074734839393835170163 0.91243211627583464818;-0.078066332808627764139 -0.45642123140360413291 1.8257156675517296485 0.83904312017691706771 -0.12741875389919157802 0.024624200455393777109 1.2328744745204389677;1.7049268411445215321 3.2285394080024318875 0.46401156624999684297 1.2369143649459690693 -0.36420076679022800326 1.1494896190052539264 -0.51156131319774189592;-1.3419750466946733791 -0.044516196096647302205 0.87460503138911238619 -1.0462733036098905703 -2.4659915740403106632 -0.42161750707464129562 -1.0607119673937823734;-0.90251987063122074417 1.3144622183758269962 -0.64465005895336902064 1.6579260358666556702e-05 0.62069189698532289956 -0.53183811560200622282 0.53731187256601253832;-0.071884983651586617515 0.2699062084363286762 2.3994525734637686121 -1.4284260123504066708 1.5189269273933780902 -1.404414955574502466 1.2062939937772314547;0.35370828671924481323 0.82318701320632958751 -0.33807307999182945046 0.72745839201067408197 1.6438292794493112314 0.1937447251822408123 1.7578104241440142275;0.36749501314532534435 -1.3459104572125399901 3.3039780069349031777 -0.39943791132260908494 -1.912894598712131522 0.023811115377862349801 1.7903284420501994756;0.51186064858504642938 -0.1044144683778181204 0.86774895170608778994 1.3369986939357116906 -2.1766541692331884406 0.70492333296091025385 -0.23311093937820559496;-1.2677926828015124716 -0.73700350002670445004 0.0096960626881365547663 1.0144297115272959964 0.97217227710414222397 1.3454936970877064972 0.011465736278117881833;1.1109920803514470311 -0.68430204628832824731 0.89665402756870460355 0.43539618587856188103 -0.55585573153230993793 -0.33630403898927391237 0.27403123180378208268;-1.6421317879266827955 0.8565132355157452082 0.49264608202307841323 1.0557163130496582948 0.39641285567960754532 -0.37364194651490140187 -1.6943980775992346643;-0.7504054576899366058 -1.1143706735212932646 0.31011583047022056592 1.4395400964713815917 0.88962606855430470532 -0.58749013076566625191 0.9160715383914665999;-2.2396702546314237736 -0.5184502277765444811 1.2127409076737316607 0.18012925748442193408 -1.2741757967031399623 -0.81171360843795137274 1.2643159359345699233;-2.1109192052290350894 -1.6447939182337216746 -0.52830922107408184729 -1.2081867236289656198 0.3089775555838743526 0.97637179370543447643 0.16099930137968396227];

% Layer 2
b2 = [-1.9757682860991230278;1.434079393297820193;0.82121160060930964431;0.43605039394423367183;1.0201060595352664517;-0.30692320194940053701;1.1072806211208257032;0.82035416619064660537;-1.7313649005309108553;-1.7828594795527785699];
LW2_1 = [0.81830662129671216665 0.20427654242714737842 -0.038773488982502865574 0.70907319714184202653 0.37562982797355193298 -0.22321895588375220698 0.38762987093979284214 0.010224106268470176812 0.85461370896797062002 -0.34054928917144788869 -1.1685497443972492349 0.88626199287546647554 -1.8080909143156436159 -1.2019214916051483844 0.15904760249997648702 -0.23317639788484828545 -0.025635164669906385787 0.3839326584991293867 -0.27049073423508135372 -0.56445746086888526349 0.5392483434208871218 0.6267045449597050677 -1.6790541032763526275 0.056799758851977140417 0.20662008151150684787 -1.2082587786633185445 -0.4759388243531251228 -0.52276571169079977253 0.59233905142910703301 -0.20625570897670469916;-0.47478960468105019244 -0.87272737537193356694 0.31477792349908378933 0.50528716257043582161 0.085418076316784385948 0.57122588927443951334 -0.53457655855662467026 -0.094535481924404168863 -0.68007136035111348527 0.37135834542188017604 1.872949422910305195 0.5341723609144160001 1.8103173593883261638 1.0220365095925056931 -0.18432532165024984039 -0.037007661870657113101 1.9001657452843476737 -0.28729779390327092603 -0.42797867437618791753 -0.27199275410614653925 -1.1054226870993435483 -0.25557449450476060759 0.88596017712918140319 -0.4437892022704247319 -0.72817053880695703505 0.14617358745666975128 -0.20512668849042378638 -0.32009609205837191714 -0.3639691517517143482 -0.082319875867611608244;-0.14592309684388077295 0.066739933007263760323 0.26993424465674759061 -0.25801388751766773932 0.49382720891181641765 0.099998947018828651667 -0.12663636807221767544 0.13764005218693844967 -0.20631382734251579869 0.32144445195517007408 -0.40950943458296690247 -0.01431699845685674953 -0.30064695809204178278 0.76068536405313680326 0.24626771128426599988 -0.37775860970053753984 -0.028049124042639612259 -0.040383758018634127729 -0.32994847897503937206 0.7830239316418547979 0.023451724096204822068 0.098253083901396906508 0.59808323249088868323 0.14567594067253425427 -0.28041258821555625769 -0.31822880462989383554 0.331581176915257958 0.30028222463743653448 0.36891359171367893444 0.17784547543390660795;-0.35655518932766572249 0.80167859587804857213 0.12680400660940446822 1.0198358521769119722 0.24585014759352982749 0.22848874800538634955 0.39402303855651388265 -0.033756970265236746487 -0.66927673986303581888 -0.25693890078313780245 1.0071682314198369124 -0.24688983883860754487 0.45495169833047838237 0.18955483792102192919 0.8231416310215098342 -0.12404867028459982958 1.3442194774763536191 -0.20144180571095549048 -1.158232017156645588 1.154311286675190118 0.69368542392859755541 -0.44262800460223511445 -0.1494572111886517396 0.5107732116493746144 -0.0063620207949483253973 -0.15067095449236808657 0.55410584619132430273 -0.47607124180419224668 -0.61687560533939067575 1.2183301156992689673;-1.1753272556228133716 -0.50412887937219019729 0.36448702666810139927 -0.30745925603520696257 0.52081674794882593105 -0.45548434576083224323 -0.27276796960681259918 -0.8453188218931603215 0.46176609233878423977 -0.27647223765948808483 -0.51185452431285471953 0.78489687931337126514 1.0200994663291533815 0.43711411566417879282 -0.76542234004425280247 -0.14716869829360657018 -0.091626394996095830714 0.1127474448105428434 0.071991735815560564671 -0.76796455652129380631 -0.035378544826818569824 0.62437020183306057852 -0.41527834479822084424 -2.5878074525619396695 0.41077398369389073185 -2.1661297372470724731 -1.7576841142930519357 -0.02099480446086510535 0.20265643576252392877 -1.6801438572363822654;-0.17289745450025637008 0.14992585607033923067 -0.49863554073144972234 0.37761875708034159382 -1.0940124307051160013 0.76193290991341122709 0.1753768048676838387 -0.042743350582425419792 0.63217099450471414546 -0.69380313000298543535 0.84203546186394284678 0.60990246356953981 0.72821922600620103694 0.39824755695147123769 -0.3809774843979079062 0.35544663808031307095 -0.35681970220895264934 0.082532720397383629862 0.46186832495799778897 -1.187008102892620709 0.35359705036163380232 0.45171661057715833953 0.070553752810912612192 0.26406120806543287305 0.17431660038882859642 0.63609389324315046554 0.47258208327753664646 -0.14081628808006119158 -0.338132774764992039 0.0017718541662396780634;-0.5568672141453815394 -0.33219089891782210833 0.069488125105855058639 0.058223158525563610544 -0.098059050723825466611 0.46855757746370901851 -0.070792474263083882136 -0.091014694311153720996 0.55552937214340580852 -0.377391176874737444 -0.14601994973318502269 0.34764251745296514962 -0.11196472478134011919 0.041908845724262122623 0.012771710273658001128 -0.51505314652943767761 -0.92188672103900304311 0.33050683874372549509 -0.43061300802445184877 0.074939003022802458398 0.15383181533048340128 0.36023465180000913133 0.89798639101010369057 0.12286815153400131029 -0.52407271117394660376 -0.20093682714003913148 0.63981195593695994184 0.70508489644221272741 0.83198249524020251311 0.30303782158180214701;0.34335367197881200285 -0.50304252620361289416 0.57027283238169912405 1.3430499468051420031 -0.35951589928146088226 0.6610887122625075385 -0.056798784285000382399 -0.022928125438176457512 0.12292093914465566928 -0.92531874363653865423 0.55782014754314535043 0.026862258121336947403 0.23942142639631475154 0.075882115946550379726 -0.51692099780607081438 0.60092334854186357784 -0.084904598186864327358 0.31369844639465011005 -0.94179279680796457175 -0.99842378475212845146 0.23026023237860349102 -0.30176801622872567732 -0.25222023821395134213 -0.19623525017987558661 -0.4862167636454140518 0.90800674464501673899 0.26513468981092186416 0.3309421813768146925 0.052972573694084493234 1.19123826435279212;0.23799907933803368665 -0.0094519995029547325405 -0.6874311256489481492 0.17910765845335274715 -1.2803524585579690864 -1.2374929466245225829 0.55229870967559302475 0.42434271005584106584 -0.56182034499116295656 0.15460847291460030895 -0.46186653722808329592 -0.98821416717633692173 -0.076190015515425826842 -0.80701784157436362577 0.08055069621660303214 0.22734224843188274856 0.52852939727295877859 -0.068296261189054505159 0.67458167254984213734 0.18667081168208768394 -0.4447754589569996031 -0.80197116080966823759 0.15157894992061676787 -0.029279741659808289356 0.61191761123945309642 -0.20524940116494089226 -0.50513199251551788027 -0.57386070314774040302 -0.85968691359833582233 -1.3209055135621974308;0.19055489989827414932 -0.28274166806037914768 -0.27700258783086811887 1.2656680937377475793 -0.45881116227919932493 0.55387321033739222997 0.1976730854056273079 -0.72538041329195401818 0.48077420772806550575 -1.2469978497099942771 1.162390302013217358 -0.24890794526720863566 0.27951165726551246982 0.08956797415466842549 0.53388725617272936308 -0.45986086157576971933 -0.025828976803922418237 0.63731133685359064867 0.33987123351184883591 0.011841507758733379324 0.22586272045972657918 -0.53598932114754771483 0.038491847345239769973 0.59934299398706480932 -0.48339359118834229756 -0.67314421384015343808 -0.67116126504885931237 0.50632589720101350839 -0.14757014279382901778 0.47413919429715822851];

% Layer 3
b3 = -0.68427559205512122897;
LW3_2 = [-2.2160977091753295554 -2.4165848666890470398 -3.0753493374032254692 0.88193473090111240698 1.7084857222959186629 -1.4668141775848495545 1.7362828169331494532 -1.4574388216010543129 -0.61708996767330559496 -0.51996597150337975357];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
