function [Y,Xf,Af] = ESPER_pH_7_Atl_4(X,~,~)
%ESPER_PH_7_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:22.
% 
% [Y] = ESPER_pH_7_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-101.945317545701];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0054210015363163];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.2545432827863156611;-2.4123131156477830572;1.8588361309002650046;1.5165707815595166341;-1.8472806389638740665;1.309476115062147672;1.5106460209919247983;-1.3120819752939656411;-0.91475693586030892845;-0.3205103694707056583;0.22352428738628685179;-0.34450907179220013887;1.4152846290046461331;-0.50003762666876250265;-0.50956964215464173318;-0.98449990788218699755;-0.79619724196690233597;0.29658904009036535232;0.20392966955150418351;0.53600399747906835035;-1.1409746295037057617;-1.1197803529228613773;1.8821756503655833193;-1.3963336940774377926;-1.3630865895315142922;2.376627370523913374;-2.1621629046878845237;2.0724653277672779872;2.4521202909036148299;2.1404568218487058928];
IW1_1 = [-0.80441685879751601007 -0.32130299881873891632 -2.7314758576770175047 0.83759598379564625947 0.51911883882786424849 -0.28249453330861074019 -0.089711195029949133972;1.0061579914256415513 1.0238780606928938877 0.036757264350490273519 0.95954204923283492601 -0.88080483899162931305 0.33623735414916788855 0.96522324246746693532;-0.94807602496605536402 -0.58089586856924391167 -0.33057492745773470189 -0.73579647455671870482 1.1033387427562992844 -1.4502603447430781891 -0.54242086341594764054;-1.1391646881960222348 -0.49385845567541186707 -0.88020314071559202507 -0.85079225470417074728 0.86783568077005524 -0.72660095554336767698 -0.95823129938871487443;0.77625005926704637726 0.0057098623522142538667 0.79688363079183077708 0.65441465690338307404 -0.62767776288386878392 -1.7386254077537037777 1.4630048352579720916;-0.92792219855471347323 1.3272616267168444448 0.51381410809809313633 -0.56182823596438169478 -0.27024677418861720035 0.33997912513858752348 0.23853864373385533226;0.093125373662267418862 -0.48145651442097064932 1.4896377806249838649 1.2206345143625123573 -1.3894100899124333104 0.44529116498223403342 -0.092413296034036418458;0.27650473360224087083 -0.877026189362156261 0.37104173690821073972 -0.97659077341427980024 -0.91182435274085904542 -1.1058723571082562653 0.73006252655931735962;0.87355244970629186696 0.52911704358318178976 -1.2505472495886438278 -0.98499094984543222875 0.35293028253738861766 0.61827715711072295246 -1.4360182442858562268;1.1782950800537386193 1.4245337795964314598 0.65761272571225426464 -1.2558178784960547514 -1.2530505542039584999 0.41421858430647884308 0.10263285633733754132;-0.28828016624060592843 -0.56934414886885631457 1.9416244000945204196 0.92879327967358260576 1.4150981586722068961 0.29656362315222661863 0.49501238654271578765;0.47523640603183170406 0.13941903633055865996 0.83371008175875160884 0.20984611815845780058 0.047648227810310729569 1.0731495491900298056 0.99213184126655951101;-1.2961168700136416199 -0.15507089346163177579 0.18380186139499166131 -0.23348155555570315745 -3.7736895453469863071 0.017753013223808324084 -0.25854675982166036574;-0.30888109423005577492 -0.59330074392398213234 0.77352221836285184331 0.67702342615459054631 1.1265031873011674968 -1.0428935787264492774 1.5407848249373485849;1.375886986941693646 -1.6237316205117768853 -1.693877079358586224 -0.49451597412536896226 -0.0061088731255457377756 -0.00066246670874745895198 -1.5300298087704955474;1.1477861737928412023 -1.567444205287820802 0.3766556138262331932 -1.0903026196221665689 -0.48697749270363605012 0.95199949706196240751 -0.45399911547913157639;-0.94189460737751706798 1.3625721615776096307 1.6604799530038172328 -0.2494237874555309542 -0.11576577388750013131 1.7426826171316602831 -1.8863386582860357521;1.114903368781641424 0.84355307753278707672 0.70953704856635479992 0.362951568283443049 -0.44336013883017066917 -1.5292925928801415214 -0.24348523010177830495;0.63624448604840222465 0.13180009670103398634 -1.5006217877316470055 0.84096464357069511397 1.1383821974908245878 -1.2554323126343200911 -1.1807939702290539685;0.48026028731813891204 0.35010937342989795207 1.2739811229134321291 1.1808973248090746111 3.0561325447173981473 0.31815593991548041242 0.087631630398080612165;-1.9955058613779781407 -0.58227651564683424734 -0.016259587185972052686 -0.21193384271560991583 -0.95873888782814231657 -0.89844057401934551699 0.0022964475762711905604;0.022665520525997167461 -0.44145561800007238062 -0.36632465001411995686 -0.27641723855881611405 -0.67762179057626603651 -0.20601416021288240787 0.77858904546845508765;0.2819287864209033545 0.18283095028895493539 -2.6876489328244694832 -0.41668032823468864612 -1.2242732326374030638 -0.95830223197523467515 0.59224463606431598794;-0.86050478031751020946 0.93283172034596062439 -1.0466095058263225059 1.0194726522088335408 -0.47818348250405950939 -0.79628343687312108656 -1.2549054175576335179;-1.2109852368208793294 -0.34428736930568143437 -0.96621917590571593237 0.42268485528743099389 -1.5198329584792222846 -0.069980804254255818408 -0.7886184353844312156;0.21038449217022806015 -0.17786762398384636796 0.68034439346040365137 1.9233630872086446839 -0.6255159931140154006 0.89467713223630429553 0.079696132387194737468;-1.1011042511340503047 0.38812159523234485148 0.98100356608882532949 0.60758133466989494575 0.30443564144128676396 -0.95360998538603902741 0.89564946907475084803;0.60633129549181552509 0.44186784840720544354 -2.6948203852421448445 -0.34926170157409763828 1.602861893196534826 0.59840510153310200181 0.52762793336377566966;0.41503781776183346075 0.4596019471241964971 1.1183861559102978855 0.57534357430469751371 -2.2192378423938365906 -0.62295163513346385464 -0.356996209857319724;1.1140745908145923693 0.85906919126672998122 -0.16883937744456462005 -2.0062561213721350484 -0.7796948456905330449 1.8543281293470381677 -0.6802526840708061906];

% Layer 2
b2 = [-1.6771112277986532924;-1.1531028536433689524;-0.91276823463322709351;0.84525694000542361817;0.35156146077457361976;-0.16315046435171856598;-0.44444773978193163888;-0.7441537396210655686;-1.5258564723610363867;-1.5806980097659988349];
LW2_1 = [1.0003027751128794609 0.54016551614647112523 -0.037070616900397590499 -0.3478527985325336469 0.3981520503549325074 -0.88125589552784211467 -0.21966061208828385753 -0.21051381966088789088 -0.18182492528605556648 1.3057802352017526815 0.24774285383457078646 -0.54647113931193957992 -0.99368037594758495956 0.14455108726298826483 0.41506772428681459886 -0.30169099161843726531 0.5930408450964181899 -0.6626625749209427152 0.31904037457726786009 0.19080855343358715803 0.38318891724960957301 0.22313122272188329331 -1.0441628613714655227 0.0020114071995417726404 -0.42216542786487643024 0.47606865358752603612 -0.28167394052564165285 0.40082834861702559826 0.25214119013369790112 0.1549761104108396681;0.2823795332780110745 0.36179006827362769627 -0.23607993157361603642 0.46274963038570543494 0.014497829361951049265 0.81232626485036973918 0.88577979007998219885 0.11593323860898321898 -0.25299117359426753771 0.11165871456661138894 -0.84743503129076969138 -0.39992584694122290667 -0.84990355706809372904 -0.60221931776587744878 -0.76320537758856976662 0.17774015483547350724 0.14634571345310726231 0.10086254431840656343 -0.11428792731433264074 0.7477647835455195624 -0.38559804971005873231 0.52502372243077155556 0.56215256145174163915 -0.094035982136979306967 0.10063115008134768114 0.65476609117932416115 -0.047385686849887462269 -0.42739252237530156453 -0.11937137754644915055 0.046403184245820947029;0.79630940789278781278 -0.38590244644407900587 -0.14126889344107673718 0.44776422351185707349 -0.65583327962836590608 0.43760701953867181535 0.45254571494798129239 -0.13584879446828312943 -0.20241103860832460049 0.023159481560793174909 0.23219076466002441794 0.75277413770140544358 0.42574677287792256353 -0.25905939907238828557 0.01786128719683666155 -0.021416949262354309513 -0.1128141033801034615 0.61734101706566280043 0.67299848797551609092 -0.030043040164301183792 0.25112207535923947166 0.044645768078810571522 0.66690302620277719381 0.17071306424781079736 -0.32023018832493732599 -0.2729297232903661885 0.25660845981603597199 0.95876929089650997362 0.42782013659927176086 -0.80286289113029729592;-0.26324868548559371417 -0.11060060371306590365 0.41257412123356085321 0.36112530281036386848 -0.28339168999950359318 -0.14306747140497474979 0.46946216905278764786 -0.68580387302349909984 0.10175633548989956867 -0.29840210821971258071 -0.42334180772046431374 -0.37470476120120488339 -0.52479410129107284533 0.58835459639780218755 -0.35766518910967831646 0.85976528884573222289 0.17979734055686952265 0.72617469619444696693 -0.15753327214092804898 -1.6060714022804563061 0.14642704326235661538 0.31744114277015827996 0.29556239262617522989 -0.51826981792967885543 -0.12465725441981584387 -0.056280098559263996849 -0.39479658391798033712 -0.046502140812309106233 -0.3220072469770659529 -0.26173829549507110492;-0.24494486539785409462 -0.42927492271893158415 -0.060744453302226907032 0.55061976425416847558 -0.13280778016215435966 -0.61938823438582935044 0.075022880780924838806 -0.29519603832971524904 -0.37942468306645577014 -0.33808391624492445393 -0.061043260292680298629 0.42227544494376068052 0.68156551486740590828 0.007567432764902287147 -0.0993602548542782682 0.36589066633964961728 0.20667436549911472055 0.62172260927560807353 0.099940445834482111165 0.831712190616332947 -0.21697662988449231691 1.0388849704548905883 0.46057778304401003622 -0.25861584275960569634 0.33281316025620577559 -0.6250859856823746119 -0.87712882344145459701 -0.41122797390488974312 -0.51010112849548538971 -0.29434955021499015215;-1.6913306586076060078 -0.33297093024257978788 -0.13984766946589993752 -0.20777645723342688666 0.21775481002757510196 0.77549460974515438405 0.29841065093130320074 -0.19622076778031946609 0.069837169071613469651 -1.4309278009549430966 0.0022125033430747120811 -0.12817582850999439947 0.56341212618161573555 0.67037707677684088559 -0.39607782090992010859 0.41968340375520657437 0.45291191691130999741 -0.23267755258823907827 0.45313751075710423377 0.23192516162026446946 0.29920682610201937424 -0.0032547251123390165406 0.29471691497518276437 -0.18216447000316740579 0.48976818541287481246 -0.64301862211793592294 -0.031529214725956808407 0.55260602222953403295 0.48843937086653138602 -0.088509310062039908695;-0.049042787686023006644 -0.26610436783341129274 0.079837018854512040167 0.69206340371210772755 -0.058052253069197937152 -0.27962617669340245063 0.76118506221691784042 0.088841333050709681007 0.11097259905076159447 -0.064098483533887973262 -0.19138565657694220357 -0.38848235804250469405 -0.74434160237897184498 0.30215269578648257243 -0.84502296375125429684 0.18099684240603058916 0.48264895304803451248 0.19601523396685016642 -0.25377507803022547606 0.13455552766923969954 0.22329155485457544139 -0.64857865317623775159 0.6086372097329483255 0.097819769735922171283 0.49077325472935912076 0.06889250714633246564 -0.81726461493138102821 -0.39023418569801865408 -0.85841071728882667458 -0.15315454346137788444;-0.205355735171825593 0.20071675985028605838 0.34974501204611735394 -0.32534544481274291217 0.51389316733554046834 -0.089710894359970164147 -0.50939636990690551066 0.46590015441496340776 -0.4087279565713459184 -0.028106693416950233322 0.2344224521596557087 -0.12375946893101824609 1.5054934195872420322 -0.58968806466975842717 -0.44747467223450798635 1.0696851101707562925 0.056648833566692771702 -0.58972577557798422365 0.090063651093780949797 1.0468108946383780644 -0.15327434887715452039 -0.035453930807136539716 -0.12478476520361575508 -0.30223507985409059362 -0.24672332827742077255 -0.92548502432025148146 -0.18967845571568200946 -0.021713595018909556678 0.61426682629102424826 -0.63936080618865931413;-1.3354513047379570345 0.27047010180280806058 -0.5287629456819828988 -0.27048947024864611333 -0.11659175073768233977 0.43631832256138658455 0.1192342692039523866 0.86416423910337203385 -1.460197177585444539 -1.0063369132964468111 -0.76029329782052490483 0.54188881973248437252 0.10294773415301643193 -1.4576382188956060748 0.36616763598495682963 -0.45902244252955820558 -0.020748112254477188432 -0.27694794358708163529 0.95247385476979040675 0.97933424006413272167 0.17096865072159200816 -0.87420648461960925868 -0.24289653893749921232 -0.1432943813944525524 0.0066924286399879691356 -0.41838224417010239087 0.93133898956863514496 1.2868613080259372339 0.011946176280839871514 0.16843090962670020927;0.65351804052494821828 0.38399240594244049563 0.35177955441793418156 0.063378473175032451481 0.64930481374853998844 -0.46200957885011595394 -0.70704315753764968022 -0.094250616439496281984 -0.25588638777521699463 0.65425269231130700476 0.023761007625818307554 0.46323373854187077647 0.17867904744229332059 -0.51790792867457879911 0.31161078198585767662 -0.20018345641074639096 0.224634177678383673 -0.092776185087596260703 0.14226313743403756762 1.0660071578452741115 -0.17907325110933053347 -0.17732699435652385378 -0.54738167221756428571 -0.71484554365543728771 0.16289233748750450714 -0.13730496580854570365 -0.27018944505474673523 -0.86758458417274197938 0.46154025111715413221 0.38213418585124370175];

% Layer 3
b3 = 0.56737971313221569059;
LW3_2 = [-0.86223514235024156793 -0.80393187763427520487 0.43964542254705846203 2.3040137575107033641 -1.4919100489816841115 -0.78016500675132693932 1.5361862895086835223 0.78232291347853799568 2.9627601263232730133 1.1671152651415401813];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
