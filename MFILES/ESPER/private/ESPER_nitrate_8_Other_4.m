function [Y,Xf,Af] = ESPER_nitrate_8_Other_4(X,~,~)
%ESPER_NITRATE_8_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:35.
% 
% [Y] = ESPER_nitrate_8_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.8760742209979333062;1.8340568823404106436;-3.0231133904727518491;-7.4186817482386091527;0.40741572222056449126;-0.72289034566637877521;-1.3331699452146748008;-2.5426132733965416399;-0.36312512308384065074;-4.1086999047965955256;-0.40940282407151268318;0.95587004697714350598;-1.2505521223161655264;1.2955352667429564928;-0.01371696950638729047;-0.069950516257533845721;-1.4166165267009236395;0.31022074959518708415;-0.20011423428175062478;1.9247273662440280706;1.8401559443702804053;3.9915682233999723039;-1.20363484871395654;3.8730476755204104045;-2.2215655823258257939;0.34858928565994168336;17.89104341984443991;-0.89079114666272996015;1.066334585163241977;3.0407984825216480829];
IW1_1 = [0.25119109655236426804 0.060910241590360028607 0.67642298137255274515 1.1513964686519717606 11.584432787333060588 -7.2986427799287225682;0.74669287870814304853 -0.020126831306540245853 -3.8033749480211205274 0.97274605497557709022 1.1895518735177992298 4.2852548828867691455;4.3734241555037787208 2.6203293940073666413 -0.09371190869497086906 -1.0127064968692560676 2.1783531017868456026 -2.0325447129320308726;3.0520765368858429056 1.1993874132926327647 -5.6124256108616767946 -1.2798797680219029527 -0.87681333179176312864 -1.9072420125300186822;-0.98900460854657135101 0.19330486621118322943 -1.2260549680325021349 -0.33630975706160814998 -0.34851295115270003455 1.2174103095852448764;0.25121242454154624202 -0.51045090066581466637 -4.0113402403265236984 -0.55018731215047100847 2.0911580873034076866 -1.0238257944657618292;-0.70155467194102749673 0.22724090661210988307 -1.5254955486410466392 1.3109470765857391683 -2.3932558157204506522 0.25159664807635512274;0.14198751826431835199 -0.60826711559270996155 -1.5043157925540582287 -0.50494571813386313064 -4.0304352858216541122 -1.1326415355664003481;1.0214579121837090714 0.23435452755780267209 -2.6178475653593364925 0.05538565828066758373 -7.0715343016505114448 1.082540808956794276;5.2363209634923997271 3.2226084939175576594 0.71450888360158426593 -1.6512613696088227488 3.0974872939484923151 -3.4029578699643940887;-0.175215100264315915 0.39590763551581004132 2.0687766326851479981 0.24955477272695983371 -0.074850634263270710012 -0.34899860198253412902;-2.7855235499117960707 1.3792001375878681912 -0.11505419851897213945 -0.24973633447747523029 -6.5060330948915776617 -0.7805064707544598912;0.38859349565967277185 0.24457527699998035664 -0.97453866954201084916 1.1964651396407144368 4.794518961785995792 -2.1863663000782604939;-1.3142765294166458556 -0.73874655457544280424 2.4081509694234433105 0.26192495506088198098 -4.0911082431827381356 -0.38436159995885865737;-0.74490408836218968691 -0.28436200434055214359 0.71040993220464210278 0.89593075319756865227 -4.0582031375324527644 1.2659937741556415158;-0.42091290471721437561 -0.038305206953954201721 -1.2747126885955846198 0.0039744641902549745702 1.8345167126707533356 0.19780855813565814683;-0.42443756671428140015 -0.54667710566817451223 5.1302158659065595359 -0.85866974887345648426 -1.9415879268206461816 -0.23266630110431155143;-1.1091245851799980127 -0.88274459045820119485 0.50446344605638182568 1.025687508558524641 2.6680068342730804964 -1.7126412119772826959;1.26984212205305802 -0.27098776938141005965 1.1596493273373229549 0.84472705403025627469 0.77559675341257983128 -1.4629071457701467995;1.07508090235400533 0.81273068968103967524 -0.47016609113579954649 0.83933568723657325794 -2.7189725423291171147 -2.1753113638630634519;0.76478939018166947061 0.91931529811674506103 -2.5748390448194511393 -0.45062545566956863086 -0.1334506489493474668 0.065924977738689063966;0.0026620032984803337905 -0.30319484694613907383 0.13225825221177736624 0.029065990572602170422 -1.6146767731698929982 4.8160857127748650797;-0.87685046247161857469 -0.59758933864702334926 0.62063266100168890116 -0.54444637558335173821 -0.60000419607857480297 -1.325586656880121561;-0.014527257186129455616 -0.29074081822778274908 0.42358335960121201724 0.099706753097348249648 -5.1798610169243515244 4.9796521984355059942;-0.70052369316103213492 -0.026797348774341575584 -1.4764883281290028805 0.37397338036562921548 -2.6693872957370170518 -1.729958498482648821;5.2304819727652533956 4.3703038301255672238 2.5431742021524836872 -1.3918907985564716867 -5.010064575850914359 -2.0398897733477490135;-0.30651059066842173406 -0.45771424402641802676 4.3748916471933849692 14.594779582783745653 -0.16300074704232359046 -4.2641499340766921833;0.5307105949285414459 1.0815568888018511906 0.39094724336924047137 -0.49269609781892209632 1.1363449108356358241 1.7632530208789733983;1.0883763581531920028 -0.33575900807363395772 2.2382997178496868429 -1.3278756229295471947 -0.8207762211831475252 -1.1369590722807296768;0.62742453358108640771 1.8028946702207697683 -2.6058399752783443226 1.2646035982671974818 -0.674700554287384624 0.26718892292680235245];

% Layer 2
b2 = [2.0779733096332533293;16.130851967925480039;7.7353258166965934706;2.706146601129626017;2.9722483955304510594;1.1814891342902307247;2.2293829315561617399;-17.149872355032172777;6.8077313834541932636;3.8075121065569246248];
LW2_1 = [0.90129715361595530432 2.3771778162896133324 1.1372903146498121174 -0.10718880867592761597 -5.9819869937762151224 -1.0404932139772922195 2.63400334181848228 2.5682187817290307308 -6.0487410075510474883 -2.7109690895797058374 -2.533305915440136058 3.6322004593359311642 -7.9130804363012696712 -2.2061733401209355776 5.3635582749631582899 -6.0518845555130456049 -1.0722172306710298084 2.2040984115978674573 -3.3670374614682931913 -3.9399379871261022146 -1.7135311696001767068 7.2084734940809003234 -12.728422750629022175 -10.105807514515660728 4.6358194872496483185 -0.6231730496063646596 4.9951137535366427755 -7.1725139885353037528 -6.2821389588952918359 3.1738292558090157591;0.92510169250018781106 3.4750237982180589569 2.6441324318964078977 -6.3222915680871505373 -0.94567928257669187087 -1.0607434228833712009 5.9203682278319540444 23.191023447725839901 -0.49678073606701422804 -3.5350779308273878598 3.0822224944781715372 -0.575715076817408411 -4.4714357079628035407 5.8869374167946704191 1.423969983662143779 13.515372189609376363 -0.70991567099488395165 -1.8209251638170176335 0.38251260246283452782 1.6573917158117579262 -8.8492409711083404034 -8.4023686411813169883 -11.398374614574711572 6.2444522424916151238 -10.173110146019704203 -0.23245578951393680578 -2.9290555033473637536 -9.8092391207033742262 3.3050529010174369837 5.1133222921710546061;0.4127824037822721559 2.0796466911504789543 0.094863870284966234081 0.91133075128560792066 2.4435993567173026619 -1.5604768129206965099 4.4777580793283240368 -3.5020422494378693479 0.74790081554741727476 0.3440731551909288477 -11.59988721951943802 0.22927900612001503311 4.6652250538190846996 6.6074933528650907633 -1.8613539169889969926 -0.55970367765348394418 3.8274730990127232566 -1.177199513275670073 1.0132935005191912037 0.01570464514759850605 -1.6268035445032555941 -4.0949120419637203838 2.6831953489767044196 1.0644413250739408472 -6.5026920214899242012 0.068364579123040308817 -6.8893907621803585073 2.0405570025312251836 1.3716646509602323789 0.30218147370990600109;2.6362754508295740408 2.9328218978986568821 2.7670841690307468319 -0.26603736472683486847 6.0933007535014906964 1.7492885484683040609 -8.0542595032220845042 -5.3045517786605609345 3.3188040974421815221 2.9089176169409518558 -1.6399958117420414538 -4.0417962139284782097 -2.8625415035835373168 8.4439303301163803894 6.2642214099618307444 -0.070136077976420532765 2.6698425685325628542 -2.1439023668061376604 2.6417014456109266796 -0.32874006421563967129 -3.6373148859760022766 7.2197257351999777342 -1.6641559258039733127 -5.7464667317356861176 1.8483419609988276378 1.5113558044538411007 -3.1285710804443089827 0.99135938453910554813 -4.2811630927689083848 4.4419058325097005024;-0.17467333656449401946 -0.32587580439658592191 -1.954733304695655427 0.098395051855331303048 4.9532671133223695747 1.8052520127905962166 -4.7260018424339609311 1.6313214600505701046 0.25173401579480342294 1.2933458806754025705 4.9679986414439865072 -0.25119657054334154633 -0.92428657827053251061 -1.2315893712602627996 2.2638125804400113239 0.29236771733148958496 -1.5100690475104181498 -0.78751077613696707225 3.4427904876762775999 -1.097520792894256525 1.7167667563394304331 -3.5032755059505307216 -0.079181630819575021807 3.2959518120700774801 0.0071247474797287704482 -0.14111992922623198266 -2.0784044891446971093 0.54394426294697773017 -2.4430358017455922059 -0.9409187116872054224;-0.8027125076711570939 -3.609105666195399742 -2.6460613436246589458 -4.963633628136057574 -3.8828703138101023917 -2.6571204567993813583 -2.7719261782394841731 -2.5046841009458180594 2.3509004916355982218 -3.6084378753150239127 -2.1376044759291232822 0.263183578020944553 -2.8009064563692791516 -1.2314150124586227264 9.6940698781577925303 12.071063383358540122 -0.35864564036519092083 -4.5821454258912623914 4.7985439397103171189 -1.3252522418257350889 2.9318321115247534259 2.8956190063270197399 -0.76253820504666347535 -8.1616678403808844422 6.7804448163775408176 0.081331330922571540287 1.5266210694504169787 5.041092168836946108 5.5312544105797689653 0.38188556575667453874;3.3749797375444998693 -0.4528318686461613729 -6.1987387780641709512 0.81357982102016324077 -5.7739503598166779241 4.7421532358737072954 -6.7218916835860680337 -2.3643183784260912716 1.8122773699172449735 5.9761554520542778945 10.748648037639135566 0.52306444458490541916 -2.2673234055998099379 0.44910009417918755892 2.8888242278924818329 6.3079253229972467309 2.5954314997490466332 -1.5856525625166060234 -0.87238276639618184127 0.072588115055270713283 7.5257060070668702068 -2.1395782523855428892 -2.8986412462669139956 8.5138122344085793713 6.4367898429312893072 -0.55103197316567054109 0.718067401141121886 1.9141097790967984693 -1.625640652307747791 -6.9811014605179737558;1.0582820295422734613 1.3762236710106101611 -1.3472398919939343465 -2.4303969501715920742 0.18025269038793734211 0.57085268479288420185 0.72665582218759994237 0.0067996146959189039324 -1.47855383664887996 1.5239830767095963182 -0.18317199038727685623 -0.27647156708068099107 -2.290226262849925476 -2.3097044766429601914 3.223507557841763127 4.220204714998193829 0.76986096553293359435 -2.3209635734518649919 0.37208033182280336737 10.308952279515228412 1.5163172485570359793 -8.9771739170236628524 -0.36072477478486653091 7.6750282923939643354 -1.7290928250667072508 0.063950589336902299853 -1.0328357349578913826 -5.7482028178264306106 6.153466943442477799 -2.1851501317668411417;0.92420016707133911815 -0.58121895233751719179 -0.61819560059948741593 0.30302037781047025389 2.8132016365441265826 -1.6461765901970430992 -0.72699824916398292363 0.38594084827263719362 0.36040070797786805112 0.38534871416606808481 -5.702196509235591293 -0.020856163682000460058 0.19108087533796691559 0.16326216418490416271 -1.4443396740983829307 -2.4870168535195849024 1.9827642192246635044 2.1504535470236398886 0.95438277753243294654 -3.4649902646180881227 -6.3671305318348210278 0.5085544998018241003 0.51013059669689586606 -0.75414576279591694075 -0.028109465206045253921 0.65238725112573081599 0.59518792644547835469 0.84951733372068605199 -2.0616524020078377255 6.1220939742932003469;-0.34213087936662311961 -0.74759594403601792312 0.57906631254529261632 0.64725097749430338112 -7.1577321795818065198 -2.28047169465991173 10.577044337382682571 2.2136671925826409968 -1.2822503658997672638 -1.5386703529575984639 0.39245187987621210635 1.7117456241403379291 -1.6766634113032861109 -1.1682865401255109195 1.4562515829676812018 2.393279477696742763 -2.0139925379254295379 1.3138920287207564996 -4.1538915543615448911 1.0321737378463000656 1.7871367347007574011 1.2586712449950159254 -3.331595364360426359 -2.0677710998008680399 -1.3853960492364405521 -0.1928330782211254979 1.4598784277271525944 -1.7467506403374315482 2.4635423387595323241 -0.25758223053795148427];

% Layer 3
b3 = -3.6414076689594119252;
LW3_2 = [-0.07277319112104276011 0.46868430276663519685 -0.081016462106296219248 -0.03505389795573528311 -0.47524904687718028118 -0.033631117220658951483 0.07647244352012451396 0.12973671876384529345 3.1987825323906280417 0.24383770325815562474];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
