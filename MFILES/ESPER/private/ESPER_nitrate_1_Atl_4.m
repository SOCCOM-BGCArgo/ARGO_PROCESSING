function [Y,Xf,Af] = ESPER_nitrate_1_Atl_4(X,~,~)
%ESPER_NITRATE_1_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:32.
% 
% [Y] = ESPER_nitrate_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.03;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.604229607250755;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.85068344931497730244;1.1950733578129297818;2.6914309687407267369;-1.903501054146574667;1.7482742255143928212;2.6288497217333746114;-0.29165126180556055768;2.6385481065287108571;1.7696535773916335366;2.0227944024214958851;-0.84991258748616060892;-0.91689642165439699806;-0.96667861471670968321;0.33847515731691651952;0.62771183191282386993;0.082697518217183962896;0.62123483990437888824;-0.80707935761378846173;0.53696464499189155983;0.6927946662131182487;0.10059399664506729621;-0.16796835152640776645;0.88880259535274142024;1.6624755905729813321;-0.089031008189553548227;-1.1767898480281551166;3.850271704515586535;-2.6906761873855802314;-0.4123615709966372278;-1.1910915813991109768];
IW1_1 = [-0.084325102261377168911 -0.28890482942221468177 -0.43846691561911721458 0.18783503759781075559 2.4077410946546318193 1.4803391428347951742 -0.89591892504342252046 -0.052371948938721907263 -0.57288937830892106007;-2.2705943797740339996 -0.43388463890078865504 -0.57497073885832972184 -0.62787722228540943092 0.9509570418401478431 -0.18888546360529265278 -0.60015596668086645948 -0.68359950368400679288 0.063529234337542012101;-0.33506617824786721904 -1.317570832574100681 0.52154767861343065416 0.34083311495335572028 -0.89743671458805052144 0.50138948254287263318 0.33775140908325318456 0.81667217464103214475 1.307502547095553469;0.50764156293237061579 -1.6598757977476414904 -0.4688050307634003544 0.74060166853782027907 -1.5704254861242952224 -0.31513277934354255727 0.7579401272551268276 0.71896031612696431612 -1.4671231845913998981;1.0645208294923242942 -1.7986607435704897728 0.63687201431055950884 -0.8068678763642543883 1.5788012534995590208 1.4666654288906888493 0.82580126764981354182 -1.0459230603721949571 0.30273537554432300434;-1.4331324647006355999 -0.32243630000290646187 0.56375738246832052258 1.3320167275614147595 -0.85552440794689121883 1.0130510809935784344 -0.19512929501366299556 -0.79644755559001856327 0.25722349284611839559;1.7899566643225899298 -2.3663670475262996717 -0.98698740290275066567 0.98026418267981774157 -0.33994829765972189861 2.0918465331486522096 1.0041881785421109541 -1.7277303574534303987 -0.20223031612869507567;-0.69511222481465562151 -0.63471861348987956841 -0.22662052238169355656 -0.26851783446333421512 -1.2016708166171925498 1.3089031183635466693 -0.74070654002874802835 0.11474492294675259219 0.27432144103765648824;-0.49435532852995983655 0.041677063107740032477 -1.5906719723245263953 0.013737389074594060986 2.605194827676716951 0.62796386795343217546 1.587657712527306586 3.2256886828914868026 -1.3156914283494427487;0.17067194272936311861 0.34196154374802917308 -1.3195368124328721304 -0.95002045805707979742 -2.7104175517245456817 -0.10538366101786263151 -0.44856871432811790124 -0.038994321020846600678 1.0667942146546041116;0.6888684224702790182 1.2765636942121039166 0.60296316822402351576 0.7035087932066950156 -2.2161799899847212103 0.7350780665968440486 -1.9510960010861400082 1.2059868986518971212 -1.3790948069508945917;0.065106568411956680653 1.6823525916476593789 1.1912036811091413213 -0.89937704637024440402 1.1556534555246766871 -0.70312082673712839043 -1.7543586690381536286 -0.8466889771034366019 0.55679072279774899368;0.31504822325509096448 0.45620683965231301205 -0.56455342759129711894 0.35065377401073843933 0.54017787307041786882 1.0055878406624167987 -0.52009916943750711393 0.86130929654003662854 -0.52352896055168562928;0.0051490402638421414044 -0.17427019080927758088 0.019369301455371176757 -0.40641432224052920219 -1.7802189050907051282 -0.18303317517389247615 -0.83402297554868976004 0.88314462611008015536 -0.50902277554260877412;0.15823607548318951999 0.035251882562545522326 -0.031515170319282186095 -0.435842926571249345 -2.4146717873354686112 1.8222016781438659105 -0.041051908264479637645 -0.87456261902274179398 -1.3676602129424482168;-0.46012865393521162893 0.2999822461165259635 -0.77786789376952913955 0.17292799015382318006 -0.5518190454033332637 -0.68964553842815101703 -0.77536905770680630834 -1.6664271148976703696 1.2466101207781872251;-0.37320399863738568103 -0.064019818812287646037 0.38915427737862356983 -0.12072587763961066532 0.30180744935644376881 -1.7410314013717453907 1.2579940215790859082 -0.85804153994143439466 0.74514345802931047924;-0.38467765586511376563 0.46755826495304059209 0.28508729599715748604 0.080518388371760021838 0.12695256134241084123 -1.6258192481420690179 -0.18983204552738286441 0.25057385739868670571 0.12193252428864863324;1.155381500933439165 0.41596685957125922872 0.71336368113840731287 0.039382462118438744947 -0.29807010852415849467 0.52654646160625506734 -0.061140087913538400388 2.264469084228700968 1.2648564489846891856;-3.0891299535871823423 1.1188702532031640224 1.1448464456962481606 1.2536855801521491482 -1.7635995589773836301 -2.7427217388863756042 0.067564206079861466314 -0.51996130849520916239 -1.2317943377852778042;-0.036911395846789638031 0.30487849929588117792 0.21197143578100322014 -1.0151138111596229585 0.87435131864545911906 -1.4385201176462432127 -0.85888161242770755255 -0.54726864676753173011 1.3258884322405708467;-0.023358300933421442813 0.22265274732712414529 -0.81182221407458432516 0.4782950253646407468 -1.584577001298796306 -0.45400470640489493102 0.15273200383996796137 1.0984744647897559666 -0.025785219221684752;-1.4246362840088875323 -0.091450758459356476515 2.1130463224650060106 -0.29400954290914083078 -5.3701888091535625591 1.5189067124677584353 -0.25078209390906486265 2.1242709548627334293 -0.88350748177547766549;1.0952027067080585265 -1.1056073021421259917 -0.95236792213142185126 -0.083903301574401345508 -0.96684039471624294571 -0.39122575059395858776 0.88262653334157548102 -1.6479337463141587872 -0.61423568177642728916;0.54607994746683941045 -1.1915539615472587887 -0.25872341503554602271 1.7928672572292514431 0.92121907084348242378 -1.9789758044087986111 -0.71217133725096026797 -0.32601593262497341463 -1.7436691715335255193;-0.51719195094098635579 -0.18138695100266166715 -0.51981889066514352926 -0.10841683701455026578 1.6892983011223017265 -0.085848150339051854107 -0.13414380332669986751 -3.2634187824723954741 1.2857580985506598115;1.0403997185105513523 1.7314576294983383686 -2.6566999354445894888 4.2966104128766762216 -0.22446427250441630674 -0.035922173368471463362 1.9109839559694714595 -1.3093406392817297235 -3.4826470216411422598;-0.46510873724074297542 -1.1854537401729892121 -0.72171725524212992919 0.26613631684085498064 1.207837227909437372 -1.1669945545535300724 -1.0027828497571467103 1.2574947441739328102 -0.36757820737975449576;-0.27827676372041387776 0.66832198988314861499 0.32434904678174825143 0.21737580238579490288 0.59700689056687195055 0.57952173249752358952 2.1218247068771605157 -3.0127982360807230577 0.10940895625607569008;-0.87025407017472133919 1.2205145271565958076 -1.1754094758925155428 -0.12108651402560303978 -0.7318579587452684887 -1.2874734743510949375 1.3847771889730835504 0.16191302096800930244 -0.31163089780253583339];

% Layer 2
b2 = [1.6148850289867699992;-1.8786933315779361653;0.6803290436149210807;0.18333506882699396323;-0.24072085032372572688;-0.25347290425298063532;1.1070261149158517888;-1.6579890681070108549;1.3288738609127725976;1.9682058879368959925];
LW2_1 = [-1.4489793186008548265 -0.33064436263960550466 1.0182710099875418308 0.73126691025085388542 0.15961404917554150584 -0.25418728328935330518 -0.059158039042472798652 2.2422481275937187206 -1.0188679727490550508 0.31230145685137916667 0.72699676221313447311 -0.18057751654131165564 2.2897666389408088961 -0.15226799070189073193 0.77948445997639448368 -0.68286480891582301833 0.98094580912354201185 0.2192830590196679641 -0.079315011669140941808 0.29228140611206926414 0.88343072791666887866 -0.73484311201115881662 -1.3644320484853276199 -0.79901906211023254745 -0.97288659692061940643 0.68833774120736557212 -0.40070531997710528982 -0.17749081858782356225 -0.852345490009065343 0.021624949520957382348;-0.48794892727175492864 -0.21516253184059441761 0.18620735524433484898 0.48364533114585972484 0.79398455905581377667 -0.27768950778844531113 -0.55021296364804483936 1.2136464539878104585 0.78788958409504017411 0.29307352655604768099 0.33247323558273816912 -0.71773923527937966149 -1.0560452336115413452 0.046897799067586926069 -0.061282615894352833463 -0.083701512033194869211 -0.91211131062635941724 0.079269096136323866086 -0.24249199773151233761 -0.34776842124285284319 -0.33783736448969614585 0.28147327159380203243 -1.1302307496684489418 -0.40251066193328782772 -0.68702909839679471293 0.045089374031786477737 0.10787967677810045286 -0.358357400982042551 1.2371343727286687741 -0.11580562791359066965;-1.4786893517965509215 -0.19905874304259596475 -0.87209153402538952538 -1.7885372449532124239 0.79633589389371595146 -0.58503128728836828465 0.42887438425010532272 0.63827925054495537882 0.38020175230809871714 -0.47675944444843504355 0.18614410603842862502 0.44277814107968133106 0.40911293094807510418 -0.94083820864400358186 -1.2824247731669968786 -0.4357926353673587383 0.37608968814413340498 -3.4687329586403938819 -0.71173594021847974567 0.21522045738644340895 -0.96527954014602546096 0.71918703900094693715 0.90327530183262305652 -0.55133280997722178274 -0.23719225581947825376 0.20224565781553482946 0.29244095661402430553 0.54386532469498982678 0.22278399132036949548 -0.17217659106657945411;-0.64096902703055946837 -0.0484442133942600342 0.47127384051669302112 0.34569491168806726344 -0.80286445386555915782 -0.39227160835068031197 -0.063305993877713323537 0.54828220717611719781 0.17668118925304721056 -0.30140684195824712921 0.059070093461025645343 -0.18419534071511819984 0.74164926284813226243 -1.0394586034419599496 0.55495934120926426747 -0.55511008558187935336 0.017492349839385114285 -0.48186901337948767621 -0.25010812377067886958 0.089705814477811895991 0.63210287076912374804 -0.13964883855284679348 -0.47013580696858092711 0.81051104048003197455 -1.671842889876687499 0.43606510401778825203 0.20136552606697821766 -0.033513341316240681522 -0.5103626733613066957 -0.41628299173896476937;1.7515235092971499498 0.93194287239208828399 0.52228502200496851327 1.1323445431396035321 -0.99429140408938720963 0.88724384519783328074 -0.43679844765772996018 -0.72714726170235877145 -0.16494569842404058213 1.3581337215178344024 0.0038863609502599646278 -0.50949567496117453835 0.21642458108212719869 0.091437447721316678084 -0.70779447105852533184 0.034982422683975548938 1.2265693081997277591 -0.042272074830568800996 0.65622564216548717742 -0.26338846274104449341 0.62168208433037885907 -0.60136329030177293475 0.045788808246977751037 0.96414391785196318363 0.075773419198978619882 0.48731288711960163429 -0.071546082464728752437 -1.3460919635601724664 -0.65122515113286749688 -0.021043306625537449434;-0.47157559888167716045 0.957548092167986864 0.66451936953659385132 2.2643139848337554554 -0.25539925406544822239 0.66089459421149954199 -0.96477775195640069761 -1.2103642394009044292 -1.230066899004756964 0.61777321297944098877 0.49509893949176037031 -0.54023643516244879148 1.6622125807827954347 3.3275927045369098067 1.4296638808698796108 -0.89401990263574182549 1.4631692666229598743 -0.41910145315107105723 -0.48071629043929559044 -0.22615515955350290467 1.7072031904373823341 -0.63116868605574039108 0.21367082225764075232 0.7536549223598070224 -0.43740623969172770513 1.372159075907764425 -0.098598842110698137198 -1.9321746190915198849 -0.46064753885121295651 0.15187763131322951082;-1.2916260958198810815 -0.60782234025993642224 -0.13654647913698411688 -0.11979104094372100553 -1.5775892589800175614 -0.91384274877921800595 0.02065867664511443838 0.5825359344848765053 -0.059272373120746270347 -0.83308267430439497669 -0.13691213617707481687 -0.79236750393984189955 -0.65231658556307492436 -0.63779035353970880973 -0.065726313500761357478 0.61703669015899542671 -1.1401653985135549174 -0.89584176308752783147 -1.0237250084004276829 0.10569141859242854598 -0.64412714789538072502 -0.12929842950496833742 -0.91217985033193305089 1.2221005575328305337 -0.70909689051451207931 -0.21071479722966107717 0.12252631119708075336 -0.34982848782079434269 -0.37757558426554210795 -0.58820320660270231095;0.83623129947868735101 0.24696709002641795139 -0.24139778973248546268 0.23517306427600048746 0.40972635851117239492 0.43658182041165860543 -0.42087031377657468934 -2.0388111330177185465 0.39916246726042747817 -0.59355798056540653995 -0.80089952289245125439 -0.075127747090054167178 -0.060941483014490656356 -0.41796564993513785069 -0.35059063775472493196 0.17246607581734635373 0.70672958861454593382 1.4160996550853379716 0.98667841202726469518 -0.35994680568064602033 0.16676291056196329565 -0.80401014026360650977 0.15031174548323308904 -0.092513629711654846166 -0.11263723483861093344 -0.051420686848880833852 0.20561399613384370721 1.5446849547693350946 0.21532922971536780365 0.80433982177925567036;-0.192556767343385421 0.025771246067830117649 -0.36156671323374561799 0.17274439253001366845 -0.024505185067739923555 0.59641911122121626931 0.55216152702366128047 -0.52022235706661879018 -0.044663904238559912208 -0.50191886739766133907 -1.199666842985841253 0.49122831468379768438 0.62688273775634906215 0.43891619846106239011 0.23922322294919051711 0.54541089955217991747 0.65662492252738569043 -0.36823345990919154058 0.77413221641249063687 0.18552740524932057053 0.43689193515733804052 0.071792164696944868463 0.62965977908468384605 -0.17977771827959412865 -0.78394863870054121158 -0.65323648642037401846 0.21642630830566336742 0.15928668164766357496 -0.02827512810639447316 -0.87900899709657254188;-0.04473119158840069276 0.016083294014848814601 -0.38729354960761852578 0.33889628166454510705 -0.50219222591904211228 0.59711008178900759624 0.51180391992194251838 -0.52139488066884676076 -0.2633047400504016089 -0.44471897014927874725 -1.4768409841265530691 0.49710520112934919457 0.2258366421070960306 0.29675442163247789384 -0.10872731220327390422 0.94840735716120716514 -0.099796247595706225053 0.15646155920975113318 0.78504314282649501067 0.040043753530082867864 0.11232162681579324626 -0.47443160062734540672 0.58653135961139779564 0.24033776982655430388 -1.1701121450932812085 -0.93256921025688199745 0.33834551168046533842 0.1067434732711425166 -0.0067953277920126849143 -0.8214045439869773757];

% Layer 3
b3 = -0.80477217594529926181;
LW3_2 = [0.54408992685017432134 0.79281733470063009417 0.45359180884815752943 -0.88072960446784143151 0.52011578609235342707 -0.27140284036315698302 0.48618815883566635083 0.27991997310805288857 1.3882605561692453744 -1.1879134224434486633];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
