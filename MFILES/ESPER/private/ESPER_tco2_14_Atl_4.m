function [Y,Xf,Af] = ESPER_tco2_14_Atl_4(X,~,~)
%ESPER_TCO2_14_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:59.
% 
% [Y] = ESPER_tco2_14_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-0.2178];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0461352500991908];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.7785117454259973;-4.9366233275456812;-0.26619262982774788;0.50440184380103825;0.64180915465345545;-2.9037063066004922;1.8457186276213118;-0.76568969748137905;0.13292122582002014;-1.5609157017727269;2.7385715664041586;-1.4748302387510506;3.6797637766374662;-2.9321357223017732;-0.35605864306785828;-3.5749681021296551;-0.079115085914413408;0.65774802247708508;-0.027287206663288696;1.3676677546356395;2.4789766821663268;0.72520502963720224;-8.4791997056130928;0.93621914542610685;2.9112774794414849;0.94949527291309788;2.4590676333179591;-4.5829599229413294;4.1043968207788426;1.6998700806984306];
IW1_1 = [-1.3263545793022975 0.26458104252030828 -2.4937105052847808 -2.7340072320573348 5.8273489861128231 2.1118784641371353;0.15576470568776785 -0.42591404493666046 0.060502039272540643 -3.1921547512866448 -2.079214173440215 -1.8992236083747562;0.12739439413014175 -2.6426978297212842 -0.41449751229061554 -2.7077419785744405 2.303382001092074 1.8067994327356216;-0.34998433826586017 -1.3852157380233816 0.90410365097068823 0.71182953727984388 0.44121940388167841 0.9568950719769368;0.1539946515184836 -0.65327495859622531 2.2516536439799184 0.087753926469522167 -0.081455682125167503 -2.5443953464954343;-0.36731308163177095 -1.8759546479658289 -1.8313284832592609 0.2682472987967004 4.7675225613132453 0.6353959319892365;-2.7351330826386828 0.031702349517959541 -0.46306517332040054 0.2266023695736801 -1.855843287282519 -0.16839892484191599;1.3041608391525186 -0.37775822164716782 -1.122787708909494 0.25263764381240367 0.18112888010865411 -0.063023987065621498;3.5589139900004083 1.6693873848500753 0.8445097164119072 0.43016277316278562 -4.5551879719973662 0.008131931274357353;0.33740197078410511 0.58368746712195496 0.4426567146151254 -1.3877665007418298 1.2456414699724732 -0.49651225959547185;1.0703426387194768 -1.4996724328373827 1.2279783346607203 -1.2976249025060116 -0.035202354264659577 -0.68397043283999848;-1.6839439164764582 1.5372696149348315 1.3127127614062994 -1.465426434845122 -0.51769904445844805 -0.37373332423168815;1.7216075170758611 -0.39581523700387844 -1.139338612728731 -1.0171702025655385 -6.41868096810793 0.76700200940214225;0.67403311071206073 0.012941768381501908 -0.30187718583183865 1.4902958669171524 4.3700456443535618 0.79752552026293866;-0.17149165226785024 0.71304839229848838 0.051214307062689757 1.716879488621861 1.7536928731954902 -1.8701920998745727;0.7576393996998716 1.6020505662036377 5.69681894596481 0.06856509837905235 0.4940366067199729 -0.098878986978976097;0.62203447452967853 -0.70540160243322192 -2.138613695101744 1.9078015493291722 2.0971193059583251 1.0438578052072627;0.70718814467387903 1.320525138801478 0.04897063783185944 0.28801092485269791 -0.16324803742508551 -0.53782361734955697;0.74878240701206333 1.6271051044300491 3.1700901619076287 -0.19474054055031148 -2.6577455981028777 -0.33868158493513684;-0.82328881179476776 1.8271636744466158 0.85000265874969527 -0.2559000343804313 0.968784669144098 -0.2025068134842733;1.4523460424712193 2.9860458100169542 1.439852685687429 0.35416522846494275 0.38904732037168305 0.39109358562557822;1.1782259331076703 0.18742115667695214 1.0882093600968352 0.3787205239717697 -0.1696631154030703 0.48188067319617778;2.6792877285592742 1.764524443038948 6.1130928544943375 0.056467296816581428 0.92333369522307618 0.98947828724794518;2.251961003732041 -0.43347871153347456 1.1457269678550286 -0.91778555098460324 -3.2639478387366014 -0.61931443436488376;1.9005625855556481 -0.66788750851530465 1.0878065470116567 -2.2825477765521609 -2.8537280066030069 -1.6847619737620783;1.272612123217983 -1.1148216118197409 0.096095031780695062 1.2588708344232582 1.1602592199501154 2.4342062289069983;0.76623257071494755 -1.3746378727185582 1.2830019070621674 0.66317786922263022 -3.4073807442346822 0.78648622312223126;3.2057998107059822 2.7436385453481464 1.2674252474730372 1.3618727267458088 6.5972237244320473 -0.25129399207238479;1.0868867351123814 1.5061985298045584 -3.9532210715129343 -0.73712776624354182 0.41985037119690255 -0.046435663122810014;1.3049445170072254 1.852465440143209 -1.5466504115168431 -1.6768600066185508 0.18569406058214727 1.1276341242244559];

% Layer 2
b2 = [1.0532749883144523;1.7132003176808199;-2.8737730361222624;1.9321438518044602;2.0004225409423122;-0.1084600896560773;0.061082326140763518;-0.70616460325283514;-2.6488867228501438;-0.37582402713041152];
LW2_1 = [-0.047577645256218173 0.63191979504024198 -0.66722544999665689 -0.22676794335837674 -0.16721684388668645 0.16674033540906977 0.75148066682632975 -0.84169656991453945 0.74417427360241162 2.2282477094278708 0.6945464687691012 -1.7723532950476188 -0.2154791996602996 0.89168525777026708 0.13215526432905719 -1.2422323970826523 0.75789603914858694 -0.97442822240127414 1.4574504433651396 -1.4481904122231717 0.96976141463405041 -0.95359749877180411 3.150633124263404 0.65107333935876888 3.0942450533091819 0.28579232670536758 -0.50524502973410335 0.14396693420614248 -1.954737956023658 0.71064571189489767;2.2157127045743183 -1.762017824913203 0.10813892542191078 1.586165130640302 0.17857528689957308 -0.8848288154181132 1.015186696320123 -1.7578836561537938 0.12155413826733151 0.86533391338241894 -1.2565094614420871 1.836383914583902 2.8386315186061908 2.440146995842237 0.95055427865673603 1.7422687173312839 -1.4412728471370788 -0.26364219006082307 -1.9619625067663522 -0.40358919662616932 -1.3283553078753705 -1.0711407233950763 4.3453236834393207 2.0563079762588345 2.8516790188527019 1.2500037384677887 -1.5366842450615998 1.4994932831079986 0.24739525437932597 -1.5506289090190069;0.10139866757136454 0.45231520850348272 -0.70980983295477906 -0.6899858313482653 0.070660687215173573 0.42566986974904375 0.07522927953102794 -0.057918337368699904 -0.70214816841900929 -0.65749455351207786 -0.35358567449549955 0.49474855117044375 0.56031376764874585 -1.1468165615138719 0.84636031045670723 -1.1744402125726126 0.05546355602875655 0.95179709556741321 1.6631781830792856 -0.10449649988342773 -0.34433605599447531 0.19942798436260434 -5.4163136747153828 0.47634597896414832 0.2086565236015768 0.5379456293785414 0.15555276487148223 -0.27554379499045828 -0.72895833735211391 -0.67667121377326123;0.18957466552331095 -0.20674577404408764 0.35825168115213885 0.99898965990070543 -0.83623809165538132 -1.5401371272741471 -0.4582095834551082 -0.47217855843993606 -0.26264240403445283 1.1469547921646355 -2.8538724381139051 -1.3077639003337473 0.075811107657652671 0.35637296434892779 0.3846680778374385 0.38251940299985299 0.046736693085704689 -0.11942777959637486 -0.40706877658487339 -0.36764705336336123 0.032608149433900918 0.8505165281495578 -2.6353112590548702 0.80628315946386253 -0.19770547030570831 0.38783127199517753 -0.31314537606461967 -5.5934259638017974 0.88484262367095023 -1.3589910299753301;-0.040639510133699819 0.9648248354811384 -0.63674423932997448 -0.37816868725548147 -0.16245990655046766 0.014094693751629545 0.66369112266712726 -0.71120345063991564 0.66357982776346547 2.1281799334998044 -0.41975217007154669 -1.6523309899919121 -0.25900727896889802 0.90096217706454929 0.13088138907233723 -1.0340435774293644 0.71945278575917793 -1.1081843856645357 1.2022385377344587 -1.205840946845421 1.0446589592810325 -1.2549361091345945 3.107977493237569 0.63894657550554679 3.1597024043652753 0.3311342438182977 -0.31990172778284881 0.14717780966024072 -1.4255673049715911 0.63116427268079545;-0.77160402449710064 5.4222446309182244 3.2901188010024374 1.7271680043468653 -1.7473967567892372 -0.20167452542226066 -0.6173403386465901 -3.5289058606753705 1.7800071392673447 0.77999677190190908 -0.4943521753351085 -7.5626998057906558 -1.316643836090116 -1.0003748928597684 0.92086481500331019 1.1885134568117117 -0.75529453936198876 2.8279273187940421 -3.2465817144065898 1.4591104607955381 0.49131874254163826 -0.94031680201658008 0.131310304924114 2.6718649740289764 -0.83013299832410137 -6.2389229990601125 -2.6918385300217942 2.6030608868548861 -5.0037251904988871 4.3480897056834111;-0.21355897834189846 -0.26598053020098417 -0.11983503457859786 -0.1537033136204643 0.57731519793879471 -0.49050564388980861 -1.076633497368124 1.994036435636914 1.4109623539281315 -0.7232529697134692 -2.2463480983699 -1.1730209510055907 -0.98687069568650621 -1.1211473533483178 -0.97409920113127979 -0.49551726460459472 -0.7991056339012369 0.41231474685059172 0.70528747075769982 1.2430854157584319 0.51815558785609439 0.90242466011962075 2.6473899243880803 -0.026781177720752961 1.581527488656385 -0.90119967488607589 -0.87977562934857456 -0.5115390092261215 -0.24927669885067374 0.031423919393204054;-0.2837977711114934 1.2310580668076527 2.1684165441903178 1.4481869063242345 0.40929123224158243 -0.25530767074342892 0.2714035907539622 0.94960526950865365 1.3784892770947039 1.6980395881701351 -0.46740737092122986 0.16452284617795421 1.2992072577291316 0.059627649067593373 -0.7472447961364358 -3.0702653701229146 0.6260447382277422 -0.1186299504601474 1.6813284700353481 0.28659453811149643 -0.55990875920331873 -0.063131526381647277 0.2981135407559049 -0.56545129399909178 1.3951938444556122 -2.567041400132688 0.47697180386147242 -0.48468274837621744 0.21938995910749245 0.050800793249411558;-0.24350363689672791 -5.5637119784193487 -2.6065200511240345 0.34583770988174733 -0.11214516600009294 -0.89616712910906671 3.1038167922542876 -1.0482446564904071 -0.23345799697980907 -0.48701278048041824 2.6423684908678498 1.0926631214116713 2.8526847821320516 1.9309458151973824 -2.6422402882620086 -1.1862339551089256 0.57070272775974629 2.4036567854970956 2.5411376165541015 -0.59208443143266876 0.24851233314768539 0.52118001946137527 -2.2550614320391174 1.0269285321964925 0.31343642335661104 -1.1906323468095248 2.2633909160780941 -4.2658719851653188 0.9005157223493675 -1.8138721374532798;-0.48932754047701055 -2.1891762475224668 -0.72630513978505318 -0.68369717561899024 1.4191772042726449 0.22669596145075044 0.14967469014510959 0.29361385029702824 -0.91301055584483537 1.004834546547162 -2.7929144308652232 -1.6259592048157285 -2.6557074084013235 1.8236973590176795 -1.1172916723370028 2.1888941985267527 -0.26804000611998208 -1.933558109587578 -1.2863188947400179 1.074888470794193 -0.55922124814476304 1.8666567216149483 2.594915418170618 2.0950234574350288 1.4409792599627669 1.6870871946159778 -0.56367808045713474 -3.057220302121415 -0.29591518249547771 1.3747046954903033];

% Layer 3
b3 = 0.69195962299782288;
LW3_2 = [2.1734311609378256 -0.12753641173288024 -0.084803955859887828 -0.0045911600622438676 -2.1777545936465827 -0.0017932562989865551 0.033372165843848299 -0.010822017619807044 -0.0091030276851254283 0.0075106351294591412];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
