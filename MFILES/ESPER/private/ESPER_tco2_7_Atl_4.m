function [Y,Xf,Af] = ESPER_tco2_7_Atl_4(X,~,~)
%ESPER_TCO2_7_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:55.
% 
% [Y] = ESPER_tco2_7_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.0838037411780972;-3.8079286168517426;-0.72212406833456355;-2.2814383291355633;2.3655202007941627;2.8935988140087039;-0.1339157834386194;-7.5254108722204673;0.65180809891401204;2.1780957264034075;4.3306724740727827;-0.48936425955241492;-1.7258817770566341;-3.4107377513339801;-0.02543810430322354;0.39714504099403614;-0.55563752069336025;-0.075576540666138253;-0.88940405603986539;-3.1962913999882989;2.5222328802092995;0.40160111016568928;2.5162852061951502;-0.95200943477865996;0.42028510141660724;-0.56463482820573829;-1.6738110541863458;3.1601613101235526;1.0771862997409976;-1.2969812041655007];
IW1_1 = [-0.0088930132479654936 -0.48596329072288752 0.61048456355042147 -0.46153748076201895 -1.7985752056495961 0.85148839034082013 -1.222799251581931;0.37819962653685019 -0.76637569502788605 -0.32699248898119465 0.70218721340233159 -0.57156049680856291 2.8233047569683771 -0.32858641129468047;-0.1447051171597076 -0.002386768545239064 -1.1120557189688549 -0.91325843901796333 2.6676063075953094 -0.34266315252316998 -0.34747552767806406;0.28392547252447786 0.3324335034401002 -1.9434506845904584 1.2565045957155518 1.5853184702191097 2.4003921055113904 -0.75594089235599382;-1.2368342424695498 1.0336354778928734 1.1558697182867201 -1.1670454675295512 -0.24654857613509221 -2.2443894566674674 2.0202796944197479;-1.6434339011346704 1.4239389705590439 -0.75926724399055723 1.8481729752830625 1.5096540642598029 0.17437164450822878 0.48827812036545454;0.56319227242622161 0.91792590624627679 2.2228173332916037 -0.45947623224390527 -1.5846005200646209 -0.87841325733401543 -0.9939977467288712;0.41390627706982724 -0.67995865153152713 -0.9871820219052998 0.56190077038653641 6.410914093369068 0.18917387808032474 0.92662130889714656;0.75552338407857866 -1.2173886352683185 -2.5322777915434096 2.0744379763414473 -3.1210476717066555 2.4033729461876523 -2.335293803567617;0.36893563571440685 -0.90941149010568711 2.2490309962754069 -1.7068612056796766 1.3503994546474787 0.16937559699084492 0.74348606931018379;-1.0103093376661987 -1.8034942857232474 -0.50270805184438316 -0.70912742864563283 -2.9235521074127719 -0.73634104842323067 0.44777559960474367;0.68508724926062581 0.088093027224321205 -0.23255824601446837 0.14830162449520931 -0.053136578441674048 -0.46411499258564287 0.6385107341516435;-2.0504407808587515 1.6074548995424609 1.2541001100496425 1.0484981303986676 -0.58013707931693781 -1.59457909797254 1.5367465738049466;0.48046162925725261 -0.83259528508159364 0.7199023868725215 -0.23926190970509464 2.1459559691120718 -1.4089229971180071 0.52923858498504361;1.8415889774348724 -3.9004415222202629 -0.91181676820697344 1.078353492145703 -1.7492976971750351 1.0365660391121787 -1.543804455639852;-1.1384881666829347 0.4261273883766647 -0.50831650960064589 -1.4126863259557429 -1.9228723114207722 -0.064672538388122466 1.6344627863426924;0.95531642156382635 -0.22835121711278178 -0.17543714581016689 0.58761857768261028 -0.11316923042017182 -0.29274967780359207 0.38546783714513821;-0.51651668851938626 0.48381815236621578 -0.78799693210012789 -0.057711871533975174 1.9023800839801952 0.99208376957199307 -0.54878673255997912;0.75204054258369013 -1.0100788237652738 1.0544198956311674 -1.3779765424055055 -1.6413450693530611 -0.64726993290296497 -1.1986643615128276;-1.5598985620019468 -0.064421256692440018 0.66232902484623801 1.139481382687624 2.4210929000662458 -0.90127688851640597 0.40406593974744154;0.71497559269617239 -0.65650204860607497 -0.32622851460912455 -0.93064656602325624 -1.9686601794733347 0.935703259743914 -0.78555647139429075;-0.95879703825710694 0.39574028069087053 1.0637134057952442 0.043947822509625964 -1.6201037594531758 -1.7058715703678666 0.092661620642942852;-0.30122420039185183 0.42688901442705823 0.31715853847731973 0.48852317358566383 -4.3756798260231715 -0.43949628683789571 0.28269048221999926;-0.73471746537286997 0.92596204248452862 -1.0285758065782402 -1.6095437916423216 -1.9420480411231307 0.83698797230467192 -0.65428905230797019;1.540908852672719 0.40959812812856217 -0.70572235957994245 -1.6359195273559981 -0.1633955820888976 -1.271431138967047 0.71271489305141;-0.34603474722118693 0.48599419187533704 0.35490018758477976 1.9149224678327403 -3.0839432188344644 -0.86268672091830134 2.1162907942014324;-1.3092389447650068 1.0538740499248218 1.5476964101669399 -3.8074700580057228 -3.0036803468748254 -0.11235566439000368 0.054921368093748424;-0.36424751569497088 -0.29390256900459633 0.935627178300943 -1.1866425336497151 1.261154144152453 -0.22866019189486142 1.0864858568796656;-0.2442284779031571 0.88411307870325551 -0.14336044414677163 0.77995865842220891 1.1446353194457379 0.54266334824584572 -0.80980009594560176;-0.5320616605804368 -0.31457489777080561 0.38069834791418566 -0.71285907911683011 1.3299954058534478 -0.45469467623914833 -0.20038959084860342];

% Layer 2
b2 = [1.375309158762092;1.2225576092030195;0.67276259195700816;3.12729121820592;-0.24149463892019676;-0.67482692782466047;1.3423381393348472;2.1797544714372958;1.1574531393209562;-3.7232271939147976];
LW2_1 = [-0.55869512862715409 -0.63843419778906652 -0.84516763599338796 1.7882271524532012 0.28654893682495336 -0.11042692489834924 -0.45647551809807135 0.534786157766583 0.59584992869779807 0.8052569181711744 -1.5451370252328849 1.2454392402576357 -0.71033230656054702 1.2858484394365202 0.37436780794866725 0.68341342818466178 1.4994025715764183 1.4120802283849636 -0.047110834486138897 1.4375874062950358 1.1619790169953004 -0.18871016232237081 -0.068242544186995838 -0.74809203282575809 -0.24425929462858881 0.60798295620569287 0.99332655849290352 1.9317944493349219 0.84638027415856454 2.9344625702758282;0.37501613451778276 -0.30850363245322687 2.0659632107308474 -0.4272161323447215 0.69835887543667896 1.5536965750134362 0.97993150017932118 -0.74993485988332598 -0.24602726077036813 1.4223530050830162 0.24244784086731935 -0.27547445201355375 1.9057591157730618 -1.6884311135988734 -1.1714269913051216 1.2557081612298771 -3.4813295775906252 -3.1692088313703168 -0.42634350709212443 -0.90939187192726967 0.28665844620028513 0.85419111590269103 0.43222968621215163 -1.4758546911964054 1.60294207972314 1.4198128828061014 0.4942738696531051 -0.39584671423264689 -0.68784282243707362 -2.0354623457205872;-1.1546598036057125 0.89331311670666957 -0.62217634056186022 1.2159696189885987 1.1610708279419544 0.097149068020621288 -0.55179399985842525 -0.50943950878840472 0.70617324442804219 1.6107638771971877 -0.62234443205612133 -1.5539726589697229 0.17119077428396198 -0.77646840662912975 0.28974586640540639 -0.28785873329924905 1.8601086667893925 0.20372168230893578 0.4682779645816677 -0.77417748890402804 2.4922449381703453 0.74010907682153459 -0.21130300074558625 1.1531594167442467 -0.58091666422829447 1.3574052742427423 0.29948155668187076 0.095464656824648678 -0.95019019838841712 0.68371403662032104;0.75911959942044849 -2.0393478444302424 -1.3904536978902322 1.0565211039936193 0.6592265201091897 0.0083639181672767789 0.014377518526333415 -0.60767611063577331 -0.8779935830231016 0.13011183799836365 -1.1519449955567687 1.1825691211241007 -0.93839645935875815 0.67429821073610485 0.059190304247132314 0.31243314836830821 0.94387524906594122 3.6108012376615344 -0.74852964476092798 -1.0334102275208683 -1.5413982412312266 -0.663802769428814 1.5017080354699455 -0.5545011597845525 -1.6028443572555116 2.1646192992952074 -0.25069547846221546 2.4742740747230494 0.9197591539814931 3.5055562403187115;1.4399880041767781 0.32432669052198709 1.0016541781554089 2.0768391212687103 -1.1080847089639057 -0.045423115723594518 -2.5352472972371833 0.63543267592379749 -1.0977312045090022 -0.23409505692390054 1.1403717895568104 0.2270370721383031 0.071302694633693958 2.4915260976664921 1.6032166914232058 1.9738016608608009 2.1609678987295178 3.5747639734533165 1.0240936420764115 -0.28401679411460651 -2.4796742982821511 0.9739999278871474 -3.3542982968207009 0.22783251669555851 -0.36421472235573937 -0.67870598391504655 1.1793506900336419 -1.2470769629918694 0.46953397893211368 0.0068981627373625384;-1.8452592591458135 1.4607186568721795 -1.3314152147334599 0.011908372199394897 -0.55781750133532326 -1.3904953779779812 -0.35037978091482952 -1.9310379487318781 0.080395667046306907 -0.99474402370737902 1.3043587265500771 -0.39997791002674488 -0.61291015879474353 -0.10783808737487843 0.39511515165090999 1.2816564534040784 0.050293901235209444 -1.2383391225105136 1.0399471637868236 1.5661362717969147 0.71543232739644091 -0.3506153616591392 -2.6863865530397879 -0.93651465173696946 -0.246817051622015 -0.032802266438672352 0.75889745258855013 -0.56635026392169108 3.2989959495336056 1.0616118580793448;0.91600143971802228 0.5607770386753943 -3.642195246496974 0.49135106639073145 -1.1543917903582792 3.1672761940465874 0.056177689498230134 -0.3435125582131664 0.076640377746346314 -1.3401471566837315 -0.86636204154632124 -0.27609193677789312 -2.442489737744971 0.80545600208143087 -0.71551034524358414 1.2746437958245149 1.1245352360966747 -0.84674612019256845 -2.0652628708199292 -3.3160947406208519 -1.8438494586595648 -1.5087921480388573 1.0531009210821876 -4.2303846564130501 0.54419612935543471 -0.021779921787185706 -1.8545501403303459 0.27521760508907039 -0.44588063881355555 3.071043701451571;-0.84159260686118575 0.15699005402040897 -0.83400199294359545 0.015003745572230109 1.7219284428546142 -1.7966030053941664 -0.095380894792101295 -3.0348449898296792 0.95166942186501058 1.167166818055535 1.2267016215374136 -0.11197361123202121 2.4999395900430073 -5.2442662874468713 3.1513833729630494 0.067954116611855908 -0.059755068423076013 -3.8706646268663891 4.2812688533103405 0.10273077679879712 0.84848465409415552 2.3016470140917802 -3.2277482252140173 7.952048833525728 2.8265204551588243 1.8791201438729206 4.8578724861354683 0.54132577728120557 5.1399999506710428 -0.92055301153926561;1.6941032235243869 0.32387031616358652 1.0602859924192449 -0.20049416721079252 1.4056486306033316 0.041793031936252112 0.49084988589744954 1.2692137185007153 -0.32463372091897785 1.7288342963570618 -2.8604137779288998 1.1434586986140196 -2.0753891325048155 1.8044144355712213 0.095541907540636184 1.2109449571849025 -1.2543896310176759 -0.3964472249051596 -0.42053741230001107 -1.7265114414933649 -1.0166559007978855 -3.0336365169775985 -0.90625241620515784 -1.6778314912745995 -3.0163471297022335 0.74774168858742207 -0.34387863961537585 -0.71378538172754791 0.4256284431919799 0.19168666909010801;0.62347493474501092 1.974970008622901 -0.22820687194917375 1.1768862523343686 -0.4471331185859474 1.8013527482220992 -1.4555463574074294 -5.8977839101688447 0.3293748267035399 -0.50844553812062487 -0.65132305539847413 0.32551321733947924 1.2291019010747053 -0.0087724421051013426 -0.80354801822170963 -0.44548653760882445 1.1988908752655436 0.033533781939130675 -0.92355395155639086 1.552081669026482 0.3155976519531104 -0.4776326217396149 -3.6038876047426762 -1.0642300203709589 0.84138867232929493 -0.11498970992250231 -0.55649661747247525 -2.5100618704495354 -0.82738091647765444 1.7923363177836105];

% Layer 3
b3 = 0.10967710363501172;
LW3_2 = [0.16581715049030205 -0.73839205984080669 -0.17450555652907468 1.1516529749164874 -0.023496555192548296 -0.12277779588825659 0.047186009666542926 0.0048676199842065462 0.088361644325208863 -0.071007783361057661];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
