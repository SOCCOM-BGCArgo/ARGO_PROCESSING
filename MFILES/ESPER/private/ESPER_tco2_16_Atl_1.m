function [Y,Xf,Af] = ESPER_tco2_16_Atl_1(X,~,~)
%ESPER_TCO2_16_ATL_1 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:04:00.
% 
% [Y] = ESPER_tco2_16_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.6071945930445408;7.8941523054205467;5.8713889214751296;-21.070277289966935;-3.9623688188034274;1.9329083461608172;-3.2929388710247944;2.1628972162100801;-6.510669928205159;-0.84684538265048614;-2.4851768618689718;2.4311134461054928;-1.7733181381982659;-3.2627019487690316;0.18787934433531783;2.3979455134917513;3.8128688535675179;3.8014491726860111;-0.13271449952578829;4.6435035854718798;-1.0933569373631415;1.9706130400260446;-0.077629903406752451;2.7688878631490592;-3.7022674668036384;2.2880029554536012;5.9140503247114431;5.3930731995632604;12.869578213120247;-14.96304821820539;-13.470966604953762;-0.75307992827542181;0.63285923542739941;19.894385800706882;-0.49651849133699921;-0.86633302923548827;-6.4275021414429307;-4.1276105141687971;-1.0649678119245629;18.60217590277211];
IW1_1 = [-1.0563573995544433 -1.2418401736563354 -1.0098211376109485 -0.040055992984778244 2.7439974654159713;3.3987578076339857 7.7715694631652479 -9.141674107409937 0.21113785491976192 1.3277101533946021;-1.2409239815453459 1.6604177435673315 -2.0327058222769945 -0.095887073122855701 -4.1518769207090225;-0.50318412401026835 -0.17707792987782586 -0.177423334365124 -21.982871533522317 -0.16903037899269702;0.59292781210181356 1.5203033050788985 0.3541623882235293 1.4221830604033536 2.8680075059707599;-3.5555466661519608 -0.67904799662957893 6.6034102424055927 5.9293208208275976 4.4766000850653356;2.7240818226558012 -0.83021766583384859 -0.49518043555444946 -0.012770862609231697 0.57228827498728496;-0.17048035297898359 3.093420410703462 -4.1065959707938955 -4.59342783294192 -3.4460957954117668;-0.81210580866549109 0.24906773907879329 -1.1487532388109081 -5.877584617006737 0.27600171808176488;-0.91201094557070406 -0.25174546249400631 0.15002958460004462 -10.007094086569108 -10.664420774256721;0.53103751560751811 1.0862025442818906 0.23832615183576794 1.170830885304164 1.3532178058802229;0.26254252197036942 0.56298883051153492 -2.3454867056046917 0.20761456353237223 -1.771459084109952;3.5070225678022804 0.75799541479843668 -6.599815124535815 -5.9445150167151608 -4.582002931428768;1.9485631011279809 0.52516705596505697 5.1285942421325945 3.5421635053684697 6.9762783084549529;0.38899236455159047 -1.0053839829832298 -0.3286765005174398 0.25480592582472739 1.0405561493408404;1.1224282859985699 1.2050762424268668 0.92150492777178961 0.09407575831573782 -2.6156484510546649;1.3257266213365348 -3.0334239593106433 -3.6041822793847533 2.7094444593405673 -8.5835323958847471;0.41087615475558836 -0.76457820524624709 -0.86643263199245668 -0.64971583013154643 -7.5753743713929325;-1.366916480638612 0.50953939284236649 2.0292050825256553 -1.4024665235132392 4.1549885544074145;0.93448790000643778 0.43312181007761724 -0.31060339547215793 6.6550243257129917 1.8283944044063767;0.53274672047522731 0.25807814751738783 3.5761460169953589 2.7414987198059309 3.8226088035689481;-0.16775049829122776 3.1603824152628133 -4.1643582273703164 -4.669069560162515 -3.1960434385427128;1.9944413110538837 -2.2725305549514712 1.3308107424985742 -0.93851970113739602 -4.926660600668674;1.3134433971281601 1.9760949276113844 -0.1656409723100207 -0.23138776245760431 -2.9268334324622511;-2.4180131737221573 2.5743688433923611 0.68257268663668913 2.5112813046469418 7.5008346735103162;-0.45487689411663906 2.7409738801927288 -7.15774062849112 0.50152217480706662 7.6710570846361597;1.3376596908670098 -0.46412258553129182 1.697631117321668 7.4016864264052886 1.4906340578103059;0.98255212996254526 0.5102958635038719 -0.24867220712954335 5.5156362417796378 -0.45021954871958164;2.0561010357938061 -0.79063961915075931 2.6853138205534504 12.366001849461936 0.40266677713682031;0.92751347936467099 -1.5626647152590154 -0.86003164820732581 -8.6864241127732207 6.9756638896952685;1.8961370053903965 -2.2470858215235592 2.6369480350321712 -4.0608019851661972 11.455981661904215;-0.78519099626069766 1.5354448231638633 1.0190091908186811 -0.36526360832484817 -0.1618735613006205;0.53797035158276907 2.3907699674195628 -0.88569978503130087 -1.6882337342811109 1.0602568683189726;0.43334525340366897 0.14752904713292986 0.27481351093042372 21.333069091021233 0.86246773261928467;-0.54174074866670352 1.328347157816826 -0.069917364006300234 -0.54069262093227877 -0.79907777412362835;0.063039887834262717 -0.8130152341465664 -1.4839759567896085 -6.6018630059900358 -8.8415364810527688;-5.2592153143596203 4.5489341315317171 -2.7044270441583778 -8.3902088722261805 -2.3353752204867253;5.743343812016783 3.7815436843886996 0.82859857200370535 -10.42958646164101 -6.3612251701216822;0.77518674544794697 0.33059143603643143 -0.22149862983317456 0.77432059928833086 -1.3018649828500746;0.70479840883629374 -0.1871520286815157 1.8905736990579376 18.853370280398437 0.011381024130447554];

% Layer 2
b2 = 2.638004164622989;
LW2_1 = [-2.5786581340563615 -0.010617377293156319 -0.51994348003440805 -1.1266011811596039 1.6829504169102829 -1.8862872202718277 -0.43291010139844999 1.0886043379642569 3.6496477987771057 0.17739708397704468 -2.5192484454935702 0.36663057579050151 -1.8978532017576044 -0.075800463369462945 -3.0468929623658916 -2.6670065584727474 -0.034714706968542564 0.22978467686918785 -0.080966421674568606 0.82651178480286258 0.17494027374342538 -1.025026377736971 -0.23828175540931079 0.38980409741274447 0.086990626262061846 0.049682483375334083 0.87229032290904851 -0.68479659086272471 1.172569335221221 -0.14829135149024006 0.025082496563432945 -0.73493112633704749 -0.075897661779677356 -1.1739027229257073 -2.0043512058996238 -0.16443520953297627 -0.031877993640686782 0.005468454401296504 1.6552772197292824 0.399079956140308];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
