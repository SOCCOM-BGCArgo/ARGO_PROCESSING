function [Y,Xf,Af] = ESPER_silicate_7_Atl_4(X,~,~)
%ESPER_SILICATE_7_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:40.
% 
% [Y] = ESPER_silicate_7_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.3986988480394217937;9.9912647831964580547;2.5991999487892667453;-1.6579757494247535643;1.9153992851626211458;-1.3484217940274800807;-1.2171021444152498869;-0.57925433053297026298;2.2503618612894360496;-0.23225334797022781363;-3.3943639183942231341;0.19685002444277138745;4.7928019661374259286;2.868259606697618036;1.6990346479087281573;-2.2703325797732567537;7.5288487556055274652;-2.5110900520497154709;1.3387284760151667573;-12.803799106456335011;10.575589802014926377;-2.7655053699495351083;-0.56472246954640459293;3.5237047418277787081;1.5403857445937605419;-4.1522827396735735306;2.3494430963608756713;0.12157136255712980288;5.7744865229821300545;-7.3039837191449370479];
IW1_1 = [-0.58344725665144614446 0.56622683954735342216 -0.744564034127536023 -0.46410696709651727554 2.888988010246359206 -1.468259471719401299 -0.68379300295158729206;0.42197015997560732847 -0.86308191174212722796 -1.929925895762273802 0.299010323505151554 -8.0217391870451404401 1.0802402115313787245 3.0386315888395314389;-1.3368412349339202638 -2.1132275846630594884 -0.45078281107729500921 1.1433234602877231367 0.78646567165213510098 2.620021041988203514 0.72349286857427208552;-1.2554959092658763975 0.50838170589318165682 -1.5048415779118855529 -0.15061250888556856897 -1.2301363736189312448 -3.0292419214554104911 -1.3470251769273184905;0.83265062171115389322 -0.10017210902751189083 -0.56849709454884667093 0.36797934084253658416 -2.7350192221317217722 1.6382362529012610697 -0.23067665012004978653;0.40029380958933813428 0.99808440308947321551 -2.3303616111969471802 1.070974314971264274 4.5817824798659749774 0.27852711230250648544 0.62393565473012224665;-2.7443288100641312077 0.40956023360476367934 -1.5034110119218335733 -1.48712054075923783 3.495227161146611472 -0.6858899360432288983 -0.27774202832109379235;0.27212775685155754513 -0.298305675210907284 0.064027966514567602463 0.050984872590242258372 -0.48894484262917559114 -0.62855943251276091832 -0.033133465502007380943;-1.0718554161094671073 0.3202397614980933005 1.3966100838192945233 -0.55993050915039765947 -2.0402549282374558004 2.1038897562680869413 0.75472184994456636975;0.2612111214353785571 0.31110346671911132121 -0.27258328883481020011 0.22245707643790649244 1.2624288399217540313 1.0148266707570690048 -0.2891480815991070985;-1.4044612808671952386 0.32601726600375424692 1.0126805139958068303 -1.5333556806000594452 5.9097419917769942188 1.2805475730171549387 0.14313755671378244894;-0.16719770308745737775 -0.12238458054096228167 0.18883878316461102931 0.24907602653902630174 0.6728943194960386176 -0.31983609951491437373 0.3406633768613432367;-0.77874118505927680811 0.70866911818334121786 -1.990432401489652614 4.5660710376571103097 -1.6173070831256690649 -4.7725991184244316301 2.8766864188025489391;-3.1833942022447345721 -1.554840923988652257 0.7403784512128486206 2.0347467057061159323 -5.0406865878860340757 2.5174009213470021074 -2.3632256053183442468;-0.48077558881062115725 -3.084411658107600207 5.1115879264217323197 1.1746619789497265707 -4.730620147343436166 0.32423632388492690248 -0.66704856386279776093;0.37107270571253303526 0.70539217159349232311 -2.2633088908641783021 1.0454981124820821314 5.2025509742952635861 0.099440465544809619747 1.870835743118409944;1.2664944012872711987 1.642938159119574193 -4.5780150935233017151 3.0100857153166655777 -8.6497423538598816606 -2.8161190965755888982 0.17176342406361988502;-2.0994046764666922655 -1.5650336724147091427 -1.5247458280394683428 -1.5845776253134449263 0.65876033916609622043 -3.62029955061713693 -0.94858037360662517123;0.62711707347765244247 0.023355987234331382352 0.14039801862093981288 0.16743197261981185298 -1.0925526339008226895 0.61565153799918559407 2.591522084074610266;0.26276955995802142585 -0.22076971609984810674 -0.16330963689458960486 0.5699019588794416169 17.452035531811240787 -1.1098609535471355425 -1.5839679923674176987;-0.57452619372350632876 3.2783339552890096158 -2.6287360566319266653 -0.046223138309879743812 0.90590404067880769823 7.7013614164516308591 1.3206762043986346455;1.3279215807666755467 -0.21941554332387558368 0.96347802537490545571 -0.33373660869915205973 4.9842104112694034512 0.3290217443474103276 0.64522278161944324193;-0.90252150640399952941 0.3015887709469649014 1.0471889255064859015 -0.7362189244756786044 1.9770021844425560431 1.6199896174848240626 0.14551926943659429514;4.1434544672089623774 -3.7518260027510184074 0.42069283528887868595 4.4754403396826756278 4.00469931364758569 12.170993494999164497 -7.0040295245902806087;-0.41743981547228070639 0.52486050725282262785 -0.77729659336312351137 -1.3311936599859770514 -3.1748775974692042823 1.8059169242929382637 -0.53842441574798793891;2.4950000663098812481 -2.3360432616440220954 -0.01655077575761859307 -2.1030871350797868402 -5.6003648981662612627 -0.54734305735557575723 1.029777868721676537;-1.9765188819862162806 -0.67159096817812313773 -0.66246052764235163757 0.77463862389733872948 -3.3522427282545335103 1.6081359230748368816 -0.37350223116874270435;-1.8673592061994113145 -0.38172685205369039085 0.70974260075504291834 0.56632594049759565902 -0.98526902712469921486 0.0088918300205355765842 1.4614692344224387011;-0.31316079750347319832 0.040666997454111050714 -3.3289270320094365221e-05 -0.46278035194284444787 -7.9334556757648249103 0.11609434299595136619 0.55885977432935252107;-1.188004740583999963 -1.2438539353907980267 0.16416748884666318431 -1.5942339471355551073 9.957287332236962385 -0.6267316244664399294 -4.9977000637111075321];

% Layer 2
b2 = [-12.811929396772232082;-16.181133232784070231;-9.9364718652274959254;24.108853503357842385;-26.852443579156322073;-0.19359574779809329836;10.165888159385458422;-95.804452016591341135;8.5166296337660565285;-23.595792396857760309];
LW2_1 = [4.9322665895718458273 1.8739207520173548627 2.448021290257909488 -4.8979359395846202574 6.4482725639943412332 4.15072923345560163 -5.6138863009306350094 -1.1483977361429966724 -0.66886239405281022741 -3.9545268903409822592 -4.8908516469584286668 -0.96709010474492684839 1.2070818136914736041 10.455277854774230661 -0.93144888023679339728 4.5333516512855407399 2.1755277719000143399 -7.8136204407976244113 -2.5870048855217562256 -9.5655289208845015736 -3.5903222227124982346 3.5350552699657926681 -4.2099991437086652368 -0.80612725480762825736 1.4673043986337597211 4.4612046026992571157 -7.6943879758207893715 0.13169370178276090799 11.792859882982062558 6.5159177051279115744;-0.97412639922615906762 7.1154186937930719026 0.11002932680061308646 -9.6717592113297126133 0.35013905265145917056 8.0123861360761470252 -1.9345009735115090699 3.0384684442769858137 0.039393306582752772582 -10.198205626891144959 1.7138872033524898963 6.0387377726463169481 0.95023859238638763713 -2.211058584413278183 0.71094171021360907936 -2.0984608726380651333 0.24357298136432214974 -1.039942717340218703 -6.4652530124279605772 -6.3081230575319429121 0.71896547023959245237 1.7168966168984425291 2.2487799993411301536 -0.70710958787594002661 10.366081023014617202 -1.4713692400505273827 3.9427668512819122881 -4.7707106239185943508 -7.9891306817990592748 2.2695827802438488519;-2.0557990828827445995 -1.5682526889046841667 0.070199156879006005538 -2.2973577576671053713 -2.1449423376387812823 2.9785418956160905068 -0.062058091839074805418 -5.3480118135722083395 -4.8114680670686613695 -0.34888544026294121547 -1.5217337298145878766 3.4564752462536478816 0.75945652502729454891 1.4378393252788077561 1.2310842438387263886 -0.76289558777049171212 -1.2810729074024274077 -0.019433442764516039442 1.3487677200831604818 2.3787965891571385413 -1.3699933835366249202 -0.53300653356575922182 6.1499436245916747623 0.086268807193460625427 1.4960682947412886623 -3.3910538164312051812 -2.9700582783925844055 0.80089043562234907281 6.568025793169630866 -1.5810388723303969716;0.80864462304710937879 -24.660871048814048123 5.5196183185901794843 1.7715353086293212925 -6.690262338922593699 9.9067932915672560767 -4.0392051854034907166 0.81058170133658224987 12.654154524708285834 -3.1687056090262770702 -6.4027371194159963252 6.9840667711462094402 -16.588868514488982697 -13.969322152146601113 10.115589664063231012 5.6461575442357032628 2.2916818928764954855 12.726592995555224164 -17.180691604331805422 -1.2731987624435379125 11.480176960422729948 -0.45647038653049409884 -1.0606320759154443945 38.211466783231628597 4.8046452980340683681 5.0289913901295975052 -11.813763171286643328 -7.5282802710662490853 17.196870452323178569 -4.7335288242443400719;1.7339778933920808601 13.706922121483913202 -29.015478992028100436 5.4239795847428089459 19.655097268044066539 7.98747992332509682 -21.790441019060136085 -23.069487598932639116 -4.2976489285277326147 -49.903807916573427406 20.993570730174408112 51.845134027355783246 -6.0262834059151177968 29.046315514647169209 24.413207965739246674 -6.960640251398963585 3.137761322219743132 -22.783676663589336187 6.7078868175192836176 -15.070724310488643027 -17.001746138079816717 4.510864990941632513 23.388125049133854816 33.057022093262453666 7.4918174744617207494 -25.591146593591812319 7.9409258434038694219 -21.562977618883973463 8.5753737289194447158 13.776240968428515643;-11.62524562498254177 -2.5215047508917898256 1.3374506217509085637 9.2921810739749091113 -5.5475617054411499041 -16.011534302177899747 5.3634632223396456752 -3.3920564056465321023 -16.097303263886342251 -3.6091911547615866951 -8.8651392462760707502 -8.8444233158933371897 -3.0155016278674096064 -0.3953597094721286731 -2.3299734485395711125 13.608491452842681468 -2.9868781373260531176 -6.4877196791678315435 -10.173608627138507998 -2.7036026227584093462 0.18647136510679562793 9.7513509118399426256 16.791955311434570319 0.37700523214965425689 3.3124870582407797137 -7.1985372415077497621 -3.0807981980814505008 2.2564897414237741202 -7.6260621350137354213 -1.3755536119658997585;12.202838633900062959 8.7867363111733141068 1.2829104427887325635 -7.3436704472504876762 5.1072619104209948659 -0.059294371054059172299 5.006993182593596714 -11.906528574321116665 -3.4687855856060778592 10.242919623833051546 -3.4055963376180460322 15.152552870351662762 -5.6514726867762252738 -8.9440062123666770333 1.0929670781861091644 -2.0395384198207704429 1.5686959098101385113 -1.5761224952125285625 1.109082798119931379 -5.8182956941500565406 -0.92430117904339637036 -3.6299613372303398684 5.8847492832907057903 0.96425776048288158737 9.63239290837618789 1.1312617048061612834 13.927292731342626908 -8.2394461579309208332 -1.5305086278162622904 5.0327677325665893804;-4.8734953517426609082 -9.8142651503014395331 2.6543461895086983837 -9.5128001024816839504 -9.7054789337319427034 -4.1655354158586632707 -3.5678661676439435979 5.4827148146405582096 -2.0614856554896201501 -17.109828338887417942 -7.9705807784176876396 -4.6738715646034663109 -0.75157798835160771755 1.9852035178953151284 -2.9165519591452486736 -0.82225873342082189676 2.2244945873887052024 -1.0664823098438884763 -19.167938123883960344 -5.2945334493825138011 2.2881022825544259369 9.8332640637158874597 10.683527240671184089 -80.796067881261265597 0.97501933966092968475 7.9050317015859965508 -1.6995704907904380931 -3.3974767088392869852 11.647293411432539045 -2.4641862119965520783;-5.2312637502609646845 -11.126148045021867716 -0.62385272253228396533 3.072892610118231449 5.5029466468424539372 1.2986002489445485075 -0.10025163743195657229 -17.132091363709754717 3.6214190073046741425 -16.548086156445936723 1.6555624450809207637 -13.601905983107629439 0.044972368443784244141 -0.49933265859913050777 -0.035567056942593912316 -1.7050364379259907999 -0.15818979946965841532 0.10508650956247578279 -0.76115757401341177513 -2.3669911791474662621 -0.89872861337471032783 4.5122175500231698209 -7.4229817836964002709 0.012403692425300906488 -1.5700881511932520684 -7.5928834537358769197 2.38727294973283799 -1.0168271540822118038 -10.76642501222452708 0.12314277281073252035;-37.423604630030865792 -18.453509177431111965 -0.59447230196766087662 31.720693591108233278 11.840789795436919007 -0.070829787243965575128 -0.26604444643211327959 -23.449739974649816077 -2.0970199151330723986 -15.823145296691800255 0.63093584950253056576 -32.590976040128005309 24.343830222188096002 -7.0068095756279742403 -3.504670092762148581 14.540917514351567874 -11.952732542862635867 16.292230249030389189 45.569236735112461645 -3.6010019272722111339 -12.178090028448837145 9.9174210267730966706 35.516361118907902039 -18.269533895614490149 25.263291879750962465 18.888380339387399687 -6.2844622431054304457 -21.293626089386073374 20.359919451957285474 5.0927643131168167656];

% Layer 3
b3 = 0.29340691054536227611;
LW3_2 = [0.008509632925816384974 -0.021424645335506555671 0.031348665592186179818 -0.0043723252913940111736 -0.0065522685912906926051 -0.023955578223101247487 -0.015292399945210571194 -0.010057023867837673256 -1.1717001144826579839 0.0060259776702920580388];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0145232735458572;
y1_step1.xoffset = -0.52;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
