function [Y,Xf,Af] = ESPER_pH_1_Atl_1(X,~,~)
%ESPER_PH_1_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:20.
% 
% [Y] = ESPER_pH_1_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.2178;-101.945317545701;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0054210015363163;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.9204636006019457639;1.6441736318468131994;-2.0769691342725731253;-1.7726768534281844847;2.9742270462716668966;-1.9392896821757541481;-0.50267988454902767792;1.5645189465320930022;-1.7429118275320112375;0.67641560268452316507;-0.9639730535988402238;1.8189658190625934697;-0.14932451106652375183;0.87831518871324321118;-0.76266468838044754186;0.51345297249241172999;-0.54513555547119862954;-0.95690463784455859209;-0.73720024289474028745;-0.22838442377480960843;0.48544268082358127403;-0.43038401701030071234;-0.087500307588416939564;-0.85675346466594515249;-0.76328517315530353127;-0.52378063506146654849;0.47199854752847164585;-1.2085758315136765351;-0.95133875962482528088;-0.58588327192044276082;-1.65518241598239646;-1.1734891523840951244;-1.6412624326980107536;-1.5472210283737015679;1.4410265243769255772;-1.551733565786195479;2.0742997415757731261;-2.2236738356266911865;1.9959637363936593157;1.6932335370157489685];
IW1_1 = [0.42431153601249416152 0.018349274453474832824 1.6630803275852323875 -0.31783858193719488616 0.22870793082080043135 -1.1135640040556913366 0.30155401659648839452 -0.90355023337318896015 -0.013865615172025901741;-0.95825389270902416872 1.3755727431600084376 0.37555171875485154898 0.71437415715496555002 -1.1864327294399761303 -0.26845135568194000708 -0.054811866799123573624 0.44075047729733835 0.88539173475897647858;0.50117136320749089418 1.144279960159650944 0.90385964772823557123 -0.51872824616241131057 -2.0219396368204818337 -0.87226514783847786116 0.93538346265227023668 -0.57827072660845746377 -0.84199999542188885826;0.29170043203598888804 0.073770064646382541018 -0.22206759832824268797 -0.85640378386168158897 0.38257328588635081124 0.66594655685222314823 -0.29649190270439157446 -0.64937361869368748213 -0.6334345876196715297;0.12832630623510377088 -0.34557067448652228903 -1.0563543578986820393 0.93299283570657431941 0.10295731428758829462 -1.1731384689553030487 0.56225048485714801405 1.4645321603645184982 0.7036808172242662307;1.2131235117739662677 0.19921602790860423737 0.29890684334893363738 0.7579767715862155697 -0.44923543978340613192 -0.72863721918019863644 -0.20391464940362816205 0.86766579013247546737 0.64664315122544957504;-0.091229844281956823382 0.12191667662020318208 1.0040122252158560912 0.62252839236174284387 -0.24462947952847055588 -0.89492961675141857736 -0.96082632821524505129 -0.42047923673700388081 1.0359389540029848575;-0.050147386343705524503 -0.29216087872407731085 -0.70362457877918282989 -1.1416979372001456738 0.91523785853853667493 -0.26632635865945636366 0.86734823054662735231 0.23745432083069650808 -0.94011015051337409876;0.51034789819056392002 -1.1154316375612431944 -0.15447606829969554032 -1.2202975708703402979 0.2817474024697171342 2.0473172538729995651 0.13511645172137504156 0.62028455979795127373 -0.10113286700800026841;-0.17786265869249814897 0.11224146095683729119 1.0479795105213152162 -0.50276549319000418681 -0.44587806860126005803 0.19918220096624325577 -0.88569256223773318304 0.50647882914389930065 1.6770966960442326155;0.48379467767926709332 0.041238537836836244854 -0.78524894707074299749 0.060258709693019371634 1.1258360747356139786 -0.078738768973981701493 1.315089373891722202 -0.86025229942106473668 -1.59955701902902514;-0.16512493357158455898 -0.13840680940547586686 -0.85021994097582775929 0.59193262564940185566 -1.7459380115484626206 0.084007734217336274551 0.38419624466646506988 -0.13461544931964736227 -0.98384735320987060092;-1.4055431051179037016 -0.044303676318236527576 1.1175661069609821308 -0.30093926782663393826 -0.88271418786268651679 1.0848048810967294564 0.49168818754342719091 0.91170161541193128762 0.83528853804900959901;0.15795939683897125549 -0.44041383390184724034 0.74849577356343299783 -1.068177664893104728 0.22135669706487520747 -0.68766904853756583016 0.56327476627329209347 -0.96408680731509022177 -0.83550476776750037811;0.28608800131683242984 -0.80971942800072760349 -0.47338681354286471503 -0.25020881258864990926 -0.38024460711785657008 0.97332022107725746363 -0.083781540479075253258 0.5005497477715221688 -0.52019467472512104234;0.34531181389005527471 0.89117685148037362186 -0.12567589832579847964 -0.51800452557209208937 1.4246805265962971809 0.21985943919664188706 0.29507818675491731542 -0.0055817578526358912691 0.70224626368936149401;0.95826752441772933278 -0.0048499458874508979619 -0.8807943121121860619 -0.86210751875330260408 0.34881581536342542993 0.37777952883083987246 -0.3277271422555584901 0.55387711474305667547 0.11427971747038287442;0.12603661944779331883 -0.1648468017940363517 -0.43203590931744872972 0.48255619644539859969 -0.76649609827248488259 -1.2299810603158869426 -0.48700934205092938356 -0.29901336630760899649 0.2276278109211334888;-0.16279495746350788887 0.095530618609614370573 0.4913918669293577679 0.88273260032878086978 -0.26768932040881038281 -0.34437591892092983548 -0.70332499415532134801 -1.4872932346557170558 -0.07279377341776083199;1.1707148694584403881 -0.42928817117984441332 1.6785975865912228233 0.45870330622412103239 -0.0015737485728959058756 0.38051447237009627944 0.45743979875606904928 0.14663135601549309728 -0.39481326821253742709;0.75909590305466645432 0.17781915706531009613 -0.35626111305414392971 0.81336796253978926874 0.79730455723983373328 0.41977436737822404478 1.3952504342081173405 0.25647919788122874873 0.077340348953453402769;-0.56656524607643610203 -0.37267917177589032773 0.57278290032222334283 -0.27367272606944564872 -0.36223715723408239642 0.93992883657238657236 -0.39480017622523316811 -1.2522776461774520751 -0.20589036559612081123;0.23964001332897125196 0.57266590900786351614 0.086596102712646561006 -0.9760683857824827836 -0.88968628613057365584 -0.56537505586701919391 0.49427606599831969136 -0.55410476326955582227 0.96935842067273081391;-0.41398126517178474026 -0.16919671272449435251 0.48871976299736719085 -0.26865818776728545014 -1.2797658338206820972 0.94268535264060004941 -0.78422457405066481329 0.023987855109763946831 -0.13075364428325048083;-0.16233416203678446843 -0.02308873739940979497 -0.16883762749354819244 0.93450043867491228156 -1.5819662596508450303 0.26177567454618433374 -1.0645052466053610551 0.23878317045356300952 -0.30933828350998648915;-0.014428992935594043071 -0.18378424103935311895 0.36238576788483023439 0.31614145443088798038 1.775883937074289376 0.12065259501652195184 0.78769364441691069878 0.0037320036038609449847 0.26804668654974300734;-0.23556400397900845167 0.15999425258121832694 1.0638791364845174847 0.24081988378613422563 0.89774944630323982864 -0.25357843250397943402 -0.28819216402422026535 0.68497953939715039429 -0.072482250002042905579;-0.80960694877243788437 1.3751433745755179405 1.5359201040243117831 -0.38507247833214364174 0.14164112347565038785 0.41107070888741709114 0.54201432042932984334 0.11129219585241459378 -0.47445824189042201668;-0.2172718783193061387 -0.87879398209419423704 -0.5077132116508026316 -1.2074528790328487027 0.61706921631030942077 0.70677802514145970925 -0.18147802574797725073 -1.1993110196871645812 -0.48661507108726209658;-0.75759583053178991552 1.0538551035596965821 -1.4154688936406920607 0.19164896753590110468 1.3402145449553359846 1.2529781438298559504 0.68868436459925452819 -0.75248355421486645689 0.12804640846566897605;-0.36573906527746030681 -0.12629412940261738885 -0.42716434257267116292 -0.28584898070594039199 1.0360475389644647759 -0.61536657850003562142 -1.1862676432695602458 0.95154541873697706666 -0.16606407950283708086;-0.7568133819358329184 0.21793256995106047302 0.26498829404236917684 0.052987543025714699263 -1.1612272400693159913 0.89172091918531748433 0.74037252192752267543 -1.5498723021988685122 0.216975670633108908;-0.50397933455874976971 1.2824982202259678221 -0.59028923442257630327 -0.24975071393895353911 -0.04857988151049216774 -0.6471084934390793908 -0.12821764966209517334 -1.5963893675377631709 0.66933171585881801047;-1.1273133066759797316 0.82313264479704506549 0.46258612491704342862 0.30235004538634618898 1.3907616119612726813 0.46076768047522248528 0.026360088739531228191 -0.4123802028042423129 0.81542019911393703868;-0.26348750030431095093 1.2437201243793603034 0.88002847870471145875 0.029347170484545312408 1.574777633464412574 -0.22725401617795959464 0.62449634468911907614 -1.0769816722740135351 0.24386918812353647334;-0.37339660760926907113 -1.0338870900565404476 1.3095370217984398931 0.5534449368423459692 -0.42043009512532059091 -0.034379222688316196654 0.056233483330663275312 0.43567406594477703363 -0.24293600212095137203;0.19461167099069953679 -0.60685329068610305292 -0.369364087578936795 -0.79114396977845768966 -0.24806329685459144185 -0.74464425998703887011 0.82989346959703336193 -0.43604298909774602544 -1.0945220209791395316;-1.1956216413113476271 -0.38036165043726377633 -0.4622601960417712097 0.49199663755733463733 -1.0030759234818968917 -0.7477468503739881367 0.24531641325241237972 0.81863817114731551872 -0.62029464014919299952;0.11218697037844513331 0.2275514388356546791 0.65283943364183316671 0.48806216495188897708 1.048774608028204991 0.60794270166608321837 -0.54084593855812213015 0.91484335252889803503 -1.03838712609621453;0.66421243767677462522 -0.93654256881545761004 -0.84208750537432608407 -0.43559816888184665906 1.4380622818120538664 -0.63622865387797888914 -0.39871056741819338454 1.6333969455224157663 1.1388139904315226492];

% Layer 2
b2 = 0.16813773234082329822;
LW2_1 = [0.40726827452035746502 0.15444215427622770553 0.71707600274833815934 0.38601371485118096682 -0.35367109360163662135 -0.35300084228037037493 0.51563259297732799702 -0.24276205530688141354 0.37268723358438082816 1.3709826042832977677 1.1172605698579760602 1.4823934960061848631 0.21302245553832865888 -0.13476500103048291712 -1.4998649489954971603 -0.79415696989895490088 0.35682310793048177544 -0.66376542328354537492 -0.50457519030436026597 0.18678758552531610215 0.30032779330971892673 0.20731243733144136265 -0.48531720900261576812 -0.12516075692031419786 1.0975953428657754252 0.69603609033595537081 -1.1073360297130319108 -0.37605726753906065785 0.17813452898954876269 -0.34688041443074391079 0.99178577927988698093 1.0093613533621064171 0.85511416075656287994 0.92785243781745740943 0.59238762580737713836 -0.60982763606437306869 0.55016473607130633727 -1.3083365353018614474 0.042436669682206246135 1.0502358726868117333];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
