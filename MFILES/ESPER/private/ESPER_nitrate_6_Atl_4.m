function [Y,Xf,Af] = ESPER_nitrate_6_Atl_4(X,~,~)
%ESPER_NITRATE_6_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:34.
% 
% [Y] = ESPER_nitrate_6_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.03];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.604229607250755];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.4830400781030448343;-1.9539433411463520418;1.2259202599197545069;1.6516461347152089356;3.2431490183084288326;1.4758048559284955292;-1.534945506905642354;1.7261246335423043874;-0.90386179203380312419;-0.082216493795752687568;0.35685398380771332638;1.0159780077700506506;-0.60118153215160918812;0.59377170310633409223;0.49559121037985315317;2.3748896056377262198;0.50411022151609963249;2.1941115016434515894;-0.36101768400264178105;0.0098328976620412622545;3.1575991822201454617;-0.039189208344916674764;-0.74441472845123934921;-2.8527309896729233785;2.262343028798743827;-4.4743371073909345981;-0.30711882412720364899;-0.92363304987513028532;-2.7173375224225706503;1.2029419036912969432];
IW1_1 = [1.2024466447428845406 0.92290824025808260167 2.5053319988162199294 -3.9345107104489778216 0.2973811213107673268 0.78944745995604115318 1.0127562208409321975;0.96541168796720511214 1.8272610659156449664 -2.2920999964966743967 1.2560909455420579128 2.3860975969907922689 1.7603374711951067511 -1.3203985982331085669;-2.1237606287173043107 -1.5321096568503744795 -1.0794731139688926724 -0.43641935498704237384 3.3324000712481613995 2.3908179051541207372 -2.9694439851321305923;0.18907079320964853553 1.2823350283001047067 -2.4486600450211284397 -0.57959392673774867699 2.0024194253741316452 2.1750815427187371043 -1.5210767572771823897;-3.8910941877702875935 -1.2115016254727237754 -0.66491448648885753681 -0.14536465889967001286 0.34429343588880145788 2.0535554599818963695 0.55421072380003888469;-0.31032911889344100276 0.69094911970363825926 1.0539267447593414495 -1.0587007456847443709 0.087700893349553207812 -1.4627667294999648906 1.0618203081001547083;0.81590869881336702818 -0.69959942251477413855 -1.4830980704831702166 -0.49807693859186386032 0.94455113842589144557 -2.1356256446405996741 -1.1631016901256403528;-0.69089294009908175376 -1.4790691093513324006 1.6681184992679847223 0.77772634927814920935 0.18904705545116989862 -1.7869769362635825605 1.1887929119040903103;0.22879477032454018093 0.18846509385951779048 -1.9382633478384518888 0.26216320234917089849 -0.029873637263048147261 -1.889726652194273715 0.88577564090755456228;0.79349082194941633617 -1.7252609305684445395 -1.0680206061613111146 0.35773864026957935547 -0.61697560379361560123 1.1682555473001194901 -0.75250112432751481428;-0.28784528423262795149 -0.28376642193963003136 0.34262288782305266865 -1.0529565952208326252 -2.8747161865191039887 0.17252192729845342023 0.36181984724059035319;-0.97328471021386164796 0.43697632593834856429 0.87787730327185675705 0.75091525055883878714 -0.92723636265889286534 -1.3593970349710817747 -0.10745758472314866083;-0.39519328382470775285 2.2173101313182943528 1.1077429530222555609 0.21568185164130770914 1.0454532695333329517 -2.8477039312459813125 0.69163846381120130946;-0.28171618367587764054 1.3198046177467785967 -0.019902447881781359929 0.13754056536497841212 0.51165851894707925496 -2.0823757385133698783 0.53441144779972094003;0.45358331459190881496 0.17234017181850186384 -0.21163319559189749941 1.0703019593921956343 0.50323319029887880749 0.034020054564871081426 -1.2216430907590536403;-0.36855961825735206183 0.13538872624522463317 0.19664173878696658559 0.18834715550389014016 -0.0017493856015332884604 1.6095233734758174204 1.415996492391255579;0.53798579838566551459 -0.24250088798236207888 1.2441917382627534217 -0.39336992690230476732 -4.658704237904643719 -1.1127254650437516936 1.0697565762179146454;0.81980135414277655048 -0.63072840449011624564 0.20377375978203002282 3.5591191079394848273 1.2421496605442821082 1.7600766412101578329 0.1810219893175623318;0.59851848872810631264 1.0489079989678220528 -2.8155285621669983165 -0.30620008854613539606 0.11380748795378861637 -0.54014044261911731137 -0.41860947478548826695;-1.2327728772796335832 -0.51968334813242766934 -0.31723546367530713885 -0.15076638259037103418 -0.034620300764538786131 -2.4191981550469265905 -0.94927956032179672263;1.1532605117518861526 0.55265004742691259398 -4.5749898537432267531 1.5581336257429116987 0.28307118623051946704 1.233268632024296485 1.4457461796160639977;0.13809715827936064336 -0.54410441111046592422 -0.48853476484277208458 -0.016268743631337359568 2.898240503602100393 -0.80695275660698784215 2.4387995156821089537;-0.86229628141421710286 0.41709961957446506364 0.88586243753181703742 0.44490481888311039782 1.3381578750539881995 -1.3159327512754730449 0.089955571505290390921;-0.63281893254911625313 0.27429592797630109047 -2.919209719727194674 -0.022062373654847505788 -0.30026695699478511692 -2.6313011861688941906 -4.0805725928010607717;0.74645264402233801881 -1.1607496990933814374 0.42007596039319194947 0.24700008390444583295 0.39643867625960504952 -0.67258273863653128544 2.7825144824285086287;-0.56464516614659965299 0.53918182601603259485 -1.4414720557169482529 -0.055764024187861152559 -1.1635269683625855119 -6.0210788990148875754 0.6905907433973194065;-0.06548542010462840568 0.12828828540948161718 -0.28256989160373147119 -2.0607063177197995074 -2.3963748298436686746 0.21582437753400859903 0.60695638357669967622;-1.9857774093634597001 1.5351100961810320022 -2.4734517062627383588 -1.2991776301706674523 -1.7805941040758572758 0.246852397499937537 2.9165317622374460349;-0.44195132553513166718 1.0697378850004379824 -0.53537680339664639462 -0.5182895128111675298 -1.7474879175772299877 0.30725596711422720198 -0.20706142686533229869;1.236156224746228327 0.16121450033019754655 0.44820796572925170054 -2.0620465759724635468 0.071199221064681822435 -0.81635147477938607707 0.99831693936524135147];

% Layer 2
b2 = [-1.1145919863018791673;1.8984164617694043731;1.4404530000308664039;1.1838928295890058795;0.41327086389817185852;-0.26232411536365957128;0.73684263669107941119;0.52290177713269792026;1.0048912554953428611;-1.5369783935556744492];
LW2_1 = [-0.20957675913743273322 -0.31366478081628279551 0.40715793930126648048 -0.28178055489790010402 -0.21131845406452187675 -0.40881656913950742416 -0.024783247713588189842 -0.6940770764781978297 0.56027426131788793384 -0.57147231074657167671 0.19653888236741107187 0.59393822075499258517 -0.11342574700991683856 -0.90741059917458621875 -0.24124668217211017729 -0.94171223984434448973 -0.80708104978897121651 0.54037724158505595629 -0.063126091822084451355 0.2222206966678031137 0.17912901634390315797 0.10862091733256133697 -0.58460623151033708211 -0.28083401435683646996 0.60667593344132542121 -0.08245864472409228374 0.6597350047512191562 -0.28195507163322236499 -0.07586550556171825499 -0.04863138585044990414;0.86775685533839619357 -0.534957389051909038 -1.51668231483144611 -0.60663755078711478763 0.79214484834698317695 -0.39497931867127877847 -1.4771258065402985693 -1.6620051795420365259 -0.63511120947223054234 1.4267881888091205056 -0.90983485620006654404 -1.4059802545507245064 1.8064053644550794875 0.61233173442901467354 -2.2761158826069154415 -2.0107723043066485502 -2.2599307844367944043 -0.12659009081077091108 1.0826051088642236753 0.062165757536579380194 0.83710935874643144228 0.6951486604265557645 -0.17782639727622745474 0.26207463460785335174 0.53241964261601337771 1.5272300387688748646 -2.5570688017891263222 0.088397063086194230253 -1.0966375030197155205 0.047280801195204953669;0.03132716815136720595 0.19658998579689282438 0.39927831619896925197 0.78981730001182448575 -0.12096464158575592762 -0.7717226114560448158 0.26684497190052458571 0.34788647094255625847 0.58528303187504637783 -0.38859947063466432349 3.1917092651572067652 -1.067518488444313407 -0.43267535065459689081 -0.3508194248433760265 1.2486437554014211404 -0.10726704626678849885 0.69355017338669078253 0.093754471338978934147 0.31354148754044081082 -0.58786540841794920897 -0.39672399820836434792 -0.19199795512997427926 1.2840944636828119929 -0.16137536907680088971 -0.16965557013417983945 0.054318487278178395616 -0.19051620804012772692 -0.35256151818332848169 -0.4972415671857390862 0.43266778769718938769;-0.2693196556657026508 0.42283055986794376713 0.09930275937708270273 0.5616542123057031155 -0.10947105185422183193 -1.7862791807077003092 0.65072458476366323854 -1.1202599447574521641 -0.37224297704815278998 -0.18664102158338996551 -0.44043385418069652681 0.77401716620790939061 -0.71539833757026094485 0.30063886050553312312 1.6684737598433463379 -0.19997476607343150912 -0.51668776681803518791 -0.81690879461722654131 -0.21428790395302424465 -0.58943542471826326778 0.66961109936280638344 0.62272383991785495994 -0.51554078785888457492 0.82304418065517215286 1.6241815420912193435 -0.11277734690841861864 1.166048785802858534 0.81801441197731117327 -0.53868238142729274465 0.0084690938799695247852;-0.23887068518827078711 -0.20954404828327347077 0.12282691323065497713 0.42585742374828960966 -0.41228541107168659163 -0.65589503040867336292 -0.99705743940749824716 -0.40116046040365932468 0.69358901579738796439 -0.52679987080462054028 -3.5518032623180988416 0.67250984648305067726 -1.1065809458166695478 -1.1652806730949547553 -1.9110045548613099342 -3.0823693094346822363 -0.51803253993093723029 0.94761291183798102011 0.6513022329495945506 0.97818824370139390023 0.2281051502378080853 0.74459547391399127925 -0.17065197165035767002 -0.61222047517938815719 0.011417699192996127663 0.55428673786630044962 2.2044340353717957193 -0.37397190148885334215 -0.55591396665595715909 0.26315248039254424128;0.0019734520353744218132 0.0053569792899623549023 -0.5714159875452141657 -0.5958406464274115244 0.23420111657742612166 -0.40510226279822203477 -0.0042643554704752950624 0.45704605026075384444 -0.41838463568183642538 0.45256450047233592882 -0.37276787516858994609 0.10651771477151253387 0.24079879918944008255 0.82353629429516506111 0.99104637804071182838 0.68275164228814544387 -0.22339118825515930089 -0.42349356167021673381 0.068130097573193923455 0.30249758581535329816 0.38019015952447154927 -0.70729717889184806623 -0.30823598288267423095 0.41020093771368437707 -0.23858001050172272794 0.31451390172997500949 0.068195775861605370527 -0.53328025242295129527 0.2988681550298029066 1.0794729273347507537;-1.4059712494439535746 0.64448061351355689919 0.16662976920060557084 -0.54560433753932902068 -0.27323788370058815778 -0.5604094610226827422 -0.27146846385201722773 0.0095336900238311775291 0.38730326943993226285 -1.9013139852465472668 0.75695226266439608054 0.016655392801051879109 -0.41936092927012136311 -0.52740599746113070445 -0.07189132984409325744 -0.8311804039833196045 -1.9174108868301387165 0.57018052971259725048 0.41140477860632734819 -0.086913844911853360697 0.98617441317289655789 -0.78209857772418223121 -0.31113945877439097565 -0.73370520656504722989 1.1042541421767451126 0.82892586022375547294 0.46059825344504518041 0.059753525639636789757 -0.039318301156206714175 -0.88442294147083733158;-0.060667068856683561973 -0.14167804659960689384 0.30313264822977536994 -0.019880029204219960837 -0.22161027874622105105 -0.31869733640425534915 -0.15863181805918627476 -0.49838811376270381048 0.33964729597475279421 -0.45901493848319097069 0.40473479635996850723 -0.071382167426652418096 -0.16545419190072915838 -0.79095516277109301218 -0.10467742216306853698 -1.0688316992506867731 -0.7546874777970060677 0.52612336312323759735 -0.022316992835508069754 0.23075459043574059192 0.17705472532859425905 0.31729284728009449212 0.35448822556246162296 -0.3020891312189420419 0.46483435701563508013 0.0054587787030196720586 0.79733711376471028132 0.11530272567142739459 0.4043749032514269981 -0.18270536126664196908;0.66672413557173992871 0.47101794937765079085 -0.49218480105918593903 -0.87183790199515021069 0.22858540522961459662 -0.34076261724450301882 -0.99282806760108588406 1.6616780477304420316 -0.74381705206045456436 0.017637008626336016931 1.1958267920101606219 -3.370390009923665886 0.80673160990635706113 0.85077804723505301432 1.4061657456352121276 -0.15685857234120312298 -1.6014380078607985958 0.99282889680357933049 0.57473556051285701329 0.57515063191338755555 0.28197196784531286529 0.69865505407892369849 2.6002426174479693621 -0.015446784486510200043 0.17037557604959152613 0.80901188021296810415 2.8408825291234185428 -0.88103866298975175297 0.209259414375191799 0.29872285952550692301;0.26945912997494769758 1.8088513949014377591 1.2161035799358757004 0.72150539419355907977 -0.1988642358832319601 -0.22482143019128494887 -0.61940753829324124435 -0.98462507079297167945 0.51724550456385920416 0.20835586674011982722 3.1332898991809337019 0.72286036129924546856 -1.2760203828327669751 0.52666006209135218796 1.7126101217651408248 0.5675543443685782119 1.7451725133324067496 -0.16166944360747262377 -1.1802491652161288815 1.8725097753148036706 -0.9768956251635417809 -1.3666476161809633094 -0.27893783245770864543 -0.56302374533566568182 0.52063391792440905093 1.4017872280361283188 -1.443235122146180327 -1.4615112516031587564 -0.066915692425413744737 0.46351991133595205064];

% Layer 3
b3 = 0.25563663304880973604;
LW3_2 = [2.7106937861993882777 -0.18424072356972540088 -0.65813306684935246604 0.22713980800815258831 0.32148523603476591992 -0.8514018202158992743 0.27366720289471846428 -3.2530537205501155462 0.23244737951250954433 0.19660951175193475127];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
