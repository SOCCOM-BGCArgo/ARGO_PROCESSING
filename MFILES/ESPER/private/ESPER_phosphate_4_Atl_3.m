function [Y,Xf,Af] = ESPER_phosphate_4_Atl_3(X,~,~)
%ESPER_PHOSPHATE_4_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:27.
% 
% [Y] = ESPER_phosphate_4_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.62103592092025239335;-2.8479122711582189886;1.9841059181461710992;4.459965055534336642;1.3990919566011756903;0.81146563815967920341;1.2587965980037567615;-2.5787463382635431586;3.191279066468887482;3.604644603992511076;1.0081730249547904421;6.0776548880636296346;-1.5968662105949431584;-0.93050138156145245638;0.56769872400457321859;-6.1582250884687281811;-4.5624128193288271405;-0.82333841534979967935;-1.8057741847950761205;1.7508294734091849332;-2.369662564494426249;-1.1441219056631424245;-1.8581699807384675083;2.8795486892301305204;-4.0946021988919802936];
IW1_1 = [0.32226306110314290043 1.2595316393475468608 0.88557252129010832764 0.050691392429298910705 2.6658189411069508346 1.5411969353581018716 -0.95903626793975338405;1.1725381710608471231 0.95073373026707741484 0.8050362677035997061 -0.35950169118251013023 -0.12783429033912563355 0.36501757423811265202 -1.1535921764138843404;-0.11134548959381507238 0.052780909837466971624 -0.61864277555883373516 1.6103428066444565037 2.2354023963216747006 -0.67361817874605056655 2.0346208670388894468;-1.039320935317507244 -0.093400221545034661785 -0.30829121867342829111 -0.26493056166795381223 -5.9294253873502515972 -0.37007983937901328675 0.0072599610135127574245;-0.19199375221740000441 0.28462847774383637223 0.37531036019108826585 -0.43567895053910610237 -0.02170746672697550575 0.64637244467807364323 0.40900144291085133164;-0.15789100274713915861 -0.19469292084732975345 2.4457400680136838211 -1.6521549037108478331 -0.22715606999065166005 0.15744389131941854965 -0.23097754299160913605;0.17003745406090192693 -0.29953909922453220149 -1.2353681328612247103 0.44145624674956263078 0.79540513361843689921 1.3410997040837200345 1.6023849146923423437;-0.052703931526643509053 0.063374549318607920068 -0.52736700453252782772 -2.9560828026851058148 0.82993283548122209758 0.9177717777000397037 -0.22539383032379994853;0.15059953283996366236 -0.54786422002802392939 -0.01411774940795860675 0.23265896038372924082 -2.777288050736852032 1.8943310689444934347 0.65482426229042056676;-0.1645148033655045583 0.71809840485844911306 0.25484093339788999044 -0.56368399173736394303 -4.828179643482769734 -0.69531425502359112123 0.31416677986636515341;-0.069756826002046787294 1.7338303792279297078 -0.6165560926781079587 0.029851136077350327869 -1.255387350684718184 -0.8449732734672587009 -0.20068235984909435499;-0.18092168020776949744 -0.13725350583615952837 2.1365840476938253722 0.93572679416211179682 -0.44655787197878715755 -0.80315138697492560738 3.5079956216116978673;0.91654471029228867796 -0.16550635643668612507 1.3736344561892868121 -0.2446428344052451187 0.56203587332343751815 0.81926229811361805933 -1.01512857540326773;-0.98073954082475289784 -0.15387328415582957053 -0.42142442121316314729 -3.5961075181835102654 -1.0869651914103788393 1.771027279612851002 1.9714266972105638498;0.58757801784700991465 -2.4623778531679079151 -0.071888946549558713217 1.071144037666091009 -0.16339524875192662501 -1.6275999729729020427 1.1027929709587132034;0.42408273109795729949 0.51949545931441165614 2.9264954485600318534 0.4880778015435016659 8.8891602986387052709 0.17547318538879436156 -0.030883402270605011392;1.3147229675462426268 0.74465508021715109965 1.0410894118843276868 -0.26504537915573689322 2.0021153470655268514 2.0779437261781423807 -1.0354568872918159528;-0.34541648172181965704 0.35169756173919636266 1.2140176145207726144 -0.77841111016032527026 -0.57260184281417780827 -1.1369532291884869579 0.74235483269664948036;-0.83681081374932819728 -0.424190690692066108 0.54212007499336056782 -0.46078535239054779771 0.57690132156288065346 -0.99655635830772515416 -0.30797016518047692912;0.87649528806027721117 -0.49893495791455566568 -1.0645944749002040908 1.0273589130995826046 -1.9945387906276785817 0.18086039865594127907 0.23116756245459638142;-1.2451775119144623538 -0.049379828468182611345 0.7556828123009464715 -0.46550841227882366891 -0.45611897372888821067 -2.04642088735138028 0.41591002105397445465;0.93980390289286330763 -0.75570645840908878821 0.11631827069724744173 0.75801042400985219061 -1.2563505232735943107 -0.3632384656067392803 -1.101573732613720491;-0.64650844274974350601 -1.3473724953310641794 -0.78282295141811786277 -0.16195492736922112442 1.2245249700060036879 0.510568886463693139 -0.49645178166880071791;0.1358992111349613674 0.94554879835781135977 0.1587652263616050885 -0.067125157742151941864 -0.88005635811744253871 2.5518130365741380494 -0.70200211018827041176;-2.2393977198692485153 -3.5533192054767885892 1.0186774340663113936 -1.9346293118485144991 -0.87601438670429598865 -0.49057465811792083654 0.41533518499810229141];

% Layer 2
b2 = [0.90453492652900779891;0.90191321955913994479;-0.88259893598587801922;0.61202794437019103491;0.20770891103709035463;1.3338060678410879056;-2.5681226411327613413;1.0090767882949454037;-2.1613021608378204519;-0.97221150787339161159;0.3055705115085732837;1.0224219824120506228;0.63014141488344932451;-1.6161040647021180927;-1.7558001935955571682];
LW2_1 = [-0.098915876940828303954 -0.86553884059434860188 -0.63792918254167696457 -0.90290852808794053175 0.22713944192390506105 0.049160611043825248878 -1.3164070082349490498 -0.27315806038939771661 -0.51780000788571933779 -1.7573619597147207561 -0.0084152805097828242697 -0.7412026064306732609 -0.81417587420882342464 -0.50084271346891051646 0.24115790614760854171 -0.02853771997220348397 0.52432607308215006814 1.2959247645751765798 -0.59584778587105491354 0.31264193819107427563 -0.23404826156841790352 -0.8775597406011416135 -0.31428867585073866353 -0.36037511948583011989 0.096785885648355121647;0.17623143668044058407 0.9970237314935623818 -0.068564588570356452268 -0.32354334988398697481 -0.38101995143857170234 0.20641417260063998906 0.20191736303260598984 -0.11821258915406131218 -0.24773262473973359232 -0.25759284548357641587 0.29780612636993020192 -0.71198081249382705327 -0.66128759571042206034 0.40744232204491659388 -0.13965806086772980521 0.30669604331144045828 -0.78160809455824920011 0.47407583721769508411 -1.3723373063296313568 0.30692542107126752349 0.8789471574857872227 -0.27832927422436198883 0.15033942337593994565 -0.053057920320058418739 0.30479554561486688069;0.78894496642095301997 -0.61906642900561859033 -0.96981478938985166138 0.33897742378317219369 0.36804549050366291985 -0.034564706697582672779 -0.60963831873832874386 0.30497560781484706061 0.097959969898699789104 0.091937630894432853523 -0.25468476713305943093 -0.52263286093668359644 0.065860962253719554371 -0.67993546528121817651 0.30988783045584450404 -0.39226757131635497933 0.10474186194289686336 0.06448577249553896773 0.13061248566099320501 0.14528020368172073207 -0.62036097424841096792 0.1929002629452671036 -0.36815153565209463027 -0.24672998713000610094 -0.17413859689794519703;-1.1039843998237708345 -0.78354968599205820912 1.2644087608205500928 -0.1730826230148270195 0.74869130864101662848 0.26496884373362128429 0.23243888348650346143 -0.23103784127164478379 -0.72783880976801074159 -0.75214825402263074672 0.023418652868280341595 -0.21775756096453241506 0.10107372567746154834 0.080649984701423663158 0.10043302794244476916 0.021229571093858749797 0.46278460144647243224 0.30555321416417213776 -0.39338010965259423424 -0.22373338997563696484 -0.29748312156721240518 0.53439305517122370759 -0.35193574687080675378 0.59385553502701549089 0.27385764438171805724;-1.6650519415143396618 0.1539558523400711143 0.84240557255582615426 0.1921271306695500336 -0.25970794482020231886 1.5239785922354187608 3.0097838758699273498 0.14568911616867435965 -1.7461745392232468355 -0.22934867444266268666 0.062536569998389010538 1.0817930410855742807 -0.011041155354581784487 -0.60142641900896531837 0.13795969883843123283 0.81866411232774094486 -0.34321265692586166995 -0.092924423341117168285 1.3999214282004703858 0.69236042322154511819 0.17402207732181015909 0.18972522865397820069 -0.010119340678878645245 1.9434109957595024909 0.21479282398098814566;-0.46033148639274296121 -0.43420250392301690257 -0.14689688608250053847 -0.35640012496681655607 -1.1975838127528735111 0.074302066088102650121 0.47451595628899323476 -0.27334756789303543689 -0.79808004865490611568 0.31235306403930634955 -0.20171713762909121437 -0.53647785562966820994 -0.30815880192294409223 -0.28405187744763521485 0.17907286415340831209 0.49918306482409918745 0.66710351419831481756 0.71665339488697488157 0.15748236336425577853 0.20669514000957642241 -0.37048103813068811174 -0.52370192501006640473 0.035907881196717283956 0.59873777444812781301 -0.036225295289877584848;1.0951234271958212307 -0.99736620825322241934 0.72952576337233843162 0.87761701167353656228 -3.4405884851950769843 -0.723952805059449922 -0.91667096928204627737 -0.88155425348531146756 1.8307826817179859713 1.1853472178056521091 -1.3425578322719813329 1.6012142392886861142 1.9915989224428749527 0.76765020092295588316 -0.18661004194129315881 -0.019251607378172830298 -0.34599019210391684931 -0.21866635922172558693 1.0348355669302420345 -0.12877771920395769678 -0.53200626949888918382 -1.5441875470957409089 -1.2000609232276859828 0.18520556676973973231 -0.43223387124288698002;0.51409925576415682613 -2.9367128870039147515 -1.2249884143183737972 3.5282458675199861453 1.2197880203485254036 -1.1764743182901395979 -0.12076194917354199365 -1.4308677493373336276 0.29227996737366729318 1.121995872176841047 0.7719252487301524468 -3.534988124411604371 1.1242111209431615571 -0.3489547777818941543 0.75955749168599340226 1.6634419873828345526 0.81794225954848109872 -0.52200305136567015651 -1.9777828596894853064 -2.0788597403758268811 -2.1235076248787283504 1.0269090922128771837 0.1129554635887544678 -1.4024438992605838816 -0.56085804143703177349;1.2460657154579473094 0.81100334817650110431 -0.78820617022837813348 0.17611678096814301075 -1.1875231490895785669 2.853884190197090831 2.6261245823292149737 -1.0327300346232399786 -1.2154421522755727292 0.077478740805536974734 -0.5755116963046666978 -2.2402045030720194596 0.27284025780573750719 -0.84758247135240250003 -0.51109088402222935255 0.31475077205026935623 0.87025897001960328403 -1.1371003696975643393 0.22935070565962079048 -2.298816745154145913 -1.6144368159062338908 0.3809985158876534328 0.5874889074650512244 -0.27544220907598665482 -0.97709450132114994414;0.66416978486761857337 1.570034798514587715 2.8208896153157869691 0.0060128621869747454765 -1.9496106499018392988 2.3317597033176697963 2.5883770070864096091 0.73945580441133396121 1.4544187400719488235 -0.49881322759373775133 -0.57387615318921347818 1.4246031414458146802 -1.7832367222509122318 -0.39471597607990382972 0.03559584032863095937 -0.10773540283766913639 -2.3380711227079533643 2.0555517337596946881 0.95992103335707656964 -0.12750996559979849154 0.75433634493172063706 0.44562054564527514566 -2.5834028162688333907 -0.067991990124465190304 -0.055897227343400676669;0.38521200216631906743 0.015660760511406104228 0.12671572927035881784 -0.6353355181047596334 0.3188707150433866544 0.74966251905448810788 -1.6162352344692343387 -1.0235940172474811138 -0.74218849020836108465 -1.7761767137166144526 -1.0825274402542164331 0.26482351938499176791 -2.4202451780264735426 -1.1093430866559141901 -0.5606068061212237108 0.53208989118553484676 -0.6654661680310073324 -1.6538452532883816115 -1.9007612395674648997 0.44999633993582544012 0.78293615596870780315 0.13865316783953102187 -0.84701882049667820418 0.059138561225431207635 0.19047606350989973456;-0.07567475450029806372 -0.18996123361365649385 -0.065049815937935948074 -0.28979190306676005928 -1.7208791245435623996 0.031688841530760770981 0.66907448194200702662 -0.2477562387842371372 -0.87589889113413177402 0.85057387043547949546 -0.43047338035975890591 -0.97723495463320686483 -0.037500616747081674807 -0.075754322783736838254 0.059461326681792318893 0.51330405711582127726 0.2985947209477601838 0.45125477248408552011 0.25435001011837887752 0.1477523744952176088 -0.57779442066372821429 -0.38906737419463549577 -0.13048167218676789969 0.65670364994785790369 0.067948009019085778282;-0.054673600487177363705 -1.2234416659375018099 0.61563614557357038137 0.21510614777827197219 0.028269412364022434431 -0.72485335025075525728 1.1131649716363727354 0.042629100056569398103 0.11971090789982775926 0.48734677780391977286 1.8156691246495735292 0.39741391811316939542 -0.40519509471673947898 -1.6387870865982774315 -0.29031814443350512089 -0.65218354808214351603 0.25839848727186043309 -0.81916671284041620016 0.65510546689876758553 -0.84369088868107811052 0.40276078658575020786 1.1459439994678048969 1.3941656771612533916 0.5990343247794462922 -0.056574975213325710832;-0.95165157476180151086 0.50895882761929611693 -1.3892724629856683105 -0.27145820611517340604 -0.009072162813803142864 0.61945586239179351029 -1.5796479214046983408 7.2312807736187787455 -1.3344545166608781095 -0.73886900326263993399 -0.25910800230397107446 -1.6379759943479053064 1.6602231851977204968 1.0406698283253728032 0.97041599404582812305 -0.82019131763948827096 -0.15360974573725993952 2.706741056386538169 0.445093483833165382 0.080089030272919470299 -0.3752358918252014508 0.83151907717743178683 -0.79162639046043870028 -0.75277660647126443116 0.6745644477358877511;0.88419734525731219499 0.79487686879355923253 -1.4940912632173084518 -0.15674359266507403854 0.42086896806378515379 0.59812116726487507545 -0.074464096528316023327 0.41662571138125986669 0.44841102144511763017 0.83571170567588781708 0.056425472373574744878 -0.071397643298516597077 -0.24322262181872209008 -0.38316316287183105338 -0.17190246442303885877 -0.02442798583988955996 -0.60698840004128151726 -0.50470858651075833912 0.60025125828893921565 0.049940759656353667095 0.2120546625856166989 -0.27815704261185320023 0.80452864771650911546 -0.61553288971779218652 -0.27914581964105311673];

% Layer 3
b3 = -0.89110123521743023201;
LW3_2 = [-1.1477420880434803241 1.0152720333336737735 0.67378205564176374409 3.1409439520168076498 -0.65354520062695309335 2.570919075866303416 0.53998591068078771738 -0.41043322478588778468 -0.21661590621050791361 0.22282219193089583542 -0.48122952904444438182 -1.6916319050807606672 -0.17676920978974813847 -0.70050132630409711609 2.1157595758608307435];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
