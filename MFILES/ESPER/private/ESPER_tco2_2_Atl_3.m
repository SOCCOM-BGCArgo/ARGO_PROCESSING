function [Y,Xf,Af] = ESPER_tco2_2_Atl_3(X,~,~)
%ESPER_TCO2_2_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:53.
% 
% [Y] = ESPER_tco2_2_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-0.2178;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.0461352500991908;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.384649585910779;-6.5736311661286013;0.3486560522340858;8.6136658795050085;-2.9070607620436681;-2.4175389098286164;-1.284428537329243;2.6433934624539788;1.9709390031568059;8.1186126880835623;-4.5442503073867391;4.0392684226244269;9.2986586705758505;-6.3723460674911445;2.3711234052047483;-8.7369028881825184;-0.97485668907292089;0.92902213303501158;-1.9012306474789455;0.25009308193656515;-0.20459089913419037;0.1715285577066312;0.84177712007970362;-1.3274744844132353;-1.6977641719660157];
IW1_1 = [-1.0078375881475738 2.1703055185763973 -0.27366043046057603 -0.52324149829038979 6.2636850278731773 -2.0945873121524383 1.2652472421621341 -0.24012534124302651;0.54474997343395559 1.0122239938288435 -0.16647880148621555 0.029598928865450513 6.298064243354383 -2.1435544765133385 0.38593491915217248 -1.373044149898919;0.74978740020014834 1.260751777676739 -0.17570730010109356 0.061471665287254423 -7.4353015389129924 0.7959721295359532 0.31707789715470003 -6.1090168458599061;-0.69111129887518186 0.47874047556553589 0.22079884444902972 0.010620951324445325 -7.9940322881283965 0.93981818785378102 -0.64017125940727893 0.65245992258267049;-0.24522946074105906 0.10505271726765615 -0.39745266775496502 -0.13878699902669411 3.2042477399583191 -0.95999164024235317 -0.63194400938886386 0.015366021746172775;0.17660494864119536 -2.4594974536629417 0.61562403194724702 -0.11520982661042294 -0.56364067665531159 1.0217369665570404 0.4200478679780677 0.41284692488454933;1.8372879725107711 -0.058349925830452454 -0.85756554096053261 -1.6463286403563937 0.48908938494620308 0.52865756183242518 -0.37685235041564052 3.3494608907225421;-1.1146783796522945 -0.96006690338948297 -1.2354843590593569 1.6695534487082235 -1.576187627595159 3.1280914948707035 1.0022407866409757 -2.6021809257826565;-2.164551506520739 2.5833350305888922 0.63566496070149126 0.17001517157877633 0.9698422804938418 1.194274886479463 1.7989970485291435 -0.64579676999925983;-1.4767232617856683 1.120281210989277 -0.064188418314543652 -1.4061460008207389 -6.1666612869646089 3.3906053327324237 -0.35374963697770645 4.194017202328773;-0.60833501776647902 0.16378073164333554 -0.73455193029416543 0.15083509181621566 4.1560924192851942 -1.8960496252850405 -0.82444947270590996 -0.69102295069676356;-1.4194763011062757 -0.61735490196811915 -0.80952402972752957 0.87308517576066036 -2.4898368487989715 2.3343900813495382 1.5785099498093313 -0.43701844845888937;0.034964729366272373 1.3652561444464388 0.42801584407893922 -0.92858623091447756 -9.739043743628562 2.2683911928569147 0.92730629910010298 0.56845114961797105;-0.27372763805236999 -1.5516447615010487 -1.4586785302764471 -0.1082098775124769 5.9567076737033364 -2.5712454668019777 -0.52320653827521413 -1.2133445631474857;-0.62136132343425865 -0.89721965122125114 0.52193668607450383 1.0649927167700011 -2.9172615778670306 0.29734823443568886 0.47589509948191183 -1.7806403988376658;-11.066989571859979 2.3733636002171448 -6.6456829259825669 1.8300151281320609 8.5702452525110555 1.7323518296031331 6.619152312058735 -5.2610362525583332;-0.073666391770465925 -0.10700730329095283 0.040310788134718251 -0.76527691302260836 -0.27303225232803985 -0.1384802118137366 -0.578938327210621 0.34753008023200732;-0.5975159951736817 -1.8094985340615044 -0.94289195638812573 -0.34790906913213165 -0.82115256466039133 0.51679174828754482 0.18879765419469344 -0.082536751920247009;2.640869802286705 1.3578004708365152 -0.95106332219297618 0.086466687672410045 2.4448593338044629 -1.8444659190593657 -1.3435367502045357 -1.4875067341829546;1.1095272007399604 0.91251540800920727 -0.32326761681600413 -0.46066983520903265 0.31166557864482891 -0.37330044175245714 0.089344163668094931 -0.86644230230839125;0.26741307375593815 -0.46688617000652327 0.4240720032006996 0.61393198514020786 -1.496876098309444 -0.017382716404077136 0.81736454468564934 -2.0132509274224608;-0.50730878547154123 -0.52546274511658764 -0.59463235196864106 -0.038991236712982942 0.56106784312491109 -1.1601306429435576 -0.49400354953210268 0.83000915523891727;-0.26728309083793023 -0.33799997165601686 0.47642555481449311 -0.40660504870289099 -3.0220794268261399 0.73675708130955486 -0.28073771209286269 -0.1551109962075089;-0.035408749705757019 0.0065661505620605376 -0.036480955999082514 -0.66867075040022228 -0.20797303429637906 -0.12683019431413273 -0.4496259449923341 0.23405014279731559;2.9241956490171903 0.58836842778190113 -2.684552118177447 0.70692726304928521 10.6879845757112 2.9053173449474983 -10.880600462560466 1.0245996657445631];

% Layer 2
b2 = [37.71610517491645;0.8069014716988494;-10.484812836345121;-176.5873781928322;-28.6618329425912;-348.67504010652266;-67.974204824215306;157.55378349227377;192.47176368539567;-576.76501484065454;-306.45812381825482;46.010515969130196;36.273206655244735;-40.768281024825832;1387.9214756992446];
LW2_1 = [-48.141859477239223 -38.587192398913466 9.3281845535582075 -83.500124801408035 -66.217209556835471 -175.24781013627052 -10.225016902270472 -4.1836776998548197 89.979372884992443 -18.834906115004042 9.7991990684804851 24.322493140967154 57.822364549178289 9.0330018443869982 30.078628600198776 18.090935009774864 -25.38806908699004 -6.0049022055304757 -87.778098254871253 -81.686683656375294 28.878170600570705 98.473019500164312 -120.62969437244915 125.62594280478105 -45.446899883638388;0.073506324982205759 0.097805293620772629 -0.059813142777406451 1.4041053123062623 0.98559619240558782 0.036628315029412405 0.12840665064066648 -0.071871885589979895 -0.16636477130389085 -0.087879426087938806 -0.41800835780545065 0.054542639310157147 -0.063237838175434005 -0.11125967731293004 0.35747030347689096 0.0062026807291508867 -3.9070121024182516 0.18055896629057092 -0.098136556546474032 0.099191786472183213 0.18935620039052747 -0.14974737037901706 0.6933571733470355 7.1036134855825424 -0.0045060217994766383;16.29899601530434 -31.517871060230913 2.1600247004895552 60.282846632866828 -19.947691743185917 134.73396047315563 38.606312698168942 -18.051846884318635 66.978032608262197 33.244094723061998 -25.22055562942581 23.003797352419241 -5.2831593569439281 -4.1435602864696222 -18.61371640758604 -15.975950084912489 -179.05412044286018 -45.726108944385082 -60.216475893696888 168.05021287230761 16.492846587797096 75.838549683983786 8.8619782149773005 110.08860975691867 -69.116637154882341;-63.406861675878183 142.89456219594544 12.228433254765218 -70.83856672885679 -30.176896895788687 17.007667666161471 -35.671653899076787 27.7471765000837 -9.0452710568305434 21.708379808344571 -23.811075684442095 -24.29959522538589 -1.1684148002771537 -13.537102794670517 -88.135170291626793 27.903665515957481 93.386617237110713 60.138200353622899 -42.539920744198483 17.510982022585868 50.528617698866988 -50.749611567057862 -84.979511388020896 -392.06477913433332 78.468011450691662;-465.87553056320019 652.74189384875297 713.21243760731534 190.30960146324077 1356.9107034073922 -519.50905193382391 1141.1434681663648 481.40407693256628 544.85907738913977 1911.9780806954614 -172.12737106284933 -99.197823027126546 -226.93644016756897 -178.68517812944336 2356.4515082622256 -1521.4901157188958 1287.178922996201 -166.39175320976841 -339.15493568419981 106.89692204037637 -382.81335603010962 864.40732101957383 -172.2757781713473 -1124.4367046648774 -193.07927061342198;-7.1202584829936075 21.883424365887159 57.064149255112234 -129.29626930677571 18.318811879410763 -560.71917497145171 14.527312768362822 -27.812805219090738 -19.996315974283874 3.4259252200421049 -17.085209744201173 -17.926598735280372 7.1469905222090127 -25.368902828993267 16.809539598238711 404.35847260139241 -9.4267206178640119 30.863371142155422 36.009085857289207 -121.10344278399097 -111.08932440255252 12.088641457768738 32.265224548037011 -454.75453443548059 5.7095920313032877;8.6606289726666912 -5.3409068039741872 -26.284942724387964 135.76106741697902 70.895459426280979 -3.1787803352738409 31.553339798192106 -17.000318802615325 -40.84367366585515 39.861820061096196 -37.268276954035237 30.713897351323538 -49.121703424009645 30.019822963561374 -8.6679767182195295 -42.627692142075745 2.5767397991665542 -159.55946025748347 1.3188042147817907 -26.822222749255481 -83.380460125643566 -69.768030887043921 -64.805994741822744 45.987303788755192 4.1628850770734385;-20.109741156371769 7.7980073867044073 35.592009153189984 21.29282147376178 17.14566403398797 94.02601049283669 -1.1984059638628903 7.175046896856605 -37.508700162296016 -2.7073602257472547 -10.056968118244432 -7.879936128459077 -0.053950063099554323 19.017902258907363 -4.6438442429434792 -0.68343898723364338 0.93734886552182428 -3.9612654471078717 -13.622775009138548 6.4370298408117863 9.5223469678329362 43.75865210934964 189.92903565777181 -86.282530808526872 -15.015370554792691;89.003123131380974 -57.18767562431217 23.652275977228392 88.061945673138311 -52.474739408220842 -193.12014458013269 -61.30475654818202 6.6441473374354123 8.1847000540211834 165.70586543413134 -59.969472838960328 -27.942437493711076 -150.68418336287883 125.91029833409847 -46.988832550099843 6.1358591985134909 52.43204656846774 -47.579874013756147 155.87658927332055 -130.07345556367886 200.74254442738751 -213.95515040120208 124.10389550091747 114.60424946527648 -123.90969265671953;472.38527395130529 36.961331758351477 -117.62642620007232 -9.9158549742928876 -168.3244316940484 297.19178141421713 63.876491103765503 231.49752934885097 105.05785130929405 -44.149726241651337 -49.245949813034748 2.8938496649782595 -48.677857222498666 -54.165013029145513 -86.13989738207097 -227.88873988737546 155.81872827549444 -80.087331478995225 -7.3627138901516913 32.734944253043523 -257.73038217652231 50.543643435679684 784.00306714253065 -1689.0323142861885 173.6272022570995;32.515658860149451 -144.78598763642648 -86.986229980405582 127.00332381535337 -48.035828515613439 -564.93596406357517 -256.6441107421179 -43.64105749998496 53.284866108316223 76.466968679671808 90.500010060854507 25.39876233906428 -81.732193757731011 38.528738930734661 -172.65605168017041 -33.456023086174298 -92.421268389174429 -88.792153023365771 -196.00474502523477 510.25220619530432 -45.529020929858788 -115.91287468612681 -5.9147221174810953 619.4262399934762 2.8988169947033882;11.625974620383566 -7.3661132711726562 6.4056807880088797 -6.0491357103048173 6.2999054687279479 57.947798248641107 14.330084126859234 -8.8293766505486264 -5.5287480819023083 -7.2279066134770238 -3.4416922298211294 -8.7932597165587705 -5.8732475131399644 13.443554357851694 31.941782331439754 -6.3523736443084973 -14.345052061066134 -1.1676140580893235 -8.0341224381464968 17.612690333982062 -18.238585174052425 -0.78156624880146841 -6.9930221275760083 18.498338453344886 -8.4533370737317561;4.9757640943062125 -23.467734150999974 -14.538135890008759 -38.061022237780399 -51.661845991461711 42.032815732782254 15.147571735771043 -5.5844881226545313 -8.5124696024085331 -23.926679667803906 19.803595942391212 -3.0296146463820146 -1.0572206014150825 -1.8274650572671882 41.592753717967334 3.7250625887333091 34.477915620806833 0.45235749637068334 -18.528365511177274 44.266532707882412 -34.290243631026804 -27.878623581428279 -51.190619792613504 25.162353346755769 -7.33889324473465;-88.128837242509746 -87.535727983151119 16.4188844652823 -28.748406132013994 -143.05266359936451 35.298773332717261 12.584464799275434 -31.901684760994954 27.249939519547016 -60.205388276485948 -25.899251916001209 -15.712587750453753 60.048996107086111 -73.114541452989712 -91.649587862657526 48.337523088677841 34.228570069800767 32.399463941263207 -158.19888312867107 114.96693793454914 27.933630076623164 167.96463867600644 -114.35917358683416 86.216916472635603 -2.0999804351366125;-210.80784788162379 -310.6348891638325 1332.1615271674702 39.096211065554947 -365.60422987505979 614.70508749670535 116.63245556456361 768.78590508006812 -188.24746244189629 -381.61369798325296 546.91760372556075 -635.90794284322965 -260.28153358642157 -819.50976280297004 -301.05052598170562 -254.23591939924719 -406.86283547626766 202.3183034432318 444.24283490555837 43.338137745639798 264.07426326981681 989.46182605546551 1391.6467257972765 895.61494728221555 -114.93790136037751];

% Layer 3
b3 = -1.4439971793634567;
LW3_2 = [0.00070413309349726615 -2.3681884496856358 -0.0026819143500867188 7.9828195147900412e-05 -5.5621245377600239e-05 0.0026619298765523224 -0.0025415941793338719 0.0012355347110042073 -0.0014610818980327709 -0.0013439863774925604 -0.001860964197673736 0.0036656460974778282 0.0021692305032210341 -0.0011011773339416678 -0.00039947785007505513];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
