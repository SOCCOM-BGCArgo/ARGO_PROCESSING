function [Y,Xf,Af] = ESPER_talk_15_Atl_3(X,~,~)
%ESPER_TALK_15_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:51.
% 
% [Y] = ESPER_talk_15_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-143.241523403244];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.00458552991639557];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.2461627143519638;-5.2184952179817383;1.0726152040968693;-0.39619739125104753;-3.918181462392849;2.7283274827782664;0.0075078290180326029;0.63321115095131042;-1.4821653198015776;-0.11379726471836625;0.29965173454338678;-2.5928491786820898;0.35148527282329167;1.1061391308189878;5.2389026561328231;-0.39534753603800099;1.5595403664970959;1.4844235560423809;0.14926645343028794;-0.91020729579814907;-3.7649205740717835;-2.803670186543207;4.9248642070729884;-6.2096793462654629;3.2753873734417405];
IW1_1 = [-0.27606702173910314 5.5531448742431202 -2.4520120126545497 -2.0022053427947948 -2.6199342872555262 -0.27874827877258457;-1.5712584188508745 4.0773112957343471 1.7135853139210102 0.98613006627130584 -3.5339279760611486 -2.4398307292206267;-0.41311445841464373 -6.9229334144155432 -9.1604288679938346 2.4765364511923775 4.1145188878856285 0.59757056416664034;0.20231341407456413 0.60571894778307989 -0.51909713631599863 -0.72096844797158854 1.2200622855560057 -0.18437964758093153;0.55789338485562789 -0.62043273602837246 -0.54199371045763733 0.52990475761028888 6.8962783622379726 0.68717517106641823;0.039461642645729572 -0.6252713829156803 -0.66187998149707861 -0.12513413878928215 -2.8159288709478054 0.16961852909975561;-0.61030029477007997 0.0049947889912968892 -0.17636660693551909 -1.0469924849072938 1.1238223060920007 3.1347458513011714;-3.7691713916049303 -0.12756627834180712 1.9791920221483206 1.2370544957559713 3.771503932280011 1.2364957662092744;-0.43463246520760401 -1.5895010802681924 0.74898026172976129 0.49953128077125569 2.2422670778830871 0.46713364928145912;0.083591256690080912 0.15525385710367673 0.62220134924311321 -2.2440311221604414 -1.097458174375546 -2.4740266408491549;0.11456859015384914 -1.0284326134188888 0.39732944454454266 0.23163389445751537 -1.3874064258794623 0.20973265107058248;-1.5334803159934469 0.8149149659064332 -0.54478023889929994 -0.82648809585745331 6.9261351597539846 -0.91649254645896927;0.4913627549726573 0.47611262037188296 0.25131982838401523 0.755514707887462 -0.92394863378413983 0.81297043406576952;-0.62193276279010967 0.62229273566513532 0.11025305859288118 0.081472886088460483 -1.5658428587290245 -0.11452901842138814;-1.5628398580347913 -1.0959228265255394 -4.5067946286557792 0.65087903145653103 -1.7636940842876703 -1.3046332404321279;-0.25127538539963401 -1.3180803082596151 0.31846495415205217 0.44457510640802794 -0.53907281308094956 0.26469448631739761;-0.74773274486428909 -2.2694059740985 2.2340874035986675 0.90331597409046727 -2.440358076422418 0.21709705053808448;-1.8670021768312599 1.8263555551435231 0.53710270208919819 -0.82871262254441802 -2.1668288417256525 1.6843038144479459;-0.1980790036510279 -1.6824149189062532 -1.3481877922453429 0.045520856143590332 1.5345671506784926 -0.34635400673864258;-1.3307701279314252 0.15168672556143928 -2.4797314868448259 0.55433420120270627 2.3540814346845518 -0.73985679400081872;-2.31791584247601 -0.34566755687044565 -0.87556993960917462 0.66058853387255223 2.8275718056331614 0.21090857837949431;-5.389987239225233 -1.4262529430183835 -1.0238775277518501 -0.30856573165161705 -1.18827109306003 0.27074560247147544;1.4739676574340563 -1.7819266338026689 -6.9301076092542582 0.2720564218593291 -0.33240691707415926 -0.65055986148807676;-0.047374576110806511 1.6385490550210042 0.091598164864767365 -1.4031376736841166 5.0699272770256991 -0.31817252413286246;3.0926180973484829 -1.0530995272969905 -3.1753740828154062 0.13788934053905405 0.3169667812750232 -0.37448485449196012];

% Layer 2
b2 = [1.4269348533816812;-3.3842681981336855;-0.16404501909814351;3.6443537233051582;-3.2468537842766665;-0.83933519175895521;-1.8053408974819041;4.1069941148128279;1.6599243175509621;1.5123812887002306;0.15635241070797951;0.75813629976290953;-0.066221995389872265;-0.62796889162497149;-3.2893871793487777];
LW2_1 = [0.16019891637193023 0.46549972345410684 1.3849185758784137 -1.391403732167253 0.57654015250842583 7.0019935968375533 0.053198748769351697 -0.074468584554629125 -0.85528860935701123 0.71360241920623901 3.2625313611879618 -3.3983384800485608 -1.3703281633299513 -1.1497414946974049 -1.9817955495975885 -2.7780501761682412 0.46117881863717602 2.0704744821975596 0.34465583435630232 -0.26724616970729248 2.9439140189562245 3.2499859561305735 -0.83598034440955538 -3.0021010400085846 -0.19913958224652525;1.7882877770473251 -2.4277117681884532 -0.29433325354707901 2.9046110078718179 -0.24081031166216313 -2.9349077167828468 -0.051110720871669228 -0.54584278724182655 3.8240974542958575 -0.19917429351490873 1.8345217608120008 -1.7403491236134656 -0.62282326666029852 -1.2995285141040722 0.063704082060272532 -1.0896205742759759 -0.61696770928529854 -0.26592410337405753 -1.097581780976856 0.73908191154913294 0.94954579983175991 -3.3603945076715651 1.6659903499453619 1.0273229402378541 -0.29715543660893046;-0.12096188713711456 -3.9286836374519027 -2.1252886143654433 5.0052373857167831 2.6303433865430201 -2.0800662647654202 -1.214483191954234 -1.6260409678229397 2.6554467820689642 0.32124540567988052 -3.3415759191146215 -2.005076874103688 3.9728985108002259 0.95982666274325135 1.2018756023708133 0.89415133492966081 2.7874155413195676 3.7265312787716391 3.9753927889266802 0.12870472387678206 -1.381838155366822 1.9576111346414065 1.3045876045974922 4.7208274427986137 3.3713874843953668;-0.56926860643899158 -0.54108620301107579 3.3634382396518192 1.5173791376254395 -4.5619264025884716 -3.2129251483103585 2.2197698539721218 -2.4393263255215181 0.38378508910734749 0.77888768512789386 -3.4372130673623702 1.6114793879958766 3.3268277082664737 2.4304984619610575 -1.1926149306237175 3.4320686277904944 3.3294287123723914 -1.5444749001482567 3.2039689869807506 1.8534769879948974 1.596245714013572 -0.25643374922687395 -0.11963351048546876 2.6255512652525952 1.1372896427785051;0.3576092312897744 -2.1450698782088944 -1.0304459077683155 -3.1925200993374387 -0.79248807373454833 0.35698653848150108 -0.09110083900476032 0.65208844033874724 0.93376136654561548 0.33356405027570007 -1.5356592146420307 0.16576361269266862 -0.92795490387979007 -2.8262721890629954 0.83552030585453907 -0.90130412475595156 -1.1929372586858391 1.2004708836906031 -0.080906847019263914 0.03802230775039224 1.6558735692295443 -1.4542334087804509 1.5507756734466112 -0.90129789901121171 -3.0925939637272934;1.4370536377736292 0.24680098285706395 -5.1640438774779067 6.0764964247365283 1.7301230719331984 6.6025300593757654 -3.5264275483087242 -0.63191891226538843 2.7810249348725025 1.4706110218453137 0.64431036483698212 0.8445653299610193 -0.89082575931419339 1.3917077250557683 -0.88943665459417087 -3.3252513378314297 -0.034920292955535052 4.2446344381226169 2.7943301117607704 0.34526599674639741 1.9020826443647678 -3.5932944866213501 2.9322340305915229 2.5797398560873521 -2.3139206492145745;-1.3402838777022061 0.028324969883640583 1.9544577576403162 0.95114777982577647 0.47046336988921916 -0.52134863398006148 -0.37030348040645666 0.71206382722636863 -2.6621125038645599 -0.35809045961837693 -1.4507183421570886 1.5333927904239149 1.4487006729844343 -0.99998440818973999 -1.0813142040285064 2.2808261243839238 0.59286052839153403 0.19475789638662674 3.6110788657423618 -0.24807123161102032 0.99564459057096066 2.6398283452329627 1.4968621105208624 3.323873868042571 1.7911713411631025;-0.68893105208155114 -2.6306134886499581 3.2392979628735783 7.2979481309801821 -3.4150806588222684 -3.5651841689971131 -5.4306534182982933 2.5884506487535432 2.5377213249116957 -2.8737519332163584 -2.626117779688764 2.3850262518518197 7.0313864389503893 -1.7425470538484134 -0.71822896333486741 -3.6921173945192791 -4.2744479653953666 -4.4052019137148601 3.9619990360736819 -3.5937578111078099 -0.77245757501627565 2.5519902843015254 0.16331527497116483 -2.0494204409679613 -3.2310895873917502;0.41178241435552221 0.39348886464087385 -0.061843334757006152 -0.83320127837317814 0.14858745625964861 -0.06634067364926223 -0.18781211497242495 0.18173201449249923 -0.97185018894990816 -0.2989583113328389 -3.4973427511355792 0.11571746053559287 -0.37292368171176854 -2.3793864889866332 -0.76955041889059728 3.0875648548043246 0.0024766395659324937 -0.52726017646833623 -0.73717014352371335 -0.74125215456298221 -0.97125614964158458 1.6958466637520437 0.31478604890055534 -0.031958629599977924 2.4108822038481459;-5.5562647712376432 1.7751080871450287 -1.8534134059236171 4.9851977076104061 -2.7201290592274066 -5.8875225711689341 2.0659023318437102 -4.7238457094855022 2.9098676918708692 -1.7780759009519493 0.17508152039247168 1.3652180906014177 1.1705354781848614 -0.63152638482928014 -0.15314132255905963 3.5723373192274321 -1.7892079433256911 -0.31824824256500256 -0.38240337832985605 1.4777619933310941 -2.1773394377089934 -2.0035075257949733 0.782851077008487 1.2161179481122697 -0.12238670000585261;-0.61164613947901636 -1.975741402721362 0.024513813503349989 -3.223778552410915 1.5647852649247658 -3.7430933388296355 -2.1016592227501896 -0.73443844747133658 -3.742425979355934 -2.309880517273704 1.2648852902721979 3.2027839659405641 -2.4583835023779335 -0.046090631195298853 -1.3155579416308578 -0.24649478888390591 1.9054081081364216 0.15348709413259115 1.8850632960022315 1.7242615145883495 -3.3756251088166023 -0.87170357700814571 2.4067076492695767 5.5379544515814434 -2.7439522842651827;1.0537496741023971 1.0806271733549628 -1.021283945510095 -0.38178989898916643 0.12604825055542829 3.590765998084863 -0.4927571396268805 0.36711764821818782 0.831056131032887 -0.50773872068544879 1.6774652207484071 0.090644948118996482 -1.1815772322729714 -0.76226394638923256 0.26049009410658308 -0.68595210732649392 -0.90280778838600606 0.42594890246514411 -1.9085642364790445 0.082646003146977093 1.6202265863242145 -0.48086071327663499 1.5902460269215022 0.87739957277074532 -0.067109246731869271;-1.3957826875065507 -0.72400685412191512 0.17850785611915931 6.1338189941941952 2.9576227531734562 5.1147052818980381 -2.8599737755237151 0.19449527575875925 -2.5965234549675715 0.55825754348231871 5.569291125077708 -1.8181268813675231 -1.0331202976432963 -2.6925356098882931 -1.2129460512355432 -0.33482393495340235 -0.30416789611077621 -0.57557640829560419 -7.7449162195035228 1.4699053716842763 0.60282193093861736 -1.3761120916735208 -0.82801757724272551 0.099816836903995232 -0.29468930927020331;-0.18584597803815575 -0.040813434910025093 1.4071013617077799 0.94347364061891836 -0.10461921218180555 4.097328651156471 -2.7541973842088132 -1.1529421248292044 1.3521211319936706 0.90037939372135622 -1.0994786233333862 3.3425147658432368 1.7159362989879055 -1.746870227595287 -0.85309392344477897 -0.8663127326354324 1.346504356580936 3.3394152678909532 -2.3967923581658996 -0.32480359069802983 -0.60430895448476163 -0.67739171808779275 -2.4598603122393761 -1.9816232026074605 0.72310240096756928;-5.1511891566850805 6.4744620542010471 -1.6458031103647279 -2.313785274706853 -0.60026710700646246 3.0206488455500615 -2.1763288765928515 0.79589674770146368 -3.4246088206781837 -2.7547775456635311 -0.52179985138505214 2.7364087359308309 2.549197030865701 -3.15513071450835 -2.9602037432898216 4.3584182288743616 3.0127665371186794 -3.7111330722187064 0.96907698329711645 1.7684418025973945 1.4643857394526947 -1.0202079598356131 0.66381119823414281 -2.5478890145505981 -0.90746723529152185];

% Layer 3
b3 = 0.46512536931231435;
LW3_2 = [-0.014629244927092394 0.061461663991575911 0.013273251947915616 0.007470004993750199 0.64912994941265167 0.0052773692922172925 0.058981733846695514 0.015854080402002629 0.65214484736070311 0.0024941075877050211 0.0060400977595958744 -0.073332186005956451 -0.011995593362277488 -0.021909704036590229 0.0020664864500944207];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
