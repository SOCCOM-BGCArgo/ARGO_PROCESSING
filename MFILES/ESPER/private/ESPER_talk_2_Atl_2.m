function [Y,Xf,Af] = ESPER_talk_2_Atl_2(X,~,~)
%ESPER_TALK_2_ATL_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:44.
% 
% [Y] = ESPER_talk_2_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.2178;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-7.4873685914826948;-1.7470695661801949;-4.2148581261775471;4.0324572987813116;-9.730479656633225;7.4205663518299012;0.32169405762703196;1.2341456783155911;-0.71597531984611396;-1.2753509631732001;0.23274597606244513;-2.8034111076462311;2.9874525506297949;-5.6818666609195621;6.8321935196723302;-2.3642765127618217;1.003576889987716;8.2724195854814031;18.406048673934698;-2.4110587271187711];
IW1_1 = [5.6523022206430138 -5.3675058575891317 2.099788943836665 -0.16918358851776744 -6.2320416280864475 2.1162371032822609 1.361395418883306 0.50777047077714843;0.43082424274439196 0.75987741931444641 0.082772097732871142 -0.83018005894630653 -1.0588417591847339 -0.74281942545233171 -1.3437723334285743 -0.25632861610907631;0.39972825677461721 -1.1753239914238387 7.0154587164368882 2.5909930675935096 5.7581555744679322 31.101968233605156 12.105930875644988 22.103548202621788;-0.59340735098242114 0.62623440753832305 0.18673288721593331 -0.095037928563940791 -5.0948681162567677 0.093253661805059868 -0.064955769275241659 -0.49651620976862804;-0.16628754440480129 0.37520645869753733 -0.12129832656444432 0.28015797562577949 12.339620030605769 -3.032059288103699 0.30690160909825809 1.2071833381234962;0.20835288870905352 -1.5096354918025627 -2.1019297864315396 -0.55102870505014456 -4.4543717110316425 -1.43285891081864 0.33660525960317089 5.318900305317249;0.16713011357351032 -0.36167491072376429 -0.3053357987054019 0.22628881372474638 1.2998377731978334 0.5532921975067765 -0.084324062819677581 0.71815618884770782;-0.34798205688626027 0.39082962918511116 -0.14201049118020784 -0.21040224231971266 -1.506968078039133 0.010168245624743074 -0.034544562268232458 0.078159738544849783;-0.21628684295735018 0.4814418145879501 0.26081704034194958 -0.12812560689844202 -0.51206990426413135 -0.42968884028841525 0.02274303792700659 -0.53789228685464074;0.78261058987379961 -0.95814979795981348 -0.10422512388938913 -0.2628472092519058 -0.72259740114651239 0.19568156486063559 0.053406976302052579 -0.42341458834922402;-0.08200839159197082 0.15804993498302589 -0.15675131929593591 -0.16076186228236286 -0.68313814120717409 -0.027226084399293367 -0.045916470674168958 0.1423746259943918;0.030750740425270612 -0.39440599149982308 0.25503645070583036 -0.33309958460247741 0.73063762754111505 -1.0140742560910943 0.30916009226810115 -0.68822523421515469;0.78689320700749332 -0.15711522157480284 1.3680003395492752 -1.0776851741425364 1.0610356608498386 -1.0775619963713554 -1.2259807992630962 1.7892200190181353;3.1155654750797797 6.5857908633670563 1.8803539628854851 0.23626463211097756 3.1708028181426573 3.1719715981518495 -0.97059535792586427 3.933329265536373;0.84994552606823015 -1.4985027520819736 -0.31000044475738109 -0.12200719180483843 -8.5074723406091639 1.9509589556357159 0.20690330026085918 1.059429248421361;-0.41900099833866022 0.76348755266565582 0.49652280976596741 -0.37189447455851721 -0.73499300130559686 -0.76234931653250915 0.34414067144133287 -1.1158746657940346;-0.11814124700365168 0.16204282794109534 -0.3230836986987527 -0.30823899418478695 -2.5289369096166978 -0.33022735718074281 0.3601774167161661 -0.32097928774439322;-0.81496227373284347 1.3440687537145091 1.1188758562320726 0.57897083190193155 -9.0346096338825248 -1.2690037982701805 -0.43840605935774496 0.37255465857408521;21.928374656011378 19.248934816076513 8.8115670578043339 0.15841404251668292 1.6175474644294638 8.3321993419053264 11.905685864625339 -7.7267824214891681;0.90571998449830371 -1.1003334865935963 -0.08894122043774072 -0.41232056618019569 1.6145533698276509 1.2316066264499355 -0.059912362636236685 -0.18598735352192525];

% Layer 2
b2 = [-1.4596570855998185;-19.185084731092743;22.885501427912779;-1.5661297867262212;-47.783975448757019;35.537762265856024;4.3267252932735998;-8.4307506670953973;43.88699345680434;-14.952994801687723;7.4902654677491727;1.6503939834488874;18.525704295227833;-18.222590213197904;8.9299964923228856;-11.811002269258307;-19.635394698323271;-17.643914166579979;0.69103269698364223;-17.810393279868332];
LW2_1 = [-21.838173218841465 3.8991678100941369 0.96804709887265228 4.3812016124343343 2.1207348284097933 9.7294221494345923 11.184606502111651 2.4021799443903542 16.354778514666862 0.70201934307444824 -12.355787104558729 7.4932815302761098 -10.908330288814659 -0.45570436855977148 -0.98926780833822014 -2.2869698457474978 -1.7505145384701291 4.5922553324245419 16.936580731635054 1.8559013024212296;10.131934072544066 -12.2232137340264 17.585804478534296 38.185866078955335 4.7417638719521769 -37.941559506711698 -39.724996467674792 25.057333099579321 -16.760220603459228 -28.06555076188522 -67.649342223451868 -31.80573732890986 9.1544247515797643 -7.5345674978860799 6.6172795078829658 -20.955748289846159 6.5941454736269325 7.2872696154628676 5.1712219579748693 17.260442898279155;-13.73361503390116 -4.5456050380800619 -20.073473306667434 5.3258382427056405 -6.2495878603558257 -3.8355576147012069 8.2477915404105797 -10.480521639780688 14.811601647327389 3.5940304293892504 7.1064103120605164 -0.42885646914099235 -17.478494368906937 -12.004227965937902 -1.7455963856403245 0.96397155721201777 9.6670244151298999 2.9543163690329775 51.739329993851946 -0.80271176600864447;-4.6206749270059104 -1.4066975538259223 2.965024326089075 3.6922896502687577 1.6179921694656509 -1.6508028629031426 -3.0079947863828291 -2.8604415607974083 21.211279294092979 -3.812849502624498 5.37673739880693 7.2930014630903202 -31.219756906161219 -6.3563765640850161 2.9870980785916106 -22.985779823787372 -11.937837510243428 2.7955192545601664 -13.040241219892524 9.7606247919348039;9.3535366831978308 3.752691687395981 49.194292090276825 -14.977016584987622 -5.4364679570967258 5.8392357319787394 15.316095487643041 3.5509180827581686 -17.047823386113503 11.168202566210407 -29.974876313542449 20.86944350961048 61.486588731562406 -46.317941155416229 -20.966760367227138 -9.4679206275011474 -5.0218964582749273 -16.401874004588585 15.291186176180132 -21.245261966894912;13.423100790712335 0.8371872645838534 -12.986637257209436 3.3052283056167422 0.90432211107463067 0.02878993982458259 -8.7362848261650488 1.538119102556095 -20.189844776787382 -2.6264642327010042 1.4340416121977348 -2.6225115129105747 9.3536738608590344 26.191867030930009 -0.50546761025253151 8.7750486285272569 -5.8779003612812746 -0.043477635250135982 20.701076076832951 -0.20556983223537134;-3.8584130342503951 -8.2093661917484742 -3.2668483351986386 -10.258634453835885 -6.4889374212415101 -4.4370186287160509 9.495843121928047 -18.899433040273195 9.1837492108838266 -26.548443485808399 -0.14454254589736312 -40.478714073995143 9.5096910266002883 37.599165755003732 -21.222167338294796 3.8415778943129446 10.181557525857281 17.688493300597489 -1.8857128882904997 43.256255363965309;-9.5304937416323909 -2.9295727543444516 1.4649699781433954 -7.5697698929889885 -4.1461036117979484 -1.0446400807169161 -17.081553811249549 -19.017059051067918 -37.538901163409655 -12.209132515191046 9.2803081722064285 -4.1895355690655851 -37.358313086502697 -28.137640113372598 2.6400176007879281 46.896668459126793 19.381825820494782 -0.29569860993692404 -26.318380222184512 6.6075441157027575;28.948034311830838 0.59199730341565027 -3.5873749044247565 3.7725157537664225 0.84522830866198373 0.090161818518251974 4.4730687909953284 -4.2515022143180854 2.4052605542100181 -2.0281726160523119 -8.0728846137085508 -3.0384670914521612 7.8702733225999753 0.36927483286454732 -0.39942136327953426 0.73703403279732338 3.5558828090302415 -2.4696953614110817 22.156647941664847 3.3456513822836027;-13.823302103771722 -9.8888011516646586 -27.592141101740395 26.162545861669638 9.3860938113528487 -18.022907480862944 3.7092561691291208 21.397464676767822 -51.015173794339134 -8.8435447026976544 5.4701836941253648 6.9290225460989117 2.8612497887007602 -2.9244829121538056 -2.6807566830859826 10.495195432883936 -24.608177624443091 -7.8146245442750022 46.564967082654121 6.8570018407946201;-26.232697615491585 -2.0386251940318409 -8.3004647520175432 -5.5164215683112676 -2.8476612368873937 0.84421342960830104 10.436647050318824 4.7400361078188125 11.135964660788513 14.109475999972478 -24.518394348023708 6.31366906588039 41.454292738005087 25.986747778539282 -14.725850617028383 7.0070643384426816 -0.73377993748256021 -0.46227611029695143 49.454956859867757 -5.7720918114573312;1.5533723225906748 43.626872970780319 1.4274792573410564 -4.4750319905386897 -8.737281471670606 -10.99758445752399 27.985332350913122 32.394830694881769 -0.40120468505294049 -9.720745011638293 -5.2478767678871954 27.473577185228468 4.7572724991952198 -7.3428694240011776 -0.40924407573333238 -47.614848127078062 -24.291093106364841 5.0929735501563833 0.29206069401123158 17.649880881264441;5.9928685949884271 0.13875414496274019 24.514881864512624 1.701311288606794 -0.55356279392440189 -0.00059534922053271905 -12.517590389325164 -5.4973852907029954 -17.951072388708081 -1.0999532619390064 5.6353936592325162 -2.6741432518870991 1.6026254902228296 -8.7461046064911585 -0.17915152738519036 4.1651077662348088 0.50504461159220915 -0.39376354882253761 -0.020341728239723657 -0.3352415422794997;25.368587551588064 7.4262853298432061 20.074525781896991 9.8183065184601421 29.087133901897126 56.530979725347713 -27.595181069363317 -14.253453442038792 29.754616282540471 53.404013880615409 39.561819218104795 -30.138975020033616 116.47356008931045 -22.105762662295614 -0.054916904857197683 53.037693408737454 -37.887552814580665 -27.576894699140887 28.984614986798555 35.268451176542271;33.94985149242379 -0.22608621976282336 -9.5129231762977948 -4.0545627705330478 -6.6410571930461391 0.98765547288877031 0.39096738170547424 5.9264496191224731 2.8360967152838761 0.30502956061558723 18.06585828998583 -7.3253264993190443 12.400553364417597 20.489085388231075 -2.6462470967113032 -4.7757595533808264 -10.166268191800329 -2.7538342976071668 -22.811306397867938 -6.9660261124472891;13.51227526155769 -14.796033845654563 2.2216619387645404 34.215156463772267 11.393049377013295 36.193954994672943 -22.960013764307387 -9.4935016705371815 5.2724397637014544 44.228310199492313 24.839321894331274 19.595719288235497 -4.8717943843540894 -16.857776396358865 28.45764680570889 -1.8454865162629219 -2.1647079756806962 35.784792988002394 12.972447825538811 10.411817679675268;-9.8822882914981935 -0.7737146401836662 -40.537311991025341 9.1467671034237803 2.9987584336409503 7.7964555065141008 -20.960110212224613 6.8415406784653472 -19.675351406542902 1.7099235366209664 0.62682144614595514 -16.112434423656314 -9.7660144526701629 4.5183050031102878 5.1701157593003098 -3.3723133722987213 -1.9020339456745097 4.4221060252127646 40.130786285077832 6.9530683482145257;-46.40419800550832 -2.8905571393812712 -5.5205440715946068 8.9669230379175158 4.0611059565215957 -2.4017571163008022 -29.51542985861591 3.2268566642746261 -0.8454006793747697 -0.20884188919369415 7.5600297064913429 -27.98547704162301 2.2409554771093552 4.0302717414803935 -2.5773926598784178 -8.6902527573525354 -3.3483871833106633 -8.7473273675860241 34.272452805695231 -11.167188279324069;25.022627155383748 1.4421065313318637 -5.7674193521372672 4.1473239855131894 -1.3017073434933701 -2.9039005555378647 0.82755142601748488 -1.7482264964529119 6.9486658592508341 -5.1172660478327376 -3.1872473664080818 3.5745399275911072 2.2231831186823148 -1.2889411729584914 7.8042978191680454 -1.0525715299152318 -0.33431840230831444 5.4724742488102693 -10.785376305659687 1.5458567776579601;-28.195162961818379 0.59399297706320109 1.4075620929140962 -0.80547373293145164 -1.5574082701549234 0.32917688627178832 -5.0581499847334701 -6.3219714389577781 -6.3211975395251354 -5.2973005218006222 4.130290859649123 0.019043491678413432 -13.256751712840039 -2.586055382249242 -0.045786311341037403 -1.5757133557803922 1.9250323136665133 -0.0014391423906820735 -0.088453224440615208 2.7950172931680282];

% Layer 3
b3 = 0.16376738790880213;
LW3_2 = [7.4522187596368116e-05 -0.0013603341837266948 -0.0011550596644904372 0.0020923459811273666 0.0012826516792958881 -0.053411676414659853 0.0012812012754276863 0.0016341864310948897 0.30063683733980823 0.0023021472561130601 0.004099541325467122 -0.0038516401990941725 -0.190782846068383 -0.0010786076401793437 0.0020558047638269787 0.00073606759771516618 0.0012578230620286426 -0.0062004409729055675 0.0012724753897511865 0.18812817068484453];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
