function [Y,Xf,Af] = ESPER_talk_6_Atl_3(X,~,~)
%ESPER_TALK_6_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:46.
% 
% [Y] = ESPER_talk_6_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.2178];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.7879209656760124;-4.4038163344944969;1.5852926899297364;-3.9304064055500048;-2.9744493621635746;2.2640132039796557;1.6334153944470218;-2.2046284804999492;-1.8251400620490428;2.6974968196730029;3.7785569249458284;1.1059135995683804;1.1375152426086617;1.1826653025048264;-7.6572750844129454;0.2291404576697135;-1.9294935276027516;-3.2852025592125513;1.0194728703427502;3.7105185155342877;0.75430374226666908;2.9203712946753284;-3.5552109510108458;-0.72782712608035927;6.2238469832771939];
IW1_1 = [0.77723904659851073 -1.4019144484561918 -0.10243592963419099 0.26291850897676194 -2.2192292113885701 -0.1415352379363215 -0.40753547630222664;0.24826944922028463 -0.64004527814349821 -0.7710988060165439 0.14704820342481834 4.6938427800145757 -0.3340313657476221 0.41464799756435244;-4.0767669894309195 2.5203570250209593 -0.66361902894516844 -2.79713249733642 1.1479408148732815 -4.8239502429071148 -2.2583047748037073;1.5584672907747872 -0.089370416650792692 -1.4735775050711295 -1.368880178584724 3.4795596263579398 0.94178978203387476 0.38652639260068472;0.41381779203558666 0.44364519916532513 -2.7738155859481841 -0.4155076453293467 -0.67319853643185201 0.19719774751594932 0.20721217124077623;-0.58408724119776523 0.62549330316064611 1.3082543789974503 0.71810311643752356 -1.2686366410399919 1.005390592342059 1.0064641456649499;-0.44699061629606213 0.77131761194093862 -1.2031023694165248 -0.0816201937321267 -0.44272330153820938 0.52990717048333025 0.080946228583224991;0.093321126449183223 -0.35134256572938982 0.09488892197896881 1.6565844103629717 3.4897731451992171 -0.56309573481524244 1.2936353112775669;-2.1323683623859639 -0.54662938447682197 2.5845138957787945 1.4322973656587623 -1.6340773511068312 3.2791059059157708 1.378246757848264;-0.75995571539254347 0.82971184744094839 0.30258874012297399 0.47187614869254024 -0.43634788185057694 1.7245814839904625 0.13773743752818482;-0.047319365636485651 0.61133892281427948 -0.3973218561922599 0.016647786713217608 -2.9164615634043032 1.7820688520371013 0.0032420981143107528;-0.35657909426414536 -0.51336873765281932 0.30645835238884117 0.27736112617813152 -0.91418387496674236 1.4838311454752515 0.23053260123368194;0.222403091769308 -0.94881242512537345 1.6070994461776484 0.11197796553369214 -3.9010013345249881 -0.33651493494815116 -0.17348256817125074;0.45322145525183621 -0.51173452275954467 0.75279986400791266 0.08464652680119944 -0.81640318986986415 1.8293668641037732 -0.37270185371336173;1.0667682975979915 -1.0365957353392874 0.058899429823988214 0.29399399693595601 6.8247389331964472 0.23130505177727892 0.095083364021086497;0.98262858619728144 -0.68152464758366293 -0.91329199556063634 -0.094812581728094592 -3.5455480257617786 -0.88293599604990092 0.016899422012029715;-0.072753918281570268 0.59865263948897052 -0.61429253414543827 -0.97165041693109233 -1.751257028281739 -0.35552566952731951 -0.87216596788980805;1.2688405649126391 -1.2326317670268709 -0.88495555864049569 0.016801860770777506 2.8809107587121323 0.44423707996124084 0.22792454023009637;0.18950734611763739 0.3891741910085974 1.1410657172235406 -0.15943982023876996 -2.0788273985953101 -0.32386632309294566 0.066228043370921141;-0.7727108242380708 0.86316173595586287 -1.5464716153896985 -0.75283117390538157 -0.71801685496959577 -0.77837750224726787 0.19009950386920296;0.71937290450038871 -0.80371231909454766 -0.065154048637976608 0.53492777609507702 1.144011550787766 -0.74495803281029915 0.46949620127658626;0.56174272323401431 -0.69732204468945169 0.73611145873691763 0.088912818169922719 -3.9538571198176724 0.39175277766260058 -0.15990447640594296;-0.68205076700629619 -1.1290728739782325 1.977310611834616 0.75473834457132516 2.443700886589288 0.67857316967497461 0.13529470879273825;-0.17272542593356957 -0.75734342087887629 1.0296724260743473 0.54328248175407468 0.2403306275047484 0.24606458518408539 0.38791285285699301;1.9478807024008258 -0.15421071635989778 -2.4464550807760754 1.0589691688864333 0.1797927355741416 2.3837141367026935 0.46802640600647821];

% Layer 2
b2 = [-0.1820074118420543;2.9825554664639609;-0.51561282503357664;0.1160477583609499;-2.079070133936114;-0.14104010336069267;0.019760003519013823;3.9862267385179906;-1.4198886133976591;4.3965133900754791;2.3204293417009545;2.2727844172748184;4.7093930252208249;4.4153656215878829;-0.38357521496183855];
LW2_1 = [-1.6434873079667021 -3.1824369879905001 -1.1492416289625342 -0.85499526936004322 -0.81423911375219837 3.4754870165966123 5.5956909341350327 -1.9882587785389052 2.1866274286265668 -2.3937765164209703 -3.0964970836953296 0.0025228246471589635 3.5147672739452251 -1.3855940285068928 3.2697597937447735 -0.1499747256062556 -1.8258428746938236 2.9892519901537282 -2.098552720882279 1.8611163667759703 -3.5160540293758467 4.6714618814774287 -0.49477371241801787 -4.1321844525800904 -0.34380398332306966;-1.0683317581312406 1.0116188641813386 -0.47040229751881857 1.4781928872158405 -0.58723074579006951 0.78899038787825604 0.69153688348072628 0.20045527209564293 0.92349931930598994 1.590390403113269 -1.9622450327357954 1.6866826794328906 -3.7861463277654037 1.0226332543346628 1.4374283769602636 1.6416674368998965 -0.4892857776697544 2.6953074504006689 -0.92769038376315038 -0.58765198369559968 -4.0511148766599971 -1.5587459979154279 -0.94297987563436525 -2.8865519234780499 -0.7501825447546524;0.039728603618975511 -0.070834058029316846 0.10973156618505019 -1.9141232827112169 1.0288329537307723 -0.062167267712216874 0.84043642612854752 0.53941218233898103 -1.0518830750879327 -2.7242975220964492 3.4982261748346741 -3.6962389725773912 -1.1324741460913765 -2.9936847468822041 3.4362429470122424 -3.6192046322866429 -0.50750961106789771 1.3420484696439927 1.052773104431332 0.7404991768789263 1.8299770125679564 0.72519355811329489 3.1324527112950871 3.2694929191762605 -0.49097127843474564;2.2496829735996591 -0.17670850073308059 0.068962572039769271 0.25074047250650355 1.0265797534221528 -0.23215698438625312 2.8694776620236602 0.43457190712495769 -2.0518273285931548 -0.90210176040053991 -1.175322194606222 0.34566972537737806 -0.27128970730773061 0.38080835631383686 -1.0157426407120742 -0.71864381508357267 -0.56636526647769592 -0.70241748028354867 1.588198777940292 -1.9188029005964393 -0.21304771587661508 0.88698351937266096 0.64867046685966423 0.010414275620570748 -0.24894518808869337;-0.39345104828653327 1.6041303232887869 -1.449263965131149 -6.3450720607702999 -1.7230902764664375 0.51939030145785714 1.0586845282812314 2.7851095982088605 -0.08080012296748447 -3.0919232793487059 3.2284356584894791 0.95036104953260292 -1.2554045511866345 0.96419812580794517 6.9426488723908326 -1.3466769553019662 -1.7495867233683455 3.1299161389810499 -0.3716657195569224 -0.42979584227001105 1.6139229688519672 0.10898572272147129 1.0159087889054412 -0.49692724243259789 -1.0719908077457718;-2.6027746705241079 2.6090328707995156 0.94283654432652853 -2.2334008150635594 -0.3316430834697468 2.3838579246348339 -1.8231955424182917 0.079545464263362495 -3.5107678406505434 -3.7953959992211659 3.7424328752350471 0.86189154949848246 1.0163445404359452 -2.3536487742737546 5.2909289433655164 -5.5531421588469412 1.4298846901180498 0.95064931946884346 2.9627779844817153 0.85419280669622244 -2.2821664369622261 0.91316833846868439 5.8943561866671246 -6.7059526115122514 3.5729935081018249;-1.2823995687769738 0.41162797671377976 0.12543479737809876 -0.15200448946789816 0.28192609444748512 1.0091056709254589 -0.38388525398996565 0.30465934487136048 -1.4216117929073662 -1.3010780353059208 -0.80379498950650696 1.2768774742174491 -0.39123206214639461 1.0823673513488603 3.801555378455447 0.16327643785726489 1.1400223848803754 -0.16817277629569802 -0.59057339340522963 1.846664086385386 -3.3128819495389976 -0.41236578736325558 -1.7506918022072653 -1.3647561906166723 2.3735702779943835;2.0724023591271457 -3.6281450318712705 0.31851240870514419 0.82142083544698663 1.2305127607423285 0.22482580951757436 0.61699411376771307 0.93119452204375242 -0.37671742147292614 3.1759032602650512 -3.0391518736962237 -2.2472405188364122 2.790142375987958 0.14441590845002808 1.4946512682567137 0.71818305191413012 -3.5785805906343087 0.79840069407765424 -3.6807464450377188 -0.44466255053578152 -1.255814586480102 -0.39598795214073468 0.45713943707736748 -0.14339132186963291 0.2362958909775964;-2.2425864672038403 4.8725156366703049 1.0336799958991705 -1.8868073970381987 -1.573051292976801 1.1256929688207387 2.726429063823602 -1.8330204277632391 2.9492435810572055 -1.9517286037921999 -4.4847009799039768 -0.27170541357879641 -5.8072959243098561 0.74410506319638148 -4.3390842982454867 -1.6108559588769591 0.17903659672619962 0.1675469223076359 -1.5562223006382045 -2.0926457679391834 1.4622973651059985 -2.951757800846333 -0.3459843574936553 -0.13400586387221039 1.6428747132136414;2.6721033488117212 3.4150099602495319 2.4986373260140171 0.018541977201280355 -2.4078973468077205 6.3945730878928027 4.8465173148705549 -0.52442001523004167 -2.740847353296902 -3.2500874038006056 -1.8540572919723468 0.87352477123237915 2.608535851539036 -1.1706765210879611 1.5141774712448983 2.2835931870094557 -2.9030088139433592 0.84432328088044262 -2.1028864358625072 -3.7235056554588324 -0.76012140038555587 1.5306716919380536 0.19906416068914701 -2.6374875837653513 -0.99641429841932239;1.5883893323115503 0.66173768550724021 0.098566785688665934 0.73453228013743466 1.26067211380847 -0.71978051709545054 4.5352112212857172 0.44452987821016321 -2.4411902842616939 -0.84819644848833897 -1.9435546464190006 0.074813414915038928 -0.66808403031160546 0.83912982183709917 2.3905695399589342 -0.60350829115598037 -1.2492180270456259 -1.9722979101833786 2.6099253373810409 -2.1470582891639798 -0.45569947344802048 1.6436995574802613 0.84297725225466003 0.65347215099531286 -0.28112912800640488;0.80857865072340052 -2.7772396413866387 6.0763111891935662 -2.1174171719058514 -4.5514290228230294 -0.061201996660055075 -1.3468599802468875 -1.2468337072833897 -0.53328358045801139 1.7584882433603888 3.0049257271004066 -2.1663328122363366 -3.7847432599704351 2.0849784758601806 2.2396710010932246 -0.77428363200576877 4.3182791490379682 5.9709979591079048 -3.355816767893756 -2.588129000851064 -1.1964754013551477 -1.9892628740600484 0.27578597361438495 2.9965644900211252 1.0235081821830558;3.7081258054277186 -1.8156302193581877 -2.25435077557783 4.0608009560927654 -3.7543351786557877 -1.6749304285660795 -0.1676339545798291 -0.039168137868001218 1.7737955666110363 -2.3719116885150906 0.041071174798865469 -0.98286115183230582 0.32370565728917505 -0.80281668888135482 -2.3682286686296159 -3.8025375366805991 2.5555643394219842 -1.5118243372766753 -0.34905532187254462 7.4297670107189342 -1.763420182576406 -4.9414164009020629 3.6988801534845939 1.7728455998365049 0.86312535541022084;8.308884440710246 2.4112489924578053 -0.53686845967467189 -0.81965226175529693 0.68854996541554203 0.58406933038703457 -1.8181040850027248 -0.026471354219495955 0.15483992650466255 -0.72180084682747025 2.6548912004570755 0.94222516219874564 2.5774079454125349 0.55952730825136687 0.012973122537383211 0.38881239318856087 1.0371371547345007 2.6833490802422402 -1.0493788740666543 0.66178092822579992 3.3943273154690945 0.70018895965354067 -3.9602146841708263 0.28245445613546816 -1.0493876256698056;8.0218450465446001 -2.7835709480947619 -2.7876977770062554 2.3214085108810205 -1.6866481445750665 -3.7339072692835957 6.8405597271749432 -1.3306520317665398 2.5738320580076159 2.541579319408299 -7.2603979374726331 2.1913057228573285 -1.4394264325016521 -1.6503435467058114 -1.8320591351619817 -0.56752591034641275 -8.8956573504173804 -0.018145059714605557 -0.66823731114340701 4.4082806082122588 -5.8508280680816611 0.33428951675803115 -3.826822663005967 7.2971979012249539 -0.063336621349957406];

% Layer 3
b3 = -0.15207185509237572;
LW3_2 = [-0.010930889002508671 0.0026160028475250368 0.039593774000752008 -1.2503421483647574 0.0047473569820457367 0.017526103997339115 0.079711388078789067 0.33097817561331494 -0.0040273168249813926 -0.0048212043113143779 0.89804031276382446 0.0048336845586138613 0.019159091394578276 -0.018581078962190526 0.0057213040216085049];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
