function [Y,Xf,Af] = ESPER_phosphate_4_Atl_2(X,~,~)
%ESPER_PHOSPHATE_4_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:27.
% 
% [Y] = ESPER_phosphate_4_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.5950544042753147522;-2.5378276245025181979;1.6008052091092972447;2.5948466814600235075;2.4442729013750383871;-0.46723040908339386057;1.5345488206985924418;-1.2563254063109268177;-0.94575085444724960038;-0.31548035148297187691;-0.23543277574817461639;-0.52793333521461849323;2.7351191553633236175;-0.82276294141838335339;-0.31236063823660542571;2.0499751815916926745;-2.0277883646783978477;1.9684898140575015635;1.6424099269588376959;-1.9356571260152761749];
IW1_1 = [0.35532905691580435326 0.24969967811592205797 0.59179689297489646016 -3.8998812808017295772 -4.2372804298599442419 0.57828737220537906882 -2.3380686079173518266;1.1992672303633282738 1.4869458946800990784 -2.541300724253574117 0.017340004568754188718 -1.3768429013584626563 -0.92779740479920291829 -1.2566924110868273878;-1.2422589114423721046 -0.091377763348621812711 -0.97645456949199416208 2.6825575424147891646 0.5366591592747124162 -0.45767426050303700036 -1.9460683713944544326;-0.64802417624993280398 0.31096715307037298137 -2.1996826547369376925 0.18451864745052545813 -2.8766944886002625559 0.3983934263049577762 -0.11701733043254235189;-0.20181777492571895127 0.51803543388648309875 1.9642076931337311141 1.1079964811545244263 2.6116300906754341682 0.23127600226410868767 2.0455898082228465285;-0.0592805239213786625 1.0261295016784741652 -0.35109457954716200012 -0.41957161041064988671 1.0947122011338850101 0.65126365997807178498 -1.0955147887147704822;0.69198136734863091579 -0.36825580985063655071 1.9148391425176156666 -0.30925415533262928802 -0.57324687706937493825 1.904217583233148714 0.0042781012496234359366;0.74953023539010521503 -1.2064790246291474674 -2.205744302088835429 -0.055966583101835609693 2.2582484671330944614 -2.1544007943334388955 1.5025829506787089507;0.84781108391555703996 -0.70895938285557469349 -0.00051046065646851226938 -0.55045102532951384333 1.9963027093218459473 -0.39020392699975903206 -0.3999495504834068571;1.3321737613692989921 -0.6190400765395258631 -0.54183226080969282279 -0.81954421238714370013 -0.42818846482141653675 1.7169618102205959076 -0.68828731724552072446;-0.72059926491080916744 -1.1456838097095662921 3.2128589205252837679 -0.089621732652284097354 -0.49820016457507698693 -1.0506372563910000295 0.69890683688797472506;0.47793541891675672684 0.24791393807984024589 0.87237789984126901111 2.1338666085499444769 0.53383358908917022401 -1.2836040484333473 -2.0767042976842096103;-0.063167258552248375936 -1.6428424563519383739 -1.5615945268866966433 0.43110742418629177664 -0.67990841939405355365 -0.74169963930787285999 1.6639126541763751277;-1.5058932111493805728 -0.46189765257211312655 -0.77917272481416588459 -1.3962308293346734622 -0.65341642954715817293 -0.56038619066674810743 -0.33188956304529204644;0.57601318896531017444 -0.25560806918281764322 -0.27420715093363162707 0.10900180692617808531 2.5819229959231595473 1.1706014699471523066 0.51227363533898673253;0.31113919076037482858 0.72338704918433638369 -0.71440648039155296711 -0.016671440389030855317 -2.49324939580260585 0.96360525219656723017 -0.73904479453167959413;-0.71758931201736064764 1.5128822427228074687 2.0835422128287310883 -0.96157827345964941301 -1.4371417119821019437 -1.9847143549134398377 0.8004302936194718221;0.062118206075824342061 0.68417746008664259705 -2.3369897920730533514 -0.11471347390733270533 -0.055431824771540287589 -2.2250785742401748557 0.081341025752430656803;0.8079742912841219038 -1.1962920995439909611 0.49389133107214727714 1.3116700010390913711 -0.4638291218521734538 -2.5509308484921495719 0.36810822007508053888;0.017688740112764764212 0.075693540746868639979 -0.21675259088072629243 0.76853074565429801979 2.8314788064774383258 0.94464523198893646239 -0.71826115480767660504];

% Layer 2
b2 = [1.8117152574389303599;-1.4312815951102340062;2.1448791426870927879;-0.67984219902412468262;1.510890061450066435;0.052382692318952518706;-2.5462327844811656341;-1.7085246666222002609;-0.00087180130215592718801;-1.364348140644442875;-0.58290795818601048861;-2.1505979631337859281;-1.4376004174892889065;-1.0182100528530035888;0.56591876329366630483;0.5226486249914691351;-2.0264351305003884818;2.0019348490976294208;1.3184038819984602586;0.81984846792729271225];
LW2_1 = [-0.17693812038269432496 -0.061529087406408972116 -0.1560126827315744813 -0.63400523871684155708 0.034060430108919785563 0.14156326820425688129 -0.90766407569356388763 -0.34635301464427559193 -0.5518293244975129852 -0.72035336157101270693 -0.17525795871103150292 -0.39102079012715629247 0.48025869905599605225 -0.77283543317122505023 0.82383160905859742495 -0.10655321771382454676 0.50282781169181667291 0.41408863947340823763 -0.71860243934830025925 -1.2365267187864932286;0.20187242212769554439 0.23258408808272479362 0.46564895737082268035 -0.43044654114809588474 -0.46660828689055222629 -0.39479428589281678752 0.4551136879728029383 0.5713237000579821645 -0.43784807907005829364 -0.46124826900488591352 0.27260526791031203242 -0.50696992402636020802 -0.28951860630329329105 0.26245182091225116583 -0.0354355372246704034 0.09577671979239953115 0.11889131549224063455 -0.35308981881991807761 0.02851328236046752132 0.45943644761847723945;0.57309391137480736322 -0.041573194936465406035 -0.86762200639558961779 -1.7965457782922511498 -0.25408814703760640441 0.72670965252928165778 -0.52099124854831213582 0.48359170935213241505 -0.12754177970861269031 -0.38707892231204799049 -0.57024534547710115095 -0.67085528421449913683 0.19647678343998203898 0.21534276061749907383 -0.51954254014334644296 0.72723631288338985712 -0.0095118581119930829815 0.021686960714287020074 0.72907066350022353696 0.14604482616950292817;-0.25269612677853481308 -0.37867269704965450527 -0.23779787569363447508 1.625276711345432723 0.32883211285959024206 0.35181451632823818043 1.1614383284650278139 -0.60281435796391003024 -0.58052637045457455844 -0.10224878259230903155 0.56588500944611730414 0.37946295131385537891 -0.63869388886953082363 -0.10021475048274811059 0.25365937160304447007 -0.8645775467788724411 -0.38720872031864711493 -0.27964852039311172138 0.44405928933415972359 -0.44084861826556348552;0.53024405810763852731 0.59394428037276891796 0.33234302876109750313 0.72575927294570796722 -0.49312834445179865028 -0.089659744363222576569 0.39769606103747490167 0.55295313968882742195 0.99540516171363913056 0.16602685780420040063 -0.069292489678523958019 -0.52813375652314464848 -0.069316904747940930043 0.26938384816307753278 -0.71578063544639436433 0.25112053222464930657 -0.12482073780748577374 -0.083634264396683727361 0.4366622459745173046 0.83302563393078388199;-0.30636409862290059358 0.76154439093108683423 0.21815865530401995498 0.72997089993223318594 1.5306124763224635554 -0.81402528054854050854 1.6569674960269484831 0.37232688848675959958 -0.80940218895546900413 0.58940503715123060413 -0.099647595799268462446 0.16304888098579611855 -1.0167660439946437645 -0.26234371125680816528 -1.4711735054040060433 0.27858465549856337162 0.16966421476055104645 -0.85446296888294848149 0.78788997108417979653 -0.028929071070043249625;-1.9202615334702501926 -1.0887131758148078653 0.071120183041625081866 1.5524871765174119709 0.44772673268584756157 -0.76160631685583624062 1.4280912162856456149 -0.76528709603528088934 0.48106199562811291504 -1.2644338433038395664 0.35951605907954931052 0.10968421073459681814 -0.40873393690292997293 -1.2602096854237505585 0.46403779000467104687 1.9296310876800324419 -0.015580720780241098453 0.10214877960563885362 -0.30778468035937783798 -1.871388597677128951;-0.40767855829282828584 1.0950085394136472861 1.0930438859182265432 -1.562598422019335187 -0.95277750406993655385 0.328521696151918563 0.070166455007338340844 -0.20728342049776987688 0.24401342366345082913 -0.77579745972696034784 -0.07640267941154504916 1.9015564052112006177 0.21237894662934889145 0.47541233521844555865 0.068627047938389029724 -0.10799605964717425011 -0.9769570372304040573 -1.6694104565901803916 0.049895175610412900724 0.40171960106603604723;0.1654835619257272461 -0.21003281757789479811 -0.21767990213839299996 -0.58295901152216555996 0.11439052651687436901 2.2837034312233206457 0.68098102636125101839 0.97397423177284481177 -1.0886358947816709986 -1.3340079103961226537 -0.77295281260167503223 -0.15219844695111434119 0.072981803672903119984 0.083051545941268109519 1.6595534615183289429 -1.7530163825179321258 0.44904185546378183602 0.12379422900516705297 -0.30751759451263921408 0.99219550977415815751;0.15715450873297165391 -0.33120112574173204978 -1.2087315204079498443 1.935128726740503069 2.188802677242722261 -0.010643570336922486205 -0.16374399972491049393 0.63385904575335172417 0.268330290166075347 -0.41327033942115065646 0.83220017018203984449 -0.10404416005324286509 1.1731234373869952048 0.086046758974874001935 0.18190667497586426871 0.87440778833500021339 0.34453778709805954472 -0.30858178473519032314 0.88814498761926519155 -0.22736952473419880238;0.0077881772444426036056 -0.51073680460965942274 0.059161336805106379266 1.046995172383151429 1.385689554515552091 -0.22188424280830001956 0.80729830401535551676 0.13072420843077003916 -1.5923151358232858765 -0.47931522981182278498 0.25279888002387052026 -0.07580977809818588431 0.56093696300569784174 -0.27154282634301740718 -0.57776906915305703549 1.5188489741755841766 -0.5228933920635147059 0.17326706027957411438 -0.011647224908492945228 -0.27471116931827055385;-1.8452323153655869614 0.016933337234284834283 -0.66723422970839019186 1.0000271448304669519 -0.13447653564302161633 0.92231273841353622611 1.3302853379129426781 -0.35004793818763679791 -0.32447542070481721899 -0.093063469041357399503 0.54570524670616382679 1.3101444164422946237 0.7756147674133991865 -0.2938243299842219769 -0.49477027020773106658 0.57497000923164598429 0.12094461836233488805 -0.69581094272640187093 -0.6749461129351194133 -0.30354600578603074812;-0.6664558335704034997 -0.17865012382264389146 -0.16450745126030821841 0.026685774936437100385 -0.78902363092622584961 0.66844482426643780926 0.15654740229498137483 0.11920200286576210225 1.6066733512098143599 0.95568623012340880862 0.40803045309502550264 0.58504963242790086753 0.078948924243922871669 0.13683839825874744012 -0.18862393344613090362 -0.97115233352232910313 1.0523335007966665433 -0.53373528392546232269 -0.083630926282738604627 0.34950564233477604548;-0.96090193510300114799 -0.53641506910026104382 0.90112065886610415166 -0.94813498216279645803 -0.89162887155693248964 -0.063452995386074892425 -0.43735780060331092001 -0.73329185983503408774 -0.30040808591545181683 -0.34612712941964457469 0.34200728223438958686 0.79577407854976378587 -0.69469905543816612425 -0.18807906390586479062 0.2838814224294616273 0.22068967022331725802 -0.033185519660811332865 -0.67583751327502328277 -0.27857328360522581878 -0.92192645130803474451;0.97712169533438264502 0.02736595226090869637 0.074315038621296639065 0.42251160668315435043 -0.84913763765079852686 -0.28550208969879087295 -0.65676225799516718684 -0.70859392163414736121 -0.050741539108830592542 -0.96820862838761656555 1.1596436502284521719 0.79390427425735898836 0.1044777536528280204 -0.7285412379671305505 0.6259918085854528913 0.32832828119647827769 -0.69305824455811060325 -0.13457618634031839888 -0.29521155505768764682 -0.52895988615013067591;0.34392507552152756789 -0.16362835630168043322 -0.70475940255773450449 -0.48789768641333808308 0.30681461975141183229 0.21866721448068954237 -0.15035749884761290263 0.44313560237298194044 -0.46591075850017399373 0.22659626503567431577 -0.49390643078919888032 -0.036826501611355887122 0.74723910468898735449 -0.019854512071745128443 -0.12980982255478903942 -0.048505409931162639381 0.38404060802160855381 0.41644725840192930999 -0.4285615579202843306 0.30035763243043817061;0.0098736029307630451823 0.093390917978369125674 -0.076028985751903213619 0.57361849840648015952 0.57878521079714895237 -0.65766341694590058076 0.93873212240314274357 -0.4591886416049241193 -0.73419512184204271943 0.65816128412924612689 -0.32330989218770161964 1.450346872881592919 -0.24052750854464929886 -0.50482386778465093702 1.3759903401685567026 -0.043971374809523781912 0.46633687654657740573 -0.18567787770406721237 -0.36040223304437662977 0.99573230338288132302;1.5976403900487070597 -0.33447499749348669207 0.75971380814259958925 -0.7614711110937840699 1.0860010878228969489 0.71844314634966777167 -1.2024244335608733625 0.2483961509997355821 -1.1129815071090007894 -0.60022535694140954909 0.46897668051962865254 0.30440840388305945297 0.0037030906549308292147 -0.10019611644085736624 0.087298685289505351115 0.1132340813009445335 0.1380771980693268064 0.51727747070779406258 -0.28978570035162076746 0.83065935896660114679;-0.53742876442785258995 -0.31373778562424831096 -0.71318503210655359581 0.4951718770036318551 -0.10105830898733926537 0.31664520227035364286 0.090902459521253919927 -0.71826650198132424574 -0.11418359260068863814 -0.1747524715286467023 0.23187550145709764915 -0.17740290240994993631 0.20425073449202818532 0.33140971473050284679 0.0028963990463465117201 0.32106583437911229151 -0.20615864182846779795 0.25272703756312625556 -0.59581873992643108462 -0.3060090908831445411;0.97498357766294918569 0.16476477109067591553 0.35753905610731223641 0.14766827774898250158 1.1655805312703189092 -0.71595769778660545146 -0.57603955051643329632 0.36233967756067497756 -0.55911009216954565826 -0.18591654346948552345 0.79377806148359031368 0.51273614323797556125 -0.48446749090195240228 -0.34295716805418174911 0.02703858686225405622 0.030319644527805375556 0.29236600116733862942 -1.2823572523836734849 0.32360661061180828746 0.03275466623267850319];

% Layer 3
b3 = 0.21612435588492515115;
LW3_2 = [1.1892849986564675291 0.26935425039853760909 -0.80109677694626879596 -1.0956970856362169275 -1.4168137324499940899 0.83191058952268825966 -0.51838908101893466096 0.26294197888804360375 0.36560714750562645081 0.57650359664833950024 1.2459280412562199203 -0.97259916401151891296 1.0550969936856420262 -0.65063145281028933464 0.3338423443098057497 -1.4706439207670949365 0.69910653118024335129 -0.72131962642708069566 0.88103963779285232594 -0.85094574951734458512];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
