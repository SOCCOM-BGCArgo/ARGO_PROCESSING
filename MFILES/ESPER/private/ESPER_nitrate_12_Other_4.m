function [Y,Xf,Af] = ESPER_nitrate_12_Other_4(X,~,~)
%ESPER_NITRATE_12_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:36.
% 
% [Y] = ESPER_nitrate_12_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [39.088137646285062488;0.79497012275054579344;-3.4907058998651718795;2.9760710106181935686;0.26078853368633125864;-5.7863259012097731926;9.1808542890001749726;0.11153336832509880283;-0.82155533703868055539;-0.80910954484729180614;0.23545229247240526127;5.8645280329897317984;-0.51082356790680794045;0.28642541553260603138;11.804598302955859879;-1.0578948383651041176;0.067417979724430490696;-0.23811592155033195484;-0.33163357166515400332;-4.3956546874691753146;-2.2402199901668282678;0.34055279201085647545;0.14099817319273139082;-1.7463882548860700794;1.1759549781028753035;13.21821853138377989;0.033393225540302585996;1.2296701758267278848;-2.01136928232374812;-40.58976830308463235];
IW1_1 = [-1.6097237788574625394 -0.37600576208548375234 12.455090341998028336 28.428693310208071665 0.24535116644650614703 2.9002346858241891958;0.010275353813309068621 -0.16168314488082846658 -0.57250162948887017844 0.71914073181434889914 5.2338124711221070129 1.1835553822758226872;2.5876077176913381273 -0.24939250716093272486 0.62844993690399031383 -3.4629458810429043503 -10.326274024436290944 0.20693631485842395312;-3.933848545547733444 -0.15650946309752519769 1.174991131722354476 1.1805805431210107947 3.4035885210316600968 0.31234918951482126825;-0.14031535413050599814 -0.22871542486384940918 2.0961252951757392005 -0.89871670254486291096 -2.1305242634885406261 0.68542290757984769556;2.1976761267469338001 -1.4492054978167154822 6.5160618713091631449 -1.7843631864682123478 -17.485561671286564689 -3.9656736046226770398;-0.044310115655031769022 0.45380309079607333844 -3.3904155309701633492 9.5225276604128090696 1.386665919693157889 1.0151055731537947935;-0.096941304503148473248 -0.82467934803331688354 0.86332482259767651112 -0.3898555415397739754 -2.161687009505435686 0.81303589999999636984;1.8852342176775400695 0.12485622185975998877 0.036029256525166086789 -0.5099787303148587414 -1.3461741499925075072 -1.9831459625179717055;-0.059908168705353370687 0.12104539334676428508 1.596760463266756247 -1.4333291664159826251 4.3823463230863897167 -1.5527500166367749213;0.38183792829472662511 -0.22659007492544089302 -1.9953906471204576611 1.3812164825081039154 5.1727526834131243305 -1.780831484611704596;-3.5188781799289787777 7.8932748481206180813 -0.24493066329733112485 -5.7200966105865358458 3.7554648326463819785 20.345799031909344023;0.0030313332866600669821 0.77244194127254162119 -0.61401719969897772256 -0.10878103513668073432 -5.4328190172615560272 -1.2579047871904180944;1.5028689341411352043 -0.76959055642859697244 6.2959969198062992746 1.0010853425361354585 1.9938100006015266885 0.035396853571584042941;-1.2296897480164794558 0.09639116341743253491 -5.5632899463801175344 10.528293651674088593 -5.6774310944884653907 -1.5881773373039567154;0.1247842778004858294 -0.2389060109436596524 -0.43183385577828858892 -1.7984815335065169606 13.079817575326037726 -1.214258136790421938;-3.5215936110265149139 0.86643091334029143091 -2.6225358574816546309 -5.5032242300858102979 12.609825401979410486 10.139386875832345325;0.14476484712350726203 0.36647674502450966472 -2.2806775304229010004 1.1091605329571043725 1.5961871649505772197 -0.68079725615704012043;0.21894462515070475805 -0.14937274806427125462 -2.4455252767291115745 0.34027805369614005926 -4.7455871511578369137 1.4452815256201423377;0.30535926092348986138 -0.41851248474598251592 2.8872110799716339535 -5.1729287132068764166 1.9600345509478838135 0.47869277182183700425;3.2268942913677536311 0.27821323040267931237 -0.38268522640923874345 -0.95357591167783306574 -2.0626597705022615692 -0.27281671013271646675;-0.18958619922093228327 -0.74315088659403638616 2.819662782513181476 -1.3125305768905159987 1.1553435479553118004 0.70992828821140918638;-0.13839420846668445964 -0.9123414184507904201 1.5753367178817803129 -0.34159659090215888089 -0.8402216462643443684 0.88985228798556847973;0.21815396477407711373 0.18133266339227896435 0.50880440802021609237 -0.74498359989422147098 0.83297067385519962812 -1.2708559926906628501;-0.1139834678839284493 -0.097146437568614407709 -0.34120765098557093165 0.53324046923979884216 -0.31302888874507350803 0.61578962366204570422;0.05872029283511354808 0.12964036961734609621 -0.84071165772777933789 4.304013345466518814 -0.16800504841681440649 7.9916926664654406309;-0.11719516668336511789 -0.08579768740517669523 0.12947362673276585632 -0.61857534248382828324 -3.8690538286462885509 -2.9532514468654924578;1.0003286783863840625 0.24385383888626907534 -0.099076267185173497176 0.058655586203581300264 1.0577938212964721476 0.33002588682029515565;-1.2502366664823056919 -0.1715403022429939639 -0.17236231818059730148 0.57417778492487847597 -0.068270874098350642356 -1.5294231637568187487;-10.762955958803377854 17.564801196258084559 -16.919210734086082226 -3.6535307114079782487 -1.3743308044017508163 -0.61478418620513108905];

% Layer 2
b2 = [-12.594308268905908932;9.0553664665558741831;28.578980743095364403;5.9175002641059091246;-30.56764537247177671;3.7753273096553217059;8.9068061714139421525;9.9559538232843518557;0.58928017145177302716;-13.088250077670895877];
LW2_1 = [-3.0753861234741575181 -7.549487385388896854 -4.8125534501828530765 -3.9891447329282301304 15.846522525089648425 16.329565847624394337 -0.68439996629746135959 -6.2926250379801098589 -2.8985864809470522907 -9.3999992804551428804 6.1504711670067120366 -7.1390079643078303562 -14.698658819797429942 -5.2421313593304628142 -2.9639331491358951176 5.7330030880150975037 4.488377057016903926 -6.2660535941136679128 -8.4979614224610671158 -0.48789821581024439556 -10.780711633662148685 -15.323423815519552349 -7.6767327565887342189 7.716002940331045501 -7.01848026543033221 3.7520555355346862925 22.637994124026292297 8.4015466584337623601 10.45171691572785555 -7.9963673699452986199;-0.78544482767565682035 6.0878892361275847023 -1.0300187460214715873 -2.2156899169507866532 -14.629542198200590875 -0.16064020712350801645 -0.56995963052969889073 -0.87770729432473482134 1.0031548486257653163 3.056621762155538935 1.1953858659198268732 -0.037727271110509351393 1.6970150298900719132 0.21264953029387217986 0.76877289641682611254 -2.8967748246953202163 0.1790189584289890723 -18.447017762641671368 0.74935367819505271925 0.23883991805388543606 -2.1948500541704998312 -3.7076394909959247137 0.20177532583302126845 2.385355591129275421 2.1080623364441000156 -15.830018654609114392 0.98543648901956260033 0.15305004218430534602 1.7251892925285412517 -8.5922067218698785496;0.034256501559939679658 2.2866822981464469677 -0.0043183849870911715854 -0.18162891608762501972 -7.2125018990141160913 0.066972096126063404564 -2.460196662415483182 -2.0630637491493786229 -0.10800595814421629082 -1.3071550923862966798 0.31167562359746270317 0.015600485800295504218 -1.0782471743626378391 -0.016404352257542588467 0.55154160042076794124 -0.14529794410885249478 -0.13817740142056050834 -8.4757474496722089441 -1.2230983863611621931 -1.8380284911285689198 -0.41289410032878592904 -2.6492950617327792884 1.3307923997126731575 -7.9360120186824492095 -15.288985531915214366 -7.320590166169602675 0.2872945992183839059 -1.0631176395636061649 -0.87592144748728761883 18.501907311371581955;3.8112396578435983052 -8.0096493918032880543 2.4715624692682736097 -2.835386543589523356 39.183587670987400031 -1.7522152719758941064 -16.934873834760718836 -5.3912586477060866486 -3.8687101584252259201 -24.414030474542698812 1.7781606128946745304 -1.1290670843127796896 -8.4184470941098474839 -19.323921837372914467 8.2790969022953362355 3.4521029768305324659 -2.0718881268407143281 12.974176745832981084 3.0088076500805485125 14.671598175384939822 -7.2553446250778232951 7.4719800421716309202 -23.831253506987213342 30.690724426662246316 2.2660857718510669656 17.757955391505330311 -23.333869884954552276 -14.081449563758219767 -12.14501012447781747 -8.445148016317549633;-3.5191207701919573481 -3.1138823759035583194 21.119550519881254758 -5.5501166767067804386 23.169717869426317947 4.6984326900426243157 4.2163290160566591069 -5.635944156998410115 -46.739654745905653499 -12.092146262791485967 0.13781290642300522697 11.35914268337943156 -5.5020581819266505263 2.6015813737075461631 5.3015157992796897446 4.3491920296496546783 -7.8958147109989331724 2.255940900870389676 -6.5718221058414467706 -18.612169792946524183 -22.020261787304136192 -6.6841227429746608024 9.8114517590424625837 13.895314490544590669 -5.6583617794008924662 34.07766652875820057 10.082794744470447768 30.982870322075367397 -0.50388878699904604552 -0.77625121446466205377;-1.5659738908584523998 0.54203046644107244489 -0.29303153559106481785 -5.0967340991084322255 14.928669364827129584 -0.22430912687733481348 0.91109077345170252915 -1.9750296042934898377 0.34981758948355162753 -2.8601701298411121854 1.1216126187326274088 -0.61210093055636716208 -2.5598793002088902071 0.91745911705274063586 -1.4857726261782187027 1.2468182790874249299 0.12859983372195707418 12.069247526923088998 -3.5972390046251438989 0.30712810431120779464 -5.9209561199502616091 -0.89030145612502442631 -4.1121130432104866514 -4.1512500068175546275 0.0379622198499477842 -3.0292378071537382489 -2.9267911297550743832 -17.190133717644869193 -15.408764805593664349 -1.5235667540379467244;3.4619069719804311802 -0.76033230515141614347 -8.7444440958114277862 3.1409504171822271168 -4.4573438472447461933 26.33793908645332138 6.0398513843262335854 9.593687022927259278 8.0255530421808742858 -16.54804753799702155 -3.838336631394913212 13.971795976353673652 -11.212368820022589944 -4.4807036997442777349 -2.9659299876769620319 1.8839275986031871479 -0.25269151341609163985 -0.051995757163730546568 5.552789240944772331 -13.706053722760787039 -5.4972788130508547511 3.9075958652917450742 -2.5506836891723492222 10.722849725222101114 -2.1605019106596796696 2.9931484392019553908 -1.0804458007477169001 -17.182925145089225083 -0.23099214224855732502 8.7563762705735062042;0.052736205836509807143 -1.4758184903967950241 0.073427302587639908804 -0.1844647834665302244 -10.137931537704591989 0.23293360911607494113 0.26757255584205130727 -0.089826966569728508571 -0.33378132876286636943 -3.4573838108994721097 -2.1918576716514754921 -0.040657127084112898441 -0.41876767191360259046 0.39967618690115930269 0.43627875182778080854 0.78493086170007653202 -0.092548204593589811218 -8.0642377092313335396 -2.1026172878692950263 -1.0066465677942542101 -0.25178364945514924989 -1.3294692040652671405 0.94624229914204749381 -1.9654694926813960354 -9.2389375974370437916 -8.6969587975869000473 2.169158155650804165 -0.095662499521745394948 0.14907615445436514512 0.6440378192951609071;2.3766185330244731233 -3.0628766559375932843 0.035267643101302238728 -4.6305587457107639793 4.2301419292312685272 17.808847428426400228 18.354018554126394491 -7.5318194593519134372 -2.0976856645488179964 -9.3228282339546844071 0.6139599087411391487 0.8195475901544051478 -3.3429957249501116578 5.8941127398359229872 5.1896101685406756943 -1.873532499561166409 -4.3232565928380815024 -0.45097151516680744621 9.0627799972210336676 1.8031442515853717268 -4.5191816935547848288 -1.2653995342308395067 7.9503068672634640279 -5.4399506114018896241 -8.4197234184444305072 -15.125683899626539031 6.3381358940893814946 -0.71578628939618249571 -4.6857819654962664657 -0.39152089819932528458;2.8411226154029951552 -27.352405693531487429 -6.9989182521015411709 9.5368677337134357685 10.942398443754521864 0.98364758759627224372 16.594970884827912272 -4.0727241266043305856 -10.098598670159875113 -23.84353546444446792 16.357913926975758301 0.8109666000605989522 -2.0113874187100497792 -5.2772627977256680865 7.2871372745559073181 -10.093426103436989649 -4.0203252049434068383 -10.602649597569312689 3.1929310476900578664 8.8213926483679649948 12.770450928567258941 5.9567845821921601157 3.0746989537137285886 15.927825383454397468 0.54031726443996608289 7.4814156434384235794 10.065914781724343285 -9.8420365918675809525 -11.90719444980924635 15.620994015432557944];

% Layer 3
b3 = -0.043104244882542649964;
LW3_2 = [0.019149288659234348087 -0.17083969453486863577 -0.26420779650073483724 0.011792394276574066914 0.018653662285174881647 0.082686383814347411136 -0.0081155882981017585243 -0.47727818949349654076 0.018030524869622595319 0.011964806790376193019];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
