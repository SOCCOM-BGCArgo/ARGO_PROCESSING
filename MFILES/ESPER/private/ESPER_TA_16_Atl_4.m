function [Y,Xf,Af] = ESPER_TA_16_Atl_4(X,~,~)
%ESPER_TA_16_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:05.
% 
% [Y] = ESPER_TA_16_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.9870425200840617919;-6.696948348417045338;-9.8087941508262019852;-6.5468893118455158131;-0.9213313987818322337;-0.093225074295921112055;-1.3382174388083363237;-1.8014987338791543792;-0.98416179198281683593;-3.4915637053853880722;0.99981546445722957461;-1.0120544224126790667;-0.1409339979451194047;1.6221224595361851684;-1.9792356663919783433;-5.0779592014537202616;-1.8477377450288023919;-0.22914664829191908058;0.77302189089772643804;-11.904178011650666136;0.50592827543381257982;2.1653133775753521384;0.147438606628281621;0.92091172645498176053;-0.33249518603297717467;0.14454159487866044542;-1.1291142746344771108;-3.9323785379064664092;-3.3874411648165474453;-7.8949537660961279784];
IW1_1 = [1.8434731746465597979 0.83582205890574412521 -2.5432474891297238706 -1.5592665270224042029 -3.1571709973494996859;2.6968135919328140027 -2.7530242513249887359 2.1433476546740610758 0.055883661023804862 2.0247215972723333621;4.2079942607245106601 0.5495147867701900557 -1.4391553175344415916 0.23525633916335075835 3.46959065970410796;3.1001406461939198245 -0.43080785598725768182 -0.32726287870408254932 -3.289938476747054974 -2.8922041651682168784;0.16859716849067399314 -0.65190084075949417119 0.97820486715235055453 0.041288945976627862422 -0.32755663796256562215;-0.1308797023769972534 -0.96373402222145376772 1.0995699141845496349 -0.20982221976331441593 -1.3300783614741111816;-0.14535405644651561152 -1.8478383779382787644 -2.6932611857145838385 0.69146774763336227299 3.0671314382590009195;1.4956679108417596513 1.2462685826627295516 -0.53042351966362677462 0.22455549682928799271 -0.38855050361320614405;1.3142996767768275745 -0.77907894430179969181 1.3979662216508172978 1.0883289029727545305 -0.64894582708110237768;0.43270184982130638351 -0.23263904721460021419 1.1455142355498431073 1.8060681922093602125 4.1076817316514544487;-0.1108991784590171864 0.9234057347938011695 -1.0468596260779547968 0.026417904087672500202 0.082382689248069421173;1.0032406926040284834 -1.4844923302182093661 1.9328714879358239731 -0.23624348524089439083 -0.23671284184932284145;-0.43144457619046944208 0.44964281032371594682 -0.30194013577601941378 -0.47440385598300160996 0.70672674232926302462;0.14956353423802809521 0.46219141477896402703 -0.25609684294376028335 -1.177924966979869037 -3.751474317884611942;2.0094003773033612958 1.8569356890884560762 0.54986756260822677866 1.1183059677080158245 3.8163012012610906254;-1.1174008116767182308 -0.228156003806769897 1.2112531072658032638 -0.82329456429992486921 6.6825261214894711159;1.2177004165220859377 -0.83324438486045260266 2.7027117489693242014 0.43545775824703286672 0.53052337123775550332;0.25260942149142134872 -0.44428643284520047407 0.17514689962632523645 -0.077462073010187676436 0.65330881355882242101;-2.9453266429888809164 2.479658042075311819 3.1186582089790206851 -0.21437593923257142192 0.51179080052094405584;0.15939465881217346199 0.57634613961871328236 -3.0647468661513608268 -0.56381253355880567302 23.898514038281071237;-0.8708897536980954035 1.3530082732455988026 -0.67533391430737865768 0.17612371355828274067 -0.72611119176254479424;0.15706262819453292723 0.59192751807768839711 -0.95403183717032602473 -0.53368816762116688679 -1.1341430566879879827;0.36707319828884688029 -4.0669487232521568387 -1.0048213813583017906 0.33967702545719302698 0.30707496878999251955;1.0833688367365288396 0.95511218911346096316 -1.5204919243253707251 0.37655196645148159007 -0.90214046865318209267;-3.1809864975735093751 -0.24898705461450396093 -2.012968137709714167 -1.5267446923452299146 -1.8823257358763998415;-4.8128035319280346727 1.8516505626945740648 1.4482131626195504648 0.80413857861622251022 -2.9824937027817051138;-2.18144063751032391 0.5154561486470552456 1.9426057719503000421 1.3015099594344878842 -0.82226064271041965359;-0.32455067955114791367 -1.1708093044411536088 2.7788693677195945853 0.28623552232491494829 2.4700152280998839416;0.065833589328775421468 -3.092396332086503552 1.9721478343183984627 -0.60872198610283900777 0.94313821471137582186;-3.3366789118065409703 -1.1333957343293867837 -1.7404701143177592204 3.0024208667850369459 4.8412080977408527005];

% Layer 2
b2 = [-10.509958588588101946;-39.3849459742182475;-8.2582006992896310749;20.981591948464494379;6.9682939737161362359;-4.1306506572210217598;-9.2797003853226716075;3.2138716285538508899;24.481129112663271741;-5.0171945500829719933];
LW2_1 = [-1.1715568056785854445 2.4107240354149874761 -6.8748309643815526115 0.34941006797491425129 -5.4890982370687311231 0.29798061254578273038 0.057374864014515809807 2.3226592992446097874 -1.2913049978276081031 0.41591340360245682151 -2.6742528329309265267 0.44439367155243264529 -5.4497299808453485426 0.77047622041925956093 -0.022199844610010177615 3.2361276132516745285 0.18418683844565261754 0.43919821300785416573 -1.3590041943993107498 6.7170339814033033221 -0.8545138345882240527 2.2263366079619770765 0.13985411373728931506 -2.4935023288832738331 -0.75271260974611486905 1.4216188403050493694 2.9456033839940576335 -0.63764130341142222225 -4.1601477812650831112 -0.9290795732698917675;3.3816384998111028715 0.17798790114624135628 -12.768899729035910084 -0.8090562010488555611 2.3894864090837031334 0.58333219723735141304 -1.3400525977054607019 1.6473100960817848026 0.27513695493339856979 0.44769242823318106117 2.9940693594681011547 -0.48609744466816878772 -2.2630948183727901402 0.1158765391678592549 -1.0618225266744003576 -2.2106338514639403137 0.021933833900538043243 2.641036352744424498 0.30006065711728274747 40.513237413020661393 0.54666775576239734491 -1.6797635344479575625 0.02225876661387367339 -2.2198525526931129903 -0.0081365195371276843872 -0.27677846089691338083 -2.3300471400945603762 -1.3911455495994873299 -0.80177275375269962954 20.561074132645412504;-0.3386352219441415845 -2.4258184480915230274 5.1002269987207631274 -2.3361316015664863599 -5.6552848344018409321 -4.2152035503592877319 -2.8191748408749801591 -3.832079132643701147 2.885523220824081303 -0.59552190163318408089 -14.643009668478597973 2.5710743748445836765 -6.0034592775113333474 0.46885626372754707347 0.308659390171008019 0.55985921642301372803 -1.820646523495925706 -12.32004938168920205 1.5178247163876377179 15.892516385385761168 1.0728276971782741978 7.3908323071763817325 -0.69326231480076760949 -0.55554911095174608349 -0.85542963683799755348 -10.054189989513238501 8.8138165096923621888 -0.10591800996993229467 -0.42652756285916010315 6.0224776318430590649;2.4825285266568766218 0.021045687666423125439 19.755627977449385924 -0.056099756667475179917 -2.0655351026857067254 0.36462782867684595534 1.5390215610789605982 -1.3410191195874423542 1.0509036152847437418 -1.960549015853861432 -2.8517187661595695403 -0.042128315842484290177 -0.38978538753361713365 0.84507611966246154456 0.44082777948110563049 -1.5537833938495901887 1.0341711365608170503 -1.0935620045796041744 1.3314949346506741445 3.4180045895231332409 3.8150357417998170817 0.56515577431123020791 -0.75185341769134172996 1.8498707524622575171 -0.16583759901978084583 3.970600477075205248 0.83051207250938841042 0.65357930598630276098 1.0286274751140331851 1.1479005135501658685;-0.69039159104720893012 -0.70203545840807657363 1.3561591284019369752 -0.25513818012927091949 0.72905446229150527859 -0.66768751501721823605 0.95366023843444192032 0.49788254209959431629 0.36466483909997526869 -0.6421781802087523916 -2.596135779959638068 -1.1658998903464130592 -2.2009107646116592427 0.61652932824531203604 -0.15560323773147510806 0.12034030519225434597 0.28015726615546543421 -1.6529667722907486205 2.9950088461379480442 0.097803296204410195003 -0.08277296364570121967 3.2720294241301854932 1.7402147667842404744 -0.6142668832456559258 -0.32213086176666105853 7.3861036134911151052 0.52442184166429339776 -0.66059005324536512749 -0.1079742623084151143 -2.8323352293528603063;0.50222487823640382665 0.6922772348588196456 -2.3679681514129664599 0.25836671419174556119 -6.5209416242055500135 -1.4424984333649473189 -1.9192606805133869408 0.46501083963344735928 -0.064294615650024700138 0.58488389516247518696 -1.0089210434960493856 1.4314530786579631183 -0.60830735761882948065 0.35290273855058656993 -0.34886869649235419111 -0.59066002122091754156 -0.22669404500572137851 1.7695560844832922687 0.45687424568111972834 -0.28461223841002802892 -0.36652558279285563092 -0.98977654107731449784 0.22496409828728802793 -1.2522410069056073567 0.44936924669272687582 0.70343436558561067695 -0.0025320810843811915325 0.85272896996191960284 -0.056082756704492572886 -0.82875589840495578198;-1.1108636578392176997 -0.48933704968398172852 -7.1635360029548413863 -2.4406536319221538989 -10.053709435424407204 -1.9204727230430693741 -2.2646584992340592635 -0.78432318026790581733 -0.051590546206522251704 -0.30396977882899506307 -7.9962844877269212418 0.86421296744469466855 -1.7084437692517753238 -0.68390899540781269206 0.21131471323943384899 -0.27545037223940960214 1.0718653439392686888 -4.257848812087803303 0.99780997369612167702 3.7314837804810401245 0.80559838432898167593 3.161198957594953729 0.59765186159020511347 -1.0693917337602663054 0.13911003998597118447 1.9040779883333620592 -1.7449999462139040851 1.3614194753716646336 -1.352680786722972206 3.4761333671597336448;-2.9038871974986455449 2.4092531266395398326 4.7078839226235622561 0.17756629253410036173 6.2254147306842346765 -0.8432912305759735494 3.3943057695839713439 -0.55849345691019935956 -0.4475449853831092728 -1.9888822111555686245 2.9603659079638755536 -1.2473561719381973667 1.2205951888501735958 2.0368660101595192913 3.2770400395864145437 -2.5565668881732315221 1.8037490567069294212 1.8503615192336655415 -4.2978409420698735488 4.3255890134924204204 0.23194637049464625345 1.8342477137379566976 1.3251996862497852359 -2.1014532115371165055 3.6921775693722747036 2.1080634932074828747 1.0868091100878942701 1.0802557051950059108 -1.0172963034135220628 -0.89338596022848448808;-0.59397292094576781274 -0.34562031978984747438 23.868829770407796076 0.059020197568050561387 0.90117226245945969421 1.3661096044241776148 1.8097802370507656278 -1.2616881270300490669 0.46933443414769154822 -0.64685755025323321554 -2.4768879446734879402 -1.4875691385634157715 1.187104208645328951 -0.39302820358839279935 0.21823135039639149357 0.34855059229707890944 0.62339246440480211575 -2.6191938601757218663 -0.10666807965055463692 0.24325018484392607609 0.013375569349231083635 0.49367641213701496383 -0.26142724623832441777 1.0639838165757280475 -0.62591839684298022917 -0.66069295749358492031 -0.23805424927739513019 -0.83403809525133087988 0.069494841430927031811 0.97367212077628784161;-0.92254604694847930357 -0.45007001393246615084 -6.3822971865468050012 -0.26218601257002249749 -3.2641892186034850987 0.12962615215344858166 -2.2984043368635593829 -0.53368726823867373987 -0.79489664046395669406 0.0045974281430934630516 -1.6276039831850990236 0.77033673421098269873 -0.70200756897963900727 -1.257368238827361262 0.32623969960650328614 -0.42122053147451121724 1.0444581477512078216 0.52681801744639511487 1.1456549652972283226 3.8699156408599884038 1.7811231376752669764 0.26507473942523163135 0.54354665666167123472 -0.78177795145823192335 0.11430058070146406624 1.6858237306236842912 1.2190937432884858538 0.15307078526904918658 -1.3161532654573220302 0.86473229586621269682];

% Layer 3
b3 = 0.6702734681538933259;
LW3_2 = [0.018691136736505756244 -0.039457790433099541871 0.0084610377141237230747 -0.018543512948000530349 -0.32550377470919017453 0.65371049255247926091 0.4855681398474575583 0.0039018041655100809371 0.65130033628925543265 -0.47872619312909581168];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
