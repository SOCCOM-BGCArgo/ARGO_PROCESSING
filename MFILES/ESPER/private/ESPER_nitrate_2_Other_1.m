function [Y,Xf,Af] = ESPER_nitrate_2_Other_1(X,~,~)
%ESPER_NITRATE_2_OTHER_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:32.
% 
% [Y] = ESPER_nitrate_2_Other_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-0.04979;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.568038194888224;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.1078919483820834913;-1.3915285259270495644;2.4250778804538661859;-2.1806970784650712147;-0.77810381155796881636;-8.0783179157933329151;-5.6779375070312818607;-0.024336953304419421673;1.1489550412070295149;-1.2783471256154652629;2.4507833946529666846;2.2359406097070522179;7.4731499893732715734;1.0057029773726495758;-2.3659624477494602957;1.8035267351228285726;0.21744774484151493943;-0.3973928464774916236;-4.2493132918311138368;-1.0523021288647507188;1.6448690603303561808;0.35598824796444489271;-0.37960615762693722397;-0.45793466957967543518;-0.2557937912708386774;0.028725220366260389299;-1.0982516995021143202;-1.3318050857696734912;1.0669455890040298041;-0.15970636712783431443;-0.35940994965690609142;-2.5627306090480788114;-1.8041783488504552491;2.4128544580337156766;5.417626044382538808;-1.4986244419904082292;0.20177474038143464186;-7.6491286766929533769;-5.4482163003671812973;-6.0454411209473919442];
IW1_1 = [-1.1547313117614830258 0.094408627221506405403 2.0219045108804389876 -0.0055454177669770274295 -5.571965672256502522 0.89029248678318573251 3.4865433858608998463 -1.4905214208841990331;0.94708598196283289017 -0.13022051637869239138 -1.5604498279888123768 0.58802618128005879061 6.9433981880957027499 0.68788545481331442311 0.79124871148100939244 -1.4522125177910585325;0.076381581501596476635 0.21802369580582814379 0.54558662261781742941 -0.71442413885853683908 -2.6623833069956148734 -0.41992643649053223998 0.54395523125211053816 2.6608272807605866106;0.16049100933003251912 0.1835594755376001308 0.94348060990388882274 0.20370356737019593152 0.59262346443344748881 0.25888571134646121141 1.2523516501164100312 0.097509716360265188961;0.0089191101809500215186 0.066579814757562402749 0.24376755736169963829 -0.32292110502346998979 -0.27460482558291759991 0.62059801014235793648 -0.1656655568630888975 -0.023671261280292062862;-0.16754056662540167677 0.094065934673410497857 -1.4231641718837817479 -4.7643376421619976213 -3.6233438654673268964 -0.86136787550243532063 -1.4839872595935050814 -2.125127856768683543;1.0548222337712129804 0.19387152201764890069 3.4279066138282225928 -0.053922621390981022305 -2.2392359433573951755 0.11517811099581518053 1.9191063678225988021 -1.7191164389056934336;-2.5850901846174219045 2.2491804696745618664 -0.14560918070219183718 -0.071455015296897295141 -0.96358869072160902025 0.6670665390522608762 -0.16294540234835608317 -0.34581879324841546808;-0.4026303159175831925 -0.069713326308811066068 -0.97573522433369108686 0.12962652920313005867 -1.8137729354256166836 -0.69148563995180656327 -2.2427824533608147206 0.45684269357004070322;-1.0021145259136734484 -0.47057030890701168069 0.50991257959359759244 -0.10231493966462418266 -0.23930010313189287174 -2.2488247308575881611 -0.74105036713022887085 1.730063500875254956;0.14826178550612639784 0.14119534810256464952 4.3479860898435100935 -1.5696302587045136701 -0.24566394076686787207 -2.7831418494688446863 -3.1742725017457962267 2.1035468726775805592;-0.79351649713758354299 0.80960665252382457702 0.19093408451759985578 0.03578134777849940884 -0.002612426522713665912 1.2413910163637666972 -0.23285881779754596943 0.43244075037337731393;-0.099523039501632201698 0.51170287772275624416 -2.225878079333292181 4.0187650371676211236 -7.8859380595354933163 -2.8351007598356949835 -6.1358980077710247869 2.3514291172078163328;-0.2045393945923670298 -0.13337046330426013951 0.23682999811430630044 -0.074910875857889844265 0.97429014961559634589 0.38051505605972180124 -0.68417124372515103481 0.94305517854742948458;0.080251072692942113096 -0.054587441925463282832 -0.31856907933887068651 0.10218291770892094783 0.93438932291850829159 -2.6007024793300712595 -0.020520778596546798006 0.063543087105359399858;0.1083915848854083569 -0.50525464787694318591 -0.8511755095573251273 0.49454320240477911419 -4.4413760582730352766 2.1468946233795089817 -0.41556096755047250424 3.5880622261525028094;-0.090001017013674050604 -0.021918218341095335733 -0.13332478435455089039 0.058688719776155598429 0.69841910262928430519 -0.29222091883512962829 -0.11687818208191602665 0.29797830553997028957;0.14291267476593247365 -0.0069004482349465726121 -1.8912779189023134485 0.44072316732450567134 -4.1318617537563655517 1.9137502043596066326 -0.555506519502278584 -2.0191806199752129203;0.087046441958621739721 0.049656586824504515831 4.0608924561871209136 -0.72579309591775287291 0.70886360446246299283 -1.6372032227222093059 0.92309894519620794284 -2.4025694766481797693;0.34846277075038012416 0.050277586512537393582 0.81933775118928919845 -0.11199374988193867841 1.935200781647196111 0.68958024926874239569 2.148241847982014896 -0.53160624172841175472;0.86461697500081513557 0.56465123570977049372 -0.036019294988776026645 -0.67421797790806115014 -3.6497222584579702698 -0.10857755691372802942 -0.46879474074017435381 -1.1472907228098772059;-0.15673312778883613516 -0.094862482951512366869 0.56160444973646028721 0.025700953358565353096 0.37346847838010333032 1.579833361381739687 -0.34761671747220596052 0.30959497453608292306;0.17763426194024040106 0.18433878810069073695 -0.47400455362058602216 0.092671519254460640869 -0.56222992636808533096 -2.0847636144152099646 -0.13468364455403464275 -0.06059853516204179863;0.18105653811928171248 0.22730258279051676618 -0.42360882337637789652 0.079021133773414631296 -0.63062253492050701631 -2.2796400792883684261 -0.34531905198699047732 0.04512174225237535613;-0.041571627651215629917 0.057767378334587456135 1.4139275029085200952 -0.010469200932394910966 3.1485027377078349531 0.20544395561445008558 1.3798310257799142331 -0.14501209112208598984;2.4722995757194206057 -2.143290563420016781 0.093045595018421606293 0.06313158913786970361 0.46292754168517946667 -0.61254667161838294298 0.092289044142327136822 0.33710501182795854502;-0.53976757640383943304 -0.46616217166493828516 1.1780419986280301625 -1.0724920123425085716 2.7368608483478729099 -0.19518750899355305495 -1.3084249154421296879 -0.16678208127213989265;-0.0014413852457470478167 0.28917305970182438646 1.5301210355741667879 -0.12767953888106600702 -0.98756039415773666512 -2.0627164177790717758 -0.36251817360754340358 0.21750173068969469448;2.1482976887692686319 0.55328563522489204729 -0.68335637614296307341 0.16527383675066253943 -0.11485091375071687647 -1.3505091689835957425 -1.2601917546231360401 0.011907179351007058862;-0.047826673279144318873 0.060713915825272031512 1.5613076500414824199 -0.035026790574405670953 3.4323087277553336882 0.32219232660520974454 1.4026680016268806561 0.0033653402078185992198;0.1358498127752091611 -0.013528768035302755554 -1.95410044843093611 0.48963782301890984572 -4.1975340811923516071 2.0488845743431896018 -0.49719199719849360708 -2.1215829236335834729;-0.15087376759242407398 -0.1342564395871473637 -4.5514364222642482716 1.6106909805306830474 -0.029390415075380163512 2.8496971822261123464 3.2077735460957610414 -2.154853823074510899;0.17935471758219681537 0.20754138909525784995 1.1326818902705271253 0.074191731608424668631 0.18078186601892276553 -0.026354699777153649254 0.91902932264626868708 0.12011003745791347386;0.93310772665700303374 0.63769484569840917398 0.083426836992024244744 -0.7020130369337473919 -0.21867814855013259501 0.51509998348386898392 -0.69252082881762055955 -1.0231319535500389417;1.4048158205981760016 1.0670273958493274868 -3.0199583599031964987 1.4828314441325147754 -0.21354286047660389625 -5.3529743851384070652 -4.6317861265852338093 0.25667758792196992967;-2.2500774607651479187 -5.4122355657682081898 0.24656332752854129287 2.6137942644878968679 10.841915435431987547 -3.5964713890613402292 1.0913254967932619621 -2.8672092300968077261;-0.15093233908162517753 -0.028263827239966628213 0.62521190335320087073 0.035030403048272998334 0.30303873837292005788 1.1572067847414841957 -0.73297286323120758311 0.47943887081246799875;-0.1513790132812377065 -0.10402196765375670839 -0.055015678307039093953 -4.3014905214093603902 0.65171622149644670152 0.77579043607795594717 -4.3693649663538778327 1.5992609988150829903;-0.21296514111431522065 -0.060678148285105884541 0.069535838433363444944 -3.5962832240620765667 0.99668778041837735593 0.69916874093364422826 -3.4535782245044734928 2.2665056678119057665;-1.8718943325096031316 -1.878477946319614178 0.98746973143186100863 -2.9420031727647439901 0.60312798541505086014 1.0297334059736078515 1.0469562794006515016 -0.79294279118234212156];

% Layer 2
b2 = -3.9028446223068460341;
LW2_1 = [-0.066249160563400563695 -0.11030009647270261341 0.41751134889986002419 -6.7362189023808305421 3.2224513521726452225 -0.11803116817264827643 -1.4006100693281875458 0.51165842450040122102 2.7497948064278832092 0.12467959037060406813 3.1025029826760990304 -0.36097781661099881401 -0.14699433670301731425 -2.3058692434006484717 -1.0573154312874510907 0.081979088180510320538 5.4724075360769308674 -3.3438687320321105467 -0.17914779234367211869 3.2082509214637804362 2.3487356406553141497 10.926643071553611364 14.660378195709350635 -8.7419168911706552905 -4.3569069803218765102 0.57069495948779658256 0.22733844610700390532 0.464061616855789838 -0.055204043708222259867 3.4537679192568520037 3.0725450337286255298 2.8790693647165297442 4.2219799697886735146 -2.0651633299323206572 0.26195339358118818751 0.011202129202013626219 -4.9370023975386168047 1.689509196914218192 -2.1632358318885320791 0.16904280935729021351];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
