function [Y,Xf,Af] = ESPER_nitrate_16_Other_4(X,~,~)
%ESPER_NITRATE_16_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_16_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.9432859739952328404;3.0359684036559899667;2.3672559061419655713;2.3872959648862295268;-2.6557582946368882837;0.44073895670691831672;4.073697186344852561;-11.059712355113941129;1.2687106659982299028;0.98416872209295824803;-1.5971324506600419468;4.6838480860697044861;-2.5922909909612870116;-2.018755804783098462;-0.81224701155450718115;0.97376899540072148209;-1.8427661286187870804;0.40695183581972294018;-0.69961962936248056621;0.71422400602497604361;-2.6180257371161057556;2.062737506186741232;-0.11979914067843341896;8.121194297653277161;1.605248881955015916;7.6184330739941268362;0.8908005035801112026;-13.354065035773970749;-3.8926906661220552763;-5.2365377428360400103];
IW1_1 = [1.446501627870525386 1.1869635121060615468 -0.98802268027235162773 -0.94427552538522729897 2.3439589765266295451;-1.6325345637111801089 -0.2807441713407559658 3.7575278723506668754 0.42303970621834408039 0.30388180135720477271;-1.3290929053403350846 -0.93350106485516370913 -1.1368129446619168466 0.097923539257212949272 1.9865156314112482061;-1.8023926443533364594 0.51596108713975463722 0.17332409659170344707 -0.12431257829298925088 -0.88380634139798541771;1.4209304639960653738 0.82232745601483692166 1.6541652783611853206 -0.71463080041460314007 -4.0825701646452321469;0.524931544290108687 0.18811244250168221437 1.6844007550442214871 1.6125588109624990896 5.8900647363991796013;-1.8211757447831709023 2.1246547679446692314 1.8621280844225456264 1.0669866608310529799 0.66494620735945164647;1.2753885248993317436 1.310700781253832492 -1.7241003408554846921 -10.67866746649160703 -4.9336411007466125511;-0.11312564993596274654 0.64959787706214522363 -1.5118646761984622096 0.14325184418883715742 0.58646056702499782531;0.82572396918533574883 -0.34311234943372542761 -0.15994328906538829438 1.0056819353473420708 0.30539536632928271365;0.18223578549198174437 -0.093352346090668877898 2.1925034739493542979 -0.97628189228326267557 -0.013767480184387757142;-0.69961877087538903996 -0.13235925244379459498 13.750986978770612268 -5.9631999690175216955 2.3248078222479806598;1.0072333076910826577 -0.77973020594882780365 -3.5435126340170204351 -0.94073597845829570741 4.8540115946253070689;0.13255236455415750352 -0.0041219856516978891151 4.0455711398501570386 -2.5626367184588358938 -0.02205864948467393602;-0.66222103597855630497 0.28375754477619163918 0.67547553924747361087 -1.2768526414350986897 -0.18201601067314526761;0.78703689732848258753 0.032097639466740809921 3.0853944921055904693 2.4408442897763569235 -0.62155421118869591535;0.57427007214511771593 -0.23699100926921048971 1.5263315931250440727 -3.1111335580538987955 1.6486663057122017406;-0.15442807830792326662 -0.63918125583403362366 -1.1951953496289444701 1.3254801419933721629 -2.2071465729829471414;1.1948586480543397226 0.19951084032561905435 0.47801278338894725994 -0.94071025536741392781 0.89848050045066885083;-0.12209757991219583051 -0.26254356065551526234 2.245967694799760217 -1.7009117380358900196 5.5489919460849792543;-0.31376628951984891769 0.52139610924279833348 4.793050919125417586 1.1711618279711106805 -2.0000848771424686312;-1.1350801451370029493 -0.16774594934654091238 -0.12638366193490813139 3.0110052819528370094 0.77716931502535824272;0.68730029036340467563 0.62912069327217767789 -2.5111917657713540564 -2.2638121690046668633 1.5074639842064923023;-0.23433690601910112106 -0.27001721545511070399 -7.7506342455016463688 6.5486793056389203116 0.067549788887788314584;0.72110603530917383175 -0.52711928200578561654 -2.4115173925704076474 -0.46237205358775035346 -2.4429192854617527431;0.11880686099036029402 -0.16688677382087929724 1.3398208130788760162 8.9769128616660740505 2.8039519994923889357;0.6975983561981323744 0.75983653541495954631 -2.5524161250046000227 -1.9342021107204210306 3.9925236250840101526;-0.52929093810398442077 -1.0252969533101445876 2.3015088224263768879 -13.013757042055386748 1.6826231068655690404;-0.64178913839693962906 0.61592739202298307788 6.5301531590743788769 1.9508664129569190937 3.2370485613756452281;-0.94554636857076157508 0.90091030288740370224 2.1640764246699890627 -3.7239376739857328324 2.3133907298420792742];

% Layer 2
b2 = [-63.008311088752790852;17.57190763468719652;2.4592328486345165217;-16.269506786112916785;-34.095007372104127796;-46.31139257405722276;2.8545662028525518039;-5.1193739481630693433;4.0810698073311710843;-1.4646628045557059661];
LW2_1 = [-17.146651844626674688 -14.052856218070887806 9.1749246842069158703 -25.570101398350004729 -6.0707646741725245221 -3.1158924670117555955 -8.3068549122830575016 3.3074109986133239936 60.167385636001085913 17.658513279930730278 10.423250871613690904 -1.1041042029437821981 -11.274849862079339147 -8.4428814698357914637 6.3642398952319831906 25.208532612693815622 17.539979529140460102 -29.100990004708364722 -29.307456246811931067 -8.1006151658869853804 -11.586398878894483389 -21.590970589995201578 -4.5788765221940765926 -2.1092363048292592786 -8.0891365043765137699 -2.7879742353309140412 -8.1822486399205445196 0.65843939104242177329 1.5939395656388002376 -5.9035536889851947251;0.10721250021062764257 0.15579517647190663232 1.4714421275816480517 -12.045077038208534148 1.4131698060886572765 1.2898965344351849271 -2.1875843203047335983 -0.59065048587343849107 -1.4204922609818457779 1.4861680114835751354 0.36643589481909139005 0.22288046996849714132 1.333185870675961171 -0.85662969845936298707 3.7739306904810789867 -2.3625688507348874268 -1.0245154629414690017 -0.067446538986501061719 2.0084347222306022651 -1.1497897614513057363 0.06645075689749443959 1.4195897920761113564 0.38388754320381690555 0.19952134803221172055 0.08730828489213049437 1.0809224704670385986 -0.80581396988300491024 -0.91954956319410041665 -0.41558415138885129725 1.0681685817448254294;1.8135452270384613271 -0.34760329348012797279 -0.58249449843701550655 -3.8047600004809396523 -0.48889503920864185726 -1.7842930966522281278 -0.51997292256441296487 -0.75477396213431502403 2.3999776979545739408 2.6735630172148581174 3.7702008753630109616 -0.0340182483725520457 -1.22914591647880167 -0.57827055193375720421 1.7931706614033162683 0.61214772430407982107 -0.936736105029643773 0.59116844645363808564 -1.9992078623062925491 -0.34401268275286817078 0.11566721480767243324 -0.95268872903555612552 0.30384984230450307052 0.060012659754532959866 1.3802148645797580606 -0.66823516802940097215 0.79101091268514922561 -0.12638027402137705368 1.3635926857160505232 -0.25414068214350249431;-1.48287759747506942 -1.2842171103487791672 -1.2149520833086455696 -1.4597161061380186098 -2.4137592373990592876 0.14942548760162521759 1.1747807073305611691 0.19203756973598890001 -1.1906462499957541912 6.6312953416739697232 0.1336043120878271373 -0.20002650497716636946 -0.048827018460560880908 -0.1885602532324585634 8.3331657013344866414 1.880548510601243839 2.6669324877265654372 0.28520818541243547761 -1.0305796241726312701 -0.73076508465718281737 0.54588632040001261458 0.6455172799287230978 -1.0519256075907459369 0.10602482796496950912 -1.5611313169527287759 -10.421552191519714015 2.9721593239491821414 -1.5091982920620319319 -4.3188203043767199318 -0.88707448495548257839;0.78207429053971855293 2.5397090881199932966 2.4711748924966832064 5.4096883662953283434 0.68683483887216034702 0.26925631152021489712 2.0626850649041910124 0.59081942991519986741 -6.4589966554394413478 -13.745238629239137751 -18.383428120585122656 31.246048598241841887 1.3734057279509710447 5.657929237712870929 -18.605300653722459003 -4.6918561783031629275 1.7890776487656023797 -2.0163446620081728611 3.6614845270037394975 -2.4568849072992073879 5.9488010599180825011 3.222784353062287277 9.5391397095564069986 -7.9317951302756402043 -7.1711504758289272843 -2.6517242892273960031 -4.9499920956935463678 1.7374283278950817255 -2.6462469498797811518 -2.6399983851213404407;-2.8647019426356057359 0.43190808014653725433 3.4407101900954479845 -0.026411123086257315418 0.43444622181478298462 0.43244730877727471929 -0.075115418192693364507 0.14786116506825028316 18.15509738893596392 6.3625474694169090739 24.809439259506891773 0.59968377148598728255 -0.31980082777860185939 -4.7669190394283393886 5.6226836892869238582 -6.5532261191801719491 2.4140242457159177825 0.40275575265478891218 -1.8404429842226375236 -0.94820026535985768579 -30.215286182414956784 0.80207273235720522031 4.9532790174328482635 4.7126362924564215717 7.4553276925263256558 -0.16921863954020396892 -6.2928006363409583201 0.60391938422958491017 3.4390704740404656192 1.8541035387149327196;1.6435770716798265845 -0.45732010527770089459 0.48947960267485385311 -3.6969063470276837258 0.42312220562143720848 -1.0877301848097040704 -0.42869785188477899096 -0.73818418195411417138 1.8140077278027015861 1.9856233213737461973 2.8302551067974799359 -0.13929586227342652394 -1.2171917701005077195 -0.21220000687611201284 1.1534034834765105604 0.22463683275488185997 -1.1323024314623251207 0.53925688544591854345 -1.8446543783249069737 -0.049691297172716905606 0.54344407953024642666 -1.0151067278612166955 0.36654147356742855512 -0.16529910857727392326 1.1654288560760062143 -0.57809393519288232444 0.58738726557963460984 0.4184731409991819806 0.74907778402029956411 -0.56696193292183572066;0.38153377331669718897 4.7912600693238980298 -3.6016219864697305297 -19.062860542195679159 -1.0460879504092639447 -1.2942357585236481388 -2.2038873487653596328 -1.7182354504911272475 10.914971218603836789 7.4411835160061112759 -3.8964244448975051682 0.12957461317112792254 -1.0530867564263928227 -1.3135065929162141884 14.09754033865384315 2.1497529666458419229 0.89871240755266845746 2.5716031900055056347 -1.8026543207248892919 -0.93945831545842506394 7.9587519978896272832 -4.6669016675287684492 -2.6070128636229492614 -1.3367600570567295115 8.9201625557635786379 -0.38104728094154366458 13.765488170894341735 0.92952630350895626421 4.4482676145364914433 1.0166465241250164375;1.1629971931840381583 -1.3595037322706606808 -5.742993017537000533 -4.1710459540792701461 -4.10875896911038474 -0.36839977293104453349 0.0174127835668414499 -0.78574584046935003201 0.98191112381220935212 0.56579874459450196778 3.2390690311250520672 -0.73384512001736945663 -1.4676742050429074649 -0.45150174312736990334 0.58553774899052490888 -0.18360949468679951813 -0.38961563401159093889 0.41904331117416648844 -2.2257438689789843522 1.4733716395866265358 0.54466330545184860057 -0.87133843581483871876 0.44054360115105101192 -0.50568217020629346869 0.88832056454467656081 0.19976857921290583353 0.35993804321801525781 -0.30013722367337181129 0.15149766827813798686 -2.0296931556777488836;-3.4893887654765589623 -1.9842882998143338558 6.9315606805506879695 1.8701445656856401367 0.25580084800886704333 -0.46741136708001490563 1.2896773181118852403 0.34184130563728093444 5.1926629186183479447 19.794699233283232331 1.2916763208599870705 -6.3878298014670571447 0.36912494211678914535 -1.1351990726902829731 18.588715979164401659 6.5481667122689461991 -0.54419551732998872051 -0.30054423880706804262 -1.4434169180580604941 -1.275960238174488337 -2.3702131193983415614 1.9279885183860956399 -5.4758962580550676336 3.4168822999994059586 12.090133168346829606 0.76160284691187440931 1.5375824439632495011 -0.3678972360022538246 8.7781903354018364638 6.7515161808877746097];

% Layer 3
b3 = 15.511513647971016283;
LW3_2 = [16.646059413428456963 -0.94503168893416455987 1.8504878796307557831 -1.4465225443351032997 0.25747813777004191493 -0.91287756412279186247 -2.0914137210248520127 0.54268414303118850395 0.26199301606811858933 0.89874462409442501531];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
