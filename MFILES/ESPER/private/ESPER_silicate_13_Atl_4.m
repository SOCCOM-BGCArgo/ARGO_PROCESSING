function [Y,Xf,Af] = ESPER_silicate_13_Atl_4(X,~,~)
%ESPER_SILICATE_13_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:42.
% 
% [Y] = ESPER_silicate_13_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.03;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.604229607250755;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.25136651803010667816;-4.6490687854488896846;3.9564380854446037361;1.5423959806183513699;-2.6339003272592855787;1.4157547557427612173;1.0308748842066195461;0.62246166068073427446;1.4848102850823245991;5.5895271149722933757;-1.9950510967270129736;0.36479453401673683777;0.96052099640249843926;-0.49011377489691604348;-0.20194163341458559735;-3.5419694340631986407;0.12794938535767963472;1.0918274126882996367;-1.3229651495687098084;-0.94403000817287130442;-0.77085919224466603605;-0.88950046522173431551;-0.89209637939469699219;2.4576140430107851209;-1.6545388167741337249;0.45579722836422714716;-7.0869089471458792673;-11.547212248999924711;-3.9533842378975321274;-1.8458177415144083611];
IW1_1 = [0.10313037309126373009 -0.50058933944191108534 0.72095876838314776336 -0.32281725671234645647 -0.21097544332250731114 -0.13499515621647964481 -1.2986020913984339664;0.52321939285992513646 -0.13450777834962493462 0.55075073210825464809 0.87398294154109279486 6.0409601232933152204 -0.67535980299542897054 0.78799932584200138574;-3.2581935855344394959 -0.10060495181618137051 0.69036944734638805432 0.57407198506558720918 3.1351974735528940208 -0.71451574201284462351 -0.32677431793079392275;-0.16966387173828775814 -0.18137472859297570915 -1.6188265345773897863 -1.4056436411818300503 -5.6484425159470150746 0.43042473858480223559 -0.62395579290196401256;-0.18877905152532953315 -0.31701358400855389474 1.0035899226590605515 -0.048196769699618564886 -0.61218651402611978796 -0.34203110239136796933 1.5890384940722277474;0.36132192073009311573 -0.59641406389299622681 0.75982561712860396952 2.1541995942753260351 1.4416939943199471585 0.50573859781241548017 -2.0561949116795261716;-0.61118173714671053531 -0.015623368809138997448 -1.0370499430278883324 -0.94442917762250278013 -0.30274194497276646354 1.4455346541839280139 -0.96502194384130923765;-0.3232262779484071924 -0.061784790995473626296 0.54457924903879761924 -1.0227897714314588828 -1.2970746311249301552 -1.2781049685540488703 -0.085007260300478559856;0.42908105732862594772 -0.94651196127934289493 1.349566392038071605 1.2067979921546980737 -0.63104888166289740958 0.42703564356968443105 -2.0769020938551907562;-0.47713144274823426905 0.2617281073660706614 -0.60463833222268925649 0.51416361974962787595 -5.4288049811353271679 0.6122424202185429154 -0.39849483559516241105;-0.1632321859400588937 -0.078614258226934588536 -0.22815863421128232402 -1.0800706678694242946 1.674275033617611097 0.50691354000098987065 -0.94830984423013020557;0.86645581206136845775 -1.0358245587321583958 -0.83791340799884217461 -1.8721167179247055756 -3.2569649828234714661 4.0295205313369670819 -2.4279202364644625334;0.18654639672769984804 0.38977294362684300477 -0.56269687872902474091 1.036931403344958591 -0.94409888120503049347 -0.69676458653842143764 -0.35755053620519733348;-0.77423164913281072863 0.87498299103141197186 -1.6199502735186745994 -0.34385541190641821796 1.4609742565941052916 -0.33277499451650011109 -0.43673422131363648369;0.31259624805266694736 0.08291364990720871686 -0.1450128825065293281 0.81459029797928284022 0.53772836033039883574 0.90056994064983120207 0.18532384365272294713;0.94006961088608786969 -2.2833691482591476074 2.2501966643668702694 -0.40430125240026465461 4.3794508970776266921 1.0982896969121997977 -0.22990259843891294733;-0.37226370506151129636 0.7022117115471511184 -1.5986514688697743836 -0.97146860451819394555 -0.25811993908635921802 0.030571276567367869359 0.011695027214678847816;0.11816766509024839715 -0.24557263181299943122 -0.0077626641491728588101 0.89645054916074107254 -0.27857984330310120447 -0.39866329048731807827 0.02650107912157355361;0.33750928668459090343 0.041253370376801018482 -0.90007456940602059703 1.2436404568704162443 1.9509201441451864412 1.2766216195889437124 0.021452034451613692656;-3.7139759350732015619 0.14929717082991361687 4.0204194297711053352 -2.6868558813147949138 7.6256734357125139923 -0.12375261263643269616 -1.745129947965176509;0.13667263130411036465 0.32587662395649752423 -0.64092119620357745902 -0.73463073693991320923 -1.1395730010520117581 -1.1027559767969548066 -0.28334310205692742057;0.15485708308720866344 -0.010887522257259404923 0.57529212157793241378 0.29351919278866306362 1.3943329818006382492 -0.56844928589452436984 0.35767544493557390517;-0.21727925472513398564 0.094149554683051903115 -0.062192754104637336388 -0.86712583844776214281 0.67601405029994754425 0.83577732958025741095 -0.78913849148295378555;-0.098582955144751224785 0.18224289647935937309 -0.084916063919879630761 0.40660112522371777422 -2.3714063555356741375 0.14336622679682844983 0.80466035255422074801;0.31616123010056346176 0.352456091247814296 1.7898932625351857695 0.32216064649470338432 3.4969920977787598559 -0.56687619831257574088 1.340961070632258112;0.41348841820145171289 0.060776608800075661299 1.4342684323582823858 0.76069346838883189488 -0.088860435741724877468 -1.0371442041622738195 1.0571708470059424378;-0.91275834639408892635 -1.2668153958241799018 -0.2033228459068365801 -1.3997102054479542144 12.909958516462634037 -5.4868932160061563152 2.220279900932429662;-1.6687480607687865675 1.6524636292409187188 6.2166795812844410918 -4.4402830293064221578 -0.61645225244055257274 0.86770370773301042089 -1.7287058514867126302;-1.4265772140565515791 -14.016649038656042947 17.67683982380406249 -2.4484494967959418155 17.319858031297339807 -4.9201049209647038651 -6.3473746271567552668;0.18765294904980892032 -0.1390070657411659194 0.43075564686896644639 -1.5226503777890785241 0.040942613699742703981 -0.42572929645765389406 0.85919029608052743807];

% Layer 2
b2 = [-12.263685543809620171;-11.039936027976018806;-9.3397608806934258041;-8.7069728296413959612;7.0352455618989315766;-1.4424793481736140066;7.2526273046289180257;1.0168910666081047989;-0.37127386719956928518;-0.94673101400741555];
LW2_1 = [5.9888250120975987656 -0.99966195154113579591 21.040182599576080946 -0.23209114343714409845 4.9521322568553776122 2.2479737503215870831 -0.99784866142056005689 -12.692188726862832837 -4.4624264282824954719 -1.4940105007627368927 3.3656582942006316728 -1.6527349489178684294 5.0930263674362157289 1.7194170836085007625 -1.6294772649995035163 -0.31302441973130140651 -2.8497935004903647283 -4.9740472180922221668 -8.9065646355632104303 -0.088540577568089348648 -3.6748613227876711917 -14.382860635191020648 -7.5117336663830185373 -1.9316976909556866637 1.6405077797708158549 1.0273839022873259008 -0.63403627102775683699 0.67199899987159128489 -0.033309035520799765151 3.1907799709505786367;14.782860862057813023 -3.2935699371396314206 -1.7743020591617850723 -2.5706486766725404891 -5.8684771851064301273 1.1876703324368003134 8.2030429687350654433 11.619923559012386605 -8.0970102264750263288 -0.032327773808932383504 -1.5338589974791012605 10.13803889365041222 20.916768954710352801 5.1328634783195559166 13.575101928691646336 0.49763287974979691919 -6.3290595171162582488 0.58323305207610087741 -1.3180251889995131531 4.3687980682672860056 -13.647283344806460548 4.3983378590954043119 -4.5845366938659299905 1.9535574406445499474 7.7239656851566156348 -8.4675218013369182302 -3.0937241600512157547 -2.0580801547824156827 3.1217832940525762631 13.275348720101542099;-13.070149874381314703 3.1785279081325370498 -3.059400769330437253 6.6894496726903067696 1.3044223316145573399 -7.2543214970381759699 -8.1003455811883000592 33.794424022662639118 -4.2222122716149002031 8.7152993620059397983 5.6014538811348639769 -8.1102209354144765285 -16.959601196465690975 -8.8545914605775095652 16.166704142669278355 6.1883990393910632832 20.777887503772884514 15.261508872715571883 -1.0654777158939472415 -1.2109079113154945784 0.98487959407670677692 -37.307223531706156905 -16.218488395647543854 -20.969083562694720513 26.700434401333470902 -12.771087343921907475 -1.772990517951519962 5.0645380363321965689 -6.5015020314418743297 -8.4280161391577799179;-20.076814042731534471 16.656419527138474734 -7.9269063112035489382 -4.3526250624300049097 -8.5291903882083612842 2.8097604041353503312 -8.5042713395450970637 11.141701245509626261 4.2533474638251016486 12.176203555805814815 -4.3803833338208022496 -9.2380708648685239126 -23.661690156075085412 -14.011603262482934085 16.746579798399476857 -2.8663259404468055536 5.9388965302391882872 12.802165252393420403 -21.0547421906052179 -12.455667154489939108 6.3133510046380969527 -26.571092991755424606 9.7278648233903943776 -10.617588248525425598 -6.0659062817415891899 -1.6141677116738069042 1.7324408488359437364 5.3637859456615410991 -4.9582896460129921579 -1.8584049933189674686;4.8866311128287556187 -12.156115043244064111 -5.2338189211170504933 -1.03821617588913373 2.8894445722033199608 -3.240142872472232316 -0.75852050921452240928 -3.8148451909927687531 4.4112140437443683183 -12.595321911375625845 -2.6263545820336888781 -3.2988240502983083857 1.1009380481308845834 5.7049236559551150805 20.409327437252962056 -0.92178380555666583618 2.5696135844761545108 2.6760791858011696576 -4.4689817762189525396 13.731423265407601164 -9.3006142416205097589 -1.2934782572989500515 -0.90586535641183552059 -4.1898593766512286507 -14.899202613831629805 8.8937672440008235242 0.19412207017359242589 -2.8655828726641638937 -0.53611128418392417494 -4.9907863559261675945;-11.152761608286315465 4.2166961933208559898 -3.7459820313068430409 -4.4260275552440502267 -1.9222179003899819705 6.8750013781383696454 -10.224386522817697553 12.78054943231887286 2.8690750536123466041 6.4417612710216944905 -5.3638771178115760563 -2.7268426582197231589 -10.323829172981714208 -5.68083981190376619 12.902198176582095002 -5.1856237858808800212 5.973750655826753686 2.0466077858979585535 -4.6146682740913833598 -2.9908298847504357632 5.8341627650372309688 -37.500930487581399575 2.3550089723143967646 -14.052087416126154196 7.2682939933800971843 -2.9144498609753819451 -1.4997519954682547727 1.7531815105665697896 -0.29595291754091923586 -1.2483605283458996116;7.0471170980783979232 0.63026319118768758809 4.2497469733947195181 7.0591978568378781489 -6.6931621770088671752 -5.3521686263755965385 -11.591317854195786197 -0.15108231940440691732 1.3166886599856000295 2.055226467334706264 5.9185142285929375205 4.0033852611035083413 5.9710539370726900543 3.764523360791102391 -8.5542816020103629171 -0.051652054380190243199 -4.7523607160370326952 -11.063294430021052506 -1.6809914186624308474 -3.3297925498003166922 -3.9340864997976230377 0.29672007272699518765 -6.6274999869786199724 4.3732933894347647552 3.8140535986248904621 -9.4720975925324175648 -5.2581999118753524058 0.38178742026415135591 1.6795733292727732522 1.204544422194309794;-1.8961796512844006912 6.9020264327544982308 5.7999205105509785696 3.5779559335858022173 -3.2925584500966733614 2.5585645655931297249 1.8660559432592795925 -0.15884715975375898744 -0.074758756058327394123 10.815982306615438802 -14.734142162521143504 0.022701437395796244395 -1.0622998231761122678 2.4924211412913388486 -1.1041117973911003247 0.55726217464224692133 -1.569600405697938017 2.0200609050130973188 1.0995724705629528195 -0.65767225392554296004 2.5285996041966822823 3.0776578627199175919 10.417446031524038474 -9.7903595449336187073 3.0853536593979558056 -6.1450327978972989484 0.1508119865862750375 0.59806435678722191795 -7.9466274313912936833 6.4808192507383139969;2.0217122455527665181 -7.0962112257367033763 7.5270369600409638977 -3.4085867627388970469 6.3307943226620633226 -2.1703083706520946983 -1.98575027083404132 3.1175286242544339999 -0.41328675402383702187 -10.936262670635459315 15.169883006208246812 -0.074107920472328212003 1.0280661730687321587 -2.1863707160005172447 3.177069854123171222 -0.55912708290641766062 0.76837397477234314902 -3.4136369391129255391 1.2562090543980355406 -0.07233852040821463214 -2.2796327719831976921 -4.6738831325616754242 -11.817140014644060386 9.5176817265451703065 -2.5889915092651234474 5.8641056229022296975 -0.17430622412947194277 -0.49687540708904132103 -0.027592919533475566279 -6.6240350315006546467;-1.0965209145148369085 -4.940386298223399919 -6.4353602243456533571 0.10561651877379733822 5.4737173618763650396 -3.3725457911081790918 4.7559594816505175174 5.3457326316473041672 -0.83278565581965235953 -4.7932189343005324744 2.6618436794922977207 1.7713244840948934034 5.1409291143002810998 -4.0554159466962609315 -7.5729782691296669839 0.7823982187817444256 2.505037629166632307 7.1378056609511872921 9.9993658927271145131 1.2442872950374939123 -4.169064063733753045 21.210125853269605756 6.9355909262116037794 4.4124648843086085037 -4.1350064229459215781 4.009432834250431732 0.33657430052263598297 2.7165160096094278508 10.855945433859421456 -3.6321930100987254164];

% Layer 3
b3 = -0.92493829763137302979;
LW3_2 = [-0.1393229111214607796 -0.017928688776584319337 -0.00777605590750491283 -0.010352776348511999807 0.016902401422346093052 0.025153664575787781227 -0.012006183192308230237 1.1211594741532822095 1.1480370343564922919 -0.10323287785471400857];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0145232735458572;
y1_step1.xoffset = -0.52;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
