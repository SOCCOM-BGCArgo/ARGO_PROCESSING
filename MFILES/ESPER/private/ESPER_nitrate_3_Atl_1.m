function [Y,Xf,Af] = ESPER_nitrate_3_Atl_1(X,~,~)
%ESPER_NITRATE_3_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_3_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.1259848122953677318;-1.675696574787983284;3.2565988869632107594;3.5570368143247312887;0.6092952012957836283;2.1584420074909851373;-8.3836568179600821082;-7.5433368582133395464;-2.2227211477132371442;6.369536477265971719;-1.1243275890190773669;2.6833956113031240953;-2.8511664085347434572;-2.1816370082894827043;-1.910847762826334284;-0.40132116432882458668;-1.2423605481575963339;5.0091070993523532096;-1.1460159341794313725;1.6120565392021981577;1.7031181397517765053;-2.4403703609195730451;-2.2631309276556033083;0.27281375087730963536;-4.4114075092365458985;-0.6162651481803747;2.228268989127227151;2.0671813525631383968;0.67252823125435567952;-2.3362349847375929457;-2.0061015082457500647;-2.0370899676995106731;-3.2153174564302702265;1.0903795372938849262;-2.4508071466742142874;-2.2149257247297895468;-4.3427160823366630638;-3.044678965962218431;-1.7402443236615288136;0.86762578285555824742];
IW1_1 = [0.2269446271759955891 1.2276794912057733544 -1.3739344501506096652 -1.0535542880590069714 2.9112627620295685738 1.3205852240152224919 -0.5778690654763501966 -2.5171941908153785405;1.3006108957684630045 1.5271627643185508028 1.2550974030736723464 0.55625011618146114056 -2.9286503652092306105 0.76828205223746781627 -0.10483055403228397351 -0.65647131782000567313;-0.12684887936597882829 0.63597520071283708543 -1.9715857403489309707 0.37304146028704671112 -0.98667075740202048184 -0.20216067794153894099 -2.634254079562912132 -1.3831645469824105366;-0.16749322183218873228 0.65420972794533038819 0.44446323691144923318 0.19069238703677532376 -2.5046370128074326722 0.052998634424965287981 -0.80113554644923956616 -0.40539051171014189867;-1.3713630413453674617 1.0251786071337807282 -1.0291034265365683886 -0.48770198133671360807 4.69369599201668386 2.1030809606984326443 0.7715148780940088713 -0.0080560516164848126885;-1.0218625331764432662 0.68630817706126856503 -0.45337705786713600187 0.38804160141981913767 -0.073828498494178357303 -1.5985041939075967932 -1.1251528178434704319 -0.88932810370730797089;-0.39091726987237362945 0.051432486922292852682 -0.37734006570669498259 -1.597526676900755449 0.78799602856447448218 0.77266843273518959201 -6.638551686438836974 -5.9906931611572273866;0.86359818163361745658 0.3771187606284701066 0.61816963362649268721 -2.1883696975947626306 0.72253644773236003207 1.2944431378562619717 0.87217702152659304371 -3.9534133631842851564;-1.1895311441937539421 0.20014014066997379282 2.8887967119407735872 1.0921352807633875059 -1.2725651547668002106 0.40152423605518489103 5.0563582154723194506 -0.72598049126698316336;0.15890799121028886809 0.21249466143129858153 -0.085013177927619129615 3.3224719783638354542 -1.0807749982063914462 -0.015767541277528475396 0.54825296872875040055 2.5389387468445856477;0.398266782639767003 -0.32603014346267378265 0.32392138115761881512 -0.69083866387574932588 -0.045510822074845400098 1.4442756700817800386 1.207617773848470355 1.0196054293376117794;-2.0329442944422133621 0.94955411525153665675 0.9859900161066356139 1.9858997150476076499 6.2033550761910314364 -1.8944094245631644124 1.2250829366204851745 4.0157130765387938354;1.037830803566049509 0.031053078331046056471 1.4896788542130339206 -0.83427027843879886237 1.4459620094926379785 -0.9899362385348658977 1.4091120677153181617 -2.1990795900350663672;0.3556483186751868697 0.25238957870238781789 0.40599360800162465068 -0.93714786535552396796 -1.0614681484919508136 1.4913496309469793655 0.2070140471000980753 -1.2016136417522329527;0.078524773939693218172 0.20317898835574538241 0.29567540938529496275 -0.62504218518819765205 2.662972936502177479 0.42091912198461201022 0.63973939831423320967 -0.23668120468475681295;-1.2538122790561805342 1.5797844780841068246 -2.0633773457521069616 -0.48487774008002348936 4.7058506600939642439 0.22902760486138468154 0.662367723875265213 -0.50226017283740520547;-0.14715319993787628894 0.042010463709082845885 0.4778301821345227185 -2.0134814365173316908 -1.6470939838187701465 -2.44138219559812919 -0.44907951096809062275 0.16284648854283634289;-3.2175174747759189842 -1.4617229057094027755 -0.40872516918878210035 0.56362103891016557267 -0.92690602113846154442 2.7230887052540451165 1.7343777191873142041 -1.0228451419037816184;0.0098450827111268915393 -0.32650466930671334653 0.44539030042627475448 -1.3000634634041634552 -3.3498833823527598419 1.2148197960311226673 -1.2884833042449594931 -2.4256649429790342332;-0.19963606783759968444 0.32231463571099744359 -0.056053293796899897328 0.29716160179707706845 -0.74334771896109907985 -0.039328892162879415528 -1.1414003976602726809 -0.36284640978455534599;0.27620971215990608449 0.13727532180851345633 -1.1221329550475716008 -0.33750154330252302159 -2.3145057635417871644 -0.74794167356720187012 -1.1436967089633749417 1.1705840395577264967;-0.15099154469291600766 0.029261018502526766477 0.51413080644451902845 -1.9748593285738234027 0.021371817294182041125 -2.4396092484957820901 -0.99454926724854753051 0.09045278547127097446;-0.082157545612713711591 2.0112578743926166069 -1.7974941023344386259 -0.86773560884617684241 0.30523147078850304537 2.2444265006148729213 -0.61493138983092199279 -2.1435681166765534478;0.22942363724565942307 -0.45047565027560271256 -0.52772927192035190558 -1.7806252197842513674 -1.8875571311709742339 3.0389744058964160978 -1.8757382759673675299 -2.3086856281585386164;0.74435617421143551731 0.37336166697013051241 1.052709042279231566 -0.22359665325518476853 0.80597036620692619202 -2.4458143288371680946 -1.8641809912799824911 -1.0757148248235710586;-0.83170641838107695065 -0.3553328195957727309 -1.4413741058504987436 0.7603333734095117924 2.6796051095650730289 0.50149431925188292514 -1.5143280267080934109 2.3748573635853227337;0.19364575515092938285 -0.81572502358113219145 -1.9618776814364182748 0.15982897732660872325 -4.1264391527671211435 0.45941058943583445995 -2.0399130222948560487 -1.0165168529759904814;-0.90412746488789086374 1.1715257475118481256 2.3140003970738241001 -1.8287859970751427774 -3.3293727440208167323 4.545028369043055072 0.63489100245869112271 -0.9259343731615063966;-0.033444542251320881487 0.66979712909327671078 -0.30656472374596460684 -0.30111303944397260768 1.2067050247846080602 -0.20993202609500635769 -0.78798411774137766539 1.1416327987804482103;0.26217566466718111862 1.7682607512927219773 1.4839600437859723492 -0.53318270915064291948 5.9268460640015723229 -1.0682029245874806733 1.1467989599371897214 -0.09046531105553400065;0.039493988536775923026 -0.74306201936539051367 0.70479418831831586179 -0.3497394721703900311 0.0016851827525820733955 0.38094654854149734291 -1.60354130441272269 0.14552312520887528136;-0.017647305794229888737 -0.97957111966268106684 0.28403347339168399932 0.47817675137787735151 -0.085084849628711392566 1.8025658467051064449 2.8097523521936791369 -0.31064388814640270242;-0.024640801435457354573 -0.32110019686820778784 -0.079724541606152582451 0.42533838530853823601 3.2299072319540300668 -1.998396340424763773 -0.59953917909571619038 1.0405899474446249631;0.098512664995268367507 0.46204122337955610966 -0.34828724138213063011 0.95655278750698935486 1.5482136371824311016 -0.12567040882510052691 1.3668215245425414661 -1.6260702234958333001;-1.1049409535760252865 0.2358605612925923356 2.3391227041270510334 1.077141154527723188 -0.92789326481571321459 -0.24888791688202790975 4.7409869385174081557 -0.69909228979217552524;-0.17289859395945381126 -0.30167185791026635 0.35161039947449634901 -3.2454673094524824073 -5.575121512572618343 -0.60885561220296957607 0.52293548650444687809 -2.3376290724282768885;0.77745246349142704823 0.32029187678241111126 1.2284238485603655722 -0.35586610460370565745 1.1728876844090279086 -1.9162349530211606474 -1.7483267441298742106 -0.9537971597206538199;-0.074076413500788515498 -1.0033682174643070439 1.1897270376909836465 -0.20014614700569902106 1.6596441508279318189 0.049375363826505057341 -0.79423243555591072074 0.0025274521739189897973;0.69954005137489416732 -2.5073056011601906334 -0.30520933146015361004 0.60427902597576621524 2.7548089982082131222 -0.43567262780469556693 -0.47933751694315152037 -0.50720246669793223049;0.65948298437922014958 2.7678337147430531751 2.4363248365884824231 -1.3818310140629070926 -1.5945000319493167762 -0.0024417471070496531843 -0.73175815583481462756 1.630963985656977977];

% Layer 2
b2 = 0.23200953179053704356;
LW2_1 = [-0.58381592464817888555 -0.96153802534617571762 0.83771224375104136328 2.1397014134891931825 -0.45483822874979129569 -1.7857189191515157045 -0.1021195827671526335 -0.95916794969025087614 -1.2029126599702941736 -0.61135471185468726052 -2.5864809476990626713 -0.13819042732981637323 0.62668373420657397244 2.0738149527024440921 -1.7662509038914970816 0.37502834721268030194 0.84610070993183694732 -0.17752201908334261371 -0.72094488867464656678 -3.7238233586303919331 -0.55979175415926452075 -0.88032007279339397066 0.36756917529642008091 0.12701085379495283267 -1.4385854554226145119 0.62572023423601874637 0.24474102491413685101 0.096422905196628133639 1.4298193409631250184 -0.27206280495834900268 -1.6994919950084832472 0.70829707189285484592 -0.91667208661819743476 -1.7972204500090098733 1.3785754998431583029 -0.52310001343668000029 1.5743710901851406536 1.2871552551211615789 -0.18120130324025621182 -0.14806887908998936365];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
