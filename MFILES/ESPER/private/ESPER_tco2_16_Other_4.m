function [Y,Xf,Af] = ESPER_tco2_16_Other_4(X,~,~)
%ESPER_TCO2_16_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:04:00.
% 
% [Y] = ESPER_tco2_16_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-1;-0.999998793562952;-77.961;0;29.715];
x1_step1.gain = [1.00000000274156;1.00000063368067;0.0138606862425759;0.0002963841138115;0.248478071810163];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.7646915599501021;-1.293931299551573;13.097995485961592;-1.8482261629837387;2.1827138833520596;-25.418439777465;-2.4662851813736886;-1.6363960676919056;3.4528988126881126;1.0345270261409751;0.2597785995043283;2.5147965180916301;-0.65582725182481605;-1.4641613365291168;1.2714968999482532;1.0542507840381941;-0.38274432790049817;-1.8989880397309757;1.267754721484732;10.61766258626028;-0.12535262298180314;-1.457271253424355;-0.11648308038075994;1.957436579550204;-0.26868531923817207;-0.3368625466259626;-1.0017560048925731;8.9305000951456304;0.6815297974909631;-21.505820676017514];
IW1_1 = [-0.45625567152148994 -0.12059812105833698 2.7441712955962392 -0.018286032092939424 0.61161328709992069;0.45150343286043954 -0.064026037502600358 -1.167277715381122 0.8892876847303397 1.5129134081566273;-1.2919642839659597 0.95613410211505212 3.3781434578485756 20.113587104571376 9.93876224240962;0.6242997913136189 -0.16454782619587074 -2.8537623242794674 -0.86493849714562498 0.2291871989221145;-0.15462078085909897 0.13896574870632994 -3.6441913855614647 0.39392371401080284 -1.2961063198145264;1.9146911351437239 -0.38794558026662573 -10.945356673736992 -31.667095721635089 -10.392873929799235;-0.58763697986900165 0.77412444747613673 1.4343777073655011 -1.678995919535218 -0.71043351148469747;-1.0604193615641677 0.62030013336946521 1.6284409520841923 1.3162685957765752 5.9170533979893758;0.41862672873809548 -0.166875790399373 2.9062264797528825 0.27450565142693822 1.623091968936617;-0.69002832435639316 0.45460024969056689 -4.69453912981351 -1.1970099010701096 0.4900531466909489;0.36599867996392038 -1.509658158672738 -3.4409208041453074 -1.0783365954775648 0.6033732059685929;-0.6203542560234403 -0.29866295320365721 -1.5148947400055075 3.2039714133422494 6.3923650775066134;-2.1957295048378094 -0.83666126456292 2.9636876575313358 -0.27200717934724472 1.3155148061776876;-0.55421030267546734 -0.057308268702639081 0.041420217414872652 -1.4685232481831048 1.0054514017457887;-0.84087561648319531 0.64291664337068888 0.42230164229358053 -0.92341437154631878 -4.3817259323201032;-0.060811484314660352 0.22653179026834325 -2.2540787952863117 2.4263678961693138 3.6620965230331977;-0.086994215215722856 -0.18189557231229847 0.74376620776053459 0.58637082131052587 0.73241249720151624;-0.54064009757910514 -0.56542377869257399 -0.49884209896661985 -1.7029656039043659 0.70231553820299453;2.7723268891739594 -3.2771641611395035 3.6747889418170585 1.1775602615975831 -4.1806689744414642;1.7262050325076332 0.31518666773465021 3.9055371102491816 9.8034994297126676 1.6799586466967147;-1.801395875380094 -1.2527009791490387 2.8243613253484341 -0.10896170850785296 1.7481873913167845;-0.40742546587069323 -0.093136284477611797 -0.30739235054725655 -1.4981906888349925 0.31625999675376631;-0.42856250572688898 0.03414295704345708 3.2461458672937296 -0.23839589362152652 0.97804951243769511;0.15119386627149395 0.51963696182776697 0.25655537078246909 -1.8820650466569819 -7.1652919268361339;0.54110985305879755 1.4879969680361658 -1.0646283643375976 -1.4794251260138052 1.3644201063644605;-0.12144259739053578 0.9757189801899 0.036807196287610547 -1.158936380851296 -0.30248515366928641;5.8519857428009985 -1.0934060223280999 5.0677505134269021 2.8793821019588179 -3.4690614440077479;1.579636530068655 -0.86750872452484618 -1.8293111065615284 4.633200679261205 -9.4562044369023273;0.56033654812600664 -1.3504696281830124 -2.8009478476476182 -0.92469092034652201 -0.78777490561356778;0.30605676570723517 -0.15029538761643457 0.8567181706279573 -21.017458618380303 1.423974707341674];

% Layer 2
b2 = [-1.816107894723904;-0.77280858535003716;-9.1549495227619015;-9.434365760968749;-2.1028987989892314;5.6799128526207543;0.25934284449931005;-6.283012342987055;3.172314217663025;11.3865503020176];
LW2_1 = [3.8913609391182118 6.2964566183245569 1.0374471750214316 0.12586691511263215 -12.91172590206979 3.4811571050484242 -2.0970649821291034 1.2988361896106531 9.7480595147860836 13.649158909162578 -13.558835795338155 -0.80885980024703008 0.21497163307378694 1.7615194889635872 -2.000638410005076 1.4354089812982387 1.0852549086810597 -1.9695307780435478 1.8672173732968282 0.076044729098240477 -3.7261725701831474 6.0773665165342621 1.8573625188602958 2.5428154421585609 -1.3027232596960558 -0.88045150253456061 -0.45256207875229598 -3.5610192097989244 12.367925756837137 0.55638638749355906;-4.5142918294295962 -6.1894571750213601 -0.84440854472209625 -1.6124132242192437 0.061287082693144521 -0.2509911508940138 1.1600541189888187 3.9157519721692187 -3.5618729185172691 0.75421762027417183 -0.00087563308537308426 -0.54089488140747422 0.91242963541296529 8.6801890985696399 -1.1624726896781514 1.4701862579982203 1.1305742636154141 -1.0388801392157103 -0.13721773766625844 1.3880736132420386 1.2933446413022784 -8.0707106644965965 -3.1456427705087897 0.67638522375102084 -0.39084146216845561 -2.3865880670112514 -0.42881927552523358 2.8041165689542491 1.9913333770162247 -0.20398835930771728;-6.0271788860236821 -3.7856450723227653 0.99641978136455034 -8.2166213314312468 9.3583825446656999 -0.64732670679347615 -4.5191428332370229 -1.5432450395599473 3.3712451743608387 -12.28970925200127 2.412817106159884 1.1650331675676697 -1.237529252211288 2.1860126732359535 -1.8281841340907758 -3.7722751516258164 -11.494410835817737 3.274329958049401 -0.00079027401183806058 0.58053519696034295 -0.54892676728801748 -3.6048478347409012 2.4657750381496304 -1.4192806124602373 0.10032319777813228 -3.6036338766185487 0.76805767519631041 -0.68189341594489994 -6.9195441186258062 -1.0184915196802193;0.71305835333338718 -3.9677809078448947 -1.8037758553599081 -1.5180946158246971 8.2245699797541008 -2.3175798928584612 -8.5643576708257605 -1.7748268996269991 10.524844288314908 -23.047775383236587 3.8730713970568917 -0.86354802741560299 -2.8783057079004237 0.59621606104522085 -2.1112599449077605 -4.9932893846761566 -5.615007951193272 1.8233014228767188 0.41893410597156278 0.75983456823166107 3.152678807788905 -4.4501088861328073 -1.9578111679139127 -2.4180507763915711 3.325201893626903 0.44407753316099341 -3.2865908218975433 -0.40613306903007407 -6.6089937202431894 -3.6563711176687863;-7.2267850165617356 -2.4777396163154406 -0.89793585921473162 0.160291738606159 -1.4380601101314148 -0.74582301109532567 -6.0665765179193833 -0.89947039257453798 -3.5389202312208203 -0.64769128915563479 3.3961028818023231 0.41012696708019941 -3.9787659932364621 1.9532048755665357 -1.4888626022699591 -2.026509653107023 -9.3754744479370693 -2.5883592707585841 -0.75988041432425513 2.5975004395370616 5.4672425693634246 -0.19546252519777141 2.2519001424284797 -4.3253504149094866 1.0830240345653599 -0.74885459058811887 0.11369410333079293 0.68449223747546473 -4.0428371047138283 -3.2612332031409186;5.7334181990004494 1.414055383887592 -0.34222480359286989 1.4896148444362642 -20.000996562123824 1.4551176190481414 2.1421193876978499 2.0121483723396389 -10.984044716311129 20.414174638533801 -3.3637987584739948 -2.9264461130379011 6.4501660878498281 2.9024714451052707 1.671344740484396 2.9582242412910769 -21.398167177930446 14.199642809803287 1.1452483557397013 -0.37397348628525828 -4.7548392012905447 -18.007414864787481 -4.4918940338250062 -7.6377258445706744 -3.908083333638964 10.569943882225799 3.1626739603436573 1.9852246209373565 1.7773980872860946 0.81091949987307566;2.2187888771535786 1.6248211417503242 0.07799578494156871 0.86216832703085777 -0.2735150410688405 -0.11331273588339703 -0.48916890985111461 0.21382529991886529 -0.9948973939297483 -0.0025839980605248413 0.26308469917065591 0.44557732135515754 0.051760069639356442 -5.099252786078317 0.14791965464904192 -0.42438742693894943 -2.5724637059317566 -1.4092737435657399 -0.019164835792945339 -0.058893267204966238 0.093953696622156191 7.3668124917683144 1.1488775038313537 -0.51034846556047442 -0.36829518932154937 -0.1545440495651835 -0.011968118260144142 0.10237375868781284 -0.49348892027428348 0.16718402671727131;0.97050170255023371 -0.94974407128886917 0.650717228194576 3.5801430377046009 11.866009979913715 1.3369689265106306 3.6639845005558973 4.9237887262296987 8.7880268850778194 -5.8896702019194214 5.0009645551368278 -3.7052678569199542 -3.8609142219670556 2.3727949450526791 0.90462329926861573 -5.6970460644163143 0.70167630517142821 5.8931035956223399 -0.36775541511380261 -0.58042872312012694 2.8890088969362355 -9.3608863143117382 -1.2346584012027952 -0.66626611076113318 -1.081819944662944 4.8302695145418584 1.4476697919192805 2.4645279268246831 -1.9632481793016339 0.087254112100906236;9.668076060620665 7.2929021116316104 1.1343817049889657 7.3844821186750895 -7.6593425772820236 -0.87182568323445886 -3.5338769359388968 -0.8905073211013782 -1.0615776437007369 5.0056370897581717 -3.9460296087236166 0.95164533564006282 0.10971097394473708 -4.5027588728596335 5.2113890818491466 1.546910421513022 4.9167164214185872 -7.8017643342582961 1.567418707504838 -0.39534984137580537 0.74060871840636533 14.757248268917078 2.507415216381657 -0.98690942802749637 2.4431692891596306 -2.9465208924048025 -0.66893300191583704 -1.496421778689847 3.1397306131448266 1.5205372687660001;2.2969170626731752 3.2424690292008758 -0.15757293462069008 1.4355975088565085 -1.0557618364786239 0.11244489391782161 3.2661992597988125 3.8950072341331956 -6.7842115975516863 -0.1307865006554341 -2.0542978220494397 -2.6178683144198835 0.82295914084337929 -0.38223553276394578 1.7259059666509995 3.1070925961923805 1.5943545882477197 -2.3541923037667911 -0.4325005361442551 1.0376550576764352 0.44089655995065963 2.420177614770108 1.3602836281844204 1.3788158461363813 1.8742414226177717 -3.6539871133587511 -0.74951540662374805 1.4620177013060696 7.1994300804183124 2.1389921868940451];

% Layer 3
b3 = 0.35857563936581244;
LW3_2 = [-0.067238308912822883 0.1537353947560984 0.10045663355434069 -0.054887179768284777 0.13811118130685063 -0.11955155686273909 -0.50624719382982131 0.071728218154073403 0.096661357974590134 -0.24258040652241378];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00314743155299998;
y1_step1.xoffset = 1774.26765577007;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
