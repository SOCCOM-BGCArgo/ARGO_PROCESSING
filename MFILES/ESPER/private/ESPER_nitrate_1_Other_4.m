function [Y,Xf,Af] = ESPER_nitrate_1_Other_4(X,~,~)
%ESPER_NITRATE_1_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:32.
% 
% [Y] = ESPER_nitrate_1_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-0.04979;-138.904784718693;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.568038194888224;0.0042772329208737;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.6052010146486759279;3.4515108172046571333;-1.4243846721620276874;-0.6409491724427546222;0.8638319060115867698;-2.7859773373705882804;-1.39385210649727731;-1.3961356079165900823;-0.99746764911330254577;-6.6046654940966265102;-2.9680586429481485844;-0.49765002687061127284;-0.52891664158041817867;4.8501608071663486754;-0.40107001826050847626;-2.1179039566605837308;1.5768743887335296971;1.2836099719892593018;1.3773839578456741339;4.4327972348383628542;-4.6389468023916382577;2.3828066911930685379;0.012851710836598702337;0.75457327284977315784;-0.52454063183401422599;1.4351575735974362313;1.0372219992009805711;2.5204104244305574056;-6.9109221480126974413;-0.73671390956736793054];
IW1_1 = [-0.43546077616037526248 -0.074472803735402312575 0.20224458143958307099 -0.36090728581488717985 -0.2189407812069046888 1.0268853902931089905 -1.0078793579375064926 -0.5053293033670691603 0.52022499547939560216;0.38776801931133136891 -0.53262129047974471341 0.24146483956535108595 -0.11555858091718479441 3.1447556365194979655 0.63908668262785506275 0.29099755308548713728 -2.5929242479833400914 0.072661067543103557975;-1.386544035250250273 3.4306654591207608185 -1.2589478052919640394 3.4470613608620079837 -4.1115430344179255684 1.1513166161588634928 3.5948189517989233011 1.3039133725733775826 -2.2322929091002094992;0.21364168599361846312 0.28826234151929391869 -0.31647592433451726679 0.022181498564277687957 -0.038978981078059575516 -0.77138904826827803252 0.17413534943589989434 -0.10068928825164409624 -0.039444259491146271834;-0.3857344846700491714 -0.10450342319050898166 0.1137913721710842041 0.00058811269715131585245 0.40963761823491701142 0.6613790797900721552 -0.63760089961867050246 -0.022976845132996043947 0.23464205164184562258;0.74891719045262405974 -0.55332864854979124658 -4.6631579112168370926 0.39057861114997488583 1.6032163306113498269 3.4750293869175217232 4.3929621719283087344 -0.5678196989815760265 -1.8167003253997000556;-0.096471796682042004756 0.071283897751369423856 -0.05702065136306312676 0.15750275895021492722 1.8408822541074707502 0.47542941271799471492 -0.24554354140945780505 -0.80930896707683930291 -0.57600152649728286747;0.23366422819023832669 0.79659126229536081354 0.74430761166692183117 -0.67340128133688226253 0.20257788176929103496 2.8572750217815214846 1.5499240364175823625 0.83982919768594632703 -0.25943680842514033058;-0.14638950229784922219 0.1892668736604013191 -0.2375312257410996386 -0.66374763542556602935 0.45671909137170013659 -0.28161930670110724151 -0.39046152654928534265 -1.4233953988622329856 -0.18395602412174996698;-0.021940972195756081042 -0.47483018991601216863 0.019759478904147812633 0.09097872627701664161 -0.17357297300237031767 0.8844887454343134392 -4.2288984974764955993 -1.9363775172059218832 -1.3687249191673183102;0.64487363726578261769 -0.20940235165156653729 1.8203566472845027491 -1.3595256654595198054 -1.8645198249836449911 0.48655716435621210181 -0.73320600978649552726 0.18965734248279450536 -0.43472332850683159666;0.0046826114685451017405 0.084633954639386069219 -0.30729129494135926093 0.43450424133917459057 0.76480448528973110633 0.18375396380082492653 -1.2153238626294282643 0.77998471587878848155 0.035469208792092581095;0.01554816443908971571 -0.32587459457050294009 -2.5647158432597074729 -0.23034376357573133065 0.088577480091852817123 1.4006320881976561665 -1.5125696852874377374 1.5728974349167090807 -0.306538184613951048;-0.4653212785580732036 0.42828022083133621134 3.8466827838107904292 -1.1487644136131596184 11.524900392847378328 1.2500980371680781023 0.31594860646910433166 -5.8284363622139068184 2.4109636690947771065;0.021809030271139777379 -0.3374112292825220405 0.71803472342223306768 -0.30817232748667511277 1.9110613249133221458 -1.6392125213480426282 1.3961168680806244069 -2.0134261277539358126 -0.060694009006910611126;-0.57323897279285540574 -0.95753744731133472179 0.2749594438564909038 0.45318999103451507171 -2.302022615049841292 -1.7497563721900772915 0.64743133634654570496 0.9192202787915959572 0.1756664816622809655;0.36759482749146815683 0.072109658145491306591 -1.9715171050304247657 0.54545594076731762634 2.711046970957733393 0.70146713492920031996 0.13458221540128065263 0.21925965549208092931 0.38308096881042619231;0.87010191988530727336 -1.1344688426288009886 0.83088422997431365946 -0.10098784495003629291 2.9675253094912923402 0.73869270391257091379 0.66538352344960494111 -2.6876878256570768677 -0.58255920661591298337;0.008731842406359227593 0.1750009831615875755 -0.14322509624720136667 0.3198537454059835472 -0.32102321103254610746 1.3741246970892744272 -0.54811688623667687015 1.9785268893819090152 2.0065763276529637871;1.2279574856447015296 2.1152151554861351457 0.89076769230649377462 -1.4521907318484730265 1.6421783692008440347 -3.4165348642888635489 -3.0253405876745369518 1.3792091809957107706 3.9840074067102317912;0.71740479779684585004 -1.1746377095795934586 2.8500801324783080481 0.47276651898743837776 1.7948097775493425665 6.3753036707816672646 3.7133300099700781161 3.1109825698607007638 -1.3894887957471964146;0.14661316266550275533 -0.036361523881253098034 -0.38110607994305650825 1.6513655126258079964 -0.38897071149862583184 0.54097807012632981305 -0.29512477093690597796 1.6578760652773136819 0.47428631628806450227;0.84579874460607995523 0.099799876065501530453 -0.53788738659815338305 0.055151137497642492569 0.63448295294816514645 -0.95531942177508366587 -2.1530299058377408983 1.5085706082783945092 -1.1940802941584309771;0.41551526672398153561 -0.011893084166771076063 0.18970466190562706998 0.31753467055187967194 -0.03363381526033128871 -0.23482896310377412985 -0.367531550797086215 1.362083929041526531 -1.0936874536040048778;-1.3581145576699813482 0.90171976596393366155 0.91878493313966891343 -0.23019958837436188537 0.95476330925992569654 0.24040212248805470363 -0.15847920387867206471 0.47759254928488797942 1.7577646631036070168;-0.1680242525821122046 -0.35666214684308999994 -1.987114892200208871 0.73980470428259181848 6.0100771538088535451 0.75260512923901390359 2.182472093322646689 1.3054750436267594793 -0.92766461244677189679;0.57323784200250604837 0.28768325779568043599 -0.3252756850150536061 -0.16700405857060884873 1.1386386716217800075 -0.053283684076366931437 -0.94408147856376334328 -0.50506898392044541346 -0.32174036504354208699;1.8638088519982056734 2.4894934012830876036 -2.2637462787893603 0.31643489522607626263 -0.096521431491285336612 -2.9979781710753679036 -1.2976341390101602258 0.63401065998068117935 -0.80116541045371314489;-3.2340609905962325321 2.3596561736178518487 1.4260022690138296486 2.735267622162154133 -0.73859896959305726405 1.9277985527419536638 -0.84844926293656108829 1.7285368855050742276 -4.4131356525138611957;0.15605498349036320271 0.075790115760499029984 -0.31746670651626002213 0.96382033952116252795 8.285580779570015153 -0.82168557589317603451 1.3460968785133042847 0.70371736406392881857 -0.26257372285648211685];

% Layer 2
b2 = [-1.3586094346245691789;-2.0126744933729336928;5.2718311787370897292;3.9085693027516650311;-0.81361683241191762317;5.9920384920186142708;-2.0146199224613634549;3.7982893757084248421;3.3718905960580038972;4.8214199047279899801];
LW2_1 = [-2.6556734263641765814 0.032088598398283152413 0.055139494473859670953 -0.8279086170228768804 0.38367306846524057429 -0.58770100860837393153 -2.2754878606296431443 -0.30320326389230817243 -0.48382230792589214774 -3.3603072126378008555 1.1448421224069575963 3.3609580663105975695 0.54066624433962895413 -0.11858732071187123858 0.46525637730626179245 -0.46117618572314067471 -0.13128811975796869649 -0.11366114265726151578 -0.64619031892820177898 0.056419803809858948274 -0.41377867164493226104 -1.0064990867440157807 1.6349733851556633724 -3.44090172180507059 0.0035111787180132502002 0.074053552511628817356 -2.2526330630137221256 0.18461077656544414016 -0.081671404664970720377 -1.3525868906059506092;1.8203762245351253757 1.1217492624194207451 -0.10535731154728633641 -2.3550268438507777624 -1.7601582002202791344 0.56019486942501961479 0.58946391728220537409 -0.59330409629481850597 0.86308842059203161323 2.5423263599275518487 0.37275746811164678363 2.2018740631395772311 -0.23408792919134466248 -0.9221915018615332027 -0.12078678673926145082 -1.5244522960791211386 -1.5135280074973596065 -0.61219756344586817587 0.69205451459936850878 -0.21441415307521424771 -0.54067081579034925731 -0.23799539577883552233 -1.7583548830245789851 3.6813540063679761616 -1.649636067498371661 0.48479686593440479703 -0.33187691022997350965 0.86583458193604545539 0.87558123803058562906 -1.1427278956305650937;-1.1124344453391528109 0.81630045043968835206 -0.0036020010051532264442 1.4255611622433861374 2.167933307790366193 -0.18129348078653709231 -0.65272318993050859603 3.9826796792659999724 -1.9402221726091188891 3.0093229894902568944 0.50041138243378402439 0.024295007738000605479 -0.18366678428964283709 0.4491851692318762912 0.13430595108262574633 0.89020177638809550036 1.8612276190304031243 0.22999451612995280847 1.1003137418666337766 0.64541726028686141614 -2.4963604151017082522 -1.4959740819880573692 -0.48855453208575483348 0.56761172654681057992 0.53190593925190066127 -1.5564464798280150948 2.4327514889094570272 0.0096687793888183791446 0.86129934085182502379 -0.64998683240316856846;-4.457228914928525576 0.47085255785964558184 -0.22837363088852580262 2.7938630578242111824 6.8901224377072116667 -0.72971631583924900788 -3.597115999508359252 1.1189071950126181498 3.5381284095115463906 3.7139183233307542231 4.9255235101199241754 0.64259099692701537876 1.5081158777226466583 0.64878314188557106856 1.9090821694010962073 1.1327567196451506781 0.33551978483389027774 -0.48154061791401997494 -0.79131003556390167031 -0.39938984643677694075 -0.62188121928964890106 5.3380706671142181818 -0.92245022520273167732 2.7188185752652098692 -0.20142675668515586107 -1.3213458155057928867 1.5019091512254174603 0.81468949567356419017 -1.5698550956174541771 -1.1307407683346253346;-1.9995776899810928651 1.0305346607144292292 0.12252986388557832176 3.5384290898363035538 5.8642793757754922979 0.5049421351757594767 2.5820907037302345266 0.16427608373270494169 -1.0227836457589281061 3.8059461905109537305 -0.77120860295143800478 -3.934247910658447811 -0.12025353803788203788 0.052685237438256239673 -1.1313568090779726472 -0.45732589128442130422 0.22934833626690750985 0.90190112574992442607 0.95673096733706131101 0.25653007074225775419 0.62510875235666918392 -1.0417262023358420109 -2.4205020220896016347 4.1486805549550824779 -0.55062611772299274726 0.10627315702004921927 1.0832462381721219558 -0.1682572200680305663 0.32785371434899712728 -0.94723708555258101516;0.2266773883776254106 -0.38411988257717838424 -0.039671117620531957948 0.43425698116880834254 -0.40826889181610620527 -0.17067996957147402171 0.064969500574920360791 -0.23212158264399410101 -0.28155181616054475446 2.5899087926642456736 1.0679121771101984795 1.5678671856819315078 -0.53561163549570556253 -0.082899764523663294069 -0.26152762415209696023 -0.20243054895444628771 -0.34649376969498751899 0.12710008977229383942 -0.4926193514828722253 -0.46493306609957046893 0.14562558674673012349 1.0163796177461326131 0.11200200397366655292 -0.74885206721207009384 -0.46922259372013158663 0.53590145745514194964 0.036284640367076508027 -0.041207829477094538861 0.7800961042156318026 0.088478615880790409398;-3.1625405584689985083 0.51232335815104934618 0.45121401380883002785 -2.3826617116706310107 -3.0655557293001662877 -0.76667216023726358909 -2.4801030849656013899 0.67568266935407128582 0.59213402052915886653 -3.9030628978865955503 1.8112160662478322681 0.87942488730741796843 0.60924664050162480322 0.73657115150190433095 0.94226310482633324206 1.1741594949421385596 2.0614896727360827455 -0.12945975362297845734 -1.0861723960636247011 0.82389539595573979547 -1.1414859143437949829 -1.5082105354880217529 1.3367864859703417757 -0.47505532033335479136 1.6479556104911290415 0.3124759253786655866 0.27855016783172587003 -1.1974266179337147431 0.69556947005441249754 -0.92974490232715001348;-0.91161738762308963668 -0.76717247398062771158 0.089556078368970712389 -0.36672302598941092233 0.722130131919265561 0.15703541845029453383 0.48662459807240965315 0.072538294224380017727 0.89046231971194111932 1.9696712717373539014 -0.073184230789655330129 0.44263760579323369049 -0.24995128420279574821 0.010574789225538481358 -0.1507654916641692211 0.58257497548553538458 -1.0320532891478224613 0.022381360462595634858 0.82414436737814633638 0.78683401727043211782 0.68140614101132923608 0.32925589413061334687 -1.4173743356414261196 1.1095673169061548435 -0.22938074467013649937 0.40633415598003652658 2.4683705862660354491 0.24502138717974311644 0.74072220835873736622 -0.41108457249302499115;-1.506407910379290005 -0.99018728319199145194 0.099874108003142794687 0.12468391557780227064 1.4804122353108810639 0.10119662453459080109 0.25477813590366443774 0.18031140650776580903 0.77648746192958917334 2.2967544239077946067 -0.30307288960755907059 0.19572707389905469322 -0.25193493253041648883 0.016909351082161322433 -0.27984620440566759791 0.72168234314528278972 -1.1273127578140467175 0.054247109167082453729 0.83951820251006892271 0.79946750630915452973 0.8671137841895436571 0.18370622481163473294 -1.304053416020067635 0.72039295869954134144 -0.26032065791453162795 0.43733483385926685827 2.5046040273279128741 0.15664018259020720536 -0.3960454266148875635 -0.60038317384911710217;-0.36787203391341161129 0.27611419543553938905 0.00066718747393579443897 0.86151201448688008444 0.3507165711649888884 -0.28086389693977159565 0.48834814709710433478 0.094076922772390020322 0.32342402155594007773 2.2546642089679052035 0.44007256736302724498 0.32163040830820210925 0.039946669254638342283 0.063728126533127441022 -0.088607423024029990932 0.33870078021925897893 -0.18592833671406783225 0.030608195807162074525 -0.41044452011049764595 -0.68203952901808018172 0.0590664232769945452 0.59466457790894611257 0.52877367934889241141 -0.76113257305826642618 0.042788396594770933268 0.031570627877610266121 -0.068475702797571216807 -0.073486207903946137998 -0.068184948984901766478 0.017082873317115231798];

% Layer 3
b3 = -1.018123786508326134;
LW3_2 = [-0.42561334673889938962 -0.19100378996267883269 -0.42252313410442526864 1.5715400584473719903 -0.23347734043516890634 0.29178453880364957351 0.061771848309548620104 -2.1602371615538809024 1.9628782759399932001 -1.128457468671898889];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
