function [Y,Xf,Af] = ESPER_nitrate_4_Other_4(X,~,~)
%ESPER_NITRATE_4_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_4_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.4906171197884241497;-1.0839543678042344865;0.060416108694647779886;1.0253684418014592516;0.85442888256295590477;-1.7569727947567348458;-3.9254216405621131791;-1.8589191774407336499;1.1423209452371074768;-0.68505983367907041792;0.056017453442573014732;0.026983065539858727688;0.33619203105762796024;-0.32259042758594846934;0.172745273397122312;2.2421522988887407912;-6.9262347378984907564;0.14893543447395704571;4.4823808800460147594;3.7491600266676230468;0.3598992391495419163;0.48881410550226356282;5.7479751552587172725;-2.5676492175307128463;-1.8881238661629948794;1.6306614153205440942;-0.68083338528347348007;-0.80729986338957715475;0.77666587704185841012;-0.53241292509628856955];
IW1_1 = [0.21042571701201087664 0.24240965832074995445 -0.13768899946137899692 -0.052871979752291999033 -3.523862438199908631 1.8014582279243085416 -0.34690438616182289744;-0.14142534320676250492 0.58494584097658364197 -1.471626759529786721 0.36579221763194996742 2.3785201976891401365 -0.38498858778757466537 -0.25186983961902026374;0.62404840499456704084 0.67704383421188740755 2.2677235733274234697 -0.24355592059632361068 -0.63955061544618252434 -0.44253920299916960079 -1.1744095850606413034;-0.0070004410864259554101 -0.53096999084036733407 -0.59780739247179526252 -0.32124549939680391297 -1.2775244367726437122 0.53328961913523476035 1.2332484610081906329;0.069589427312165427764 0.17748992695174245493 0.046129399055418518483 -0.20719218997712243735 -0.29571868945694262942 1.0441506256794172991 -0.69676838523477047094;-0.14196551568981713443 0.35848258145368405714 -2.5893835894214696225 -0.34404291966324346275 3.1510899932657459033 -3.6470567986862572063 0.90860879085420420687;1.8395053987667477902 -1.6602501957788666775 -2.6647985289947242471 -0.049756334319280226541 7.282768690197081618 0.45835788200916394164 1.7050354786867603085;0.21784583890030281839 -0.048992787048474310818 -0.25385475271474061687 0.14652298549914752335 -0.55712342183048635391 -2.0696629598875668776 0.10626619090403177648;0.38189813718051612845 0.25482629132648704218 1.9423668858477918242 -0.047915116726581406803 -0.79630995340509669322 1.0640746522129873597 -1.1172929062248737608;0.16921023181115060763 1.4020526755628965887 1.6332571316475645862 -0.69359518890028426519 -8.7945524350976302941 -0.54942935639962831029 -1.3446075020314587345;0.12849039610885357177 0.15959298495469451118 -0.45458888995865071037 0.12801654692907954436 -0.56734063557784986109 0.39881309224732275354 1.0157363322885868406;0.36510721220779274176 0.50231611316818014501 0.69505077633654654967 0.10060754418976483593 -0.86451930621646799757 -0.048501858495340333111 -0.39104065423045780703;-0.049879640353840848377 -0.0010612222469299054627 0.78062977036549763277 0.02300318147605620242 -0.43023567453668304372 0.31462325823501685607 -0.38729513095200407413;-0.041572413430252815048 0.072127253739521668408 0.39241360122780699626 0.37336167194055347451 -4.9047222677781503464 -0.22369301065910113246 -0.90578238814051525996;-0.39137086796303566238 0.22533571820057085588 0.70129662769559264479 0.15694847713605428186 -1.2807623070799625253 0.53683098810854057437 0.17807452915756574741;0.056448056711723267054 0.60531484318564787728 0.73389085307089019228 -0.40326437482900612252 5.6100817100045681229 2.0379700669696720894 -0.72944759823388460873;-2.438778167690829779 2.0967401489057166941 1.2427870728524805788 -0.73695333327922474265 0.77753518543923572093 -3.4669059768882388717 -3.7888097071439106323;0.25703911242221300082 -0.60400959675661969328 -1.1379023868343483006 -0.45188767415494174307 -3.4942848162930668643 -0.64174316044354307031 1.6717505295522430142;-0.7091330644901887581 -3.3890367272001222787 0.2133105530316565801 -0.41543004805784061739 -12.3400310014095691 2.6391858329139621375 2.0772711822019709338;-0.10701534693903300144 0.47608836507223933898 -5.9931559731302712635 0.86125490171722984822 1.7275548861459042449 1.3944770845294496286 0.87336072715469992289;0.80235396877567022322 0.72515506541505903026 -0.17338574477181234457 0.45166614965834578355 -0.68952661442165397165 -0.54282685929191298868 -1.1068415808423319735;0.14259133792112518857 0.15513613324817374095 -1.4848854904057526838 -0.04302779191276845383 0.57135072012209908721 1.3256138387224363218 0.78268417493724096179;0.035308361495946002928 0.183024917131253545 -0.10942774439569009914 1.4361915878839559557 -0.77640189974112505666 -0.88924839945799671881 3.8201096280308428632;-0.038944701140309040399 1.0392932607725737792 1.7824133080169086707 -0.67026310996925120289 0.84655623802568802372 -1.9949686115814466714 0.55654612180723073145;-2.6163672899305763231 -0.59099076806376471538 0.60898749301084131869 -0.13834857528617908184 -0.06274402939734252671 1.1972088169588090967 1.2945812811804184861;0.0099236292239247483188 -0.10597279754995464485 -0.42553430228848437844 -0.36245005534618285337 -10.147154860173444035 3.2660226417444975233 -0.12165348798355496429;0.27696464113001179053 0.36947875649620165461 -0.24626793247590791913 0.135376114927489688 -0.35513492714631084146 -0.34976903888022037314 0.33655208754197568632;0.15619264173624142211 -0.071030968274006164864 -1.0745156602349874575 -0.032492170011755402981 -1.0088330326314562946 -0.87173983309001579212 0.27168313772800822825;0.15199858042480485221 -0.94116883029986397879 -1.6115528792530207092 0.49521052915549296225 -2.0996780933011240933 -0.26014211613877613605 -0.8076784866402373364;0.37694672157700548354 -0.71675767024487091472 1.2649300439545627661 -0.93073288064125714314 1.6286154176737799304 1.1821442362045455621 0.63725967647287251605];

% Layer 2
b2 = [-10.821000867557573955;-8.2176066116824539876;0.29015392427893971217;-1.4383850491859582199;6.1625111995995061065;-4.6091497040899636062;11.25195436174349517;11.617976172972042548;2.1192764197575684193;8.4512902088460375438];
LW2_1 = [-4.9691527531953774144 -8.2236155999751670009 3.9970545355137128141 5.4997374593151562294 11.936020400598058799 -0.29798376184293190461 -13.092205417113301991 12.554685791975861875 -2.2337680414903728909 -0.87366319804574343877 10.43373097519073589 7.7204871816571429832 2.4753871963082048069 -1.1254878430293764335 9.4538348822895788004 -1.3386922293135106177 -0.59858211972106623033 -4.0176445507943618907 -2.7112973672523792423 0.11855006859411770792 3.228918727274309397 8.8865512509245512263 -2.6251543455797117232 4.2887641305087988997 0.45316240310359057197 -1.2709834395096049064 -19.137838936345222152 3.6915104219867282964 7.6240461394935277184 4.4983096223715710593;8.9275762221850349931 -6.0203383192415325098 3.5772460769683580573 8.4778605131014721508 -15.718264497477173691 1.064448766453502726 1.0640106208251713937 -9.3218534898931046939 -3.9452496043733873421 0.92262161383971497131 -26.775425433430278588 -3.7859906518011952059 -0.56878017472303110669 0.22221146829659771393 2.1248679293148087233 -0.21573522737948963579 0.080882530653086523453 -2.1620465525546217478 -0.75555201559114792964 -0.081491628257604295515 1.3990886748301938347 2.6661882094457904913 1.7808950697770578042 -5.9423666058094157805 -0.55895427055387580939 -2.4308151879496682213 27.010110900809369383 0.34313985970539062631 -4.4442273065901760631 0.49259345949547944654;-3.8369627505203318663 2.4038992152315521444 -1.7475854340128209596 0.60126970033289661721 8.5840871557116820156 -0.60487914736966319484 -0.98602478147175964818 2.712399078402712771 -0.32165410995912518954 -0.17672792493848005213 11.146126691818242449 7.8182684231466623714 -3.3276734322996301962 0.20120301051055411445 -2.9145279596191810967 0.30764812082976883412 -0.65370544690893572781 -1.2726595247531651278 0.163248595835696092 0.69081306179052426319 -1.1119731850165508469 -5.056403368302568424 -5.7824703133729409288 1.6312443318736422615 0.66503925172896238838 0.59963266766553702247 -14.916415633434974453 1.4858511059357621953 1.2527077928530887529 -1.7422559468583929121;-5.3901803900180889073 0.77992598366635190743 4.0623757739289096946 2.0571570338825333479 6.3259732872145262306 1.5938206752797179355 0.64116471090127857835 1.967657775818351773 -1.8017312859350131937 -1.9013810421198431566 2.030514211918910128 -3.3343622959066845368 1.0710511694400466354 5.6644019985148377216 -7.4178313370266115712 1.5107804444310628522 1.3965597251434760384 0.61726062412157467474 -0.54099812232764399322 0.0786286592139873175 -2.0645715945876825792 3.5327267101553001538 0.93634901126451153264 1.114233358645291716 -1.9136347620577698336 -1.8175168789677313974 0.19011890167547690345 -6.4745600493341495252 -0.94725058855763411003 0.29065979668630720356;-2.6180877023208979359 -3.4087682161262926606 2.2242573646733281301 -3.4010658466495145014 8.213582104531544914 1.2480037564528871918 0.66266605176774107111 0.43997770091469506903 -2.4923528048883158981 0.49001289639710815527 2.5497595756779953824 -6.8303637911100576474 0.69797543418221552614 3.8332364458896202031 -1.5463671854372609271 -1.7718749725712166221 0.45387079435029464847 2.284550579973858575 0.074497015121449433606 -0.68180264459355988116 0.86657540139298139259 5.3296481447576180557 -2.233537266279744582 -0.38978643329439072174 0.21135104418805994442 -1.9337790380066750551 6.1254969138402435291 -8.5222171635724528471 -0.030899110264813907378 0.91163257718353651882;4.2677038644862177463 -4.2776731293333289941 -1.6584197160098725909 -4.3233446232747825277 -0.59429171245610701302 -0.98490244508198765416 -0.42332394244623255952 -2.5559431424800362898 2.0848016228895072111 1.3506735288184639199 -3.9651071379828222163 1.4364123265532438012 -38.930085192751555212 4.5292332734455564847 0.72985697708518815219 -1.5827088111947444915 0.12691959871695140949 3.442069054687130869 -0.43951031326263467758 -1.4240697080252640028 -0.94919768837575790865 -1.4363402005298311348 4.3941708199306734883 -0.53574686220367584433 -0.12206656777286253868 -1.975416844065254196 -0.60518155849546340086 -15.071457294472541122 -0.21713715503496008874 1.8668926556870166777;-0.76026501406617053025 -4.5866331185308979457 0.52375070999372097535 -10.966096023940178128 12.187199171353791272 2.4087070464115636348 -1.3368157021178135313 1.9468816131067139263 0.092954274547242699001 0.57162171349718216007 4.0169533396076451126 -3.0413205286690483398 -38.843744306868536853 5.8772179349788213898 -5.9576360421534237943 -3.4820587323120770762 -0.75138426525809065559 2.6657193396532488094 1.4831498070304840464 -5.0716421723365519014 -1.5464932641960329462 -3.4383631140226920131 -10.482672055586101933 -2.9570666745185798518 0.86836394490796897649 -0.69388531351022231242 -2.6433756118084135167 -21.905269690481460998 -2.6557943420208367513 -0.33739126325852908383;-11.489063114183867498 8.3530782483295986651 -3.5447172014908265858 1.3458472341114766646 5.1343613929610496527 1.4218190109183512781 2.7615180774765648586 1.5072530761871749672 1.867351077049313135 0.19142971067421954423 3.6546053224792478531 -7.5071660985854311576 10.335392518932161821 5.7816291724566513111 -10.477411117357798176 0.40328469279562334515 -0.38205677158400669358 -3.1000539794192429888 2.8995414466493278915 -0.052301242672858933025 -2.023754057356471403 0.79334049937147277376 6.8192020075850194871 0.39256256733561195604 0.14051521246991321989 4.1734213713567998028 14.768705861328800921 -9.289371560077482215 -4.3624111931848563728 1.4406315499515796041;-1.4332675799744369893 -1.777882381366671094 -3.9647638871879280487 -1.671718205032503235 -0.21086919085662364504 -0.58926915674514845911 -2.0295802992565543654 2.5390513528400386889 5.8009367637329392053 1.3114448945925483159 -9.3643408746940455245 3.0253765161766548175 -17.016723930078555327 -0.70664150615891174745 7.6758895915141103217 -2.0983230063612481331 0.035687881710142130287 2.3737621596212266084 -0.31602808873333193551 -1.1545029625975458121 -0.92809878844771742656 3.6832845985349558227 0.35343350004908258288 -0.043896769278743287546 -1.264871777787285323 -0.94046163249335235079 2.0028849770172238998 -5.0727805163165777813 1.4740327244600890388 2.551150560032625414;3.9116301149172141294 -3.1399781201697591904 -2.3653816947401153925 -3.255529596940222703 -10.752806385029042957 2.1292777923712957744 -0.45277891710536793957 -6.5464057603592005208 4.8033794197610504284 1.8592689779343545275 -10.711307920513265302 -2.8051620326703079478 -10.205116825229120892 -2.8741457638064460411 4.7131019502863598092 -2.0254308847407647143 -0.18912490129841777464 2.5886824037363509454 0.11926841073371513557 -1.6876362166328748859 3.7193778317592567362 2.4706470483581863817 -10.032929341185097272 -4.893155204273548442 1.3504636704337351638 1.900691631251489877 9.7475102494097090045 -6.6930626955403997869 -0.31086662959426247799 -1.857532628842528899];

% Layer 3
b3 = 0.39240596645055808578;
LW3_2 = [-0.051827410880672747373 0.15336554244086897381 -0.32036992174207068462 -0.11831278036707115753 -0.39088587108350625332 0.2226862222354245302 -0.066664659025541639359 0.046141141088809671522 -0.20360179471769368487 -0.16902617506473982534];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
