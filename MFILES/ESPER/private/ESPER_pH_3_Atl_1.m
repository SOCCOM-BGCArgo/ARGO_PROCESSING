function [Y,Xf,Af] = ESPER_pH_3_Atl_1(X,~,~)
%ESPER_PH_3_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_3_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-101.945317545701;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0054210015363163;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.212658015469928241;2.6866134269005677027;-2.1190458155393390172;-1.7989915647262395559;1.2488329410254981333;2.7961517954436172495;1.9819032654580364117;-1.8197015963122120663;-1.6125017307448454851;0.65964132055903457186;2.6446220252148369134;0.91262600862936527069;2.3027622479720357695;-0.96685348293559014721;-0.53939831446926056469;-0.75048626085684244647;0.50367289962196992725;-0.62580282386235630554;0.049010534246790860013;-0.016192095984262529218;1.1190175138067037786;0.42671820152622680355;0.036236059702497651347;0.18567346384782051905;1.0590254242974914689;0.59758025676435544415;1.4531997585771905257;1.0946688379627926846;0.96316812050428335379;1.4421310209785223044;-1.1048290991542468742;1.2807188740986243936;-1.1250741652133782189;1.3705755673105197712;-1.7811862448169866191;1.5483737416346718963;2.1903682438059139947;-2.7191138925919919878;2.181006650703033678;-2.0560336650314718909];
IW1_1 = [0.9494528859171232904 0.62214664189553514628 -0.34819131228885952245 -0.89206168252479201008 -1.3424959888884255843 -0.76643801822092239018 -0.89147736868739990701 0.20769598910214054355;0.3776940676357923854 0.11463405391508629805 -1.8661026406539231726 -0.2774394513629381831 1.5494735261520886649 1.6641321391842012201 0.22385050564883562929 -0.088547020194127745718;1.1846795668802301282 -0.60548532096892615506 -1.2622443813548274161 0.44992537334556137463 1.068348579227688333 0.06950444227917570994 -0.021315873079379852456 0.35369581606281180752;0.74768745579606543661 -1.2240923735764972502 0.60086536284778258032 -0.51127835559486056738 -0.052291289615496519549 0.86750085903156060052 -1.2723748988693253104 1.0098307150291983003;-0.75802790291990806981 0.3953540217380902555 0.35022294176075430272 -0.56566243929714254968 0.44706516389293476932 0.88805645470224359173 -1.0927701344945153217 -0.33207122828064788989;-0.0038023857990196422568 0.30706111959930465494 -0.34860299222145268994 1.5195379571464693313 1.7592231364961663509 0.29666901397422340558 0.50498131343025876028 1.1799264720132049966;-1.2984998099607740762 -1.5385998206569431179 -1.0203836992571091447 -0.77796206879862117578 0.59619043930327109138 -0.0023682024071507087881 0.55265577391340769964 0.9702352072221236412;0.34421809786056728475 0.59583687235890347988 0.72121219823322690878 -0.5612346204651870174 -0.37390774343361932175 1.5334454829652319763 -0.48412388519069093906 -0.30766666770807282738;0.4925362902414930355 -0.59129661878288974908 0.29350563002997825945 -1.1788757861496315105 -0.38538552886941179754 -0.007249711715566265792 1.5807603134823304813 -0.8603302764329849861;-0.31639120507847512398 -0.4858816323405298343 -0.27805858956782730784 -0.4472914333764687056 -0.41928608973069464438 0.063736970637219031444 1.4760526013321793037 0.29582161106866372569;-0.47604484054600393339 -0.31186321339616818182 -0.36247153322450376134 -0.49142267800721961546 -1.1591188480996503785 1.846086532214897602 0.81485128446949839365 0.52655637414479472547;0.0084944418038457973619 -0.64665142807809916636 0.21757948576272434504 -0.78033607716097053153 -0.44815966630855291752 -1.3419889129784399184 0.4015880732320659674 0.86400217611537655227;-0.1340826317445323046 0.48693939969882454877 -0.47120998248200546277 1.2974925251012456862 -1.4302629528606367604 0.70704270718090145298 -0.3420082493953037206 -0.039212657584153542967;0.13221731818475271347 0.24107696644225928839 0.83695871504527430407 -1.0494415184376735262 0.55167093384464693795 -0.42156734125623401832 0.90062097237090832369 1.069300867061051763;1.9015731199579910538 0.39449143655044816015 -0.6432334737693735649 0.3331654687629413969 -0.98585920410378102829 -0.23822280937971979098 0.24975781176929845451 -0.97094984009855733742;0.54786155325427676743 -0.20870171325788045014 0.36724380310335213995 -1.2058625745346351898 -1.6122482614243365262 1.1900063211085016857 -0.12013609799501930031 0.35008704874750901093;-1.0102127586840317086 0.40150946952196631123 2.3111983927428685348 -0.57649917459877941806 -2.2318394372532379677 -1.0983699219847109507 0.68823419089244675106 1.9501057727269932585;0.77319737995873960568 -0.77190325498473122412 -1.5719469836675719066 0.37651965659257985441 1.860140051864854982 1.0688123873084187654 -0.44959772744689502355 0.061590249283855320883;1.2615726028241722734 -0.40058376217711771927 -0.69956348857254113671 0.297566284543268611 0.72120458535843834369 0.89936806307265304561 -1.7964906429311156 -1.0473333618887175067;0.78252831203057182652 -0.49370884426482880558 -1.2921157617653986627 -0.111247803903719647 0.72249400407226038734 0.95271331779391965622 0.46845950381988299416 -0.86600599751770379608;0.14319947183392020551 -0.69256645477809108957 0.12587278804707166535 1.3197307456528999392 1.100509463476518901 1.2947068698167234491 0.94436354794410592994 -0.72099026030998680792;1.1728817138067182402 -0.4493374264561669218 0.44803634800799474469 0.094750909202964778144 0.66061476293910614821 0.03766845834212220745 2.0315701366682867857 0.78409231925376809968;0.93510822222688017025 0.10113496591357118426 -0.9062514115871370679 0.41920198929398194698 1.2719413029216610767 -0.71267229989545521907 0.25224459769269336196 0.80215606009934625753;0.71703428555203185812 0.64557653591757768741 1.3950353732985794064 0.10697797506301998105 -1.2248190017873770152 0.050435096949349035589 0.27484849639364983265 0.44371578247538145945;-0.19299569093256674357 -0.74002749153011571082 -0.8340923592979773149 -0.83402093608520555534 -0.28663524066106504939 -1.3104144347500079615 1.9929568916265438805 -0.38874156219820826808;0.51682288806963139205 -0.47640579606909772004 1.1556093135795300064 0.44787086672456660752 -0.030170306246530088912 -0.51699085979552106274 1.5865252487554073468 -0.79430275384365633951;0.3729261426885624453 -0.39632994325637960209 -1.3523998723352896878 -0.49133137765972112465 -1.2841310004244499421 0.926840623986908696 0.12587963255104683835 -0.42590442671934758412;1.0778604475873276858 -0.3434248254315018789 -1.2495674541149306425 0.72901613420494071338 -0.52190834230814298067 0.8233032078929316544 -0.77919422174529362479 -1.2416919184166261836;1.0033229277507378363 -0.1947494437693655378 -0.142058211957287156 0.70166813593690335882 -0.76068317085811409939 1.1310133104947661664 1.5302122039528509578 -0.93542286162823440332;0.33206205765676061192 -0.215059688756798012 -0.37563389742289515771 0.63963098307913690554 -1.7992727601400699822 -0.21269112663271366737 -0.59627125131329605789 -0.50360493712736298377;-0.34791170824881723078 0.73411483937158483748 -1.3702647505264318184 -0.28754687825457109218 2.0207815129858017755 0.72615128469865142247 -0.71692676197006466321 -0.18365143634556446717;0.87612345379913048049 -0.78317227724881111062 -1.4609602318186905023 -0.77397753271987212997 -1.359273428480388235 -0.83257363976920217841 0.0015023870457702669101 -0.38162061942726666075;0.17950794176051923512 0.30586559954437408937 0.12705952950338395002 -0.82181023149716814213 -0.16332077543655956764 -1.1519243103444292142 0.77531416776240880129 -0.060732507284073665443;0.66811169318830665453 0.3451847115944566835 1.0857207174697138807 -0.56145545410612274217 0.015074751197986017287 0.0024500689285026997638 0.39305954555388261662 1.2205082152603730083;-1.6940356402245166922 -0.1114550929273771529 0.50997983915122957477 0.37964455174298022966 -1.8023642070222738454 -0.88649083708647014035 -1.1837184582822701806 0.17875454623874545423;1.4112788060479775076 -1.0912713012353212338 0.074989868424779046463 0.59219451635469066986 -0.087035625050272694136 -0.1264681671597693291 1.3267923995479471433 -1.23089067124328011;0.54362858570330807595 0.050376492315794767218 -0.0044872607188140324619 -0.46919970398536214873 -1.3024258494952976051 1.4540296393041827194 -0.65146731997454110363 0.46845145670258009352;-0.28378530378147170943 -0.7439926778278399544 0.10600218997240284935 0.2557789911616052958 -0.010237759900688658127 0.23167281603601164175 -0.93149457017494063926 1.0209952136038555892;0.55271238012374179771 -0.90314658877887610267 0.22466600626865332324 1.2534017123487151135 0.14529933851787801835 0.23550810733421081999 -0.95124744867515942381 -0.93045537003891920502;-0.29392851521257284952 1.1108394811175967831 -0.55919035041174336431 1.2007809463529017791 1.1003498785241643265 -0.46264961866185749795 0.54038520852212312828 0.050154991236443985381];

% Layer 2
b2 = 0.0012364944352162886634;
LW2_1 = [0.67255232095924066815 1.1121627822768278548 0.13405400221678340222 0.24081412313784550383 0.5841896781038903308 -1.2878981025908802227 -0.18834948823554389929 0.80153853378418338238 -0.27659824558479367829 0.62579550197184041771 -0.58735835797821145388 -0.32504017799310919168 -0.78672445732926699069 0.81226464470045389721 0.092673557364977898754 -1.0804414687543661966 -1.0209539277472667873 0.81404630374637820811 0.33001962821676222859 -1.4862607226619863887 0.63940058897789464609 -0.03364705920704541553 -0.39853986508306449288 0.71501648677131079967 0.78228886291827992583 -0.40677474055227519356 1.0652180108248314738 -1.0861816544709756993 0.33851267034610338369 1.1371567448256976185 0.48853720154587110258 -0.33525845744448429242 -0.6503648468214436873 0.62277161648584045128 0.47930089856478075294 -0.47234373709952254261 -1.0509613756365057124 -0.82427485813021084127 0.27962412732944658122 -0.40815232624127806282];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
