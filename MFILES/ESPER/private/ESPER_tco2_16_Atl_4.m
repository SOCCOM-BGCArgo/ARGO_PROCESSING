function [Y,Xf,Af] = ESPER_tco2_16_Atl_4(X,~,~)
%ESPER_TCO2_16_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:04:00.
% 
% [Y] = ESPER_tco2_16_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.8554144924602722;5.7582165960657532;5.2093169248702633;9.0643651960124689;-3.6924738911715722;4.9009475935465598;-0.57417161893647095;6.161454030018926;-5.2584576066958437;6.3017456801540481;1.4209483861745942;1.4130221260567346;-7.2915119089162506;-1.1011405694935292;0.12179328786003429;-1.3103066293322192;-3.9297028921139168;-1.4947691389936755;0.64087713170608474;-1.1391616547012191;1.8155750472837648;-0.26476838017238996;-1.8646469765720235;0.93884474474439683;2.4688547629045101;-5.1992433289314457;4.9186810820412443;-2.5092483021586354;-1.7768286743790915;0.97944624754213916];
IW1_1 = [-0.35355403646382322 1.0538086569573821 5.2192532847917139 0.24349479050945472 -4.1482029023860445;-5.7308191129754462 -2.2630651220821063 1.7373919557601405 4.7180382650698309 1.6270098253119243;-1.6200441713450895 0.18873019681702363 -0.050829673784879008 -1.3712785834693735 -5.1595995575757119;-2.4274148658641543 1.4976285030564187 0.76558289906125676 -1.2893051511897391 -8.6940520033952122;2.1962136279413254 3.3042239264105664 3.862868816043374 -4.621571777446519 -0.68967592392498933;-0.18828599007057178 0.40712209923684706 0.64991995327084706 4.3427698534910668 0.16493782482286193;1.5803372106132938 -0.72597805278368543 1.3075873772938214 -0.98758162858041454 -2.0481669070596356;0.78256192432313454 3.2680176903956428 -2.2729973532399326 0.31489057391904546 -1.4716424115915165;2.3626465170128244 0.44370865999534043 -3.1927015111658013 -1.307051041374955 7.5368880033838659;-0.12131996246319181 -0.90690687487414434 -2.6648462326387046 1.3930565919016307 -6.4619458073746676;0.09544549926317647 1.8859180238362072 0.3612848706144674 4.3036553174295777 0.02406687639752025;-0.32412271363917822 -0.6650845251100721 -4.692109430803165 -1.8747406189295452 2.3141726876947897;-2.0166090162640526 -0.59514705470539209 -9.2469291151529323 0.20345441314163656 6.5831425957778178;0.35727598332962546 1.4862899122184674 -6.0181158437399942 2.7254065289171869 -0.043459523843865339;-2.2628267848371535 0.33846763550019998 0.2922985789560732 -1.5622444525484103 3.0949193945492346;-1.1646550556751398 0.52204084925707239 1.1253220958736723 -0.49593228551539092 -0.38331639682304564;2.3286023412306154 -2.2715636934780594 -1.2958216493014882 -4.9306381637772239 -3.6693049824696877;-0.19809204695570243 0.55915331567013826 -1.3373218059986578 -4.7098009373946113 -3.9328067596901493;1.5943104131261423 -0.20255663736575416 -3.7655657269091969 -0.66212562561034549 -1.2558356315415407;1.8737392617681232 -3.0343955022118236 4.5360584758051905 2.029165731589532 1.3220165201170924;1.0982771443263573 1.7355063095592613 1.3801869175826371 1.2950967303095859 2.8000331083880146;-7.1769251828254115 1.8267987598407203 4.140226067116604 0.85415492468202192 1.8180606658817318;-1.7517915957431067 1.933878194863317 0.79502283221819814 -0.95207110669856487 -0.9585941496670275;0.45613692751871165 -2.6706652774196149 2.2700888353761806 -0.93735563735580063 -6.4129929380945816;1.3702065314127672 1.1884382060105776 0.40258344925138023 -2.2826267454794298 4.1489118488812942;-0.042166432809601827 -0.61700459787972328 6.279626216651784 1.0282828981279548 -0.57577699530383453;0.52832739014499874 1.062316456856818 3.1599918151344299 -0.37049068547843977 -3.2141108952863902;-2.5060476536161387 -0.74684380650373883 -0.65587574991092379 0.19490483630742184 -2.2379190019421586;-2.14390992069143 -1.0842294644959396 2.1501322079145946 -1.9641938535149848 1.3670704889977559;-1.0293667791216023 1.3906719848390614 1.6838532982865042 -1.2195877217570452 3.6011296626748139];

% Layer 2
b2 = [-2.0595046242379631;-1.5624036546730182;-0.23925340897736097;1.4238665933803949;0.44831777322924615;-0.020752945211618037;0.52096644357964694;0.21218555382156809;-1.577325577510247;1.8685621872164491];
LW2_1 = [1.0294436095783652 -0.43115794070915592 -0.10602618928262901 3.0051354641550301 1.8158972357082093 -0.56123306221122737 -1.8354536362723932 1.3026144583607422 -0.57579907260241436 -0.19627692565859736 -0.050845684138130301 1.2023127611461639 0.46762004127554541 0.91921707325524304 -1.3216706380196659 1.2848894883970738 -1.6741290440395009 1.4837118449219435 1.1085858491139231 1.2481771188639377 -0.6559037074822055 -1.7480844033928737 -0.12798908723780936 -0.15039574837249708 -2.5048473771230251 -0.96859535825877696 0.032988429875787088 0.40336696243684617 0.45812231740160742 -0.41673660820902553;-0.051304165029655874 0.021050107187401142 0.3362450079973866 -0.77273774171882315 0.17544580461611128 1.0732471679902089 0.15152909730108069 -0.70170262651543813 -0.061287493801945828 0.44236455972703775 0.008544746267513708 0.68126507992311192 -0.028114991481332886 0.026006236888937596 0.099361945966716977 -0.51407749944058434 0.13528554538195944 -0.080408938135186764 -0.049215575941035677 -0.018841426593319537 -0.58755002232378384 0.019207902863558828 0.68815908595715636 0.3029064544289074 -0.44870839318808514 -0.40618766919315469 0.25645921150853956 -0.42086991366590426 -0.19427078290754302 -0.36237066722607486;2.0366041519001308 0.082716339099279709 1.4144353005648822 -1.7312851871722508 0.54994805828718929 1.5622975195622275 1.8218605902994902 -1.2091948798738565 0.19531102418488472 2.1923933419245825 0.22866684866449319 -2.2066599816711641 -0.19332249695817988 -0.41853512010980687 0.2754830943045779 5.2035693057121577 0.16931056701199529 -3.2707719382424356 -1.5032573427919447 -0.59972979189816156 0.47921108952608543 -0.91018034162024808 -3.0948195879789524 -1.9137287568023564 -1.1001943593589063 -1.3739990049011523 0.23316314856617168 0.44459344454599808 0.89373105557317556 0.68329087461751237;-2.0918480770286725 0.95244835044774312 -1.2377097084644741 2.7245738075496457 -0.76424559700521055 12.726253744648945 0.27750340433195125 -1.8226204193524829 -0.75965626131046304 0.081716931554896122 -2.0165503174979653 -2.9943468255853505 -0.12644590558264404 -0.88181743348394248 -0.2297067221881833 -4.3803650262450864 3.0880193906203122 0.70038087728485687 1.6193830958322013 0.70703314397423478 -3.1783324730366553 2.0776852434771134 3.3721454716307657 -0.78022003985744015 1.0077272114761107 3.0932121920769804 -4.0328370087273884 -2.2883006249785955 -3.0635781252947782 0.0524947606212725;0.12155151010626757 -0.014522539334621727 -0.39101330444500343 0.83705196021225392 -0.21787958349054923 -1.0889677722407058 -0.083898004176737886 1.1139575571119402 -0.069459190063524634 -0.59920237312852498 -0.010653538482229804 -0.63349473539393575 0.10685070307181295 0.015710447172900169 -0.15341044035063756 0.8603199861841353 -0.21939299977237833 0.33231407363568349 0.18865607357548914 0.060582645116467014 0.59968829352632724 0.024526454678361051 -0.86538148157597528 -0.20899543944333146 -0.88937001602628429 0.30949322754062003 -0.4177013887209311 -1.5511077937987736 0.10673860259451952 0.57754415389881208;-0.93880285254847795 0.31189582405751309 2.119919291117577 0.65680343572840105 0.017565458758286027 -2.0252974945795543 -0.40004695766332976 2.0932960921746386 -0.3855598566118173 0.0683227396246361 -0.37217762795417331 1.8860683576946378 0.17727102615105494 0.34691849968226063 -2.6819401641844047 -1.8643360984769417 0.092527004885877909 1.529468569294782 -0.21724842916753426 0.71755343210986466 0.070870416665638356 0.28814368918433608 1.3031346180770524 -0.21122033980015589 -0.19645004504033489 1.7068253746967523 -0.38019867726679552 1.0539866072713857 -0.60454503796678583 0.046473502864713544;0.26563562720982048 -0.43327643034607605 -6.1668502970682946 1.9494325886881878 0.0013910614269574285 1.8643403101653968 0.88567623495986403 -2.3721633390291768 0.21967268272340074 -1.2787409071674667 0.063443900875421386 0.65310266531619987 0.87107634492534103 -0.27796879381079631 3.8436383277688155 1.5481644628925852 -0.13901533427282003 1.7384524876532272 -0.0077953071869895077 1.2403565136487413 -1.2919926058828319 -0.25173232632465592 1.3312722779763944 -1.6753337698401036 -0.42128240222563124 0.11215097606884561 4.2438304572616961 -0.10456663692819898 0.96707671635905157 2.2819002081265727;-2.768765227075328 0.78388013734718598 2.5476368779221548 1.3746307087024829 -0.84445684654557174 13.666347714720619 0.76276805544096615 -3.1942145663038199 -0.8588230270015268 -0.47838233615131204 -0.68140759564287534 -2.5154482977758272 0.67581835057717676 0.11609436288837023 -1.5942173441209502 -2.9838372658735675 2.3894111455815286 -1.1615528681711538 1.7323757466265035 0.99111169595424953 -2.8492625602838837 1.5462088530703915 2.3487193540099174 -1.0379956604752476 -0.17006138377881092 0.78093376054735797 -4.3860041167060508 -1.8597946535807344 -3.38616201513452 1.1029099006229173;0.43434175352664062 -0.87791929138774405 -1.1740662068583392 2.6390056823285444 0.98269646149812051 -4.5269837764099616 -2.3751361251645062 -2.8796088204740764 -0.21661858738397677 -0.17733915324671656 -1.6389597691205695 0.075257509282286236 -1.3544542839701637 -1.6732884423888434 2.1618310582720484 -1.3528992074042623 0.29845827367376693 1.3266536420437125 -1.7611682009901186 1.5983985454022536 -1.0266897358995417 -1.223935931485016 2.693822129390242 -0.15247915032257131 0.33524034613583714 -1.524675861766442 -0.99447990327531111 1.4451984631473853 -0.76187805782117879 -0.9381654947607323;-0.18394032225019072 -0.030130436041869581 0.18539255125733548 -0.064806757806065846 -0.24879079262269355 1.0636047675568681 0.63451106574807525 2.0296612250851016 -0.55140671681385001 -0.74627548309881819 0.13224243004254899 -0.72944592642507555 0.30245498423753497 -0.050340220695672198 -0.21039559703362173 2.3849298952465876 -0.39480649709738663 0.25449951563558781 0.42280598604272424 -0.27815795755212636 -0.26494996773598101 -0.123377426311991 1.9549770930086154 -0.27834504905411211 0.065831211066748108 -0.24019775037964278 -0.25624681276866462 -0.94612359146259251 0.021989697695701173 -0.10693059012554942];

% Layer 3
b3 = -1.9266076099239515;
LW3_2 = [1.5228895657783501 -3.7515093705944165 -0.10809292849823214 -0.15276111358953093 -2.032663138063358 0.15000992213423103 0.090764770202137718 0.13505714962114823 -2.3584975722627495 0.25871977561880932];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
