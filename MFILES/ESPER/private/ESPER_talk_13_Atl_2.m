function [Y,Xf,Af] = ESPER_talk_13_Atl_2(X,~,~)
%ESPER_TALK_13_ATL_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:50.
% 
% [Y] = ESPER_talk_13_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-0.2178;-143.241523403244];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0479365703301392;0.00458552991639557];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.2382111778704052;-3.4419841024371967;-0.37200968730132555;0.48839361548675786;0.66171980887224979;0.67764055491117214;0.27164955641195943;3.1326077772227383;-2.4335326909020081;0.82632411929498539;-0.62179371851250087;0.35141594040852592;0.26079050370275347;2.5365042487701621;4.3701985487540567;1.6978243312311219;-0.26973538180898687;-4.1910682387282794;-2.2599710879206891;-3.3778502808617343];
IW1_1 = [-0.91841946562767729 0.98538651513916742 0.38914919379666701 0.48426425159483222 -0.95356004466670996 1.4206514220997095 0.30205895097217006;1.8869363577139548 -2.8250466028436145 1.3902334954137658 -0.36982099661346385 4.2689204587548462 0.39305214619096368 0.77928334635858687;0.04632185901931312 -0.21156036074792284 -0.76078065470023293 -0.5459652552240104 1.8994560804175711 -0.60764343246622921 0.80199958917605463;0.22784926320775559 1.2607654752847759 0.47613723798490304 -0.089590444867422195 -0.93009613342877295 -0.73121167126286546 -0.047096926107200607;-0.076426650353567063 -0.37419474758119958 0.18558394481402621 -0.063797813046322538 0.14908471873434709 -0.015857833039761075 0.13130434507411209;-0.17821278485440958 -0.1240530863465121 0.56161667193201004 -0.2084512187766337 -0.48634420061523465 0.1517423530780144 0.01059776133167048;-0.011593899789645841 -0.057123777519431401 0.20574052622732347 -0.1058181360062859 -1.01402750318076 -0.036374734256197305 0.024918967438428037;-0.46522638253059612 -0.5646748607816634 -0.29653862082437987 -0.54879239271742741 -4.0028918704134853 -1.3868210313389611 0.63785655919997475;1.5834774633630442 0.33509199623266106 0.42620334440088381 0.5890922094571166 0.37900534790755697 -0.022969874845872228 0.33739424786130406;-0.21037440217293474 -0.51340119922142191 1.1688779736932997 -0.063860421109333196 -2.5905313490053068 0.51707476719648326 0.50813923294425312;-0.15656517859175156 -0.2947061856510354 -0.39713730460801588 -0.35562154255949019 0.45186513418023766 -0.86075943636026286 0.21530868544834192;-0.88709082260398076 -0.40388132512924607 0.56262024513386388 0.36592274859835994 -2.4650325935766566 -0.23974547823623044 -0.92969990318755158;-0.069186019333362131 1.1563430654727347 -0.58855443964031806 0.27339664504660882 -0.38670139171062123 0.21740199204162444 -0.19972883511731343;0.86200218710065812 -3.4273340408297051 0.18669155384691058 1.1722545299175742 -0.97977994842230265 1.0657026227937889 0.39384084814714193;-3.3382560448294925 5.0213888594664162 2.8095725246805907 -1.8789756555703441 10.184117892362305 -0.93142848188368321 -3.180651837545529;0.11861929327523596 0.68414002728697854 -1.8943131145151992 0.73554411722157864 0.68773578522562406 -2.6115213954497829 -0.71492591276265549;-0.79570273947928438 0.098715765322461249 0.19441627174274204 0.76800071174524065 -0.43520460119656035 0.53718141349778314 -1.0218981144239458;0.86089836193620872 0.35109658102307095 0.4771862305250319 0.24245067949422289 4.0782714407882619 1.0809114661474812 -0.67991929000207796;0.15358270502636187 -0.47999410191281344 -0.70404644863090293 0.21565840231089903 1.180547060253228 -0.26266768868558704 0.46363172073067133;1.7914195894383713 -1.1629624669938916 -2.2493670862123767 1.2568895752452247 -1.407530168634298 -2.5876466682373249 -0.49924479093848234];

% Layer 2
b2 = [-3.3007611044808729;6.9131538288243233;-8.3409685060286964;2.2818183178863065;-13.94640906003043;-0.40018247799358991;5.2151653185976077;5.0957677171044971;-1.3495673967401327;-5.1598396638273512;-19.724298176665641;-3.7880695778692361;-12.26029780307935;-0.020211447595758963;-4.9623163646418318;1.7582042007057279;5.0240204015121765;-10.694563082671751;-8.8107391413914549;-20.019324841181085];
LW2_1 = [-1.5259110730882985 0.58490301842099868 0.4504669269227729 -0.40580721335264852 -1.8312813247095254 -1.3842634672403094 0.88560617009409948 -1.3590656967550745 0.026367082141453627 0.15556435481192873 0.70001892294575052 1.003832116405226 1.0855745771160443 0.72110752420910473 -2.0856978633580678 -1.2921025060399642 1.5546780527207502 1.7615317962542749 1.1245859388978166 2.1022281263524922;1.2208708425381825 -3.4608111998281119 -0.6627648809888198 3.0181270035174306 -7.0676303187580727 0.59835546684257013 1.589968406473556 0.82291036776456539 -2.6030347652568731 -0.30282109406379615 0.079543830025936624 -1.9539998207197424 -2.9334250336063117 2.5669733822707683 0.42172997168869075 -2.1527834453860826 0.13737699259124173 1.1445935775429594 2.8514351286786463 3.5312154521248891;1.5427728680222406 0.20154754675724423 -2.5060987886513018 0.61740208906543192 11.24956800964401 -0.28023850871489503 -5.2255822646404813 0.011207271133463823 0.090413676250519923 -1.2265938107796648 -0.1146055419018879 0.057435541964393919 1.4437428220351103 -2.2892040243618244 -1.83001332777911 -0.70767512932569898 -4.7160312423927291 1.4528391942950836 -0.25773806805907962 0.61319696349611075;-3.7821914280153051 2.7953968559042131 -3.5468433653235909 1.7461921795457482 3.882347131956287 7.8896780012574208 -2.187779296799377 -0.046812289235572617 -4.5226601582179269 1.3063803515809984 0.30821087351938181 -2.2005451154872464 10.965204414572286 -2.2386047748742874 -4.6757745622749249 1.7764118347735613 -5.9618597227668841 1.8939825449262095 7.5287871744583867 1.6174923222365285;0.090272036685152379 2.3037080761656368 4.7336578079204372 0.13378162466192012 17.152825837149049 -3.4806196398491434 -11.26968607410303 0.78265227259795456 1.1033397555045277 2.5513067157963998 0.17583845410400797 -1.5729367025126686 1.3932468449725546 -3.9290257844605074 -4.0798585170201704 1.876172303943745 2.1358347701500642 2.531927554629537 -4.7439428485874027 0.036262313604892155;-0.99003142095110785 -0.79854765473737155 0.18365946694653709 -4.5350652980455326 -2.6902586245834286 -1.9584511466582193 -0.21156877082960021 -2.2088690102177901 -4.5857207803738262 1.0063811065200876 -3.8247080268874996 1.8983266184570009 -2.559980654393383 1.622581239978822 0.91639940280324461 2.4942735229298161 -1.075215629358246 -1.8153420682899093 -2.2583018905224086 0.76849204697497242;0.35239783608185082 -0.96748298236429009 0.53011025962857983 0.1708168069462849 -8.3532846337140114 -0.16061917280456534 -1.7436437821413822 -1.5073392936949153 -0.17961925963990541 2.3136312754909554 4.9077999578426024 0.38374694345893973 -1.2799969924093215 -1.2466525653574108 0.3093849238062687 -0.060217252041476786 -0.50725133702913139 -1.6184626393305808 1.6777498610907788 -0.93283551517567043;-0.27969692477009955 0.38805172724273984 1.9862779121890706 -0.9115115296842341 -25.735238127158173 3.1089762507535856 2.7756648529959738 2.3489098531147881 2.5617924000039518 -2.4699118414151058 -1.856824293274344 -0.76950554375061042 -4.4572047567235922 -1.9876187399434007 6.7303040585724387 -0.27461231255713026 -2.7059229626575969 0.68991491265243876 -0.072783572094855087 -0.50902441429837952;-0.068241755471704038 0.20627739953885754 0.8335848131628939 -0.22465566656638311 1.5493021956206481 1.1633202180422233 3.6131568251146877 -0.090220247631141587 0.46877184686129691 -0.75857861171035257 -0.57899093720225592 0.087351505939313762 0.45699352181625941 -0.28514508555677176 0.70403315361637042 0.50833204053900538 0.081581935835123603 0.032506663099555001 1.3992353352349334 0.46885481279143365;-12.086056098314767 8.7205165057940679 6.8847814554241635 4.2727628836931943 -3.2235781745344281 1.6545280940341991 -36.698600571930378 -6.0452710872310433 1.279540453803002 -7.6026604885856628 -9.0150349763360698 7.8586403352307919 -6.843310539421549 -12.330689198631289 6.3927278127513389 -0.037064470402767974 7.3674523499123836 0.12970348522414832 1.0545263730696648 4.4626272030768517;-2.8623559327581138 -0.25620419785552079 -1.2052386765104175 0.41795326694954205 21.812076169922594 1.273627694762306 -6.2389396409649747 3.9838919631477316 -5.241071067913925 2.6568263994343622 0.11691369922836906 3.8403797389389185 10.375572334321109 1.1316018283997669 1.5180886599465584 -1.1068198443543367 -6.9390526829214902 1.3833862508783705 4.3275460608929377 -0.52127154150339683;-7.32917215742581 -3.7000783546648854 0.2125162913348686 -1.3047780761607424 -4.5954798756505317 16.468311314556548 -0.54435345250622647 -4.393849004721627 -4.5185304375129789 -3.710168594595987 -6.3688201573510117 -5.1350544967081602 6.0283771918704634 -2.2588865097436774 -1.4469350562852863 1.4388899989702884 -10.66221028025714 -7.550584989451405 2.4392944658767521 3.3250200914663774;0.1907314988893504 -2.8921422310980933 0.94076815614213727 4.300801422698906 11.548168169090269 -0.90147854873253985 -2.6468195930214544 -1.7119635883515929 -2.6149829743479502 -1.1645052939707894 -0.53021934496185585 2.3238692707168318 2.1069808036951501 1.8310618669239174 -0.70967235596484202 -1.864574891941295 -3.8201117682454888 -0.80438055697726574 0.20558916829368265 1.1287520776382471;-0.097823976887804392 -1.893702000286037 0.84532878879798401 -7.2557548257234785 5.1610139966522128 -5.057267112867696 23.45322397808615 -4.7640452545136256 2.502128703045905 -16.167320999394555 6.6231284334065466 9.0052837957770588 5.065056399405762 0.3879955914179668 1.6875526053415528 -5.8106580564883386 -5.678183219226665 -14.717137447648303 2.3906588668122333 -4.974427391245638;0.79266974658677114 -0.38099229194283341 -2.6942483970585647 0.19688063844184589 13.082159809012603 -6.3571726484876656 -1.3840116065446866 1.4601388761553613 -1.3929065429360443 0.69498560993439729 1.6692840224962 -1.5251537533699868 1.4194547571265195 0.53581983355610774 -3.0764011450852737 -0.71501699793645968 1.4776337526238505 2.5311961175895346 -5.0188803520562937 -0.66470905444373096;-1.8119200973914302 0.21611802037771713 -7.6353694751766632 -4.3677559042702336 12.347547753540159 7.1558743435528989 9.8361605388386248 6.7138177075040835 -1.7232643686383355 -1.0678243059568047 -9.0038926368198222 2.9913480146151974 5.1374071586272505 3.5905093155677337 -1.9543902688375074 2.0378832004128244 -1.3880590938746209 3.1518048641847227 5.9815945865883799 3.8395974737541745;2.0819369805125016 2.8681010854552853 -3.6198266160203612 -0.19035769284060111 -7.1215566669491768 -5.2938632333079489 0.68009492318548814 3.0998020787004839 -0.24014217016919451 1.0299968637941643 -0.73474625309808383 0.64822536402695652 -0.54806151689012073 -0.93941745047759606 -0.073380569294926784 0.24161826533957204 0.48130802257583233 -3.188530380042264 -1.8610380483708699 -1.023580436927455;2.4719386334233788 2.0047667984834332 -0.13463572789526546 -0.14501938958586039 37.056511766800092 -0.73451414675088111 -8.8380445661636333 -7.2530984351081269 12.587324274465891 -11.432170555087652 1.9210354373220362 5.617996912944248 2.3283152976603452 -3.4095969728062183 -10.167140945274321 0.84757157552274209 2.1683437489941793 0.03671957020668002 -16.638378831524715 10.082500778718904;2.7836251311084328 -1.0949699725912974 -0.2864760857841408 -0.28126809124893953 -2.8621731974793225 15.702151858339315 0.10254452670976588 1.3017762856873358 -4.6058261542882537 -1.3295852219128019 1.2141543750204025 1.2411841276282849 -1.6943258240545809 2.185485948334871 -0.56665511981611238 -5.2061212666249377 -0.62945601196502943 0.42747342124097726 7.3505847723421471 1.400422283338203;1.8167765915141061 -0.33283451169111905 -2.4099108036562593 3.4995780445426878 14.922810590139351 0.95969867307989776 -1.9416652687927825 6.1528073244635024 -0.51653989863100191 -1.495781454541133 -4.8712108928128828 1.0809469636834677 0.52880356146667995 1.2663221052733873 -0.8203118030459875 0.5130516947604572 -7.3223453505615268 -1.0699997147988813 -1.1766213298598502 2.782078256424966];

% Layer 3
b3 = 0.082712049860804798;
LW3_2 = [0.051879402194875676 -0.015002784998091809 -0.077611498518807179 0.015298101429017295 0.052321751217844353 -0.089708192721260238 0.039702579524195716 -0.026232086497067597 -0.68314981800955676 -0.0044031433210660774 -0.032178100046676074 0.0062208547247937333 -0.026328365391419972 -0.003787742903805446 -0.16799550343919006 0.0075930924870436381 -0.090125669704293462 0.0037352132623051744 0.00010760562752960563 -0.030998792412949654];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
