function [Y,Xf,Af] = ESPER_talk_3_Other_4(X,~,~)
%ESPER_TALK_3_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:45.
% 
% [Y] = ESPER_talk_3_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751;-133.803853032615;-0.1386];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0584431850247228;0.00432440760873659;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.627395730437021;2.5205034058456022;-0.53685176526406408;1.3156675122493868;2.2564194983249819;0.027809638501439145;0.79242823553449004;-1.2466476033193887;-1.2822413621599649;-1.0021114447610191;-2.9026259950225155;2.8944853882142283;1.5563252350538181;-0.54687252618116333;-0.025322099340364401;-0.31933241190940259;-2.9271162314489709;0.58705317006150604;-1.2596757497083657;0.23824924886612597;2.5363613731643109;1.4895332880825456;2.2918915602458125;-3.9988333802507472;-1.0319596754622946;1.5739450172172709;0.12358178436678136;-0.094946909816654587;-1.7993138367727664;1.7172543099843685];
IW1_1 = [0.065128007427715282 0.44555428486593479 -0.77722100723078524 -0.26169150116108431 -1.5142180979446249 -0.72884191275599852 0.83131588921102817 -0.53983326791145625;-0.19787175714260891 -0.08511149911098119 2.0249684251509845 0.34578285577213025 1.0620453327486781 1.7918957978671533 3.2850860810911358 1.0021588845847407;-0.020951823761935696 0.13887062702681183 -0.40222832548327392 0.2219966964664295 -0.79250849331800532 -0.59881079010476757 0.085690611914999285 0.2115165905654241;-1.1323970919997619 0.65472375916651793 0.10969591640764377 0.10218017202692127 0.93387934252534621 0.2263943774852509 0.13472221206480212 0.68204934277196627;0.62494627062131258 -0.19498594990889603 0.038954239593999192 -0.16779578435701842 -2.2361601129922972 0.24035166542701633 -0.99990518390863825 0.13975123950995977;-0.56979383699274544 -1.0247345984844594 1.3353569666461462 0.9439112098207082 3.696013347670994 -0.69040695795100293 -0.92274776510580259 0.42045236348504972;-0.2681738501171021 -0.094383180380442244 -0.87584957666770524 -0.15924976493327411 1.337995624515407 0.22528338559021047 -0.13319389740338505 0.44777470643679074;-0.2403420831002237 0.70939385530685006 1.0039480794143105 0.83496471558062324 2.8770617313445208 -1.2560021572663624 0.041724372963794533 -0.033250577492661464;1.6787918969248594 -1.0564420013769054 1.177467330580777 -0.43087294988756297 0.18990449640266871 -0.97748564929603043 -0.56769367901705303 0.023160598007005498;0.042066038816039826 0.10935243116002309 -1.7832620572357176 -0.32434533952606609 -1.5069533673753541 -0.80331935781328723 -2.6392715390414168 0.11779085140873538;-0.52224966116954108 0.45918447459606987 -0.69358057786928706 0.5574426408682992 4.8818966345230104 -2.7520003263594397 0.25136550401864682 -1.0471104875631352;-0.35452867810037725 -0.084185268846289157 2.3584650326166994 1.3739243033739887 1.3237209299701294 -1.6297635597381066 0.44745563414069101 1.6087935369175821;-0.60582419588046266 0.38401683795549391 -0.19791002860732873 -0.64187045466483605 1.4316262872583141 2.6328342354570444 3.8905333667476936 -1.7673454223286005;-0.31548260669520323 -0.21554619892269825 0.017345267539486009 0.13248182152775237 -0.011930341714144288 -0.093713715060811137 -0.22118898563800138 0.48940178939511891;1.320825121173933 -0.34314337836741704 2.0047292940264834 -2.2154513677685785 0.74037874032005646 -1.9713428194501081 -0.95227509704442537 0.054376906127197075;-1.0058485001879773 2.602438758163713 -2.8681939923043158 -1.1816615379546647 1.7976276481514886 0.7243477631560441 0.42038100717633675 -0.37205631233804914;-0.051765863754454286 -0.44416704437883653 0.55270540949131319 0.22025370923707963 1.8732771602553488 -1.7687655183749147 -0.037538351916302011 0.36779903305316086;0.27881293160984094 0.052192897901609268 0.38805576220921512 -0.54668051591364664 -1.307046414366158 0.16220902221065658 0.34636495060368899 -0.0033835062007737228;1.6390334080063267 -0.69351396180748559 2.4058119037412098 0.22860113216477462 -1.302364549297464 -3.1914074808140462 0.28175309688344546 -1.1629224807323875;0.42922838908391547 -0.67004686378863521 2.4881877277822952 0.83529313888149848 -1.6494889291981998 -0.38985147435553313 -1.0102039869131931 1.2558214244899022;-0.28807584119098389 -0.020576977438678565 0.53165854353038133 0.11170259406278768 -0.52496607201891465 0.62036596989964332 0.27199162964657925 1.5171121518782196;0.4215679011825707 2.1789062161891835 0.4109263804925628 0.84035925354054364 -0.26476150970005174 1.6478771414211875 1.2642768788657515 1.1372535774559169;-2.7340827587392802 -0.96285592798280317 -1.6314760624610156 -0.76278336332116292 3.947241003478823 -0.033082645508040694 -0.65407447096765703 -0.41030280978417061;-0.30138548725781827 -0.96313661805543083 1.4120004634458967 -3.4534976422750217 -0.57851382043227451 2.9537545252338804 -0.36574024016136708 0.850106954494803;-0.11611531471513362 0.040572188451590281 -0.30463002392949379 0.43519192058254713 1.1029570134086895 -0.60404032248110306 -0.24176207032104016 -0.39696459813999241;-0.70395683249294427 0.17953546017542649 -1.1519175832792581 1.1606878701879373 -1.259919732833862 1.2363129675744411 0.15603631374458982 0.33308486524116765;-0.066519540789062082 -0.21871020447214795 0.21235148907549375 -0.21074158437904777 2.7585114418024048 0.4466586559298284 -0.15900182263477994 -1.0411553849755797;-0.44690736435967099 0.65320569294384589 0.13933651794978516 0.37894894044529848 -0.96162741657783235 0.84309007497859023 0.29279510589497609 2.1625634325168788;-0.091509035468202493 -0.74853173418240626 1.7474024351670494 -3.04181755288303 0.88241466074683494 2.3131917042482093 -2.055258225212826 3.3246363128848011;0.348584306464709 -0.90420446147051814 -1.3491128487185271 -0.053733065310394415 -3.7261356886266972 0.72684426592173745 1.0899252109979243 -2.1890080120558193];

% Layer 2
b2 = [2.140694826368486;-1.2982787980494384;-2.9328491801820018;0.52520029454297523;-7.979378463001825;-1.7491828030396102;-17.022072196189416;7.4256299971154265;-22.376068265359041;-18.224765052848682];
LW2_1 = [5.6389554331383174 1.0354667912286324 9.8760057201461873 -7.2768062153186071 5.1066548227714952 0.76355026239253054 3.748758618157944 1.2517674579014777 2.0441813159591344 -0.54985207998881624 -0.83849568616896419 -13.152074533215339 -2.4534757916751131 -9.7076136589730293 -0.78459683039793415 -0.37704700388474699 -5.1320193491684289 -8.4779319877102317 -1.5142330105131212 2.7181319588196993 4.1030411718757138 0.15728543465160169 2.4920351892803456 -4.5143292244629434 -14.559078127823213 0.47557326747330025 10.127452897229677 6.7217372699435876 2.3315191440150396 3.1633539366704224;1.3178347039255962 0.47286940867965371 -3.0861408172235101 0.16829801921437545 0.763892766055706 -0.12008163048832028 0.78273103721982729 0.36813412248003707 0.40513496687164879 0.46187453003858953 -0.12366476001263235 0.030605858738816022 -0.3398617620103726 3.8222813079227635 -0.040482107509372325 0.096130300523856169 -3.4723741717539109 1.6439190760933935 0.33311230572638861 0.20297673591320381 0.87551547478468006 0.15989574913427498 -0.088375818423876443 0.6273418972464877 3.0310052560463356 0.38595399124344193 -0.58241078186285833 -0.39918686966480887 -0.53503069565159478 -0.29957201560830388;-0.96219872342288126 -0.41388335418182554 -1.4659597733614773 -0.34006550608411101 0.49354798867459321 0.1413321226381733 -0.26765073969681191 -0.43151854588559874 -0.26605268710779806 0.24619305794840546 0.39934321692549424 0.50145066631766244 0.79555759292575479 -4.7662751564136512 0.064794981898557286 -0.41930855075278267 3.0599810322619794 -1.6932035163577714 -0.21984427701220433 -0.27417761491411219 -0.4363747188908555 -0.25016243321793075 2.1719369952391565 0.60145327029306628 -2.8059521046095153 0.34987614450792942 -1.7914733835872467 2.3584410475204494 -0.49716794460564212 1.6819309234327475;0.40074736976003356 1.6545479217321799 1.1008063296071733 10.977478374992476 -0.74029854201191025 -3.5326483329210463 1.6328402959716477 5.9492463330325167 6.1333287091412645 2.1587303935618705 0.95496399947519539 -0.67027651421296763 -0.93523462805775504 -14.065888392217866 4.5364464538110205 -1.4313960643133548 -2.78148829155709 -14.848000474064365 0.095537300217869242 0.90319761294573053 -1.1496791391093923 -1.8627704408744212 -2.5472682207233914 -1.3147906865869727 -7.1846801291502489 2.6152204404800963 1.2186188234796351 10.766251580571103 0.94276446490382138 6.4997946620729081;-5.5506177558711345 4.8175463446498323 1.8801026161105263 -5.5024810601763336 1.8810430412889962 -1.1256672867877691 -7.3334059945709642 6.5369192892675247 -3.6168256043491178 6.0453819669068709 8.922204334204455 -7.2854901961101568 0.21873827674114812 5.2988573514849975 1.4802726028906887 -1.4851756882264533 5.5641197752059393 1.4241719676696085 -0.062407882705061923 -0.83162370834909238 1.6958496196077779 -3.5532435147270447 3.1117285774992767 -11.120780466628135 -10.140623068755895 -2.2230858442868646 -8.2104014245167622 -1.7311154774251523 1.8825167105461049 6.6269775277227181;0.63683688037130026 0.23507872794850082 -1.0678773471221399 0.47099740463480233 0.68645040479205877 -0.15857245977983458 1.623276635304727 0.44712634780359561 0.48061709663010993 0.19129728290656808 0.008030895769514438 0.22008904370957033 -0.1931908823866833 1.3358438799829997 0.11998512834979809 -0.020097969945018761 -2.5954910628294683 -1.4999449556118802 0.29372794666549673 0.3743519956589616 -0.11729740106675302 0.099378931362562858 -0.43491431678281572 0.69071411328485943 -1.0304562789532579 0.14562952086067843 -0.079567290572181912 0.40932969276184894 -0.57343897014389589 0.19265809987947355;-0.31569066216129044 -0.42764724166471102 1.7110024360452392 2.9784808870340695 3.1757909081383024 1.6557767215234804 -1.6484490173452067 0.22502003065686785 0.70832799753732811 0.27654765087449601 1.4676106543931013 1.4933162943719773 1.9230535700364908 -1.0316848209881109 -0.75984285562611309 0.05383638101343341 -6.6405652866904017 2.044811264476373 0.9196008271965298 2.6721564309878749 -1.2959641379303792 0.124314663895106 3.7172737713725788 0.23612396538136476 -6.316702606264962 2.2146376229839762 0.1369586749834493 -0.86972883907326526 -0.87291887581948291 -0.77268212231404698;-3.3223707294919969 0.31640933923253028 4.9768796246523896 13.460218596591528 -18.928882887966072 -0.12856231906890389 -8.1538762706335639 0.75309766697286817 2.5125126727805891 5.1988448197796595 -5.4150275979973026 -3.5873370096768684 -0.79648758206100112 2.1694671827848135 2.8786899319663903 -2.8693995756937376 -9.060874941610118 -7.9310109993603435 -1.8289879647516651 -3.6298458346555789 3.4617698831198229 -2.9004959837243036 0.390248329034874 5.4644988653225042 -1.6929127016277059 -11.137868949267258 2.4340488554461599 3.4131238991632395 -8.2030295322125362 -3.178321612060079;6.0469731299483396 -1.2872458607434738 -10.158692974387661 13.636486877378751 4.9728131445234078 4.5601420539230517 -4.1897928989692845 -1.3808144175396693 4.4197628472257593 -0.020262841027940307 0.63517003951851636 2.5964629498710368 -0.91253308441266312 -2.2606160630350085 8.379858901071616 0.57153077883719905 10.408232421824103 17.47404869548695 0.18386428689245282 -0.3226274077583835 -4.9834305672852794 1.7440663616562215 -1.0808799062268359 -1.9522294660016788 6.5633264943355902 5.8102432796344088 -5.7129757373213383 -10.26112576225648 1.436949603464186 -1.882126880565949;-3.8233946270621706 2.6846256437360845 5.6526493441824206 1.0006450695796962 10.414829983424873 1.4954164113291506 -23.633247111369538 11.861383668287473 -6.6123645115053451 -0.78251101682401403 -2.7043352085222532 2.1666937403469628 -1.8451541551444217 5.1275607976246897 1.0487279298945023 6.6605433815262183 -0.3133486234182965 -3.2666385800158553 -6.3200174097394335 9.4202382740657225 9.4633372836579852 -1.038489030423273 -4.550780860079465 2.3061524105662921 1.4785015436247142 -4.6438606992053311 -0.10393741325423878 -5.5972099058325151 -0.94295551629057461 -3.5442156759394692];

% Layer 3
b3 = 0.2146487177428911;
LW3_2 = [-0.035324698401699252 -0.79502607947446535 -0.17144694731461282 0.055334960586312917 -0.016420447902710023 0.7720626417242954 0.052288732934217347 0.0066900953785432038 0.053185175514394868 0.0066164291701906203];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
