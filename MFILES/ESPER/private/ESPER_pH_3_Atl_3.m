function [Y,Xf,Af] = ESPER_pH_3_Atl_3(X,~,~)
%ESPER_PH_3_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_3_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-101.945317545701;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0054210015363163;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.0173489522865324375;2.6793116540564088091;1.7886218875095849512;1.464550836049434146;-1.3379677943114769434;1.1121829699178487072;1.2131127791651907799;-0.6257678885722823825;0.98245165795308520007;-0.77614777486581087995;-0.19763418227430307184;0.40417534093462870182;0.068861761612745917005;-0.18976021328777506469;0.49893022057281249948;0.69284810293303544793;-0.75270129932569651565;0.8978915871285952921;1.1323377545763408936;-1.1156458403900033627;-1.3773008888514082226;-1.7404536383437581026;1.7254051773647882673;1.941037946099704925;-2.1022980010696321607];
IW1_1 = [-0.59858853660544852904 1.2792343815844346988 0.56331485689237437153 -0.28481390503173215079 1.0237145783343397643 -1.0448261864272765376 -0.16712854155961109903 -0.23773569299364766261;-0.98399203432751325415 -0.42205268898414477485 -0.85870139441760051646 1.1037454221069160631 1.226281501967569465 0.55124885024014491641 0.45720780224432649996 0.036031981202622284655;-1.0512073410523743444 -1.2692411135895020902 1.112165850053949967 -0.29673325776949538435 0.43426563668339818181 -0.73701445599917803086 0.67652546786910805476 -0.085264574703476675444;-0.49510524056320120989 0.17248265427441419884 0.4948769156738140329 0.17501435988420105394 1.3437316533448386835 0.14192651632628305869 -0.70537988069862433971 0.77363158709844270788;0.17993517865965957814 -0.49613257109534208977 0.4719197224189258244 -0.51119676580050754655 0.14091903148809686863 -1.114915509392812254 -1.2329517549914252861 -0.83164553203857516372;-0.36768859916965701551 0.62320911418756208544 0.12524078665661816934 0.92394895518075326191 -1.4578439395017430691 0.35729034270241388782 0.82464152700969262089 0.085359635182581855561;-0.090248689751827079752 -0.3018801287244937126 0.50617852961364540043 0.68819509429126912714 -1.1665474915811733236 -0.83376780161992980478 -0.33575577295650804732 0.91108703262973989023;0.8741974131688838856 0.91929044833331219344 -0.55946164104209894496 0.48226596836273405433 0.061314472610647235973 -0.866845936108032733 -0.45009070671887180248 -0.75741321839709330188;-0.37201440065469937313 0.013621835317338248234 -1.5270642303377890414 -0.59621689148907075495 0.36927843945011429305 1.1824961577345463049 -0.97734805549977910033 -0.91724593428448397692;0.79585525132910883706 -0.39215378487378838024 0.57708450363928132099 0.90177860884976812628 0.18295945867654822559 -1.2489452661256243982 -0.85074880463588109514 0.51918010577494877467;0.93992286259208457366 0.25705999870341117441 0.82169024404496326941 0.61589480146623343249 0.16827555103521504853 0.11810228626810313768 -0.79706005896436948888 0.87739359923531778929;-1.0698747828884263011 0.29493111296145502198 0.38027632323701549 0.8007169713641603126 -0.24835657715700390491 0.48691236887718358783 1.1950569832799877723 -0.60381164381846352818;0.36740794082752969985 0.51336785631513326411 -0.80907765761386007952 -0.45073031349632397546 -1.1198576437327962818 0.51416904341144742396 0.51594500910822116424 -1.293929632352328829;-0.89642130535218234044 -0.2031637151433071109 -0.42842650511443741701 0.11453527060163753992 1.356337644242713969 -0.61854831500028284452 0.99028684674183320436 -0.66777693077140265476;0.43743295760853867504 -0.67936002020415464653 -0.69447447355233760113 -0.97944566418021083987 0.075298284901606962749 -1.4201599577178671829 0.80627286567674760764 0.56240889923867454225;-0.4826493752204948362 -1.0819131938127022341 -0.49866704076124257483 -0.84515369594804601316 -0.19161010866787925311 -0.79663637423426014728 -0.45917739243110894387 0.62954758602891824903;-0.65933472967573236723 0.49517097870189241693 0.6783864251639563081 0.45839792966701703447 0.70214960516929647572 0.46076414413143229609 -0.35491712853817986018 1.3574061683819831359;0.98042590640076976438 0.30674409722470769024 0.58610699256875509189 -0.77251651987071456862 0.96254181285599937912 -0.30755001395782693985 0.58056997537961885225 -0.89986114424856056271;0.056582418066122713851 0.39083174464469350173 -0.80711691266683727175 0.16991656138326977077 0.93439655900813489708 -0.36011536059062992932 0.67213202383960368724 1.0105430001009312324;-0.83012686186337647509 0.38239505075865298789 1.2429332193884232716 -0.030284388411491031112 -0.58504523642047512322 -0.90027896565376885896 -0.66854991268688135353 -0.40677488662369515326;-0.82149889504617212843 -0.49197693277572279724 0.25194495556997492658 0.54497237016480548633 -1.3205198659825541085 -0.53423712603510320474 1.0194737132362234888 1.0643529639493869432;-1.0552662645321857493 0.70120255003191223064 -1.247835252272935902 0.37983731328548120398 0.51715375925455742134 0.24182927500426967815 -0.46341393636159794456 -0.31053693064758003395;0.64486353773035920423 -0.7210479818576850386 0.63456757712255562609 -0.88627095658770671527 0.61827919694677546669 -0.47987071248545193347 -0.28820762167647928642 1.2683853673065963452;0.28622209946124599345 -0.31241082453070723179 -0.54597289644242630313 1.2828890512981836469 -0.7864180084143586047 -0.18128684816205287156 -0.56242752634430626113 -1.4836279512387373636;-0.82023028803489472782 -0.70292126128704957022 1.2138516448492702171 -0.17965899240932167724 -1.2186110531637182053 0.41447464447664006393 0.0097982873025856120908 -0.14556538420513231991];

% Layer 2
b2 = [-1.4367812239802042473;1.5557365697288669804;-1.14131507614545602;-0.84136283345284923474;-0.75853336855663666682;0.45900288469255245971;-0.23456658124744717009;-0.0029408708679527465098;0.39795432335752584097;-0.3335450466256925095;-0.685800393042285239;0.77481695505330283602;-1.0219209331543241959;-1.2833045232152320292;1.5126997641715025367];
LW2_1 = [0.2816336406775764023 -0.23345602444616789239 0.40911903193168053239 -0.038849803457386505867 0.19843696981278591274 -0.69737885811740252251 -0.46130559133663845417 0.18403370450160630445 -0.034179451121722097262 -0.85248412661203532004 -0.0090132694148955232877 0.018075757169289483062 -0.73162046372183087151 0.53090954697167980214 0.085950533790797215006 -0.15509508265153482132 0.31620453639259543666 -0.32385053979707700833 0.035042440737879473889 0.080736456752233995426 0.4461516101157044778 0.25628924237202566072 0.68562548681137958084 0.6188108679822756919 0.35646784338249626334;-0.065907428116789873451 -0.063989095020600586516 0.3131709660430282427 0.23561131827663647775 0.044705352551701577068 -0.067922045747475276456 -0.50555915610618795686 0.44444474412040735345 0.34158813835355811284 0.45267227347470168075 0.14031684647180783787 0.052953699467061410289 -0.51075396687565099985 -0.022288189565154607058 -0.65963017707816617996 0.024606204810571886965 0.16932433888467818273 0.2855394779240575942 0.090600955372791433517 0.75770602725427327329 -0.070993502418231574369 0.31935417922392717038 0.28244180242919297852 -0.062122952251645685573 0.1361423377165299764;0.11780521933727533535 -0.69690806734245258625 0.28393466495329428012 0.32537472465717248715 0.54830441545831420935 0.34722596670781075145 0.22518769913772887503 0.1391663176427638815 0.50880972905764343395 -0.28560768825925803016 0.36117191084919664235 -0.23818367975018392424 0.028315266125805607644 0.061930995630119584083 -0.42988814645846434859 0.27697407450180588917 0.088779175710316973746 0.29776071148855220994 -0.14342523375056392965 0.53278252856622243527 0.066474688994072397841 0.21615599279288735812 -0.26576849532630258954 0.38573710962970197969 -0.43369080036893864483;-0.067009980209642092119 -0.77679254250106954949 -0.12538527102553487236 -0.14680008604180747045 0.17973169507616532092 0.042777308315408338335 -0.12864101709131145479 -0.27301116587710005934 -0.66815395116402109821 -0.14500460404410100979 -0.77829376614019007974 -0.79161090992916505193 0.53272200212358322702 0.099963694448704551454 -0.46474357232642432569 0.35340436083225773567 -0.49969815141502399447 -0.2291984928226465934 -1.0140924498750665261 0.91641448045217865914 -0.23810905203967486221 -0.20372706474408941446 0.26473252848765405076 0.33132049522808187936 0.41676376960923644521;0.021147408312452743717 0.4060900334859785521 0.46438011930342137923 -0.47253005721717605825 -0.24337848386068031137 -0.22603641449957118104 0.47474477497495543021 0.62531535063335508262 -0.23542754703800222726 -0.12021223758622662237 -0.058362904139842221307 -0.065023367414138277809 -0.21095783097716774845 0.76490536688763299811 -0.5909426808748046156 -0.1600933020213303748 -0.034214163936204036731 -0.012658514665449652897 -0.13326854699798915127 0.38947421191455228184 -0.1856482597260382672 -0.4550214132556317792 0.46585839991983990505 -0.052973152380705983144 0.12682371577573567367;-0.15669641777838516639 -0.55406283603340167332 -0.60880342473057369457 0.10674825947792458691 0.21219394242110756199 -0.35311234244186301412 0.64013964715190874166 0.13246418811588653308 0.12155105608865508782 -0.4401328680144386829 -0.091300367292678402675 -0.07495940788141479405 0.036072314537834937465 0.74471696004005438763 -0.28084413508642153134 0.4665089584395798461 -0.17468685709817738383 0.20944021066600865266 0.54920176213200233573 -0.52623837865161426919 0.30800588563989528268 -0.025706740594389695942 -0.22871208922270447328 0.42365987194622833911 0.29580340082947992331;0.11720566587689981719 -0.25695627111183250157 -0.074518401413347423734 0.14480143951652854617 0.24707047444003538139 -0.80216740128241681429 -0.29984572581739277197 -0.12433965611922485894 -0.59270577406906699292 0.18028123421218547606 0.35005686903476723737 0.15193407304566755589 0.56467069232935518386 0.5796408777925992073 -0.33933754639465041336 0.42667787806228696379 -0.088700456397819829601 -0.20732808024888982334 -0.26516337363864928012 -0.068147777688099889226 0.49661200616786843609 0.01115832401855612957 -0.42873790144964613047 -0.10606387044694037813 0.1203487949827622;-0.26652067575169968716 -0.027134587160858709975 -0.36036168231263643325 -0.41679826045662110579 0.03570466071858968693 0.22232644206198778902 -0.2223350272570243924 0.60202568049024218766 -0.28554905898618054838 -0.08297131272477560604 0.5951475683712390552 0.34780161783589508273 0.4065559917866731765 -0.048804962156412272367 0.15913463306303940459 -0.57756323312787394286 -0.14452762145696004814 0.42169502228341204653 -0.1226920927711101228 -0.28518524346448737017 -0.025774205443699110124 0.56452427583630726549 -0.60508138793827204172 0.27441854892073447303 -0.34128952731167483403;0.15605658641132241771 -0.87800754395130542473 0.43559603179809208706 0.23486514793893373265 -0.12254448672413613408 -0.51191360150264075823 0.12307164027827507957 -0.1291591317705217401 0.20157094139333886496 -0.44813180856512535577 -0.31412826598615417595 0.25441817282868212091 0.016912633685798813404 0.16284909703295577521 -0.16587511994025314066 0.5613536673341157357 0.055124550725237558835 0.11076116337902086606 -0.20090304579412557318 -0.19466294426376304361 0.26029954369960733862 -0.47138463947086756134 0.045634256075937289221 0.23363063647964071867 -0.29999584151748431848;-0.35923443048862291338 -0.83471396746494852525 0.20011939963892189098 -0.14570076231661066579 0.49376426214562035844 -0.59508579013486218035 0.20529431414208998419 -0.77695131207144663144 -0.8018947166937226978 -0.18382150813741127138 -0.14197557339338465199 -0.30993837283931152671 0.041941518890557173693 0.075678333083874851916 -0.50058580044056910641 -0.42265175212636169055 -0.45422229979014150381 0.52360085122652200162 -0.73971371290616638738 0.27869966408659818669 0.3960206758837919172 0.33036268118332984267 0.085590457473438158464 -0.19668861911938634313 -0.044553030304388174798;-0.24895020388898675412 0.38297561907409066739 0.32804887753493172653 -0.47158244730234388786 -0.36062987329446483109 0.55613579005260194155 -0.12395692628886308129 0.64901830155095929786 0.51465520946625187282 0.038937376764054565381 0.35637134884825166781 -0.14005041604997958693 -0.062131797327508786477 0.12966777299860837713 -0.17128714037402378856 -0.14120383049132201325 -0.07216524102400873053 0.20381839214789210235 0.25839482651937123459 -0.5883558936463534339 -0.43630708982032201382 0.035618892021385142876 0.10225642873940302136 -0.16925270220281243838 -0.42685909736900129463;0.16562450440844378452 -0.14856752302481304739 0.20766227439217310735 -0.4906272047014493265 0.47757606020281412329 -0.14226115336957914637 -0.635274873627156067 0.079943300989674156987 -0.038564972573018871382 -0.83444657132878818917 0.31529504080006015565 0.082234405602457746887 -0.50764392036420913357 0.14678153084121284278 0.31266335198065198231 -0.43419690534087773681 -0.33704839775544742642 -0.010210318666816443553 -0.35201226582868677673 -0.26569119175843913805 0.59868492664554351368 0.14715842860231082012 0.2503569039249715078 -0.69398533471164625119 0.066442470746343212928;0.0074136874223507892925 0.40531658473120601993 0.18407977293193888979 0.26044951462041843193 0.71193326091934239219 0.07473726360226239096 -0.19374185834426518871 -0.45326177433424563734 0.55525029286907534587 -0.10646946998215477131 -0.099769178700569491336 0.29810639650364434416 0.43339380788207959583 0.24511731265193992257 0.37698671149451534745 -0.11847628269795056066 -0.39106139428511327294 0.54331816082345407715 0.2423315179025037347 -0.070783975485431402386 -0.56245057806153497815 -0.038495938485067549006 -0.14653133589751840549 -0.30250606189627499143 -0.36543907996322111398;-0.37498592410433639888 -0.15187046802934703327 -0.24708194666991911692 0.16634093828090840139 -0.113987515827012581 -0.36037251871328296327 -0.04029780788810953529 -0.57749490249080359661 -0.43646321864704373805 -0.45430513887034584819 0.42396016296704891468 0.49883842986466825353 -0.057499502228438227613 -0.11681237273785032016 -0.46419881446434269057 0.22668120044461470552 -0.12559606684109683727 -0.15108711989264334008 -0.2663914591358931272 0.12907131467220592236 -0.39581487455170311085 -0.50749452188583388246 0.40932119943108385973 0.28488017484028760329 -0.35743059869745225088;0.6007539141980933195 -0.50158458899962321542 0.35304338628922898868 -0.68648096608879694003 -0.15271485797105918691 0.097015434181468240826 0.11406236874631940637 -0.31888135116187182883 0.40911502989472159353 -0.40705479061348470715 0.32920127878523175458 0.15569200816890305106 -0.11629484607634879567 0.41390329052822738554 -0.51142416351870190194 0.073330579789729649631 -0.017226123724167458073 -0.2766907284957434987 -0.023743639552059575548 0.56993275332117920851 0.43800485537721750573 0.048624559244120263424 -0.17891503033727698679 0.19999694012922433761 -0.46191762519824053346];

% Layer 3
b3 = 0.21207690425810010737;
LW3_2 = [1.0209329492401766348 0.46103855727961606803 -0.21167959016451531884 0.7364648981380106374 -0.41445523425560959474 -0.94766579226062730434 0.44709241315339021128 0.49620160252790751487 0.84388019037846084824 -1.1384486261017776609 -0.14483384799867876636 -0.7444415812320335224 0.13090451090171104087 -0.27543014145716887553 -0.54636352896404349888];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
