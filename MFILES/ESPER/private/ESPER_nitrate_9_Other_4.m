function [Y,Xf,Af] = ESPER_nitrate_9_Other_4(X,~,~)
%ESPER_NITRATE_9_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:35.
% 
% [Y] = ESPER_nitrate_9_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-0.04979;-138.904784718693;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.568038194888224;0.0042772329208737;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.0950519026904776965;2.454673138726997994;1.8292444795208406827;-1.5218413986187604436;-2.1735732976262829297;4.1973352556561964732;1.6410660819778164488;2.1502602678162467953;-0.32585126543687420453;0.91541124561987097241;3.0844769409217382972;-1.5812383997226711063;-1.166480815803343063;3.0041763634482756551;0.31296373158757373467;2.2421632321338398341;0.99851114696014553473;0.90956890578047433493;-0.95072306202472578462;0.76326792464769954716;-2.951156269236077101;1.1928950662535726668;1.7062032394493396037;3.5933652714882318158;-4.8194287826307862233;7.8381873983153314001;-2.9524291882569446699;-7.1007084627670726817;0.3700551041758096682;-1.7513550849022943012];
IW1_1 = [-1.2239246583575804639 1.2074349109755777576 -5.0935585150250846098 0.76667438923014152863 -1.1330350445010985982 1.1978470057445735897 -1.9948557586145525544 1.1515739642374986929;-0.30801746070752156204 -0.34371259523593683527 -0.51356382607989148337 0.38531263961508632754 -0.20080037978429801648 -0.26840220183632912399 -0.65143805015226996513 1.5268020331877341089;0.3782412711038500297 0.072609207722148363939 -0.2043487481651260762 -0.32573602564463349784 -0.23624705885501159908 1.1580851014431445822 -1.533380032745905952 -0.20639669962058360131;-0.071885498404654857296 -0.3130905176460982986 -0.90405481892089323281 -1.8953010465415589536 6.8701944525980502831 3.8818728388552288244 -1.5761359415564137887 3.272684012290193678;0.64583705523035894736 -0.3509766565334317967 -3.1706329245195159494 0.5830821170903951467 0.5220109422512475561 2.6899533594107025714 -1.3297084235604148539 -1.1632016478801643355;-0.63177265525264203472 0.61490801047202536811 2.5187055319923707941 -0.51661726769803828496 -1.488078183495262552 -1.5984301891883967439 0.46325101860292738909 2.849384199902427639;-0.1780485093301784616 -0.038701218315472608877 0.32632661495669051943 -0.22509680618311012079 0.37546714993017249462 1.8098731349416519176 1.5427151283110733804 -1.1149006468972579853;-0.052675943397813437818 -1.6081314906082977423 -1.2009811583335077145 -0.1645228421656953488 2.4251702761173508094 -0.14870243444505557018 0.52411483689328552948 0.10410849375806005557;0.75639196934042562948 0.044306139034558086887 -0.77832614362530572194 1.548371172118082395 -0.34342151160875156179 1.5969732565433949478 1.0030790975413177435 -0.11979702420301839572;-0.16217220372528109995 0.16708934396313276927 1.7758936678124621622 -0.50026125532920306949 -1.3748329646810122373 0.48901974680815479823 -0.33758905143653245018 0.40449299356799051086;-0.082354321303391611608 -0.22409361966252791531 1.1037324577482821031 2.5103472772672885682 1.2554435944260029512 0.29383853731322895353 2.4085306275957441002 -0.36361285597717168949;-0.15821146392626758703 -0.13524772921534608527 0.87905585581814660312 -0.90791759899235535691 -0.58714518451443264979 0.17704759004190259719 0.45201431788723139826 -0.51543981281192907673;-0.53349846420381341616 0.62119218332044789932 1.361945068654504265 0.43617053931690513702 -1.4089419284298017043 -0.017369394727505017839 0.26715382046567859309 1.4749012766209890213;0.055440024314523078663 0.023370371999286616155 -3.3422116144527906911 2.370591139037188988 7.0160714028832593669 2.2690387768976818528 -1.7522839270741314976 -0.56970370613738896548;-0.23628323051747898709 0.56115508118434964668 -0.033422050077688288117 1.1440478968333320786 -1.2887762408586123097 0.094648238502005779815 0.636960516838926738 0.43807420313496470143;-0.5102579316077714422 0.27694841952201293411 2.8845392219408854118 -0.56559990323379472077 3.3196036853992083593 -1.2765636254102983305 -0.23959636573077044974 0.90382435755319923132;0.90346116668253173554 -0.95432514317390348957 -1.044319312848325465 0.41663949095987129478 -0.11699399121926605527 0.058135681067422770307 -0.14035159766358318301 0.79281057371565311076;0.059617603154224312056 0.14615739109169487153 1.1332731240416458185 -0.3620569109580576983 -2.79230990326521189 0.60632149338144181172 -0.52222926065096653137 0.75778536509287963696;0.50430529074861096817 -0.010582941732138289453 -0.79600568339589428124 -0.015738928205190891307 -0.92458392263295430258 2.2816500815614921827 -0.16830259678404621559 2.3778436061726897499;1.0265535157750089734 -1.119997249584846033 -0.76051083355911153205 0.29970052856462020552 0.22321394203102068454 0.23687936838378700899 -0.041042001036890374266 0.34557482521761073713;-0.38161622176281589924 0.0008652734103014494537 0.89765209732193762537 -1.2440984096769305278 -0.40653852327067108163 -0.00036052235463525025838 -3.2380265355427364504 -0.25577475876931388132;0.93804581144693799377 0.04368627351980453738 -1.688480645122261592 -0.058124466366039732879 2.8506016196522270256 -0.15847459501372679336 0.47604313883475979363 -0.13976871326808076867;0.81749918853400194152 -0.3566616361106789701 -0.38460101151874293013 0.54461562283861364442 0.95068308613301200083 -0.69750714188625895229 -0.072949161335889814439 -1.9149287180162566369;0.29935915242121963198 0.123457823067221098 -0.62499149644729357078 0.18547366464017669974 0.22245515823735434457 -0.41129729352119404062 2.464196631991121933 2.7959347818979574107;0.052977618147968370821 0.2522360961134869628 -0.84115607063885944328 -3.7357525586876865198 0.33580810091321283695 1.8354307872392636725 -1.6203424323726425271 -0.38706462827869653198;0.06175462930038812942 -0.18463161624092261359 0.76703143285619701519 7.2648499801322810043 3.8270647899093925837 1.2161994533970739152 1.1070080555665331445 -1.1871455892413576017;0.096708733251939821285 -0.041462630164425341717 0.79433080643444020641 2.0568528719152947559 1.2284647516246260945 -3.7742354162294753372 0.040011020677079046914 -0.98848094615003168073;0.078416249235649784777 -0.66271986143297034744 0.93835836646444603648 -2.1527044891017128592 1.0424911187364789278 -0.61059070052011210628 1.9518792428529125882 -3.5254261434395135488;-0.074257212149509047028 0.089266504530456064481 1.8187815401446916219 -0.35272337155476607418 -0.16244417048769060896 0.11366035217187249462 4.9275742812595373366 -3.2211478376245956667;0.11345327913874915515 0.012425032480283152575 -0.6402273720350947217 0.36485191713620157561 -2.1158149242698640613 0.80319304470947194829 2.0567935929481269142 0.15335545747720530363];

% Layer 2
b2 = [-1.9847080643873695749;2.7730785262336534736;-2.8691245606304356386;-0.73325360630454872179;-1.1762448051250982139;-3.0212087853661189207;1.7553532374532938576;-1.9922943792527185725;-0.48832714453365994034;1.3424252560919271993];
LW2_1 = [0.53959245457919069455 -1.1336564064571255095 -1.5058929944486629804 -1.542919085053021 0.62456391212439532623 -1.2719966201396395444 -0.35147375519007895139 1.2935545826855092688 -0.30777650635049585981 -1.0970263593147209225 0.80393639346873579932 3.228461451721562625 2.3501324939676577763 0.21644204946924541777 -1.5076758018319813548 1.3496548723952908055 0.73493703388502940044 0.6585765806773598019 2.1558170743687758986 -0.78953875310688292899 -1.6224477536253825161 1.2020248885671749317 1.8635740777797620282 -1.7015584218807764394 -2.214870023050143466 -0.44371407195790041333 0.43966378555726293165 0.68094851354872143467 0.62079181218770640438 0.32732785305102751749;0.048041081388122311435 -2.9063917235051071053 1.0273101729968712181 0.27881169326313176571 0.84912665166032108566 -0.37151498208067745832 -1.5819205952246466751 0.30495629381774702615 0.11135077639926363458 0.14775474475191749391 0.039057888611122811018 -1.1942218728316298382 -0.61341024916013942025 -0.17064539353757482432 0.60071408284534255628 1.4154915000715617701 -0.70951227631035052035 -1.0471854936376707723 0.31636239143333799717 0.6862069828151419193 0.35624005082542020695 -0.32035725402744458234 0.13087119479019015955 -0.2513152179448206458 -0.40387796301729184112 -0.46782795189850590045 -0.24478106421300241391 0.7236908181149811492 0.74668473700497439705 -0.49440920143017835775;0.2557137049305188703 -1.1730508623466562312 -2.6279238973878884522 0.2948326710353100788 -0.32713038921671860892 -0.11052075769990349352 4.8446472455744791219 0.12453025007982292116 0.3522295520632577337 0.5264749462667954738 -0.50763218127736220442 2.2077722302198279358 0.0052549688623514927838 0.2302659041335708423 0.99909688630050708102 -0.63166397023361642304 0.098267027022130234992 -0.58359942204990844505 0.045862173587465734914 0.22274433118728304004 1.2280408737479808767 0.67494298002444341744 0.045239974340147655341 0.94174035448220494438 -0.52055906048606537251 0.55863367272728414736 -1.4989310903188806101 1.3313036258635924103 0.56398944046860777224 -1.3484468700137444142;0.27690347573635876177 0.36315016873292421673 -0.11440074826445136014 0.4577223235234760268 -0.9324752362738786271 0.067547136098660337522 -0.56834551035623004367 0.19513991701485319807 -0.19165220833158680414 -1.1617776848234726561 1.0259425386947964576 0.2949800202020629869 1.4013491149742538511 0.35105000017020121517 0.140684033775304973 -1.0675617078061703236 -0.10989061291926728592 1.492956999237592397 -0.83359495253198612197 -0.20915089927226920841 -0.45827160688821122481 0.60885711924931662509 1.1697791397417278692 -0.45022780338210677264 0.15192011787591608307 -0.12713234319904495595 -1.2633889782700291615 1.1444863786536831896 -0.49627106348532934454 0.38696460467641929926;0.10590654395336360216 -0.24494088437337904751 -1.9805499712299563519 0.28733944724491622402 -1.0760930031651405603 0.65080408381382648386 2.7772160920174724374 -0.5112867057107227664 0.37040509583795888648 -1.7594162953023713136 -0.24397712215446351602 1.2646435253782399855 0.12988636937459319132 1.0354039821094935814 0.84149093815096276394 -0.77964047826505467054 1.5123272000001368731 1.8485813975975831092 -0.46455770055638545557 -0.78256598968182389253 -0.54057541762374095029 -0.45747147373562757622 0.090035252195007173248 0.60073940130557623718 0.31006772271156690657 1.2184077623978759597 -2.4600880430062237458 2.489701429482588324 0.043586085701249881186 0.83206473170969552644;0.27691762771872746596 0.41049735937835352129 0.15791351161883576681 0.447526068372468111 -0.83872230483188026096 0.0036206939236935933163 -0.42808853807401275882 0.21672743297064855916 -0.24036526537779079327 -1.0901860528332114608 1.1226266457891833639 -0.03110509290201762117 1.3833369433427973316 0.29264206003353337993 0.085468880484881395998 -0.93746961414218521469 -0.23754147251262691665 1.4594624142475294271 -0.80674435078974682245 -0.13635169438428912381 -0.65756749307808604055 0.55336245016846652423 1.2029923344794704043 -0.58974276969431760342 0.21449566347756715556 -0.18964382025621520644 -0.5355753509777287924 -1.3935084555805545836 -0.51317013015434198575 0.56392056024045356111;-0.43909296435430683614 -0.77499141293247253426 -0.12322129411439874946 0.33857681700310726658 -0.57420338914680801867 0.75996277912063092685 -2.573377238348985685 0.3393212303163437582 0.82509028355194513615 2.4775334305184548711 -0.27435954569673726144 -1.5075915730924642766 0.40665804320564574725 -0.67075890843068564084 -0.79608903577534018137 -2.0514810994054917259 2.5399871421195854282 -2.3545312898851733507 -2.4907631626406159242 -2.0530212054179419745 -1.6651878286274850449 -0.3672981416857811765 0.31944476297730323155 -2.1312980059174444492 0.033014277331299191065 -0.9710143901217889173 0.5540976097338990991 1.787607232236840149 -0.22806378168978747034 -1.9219135511672231775;-0.64929418753122492003 1.5894825003990111778 0.13950494692798703911 -0.53526969824244363672 -3.0229064254193560579 -0.52727268335131516341 1.1052159415643032503 -1.3181979777349324134 0.14724800492040968081 -0.77346716568100848388 0.39165586554350745319 -2.8178971602044389222 -1.309776304189765872 0.31425840914384767233 -1.849137489295791914 -4.0367757207152461518 -0.49928093567453735169 1.2672757276590334019 -0.1286608566497411954 0.046145599612258350608 -2.2680203823724185419 -1.6039235131645968035 -1.6696623574213884655 -1.0850582373614185983 0.15528337316741938623 0.13959264896627596175 -1.6550423622181074101 -1.9633229218296293084 -1.9694461296257497196 1.9213671715144164942;-0.36285512751561865841 -0.7779898393338413598 3.1246028709910156351 -1.1446089632801093039 -0.57765196685232123031 0.39461741039015857391 -3.7205450951696139583 -0.42134318585825403236 -4.2675476062801926957 3.7263668315399822717 0.31659991007653082162 -1.8871753239316482187 3.6321639744940195094 -0.44641483330386289019 -1.4739893738621274721 -1.8961145443340818861 2.1097245997021083497 -2.9383927290089988382 3.4319600740290860941 -2.0346392625941769339 -2.6200184896667368939 -1.1695953078977647799 4.4934604828005468846 -1.7000410859155770105 -0.49133470847077093113 -0.547856828305965049 -0.64892360416184247107 2.8538076008579293941 0.34571087428990110446 1.4893209104776132801;0.28953050372633198917 -0.29035143721293282804 -2.913651143316231984 0.18372223130919046463 0.66625700318076896966 -0.58148907888238143826 0.90830256123839459015 0.41305229349218780532 0.99518687363358193654 -2.9928209542109978081 0.94077675976395180868 1.1384109895882101871 -0.51470556983567972154 0.4747067954126137912 1.5794078859910747337 1.6848254151140042989 -0.43453246447902887928 2.4646508024964668415 0.81121265060749481179 0.09349429476343568135 1.3435125316457572353 0.85974746542399715921 0.80551231768249254017 0.66086056181065178095 -0.28772633108480144548 0.4812197794346786961 -0.42149652973896628572 -0.40368471947823514334 0.026115836364082035265 -2.0125020764055379097];

% Layer 3
b3 = 2.7651222423475227963;
LW3_2 = [2.4115916768123510927 -0.25771872521450361893 0.62904715177814107818 -2.7337065257885240221 0.18336096702092904986 2.7303735471609784646 -0.2068786297791029849 0.16564774690203559748 -0.16599128637600676917 -0.26840773812280460664];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
