function [Y,Xf,Af] = ESPER_phosphate_3_Other_4(X,~,~)
%ESPER_PHOSPHATE_3_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:27.
% 
% [Y] = ESPER_phosphate_3_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-138.904784718693;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.0042772329208737;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.0295253898831138173;-3.5875073339090777225;-0.55773110500308753501;1.7184285394382501355;2.258468527306186413;-0.55776619681617289892;-0.92334309423295313213;-0.12639154803560548324;-0.2542723966254443746;-3.3655514804845108046;6.971228268157842578;-2.3910037441751414988;-0.1304057824544307409;0.2178008047844191275;-0.82302113478452509909;0.50293141430200383191;0.79050732031431569791;0.70400947792621371146;-0.662817067971118834;0.11421826908048038351;0.5457520848663389712;-2.7190438030467065644;-1.1322365369682267922;-1.1422518573277695708;-1.699267192636924495;-5.7914836817298409599;-2.0851245695786468914;1.2719390961045826671;0.18053930710009696847;-1.6039489991049156181];
IW1_1 = [-0.13952898666383098392 0.30947846910403836729 -0.0035169484300007214372 0.073241468336570275666 0.53793273045998213355 0.17993824292080523586 -0.1881442617610185053 -0.30757664652446087272;1.092767880101966238 0.56555965513591499594 3.2833796746404746436 -0.47660814089332720345 -1.8715338555795786313 -0.5705761301907148475 -0.13171720316504775816 -1.1652184266669691759;0.95332594768580669609 -0.021343891019262782593 0.57226902534898016484 -0.15295018578869878922 3.184683597684888845 0.04731698250958119023 -1.2141613441789436134 0.36870899085240488313;0.21712775612278062409 -0.71713164425722375483 -0.22307584306701017107 -0.90026259077228987238 0.35643659852856701686 -2.0911868060593827856 -3.0679949380207887089 1.0562632462570384906;-0.013573155385447252183 -0.78223884661530507234 -2.6090834924032177966 0.65953689075694832411 0.1231632777236388171 -1.184900762742185254 -0.68147065533079320687 -0.68685176291692018324;0.91796958685956220325 -0.0744641328927318491 0.82411966883971343734 -0.20057800640378989354 3.4274088835660418972 -0.0455304399041670943 -0.99067511743602432173 0.14275333447062654724;2.1227342551152594829 -0.31600175133283531226 -1.1392469228010047022 -1.7875142153560765745 0.60273868573872491083 0.34176997142118098472 -0.25685592250772953937 1.7416165719972322989;3.7006148478562317372 2.4517336664432596294 -3.185845025537811015 -0.39191859609181661783 -0.46899998503433415475 0.77960032629799724813 -0.63162110512359759262 1.9439240468981584531;-0.90007629774358743902 -0.59620154580006945455 5.4343875782455892676 -0.057836196683048311795 0.17326903420621653229 -3.5891076721545775996 0.4623157426768417233 -1.7582797684457083243;-0.6066240899481095683 0.61045364758867692867 -1.6776675969417762513 -1.5619765574573014622 2.958345201816511949 0.63012049763513822143 -2.0251972189171256744 -0.64570432858722115466;-0.76232980441911246672 1.6425424318613417451 -1.1545636594317005841 5.8672125520670288523 2.3800138769597896093 -1.6131454306907810903 1.2677079710115641831 -1.2377489988846019919;-0.025808431843921633697 -0.062915694497293325749 1.1145595888724035838 -0.74891825789782862088 2.0742113478004347016 -2.7698686291108001178 -0.94913248544320971689 -1.5109098363163118162;0.05714909976577143419 -0.022637760028978583249 -0.29172306288505173155 0.58109783783054014261 1.5174394638657293655 -1.6337642692805933731 0.78888198496016848082 0.85090573977459393884;-0.42568207318299161601 -0.41237730846747694402 0.061725477295698862046 0.11521077329246968979 -0.15177238667631387514 1.1803210897351561481 -0.41463495469289418649 2.0054546717994643501;-0.073609144819752878042 -0.33121800364408066075 -0.59916454558652565421 0.25667725400850721629 -0.48926644944891567457 -1.1023687199429821337 0.7755848020524466202 0.59811649531442312444;-0.15630171579218807287 0.045411602208264456593 -1.4163853924044347288 0.65289058187571147318 2.6804688731152257475 0.64484482747729965357 0.12432842208733531353 0.71235756439315478517;0.88625347481752636547 -0.3447181427352615235 -0.67713745838844607849 0.29981576195484010983 0.30866826232935440366 0.16173761533399846901 -0.14529267293969613806 0.78073695394120568025;0.30386098998334432064 0.24851206549689916492 1.3040398792361416191 -0.27905397027959993883 0.080097444763428948811 0.015377522813211747313 -1.1826572707493625547 0.81832265112451951783;-0.0048211149491276137843 0.094459525726192525297 -2.1790470791885767632 0.012172866062301283124 2.8624376922771994636 -0.9736357712326729752 -1.171043764730356429 0.75630152702512343232;0.081625170447148634456 -0.32555842887457886459 0.90476552152531686257 -0.025946373314976595159 2.1249399733040350569 -1.3219672479853554758 0.21740444565347188943 0.56332209465738469767;0.2351108829104137099 -0.40711155079321759143 -0.70789248853748332202 -0.07044774252369860601 -0.83744080724747482769 -0.29222674362855594055 -0.078754365873489065586 -0.75772388853955219279;0.21806085501670352533 -0.62119672860010566318 -0.17114867895089261318 -0.35084593139764475023 -7.1932734285022830178 -1.3988827179413638735 -0.60396230249973303916 0.22113181492777184145;-0.020444768284389010921 -0.17967197759318728756 2.4606737326223915296 -1.0906570608225283348 -4.5034892077672816768 0.27207842721262009977 -0.84290752351032405265 0.063826681864174256154;-0.66977176169715391119 -0.0601453306117371439 -0.94093034181839263486 -0.018269221524649974925 -4.978719230657208783 1.317751874439807791 -0.71549671705854567261 0.27347916871609528888;-1.0061657768835956528 -0.3567599930681697451 0.3232038764979215939 0.64184936197003850111 -2.6850224278065941697 2.037448759133948073 -1.6266554719852968081 0.5732624797073969658;0.62264463036059847223 -1.4948952077279618056 0.78167811210452964321 -5.153974079941178843 -2.5964378201070235086 1.4517010982810882869 -1.2166984354203937979 1.5547626622344512537;-0.17580961743034362321 -0.51829303529194670208 -0.50160311417218395036 -0.47847325695238396293 -1.6031975339254047608 1.1776564415154413545 -0.54176640717050228435 -0.85144617952852230669;0.3651689078768228236 0.088501943351624076661 3.6266435799484462166 0.066356630906346192322 2.025277742024298 -2.4943896088108181708 -2.6852620790357053515 -0.085902152836602629904;0.20265363653399973143 0.37490391149932750237 0.24908969228384669758 -0.084977400017644394437 -0.88130836226042574832 0.22834651031289113221 -0.28972985120743910414 0.29969933680647486973;-0.054553190121318990979 0.12485787851498850176 -0.75535376502665174669 0.093719335649251445108 -2.8510042377168502981 -0.43956614039418262507 0.4410135148461555854 -0.67942555633827017569];

% Layer 2
b2 = [5.6532399769832073488;0.66485568782355797257;-2.3590125623399305077;1.866412887305745727;-4.1027578644336690772;-2.0393602328970361626;-1.9105528115281600332;-0.74990977360418231701;1.9703383405585896959;-1.2012375042516971746];
LW2_1 = [-3.5502822647540344114 -2.7266465140998978889 2.0817752370447348831 -0.46888840115060592684 1.6200665849718101086 -2.6186325194890978096 -0.27280832803187105018 -0.017677230206586881656 0.15921368918194622744 -0.33212791861906049151 -1.9431855873081111952 -0.74806588399321427563 -0.10639792617902500693 -1.3021349668288912937 -2.4771454196738700304 0.58899571373434445043 0.15410447017043696349 4.2380546369223512926 0.75026271044939030208 2.1754617796467696778 -8.4532047225557764847 -0.26020736393324689351 0.7964230345807903344 0.044069440194193447435 2.7982213299536020656 -2.7859594238190279469 -0.31895950361968933295 -0.33047973869907448785 -2.1066765534696414441 2.3558496745973198649;8.6940048816285884214 -0.37424446748542156138 -0.48260069473692440711 0.95679478751007063231 -1.0722501763707927847 0.20307030249686919277 -0.52655351037814512871 -0.24188640511970979641 -0.13469386527695528799 -0.30316359272684390014 -0.064212908138663843394 0.030702595385955624291 0.97520693945647085599 -2.0531853169834266559 -2.6320188408149918224 -1.6705817876116175746 2.5927605488626142005 1.7624707919096165298 -3.2734110215423428691 0.41528217489592006428 0.078561215122042171721 -0.36954506033863832037 0.70839754484907291321 -0.079315003895951641244 1.437972348984416282 0.30144466320831336814 -0.38709316865654525008 -0.97561463258441949442 -4.4890543144453198821 2.3413127612911242004;0.043999622659235279598 0.33009149229353851318 -1.2409711646586716327 0.03200545540155314006 -0.016058685524921210291 1.1907898008097377307 -0.12106389312245280365 0.020275446183874244743 -0.14221318743619504321 0.14510077326215500837 -1.2734855436296594888 0.2469910619060518564 0.022332944370282790947 -0.66526132866932263799 -0.081883796123860499994 -0.0580846010796443879 0.069456610470311819228 -0.15559174622427349166 -0.32990769156392363293 -0.50322703436626514684 0.7371388008011722226 0.49880356558718369486 -0.14902051146765932232 -0.088701767758185570689 -1.4233352981995412989 -0.50166453028408342085 -0.33782326203464063674 -0.053287380078201510014 -0.31276018836938912493 -0.28733334394649678867;0.80970635715150796052 -1.0595313426366905762 1.1000588876160131147 -0.00052147186379763901636 -0.16561498169288402238 -0.92804893832354140581 -0.075429596426454054159 -0.030034165488514716347 -0.21232039259114346419 -0.20554241284225932551 -2.9588120730204501285 0.48169980045072574582 -0.17893719326607501752 0.25537752296647542316 0.14818995678080371103 0.083028058121162304217 -0.40835617171944721404 -0.45234841083736609946 0.34923593710253325595 0.64077857307893704153 0.35901351543888931905 0.67430159558000224429 -0.41653197707074257616 0.75756770378103222008 0.42291170999477722958 -3.841032688578722265 0.79644342340950047276 0.2234894770341313841 1.6989734382546810565 -0.63511091900647065334;-6.0500746642298661726 4.1136894979722669063 -0.91858524842634192709 -1.7719167222667009387 1.6940107325403825911 1.8151151135376455414 1.3924103708355115572 0.44980122259788551942 -0.32626709159616601452 1.6442830905390224405 3.3029840398584391359 0.60587923559067424772 -0.45614582603882181111 2.7547092914121247276 1.0291863025503225071 -1.2537971633922964099 -1.7087445129317746506 -3.719038791028158375 4.1564457541585388967 -2.2511029115179139737 0.93619452100237754433 0.65123521115069371579 2.9607192442353311712 -0.11777791957148955881 1.8153349325729979391 1.0960557260587777684 -1.1500494513183365797 1.4794272401764074765 0.9646777398837830253 -3.0372792685580241034;-0.14138913566473990113 0.38020054943517789248 1.6503187192212898093 0.83969149668498055394 -0.35874063021855762123 -1.6231199696335538718 0.04867213769933227685 0.00079449395263779813876 -0.62406325032987219892 -0.40269531446269452024 5.539867598128589421 2.3545467457689777113 2.3209837928717620414 0.20887538427220223025 0.11347959357955267334 1.6115698134119691431 -0.03673186728769999021 -0.52736225239987766233 -1.0639559676758232332 -2.0877613694041499137 -0.34628350592442724842 0.45429356759482669714 -0.38633951945495320635 0.94460746939855566584 -1.4728376013712292103 3.8244556173845274394 1.4632539217001430121 0.38006961202868594363 -0.15522086423171430059 -2.5049289508821086514;-1.7948849782469862291 -1.217528694501063713 -1.8829529726726754735 0.089031455502093889698 -0.6086305141351527892 1.8083927468746154865 -0.018529955338766744555 -0.14665145187385608683 -0.28673269688081498563 -0.2524882899482907006 0.25693794002954806199 0.78598760132976919213 -0.78052953288777626728 0.18928482386949996297 0.88587311999802154094 0.58692226424670612683 -0.62751306858465838445 -1.1172663666362485646 -0.16046723391566447559 0.41950133121868798947 -0.26899671830737564848 0.9466666514049689729 -0.88369072385094193933 -0.26590901298808988784 -2.2629132837539738254 0.8191927641253303749 1.0743123252339488172 0.15114030743618855901 3.0072207540082263044 0.014082457498479391059;0.92704634436895350103 0.76179692070019700001 -0.34511125466519726457 -0.8157556061471491482 0.53920969568036736241 0.12660596218148920111 -0.026401627075047194582 0.35289494187784781198 -0.13444395214660528892 0.20134025943573258255 -4.1865576473863503892 0.52177013205981170874 1.6873391206847547785 0.14176133696907133874 -0.48936348408174595859 0.31367237332318598231 0.46487297336622651622 1.067506947183837207 -0.70579418381874547972 -0.78585919553565175555 1.0558661525341725973 -0.041280688699828267663 0.96831487502650226418 0.71328723961878826021 -2.1114243849377944962 -2.5071959627619855304 -2.6309534183774947458 0.23715946300314144635 -2.5526680116408799748 0.33044103859242784926;1.0169662229988685187 -1.4593161500672104935 1.1159948947269056063 0.33490803631700244436 -0.87278992602097915654 -0.79709421260648849472 0.19851847024296467858 -0.015980770336015054367 -0.012529148466899805645 -0.33037353574879974039 0.39006713529784581285 0.1228338975385687426 0.050394049243012294104 0.97461618853446640998 -0.33125699603781522118 0.71789836842397214411 -1.09505980277682613 -0.95417913633270368123 -0.46950475305032446371 1.3442487948568442313 2.2957531310888628084 0.54182654298927257486 -0.41774414143317556425 0.47001582982677303502 -0.12189434013608504981 0.9001916212770453285 0.17964013500395215051 -0.0086879331520029468017 2.5619915672797608508 -0.73474582795465903651;-0.51899673450672245689 1.2912670702183639548 0.79880353635723244654 0.079578161912200323647 0.76194156093732090529 -0.68191362874182903653 -0.153505393914872168 -0.014300214070022890592 -0.23189944670403275784 0.26261581394063626682 1.6746895187475439037 0.38371540680772298071 0.45470752053602897513 -0.46417789746297866138 -0.14985543899706918469 -0.73992096081256109041 0.54161842686483729903 -0.49569934163578854847 -0.0088361880711281988454 -1.50665539350964095 -2.1290002888895571687 0.23957720129378495821 0.16265636808221026199 -0.1755818112784161833 0.5204810307721003948 1.1233515247817025262 -0.81532809054914479052 -0.068276755067578062675 -2.0040122286156170084 -0.55199730784038958387];

% Layer 3
b3 = -4.699517074771335956;
LW3_2 = [3.0707876453671998362 -0.21721838176351723759 -1.0906475985551857821 -1.0212784742963183504 -0.74027626229428822313 -0.30936455215493618986 0.65473281793436188813 0.31360628063620249462 4.2889914169727463289 3.5745525501294581616];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.568038194888224;
y1_step1.xoffset = -0.04979;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
