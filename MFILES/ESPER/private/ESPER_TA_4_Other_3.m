function [Y,Xf,Af] = ESPER_TA_4_Other_3(X,~,~)
%ESPER_TA_4_OTHER_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:01.
% 
% [Y] = ESPER_TA_4_Other_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751;-0.1386];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0584431850247228;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.33262105189233387437;0.083063134950159156489;-1.4536343060459346876;1.4991546319596642522;0.76763508603466901192;6.4718840830148245402;1.5555101707047671589;-0.073607244564405760467;-0.1469184096722011279;-1.9525300764734867531;-2.1595859591090307283;1.9835811921382708878;0.012834721516858677709;-0.031460732017953144113;0.20308812395328959544;-0.10910331734907194323;0.16870773073004372011;0.050740704398015826215;0.069979481568601634156;-0.30356370741209043329;-4.9476352471887006246;-1.5769302120502202147;10.7180370027166596;-0.74585343571102402649;-7.3671567866094882504];
IW1_1 = [-0.16609503821612325858 -0.0029920974154210942114 0.71046010856439845149 -0.26837434249110470041 0.46016265556281843452 -0.0097842134494875894479 -0.13124071251693508744;-1.5980922192292399409 1.320022197737618086 0.76553620729133842193 0.74321068619755614737 2.0343500783324808268 -1.5778526295512562694 -0.53608303837113779888;-1.7183847456152627764 -0.17877318577717116188 0.35305771039038630343 -0.59207174179146837556 1.5286207774696349837 -0.75231067603558032797 -1.6446571985564217844;-0.14554147359941033146 0.03871873085864058206 1.0018946510002237904 -0.44768330411283518977 -0.86872287631758493553 1.4073252502611777182 0.51161560764727620487;-0.62093407698690017416 -0.080902094444230812642 0.94951393858538102322 0.22817580052233954468 -0.44736238029412705997 0.80089887914529844792 0.7733419803773833312;-0.17296054182105566333 0.15755989320776495055 0.11840987705109810857 1.4472935604247398889 0.33719342961820253368 0.084513395395275719979 2.1917906235143558291;-0.60156546331509597181 -0.86616828162793046975 -0.013437420670639398448 -0.52232498318532949444 -2.8143186235928809857 -0.58683507368971543627 0.45218004056540789248;0.71898710943182075894 -0.072028457026123024476 -0.20071538212120421107 0.25669489302257264551 2.3967060466216087988 0.84495267231017168186 0.35670357500710031529;-0.14962506210742743118 -0.049410731399412662068 0.71055068185984937568 0.096571041562497031419 0.071794930277017290909 0.21089576213735303223 0.022380381161242444282;-0.11817371700200310358 0.42617873328896610507 -0.75406200983911453317 0.38730540345418840165 -2.2717614560057288742 -1.831812607145248295 0.93749484133613403269;-0.60508313713771588738 -0.68265490267167494576 -0.32686655676471804144 -0.34297422882920952647 -1.4537800227175503576 0.019027492270965284948 -0.32519308653757028615;1.1646817956281352302 0.85869920893119533467 -0.49833393489109978347 -0.1657577374699471251 -2.8948655373966691862 0.83521764350248473008 0.41576187142804182928;-0.36520150764036740654 -0.051631686647868692275 0.8898762029106724869 0.088080490268204691962 1.3794970346391641769 0.14732272583478747685 0.47718154094305303969;-0.094504065103879417165 0.025842094811213689454 -0.54217077400269941823 -0.0091856420251808842264 -0.11985450478289520759 -0.36844159098140827346 0.038377772502272526622;0.20647005194144923967 -0.053965304867442151493 -0.77036050684115287002 0.32982334442575700351 -0.26099883596956779952 -0.045649412699159390427 0.1419687163513840833;0.24356406897098362152 0.4482609375110033767 -0.92521417928757621052 -0.33188167543989055552 -0.27793175635502948007 -0.64506108200440104294 -0.35320031538488677603;-0.48550486697188688368 0.94108530265180223573 1.1315304913287276278 -0.22054925848021061929 -0.7551796880915797594 0.39885815328340329389 0.35730334162066662573;0.11045641593969891814 -0.052023774808098742495 0.52122220431431531829 -0.034880024013740990041 0.10389255510790869341 0.35511756655882159572 -0.059153825778463418883;-0.53607665729950804145 -0.17809701481603654183 -0.93064571381399519012 0.2270459100111060502 -2.1782862136113267937 0.38457960246025479911 1.1467076789198193953;0.63204677266495712384 -0.21107905087865025395 1.7631271445153957611 -0.83749308214192186295 0.63947465194278940714 -1.024287666015718079 -0.48026030334965452706;0.074369590432547497127 -0.043978413181885687988 0.91162860118876132276 -0.24837048427556931984 2.1461162596864467034 -5.4163124151715873467 -1.9839772225267433559;-0.49408885284954368045 0.21041888849074932843 0.72334885932130488229 -0.18303094981394948948 -0.47800826970686083328 -0.44338499422664812144 -0.48841341552228656475;-0.36028003221578785986 1.2585841626781590907 -1.2139941573972901079 0.16837231619381518022 -1.2139411342203261235 11.748193611066021447 -0.67058832236840415497;-0.075271723628397624317 -0.19519920445889976657 0.562759952924070328 -0.23947861522242125387 -0.96785037989889488586 -0.3900560460940020735 -0.33768237898685599108;-0.19598959417386202508 -0.50308798792380404752 0.38703512868736772434 -0.044156794430343301872 0.14559313755858763195 -8.4076600947481772153 0.93087523777813940828];

% Layer 2
b2 = [-496.08115175162032529;-85.126173619690931105;-9.349888017148041186;193.54115698258794964;534.01356779797094987;-17.092210612446287143;-26.979612801565895808;254.14565786211406362;-197.66570574356205725;140.22488514107357105;-180.53393644494417458;-43.065428199626310857;369.80520216492124064;-15.5857902467506797;-78.927657816218115272];
LW2_1 = [-150.99610998909113846 177.29694337095386913 23.638941369936819825 22.113004333083651431 -12.409092057820195976 331.39099833173094112 -46.472661273490217582 -13.805917481091064758 38.401821405227948958 -2.66971969053528424 19.249860354588996358 -2.4483414834067547261 2.3393051526664954132 0.93120217112336434173 14.003269895168500625 -0.66574342178519441138 -3.5708286115020393403 -0.23052264765639887689 63.245953543311784983 81.019415719330780234 10.776815447517471114 31.942270460525342912 -16.931296086392819689 -74.007999168038651305 -29.854780467049572223;-0.77827739526294337224 0.5571584860033420572 -0.54226212793621819674 1.161477789622712864 -0.08143134854871129924 84.110069318143132477 -1.3730463136348927122 -0.5759485183184445134 1.6565163547221670726 -2.1672028947942023613 0.34489011883632558764 0.24332475696929325992 0.16894737045186677959 13.81923630862012331 0.22021418272247494929 -2.3448717211544329864 -0.30606431965078545465 7.6909017592204840241 -0.60113229296138970259 -0.73071751697675679793 0.19434288549643027877 0.49248988914795233107 -0.14920790048461490818 -2.9068402403386439659 -0.050583422921799500727;-4.2646342047393881458 0.076421604689749053629 0.69514958310787833273 -2.5849907387633344058 0.034416767410306983721 13.011394302444426074 0.18674541966129504234 0.30782977062799288248 -15.26030489344081964 1.0618062705570991966 -0.10294450979454078388 -0.6768032440845620501 -1.2432316212627256835 -20.331719227937973926 -6.0313037950911914109 -2.5271215157814257424 0.6057729198927249703 -6.3796360653272046193 0.57896232630639332672 -0.77982210368614934826 1.3627626128455929688 5.4781996776646471048 2.6565087794356343487 -2.216722357996394166 2.6692746662514093003;-8.5945820942104376172 -21.145778384528732374 -35.975846755684031564 19.691835052802499462 -0.60589260993214144602 -142.77856448565538017 -9.2007584545272855792 -39.641165424238835158 27.013111782310016196 -23.817846092315203776 32.533830469881429792 1.7010915081981266006 5.0635316297946992847 28.651409277343788062 -0.51098341813089065422 11.137161670493732402 9.1378621842751233117 18.873889814563323597 41.590142890892387584 -23.221493914984076667 -5.5021529368807353677 0.96169842543716443917 -30.349185993411101236 9.9523290021399439809 -29.716399327121695961;-1.2592058377985420048 -331.4728333073018689 17.079890700985544072 -11.320731971447823838 14.02993477291124691 -211.97691395190622643 27.169401933236237312 -12.527331680491291976 86.086492971743837188 47.211801270247846674 82.126782504074384406 43.60046482427636505 32.879388804414936942 51.78482372561990843 -11.342449024239641631 -7.3925662495027140153 19.505105104734308696 6.2220848514469988544 -32.669727158202732653 2.9791317333579026005 6.2937157348308687688 -16.367952164351905253 -3.2304313372603461474 2.0873108427576321233 15.224625724001969118;-26.152683321802808081 -4.0977953884242417359 7.8465968687653138147 4.0843141921793542082 7.896463676290666811 13.740657208211059626 7.3210464201957723418 6.9668982473258100896 14.537940787962291722 18.130798824428207894 11.661024204912692426 0.040256207583391823146 -10.330496837426753842 49.734122696262105023 0.15552263020665352267 -8.4138093461937391027 12.992483686675194932 19.516797066010084905 -13.694907581405070474 5.2995131629717953103 -5.7761672756495743286 -10.464588108327637528 -24.479233464475402826 3.7010255010005663756 -30.182398489085226601;0.12682623380681651293 2.6846863047124900348 -6.1053254600899560245 0.57792220865698618049 -3.7119788712836467859 16.108912905828823625 1.2663537976993033407 -6.2376474232715404256 6.4795400107944631785 -10.562720589812217398 -2.9542589975150148618 2.1853963172490007416 5.1677081388115500005 6.138439146230729726 -1.4359742717743866347 -2.9678079632733003201 -2.4848613945580990681 9.0182379641701899686 3.0224858025061163147 -4.1724547698652365568 3.1823249509022333292 -0.94159589062858151109 12.416723139850487811 -1.5078942581012499957 10.060547891038597257;0.54149946711986141068 -178.91696855097205798 43.817314070302408879 -28.225860281872396484 2.6607101301139883809 -136.41928645908885187 -28.552680130879945608 -42.414809206939068531 16.718597575978996872 -66.039314059552353342 -31.089978027896759016 -1.8813038217855619916 -5.2282646241513379692 33.080184682818064346 21.413046765599862198 -56.615763393188736075 -43.719606829756124 16.910894067916803607 73.951057498082718666 -3.8833552454882296345 -16.302107130806714252 2.8575125806536454398 70.286803968031676959 -34.525990220992881063 3.2153163321874624891;17.253595885072943616 -162.23527038091302188 -0.14077842529117945425 -68.844009168150961386 128.36078850782649852 259.87513849450380121 -186.95180102172597003 -18.756412244709967041 27.546937672032761668 -53.013739815989033843 1.6176053225993123341 115.78869498000393889 -62.338168610963471394 429.12911966926395735 -34.875897719983875334 -120.52180987632726783 -54.369306315923353168 160.71861247704376296 98.221984018951303597 42.15827212864206075 -8.8308735055964877603 -136.69075099297231191 28.554826353840844888 16.229094085917495249 -75.351375980227942364;25.628582551330573835 -41.327129697748084425 -5.1180751920289937473 7.2670482557296596227 -10.674895447751245214 -81.620903193927205166 5.0625038012642704643 12.578143131214028827 -2.3825593549009798089 6.8350650022893928437 15.959912100922020173 3.0308736132023454957 6.2202510618739177417 15.662325981561151522 -7.8357590820403952847 1.7944923246738229139 -4.1001772285842212895 2.9691136755833800187 -0.75963663520788615724 -0.12401274771793809049 -1.3759486703407883823 5.4309408190952659368 -3.8584933355630020024 5.8462534058567667827 5.5822051388175326636;-7.8922647882313805567 24.122318947092342256 -2.3409455880528033944 -24.379129316315903964 20.471547505661636279 155.20984834727883594 5.2971140045380300521 7.7566546070873929608 73.0016278902489546 -32.241952256628515272 6.7682350802360913278 -7.2196000459132978477 -15.704103518415735152 4.4186493250864149474 14.904774359606527412 58.227792177241447291 10.00681191644188317 35.894978615571645264 -8.2122677986406511508 -7.7698644622173409502 -12.883950965515634124 11.634246677869992226 6.3011758051874933173 -4.9321387748740281864 23.136284980788648369;-0.66743096555691872052 -1.7566409572648622461 0.94124792699567227938 2.0621679276243352064 -3.0862557352742663319 52.060033392681873465 -1.1795231080862054185 -1.7678915452129377872 15.333944414757567642 -0.30206244968644557769 7.6997077432656988449 -0.71960362713607972651 3.2010426655218564562 5.3950164988228719309 8.004185640627861531 4.2890292659628919125 -0.41125569231349384802 1.7421901775033876714 -2.2633160808802519348 0.38945960820141140024 0.62373617024578309476 2.5189691891251899669 -0.84513755064982631904 -5.284289620490855377 0.27617623521974943301;18.878507855931680126 15.335795353972510924 -18.817952924990784425 22.514677738397416817 -5.1676160894954463743 -384.5862169333544216 18.687875825136003982 34.492807593443636449 73.029383530998487117 8.4703133186738384097 -17.947219929050262976 -21.624175779287647003 -8.9865493512458627379 77.778081486115823395 -1.8892889438375379818 28.589123076631093312 -7.5429566805816552488 26.867284244305505325 1.0923461987996672118 -11.399838906978681408 -6.1239827787767744383 -10.579264810923019624 0.34777614333824524717 24.4402505964279122 -11.970235950715393258;-6.0815980977120656092 -0.015070624670639236331 -0.033981549410031196279 -0.34055301787920910783 -0.50064186797881415902 17.355236059201455845 -0.16404543934581045095 -0.19658019285958860944 2.8656254393431326299 0.093032476216227857901 0.51387162783238993224 -0.013185697468541793601 0.61536261753082521775 13.045890982855970819 -4.4879960627525843364 0.31847950208670555705 -0.12736475039642677909 12.761127229587932774 -0.043607956791141933017 -0.0056620427225903989174 -0.020588515488240217294 0.57438212120244647174 -0.019022708348724444438 -0.79400627513705968052 0.022683730260225087177;-13.749487393986136397 -69.774332835779389939 -28.908823710645986438 8.0134941615849477614 -2.3986388577032911051 167.26990954199297335 15.290636581613171074 36.593962317400873019 26.279887282450630437 -23.420541746561212904 28.389320131182451235 -14.505048599918339391 49.053858105299710246 -31.822418743490263893 -13.57705159639013992 31.548932960364972189 32.192874267467772142 -20.944196114818399934 37.117707809037568722 27.338662522268379007 -5.0203234642153615752 3.1662720932284558195 -44.386506675393981425 -76.550256420900439025 11.292789456575947682];

% Layer 3
b3 = 8.2271002858315416262;
LW3_2 = [-0.00295741857278185305 0.12410681822028483967 -0.063471962125935407761 0.0059347674092651431232 -0.0013781401537667859001 -0.0096469821047797995467 0.016110562374608491942 0.0032432648500478672079 -0.0019480968955583968273 0.0050016307367817753118 -0.0071387274013423075714 0.06323977634386293567 -0.0066548319612632911291 -9.1061498008824273143 0.0035974309751271127227];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
