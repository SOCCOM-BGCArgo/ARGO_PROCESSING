function [Y,Xf,Af] = ESPER_nitrate_16_Other_2(X,~,~)
%ESPER_NITRATE_16_OTHER_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_16_Other_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-6.5260869441395410462;-7.5220033392886200829;2.1026706941142063734;5.8838516501476805232;-6.1182522501003395732;0.92610616428372105613;1.3102776955951089821;0.74446379230182624376;-1.4939231140815012466;-1.6891419874031421422;-8.918364332587056964;0.30238910050853151645;0.67939938861161330852;-4.4655409452624050815;7.1857127673210623442;-2.7654507642071775031;-6.2412963747322676156;2.6701768098656537553;6.0910071191096530896;16.484904791558349757];
IW1_1 = [0.28815304128653040916 0.060393504074392881376 3.9717127331955142111 -6.1588388981861310612 -0.63508516726045127765;1.7985189102420857665 -2.594069157410553661 2.504079690269942482 -6.1546024309524236529 -0.80663816317265657485;-0.80320131359908919499 -0.27985034565971561582 3.3580883490279576087 1.2482970758233924435 -4.3495751600055641006;-2.2311834393595804116 -0.35448735924850510726 -6.1596113874502389507 3.1329978406128282664 2.5320709323742676133;1.2831507032788991296 0.094274348855766049171 0.96938384425631207719 -5.9589458537585100473 1.8115595382709297478;0.211415894393612247 0.19203430607489399562 -0.60640815489112631642 1.6135670970697537641 3.1542997365622560402;0.17700198987281387519 0.15178674843341466438 0.049621399094568252597 1.8914046006477056583 2.4658384171001377361;0.39751079087044088878 -0.16280795530888861333 -3.2666885312049824819 2.3862890112753358807 -2.1447532029850830959;-0.058388244296418985446 -0.82819129538880631447 4.4275160923201530849 1.2193269919271014778 -1.9386698182945256708;0.78157989358222190734 0.61682805817291663786 -0.83514272042103954163 -1.3195527746950181935 -8.6181134232690030927;-0.78601490776701155028 0.31660696080253186713 -11.576155365122794194 -8.3969310848490952282 5.1312352323848635649;0.95407590035463674116 -0.48228582785165102775 -3.6966709667424266783 -0.10456521053018995315 -0.77111598836364403375;0.37144887791856734394 -0.050741899385020779178 -3.9403700046627059272 2.8937285509052230736 -3.6951145650866852321;-5.1388081506961853506 -1.5014491185565601583 2.9381382510592994883 -0.20685111385701357434 -4.297883672612385908;-0.60114180911760795034 -1.6481637760317888741 2.762094009890999402 7.3174170357127055198 0.60995946817894319825;-0.60455941120645506626 -0.19250325406191245992 1.6392857979769563936 -1.036541574839369817 -1.6539429155402514127;0.61273028249201944018 0.0044325507572004606976 -11.387938081751176611 0.7004181547402771324 6.428818185098593041;1.8835222574125052297 -1.1710559370085689146 -6.4462288679824437665 -0.6239793090555184607 -9.6605459937661297687;-0.5630418438776851886 -1.3692869365792847969 -0.017594360771551752903 6.0571432765347887894 -0.35364881334727249484;-0.0026072583136372865995 0.091882185414377037791 -0.38132254057187969787 16.273681341656441646 1.8475279308887591068];

% Layer 2
b2 = [-8.4578082875717086608;-2.0757375216984943478;6.4618197608706156032;5.4228186993529483573;-2.3490020089483500954;-1.1012628363845784474;-2.0074579213459644578;-0.49524778711234085371;4.5093182527010888805;12.755782329128365404;5.4374476763924768363;-0.77492994515105939612;-3.7952904475246476146;1.2212149898834478989;-2.4762818817914884484;-0.90967853098759487995;0.81549186676598872658;-12.889086058549411362;-14.70211209156043175;0.7863358274540802606];
LW2_1 = [2.1472759474222575804 0.34573847627378495595 1.6123082392338043967 1.031839885590233985 0.73946833584105831072 0.46933255403827556229 -1.3466046511187408363 8.621696670103482063 -4.1705331665490303905 0.89860907573893500366 0.37712754556985633725 -1.5983058880752583075 -5.5660584891995803503 -1.171309321067696585 -0.20928393729808764112 -1.5426664899906865625 0.2711723798897567872 -0.37910598628174591029 1.1336610000848430513 1.6687600015170958034;0.28979866864159548046 1.2376665089249809792 -2.6331757122124082038 1.3679718328374306235 -1.2464342425473020626 -3.0768941656004678009 1.3067312182157846401 -1.5641083996811375734 -0.54924730577253777497 -0.33629805052586597691 1.0250917678143189882 -0.2644126859224035786 1.2540951587592723548 0.52807249567018921255 0.45543980237546721757 1.8693040647894676454 -1.0365934124794433657 0.20073696374234123452 0.3051635249074642342 0.11507617542312706393;-0.22965713765912285083 -0.44883032394543659338 -0.35031698940541700082 -0.51803058537111101867 3.5464317079889324802 0.66392508788440507406 -0.10778832065596645473 -1.9084943578465185521 0.13805271575135583118 0.1565059980405556217 -0.0065854112794180253918 -0.59197613940841520286 2.0801542384719557965 -0.062232016829521022427 0.55406265629092965597 0.022039012323507446711 -0.0050590929427627761086 0.51576716318366755409 0.11731374635395955264 -1.2916776884897123168;-2.8921429627828572073 0.40209546654539995991 -0.60386214351489742036 -0.26224485329522045918 1.1885198267632055558 -3.1471430110849998307 2.6247804478159353359 -1.1266519769342975277 1.8878410970819354819 -0.33438332730948977511 -0.45775660623967684426 -0.85151716134669208635 4.5258463545381291127 0.032818263222722736383 0.21994166488577973628 -0.94052588473394393986 0.19420023750320120071 0.44986457388322093065 -0.25342332275881762627 0.59836431421232161298;5.5367373113686664254 -0.221815725335301972 -0.85973409781879139846 4.8473024082658806577 -0.057286418278245980484 -1.1164987166261257645 -0.17202792082153561815 -0.58939016797031917871 -7.8307452207086729601 -0.19263399238199463426 1.3808831593462500553 2.7590837180640730431 -0.88292349249189505667 -0.52659192744769967032 2.7482278360751548618 11.46079157240781754 -1.0154827690948466934 -0.16618442885478343363 -3.7318025539617210029 -1.7387801177033530564;0.74287312712972719542 0.42782529152299825226 0.050729424685899339453 -1.404723742241897444 0.22620893277646231256 -0.82836481829488928241 -0.1191427737960622929 1.7245006352948326622 -1.1537194845761618023 1.3444633762215143502 0.20803659137466989915 2.4858018473148408845 -1.4668184126966858916 0.12495544515553413945 0.0074804720263031386496 3.32081819914713261 0.012749126816964224951 1.2627677901350526923 -0.38860004550124616074 1.5151726255792863363;-0.24124991192501604731 1.1179775801626870013 -2.7818508619555952777 -4.0727618067197628449 -0.72884116770058759993 -5.4678112476455735802 3.1083584135285051708 3.0971351696330433612 3.1369006492864590641 0.75390585412215871397 1.1090317146518227087 0.1239142302198432688 -3.1454040196818109365 -4.440631753431311779 0.79811108614035908282 -0.63962832399601299294 -0.45009140921428320015 -0.28101158752434918231 -0.64443960386447263211 0.88693625643921503166;0.42606169200021465349 -0.096262564366099812041 0.069158400463835964511 -0.041704444514722334436 -0.23159593876744319352 0.034546761962340917507 0.96121788756173531798 1.9141299457879479284 0.27851623483970389117 -0.20507648736034889136 -0.066101341135533911442 0.00087898286963531910027 -1.9289339883002667442 0.093584500901875949941 -0.19120900353884665024 -1.2801331090257430656 0.10654467353539340269 0.082086477187050810311 -0.057167507315838125836 0.4388974039199329269;-0.84382066419244838862 1.8497835583181374552 1.5928198668873481125 2.0161107585905955197 2.389252247205039037 -0.69333867770065038538 2.5393719554574416541 1.9475090202902463066 -0.39702525853284859059 1.0560071203905303516 -0.49466288313971312762 -0.64210385998502383931 -0.25373569096886117169 -0.25989636875834210006 0.98465764839758129767 8.690860243335750468 -0.62750039442369298648 1.2231596618847757618 -0.21830336600591715435 3.9057375749196237003;-2.0727399207927756919 -0.080425943295828139501 0.82360653160429808661 -0.31902067402020128917 0.68463135359889604192 -0.57538347426680369612 0.76126355466059425492 1.3599022640164630804 2.0102427005686220873 -0.10690429237537467377 11.027213104481772277 -0.14411717889936276338 1.6522608906158871012 0.084266239177841623098 0.23063984541414805918 -1.4051403215677826797 -2.196612987796353611 0.15728874485014116003 -0.19729079346317660026 0.53332992228799325218;-5.0657281831927409854 1.0435090280527201667 2.4806260780039175451 1.8834062989392372778 3.4882919731536334851 -2.9477699724017361049 4.7249683020761787944 6.7844739928233384063 -3.7461365719091261894 1.1096041221926480347 -0.7019125379631772077 -1.8992179156488788738 -4.6446485037040963206 -0.459084880709553389 0.73631362917436271598 14.256350679541593962 -1.0856429513042051838 0.31410679929798845933 0.55018882917770772778 2.6402024895633124935;1.6393991224716717436 0.34518789616056816394 1.4215193973599802302 0.68591667541287526522 1.5641585055587985398 3.4828405647211475582 -3.9491715631912733819 2.3929325470204578785 -2.6267540538891736013 0.70626799007609564196 0.11740707057459644214 -0.83826202648271763707 -1.2696840385800851614 -0.36912684326967065696 0.85710946965153278487 2.7167357610882012509 0.19407473671664540738 -0.11313439503785099882 0.42110623248568251897 0.65500959641322065163;6.429547510664884058 -0.78750816326036965354 0.48801971426083878836 2.9221075669100322614 0.35505478150990771313 7.0553800463541884724 -10.411377439248196808 -5.3137510475637039775 -4.5472016304936611064 0.59693010662498469099 2.796801808135510381 -0.85658760698621760898 5.0614206765913367647 -0.66817527998477954654 0.46953326302771869472 1.1631291817310249748 -1.2674215838830809044 0.16158529509152139148 0.57908187505533581518 -3.0888323974580127462;-0.016784237949720996752 2.1088482291221062326 0.68577187639047576528 -0.49866796248279532389 0.85149784273200535001 -1.1897350791452019347 1.9076303772745923926 -1.126679866030635413 0.15213178905863555812 -0.58964713795741841018 0.37705828868051127767 0.95799936170002875091 1.6744137815117834389 0.13779990012343495964 0.41709660030153383747 0.32971828744541264999 0.4658039594004851347 0.18929223675646014713 -0.020226467461780032325 1.9147737621467841862;-1.0793029088396148829 0.75377665787147829501 -2.3772765463843872347 -3.4935133060392318249 -0.14285854795850028154 -3.3988347563627656633 0.50900637999615439 3.5376987407348217118 3.2069130847780127347 0.83244340450147868982 0.16694063369401734853 -0.72900376909718345164 -2.720985084569318424 -3.6033100446083490276 0.6663799429650820727 -1.626910468199474824 -0.50566900614811738368 -0.3743855303072165519 -0.58554789380485816608 0.67681852125540131748;-1.0431743490414313591 -0.55511388433452046876 1.7912421575180381694 0.61865764138247925086 1.0228647438241369461 -3.4602780920357685268 3.728111833305707723 -0.73402895108674404145 3.25716459034028194 0.90634496465135194754 -0.17698140842387027893 -0.88515428428928777382 2.216668841306106863 0.10543385889667893085 0.49618864139550156178 -1.7474411630663981843 1.1126151127349490633 -0.1140052559219459638 0.17247119657043746832 2.1992485689466918508;-1.2371505597256162723 -0.12452083227426115342 1.0709151982100286737 -0.54948801500537314269 0.21892895096571685087 -0.8593843461982546561 1.305100082674084172 1.4536059828296008511 1.8142546302825961479 0.4844031902694044267 0.026451827101217000732 -0.55194883596327104502 -0.73497301029630768276 0.14770080644562161298 0.25327855415008110329 -0.51634122415561478636 0.5040553361580863978 -0.11821421534464822412 -0.21648593901610879708 0.84477817909428754017;1.6908015827676841081 0.27021705227119979797 -0.69844877398443905303 0.42608038930253377963 -0.052980513917828396531 0.5723636723209534205 -0.98314903575035361705 0.13863653707843878737 -2.2635397661503464661 0.16256996381333393975 -11.59519661097437826 -0.46859444583428450093 -0.90233460145194832602 -0.16963939825730467437 -0.085486883596011059572 1.8533675379171328235 0.45659462448523352451 -0.050554482763177331639 0.3141882145380950897 -0.17564156217019460948;15.827983791825650073 0.92280122447372203709 -2.6398904445877566793 3.0016335276855099501 -0.74621648302751997228 3.2998193666323318851 -4.9331874672715017027 -9.568879322799578091 -4.3335483689182128231 -1.6366023456716378703 -0.4457584959471111441 6.8809974614666682413 16.458779134738456662 3.2757812866836446553 -1.1449116018543556983 -12.065990924896164316 -0.054615185882782656124 -0.2921842579225353842 -0.10763161893943549996 0.624705343035433458;0.32681602220608096943 0.21970143425407445692 -0.50442069046753079675 -0.00057755768626152007711 0.25023488835777601969 -0.656750727464155859 1.2446889933652633964 -0.38210615029938488352 0.15723952773337043776 -0.3655754133539960149 -0.15007196439617989658 0.24468922001784282338 0.47883607502927738597 0.026962478130632971246 0.056208112681375974051 -0.62175184925044812978 -0.19264852036173513161 0.25977745411357877625 -0.07662661336916150312 0.21578041392582289482];

% Layer 3
b3 = 1.6950028371357996892;
LW3_2 = [0.37878619762616899669 -0.33052625038381761025 -2.5478005294795882385 -3.1916604794825365055 -0.30707340941283312041 -0.31550892780019879069 1.0243848583100629845 -1.6246267187769625195 0.3108850441700600209 8.5061981937206034843 -0.11726975584114876505 -1.5127062259030006341 -0.17544008545328057536 -0.22770970865654313608 -1.2518393447263698182 -0.54875239187932822738 1.2713670590353869372 7.2404709724829938722 0.28466658907412795143 2.0003937947739132142];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
