function [Y,Xf,Af] = ESPER_tco2_16_Atl_3(X,~,~)
%ESPER_TCO2_16_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:04:00.
% 
% [Y] = ESPER_tco2_16_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.6146298916930624;4.7340351421833926;-3.7937304376191556;-2.6347376134710956;-1.9067906632944618;-3.1056108355754266;-1.774638656274051;-3.4950192959066033;-3.2627436238545577;2.8917148349686648;1.3784727536728962;0.69650861483514359;-1.4867857495673862;-1.0231031500718639;1.818327028984875;-0.48439766057937811;-5.1324023006393871;0.464429337635484;6.0858412269305733;-2.3281970389161502;-34.929075410279651;4.9842537184748368;-4.9637790793556871;-4.1967064060835337;-0.80082274342530357];
IW1_1 = [0.18420669765279774 0.38946046797965328 -1.4463267280080139 -0.74116576341938945 6.5318769128589373;0.35904510174047072 0.29193714921041686 1.3292614621476539 1.9562539212619421 -6.5463594948018136;-0.40133526627869726 0.34375674256935906 -0.48120580890672987 -1.5986030610532453 4.0955934865555008;0.92022854452229563 -2.0612511721563425 -0.78807027216131098 0.69193824339347554 -0.81596532118200094;-0.27042618432525517 0.64936903117771672 -0.15068867683956214 -2.3508312799897122 -0.16898953604698363;-0.24991922204537498 0.034375765857054624 -0.17238601228994918 -1.3406951698749394 3.4962656115369404;0.081611495093214151 -0.281339039718979 -1.4311262256999926 -1.6283565297025449 -1.8337294871049092;0.19324798106093749 -0.66680738093729341 2.0827186001731679 1.5591418344832022 4.1013863851271806;0.27116902140834886 -0.34158649401539082 1.9938869157422492 2.8837608931974534 8.172917785302003;0.30574863634273319 -0.6357962265395718 0.57875721127352564 1.5514863455396095 -2.5264276418132177;-0.14665797902872102 -0.29553178737192065 -0.54390853251857207 -0.97364683442429989 -2.2344121630325504;-0.041286449334363817 0.58056800948586129 0.09153429207613184 1.4247260932746526 0.6934073407935043;-0.18403124029951223 0.029109334345346773 -0.071020464615889359 -0.6305528551876044 1.1989033097591859;-0.24316588196671216 0.38686824840844825 -0.91542073069120533 -2.7500618229402982 -1.0980806674516426;0.30339991631247748 -0.75632795351132942 0.007245304981714328 1.332877089487627 -0.40644284816479476;0.28151388056428445 -0.71315566434650057 -1.1077389868038767 -0.24550579907118919 -2.8552851855851276;0.22140956512896245 -0.25398269411452079 1.4132336344886682 0.075526753218883719 7.5422872022767997;0.041705703351706633 -0.3502546139427174 0.45441910148532189 2.7283274829958506 2.4380832467367801;-0.15962348972168477 -0.40345359815465504 -0.58529626637015442 -0.3785529105225543 -9.6579571814211285;0.13121816533903768 0.21427782993597222 -1.3696295270102463 -1.3897801132615866 2.8765127019463534;-0.4843535005598596 -0.032685355005495888 -1.2502075575608245 -34.525867720032544 -0.86637657797390011;-0.11040301803497279 -0.37567424698941093 -0.48021038419678147 -0.34641847107276907 -7.784803891673822;1.8994755851665712 -3.132564794513081 -3.0759294258594392 -0.52518889766836319 -0.90389015361223091;-1.1067221503531215 -1.7782698211551606 -0.55265034888521192 -4.0240526817724751 -0.19201728204459739;-0.98975683598777775 1.0277192389696908 -3.7701380080415734 -0.39051654146629478 4.3272770577266257];

% Layer 2
b2 = [-6.6565543390846891;2.7575822792624924;3.8888803887186953;-20.450974397735092;-13.475608957610916;-18.820611075494782;-0.15555967523895575;21.253681313068149;1.7381485265270091;-6.2432022683705242;9.9416828631936465;-21.56606571838692;-0.234005879010796;46.271413832727177;-13.118005080120083];
LW2_1 = [6.0237998386187996 -21.026718216053233 -10.513814714663253 -2.8312160304616563 6.4279755723293608 35.709716962344345 -31.33832267525873 8.3068622109980055 3.8567552053558209 -28.496697669606181 -18.642331574826212 -15.170157697905017 13.954186939447617 -12.798551880450271 4.2278588865628413 -28.475715353902554 -21.308139228397632 -10.138921407431068 8.4573494865191421 1.6677934058363602 -8.3739509412304614 0.2460038214227028 17.398028718644209 30.317193440148337 -7.913710641298656;0.40543688707427944 -3.7450979157878361 -20.454989745042198 -5.1398308785869382 -6.96952741079898 -3.0810008081720199 7.4178605591675764 -4.2248754406686952 -9.8537203782839438 -7.537372887040358 -1.6097757201102012 -12.546430864715672 8.2232729429936544 -4.705820780007266 -4.9727581022931648 1.0759587877957273 -2.3309748422362704 -6.549988228183933 -11.100724640639212 -4.6115924168182714 -12.354056062484535 -3.9496667542978883 -0.82674336132076243 4.6685558822364843 2.8865733896629853;-0.34923898097004979 -12.03489435448228 2.5321342149172485 -26.079903992419712 20.062291582602569 -5.6475440124670362 5.9810719543299538 -0.030084125044686921 -5.9289152427863776 -4.3191877193827857 3.1607176751829988 -3.1687432510658002 -7.235830334018563 -7.7632689135170843 8.2230472910999453 -12.836478556967988 -1.4486606817643526 -9.2309879613335202 10.866052329315869 -4.1211239700624755 -8.3120124334042664 17.097671527156468 7.4473280956899197 -16.248221649175424 -18.604117447172776;2.6176465005865364 -12.670427336541335 -14.18841870987408 22.836315432524945 9.7878647460603343 -9.0537408279253615 -14.020024305343 24.822632460847405 -3.5333592675978447 -13.8034458222405 -2.6140073778871709 -1.1012071748619552 -21.976032809867611 22.549764120076851 13.561913001610431 20.655406895158009 12.490504072076829 -6.4995443786984133 -2.6203728979549057 1.8396810110373807 -18.726620211338016 3.7196542347667276 -2.1922007151029224 -12.540671231665556 10.792713845733013;3.9631709449853108 21.372092453422191 6.0772944239566327 -8.2455436710408563 17.527094583499998 -5.8123624926017481 -0.12162303169948474 16.797558807335665 2.8457520422965148 -18.6385664607952 12.653035525294269 -2.6602737691623952 -8.6620923401812107 -6.9670939294725924 4.7772326932978304 -3.4131009687944474 12.60006159462205 -7.3212089828703153 1.2387751909943499 -9.6564357198944908 5.118067602071779 6.6856906066814883 11.999167689465271 2.5952172288715736 0.50812222302052412;-4.4470484205048662 1.0807601243500249 -2.6358816790330848 11.468124800726548 -6.2007130388230571 -9.1579768257995529 -24.391361649753168 -2.3858208433554653 -9.2942953119317977 13.228845039283382 15.464320303627732 -0.85693775188463928 -8.3395019372585484 16.815526896747226 -3.3766131233827181 15.614060191011664 -4.9175513521554182 5.3703636103449375 3.4082221979303275 7.6006191003911772 -9.5936140917143682 -36.517235438226813 -2.5748255196758887 7.1796310759993904 -4.3447957087065694;0.35000653021436917 1.682382338497836 5.5597513827594032 6.7977881753248077 3.513489464397717 -4.1289146505018079 3.6706444032729122 -0.96895201315238655 -2.8508006131248709 23.427895742982891 4.4384836386399735 8.1202252505368655 20.085893139471427 8.3892244574564536 2.2285345424472864 -6.3492298701745558 0.91509279203125726 0.90620910400316501 -4.4177450316025659 2.7325673030969342 2.0996326949906217 0.76990407335239586 -1.6232301619694289 -1.8696908165135546 -0.30809195050087801;-0.13659091902758502 -0.31862683554796434 12.197528442273232 -2.1781814961809238 -10.839390823165347 -10.871399906947435 7.4788173013673527 1.3932072804699576 4.8428557670886416 -0.57637978513028965 -0.32827356226807503 -6.8931766083983543 -4.4978953579422472 -5.7926831924739428 -10.976663117634573 -12.363785750833253 -2.3530449241064368 -6.1784854869775074 6.681818283590732 0.70063690314244265 21.866062771038052 -5.8075822592457342 1.6991227590720315 -0.10155984987618229 -0.31345641660677936;-9.0714705339649218 3.0038603166999209 0.28648458494792622 5.8299857561649988 2.0775266407809614 2.0892933931431128 9.5538701509226662 -0.86938437192147666 -1.2568209471289813 2.8839740863410532 15.937186943716052 3.8975049613798003 -7.3329072978937866 5.2321706722756778 2.7967234489714592 -10.210897841326686 -0.75230300575089937 7.96127968135667 10.35120349239874 8.0586723131552152 8.2638233810014601 -21.107931841868943 -0.85828760944885751 -0.28115774369451935 -1.0323110262287483;-7.0897669662370735 7.0792196516728287 -11.528534833768132 -0.95096319998636825 0.96369781104217156 8.1649305482098384 -10.117820217929069 1.8848414853478215 5.6817655830437266 -29.675688612674474 5.2823092939512533 -6.3453628398524389 -8.389106329411204 -0.48552124821174997 13.813599212608063 4.8096376464372552 -4.8519840351925403 9.6436402489958439 12.366249816389987 9.8672409582082228 0.5191755603449032 -14.304166843783698 1.4867730625640767 0.26985136789630787 0.13811460624273675;-7.8958792719955531 7.442918446499637 20.573222305799103 8.5755135849023869 9.4485520357713213 -16.482925286634188 12.610639885197594 0.49508904530520109 4.749654575134941 13.391775445301136 9.7000774736963677 -9.4265164169605598 -7.6269580710997502 3.0869778457665147 6.0690658231698533 18.877473775039949 -0.55937124553930029 15.240139083667202 8.1835054037204475 7.6558799714437393 15.807744895744376 -12.118564805691676 -21.25149517180154 -1.806401828509403 0.25142516383969615;2.1989894898899154 -3.4100520465126474 -34.001589202909585 -9.6824637429385465 23.917298834609216 -12.376941680847679 5.4055613801688631 10.854729676092171 27.25613190916199 10.246569434919033 3.0842393240938302 13.05012148855257 -11.360703417475959 2.4654545319768038 0.76255846032339891 6.4749351332014813 -0.49452424877356715 6.7171168184932597 13.325750806966395 -9.8581313663076013 1.3115617615853421 -1.2717949597469498 19.173177014522569 27.440110879666975 -23.752153868708259;-0.4523960720796058 -0.83443888468987537 11.96833049697104 1.5730541515826344 -6.6947885151818012 2.5891146780842105 -16.608831432815442 -1.6127835119088547 -1.625751772356171 6.3972430843318797 -7.3075404699842323 -4.4398895837788777 -6.209413450318352 6.197991701214268 -0.37139233311047631 9.3749306771287468 -5.513868399813127 5.5104614911759944 -9.1421442657150926 -3.6956239810517313 9.1061265650010359 9.0104632891280474 -1.5231011082255059 -1.7725845846982902 -2.0835504644511396;-3.6595261277697699 10.40822228372779 3.5060928502965907 -1.6370823447885459 47.83783736152823 -37.343777427389043 11.805985102005423 9.4854390283611867 -12.953634321723055 -20.945341375891289 20.961573045623073 0.93898287812322356 28.159838208402871 -19.973536315753734 9.2911671041836623 17.655570135818106 -1.9243823448995925 15.405793711040888 -13.035531468054959 11.191985948663602 -12.097986937818334 1.3412212945555508 -3.1761577932643039 9.3635369724354796 1.0412382002441078;0.16357510904109299 1.0204436033903728 -10.614370246630672 18.277704873544778 -1.5021090290774042 -7.3982149759229827 19.818608606677103 6.0494979061244845 -2.594216819419231 -11.360457627563884 5.8232209010391447 0.040622764062252424 -2.1107938864358995 11.730719607346925 11.599163796773013 -22.731001701277808 13.547557470677074 10.418888901794039 12.400946430789464 12.355958443758551 -6.0099791843170678 -6.7938700603210265 -3.9026137188904224 -1.6982786044469096 1.9784430417662653];

% Layer 3
b3 = -0.060016218739372879;
LW3_2 = [0.00031930704244243939 -0.019202200435670704 0.0031253389900237839 0.017580720394178059 -0.71165649462950253 -0.013024094466380327 -0.067450181514558866 -0.08470188913568473 -0.073975278993313187 0.047116863592763084 -0.078272768262338394 -0.0036042879739664729 0.042798469401135047 -0.0097577244418074766 0.028900852197925403];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
