function [Y,Xf,Af] = ESPER_talk_6_Other_4(X,~,~)
%ESPER_TALK_6_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:46.
% 
% [Y] = ESPER_talk_6_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751;-0.9];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0584431850247228;0.0422119037568594];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.28217252747135152;2.8196548595921191;-0.26045789196382507;-1.1450730164152918;-1.4627583082786111;3.1112858301613771;1.5590625690660385;-0.92145158187373799;4.1541818616975075;-1.5316333787104957;1.2563850223675197;-0.26236206649661781;4.9414915401630521;-1.4229462343849439;2.4083583348307167;0.15216499708836323;-1.2239886180513213;14.743023934940688;-0.46249157483377912;-0.14251297631249324;1.1137543883018977;1.1527127085924855;-0.53647886861442529;3.1719388140073943;3.7952054985610517;1.4349823206063956;1.1239947553403229;-10.60973731105816;-0.80095601545338935;-2.7988178212667512];
IW1_1 = [-0.68770984949111302 0.18887022910833504 1.6352909248916623 -0.51573267917379662 -0.34855705911105694 0.73320414139740098 0.3018422783746908;-1.0511242830294778 -0.94423613816286733 0.62732506025905499 2.0590748803838905 1.6616022196291143 0.47780801397965067 0.47000358374360202;0.70945941718327243 -1.2011503573836677 0.15552007056323847 0.01926707602821999 -0.74391560964920733 -0.30982768978955211 -0.41957845864032661;-0.45707189991276365 1.6809894167400632 0.12455391206683969 0.2576869341789263 0.082937228901597521 -1.2001285479779777 -1.3875309772716482;0.38750464172843901 0.79904163263986783 -0.049054934546334694 -0.39231292777736959 2.209219975474062 1.1106296936977262 0.36433288570065303;-2.7954710888942711 -1.0024562033538675 -1.0498486558384492 0.16957116796300775 0.048041061762386789 0.048065265207824719 -0.81408235281738084;-0.33070001659030812 -0.3098949855848408 0.56913405475983769 -0.15437555939391961 4.057859756328126 1.876887824763301 0.77787452353910091;2.8310801042816807 3.5029902729251101 -0.018570640370871829 1.9438234285754363 -2.3484428939097297 0.66747790224417225 0.2640337913115709;0.16243107191868872 -0.10587166604646968 1.2001352831842753 0.1847025095884724 -1.5620877565099547 5.5373013817142951 3.9139479806734054;-0.044497809250907398 0.10156161435883519 -0.15863563647566556 0.42609544670632049 -1.307296531227182 -3.2010447214576767 0.28017716697799855;0.63004383712341583 -1.2618918047335073 -0.28850083957943551 0.1933464717690197 -0.42580420603936964 1.5385037979668827 0.11309966352036505;-0.48656191411928834 0.35705472802654376 0.087016712024909376 0.037700808036810349 -1.8373541920589251 -2.0737548896823776 -1.7476596714758825;0.12215286318992881 -0.015816741249648259 0.23703814940082221 -1.6355806828613015 1.4196786950113811 7.1916597138282627 -0.19549463024849195;0.22297327710785161 1.5750485107698513 0.015350757374517838 -0.78436548689153507 0.86335473688662667 -0.46348793079869061 0.13754373943571124;-1.080139295860735 -0.65226745653059948 -1.869481799532636 1.6927156920336692 0.71266898922311095 -0.027161598596590689 -1.4609512806531066;-0.42061974944991609 -0.24368891755300034 0.014051992569005646 -0.21383750265227097 -1.4729390704984655 0.46036482519022826 0.20886616097810187;0.15127849570552285 -0.12250746227210919 -0.23027914925257467 -1.7429017563175051 1.5612286434172096 0.36009865243688244 0.4754698955933207;-3.2549347274224547 2.1153048360679807 -3.6293755170381661 12.564782210457093 2.8531009148496924 3.4727066099664294 1.2820396501620743;0.085387551300439068 -0.11655122920351409 -0.37775394760021924 -1.3502737856184099 -2.1572915874938596 0.056561936418403319 -0.1615904655207652;0.70329724559093976 -0.61538508652145552 -0.16804540478525928 -0.58771073095757975 1.6210686942824808 2.1818612307556147 2.1507807518562174;0.19849208139589306 0.40838416044269044 0.41544308034441657 1.0445491923892818 1.614940313722274 -0.51985812453372948 0.28004515733738028;0.41617633905163515 0.88208656197494439 -3.7378846258163119 -0.38627749294325214 0.13705761713494657 1.6262362965104109 0.19947532926516057;-0.05646667943901567 -0.19149600387233301 -1.3870329702704611 -3.7212186946160242 -2.8904674909127599 2.2062626349714276 -1.2394596782239538;0.79608832648909922 -0.64696112147308493 -0.1375744409105219 -2.9268132426491746 1.734656010050905 -0.71919769201670147 4.162886413439284;0.21133437774207345 -2.4300239896654072 -0.79842680178039405 -0.58704729147999213 -1.6141969610085383 3.2731969435417909 0.12720272653613701;0.32909108427348488 -0.90519114543089374 -0.068373335704514371 1.3106183377600547 -0.54836408062994613 -1.1683002455895919 -0.92362377188580913;-0.0019975102877318809 -0.61468959607200957 -0.24933451998399908 1.5324236459174032 0.19337560433675396 -0.83877655944217266 -1.2149327906189642;-2.5654425156647909 -12.02489389050449 1.8078495468441484 1.4984729504830174 -4.534697781299541 4.181283556399733 2.7933246730087715;-1.5177879862414616 0.54111066626978099 2.5542560541150476 1.5649286631497452 -3.4498353442517864 1.7870755506410578 1.9584646960481511;-1.6274661725269062 -1.2089264584259782 -0.63953865866430848 0.3195071907643976 -0.74977393112533641 1.1019480469963154 -0.35966213067338515];

% Layer 2
b2 = [2.533772666952574;-1.060969487589845;-3.6978023544335907;-1.5955121678418032;3.7292003118576034;-3.1737456152571264;-3.7659735801234167;1.0663408192190069;-1.1684500287691895;-2.1774094747878081];
LW2_1 = [-1.117050627273116 2.9311698034530065 -2.6235009132843596 3.8600075375389986 1.1323132721074525 1.0751500747325295 -1.9348319381665378 -2.347973195921798 -5.349650388893016 0.35482534683625139 -3.9510018803248554 -2.7731731866394012 -2.7184805323160779 -1.3007127485304102 0.83093507443938164 -9.9478487165818628 -2.4866308508181421 -5.1026125390031494 1.3765154864036686 4.0542475958133997 1.473838058119546 -0.10084207253098978 -1.6869076018933518 -2.1520477587827136 5.4197845804084643 8.8758074355785777 -13.452279564917896 -3.0469034977269063 2.6251725786716897 2.8576206780270894;0.003884814830842449 -0.14482968396224072 -7.1723438031002757 -2.8221438116093691 -2.4428997515134663 7.1569303287737558 -6.0466397865013679 -3.0633728392424131 5.4867248266127273 -1.8875516804617143 5.0482375407619235 3.6795969507548243 -0.41676496600964191 4.4337396300963636 -3.3346661761394154 -10.341036630456234 -4.8087460553056172 1.1441589630957951 2.2658899260335108 1.3766482012295891 -6.8332066238245659 0.42219308814594164 -3.6791711907746101 4.2611849889836497 3.5702190592699345 3.0184567344850159 -0.32618003884387708 -1.3622818831241288 11.14161952652319 3.4548051535320545;-0.095927790363638368 -0.3392603159266846 1.3623295836135862 -0.6163601336255109 1.1831451685767875 0.781970483291479 -0.72433318029948257 1.0943822526286913 0.40967966688382346 -0.3357792628947992 -1.3952409491666997 -0.6129296159346318 0.10597229095616341 0.51773133929656923 -0.69057679486248535 3.0338481422021952 0.72615940891869046 0.071065433799686231 -1.1556854013920623 -0.017635490588306747 -0.28465370716715249 -0.012635215062274715 0.65323823875059561 0.59369927651039889 -0.49490666008762413 0.78566227607650241 0.63146314842011442 -2.9948528089931967 0.37553868570491655 -0.97456224806559344;4.5382739605373725 -1.9869436615207754 0.33551885356781352 -2.1357998069734179 -5.5996981015346687 5.2741316247594083 -0.19124521942949385 1.257123670961322 -0.7662289349705107 3.213872332627548 1.2669722018176717 -5.5312654878945171 -0.72642442014480291 6.4470828962874149 1.662925267696411 -5.626734388901748 0.77082468928043746 0.18765241371523042 -4.9653664501225334 -3.1985937085030045 -8.0800305555099268 -1.0412913244170126 0.13035511906644104 2.0026645218480512 4.7016192888827995 1.1459385890002485 -0.19946446980363572 5.0684012727401626 0.11458667633899863 -0.62005591656038073;0.1997444309521666 1.235943972539753 0.88341765495966429 -1.2541261036932392 0.39744354914135283 0.019466133533403537 0.46082138226143798 0.96445846248033873 -0.075317618867661779 -0.41805367791449427 -2.2115610818297649 -3.5230759032374777 -0.41952091017786686 0.17740512543606587 -1.2687663738688351 -0.047879311821141413 -1.466520748514035 -0.15250599771763237 4.8287318601852629 -1.5295617042624687 2.9330899509244253 -1.2266051818038703 0.39187905879521934 -3.25001860417931 0.065307047041163996 -1.8283397784961013 3.0980811317872283 -1.2709145431811952 -0.6711038065027487 1.0615902346428241;0.82472112083498172 0.45649064324859756 -2.6800108455815912 1.9901862022387116 -1.1254003979576888 3.3270688313944037 1.6042825886527479 0.87035415135364846 0.30192716735317099 1.6089626470056033 3.4229236724654886 -3.2955299081466132 0.45020734301017817 -0.2233313309228537 -1.2771514531334613 -3.0583650373872437 1.2820538293127568 -1.0891607669927732 1.7881161758233011 -2.8613022209055914 -0.26966480925249647 -1.3879840893097595 -0.43552612478123026 -1.0005448680619402 1.4369282436417039 1.4549031703266802 0.56100010505590314 -4.228927101967459 -1.4346510391129028 5.0488130092476879;-2.553583850805015 -0.36275368061729374 1.5064830568978909 -0.054563641536981844 -1.0721482692178232 0.29562454722857384 -0.53496362718666302 0.45297083653217252 0.33957029641741632 -2.6655665320407693 0.081891464356957128 -1.7244595807128378 0.23227929866121044 -1.2583473947197126 1.0969217711210006 2.4919221642979563 1.2008651755118225 -2.4883307525723635 5.1308757450391456 -2.2307098014572357 11.904361838961123 0.43667478351956224 -1.0859121562035439 -2.3507238405588762 -1.2825182059882527 -0.60016646910844473 0.64160000646734283 -4.511975894371612 1.6509516587594919 1.3685209591737142;-0.24386033395775503 -0.33671937123737317 0.32559078205308106 0.4384670955960468 0.31342607539693473 -0.12319440339620803 -0.59697742782361041 -0.18064539579072153 0.57940581946387615 -1.0408321478540268 0.65299979952412979 1.2645727746167619 0.45481434243240232 0.13678629359581354 0.55981745498351843 1.7963989452259865 -0.11541839014265119 -0.083559101874514222 -1.0418144036672623 -0.0086186702310182568 0.0064243543156894192 -1.3064720767192026 -0.44471325830287367 -0.26984055041636817 0.062366815102289731 1.9541704375466493 -2.1139464913444392 -0.5673092688680581 -0.40845975184039224 -0.43806802150892449;-0.024542890048248917 -0.46592749535282502 0.48980577087974547 -0.16044085064619368 0.010687412662816267 -0.064450851144077073 1.9773890311853211 0.034366132960807309 0.38204121678632119 0.22539654955134844 -0.53700741164592158 -0.38969825502611743 -0.23597900716587944 0.21651000039007529 -0.11436184680321188 0.57683063938581547 0.72509878761344104 -0.084531722367792245 -1.1711692311720798 -0.27125078379524276 -0.74492402519542378 -0.11807514880663793 -0.052306414649269058 -1.6418177132035858 -0.092998567840195792 0.21644849629707777 0.14416519337119005 -0.58938076222635127 -0.14417337737586838 -0.45508560679459181;0.28813620170813276 -0.52107597221014867 0.38675908921458563 0.37698630386882143 0.26121623404394834 -0.1606462752495765 0.19736828262494222 -0.081231523202575831 -0.079797694982730677 0.013235540795155386 0.34099989921455992 0.31555585829659361 -0.14906163928931959 -0.43209286849897599 1.105741676019149 1.0188271825074044 -0.041791420947901163 -0.0012926158362737486 0.62085519399770361 0.11233171860415604 0.87946465672192931 0.16093251874356018 -0.20671922101114751 -0.30155521640390404 -0.15341556677698084 0.37046079151654726 -0.83220683212259117 -0.26190720400746165 -0.027802264300022368 0.65846333448294503];

% Layer 3
b3 = -1.7097010943132751;
LW3_2 = [-0.016093645745900383 -0.017076437810998015 -0.22502769525510205 0.025916691185512333 -0.11126997035955782 0.057573024269407039 0.035873820044237607 -0.20036726324751802 0.81257961840478177 -2.5075326543849501];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
