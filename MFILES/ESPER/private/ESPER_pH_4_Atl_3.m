function [Y,Xf,Af] = ESPER_pH_4_Atl_3(X,~,~)
%ESPER_PH_4_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_4_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.8998643193361877124;-2.0208809554020135124;-3.5213374000776638262;-2.280980250112998764;0.31031799952595939818;-2.5836605977907858289;1.9328883941429992888;-0.61385363891363253774;-0.31170359104375711112;-0.39361954447197833318;-0.10646418704507699948;1.0129437558278626685;0.45167993293608554861;0.20865649831794585989;-0.12456998423903148376;0.4488672064799906769;0.52910089980558761003;0.22524097613176330412;1.0453336939613180334;-2.2849363667765008046;4.7053562833819571054;-0.94044256933602032866;-2.3192904739169484252;1.7125939329047481507;2.8478951384334476593];
IW1_1 = [-0.39582439430748450615 -0.56123766220556636775 -0.60834342823129083921 -1.365382889054469695 1.0031848845885042998 0.89403810375797942989 1.513219699674977603;1.0223182531435601739 0.07960481200175231753 0.23764731186452786593 1.5922208658711884954 -0.6751564676009667032 0.60468471942001422725 -0.5705001393996610437;0.32280288050247185616 -0.63446412115888439764 1.7309641845447631958 -0.1133847734733976903 0.3327233482202864856 -2.0346515682701165062 0.89182184945143327948;0.031896412654888371685 1.1213707784997499761 0.031896625263913506998 -0.51837921314699009212 0.50003039587756825668 2.3036963436586521681 -1.2505469694586530682;0.88101010156757653125 -1.5265150765114923193 -0.72936583138700694651 0.62962567940744074146 -2.7251971247116402175 2.3325622254201210382 -0.96608620252121624183;1.2131101017264036557 -1.0848401737790418498 2.4683279771760715526 -2.1237428723614724113 2.2389790102535513938 0.45257223687817255131 0.73263452155774133612;0.028697939075261864883 -0.40752354672130980395 1.5373396299722208447 -1.0156383422062194022 -3.1208882379908384763 -1.0467465313204300514 0.65383070625816364085;0.31187100596691536003 -0.76737860790593748206 -0.64042875593237502674 0.96622900335264128024 0.0012859227897294676912 -1.4208066529954028745 -0.56162170185357329633;0.84578385642298281599 -0.60674379062165850751 -0.94169169206059766264 1.0553435233425429995 -2.4780605970200269006 0.54464929699696695842 -0.38550056377672725638;-0.75264293824721839599 0.88694483633343779161 -3.601404358518467852 -2.1957723157944073478 -0.6485176895737169156 -1.1017906208837191517 -0.40003996888520554354;-0.31506120520914360217 1.7279177263058438374 -0.48243545049299535465 1.288757564242198228 -1.7150710454890241152 -0.85870305974919935998 0.79631331769654600805;-0.23908367391178550476 -0.77831588385371386352 -0.96692134832672471667 1.2857395101805846327 0.73070817312862412773 0.97312054837319128531 -0.57770300901151705464;-2.3312873944721324015 0.86156327782105379676 -0.16443307920189631499 -0.54527605629112474439 0.960958237479636046 0.2424160183289953141 0.46871336275564445817;1.8688606783089964924 -1.367087735962401629 0.85409312638225598491 -0.58532479121022618074 0.96388240473040553979 1.4712123941506012326 0.71797777901137671552;1.5322428027971095599 1.139388558126261719 -2.594570548370173757 -0.4582417302616926813 1.030973777345805642 -1.0716120526382533207 0.94075404314455257637;-0.64229891857692378299 0.89596858278136415343 -0.12303078629049860049 -0.67332622660524266145 2.0875056056776961633 -1.5581795262508635336 -0.50103069124306964799;0.8628850697233237943 -1.2985707580877714484 -0.30784490253613072674 1.2817598047985048204 0.42058408803369612405 -1.6297795140913642342 1.9075818548850114187;-1.0906426796284152125 -0.42420572712188697739 0.073534716737024274913 -1.4053340061468315714 -2.5586489526435256536 0.36604998181316339423 1.0573577445692896593;1.0907437974555787008 0.53419363124353336225 -1.1068288166985515986 1.4724547806877750222 -0.82248519446897327967 -0.9155703323257341486 -1.6565767049337527528;-0.20417172873231126395 -0.48787410361306177142 -2.1905241029492237281 -0.4414938497172883336 0.037086209385187515752 0.69157405526895043835 -0.44955819357800042013;-0.055656584140112846937 0.18893111067972911954 0.75433457341677923047 2.6808651152302971354 1.2609026115327541806 0.71485035649154882176 2.0552413210245199515;-1.1557308004647210975 -0.2400624817639425701 0.096862917940939971539 -0.45944093221673298899 1.3137168032090005276 1.2531884076087145274 -1.3962204072271087174;-2.4696005206787878805 0.033827015661210470265 0.52550365012336852644 1.0858702135563165214 0.00028627002554200073337 1.8655936938782660128 -1.4807545191014461761;2.2754077859611117063 -1.3971279092800872323 1.6075015816651609946 0.34595544689173429731 1.3619935620050187541 -0.2011880255123698058 -1.3709650520337102186;0.57005725328726397638 2.1727069591766814405 -2.1522909651097874573 0.22084570583855975268 -1.6859780811609714757 1.1101074785255147237 0.68048545950988370556];

% Layer 2
b2 = [1.8803849138691195453;1.7945247678020124216;1.1276164100755576847;1.0124364102329348469;-1.3470907969789200909;-0.40983940144917241355;-0.34969180938428623406;0.56207666165057501573;-0.35310094414824294562;-1.3202024704933663646;0.88660298520215674589;-0.76154334638759102472;-1.247215693947402837;-1.4506941330417038039;2.4711923842703984455];
LW2_1 = [0.35619848604555937044 -0.52968451598160815053 0.37816533395654572391 1.9308697973994148889 -0.12621196387622857227 0.57516671258901874708 -0.70650034662928484774 -0.11702230444051631153 0.20041611298809031139 -0.98221511122402960225 -0.47402789375710763231 0.74505707899427420227 -0.04710174007140782021 -0.98003042202516332804 0.028686312723103749023 0.95121550548273581249 0.083797325146892059911 0.38562146991864970635 0.10574614495158132788 -0.87323647254578640187 0.43993258750122854472 0.12340415349442812598 -1.193696595935028304 -0.79507452539656575663 1.1313038995547097798;0.03706171561378085455 -0.45947678580211254173 -0.60197695571685139182 1.6313444669096479611 0.21661643639546160345 -0.20334146688979806705 -0.75476201973609424734 0.51868554117787035729 1.1888426566341268042 -0.38768101720379433139 0.49234256739169585115 -0.072898277715920431485 -0.24246461902892779694 -0.33254961498582380486 0.37054496935132064106 -0.21081372824552313539 -0.26709503618106666956 -0.011951955237741295618 -0.048684441924600252438 -0.071520376593775816798 0.84477165586437885647 0.59078627874569078493 -0.46212755528664412052 0.82146311086684387082 -0.23699832508771065398;-0.35704833942895453092 0.17003148014998664683 0.27792388306712406676 -0.53618819193854461158 -0.33280142331297812852 0.23189591507712326024 0.030884921539780486877 -0.19672303348346906193 -0.10515007876483514759 0.38268378750597853433 0.66166796898235680224 0.069728230297987095487 -0.79066422099383837363 -0.34350599135520953897 0.080342130755850255097 -0.31582546673934719372 -0.95436843868241416633 -0.6615944483557919531 -0.97205230565120881447 -0.4603041503904232723 0.83631200664870763983 -0.017933114680315203476 0.41223809858714599574 -0.35823116622709866297 -0.15667115304112064211;0.3100963791014210158 -0.22742726737026186523 -1.0226994850755990463 -0.68264192002379386892 -0.28691801037306302602 1.1754259696835920312 -0.75604201765831269277 -0.54890883292801906368 0.12911520253789510182 -0.056702251975961771857 -0.21504082251712705598 -0.15998454262339070753 0.0022221716952281773266 0.20821072177107605161 0.34221968515627237961 0.070980035531958002304 -1.0586735146527801454 0.82867595442790387139 -0.45778227860116510461 -0.65221293967336546604 0.3072694084901948508 -0.099823489162982531608 -0.86516451527658555509 0.3828970269782843161 1.4204623724726388456;0.48969856407801759524 -0.25904009565075747368 -0.95789022553000535698 0.63983969472921486954 0.32103027318720001038 0.16181946529072407936 0.038874185431075826413 1.0111768709284150169 -0.20333325508140087656 -0.28496748179531455891 -0.91883460524932869529 -0.33907021702794937212 0.34465302682344489682 -0.93234912624563681671 0.039242772446924353846 -0.17728700577124992255 0.99270076731326195585 -0.10444769712299729891 0.3199104918897966443 -0.070266951022186066589 -0.7344468323591418768 0.11463393042373676289 -0.94408952187617167784 -1.0681994816258095771 0.46742325183078459183;0.19722138278650191978 -0.24186630882622814354 -0.040715381457144525501 -1.5879975388116769341 -0.93092647908602310647 0.91318676777817042733 -0.033693557571317221677 -1.6184243847540555894 1.8177856799006746336 0.22459144439646833158 -0.99739962390058556352 2.3947923455792912151 -0.15655468588633822402 0.46064454452043540611 -0.34586511001995856596 0.29610482099918217225 1.8043909383497465093 1.6617023788144658081 1.3167374283449111427 1.8152729518649646234 3.3102319588839215214 -2.0061658124793186886 0.96765239200631636418 0.40859064818415902209 0.55903294555606719562;0.3371615009619022274 0.50385150774499620763 -0.17283517678437834708 -0.58684260803244292504 -0.50203592425774967722 -0.42972831018332696695 0.032208057813098663058 1.4638670101325117479 0.83681650706216781366 -0.21320783791932862439 -0.011009959983633762701 -0.097881581629944924838 -0.022642638778467432531 -0.2969268448690026152 -0.45894853370894911349 0.21669695574456937504 -1.0908432781070267481 0.35101531238451455508 0.20154922525635579622 0.061387787239802107941 0.064325796337731347418 0.44712577272489811842 -0.30537065003563351739 -0.28035037591714390137 -0.49328231639164143996;-0.027950924093624943123 -0.72600815432696064189 0.59822091700144508497 1.4987605146417606328 0.21690934347114013137 -0.49489952476788440228 0.27748185945015674259 -0.20704988194468429419 -0.10231226129550287374 0.081449339672901591158 -0.3271677212192904971 0.38635876674527591668 -0.65124930772226130582 -0.021654914320674577971 0.025615946907165745849 -0.16574606928883883761 -0.61859098357468644824 -0.56071347420298367492 -1.1530835956314420265 0.21402128039172488294 0.61119257756929401548 -0.25770923367010023508 -0.27278289991205922904 -0.2197797782944217182 0.38708991789691826746;0.29957181701486529368 0.69162451995420282103 -0.097947322475482379023 1.3387749889474622744 1.380079372353330891 -1.3803947701728105368 0.7771090867406059699 1.334354369245032812 0.2870121837764699757 1.7138833468585679132 0.27436454721369346599 -1.3766628977650441357 -0.16194036302948106032 0.70075999259979693257 0.64025458963839343429 0.3595706770921691664 -0.43587302730347743385 0.018687233588593827466 -0.43018643709278153731 0.76602105793080355056 -0.094730926765358228203 -0.84420681010672327105 -1.249819739027358878 0.18958297869247911493 -0.91921989502455525578;-0.20056233269481715809 1.1097900697574465401 1.0567374317221243096 -0.22834866782872659252 -0.30791311338880594795 -0.030638332544238939398 1.1583510421430354143 -0.92560338775384998211 0.1242092608913966667 0.85959738621912884504 -0.70118934776944652487 0.5262472111413176723 -0.57086357871835635702 0.33176431600518496712 -0.28741170282377453971 0.4580906953614208299 -0.29137256637114206104 -0.43856543986740659236 -0.86207451127319900674 0.10098018506774247838 0.92348661736400305955 -0.30386302264261161321 -0.5266533790935602477 -0.7942101517592931037 0.29713550737047855765;0.13674741143745122729 0.1732048268627363885 -0.4416820041058013846 0.68859345029905105751 -0.83530188887065204284 1.644917413125737804 -0.91318479584168088525 2.2358397922099020327 -0.49385352581939917505 -1.753306186091691421 -0.32878828974522950057 0.012277536527325577653 0.56683554454442308668 -0.37858268035964387499 -0.71914772731913556569 -0.15534631689258757148 -0.41252003552538207831 1.9488415742155362764 0.71150262042566980725 -1.1109981363212435568 -0.15927528698963683285 0.59993577981387768983 0.0074046644480381604292 0.552050168610021319 0.95221098392603320537;0.12751298955518594602 -0.3002325042886502815 1.0509424643503191277 -0.090835688346525320092 0.18620945317330911406 -0.71191252227824286525 -0.3231010563815117087 -0.39031753426765714021 -0.20153898379792134499 -0.054506287624053711971 -0.14429296690689349947 0.54065560789503819272 0.17433424030859134835 -0.44393447044333039786 0.072459164902220207782 -0.18427285583910976707 -0.53920562051774878487 -0.44444144892147841031 -0.42363635422953632714 -1.2473462293741579554 -0.88342097600176328065 -0.076976353159320942687 -0.45771302917380363162 0.48023707701702783579 -0.21353417654326958819;-0.2798859337488012744 -0.39521313685368331114 0.079905526178538813231 0.57960117452558646001 0.60414851713363648678 0.39780162961862763904 -0.49603199357792793212 -0.14118815212954333171 0.0036634655641536104098 0.64791985572539978477 0.27365753082286459197 -0.38141859347618045639 -0.42450133815094787115 -0.52500659683350092699 0.3840223539988734669 0.24073514437064899574 -0.19315322713162305646 0.36811038845493393445 -1.1624088358931845555 0.32993641201870615998 -1.0305787515129773979 0.368723516664838602 -0.15056304309740556335 -0.01605364579602507058 -0.0066939332413638516495;-0.46850831907671952603 0.040690876179449636529 0.32089240288509462973 -0.13775293341594385677 -0.045783970210160014613 -0.47725503182085471376 0.8401040906833840971 -1.1872721229583846902 -0.86095838108817912548 0.7896750247472346107 -1.0320991359887132788 0.52889332617704309936 -0.037557165520715425633 0.17283569229250370092 0.30975107763883186207 -0.69387067924460654744 0.18070818247364428544 -0.550882432281440515 -0.29675042905470322419 0.50946971712581778924 -0.73820049287593181297 0.16250440838969115731 -0.41196283511948977862 -0.45517641230778116412 -0.49147766839252954307;-0.16199266367519132848 -1.0316037293147066745 0.21014492984255603303 2.4336095382555114064 -0.14069468253090366971 0.22808061705390234031 0.85679126297506214005 0.50133244415638811287 0.98579557451548915914 0.28834012063411762483 -0.096664617510400757672 0.036817284277477636822 -0.93433742294324950706 -0.55651705607697676825 -0.34435369959892858649 0.84279562891294235172 -0.37119620143886217223 1.2281938339822731088 -0.86219488230127727668 0.41496562806316567018 -0.071987818042703044519 0.042439110142354671829 -0.022898182155997693493 1.4858991015866040986 0.61652845017264368277];

% Layer 3
b3 = -1.2324191158242010502;
LW3_2 = [3.2174412524578657191 -1.5383450971042114119 1.6853182922648921593 -0.36943962478219888323 1.0337511479904613054 -0.39896411542688781093 0.74231583914332499585 1.4535440419317358085 1.347376849752784933 -1.5776156783259813743 1.3006233689498518658 -1.2116143035385877891 -0.91144813973711180655 1.9203966013054316608 -1.1297517710713027572];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
