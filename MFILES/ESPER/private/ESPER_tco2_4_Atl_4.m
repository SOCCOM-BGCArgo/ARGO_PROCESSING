function [Y,Xf,Af] = ESPER_tco2_4_Atl_4(X,~,~)
%ESPER_TCO2_4_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:54.
% 
% [Y] = ESPER_tco2_4_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-0.12];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.5161838291318279;6.4553384918336247;-6.2473241408268221;2.2965501140819433;0.94044491610865799;1.4806289351376754;-1.0213614067576575;-3.778224362973464;4.9580616231185726;1.0638345009820902;1.161914794492648;-2.9915630863625888;-1.2525397784921664;-1.3517121887800272;0.30096274743718554;-1.5978862609353304;0.15293208946785786;1.2863292870753753;0.83860048673594578;2.1591750100881715;-1.5328059620957919;1.0564826018129738;4.6330706246795286;1.7755433815677855;4.234124766124542;-1.6056415225095646;-3.8759682609019315;-2.575236587184524;-0.098068237042492484;4.6056232632395204];
IW1_1 = [1.2605433846088501 -2.7282396390344967 -2.6595552104672735 0.61232657221274434 0.27505988701514944 1.6708872303600364 -1.2916972459633771;-2.2081287092528599 3.0860517440275617 1.8856807562869646 0.26457673318662772 1.5876469633159711 3.5736299840945822 -1.6595863575956116;1.3258379981501573 0.14063173280167646 -0.0014069493874437084 1.2395799207045377 2.2168855229563991 -1.5652635053839963 0.026409638671194113;0.99657696683240904 -1.3380694816105401 -0.62356906174922966 -1.2362720397000615 -1.6886558467584205 -2.6069662057050178 1.6669709475323324;-0.81369428226943419 -0.78679289058669966 -0.88587288913695772 0.15200190673351163 -1.1984344465948376 1.4683781576075763 -0.042563624497497482;-3.1034120701511174 -0.10184118343790839 -1.9162641218110743 -2.0461151128956288 3.3185964462745114 -1.2128795066543001 -1.5023054455916418;0.60143940006917451 -0.37523266912671843 -0.33975443477460288 0.25426012387979002 2.134530169032697 1.6129632968157472 0.038590074413845044;1.7735038392863467 -2.9886236347474884 -1.6314781108129088 0.53583754989782972 -2.5979375724298839 -1.2446001129581794 1.6048429197355807;-0.014043502769582671 -0.50410767131105105 0.41686748769202231 -1.2695590909254959 -5.9178774306152171 0.64519533855101896 2.5452670078710433;-0.034526014498845209 2.5281815884313428 -0.088580500474040508 0.78112023574530909 -1.7295359604496847 1.3806637047700345 0.60457251008271995;1.5003054822076534 -1.3368108010604376 1.1528989840179744 0.75911798146141973 -0.35603778152771176 0.15242345382890821 3.0531914487144296;-0.97411499630622411 0.78522183312526139 -0.37278179077865498 -0.59624980337929179 1.0963215406122662 -2.354680513981771 -1.2235296845167545;2.9611707447762683 -0.63597750468732694 -0.25408881993352506 -1.0895765637633776 2.1217486036102358 -1.6825827373063311 1.7125638891056776;-0.36529450143751924 -2.6329823506801224 -1.3047303973345143 0.75047931521789024 1.5276530325880413 -2.7033076024821763 -3.4148111169847764;0.34248820010056596 -0.53002353422995274 -1.1662939433309336 0.18348046159601278 0.51113744062560995 -1.0964608767467618 0.59366620379549218;-0.4824787467558162 0.036788345814461276 -1.2540144158185058 -0.56665864016206602 -0.57955787385693758 -1.4417753881538022 0.44701305465993302;0.67690735560772941 -0.042014019534494462 0.15066134709623619 0.66555241876483751 3.3890482470435641 -0.41479377677440288 2.020538470852749;0.025571692507401465 1.1121771321561553 -0.55562973014563344 -1.6233612002012205 -4.3427872475413674 0.54389552613155823 -1.5855832702511097;-0.66438340066430246 0.51864978806741879 -0.14991570457191197 -0.20092942186096577 -0.30292293346699894 -0.65575262321690375 0.28934906304337044;-0.64372139861401745 1.3873229447622206 1.9569704139055557 -0.06430968062837028 -0.5071426656121919 -1.4416442205373465 -0.58802931768127598;-0.80282251575286689 -1.5608067642433572 -0.18335936423899754 -0.60175843419337904 -0.084824793199803614 -0.15033720036953679 0.040833843116797781;0.47553524894674271 -0.28512959694354179 -0.25096102111083762 0.46483746446434204 3.1693629851559355 1.9022223261945641 2.1410325201366396;1.2797498776960381 0.68935650034889906 0.93241681018040823 -0.36709441597725823 -2.8114459463269248 1.7543228725152131 -0.98935205745475885;-0.66782094877992648 0.2067223351124442 0.87409876749413418 1.0796059975084484 1.9897088595774579 1.5511727393668917 1.3730927402209532;0.62620609790531956 -0.42561093567930297 -1.203841465714103 -0.22513541316935293 -5.1659188697026357 0.092543900523938544 0.059647444480033764;2.9179903133878877 -1.9013446334112249 -0.76568947874727222 -0.55294487983499396 -1.251585918666392 -2.2560912849918529 1.4408472392580756;-2.8736872061839556 -1.1170591042073901 -2.7854439410224296 0.60295062878201278 0.086000855248028141 -1.7520900121451599 1.2887947116608447;-1.5193339521526987 1.9571772524083588 1.0930042582999611 1.7282343357468357 -2.9660807991816629 -1.0752513839539348 0.69537836059050739;-5.5003748865782525 1.5038634810949074 -1.9773784222648862 -0.013609928377005085 0.72941013936811139 0.62077903839843229 4.2440594439976662;2.6330996910786792 2.0664457638136344 1.0391955909175494 -0.39887322500520933 -1.1572649628952183 1.2634652327623057 -0.060890464516905767];

% Layer 2
b2 = [0.20303290734669954;0.37811548752225671;2.1206798883214795;-1.2277118108966059;2.3542360120913379;0.92248751420491593;-1.9120038712988312;-1.3239165294895574;3.0735505981302071;2.7544437476429864];
LW2_1 = [0.53130579688153112 -1.3207448869509011 -2.4714201039318215 2.1399808080893097 -1.8538313543042535 0.50078561269880839 -0.011529900186797424 -0.8801513757643662 -0.79504335754589994 2.7398531789943461 -0.85713954705949924 0.51319655423867516 -4.0622915649314262 -0.96734494124038817 -3.0258836719479314 0.90317071204177801 -0.48846031525488687 1.8290323254579646 -2.1225482385017553 -0.86304970400897552 0.077015490026832376 2.8603606490327533 0.90086870774100469 -1.4342773718608817 2.4658960585007019 -3.5771837090172944 -0.73771185619556268 3.4492161110617392 1.8253331006225713 2.3336989127328724;0.89901811118500485 0.27934384098925491 0.99380232059434503 -0.80264158425419208 0.42700837196342561 0.048342066908121921 2.5282405099572909 0.24854705237971192 0.24098231363544267 -0.062155611462209479 0.42497871040487772 -0.33345654183506523 -0.29859277463166572 0.21327980845577552 0.77519892764216469 1.7642628123651714 1.1351878668203224 0.21018285428042752 1.4199024318858771 2.6361976772617313 -0.039701256519862324 -0.98044964346057739 -0.034890546097726266 -0.23011540134967282 -0.41544583837923388 -0.60863118005361505 0.71073729295587806 -1.9470149024355208 -0.25570921728823642 1.7944743738863211;3.2746487074058646 1.1430028241667569 2.1257309046550157 -0.27026419828015891 4.5787963192032608 2.5056039711767273 -3.4141453588365791 0.0039586530100498875 0.37699974844675921 -2.9351533022029193 -0.33647653032522662 1.4946491519507783 -0.14434352599701672 1.4809402986822184 -2.3171607680306598 0.10464149188004504 1.3588083911132356 -0.73363104515058963 -2.1591191853652449 -0.019720932926278745 -0.045166889673046273 0.0081441369601917557 -4.5157970908934075 0.26162594352803981 -0.68590107521579302 1.7144740823321356 -0.90768636204311848 -0.86014963174860415 -3.5138879706628088 1.1006249624619449;-1.0038527607319587 3.7716366727186723 6.4786609528290535 1.8262914382105622 -0.77812676860931496 2.7218801450129169 -0.53154805498898861 4.6623866243693151 -0.26888523912917273 -4.424132127162359 0.73783943587425904 -5.5833946307909947 0.8068307392479841 3.739764239995119 2.3644104098881993 -2.1523629208931974 -1.7567795298475666 2.4347463086724139 4.2737830673232677 -3.9998193254751149 1.8023123774662835 -0.62931697489179828 4.9677677960361173 -2.2724669138708395 -5.0744492053651244 0.10090680752434997 -0.99985640458266167 0.55588525611766637 1.4468793378206861 -6.6931958533542693;-1.9762680457296327 1.5226781395931235 -1.962316137929234 1.6106841976690245 1.3912880844218725 -0.1022231477349832 -1.6267591601146516 0.50316357422084934 2.0510184794517587 0.99135877568748809 3.1218705000656897 -0.82070217408268475 -0.21069312570732363 0.064500216655950265 0.22190500672384877 0.11376275514091755 -3.8033859444701572 1.3429161288154066 -0.22268027391469569 -1.5754425198868092 -1.1122758464777944 -3.6704622443219312 0.80145381127794391 1.4991369232970142 -1.4313831096877407 -1.4725513858859427 -1.2750254127927925 -2.3168030689144667 1.6008548508496381 -4.5730088066251335;-1.5147564808860667 -0.092186557030233873 2.0089162182329043 -0.66017604738144975 -2.0551083178615364 4.4824940077883264 0.14098370669787885 0.39371388847576783 1.66663329840675 -2.1824410803214014 0.98179391713872333 -0.62790882075584742 -1.0787902391929634 -1.1005123278869822 -0.63069897151450449 -1.5756371428696785 0.15792690976381263 1.0102693615811167 0.70716979347940445 1.9185018430523939 -1.0968263779738157 0.72543328467603296 -2.4098619257347997 -0.49834973937772986 -2.9906452711690692 -2.9977097059952382 1.0541949776691524 -0.4531996943471191 -0.0091309152991229242 -4.0639937532999451;-3.0335949138890617 -1.1444021191941181 0.99661223571378388 -1.2069195806070903 1.2202986240273865 2.387529701524346 -0.44769177488427153 -0.29173818626953774 -2.5664771769455683 -2.5825339052024794 -1.5005450103948033 2.7545056854743617 0.57865058955636628 5.1719132515473385 0.66568081251456457 1.1944946933788811 -4.1556040602522248 -2.1183342197085646 2.0118863138702907 -3.8521445679323629 2.3455197605728006 -1.2455788810564186 -1.1359878441715405 2.5820471982556858 -0.16050817664717071 -1.6721948939888112 0.59406025242757576 3.3926240460172816 -0.9432548740968506 0.14190681337942518;0.13946587439140007 0.33531929538412475 -1.1228957268436102 -0.059926248909651474 0.74925850957834772 -1.7528947889982753 0.59583818085843943 -0.14447240018501656 0.15133290615015244 0.27709459819879922 -1.0651899230986293 0.29241021218891217 -1.6178734166433864 -0.91279856709190921 -0.63208526401267018 -0.44909183605539504 2.6806026174529709 3.0748659934198672 -1.5459545012565634 1.1189049077758437 -3.3822886757614645 -0.38461629992230884 -2.8855793870761568 0.024787384735966048 2.2887067870298399 0.43196627563235596 -0.77664911168146356 -0.076262235541839321 -0.3811736295874088 4.7087953904522371;0.39076954618136062 0.52725012726116816 -0.69800894797029789 -0.045172999170372777 0.27761479570113806 0.15758571971705981 0.65773610831378759 1.6534385215095984 0.73353092381564922 -1.7279766540650614 -0.99014259074259003 0.032849854547699439 0.18622812079305853 -3.6622911248493413 0.59095737453899666 -0.069867805344944273 -0.033336592305230249 -0.79360330670673462 1.1993969715968464 -0.23421281220034179 -1.0781809724561955 -1.0342930009496489 -0.043928902304040882 1.5020935479235025 -0.48560350279237047 0.62180425974172793 0.45793505627379616 0.062196595601187676 -1.3138891120702585 -0.21528087772191892;1.2411381164284598 1.086983932722895 -1.3458990606090184 -0.21922546706148718 -0.18025743529472465 -0.42451337511860188 -1.1264774264105852 0.80756715809059554 -0.75482006517386957 1.5537823722626545 -0.14260919499578517 -0.30250628256222106 -0.109344432986548 0.64892455717137043 -2.1877786624116418 2.0385503317825848 -2.744367026815544 -0.59735837003632031 0.83918152268943635 -0.18626354929965827 -0.1896391088641195 0.59057326234989094 2.0191408791050036 0.63353553721629241 3.7887681129013258 -1.8191270554372108 -0.74090763535243553 -3.9864849658659836 -0.94247440161077978 -5.6773220935230944];

% Layer 3
b3 = -0.14859505804597206;
LW3_2 = [-0.0066477792278776555 0.41754784605370404 -0.033525584908784593 0.026227849345041208 -0.019725749938308376 0.019832019087649432 -0.005982381189032846 -0.0042445013309874297 0.58268882246611597 -0.043004792637313459];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
