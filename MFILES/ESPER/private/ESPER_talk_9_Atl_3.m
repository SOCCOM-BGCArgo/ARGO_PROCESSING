function [Y,Xf,Af] = ESPER_talk_9_Atl_3(X,~,~)
%ESPER_TALK_9_ATL_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:48.
% 
% [Y] = ESPER_talk_9_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-0.2178;-143.241523403244;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0479365703301392;0.00458552991639557;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.7388560542034712;-3.8489217749563847;2.9859453531022817;-3.4555503477028475;-6.2010601295984529;-1.5555404590508235;2.0752499445753942;0.55137410318602198;0.35985460445446121;-0.37275875825389732;0.46826748481809022;-0.27471230166429317;-0.11857689297928695;-0.42726825743063662;2.5727356363200853;-0.91760693038984831;0.98898349170349553;1.7007906231689089;-2.0621384946624941;-3.2776797095563017;-0.0042375510884866963;4.5256152970799635;-3.5651263357028125;-3.1012126395110413;-1.2837569490842138];
IW1_1 = [-4.0324539573186078 -1.5730062267927505 0.76513293460121146 0.27221503510415596 1.2152802496564235 0.67654103186822512 -0.43439555479685443 0.38312919880278623;1.7244153451154607 -2.8302106682776071 0.041744229255236062 -0.16343553870057043 1.0231065677182785 0.046661316736315094 -0.43728193962570294 0.9796810167804183;-2.2486842966725655 0.34434876727430425 0.27085864480171873 0.36486970905444127 -1.8553275590640423 -0.69207432094897325 0.12385768142730154 0.079637754438149036;1.0373199477757713 -0.70872446261108357 0.47746103327892175 -0.26771568339577068 0.88597876542142384 -1.5982286635008038 -0.69275726101262713 0.62146896247863925;4.5306577409380901 -1.6995315144604302 -3.8741326993358771 -1.2784992105038047 1.0777994981657084 -0.48161342972607163 0.1885853756300111 0.26616338535621648;-0.15776160743928722 1.6246410820136552 0.68153642339326781 0.5755172363341774 2.8574714612654928 0.10786750485153017 0.37413417751915212 0.61761480867472185;-2.7221443548866824 -1.0908332608531772 3.0094349349327203 1.0439033166513167 0.75538543971013294 0.28992651010783654 0.41108561121862591 0.66632095159951166;-0.82958485605301446 -0.81748732019058323 -0.11775973629215701 0.78881843722850309 -1.5561758079425494 0.60579546140780782 -0.1947805481810527 -2.0344767429877981;0.80425884710532625 -1.352929803804807 0.91480900511137098 1.0007116718963396 -3.321864790451996 -1.7123578773363453 -0.98242123940884374 0.36510324944316291;-0.19656444430908696 0.49198465489008697 0.69220818793763317 0.60730006908488543 2.8316087786447053 0.22235711071714342 0.70576036357250493 -1.6015855659746321;0.81879304922335061 -0.34155248214339257 -0.11691099019774352 0.0056726775947128702 -0.76540326123958968 -1.0177457865753974 1.116243869379099 -0.23038088642016563;1.3503089545196543 1.7402765741669826 -0.2803946330621227 0.36453229563190753 1.1642581527701397 0.21696754583482328 -0.34213769292604412 1.9675709551913296;-0.43993538037072466 0.2100203926042376 0.16133465494383314 -0.067710471235439371 -1.499149109195318 -0.85821777595797188 0.63955948620669001 0.42422654392667269;0.64564874072321532 -1.7628079208231058 -0.77744922986104081 -0.80408452186632162 0.90541585295818494 -0.023809842355713533 -0.11033216047586478 -0.094544775039731854;-0.036753961865675935 0.41151843222445145 0.041330257300740574 0.09348092457926159 -4.5906968145212659 0.41674931750471256 -0.3692382133015556 -0.72297807639317679;-1.185205537561143 -0.93864830510678465 -1.3261448491319341 -0.91748660855385866 -2.2032278057473365 -0.45207212697134697 -0.27223730143742753 1.0477547672487608;-0.71069714218207736 0.46201448750446084 0.18664187303708668 -0.0089362277620336668 3.0066796425652043 -0.43635583233362929 -0.10731792448205464 1.3006527856794103;-0.34821475589192141 1.2842438424272704 0.87687632620395262 0.20287518020897119 0.14324897968653877 0.40421578462975183 0.29700621723063358 -0.8864205281627664;-3.7540211310170615 -1.3310195351711289 -2.8664653695626576 0.42949706306339297 -0.097128496569598571 -0.4119770237095749 0.40350278399853667 0.7859279004575177;-3.1263183224008366 -0.31458284564301225 -0.28391339921396891 -0.12588920103033607 0.55378855891180223 -0.57958804986105805 0.1844035131528397 0.93152138676522833;-0.36020951191634354 0.89191397768367531 0.23575589883928158 -0.20378073489521334 0.068963825278558571 0.72238111495702173 -0.27692866559778495 0.87256395994034908;0.35708453902933374 -0.61625582804383672 -0.076371596183982524 0.081644671705203301 -1.1736073516423047 0.63696958632593381 0.39386212493319589 3.1243904118770773;-0.76121689538441206 -2.3284443674233088 -0.69833900374060376 0.79317828558378167 0.18715713942358481 0.22578044461612373 0.85903658378858694 -0.45059243437719643;-0.84152884344637924 1.1184980021895248 -0.87659636155507614 -0.43030537446149736 -0.65283555124556036 1.5486990069382569 -0.30973070308037642 0.89823714806561272;-1.4836707535228282 -1.4667783954119478 -1.0143061764379291 0.57915186839371835 0.47180471437139426 -0.94154352038152844 0.35254311079708195 0.099450823101875849];

% Layer 2
b2 = [-2.8008896434502564;-4.0025141212233804;6.2757686859315793;1.9334685887184566;0.55588118005806719;2.0654127964446487;-0.40497008131216095;-1.0711634534915877;-0.60001960400891796;0.43711177933248996;-1.2524743151185025;-0.20271309973353197;-3.7659690122544993;1.0568404745580486;-2.1280256193676776];
LW2_1 = [-0.29283055717771239 1.7290443777962718 -2.5236952535278183 0.074690310340789656 0.26609069310167111 1.0359159523043255 0.58612442466145331 0.2972049101172054 -0.10910738414071222 -2.4349141050803698 0.74879911624270179 -0.20378198973743189 -1.982174281893696 0.79828560289234385 -0.57141295724893748 5.5087658774708057 7.2247386145380093 4.323165464259727 -1.8670652477177772 5.6604199149836703 -2.4716671152897205 0.17024851070358782 -1.4420516867346767 1.3614186298470063 2.0796418659114488;-0.43916034229683953 1.1988998098984591 -1.234090999552844 -0.31347928622316584 0.30982646118007484 1.2646169321173999 0.20737394253754832 1.2092256760287885 -0.20661575614566155 0.39034872984201741 -1.0181658908001667 1.1501786969038967 -0.3783472454488982 1.8869685513831957 -2.0002435678102106 1.1552751704760067 2.048875849544634 1.3579656475783655 -0.45209615843720158 -2.7579764992799882 -1.2483851345068042 -2.5733518879223989 -0.04414178608329563 -0.71660339821708463 0.70474651849450409;2.4987269957021101 -0.59845828139645763 4.5030493913883491 -1.1926265371841227 4.4674242147939207 -1.5609489124671689 -6.9942876857556415 -3.5490502015103664 -3.0255674332943938 0.31644259354493703 -3.8975135304444888 0.62699479100701849 6.1508718965693667 -0.8650309121296943 3.6601033023616227 -3.3709776486464693 -2.022273909400639 1.1561337456020975 0.32329779915555384 0.47174711121373702 -1.4629850376867197 -3.2494231990466114 -3.6220475681144819 -4.9647728756075313 -4.3137046739548639;-0.57568457333602496 1.0320996637354862 1.1471955894300159 0.95323405308878706 -0.20592520575576534 -0.64433717830984216 -0.69581682285322666 0.86414405155279039 -0.88625009951847666 1.730953390909356 0.36837223833893429 0.82497612395126829 -1.4079241899333979 -0.91299442382552343 -3.1858343155001969 -1.4574275342351419 -1.1773728719066505 -0.22952959023177347 0.7574879946723434 -0.14039768147094669 1.7482066922692689 -0.85861377552148488 -0.97704658623874341 4.8098223155933342 -0.3238482438792904;2.2306283763919259 -2.3618302358868717 -0.097456148844096341 -0.0372135700820449 3.1297249317791365 -2.4489680094367854 -1.0951157315203024 -0.074726823147221053 4.1141554574937151 -2.6333139308899529 1.6882530220225402 -0.67663201495830561 0.38329005023166363 0.046191750545181882 -0.74862044747827006 3.6902086715387923 0.78976729238943988 1.2374141388559621 -0.65024792572744927 -2.0474597680225344 0.41900548749378663 6.0255525208349869 0.49155790150651957 -3.0464224282538157 -0.54659766648073049;1.0873033943141712 -3.0550009354961865 -2.5470962308649416 -2.2810192074968216 6.7279596036173919 0.71841284833630403 6.0239562556239363 1.9384232424222598 3.7389346360644935 -1.2027224645189678 1.2438945358544971 3.4668601676125363 -1.2330404124438494 -0.42963527516333228 -0.41409771027201053 -1.0653428696340035 0.52556236383437316 1.8043561338978769 1.3553651943730065 0.17573297500411586 -0.95414273631166435 -1.0848821154520616 -2.0266694709709667 -0.39784114819595395 -1.6883400232843089;0.51680266368888794 2.0542063509476582 -0.1112202878764572 -1.0198638829780897 1.7538633090351352 1.7106251032172213 0.334822579840795 -4.1623195278589256 0.0063033481565580134 1.7653058237439341 1.1186454925170453 -2.6416350782789109 -1.8108404879097191 -0.44622370238778253 0.62374412209398977 -1.8317297072897698 0.32523712841854752 2.5093762811660851 0.84915660151238082 0.090670509905552851 -0.54383422208666221 -1.2592747788084651 -0.034371552750345716 0.56348120261035894 -0.096916199009914106;-1.742697310057455 1.973718007294252 3.462670723806383 -3.1823043877674175 -0.90727252668096536 2.3801688228708908 -1.9781218939471816 0.16711584149048914 0.6343878869625853 2.2850577216787542 -1.3600936676367701 0.23775109069417208 1.9022461546321017 0.14230316330044734 -3.2524951755426943 0.90978089061978917 -0.31417657500362972 0.6522263948797864 -1.0248823663974989 0.24660869293576393 -2.7318125735759371 -2.6533496865748547 -3.9587252468187315 2.7107658184945107 0.9339714974714679;0.33075364135787483 1.7468036343900402 -0.8227682208834266 0.94790346470969067 -0.62256583434551949 -0.61877409822854024 -1.0685785947764253 -2.0256887932662178 1.5116603317030379 -0.77448697956459422 -0.91410118857371114 -2.6114094727004393 -3.1434743666514691 0.57579375745447847 -0.4240479147886127 -3.182627070729442 -3.1298660870665134 -0.51951252648634516 2.033273718040165 0.3630785436461032 0.65509433061759303 0.30031965931725169 -5.9540821051806825 3.0626986512943577 0.74667282781312416;1.1521627595460355 -0.35275422798979139 -0.23727747133178986 4.0685538691314207 0.42819772621475771 -1.2200024556711417 0.1148166738371208 0.56246316751460024 -1.6662983119245953 0.028412607898052573 2.163017379912954 0.48397479592666465 1.5785914035705515 -2.3063921913153043 0.72783700828620135 -2.0978818398683443 4.1726686598376403 -1.4878803238921616 0.28503644898122704 -0.61414212262061807 -0.93798460130452144 -3.7881737217578144 1.5020576110921811 -0.38271535893189745 0.094357893179700808;-7.1465868015425933 0.10616891335751918 -0.57165469975607208 1.5363628339736983 3.1576757145673904 -6.9988612717200605 -3.2426664044204636 -3.2988575442968759 5.1014124659873596 -5.7300674107314222 -1.2052087120754575 -2.890564462873161 1.6738335323864835 -6.987419291277865 -0.53919137235970926 4.3572078480363192 -7.2983053580369646 -3.1428194953624988 2.3493058302461982 2.4043654119279498 4.1089099715617037 2.8812641489606126 1.262128245412186 0.3590245253024727 -2.9595444732280076;-0.054336185930480535 -0.30350326366350866 1.5943182437355525 2.2966293374289806 1.6401296331713227 1.1974987291545316 0.87192663723957031 -1.1847285080182772 0.68630852443392532 2.2758250909913498 -1.5699819260813286 -0.71817567680594929 0.17631865543644751 1.5799173932954336 -1.6465875774942706 1.3401853141730014 2.320553357463178 -0.24636674731007047 -0.64301299223178532 1.9476797974336522 -0.27693586946093041 -0.88220931074366726 1.9750400535026358 -3.2665674732370467 -0.049300153175251542;0.36543066462039642 -1.2377892837985418 1.8617093772329143 0.98083030641587243 -1.0059866078179209 -1.1538831508307106 -1.1583194013177984 0.93449899759352784 -0.4095172936462026 1.5340869268213373 -0.94999640013251896 0.4561083076504861 2.0840358576615472 -2.2009519601074756 -1.2122765181262691 -1.9607811648356455 1.6201613265298005 -1.0857603275734051 -0.026730155255983684 -0.87357586859572445 0.89253146043769493 1.3008671045267306 1.2055639218642529 -1.2451741735087047 -1.4968937763506853;0.66554865785375927 -1.969992252906748 -1.5585151634340206 0.23197304790420856 -0.34536078522086577 0.66585522912132167 0.092737758359649397 0.037036027598010453 0.034919354511401449 -1.1798355227808883 -0.89928932977299558 0.68905368355208385 -0.58147649001084989 -0.9982356602147634 -0.56259174116674016 -1.6468401068526246 0.17623583372739141 -0.1169618766964941 1.4045946872735422 -0.82953342615012848 -2.086640078413589 0.57269583047260386 -0.5550844398883652 -0.016088398948747664 0.76791191537698111;-1.4302083975316724 0.39125018604665807 -2.4928104161562805 0.49251296378605658 -2.0416431854370716 3.464568587898353 0.49263655556803215 -0.62361601138206357 -1.3590280717632071 0.59407138155644879 -0.91265504887697779 1.915607291171012 0.94819371072416825 -0.4223256401347657 -0.64759091718172057 0.65099760469824652 -0.35566312193644967 -3.517710325446799 2.2512988693395415 -4.011612129582498 0.1183400974628524 -0.58333594157224766 -2.0082561337908942 -1.3805604110513758 -1.5840458674137396];

% Layer 3
b3 = -1.1517177383165218;
LW3_2 = [0.16518715207380499 0.036879446050981174 -0.0016331510355101074 0.080429157388889061 -0.0063490369634134434 -0.29138553332448291 0.03827382938987569 -0.010113710705073171 0.010309527515502475 -0.008398485259718879 -0.43276197394379823 0.013384170952616811 0.030237822903556841 1.6487008862024912 0.0034644077968278061];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
