function [Y,Xf,Af] = ESPER_silicate_16_Other_4(X,~,~)
%ESPER_SILICATE_16_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:43.
% 
% [Y] = ESPER_silicate_16_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.3653926912850649078;-3.6267849567026075874;11.861373770803538719;2.2698541775373470841;-3.8163414743723604872;0.3049770901673721224;-3.0022006886018406391;0.43084803755304079687;-0.51154761493759648427;-0.15732492084545857125;12.365906994160161148;7.4799108866337924439;-2.3921631725096710319;-0.29539658355781595045;-0.043100253870749588581;-0.18975317249875414682;0.22015898096427849451;0.3349735644299263182;-7.1792178026503075117;4.4999601874467236584;4.5073062493306972343;-0.31952558473414977014;0.39229950952460379554;2.7195905631874004449;-2.8818051223366163427;-15.872653509887728163;-19.002158045457509417;3.929836633280078928;6.9394787031153830625;-1.157642360215019206];
IW1_1 = [-10.269267140521268544 -6.6640638526698730004 3.4526008132780687809 2.2317054581861062168 -3.9830083027452860556;0.1791580879345820998 -0.4284168280174819321 -3.0168532257246214456 -1.7479505666863022206 -3.9308802707523744502;-0.058452588227668016152 -2.317686867325511102 15.492219854319868588 0.7541031932851282038 -2.3425321089525343865;-1.3049382079041949023 -0.083531835135546128601 3.8101189631760457033 0.48334697747536986556 -1.7637909896391612552;4.8740069470039664168 -2.6794574865245461837 -0.29257131428705096532 0.25576356672881883636 -0.75265020361082957123;-0.29061029142388439261 0.52490791459519325901 -1.036897904415750693 -0.09792200024097730271 9.4041891063710743026;1.2045668696718103696 2.1894814820689307844 2.1285011526390031911 -0.9560214806322451242 2.6412166582480898214;0.31195124659197109862 -0.10450973676865549233 1.7832522723729522518 0.35059168954192776457 13.832369955937128481;1.5866565368833873695 1.5255441041910053901 -1.6585520010529759549 0.4355051083148511748 -2.8993569283140683268;1.8222466577484981443 0.83363828253482530339 -1.1966830275674995576 0.83569345883435908195 1.1128335380497991203;-1.1932792487271379755 0.99655102924051941482 -3.0737053545695025569 14.860844030081834077 1.309894407018377116;-0.23018215605040012739 -0.19241174979857531002 10.538216323929690432 -0.16441031890837390361 -1.2294336884643564112;0.20795051409992360014 -0.81867175962761062902 -1.1761828315632947284 0.015550372279549147525 2.0556540519905825981;0.16855330526531900337 0.034796634331814943475 1.4972619670124367453 -0.32971880304970613285 -0.21654700255717482249;-0.75747568548184052162 -0.55659295284646892465 -0.29519490652796431807 0.9754572614033084621 5.3115757214510894713;-0.79703814942755313311 1.9219893699233381312 0.77716472741183251216 -1.4292891566594994046 -1.6677991385104571354;1.8469470358995649928 1.9233095342846702192 -0.98880996476485782942 -0.14042666821717458836 3.6208469533421738795;0.048745821838018878192 -0.16577425599275513735 3.3770597459207625235 -0.27437433655738624472 0.0086813617653875331526;-2.2198651065356944656 1.1958783873512659479 5.1603351464973483687 -0.29906635474532061725 4.4943435966898395151;0.47562572989565826687 -0.051644605946247472417 -2.0574033106979281449 4.1004717227227915899 4.9111468506031510373;0.33626056053333258644 -1.1062377901298094951 -6.0016288827960533325 -1.2159096188715325937 9.5704894106995954672;-0.095965518620839282415 -0.08926949752188136078 -0.2571669855698598961 -0.54737603834419312765 0.0031347830052661372797;-0.14171589917905921818 -0.25516126653684018111 0.14641334583735177155 1.33428262055346325 16.735355899062074769;-0.092839815183897528295 0.2994164252221118705 8.6224844486161327239 -5.6925094974720362728 6.1608519430269703676;-1.3470300589517181233 1.0278904405881434947 -0.073793041770815137603 -1.3933433673219259852 0.32986111613968049916;2.7684349198280493454 4.2835864987183001062 18.306580539267272911 -3.3321800302152797535 -2.8976449312476169062;-13.688888309082186012 5.2732053455998251223 -9.3427257439108704062 2.5074670759855726132 -2.3165825704281157726;0.23814590241665839487 1.9026161651964765831 4.6251358000589464226 -1.4341128467802461977 2.4967884295108722092;0.72110304908626510212 -0.65422584088974666816 -0.30612493277164010141 5.1522071424448858679 -2.4117613730637419422;-0.89680394906021343449 0.92344627026830461425 0.23700977824542804329 1.3000837417375741278 -3.6904097218997944374];

% Layer 2
b2 = [13.278042825280635952;3.5443845882909363887;1.8889362256315027633;-7.3115291589814592754;-23.522776745627105299;-5.014968689175291594;4.9839676250333964092;25.528213865418187822;-5.7472246983416122035;8.1117693941734980712];
LW2_1 = [-0.41848116174296995373 -0.32679805091847985432 0.72895189648233882362 -0.88501066894206248392 -1.5834416771486734543 -1.0042850007497026166 -1.5408842705677534557 0.54177287822298370035 -0.31944116119448190405 0.5125379241114152995 -0.07027373279109533355 -0.29396961058094023267 -5.9389777650934076902 3.9826037868400496755 2.4540426763473361937 -0.53462271482493095576 0.71007479246409199725 -0.96541306516562652718 14.093319455106334104 0.29286884170424953844 -0.36538987850053972206 5.919107380511913874 -0.18331597121244797011 -0.080844130687829085513 0.20300026683250776971 -1.701460005647715823 0.31566907134698479753 0.013665363580059155038 -3.4578593708066245327 1.2660349002408490815;0.24024304017608383299 0.43852992564683446197 -0.73301761902334972021 0.63051293225350546479 1.2038309618405620416 1.2322936630465375352 1.0551715407569968175 -1.0408059252299528552 0.3751945273359044708 -0.25392972575234395993 0.075958818368623406969 0.41096231681074740782 4.9583174694619458478 -1.8570787875788781207 -1.655465315779726998 0.394389347681262048 -0.56649933725794165973 0.83476440792205142127 1.4311998671550720807 0.16152207439326204952 0.039132362103287646193 -4.2078639571160127986 0.50902123839574597852 -0.08680943244514854884 -0.31179795262594667271 0.78618970127109222279 -0.46977132966707468853 0.018916651139279774818 0.95342422917961056061 -1.0069691771835262983;0.079477530536176399512 0.32815882202214036178 0.028657893899474658206 0.42230347126273143354 0.93989358559304780893 1.6742715104133638615 1.1104441056250293762 -1.801450387165520084 1.3172762271339815143 -1.1876595354148409278 0.46151180749502968004 -0.52789757595197017714 -2.1120389523767664208 -0.12588204260362317877 -1.6780731880730410666 -0.43062483476592156029 -1.0311778233231700952 0.85708901837947537583 1.1784824778620488495 -0.34957288875814179763 -0.30948498104851229762 0.45407659166454344968 1.1752351209371745266 -0.1018336114889705768 -2.5847920976862073239 0.37662080537123676649 0.93175366576355433956 -0.97340295514664054721 -1.3784358273074304169 0.71404229989746248464;-0.45737566454914346803 0.57884700645764008975 -0.43538019291513163633 -0.73833254639131129515 -2.269900742060787735 -0.9377560964390917464 -1.4731242230564254303 1.1147394024383514566 -3.0442940284274078167 3.4554715888001923396 0.076870503615098242922 1.6901410081599823609 -4.7073927195379194899 -0.96625164892417392259 1.0495448883314830724 -0.52037377534177353677 1.805483292450440258 0.42689639148123253998 -5.459861365439786951 -0.97282721342552469501 0.82046420379346307605 5.6597429361665643199 -0.18577060271378059708 -0.1919459596932842349 2.1480510137856367869 0.12557186886091370459 -0.71369859911109012618 -0.7068155818376873345 -2.242155510191279788 0.48371400382384394101;-0.39483366456919166687 -1.7546411041092864203 -1.3321617500932592115 -0.17443671449598496803 0.78701697289298389038 -0.49106036916713524665 4.9187155144191665457 -1.3409271378544422859 -2.3569954589336647999 0.99233288695047572325 -0.42191406944253256883 2.0427810304588920332 -2.8721411986967506635 3.4854424649073272313 0.47702317318518611122 0.023749657800341286706 0.72531922334271170527 -2.0772340274307823371 -31.401475137653797276 -1.6733364535179282573 -5.1040109882098549932 2.90482605951529127 2.5618548120553401581 0.16799044575110982924 3.4178378794987542832 4.6473507246850038754 -0.27169693364433322724 1.2864988430493680127 9.1690735449454852102 0.88382494037009828869;-0.29249928522008222798 3.9229894895661163723 -0.57552040196784914894 1.5879988534832132352 0.50467549827713809041 1.8725392876270881004 -2.9136857920593657312 -0.92125832299276633197 0.37412685559892111531 -0.67130023710040553908 0.27336710510179090816 -3.0671640394735302237 9.1502665557197975232 -13.875311195914328266 -0.91669607822196896851 -0.0010094603839928507558 -0.16452437603302583202 8.468443796693753356 -1.5102780013725110031 -2.0637053767464004217 -0.001786116113206866543 -25.805156564015739207 -0.062597861997120293753 1.1962391392728870532 -1.0147528626127455542 0.97936296502801523101 -0.31698072057288362302 1.2529134979414973117 12.183479748574379542 -3.5644596987621635087;-0.36617680354929676989 0.8613040651237733325 -0.56283412605199056866 1.0528003758758686104 -0.39521592402032057478 1.2684490278236664196 -1.8052228375266070604 -0.1116516366146277639 -0.067789438601411788898 0.45520913882205221723 0.72483719234441779111 1.5836056199164607605 7.7540484866528247565 1.4119487476654724034 0.70570310306405770184 -0.45471023874951338462 -0.064324250538857860593 0.39149098519736974522 25.798409928537278546 -1.2470981484404921602 0.12301134864717327977 -2.9477325633411610717 -1.7832526720319350488 -0.078706307613287979086 -0.69376958444338732157 1.5154926936727994846 0.22794129859414033468 0.24706392669529372852 26.521043739934462735 0.068086425107858644656;-0.12987171303604064243 -1.0280895805919318953 0.52069750173926609982 0.35569342907522882857 -1.0289937361289211992 -1.188687100612384473 -1.6902899213262578826 1.6449478064901861263 0.77306098699469871782 0.2056729548880566194 -0.2373905516468433341 0.081873321092523279607 4.9853174657335461717 2.9401368498762456838 -0.24734747168261367323 0.65068512154824609262 -0.046283201228472806155 -1.2548487955236469205 13.636784279162871059 1.2928820938995617684 -2.0902956701374701964 5.0456794407261407187 1.6442439074190333681 0.031144276889908978356 -1.0024451708044392895 -2.6642923374614597698 -0.70393066442011797967 1.4440889445722304707 -11.401849745026062521 -0.4511355899600640873;0.1785706315724579496 0.79906084777924324403 -0.83260379121720229367 -2.9855170353716271592 0.66366152768483366309 -1.4283325493712222265 0.86269955990860369699 -11.12913270664816956 2.9497356330218269527 -0.41574973182717039899 0.085833552806731522322 -0.80085717397461553269 12.371591078661120733 -0.89616135510434657974 3.3226379826369436543 0.86319722862836345545 -2.8388905527678640617 1.0229108397462949309 5.0299643907710205326 0.31074458495578277661 1.9849400228475293506 -10.884782143928939391 -9.0789769264121176207 1.1118125077588840721 2.7799701518610286932 1.0474305397737670997 -0.066552021281071696568 1.5888104858660627716 7.9847930062929215467 2.6284056745577997205;0.50246221260036316725 0.093561054074277588688 2.2188323596393368931 -0.087218089716953078883 -2.3253622723812257256 -2.5261476396216102636 4.2075408938967253647 1.8256929057038668862 0.58991228977028298264 1.3011929833358180097 -0.70514293254944016009 -2.5665083812158600018 8.2816090050931769895 6.2281601458065747323 1.4687810503108496007 0.39785937993510556154 -0.75924552174131199056 -6.2546537931172103697 6.2838807460362451351 -0.61392151263545313711 3.4196286602625645124 0.20921760718108267652 1.0224103436202054418 1.0191634731303154116 3.8739244237480514599 -0.17171227702783836699 -1.4632312250849424107 9.2649661335461512834 1.380289811262391364 0.018071233718105022409];

% Layer 3
b3 = -0.42695013897528810709;
LW3_2 = [0.86686328818633684445 0.88951384426890400814 -0.41148058598881998016 -0.31503409243235108717 -0.18068617463117653266 0.17545300516080267195 0.26250490855954417002 -0.31853791445037688002 -0.24031671447827221422 0.08160990803321915843];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00819772922900357;
y1_step1.xoffset = -2.02;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
