function [Y,Xf,Af] = ESPER_nitrate_13_Atl_4(X,~,~)
%ESPER_NITRATE_13_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:36.
% 
% [Y] = ESPER_nitrate_13_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.03;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.604229607250755;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [4.1181624310657012344;2.5178141508877773802;3.438289512898448308;1.9204346136800936051;-0.82983684139912994304;-2.5836231819153732125;0.44632718310628249903;6.3386880890558883195;-2.0219741110079345603;3.5847129043725036723;-1.1832926690440792594;1.6269243489669247271;-0.9230631788645472513;0.11998435761423650869;-2.732303001852233848;2.0347425841321409301;0.41850277596754120735;-0.8902138860004221721;0.99960293466126837192;2.0363961445529192851;-0.67725476490473424107;-0.55062794587837471383;-4.9548489975708012167;-3.3954907563269371984;-0.99583291433337517429;-1.5806586448231896291;0.67502348571791515042;2.0946823322958056934;-3.8473881170728811973;-1.4273290845998354293];
IW1_1 = [0.85935079790577106884 0.63143665681547922475 0.30737763876577922639 0.88074956526360548281 -5.3233799233853282828 -1.076686676043616675 0.12576299203685620265;-0.0043043624353024598217 -0.10535224353919409035 1.0631296272062220609 -0.85100696774115003329 -1.9239865079536797587 -0.50625079934660355274 -0.85855707798708957856;-1.7169572423912540238 1.6889747812503574931 -1.5370964287284782923 -0.89792796043215705737 -1.0397224651671783668 0.13312147592169890076 -0.6776810120071303789;-1.4760373105960045148 0.51324694721762720295 1.0521125870962195759 -1.0473282086898774157 0.76661414034787656036 2.1988418083387966107 -2.2385084254519940217;0.29226861100783618763 -0.48385012395580800915 0.44271725263215649937 0.23795594194569164026 0.066148627553135969093 -0.31931022733058711527 1.388065416143275721;1.401515861570211019 3.1301601939115695217 0.079805544872927111633 -1.0659039012522237844 1.8927845103464984167 -0.33731273855877980106 -0.87293552527263429397;1.2925481414112012235 -0.9683475236548755305 0.079376769579928577181 -1.2744007815726525745 -3.7507104724250899253 1.6519595919618783597 -3.278289922512662713;-0.35594254943669639824 0.45356797655479080822 -0.34474912498057108667 0.49298740789196210388 -7.7472198373861917986 -2.8776281998882442537 1.8488826445140265076;0.38809431088462847947 -0.70009897083258676442 -0.19087197378245282509 -0.068520879778143972683 0.83281647778179357378 -0.76478330588370879717 0.39735482059761689788;-0.63894963496986800777 2.8791926344092457768 0.8288001211776586663 0.35552752867867631892 -2.6691247039597629787 -1.4968378637093411321 1.7773767227153349779;1.2314531987642378663 0.19452045561277528374 -1.0716597815455479736 0.77334377523138919663 2.0222677428972204439 -0.38143189215177286666 1.1391493589847159207;0.06380205488263585023 -2.1909158488856541602 -0.9411246436673607052 0.11260409299520460213 -4.5344267574434917734 1.5963708447266771184 -0.80846052098135767761;-1.1843750249150326592 -1.9802120910137954723 0.004444574876392510393 -0.55623027997904761488 -0.4131677979643158527 -0.80966463239932084939 0.07682315571847314617;-0.0151969074391743314 -1.261681928392900609 -0.66024662598942318592 0.54974857142616395667 2.5572934547419330364 2.1602798118754122925 1.707129331931627636;-1.0937137292657150844 2.6086931296034330252 -1.5136312039019821363 0.83385905327524156849 2.0577068095610120402 -3.4682492214926812224 1.0732440423711788746;0.98916641814460615212 -0.58018564298543817692 1.6731458276971942212 1.1544779436680578932 -2.4324229477857230997 3.3496373166579629377 -3.3336236331502462349;-0.051249020973943140711 0.37797443817151393786 0.70530964913581994935 1.3587249279416944159 -0.87336164204879984663 0.16246279689831688575 2.4198330761275452794;0.42183664676247911718 -0.32585991048786139279 2.1333762788852479453 2.2750364632668911291 4.1039427299709210217 0.79612986995136336699 -0.34481336125326034203;-0.17675778865708607901 0.15119321801665819294 -0.93935099970005775383 -0.91586002516727194056 -0.42442501586809411318 0.51834536559239385856 -2.1507889558993813495;0.019109854971868001777 -0.96232708114790288523 3.3435457197907423321 0.30929588692750192847 -6.1894692020306258939 2.0177879808068275302 -0.4408110465774017217;0.84168766622867075 0.37937887708122319808 -0.074319523274069237972 -0.45825763389131762837 -3.4182297382290283139 -1.0429374092961976039 -3.4677069202388830504;-0.79248854596267315209 -1.2789029071695001694 2.2345622885356828391 0.89252108135710361836 0.78081436841681628458 0.16222923548851694853 0.58504875888074492352;-0.64181965697858300857 1.270263492771046332 2.31553109244614852 -3.7938177495200582356 -1.330766969874362049 -1.9531181824987269291 -8.7473258003938259009;0.28565453224152226319 -0.28377837735218913728 0.84044208307145651382 -1.3718778395620847554 3.2278557336867170768 0.78961597998181054514 -1.2513307216502531638;0.19851535429763167429 -0.90837443413353702315 0.20977818838546827274 -0.44622510704457385433 1.2394852403672842467 0.69542676032480554849 -0.24753988530504583698;0.19948825060201827442 -0.13509212705425208134 1.4544903465645020457 -1.0365814219501066074 4.2366021563048708032 -0.46631326953754276277 -1.0973666671389865623;0.93093717149786403553 -0.21628185678490038923 -0.20314214351357903765 -0.9490792013420745743 0.27503822835153957094 -0.6220190268105589837 -0.3318780521461192623;0.44470843545541199893 1.5567363513762788596 -1.2761116911321499501 -0.41851779299712987825 1.610231175989325747 0.44322046176115981186 1.3267589353315152323;-0.26664503880147455428 -0.96619820514033294412 -0.42801830385864375605 0.57074504982650509088 0.74640404849446773117 -2.8752671524600623698 -0.32603478683029446517;-0.73128821630300666623 -2.2713120741299062111 1.074180751430199976 0.59506037625129937219 -2.8056809042612531613 -0.018613688646093320966 -1.0768807885969331473];

% Layer 2
b2 = [-2.4407835382799594193;-3.4656993314136803619;-0.017494063189595860514;-2.471013039614048612;-4.1688288588705741944;4.7224540655563220781;0.78937378057073781523;-4.958514455745900662;-7.4865886252850888383;-3.6881932919339850407];
LW2_1 = [0.0046320222456679967585 0.94996393341131757371 -0.27882841592148155385 -0.45419843572432211376 0.87010594554396192279 0.12264395678668171819 -0.32835361951424546501 -0.39353820154039076407 -2.3458966673495220689 -0.43179677168316082936 0.47547150955506800596 -0.43707982048790711138 0.08113739952051836346 0.33225624322391072996 0.15143677337668287608 -0.24630615707126429781 0.49849229489166191343 0.059615158555695858811 1.2413726522245638328 -0.70245049771964374052 -0.72215446569943775312 0.015119115865966590781 -0.025145325742729592727 -0.16579271245330345907 1.2929392863158573057 -0.77029984814139851323 -0.20845828098878754764 -0.11789163361219090476 -0.52046856255183904238 1.6967350198219499635;0.96016434149062546144 0.50596992439131183161 -1.4489166695827047082 -0.34202030856462395381 -0.92706762440199397268 -0.37697088278890056312 -1.2882333839576691759 -0.46409079155367272129 0.40059811980549292487 0.41518212866251735793 -1.575749319181080299 0.44353825787276235371 -0.058066792151805893263 -0.22821825619522762008 -0.43978333214131670736 0.71390172712039423608 0.14162201143831154582 -0.99334654964815005673 0.12631702616945206241 -1.2933690242450261998 0.13118925917392904035 -1.3515902456913169161 -0.31864711432667491842 0.19231165296263882936 0.97590001079865895672 3.765584814637524147 -1.4836607019367269444 -1.2481183365835470944 -0.15768755296813219413 -0.32692093352972534381;0.97843532342149397429 6.0027788740889000962 1.3423685882699243344 0.050599755603393685444 1.3738162818068286875 -0.0558881422486258439 0.42437871724294462528 0.36641364771096140984 3.5998499881604466566 1.994898408879192786 -0.6070065253877083844 2.1378906887759114852 0.53903073474570617485 1.4526410575531529812 0.34019911119603951644 0.70616922331043185945 0.49256553946298170521 -1.3707943849018884297 -0.87406180376401265697 0.25744735015062519823 -0.01772743085410427577 0.7421923477874354802 0.4078709578691198101 1.8600807415827707025 -2.5817487471326066029 -3.999853689668293466 2.7839819596489814302 -3.4724303449536626509 -0.094794022072934178147 -2.6702648604253891307;0.033980597075102980664 -1.5002020244037332919 0.92224556245871014415 0.35422171064500346249 8.4540668689446700768 0.24188519844243261403 0.65141878911207384828 2.3121900625745581692 0.89758988905047121243 1.5438344524757223741 0.69615325590681087498 0.74190609435717158604 1.5662992138342410886 -0.27178662901621636339 2.0699645367050636402 0.84630391379089087156 0.6482968455082938064 0.042604827765307086429 3.9045746092498707647 0.9160318740896462586 -0.95391067837846554855 0.83702217686295354859 -0.16210141097117294895 0.51566535237520338963 -1.4542886446933223077 1.0222094001301755828 -0.58232109621687599965 -0.24575301880976513358 -4.9237968429217229271 0.80581614798352807494;-0.41575971457154403677 1.2925327095231502472 -1.1771264636652525315 -1.4053608200823159979 2.4323683995256759616 0.38427511129212155172 0.081508885532030464494 0.67255865902610834084 -2.115964111921740276 0.06135089468401479923 0.58919452491510648784 0.841814931207374606 0.01513364751976809669 -0.49826431377278035395 -0.86528378047257681338 -0.81143014308306760096 1.6418887433051028157 -1.0901821516209981855 3.2650059967984987885 0.91618714977941062561 -0.43150412255502634817 0.33105490847264712473 0.15945264498419206567 2.1459192205382553453 -1.6845276933445005874 0.7613055866786720971 4.314494394980027181 -3.144590234695203268 0.22216427167654898001 -1.8350588894129908901;0.057644693689182707752 0.60123325811227568138 -0.018624002920600461058 0.27622497671309936829 1.2460612995091771005 -0.40437424056175863551 -0.32665798787892058597 -0.66530642142043128207 2.279839105896697582 0.28312277664206697558 -0.56812260460719132826 -0.20146346740144152609 -0.38807475764393994933 -0.47282425633304275836 -0.30668644178001452927 0.19969570273206543876 -1.0820599560204378076 0.14604624808768540412 0.77801153788183996518 0.23212436443247341789 0.11845399633258632544 -0.21110672179433914719 -0.14896781307593595645 -1.9295018628875622024 -0.44406821356749381913 0.072078223439863337019 -1.4284453500386615765 -1.1687487254507986645 -0.048263141483264396236 0.055759162456307451161;0.31832425745224218749 2.5134646141036451894 0.10840816327078757475 0.60865034410438734191 1.079079585923410356 -0.2420193284843565884 0.54646247547918935794 0.26419529474027730886 2.7951561157159261484 1.2269752664262931763 -0.92414595495729257024 1.2120442113261962191 -0.2609789775354374175 0.37254585847733318049 -0.34100873689448707449 0.3040149641794587243 0.51609142124020923603 -0.47418742816728493006 0.64481307569473289565 0.51337423175903384998 -0.89974008065203658902 -0.093085936805357608059 -0.11314145136350074738 -0.037659936082655755263 -2.0394392439230242253 -1.4974962290924924702 0.62340794889545403379 -5.7947951414001233061 -0.58367146714583661993 -5.0244364720864052032;1.1537715299847166595 -2.9050996638468284949 -0.87219947575851253241 -1.1989781886837225233 1.1502835926426657753 -0.21688656368190586954 -2.1132654377943191903 -0.35379118391863678683 -1.3206647274505116663 0.47539137449278684455 -0.6825215140708362771 1.2726974051588586523 0.29195757474545858123 -0.78341064839441765244 -0.79385996157943716778 0.55579335436704613294 1.5294800044875456191 -1.8449205512520852057 3.0041896194280659493 -1.4873611968701219155 0.74188881840018827685 -0.76446207347719719039 -0.039828326420685643272 1.9453823524683682145 0.048244809407867676743 6.0627103615305211193 1.0593140327198098394 -1.423945086404024396 0.72098737152511105375 -0.68260571565009486861;1.4983843598957868881 -1.3267887420834774126 1.6808508086968245721 -0.53337424091586127517 1.2003853595037683455 -0.1950503439585284382 -0.65675314716167376705 -2.5004059232264443935 -4.794201443756509029 0.64178404337025451998 -0.45752609866556276375 -2.9646064531257905195 1.7261140997071962033 1.3277773735170472769 0.77618477569897492696 -0.45970017463484263986 1.1477053274847508479 0.2445838364091687811 1.98390625985058211 -2.3251891212623712057 1.1832985717157236127 -0.16261943197746939194 -0.41168038881131269191 1.788812892612983152 -0.43267898629062567784 2.1280718217712522033 -1.1073972976585091388 0.50508774192416550086 1.8257273088939971473 -3.1279703155301055162;-3.1498931471347040301 -2.6684571423946294999 -1.0126862531933378264 1.4144422904900710858 3.9054114790848668548 -0.41907556065806988999 -0.44530693260570575198 2.3546158194831874333 0.87380711337880800915 1.1341778430340252459 -1.614140556117523051 0.8069064586035307185 -1.0284745728395616737 0.48817715398410488348 -0.22754195565277263169 1.5228908945991628254 -1.0423913500299546442 0.55395548502100211419 -0.49839449607251368191 -0.54728196499536518882 -1.046826060954926696 -1.3159560173314743814 0.77659061842558829714 0.86538248529621986105 -2.2351965608572941235 0.82572562111361480497 1.8779193163606724415 1.1459039672827693312 0.41397527577913550978 -0.50731023350597437283];

% Layer 3
b3 = 2.1704117000422442629;
LW3_2 = [0.81930836360615844072 -0.48126270908925883329 -0.32236794384253281143 0.064677666653312149148 -0.22983321726691319231 -2.3954260675784473378 0.45981112176767180433 0.35064360221174811771 -0.11583332097962099894 0.18231369728804111552];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
