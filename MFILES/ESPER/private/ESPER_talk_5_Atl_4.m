function [Y,Xf,Af] = ESPER_talk_5_Atl_4(X,~,~)
%ESPER_TALK_5_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:46.
% 
% [Y] = ESPER_talk_5_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.2178;-143.241523403244];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.00458552991639557];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.1594441942976235;-8.1166470851632138;-8.0892095810892446;2.7683248678113515;3.0357008723920189;-12.220976003569731;-5.7224599217159735;-2.4059105160932792;22.294019858854991;-2.1763824752728897;-0.30597348178305483;-3.5060083202356171;12.509866211592882;6.1693825905702013;-1.2791736021891302;5.5086824204264859;0.74190801646748017;-1.2881834523894662;-1.4985627367179135;4.3687618770938705;2.7913023430107087;-5.2899390134943713;-11.36069468259835;1.159751521134909;-3.2430363190690605;-12.081078331375361;0.12472817974110899;-4.0154346387141908;-1.6767463550785617;0.160875817083282];
IW1_1 = [0.26702179430889794 -0.1792876995881878 1.0646817348570459 0.036591862039526801 15.836109741422471 7.3728305607728597 0.78854754455954512 -3.5814064729143764;-0.75886478262700952 -5.6434020572258019 3.5462609610454403 0.053604111270034879 1.4727736496816395 -0.57115154581339189 0.11591522071024939 0.28154149666935069;0.80778542178139967 -1.0828425431280733 0.22098704692564286 1.1064064019083433 10.640310674681325 0.61634945228501237 1.9265026580237583 0.68373368457346095;1.0577593116649364 -1.5032320533627839 -0.74969114613513732 0.26680912599860601 -8.5993812902944562 -1.5610162421720928 0.10695538598526529 1.2108164275905915;-0.87144181066701187 1.4140627497806213 0.20906391007213274 0.27679377949914769 -1.7246246683797628 0.43133415325039554 0.045303898770046439 0.16948701552663123;3.2109046351013903 -1.1461198173996314 0.11029051977664242 -3.6606856329265174 4.8612699740024325 7.6823003287704212 2.1547827729138906 -9.7265065874697338;-0.19207280512130845 -1.2717479842554962 0.44036844326608193 -0.8063944555366418 4.9262378588148215 -2.8055794916184391 0.077317335000407217 0.34689826997002027;-0.52777390798943569 0.75470377202174821 0.88010002884641003 -0.26849646928221194 1.1079806258960447 -0.95381250078001645 0.14839785358004387 0.36284598329225481;-1.6215794823478464 1.3308615666612467 0.084717197787218104 1.2320706648487723 -26.638428918442049 4.9638713269567649 0.42893643684937921 0.91861096514766527;-0.038583695083108126 0.28396434374010382 0.055441303682119573 -0.2192399326557827 -1.3019014522475718 -0.45001960110919625 0.074986396656453999 0.081112631442033914;0.61451646803409787 0.68750705379375832 -0.14969376000354756 -0.10022114783600017 0.70215925627956899 0.020842258843813272 -0.076081845409614463 0.072907292843714375;2.9677271850055433 -1.3748510598386956 -2.4756067232733874 -1.046176211098379 0.72238418522293724 -0.60389874387871445 1.6814853353360706 -4.1435639089560032;-2.7971100351464866 3.8734316318313953 1.0227223899639637 7.4642652911823779 -1.4981558517203433 3.595844514858562 -0.79235820203534535 2.7331276864296146;-1.9612395401192435 1.6120334835626575 0.73820537497725447 0.34595790385006125 -5.858332318816788 2.3761381776891182 1.3908750085820329 1.7012829061366006;-4.5740703122187929 -2.0177432817088499 -5.2701429347492716 -0.89991940922581559 -2.0033695057156233 -1.3779967330547163 -0.58395939258312224 1.5368268111748062;4.1392774732242001 -0.47834567315649196 1.0209575914376923 1.015160405752408 -9.1807119201165133 1.2482604512716011 0.25245297292607205 0.34641164283096038;-1.1842029319182801 1.1645295573237513 -1.3189316227447963 0.16373123227160083 1.6474454738858899 0.40069277772693374 0.074733015653139084 -0.27937481519176982;1.1661398492305359 -1.6233111249527077 0.085335605164758438 -0.16444029893957579 -0.8999587539521321 -0.054451223025337545 -0.086961936280232285 -0.19308615257285455;0.40682667395644911 -2.4404075101736682 0.42538720428870697 0.27586844956292078 -0.74962290970068202 -1.4698302327140778 1.0312411144664915 -0.45222900084337014;-1.3924307655238335 -1.8296589416524325 0.4403578008424755 0.63982859417604976 -9.5888468467312098 1.9723882973896831 -0.68203045187087441 1.2859113087416461;-1.4950654254040516 2.4230779679910386 1.420328887721044 -0.18643294568002861 -1.9408679338154959 -0.40407960082314887 0.032474820023270963 0.45998732998043629;0.1757795087738819 0.080575934102799923 -1.1562591298128895 -1.0309087419729581 5.6781059637223912 -0.39108744578524507 0.3142523163897597 0.46326215928559439;-1.7009893143949208 0.31348757958328127 -2.4285747994739237 -8.9360959620499099 -12.851292177540394 -11.553487220406859 1.9374509335996757 2.8895923679475906;2.8688997090865831 0.28977107360949644 -2.547950315289274 0.37850006674464348 0.84701397050329552 1.1814985166346241 0.19036878557991355 -0.54532629321694337;-0.11692813364770231 1.0884635638910023 -0.94704848363535765 -0.13910462915206548 4.1041449383191875 -0.96901855894319366 -0.046121669281164908 0.072684201187122419;-0.3841894540245151 -9.8207894831365792 -0.38454611167262337 -3.271368179622669 -1.6890891198315743 0.49940161178240361 0.11944943352064499 -1.3816088036957153;-0.48978928625120971 -0.41934445496194317 -1.8243542867946698 0.28589227380234783 2.3084397912006485 0.58831471589971918 -0.036922636162905989 -0.41075636520784942;-5.0544647129845277 4.3188779831119399 -6.5804885007824625 -2.3600171885661205 -3.9910545732668461 -14.873050298324948 -4.6029237245682779 13.956587113755672;-0.53487953352267759 0.93673719452341686 0.58799989351053827 -0.21021393747702194 1.7642174517943854 -0.56499168716458192 0.13897680728312919 0.49977162797153613;-1.315473528410892 2.0389027784211966 -0.92089604122427271 -0.14788194725100026 3.646560909068866 -0.48248600445883988 -0.081868939166551455 0.080069144494010952];

% Layer 2
b2 = [-1.4128252936201122;32.012668608811111;-3.8000038652542187;-55.680607412079574;-75.938457231462266;-9.0233604566071381;101.39552767531461;4.0851009652840435;93.044495635978222;-127.15997947949258];
LW2_1 = [0.3617702458487701 1.3110404839554171 1.7449709048842437 1.0904172425118472 21.332157742888104 -0.83646332340541907 1.4348306167410523 -5.5436302971810676 2.225761983275532 5.8174469563324944 -4.9439178840048079 -0.39080330244200318 -3.3720848166372095 -11.918245472464436 -2.2585822369675759 -7.5828119031602235 16.477170783189607 11.966349252758574 6.8864983826843318 -3.3623966834867134 -17.940759865568037 -1.1899456242178224 -1.5115414474622322 0.080739457543868701 -3.0485403815366388 0.24967336685116673 -3.7057169521330766 0.51364948060973303 1.3067797695526426 9.972874429687554;8.4575170395346539 16.908860102181681 -17.720629439159861 -18.480082571484978 -2.1117416844137984 26.076794994883194 -14.177539877476546 3.6363603131432547 31.811069248081758 11.04633242680822 -3.5053349663475841 -3.945159496135108 0.23082602297247129 -23.261315327861418 14.677503321008821 8.4531088701088688 -39.329492754458492 -16.672580999483849 -4.8641031597129798 -10.444733475544524 -45.614349280775521 -3.6118528468712996 -15.346819848818045 -8.0757298235393105 4.847511988268117 1.1174570369212729 -2.2933070151611128 -6.4018585721422463 18.202071316544242 -6.6141661943594432;-0.0068788118124385404 0.026338000057199048 0.013729654589299227 0.016393673788087041 -0.37136150787850608 0.00050671901243025484 0.026910322875787009 0.23647576608981383 0.0072345451830991281 -2.9900841040210548 0.18162369041134355 -0.0081213830107855073 -0.0025657441078544042 -0.0095291017142642345 -0.0015810623408628562 -0.0099058869613343238 0.051169963712460569 -0.37251820282257458 -0.013586877192213036 0.025840626732230261 0.12927946940996857 -0.03961528009869536 0.0095126278078816046 0.04477836712676668 -0.098494901893371609 0.014372211315418892 0.10529049091007374 -0.0022358937647539872 -0.17116305965534459 -0.16123953319848186;11.372216287058937 -33.695571236488618 -15.839202751418796 -11.49388260308594 1.7284052572320467 32.842368600791772 -3.4742907233133264 4.8923037886352994 -40.866247333068237 16.327035043299425 6.9973906207116432 -17.115821900603418 14.372705980185318 -2.3041811242653178 -9.4546273399383711 13.126891329534555 1.0743754218243247 5.0593091546056854 5.2554774043057648 -30.527085712503112 -35.777949803446106 12.891573288369715 17.829266306441593 -9.9455109717890409 -55.609002491745507 7.4850052739463004 -3.8367466600250468 -1.1394963200389934 15.858807109875361 -6.485630116253815;7.8823406072539344 -29.734903352078423 3.9921607495138565 87.204692514382984 -18.639269042187355 -29.2562543658427 -7.3149051370122997 -13.339771722551937 -180.50233274095615 3.5756039018641759 -46.580124857758037 12.82387902321552 -68.806191093885602 33.155363368048043 54.367578031764779 -44.691492104850411 1.7062764618909161 12.793799190444918 -91.074260659405681 111.64805814558213 64.143164830618019 20.282637978588959 -19.10153593529817 31.498331571269453 -19.865031412396707 1.8217424140816518 6.4341607860006418 19.563895660733689 -28.046547401385165 19.066679214454215;51.040343937772015 -0.47384819868890993 72.186526334003744 -79.248385795983552 -6.4162583390037433 9.9210129736879367 37.897938498805459 17.455062066229086 -86.563937827716103 -27.464431302294646 74.452130561938688 13.454021566796177 33.025753544957333 -26.558687402755449 -56.686236031844295 14.703386797386003 23.001439466968176 -34.772721907282104 -43.605353234716929 -16.021926369686998 41.957792283047375 -4.7906333523959264 -5.3800655861116544 -35.920412932783485 -67.549847845213733 -2.1025242940695161 9.7112375629143788 21.488930953953215 -22.253301479235049 -38.892621531851489;-54.373458902662605 2.6276165848665274 -12.486399331740559 1.0989190223736245 5.565061945115918 12.549466441795806 73.717230724745235 -2.9676169036240503 -96.256541212138245 -27.431399829586958 38.41256341358649 -5.5491293872964151 -62.66593886912213 -19.832639651290826 55.023451918738367 -94.548693573360509 -69.3349378210916 -44.826530025100716 31.239380208708884 16.592580902071706 77.841493617579417 -19.938957115468945 -31.814440905607697 -63.150675061364829 69.44814166113477 19.454855812016518 -8.9844449519853917 -41.833928618900607 -54.181098864382747 -51.060271907109822;0.47827512590751414 -2.073432202694466 5.1436266803637851 3.8925402492841052 -6.8988280211809938 6.9137773473270165 -5.1780419440197152 2.8009397069211968 1.7834332926293988 2.9381534182956841 -5.5550382080256879 -6.2825585894769453 1.5727508578558 -16.326058158061294 5.4118236689981254 19.473342293944093 -32.091704364076172 -6.5553650133771963 -41.584688706815406 -6.0258827927661267 2.8450915505432799 -2.567999022829452 -11.973661086968697 -1.3084351190505352 7.390876770133521 0.94405059210935138 -11.561771404532623 -0.4652496699274124 -3.0799554567891891 0.18937411550786815;-18.621090367394945 -4.6632669837937417 3.1758754630933392 35.594589192706266 1.9064620144759896 21.016542816956644 27.062671599190558 0.45751491952455997 271.68316197820883 -15.297282218714251 1.0772574877407977 -7.7637604970663787 -9.6845923787374346 25.954682650834478 16.165251845428326 73.839280871463288 87.780421346422457 -0.76080492266792965 116.53075825303215 -22.404112527772565 77.148562580787299 -10.743036375114094 -4.6480403746702521 18.326924788908173 34.181085794455505 -12.313267453201986 9.1096888455202958 -2.219198106603538 -12.636121278702685 -11.72772215433656;-5.000197946743322 17.500731966416318 8.110375292643214 -10.077222468122226 15.290904997306438 -129.01285398630156 4.2962017618287556 -16.823303088186393 -15.237707851978442 11.838436089523821 12.141475732021977 -9.43539755631482 0.13640104128798744 0.73410274861307423 -4.4929293203811564 11.390436609686946 57.461007874939483 16.87134222918089 32.368554552503348 -7.4623008931217845 -33.177837859425956 32.04895639903237 10.92363873955394 -9.9347509294316154 -41.356220936303536 -0.060196559481668348 3.9602772747127579 2.1180208209819082 -4.4946604567412205 -8.8126959076012614];

% Layer 3
b3 = 4.8971772177158606;
LW3_2 = [0.013045257546477658 -0.0005627277884996787 5.9015708185298701 -0.001765720212147283 0.0016331969009066272 -0.0010071695637438899 -0.00034581349320946013 -0.0011183394430890473 -0.00070915413731267407 0.001157845231403288];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
