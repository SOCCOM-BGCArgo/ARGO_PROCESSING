function [Y,Xf,Af] = ESPER_nitrate_12_Atl_4(X,~,~)
%ESPER_NITRATE_12_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:36.
% 
% [Y] = ESPER_nitrate_12_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.9990931340999416044;1.8463636299636017046;3.5952633409280370103;3.0130460349197938363;13.072508985288225247;17.949522519650265906;0.11577445547654528768;-9.0653770823144785851;-0.58036511202355678396;-10.043039899587265396;0.31707800503608923881;6.9221444557282394427;-9.9078536071848066769;1.7816514984235336527;-2.1717454451682467464;-3.1869136381329847829;-0.5808600704253790159;4.5328803593057305221;-1.5990603095453377325;-7.3940754609848724499;-33.559916408741727878;3.7869511156863402412;-2.4917427056481518122;3.9917866502691299324;-8.5475669286766251531;-19.437564604466530227;-8.7663096616775870729;1.4074147681159436818;9.8878692091793443097;-16.34472636121688538];
IW1_1 = [0.93809675471930564772 0.68786390557336196672 0.39974266091376431387 -1.5381228029929199241 4.9466829213980485491 1.7825918502716362468;-0.036987911851604028668 0.04788474352148105323 0.10782675032661537262 3.3101192256266678271 2.1466833713016875151 -0.24154207699151777899;0.41552972534580251418 -0.26989689634758778913 0.33876087471995702805 0.37527871502548160176 -2.3601390127768757665 2.9278728806566594045;2.1217899013792385077 -0.60539766271816519705 -3.4148112335262967854 -3.9171190582110968492 -9.2296667388450313041 -3.012518674110438166;-1.5934470693193625301 0.9154219931987791492 5.704598814124715922 -3.2728508697861364851 -14.600630393627378467 -0.7062204391955219096;12.829109806676298078 3.2664861597268752824 -4.5861618523116289836 7.901186125569864771 -35.506246454423177283 -2.7840436728325501647;-2.4107906096305202759 0.93444324888564989084 -1.6560701660333057017 0.37428857337632903679 -0.39441352444988736492 -1.3946415175630371142;0.54957168825433722059 -0.11314896397180501664 0.14213677146518668981 -0.2154836551217181595 11.007330540551969023 -1.9642706007838675042;-0.33322162557986673148 1.0575531381905278749 -2.0011350861380883259 -10.438598359734958976 -10.157514556249479298 -0.51434998302201373477;-0.5278505939202610131 -9.1559954856883791763 -4.1979475505038399419 10.096977407466001253 -10.090070837673705384 -25.674910981507874652;-2.2185025439217800347 1.6194004318472705606 -3.8990396664749153999 0.52694632370727134685 -13.165905194061211958 -9.2572173052260566806;2.2160782931060092338 -6.329927725118556836 7.2183282979948728553 8.3442055124719693993 -4.8573459622900161392 -4.455363953443268521;4.7311111112513195565 -2.7961044306575764118 3.8515424425758819638 -0.3949116591221913386 7.6427302481525600797 1.9399494443970768387;0.80314198052082386159 -0.77210955811896897494 0.49870950168496480659 -1.3635333107876652647 1.6185995865504860802 5.5007135101041493286;-0.30270714812550908457 0.29316157563259870322 0.44091733239808045264 0.9981280268192813665 2.0445755343601392795 0.1225041959917161638;-0.24215339624904252958 0.096992778804115983848 0.40844835477791135991 0.24664622503061142678 5.870865914170802391 3.2014086057739001845;-2.7885201098208867165 0.062411774285505434989 -1.934503091261573049 -1.4017803875014480663 -3.0683864364185966522 -6.8188637689970530431;-4.8456363420611054948 -0.93002842638790328422 -3.2828145906414740729 3.8237129940744751799 -4.4663053497770954792 -4.7973726215341780943;-0.20198329497787201325 0.10308559925800543644 0.079476712804530558198 0.22097794308085419446 1.5967414782221542868 -0.81499754314963934743;2.5267531815810544416 -2.2731117879296354189 4.4056079175349358579 -9.1081437571618835136 -2.0781084834316718712 -1.6438018161567600206;-1.9396549369897151394 -0.73260334814276273363 1.1767626434719391515 5.9351216384574012608 7.1995935253078995331 -33.574027607193599465;9.4949183283812086387 -4.0478397245271651173 8.7512434829420282512 -19.571269354213828962 0.15822416900875230228 -9.0488171348660060289;-0.12061643486261851288 -0.12741261421302332857 -0.48370689251338661041 -4.4977587391563993435 -0.20938208302791899706 0.90263615844565947555;1.1369463510904143089 0.35332295028499255407 5.4885845792681253741 3.4523415875959613253 -7.5740263776568328424 -1.8868717344674550418;-2.8387065557061954557 -1.0870576964750617854 3.1848704526518161195 2.1217408734106681933 10.032257092563174439 -4.9580741632927489704;0.21601475966791139349 -0.16616838421551469174 -1.1572703236108585756 -5.7968169999464302933 3.3982613568911754776 -12.281246151147209744;-0.48614059508698026502 0.60102552825849020479 0.87813160481183727413 -4.0490486425777580948 16.12618368725628315 6.2610349051181684032;0.18447568640343184332 -0.095115694972501121929 -0.1306440746584733581 -0.36230244274081302436 -1.1547745060397256456 0.53465632053118572475;1.0879809695951303539 0.11903916372331813101 -3.0101278080104227897 1.4887990622486220182 -12.285668953832486139 -1.7963207602475717017;-0.36191533102955197876 0.11999482244192839764 -0.57923617491031076376 -15.938095882696275751 4.2061328734002518814 1.042055980430575346];

% Layer 2
b2 = [50.613515217981394301;69.015610369799020418;16.863718528281594899;-16.367621525445684938;-8.7616994036564079806;14.194768765102089958;2.0978301426652703476;-4.8396014594783585139;2.6472989334505188097;13.35578917010054667];
LW2_1 = [-174.22204898423470354 -98.651341950611723064 38.301234220725163482 8.7326573214198397466 60.785082972456635275 111.15727938863008717 -45.97127428133308058 -9.9379844061293258761 -13.464858043322688985 -1.6936218533587072965 -1.0742141377606675423 62.961289862831939956 26.514792741230827744 -47.574045503144162694 9.3223417837229849425 -62.123005369982877255 32.159596341990791757 -52.338455573699974366 -13.301057397217521228 -8.6656740062208168496 -26.392965058768403708 -13.835646694044527294 -51.141794238385521965 3.8731753215195507956 -53.022534187469631206 51.338440500104930209 -8.6292527828394742784 -66.156049007242344828 -66.18701848760072437 28.126623920932566136;-15.416328971500096401 16.719284726840534461 -40.485777522972171028 -12.068891520426083375 -30.90721729566176279 -18.502173843927067765 12.214216411818833663 17.242844235168551137 -0.20893407645404932227 -1.3210451505909952541 67.524701946953655352 -0.92559799806308840076 4.6994994989671887708 -9.7084075336373025777 -11.535488588928135556 -13.327509208448859113 -9.8711501150719733744 39.040335058352042097 5.3127260607197355213 5.7480717012267641408 44.090255621614950599 -6.3620902513647807908 1.2291151964184277023 -17.474902696988472428 -35.202404776133896291 -5.7683937975006918109 -40.638109680418750713 10.403059677188734256 10.305874343558587114 -1.7548579048984120909;16.873043875614033738 -4.8175328984873582172 -42.893023257588225761 3.1888278607954303467 34.676045876800998258 140.74759891696280079 23.232021869176779916 91.464914565171852701 1.4539870496593680915 -14.742378754822867748 20.034636278709673007 -46.032354896120672549 -23.317197101466049958 -54.804975344587738562 65.76286338242447016 49.871125601853286469 -23.465202446906655354 109.01639080126881254 13.664452133008614609 -58.715301120821656866 -72.528555914424771345 -9.8378294806740100853 15.616527713311235459 71.009179516310595659 92.164836385321393664 18.430718252674950008 58.700131406822805502 -21.323192087619919022 46.501336019380339337 24.589327925061905233;23.79478002106142398 38.50058833491927146 -8.3435276580668009672 -2.9789653344312805316 6.7095765238349338588 0.21240250250445669167 11.76819438581059174 0.66710665160972160148 7.2708693907764487818 1.285736547468468105 -10.861173822965001889 7.6892620075679012359 0.74830471902596629175 6.132626406130158081 19.703208346265146389 -6.54924782983543885 0.48387261260147107489 4.0280673020219133207 17.19731023962084393 2.2286074496225229957 -1.2938033100522463581 -22.255081583147727997 -1.2074254231087886424 -1.8713355517602507927 5.238691384726775091 -5.5089483414427142804 -1.0060592568492490173 -3.732534334799858744 11.801699098344450078 0.60366464784268947241;2.0385447478036256008 -39.864934586880373502 33.465949078561799013 -55.877485707310825092 141.42299770080975918 -33.22974396025217203 -27.838617707967664217 -4.5197563021503670555 -46.289235919162642574 5.1778000959208885234 5.6904111289082113245 -76.960294129507801131 -39.565576114512104766 -57.460340079894322685 7.2715064804220679306 12.192201023507298174 11.687305967711164811 -27.593249844641487556 -44.328665331537926875 -14.359191859942994185 46.309309750025192898 -48.113837234855871827 -23.048728784908803391 11.432887237158400495 -5.1489322799847965229 -52.338068649595392401 65.785092115649845823 16.703353398935274043 63.725866339900100854 14.81278673808741253;13.401598987953521558 -13.079603191063263523 -22.476194764437984475 28.064175362452708384 21.847494555447738662 29.887931178401526466 23.62968234645712684 12.992563033070689826 -20.398890528399956423 30.037259527531865899 0.63477092972274229421 -12.724180741731766275 6.4289451348293544797 1.0468025415216180019 22.339598029710771243 -7.3266105035812305601 -16.864946286256806474 -16.790035143996902889 -5.778272630112170738 -10.293877175649130962 -1.1846759842086991288 7.9304670795550755713 31.143691012215445113 -3.2946431780477398732 7.3788602387793638115 -8.7472248197912030321 8.1084564687609059774 34.128695121466812168 17.028187315169464711 -29.954297741158178781;-0.23336189534792362021 1.1637554737243365199 -1.3653522530069301943 0.17996390840955908685 0.19255810406978687843 0.019721536927599626898 0.13411389045705118805 0.42157997795306967337 0.1328154973701227981 0.0097561519278306155223 0.28895664609642318643 -0.070263564590831689705 -0.092768790375791276848 0.57600924670475539546 -2.5407567929619356839 -0.41307899383317114861 0.091824823034458741278 -0.051711196258504940615 -11.73860834722714408 0.094695340102019673334 -0.12948225610700858645 -0.098159286839222578691 0.24976213378133144127 0.11442301669988165502 -0.10638418462656448749 0.23777236764154469073 0.20828118792291544503 -15.556841734842619118 0.18507487029298910763 0.096272779255521925834;-10.972164921548190009 -21.034973326141631844 42.806444354949640285 -18.577944597268434279 -60.754492647341955092 19.82368962522982514 -42.928635833604161576 -24.377968307897983635 20.197902811505141329 -33.703621140710026793 -53.599687065165539934 18.690348927774952159 -7.3715796165056568512 16.724950843069073869 25.739524570512802626 -27.688029320522023369 -0.59089953822940921579 6.9397900692385086074 24.201628083042738382 -10.84695972965373123 -17.312822261227562848 -31.73136988206530873 -40.977198419376527738 -5.9496774747811143058 57.667771540947533992 0.60347430198799367762 19.001359568116701126 17.390945529471199649 -36.290976325127076052 -4.6217859260929907705;-0.28258730904317058696 1.3038712962225265102 -1.6232340315142110843 0.21942962829518383727 0.23271105552211684975 0.024597942515864917867 0.15632561972656394689 0.49418951441130182234 0.15861978033950638323 0.011905420409774648133 0.3482319203695718457 -0.085631290666521919785 -0.10792906796257725754 0.68998538995314384614 -3.0527887966518179041 -0.48554337705363781463 0.11002990153083024027 -0.062494545135070973807 -13.863304052759181317 0.11739913886754042849 -0.15530251899411293137 -0.12186830330865139338 0.27416813932832162504 0.13927254962845744823 -0.13197217261147223266 0.31296367272409059135 0.2510844648047138028 -18.525527652196760897 0.22795663812220595679 0.10621928075170618266;46.787439722738909609 30.133031984148683335 -48.042043197278630373 33.635120056814812983 4.8386363608518019319 6.7574164098704931902 45.752189027527990106 -36.267051611949554513 30.80830757926017327 44.90412632781819724 28.905212648280912191 31.635791704746399233 -10.325794341460522219 -45.162212066174213021 -66.043563589312739737 45.51443145708918081 -46.426529212691612258 58.10157129614680116 123.51795389258421665 -13.892721946881046335 -6.8480533919373103302 -18.864595498000380047 -10.398902453066348528 -61.424853098472318891 56.963479599293663114 -30.493353345583948055 -25.227925536681041763 12.305890303579678502 -0.36685276406903810642 36.892748813299405697];

% Layer 3
b3 = 0.66119542615337267844;
LW3_2 = [-0.0099580739327865940708 0.0067039764550522844277 -0.0012277841029824365909 0.023546161447298132041 0.0092490173893310535097 0.01849959176108045486 14.102059720962403233 0.0049557700700034890834 -11.50358131437096354 -0.012465242245602475499];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
