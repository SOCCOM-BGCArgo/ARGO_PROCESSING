function [Y,Xf,Af] = ESPER_talk_5_Other_4(X,~,~)
%ESPER_TALK_5_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:46.
% 
% [Y] = ESPER_talk_5_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751;-0.9;-133.803853032615];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0584431850247228;0.0422119037568594;0.00432440760873659];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.6607450884036825;6.2693250902737798;1.1473319120640888;-2.3594331688691641;-3.497187137491101;-0.6141979862990502;-3.2653794908036753;0.18664819001312039;3.927126816422112;-0.3580316056904071;-0.97316515762597666;-1.1546085800908181;1.0049749859404544;-0.38206710769173396;0.65779213863725294;-1.0998975305248182;2.4898250621377169;-3.0131714427377592;-3.5965332965287469;-0.36950470202764207;-1.1888441168161625;-0.22554463198287603;0.31619600256932578;-1.9147274319974759;0.31392941727971624;0.38161270125110996;1.5527401427933112;-3.2242793116019319;1.6309497206450339;-5.5541288373604711];
IW1_1 = [-1.3896101890815444 -1.1576298243311984 0.98451199582850246 0.25929012423935299 0.27927166411466653 2.5038058701307313 -0.15097557653939975 0.92084231228798896;-0.064516391119232783 -0.1829295118833022 2.6248715043030515 1.4527405641181614 -2.0643685642684813 3.8756643098800514 0.93600378122002903 0.069148943177198302;-0.13702834827546306 -0.87749278672040076 0.75777021512319176 0.23402218736570743 1.2206887973244949 -0.34941672047860983 -0.64039751968104441 0.28056246894503073;-0.66603889325505239 0.43055143149135433 0.87742865032625061 0.2576490381169026 2.6990690399654591 -0.36620219257684589 -1.2204211220036363 0.62023100382248175;1.4459573659763796 1.982610395811558 0.93123078849154095 1.5503533925075683 0.43790689708932051 -2.9799059371436765 -0.52341519817639459 1.9218158205846876;0.080468267696850351 0.30513705821688003 -0.11376152356371994 -0.072946610345767937 -1.7769518242974864 0.018123353394593034 -0.081802506727551308 -0.45941152606989211;0.75972659242420892 0.54401157868263728 -1.0099431984666485 -0.028297316490792278 3.8859553351282647 -3.4751194903230926 -1.3552243024329163 -0.081434946385499807;-0.12155660147773155 -0.32274544081192719 3.0942410880324926 -1.6202712803820898 0.52537755030808098 -2.2084366625362963 0.81627425336602322 -0.3867240440937264;-0.48741912647459085 -0.31309503955674517 -0.2533535432696829 -1.5078382765001068 -2.5581486663235395 2.8000395811391559 -0.0068190364351251101 -1.6819010297618511;1.513828119541796 -0.45181519174894302 0.45949586897555278 0.41694376731326604 0.63053007680705697 0.15896508351290481 -0.47790984829348582 -0.29606381882285687;-0.098113066907213942 0.16039673211996433 -0.33556143491907919 0.41040855008959637 -2.0963668352775984 -2.481586594433173 0.12222760613519063 0.44645294162388766;2.3203495207183766 -0.5310873960714767 0.57657526773819312 1.8650551444472758 -0.88856137233114396 -4.2818208751691822 -1.3501823273711808 1.3555205390391367;-0.21684170246129858 0.3118298895600643 -0.71153436469052711 0.91757019882570445 1.8255836855529581 0.55203697533591245 -0.15540798260734756 0.66539455591646868;-0.30409739674183817 -0.28134066013720072 -0.4584955098917694 -0.66378241904553281 1.4253964689434249 -0.33959697877627976 0.061874501626995933 -0.07692846389879697;0.77884501809112161 0.18790370853888091 1.7242105360342646 0.21620059269068787 -2.2571523859702483 -0.77920467777036528 0.57458354524627797 -0.78729301451126632;0.036815246080609321 -0.12277329283365082 -0.78506471327800698 0.51067422791886885 -1.8539120026489928 -1.1990601456984533 0.1873638773616764 -0.50557624134525736;-0.70352812848840041 -0.3020080470839604 0.42922825946224169 -0.39647223594539532 -4.6859981575629126 3.7828141447050951 0.48559321113944143 1.0220219996404558;0.24495024747925095 0.138705827339625 -0.86147062435104338 0.46402476221765393 4.0426506561803039 -3.9718513042404808 -0.56785952004638029 1.0357453028141681;0.86453444641362565 -0.36514909183877109 2.0254568254067906 -0.64961954392360088 7.0292289984970147 -5.3157872219670628 -0.53779362876968451 -1.1787040365655563;0.48431557896444399 -0.20106600449666009 2.7195154639008168 -0.02966041083095447 -1.8806090387814782 -0.56515417253624023 0.67534759449317838 -0.52360407188038383;-3.4423017340695394 -0.44828982167470965 0.68110651111532738 -1.7110272465913205 -3.5034536350456782 -0.3127841503726036 0.0044034553396226795 -0.3573989341422168;-0.083896415839837618 -0.15586000312269824 -1.5282488152032236 -0.053532014686971073 -1.6984980239158047 -0.72767428429575243 -0.34358871573109484 -0.80813912378061747;-0.13968782416626874 -0.71978695014102512 0.17899740980644938 0.068251487623234269 1.4232422083239455 -0.39466789644970263 -1.1093679502688207 0.29678601295076446;-0.69478715261605239 0.087192122756026835 1.1431602482225551 1.3888316204974542 2.1970763072857897 -1.774783956973949 -0.2941457486359158 0.68501025834144502;0.57081732779879302 0.46411802407619274 0.051558221289446787 -0.11676720524774192 2.3761974199998797 -0.67566327531914128 -0.31752851002398347 -0.39614175519385192;-0.5732952813981439 -1.3186106900888173 0.048184764810082353 0.12787245230657854 -3.0604888140313635 1.0872546358532633 0.64889602146063197 0.03861712961658164;-0.004993590135555153 0.10585754930713995 1.9973050326333832 -0.70204287219479566 -1.7561770688495306 0.1410698118000891 -0.58557344757984764 1.1721375772417355;0.19352617900692973 0.14240566659258908 -1.3783258806152139 1.2195073443176996 5.9237633654218325 -4.4739172493544723 -0.62905606665648361 1.3847548551680449;0.64238474104359611 -0.82911302525338282 -2.0399755581514256 0.10687080360270042 1.3754275747524076 0.51520554031999044 1.5882187381288653 -0.56233027509073308;-0.39853127972585717 0.18640700229295437 -0.080158967198079217 0.8500903886847857 4.7059704622341956 -3.2884989494381731 0.050132123931742385 3.5628299572848583];

% Layer 2
b2 = [-0.43432252819088618;-0.089082754756157456;2.652980319400108;1.904551522661186;-2.2612217970125532;4.3129533669454219;5.7762361481082465;6.5522411829383325;-0.89657427005114987;-0.63190491631584];
LW2_1 = [0.67154744906712671 -0.4530604408901262 -3.7693965896466506 0.68282066375534056 0.61770763233498238 -0.13075557635120699 -0.65498158008624419 0.14184789992050331 -0.58946230872129057 0.40333370569081761 1.9380514204236814 -0.041499052971217157 -1.1412521314838131 1.0175762708438034 0.82692580346392519 -1.5100972604173091 -0.30803372015973818 0.40289813475668268 0.04538267840155974 -0.82226462048336335 -0.13997369553876454 -0.70516561510787346 3.3391497936971124 -0.22267106288173782 0.76347993413754611 0.051409816097602853 -0.86171455100144323 -0.44507252817279797 0.73347549210166885 -0.27626629815893022;0.13436735821142523 -0.25396497159374093 -0.018538943041943336 -0.43913669923632492 0.074215117688948187 -0.20987594129008416 -0.03594382438072926 -0.034139426230335772 0.13480751295110346 -0.082732878954010186 -0.0074696172350739772 0.044684966657028251 0.0040534859806672001 -0.12175185435600806 0.074554440770351518 0.46783619692458089 -0.066774765629075097 -0.36744563254101531 0.0076859926738198064 -0.11841757488230656 0.031396630763024271 0.066153930455814025 0.12395726820147236 -0.13818841025909187 -0.42274165814000003 -0.17426038217887502 0.38826758022448149 0.18362624712022166 -0.12362397382547556 0.03248719584095363;0.71569708279437616 0.54396076762289736 3.604603357086348 2.1870533305842943 -0.64244644528188899 2.3570257543042943 -0.13729093713452264 0.58289996740530148 -1.5302796194349424 2.2995437524270463 -0.83096303685767026 -0.044610133755146018 0.49189602604334826 -0.12473474559957504 -1.5885891589575232 -1.3237236012724265 0.56513466354042163 4.7117055358320536 0.057246075448267063 0.5613579970617143 -0.50889258067777488 1.1713961689059007 -6.0156742536790437 -1.0202571349352789 -1.8830026261612294 1.046375123999042 -1.3252053095255936 -3.3173370980921 1.2389751915778608 -1.5057250373997075;-1.3311677626128338 0.26772614075075241 -0.61132100979687376 0.89769704337320044 -1.070936052519607 1.3685623115992867 0.67126347864362645 0.49447679912367093 -1.2289007621644834 -0.5707451186998499 0.26942387890771435 -0.34740234107109569 0.9238772376429315 0.44420257647547795 1.0976974799904733 -1.7485373453515718 0.55991994847274307 0.60980900836536578 -1.0724281668305702 1.3710319487681801 -1.0346290052772278 -0.045722506632411342 1.3109155322962847 -0.20210809707815525 1.3860983281626458 0.15311580507265404 -0.74881551123664958 -0.48446418764800953 -0.54859910151431934 -0.30799557206954237;1.0577975943190854 -2.4007330233105892 -7.4028479923070423 0.077815635390878768 -5.0993372923275597 -1.8400471505222122 -5.0444183344987072 -9.0971981982060086 6.3249037632388667 5.0076204863696354 11.786388080505988 4.5914866732693547 -7.4660331636408639 -9.4410664296481173 -2.9452073634717326 10.386789603315824 -5.3680872060899247 10.416196124694471 -28.297362056297217 11.822245399331843 18.492893951180434 3.0330860641114423 -1.7102149689504926 -10.1303802523074 -4.3542479111299333 -5.7787858842496549 13.565782976156271 -7.628562363794015 0.30472293798150485 3.1334935839149032;1.0918459710966466 0.30929357453254086 0.89879457743535196 -0.21032129623026211 -0.12246138098270934 2.0552305803262847 3.466146776233332 0.75011262804680412 -2.0008292288481222 -0.43698041502510349 0.8330018860853674 0.15045716124194639 -3.3062649561451329 1.5368257369984195 0.56205459424172988 -4.0453840004039998 1.5344753568623219 -3.6601932125716212 0.20477419859219451 -0.80720311211101403 -0.30764894502479856 0.069403787039516524 0.065571599956310844 0.073014090457362874 -1.8551404279038988 -0.54208632414073132 -1.6237294706707999 1.7082614577044395 0.78306304908378799 1.4792240165774537;-1.7698064170817531 -2.111164908256951 -2.8920323237350454 -2.4838892918223272 0.70110367441547683 0.2908030229743101 -1.1706617282878236 0.84478672230825902 0.36367553106180744 1.9354196047762708 0.80579401779500892 0.266274030044162 4.3397141596292732 5.4749039349447557 0.39073831553996918 -0.53766610476774113 -0.12992888040474582 -5.8118469487486761 0.42639507023781448 0.21130304479183148 -0.6901625339804317 1.0210929351268463 0.19040846216801 1.3252207121474229 -5.4883879781565525 -1.649218577376935 -1.2899801410927749 2.7989291993885672 -2.4436260669288394 0.87474570899835513;-2.912108354802553 -0.6333840966234433 -0.53416549233420296 0.033964867890356548 -0.45516310331257864 3.8080832821017871 2.3326069642323799 -1.6126319530160032 -1.3942773885479003 -1.106187542939244 2.1868282500859304 -0.047952112310219744 1.5390970228723122 1.7508394746818807 2.5123839641487602 -2.3374206090315175 1.9414820331264242 1.3318181529547293 -0.45134745901402035 -1.3271935898154523 -1.1215820823187597 -0.69495301873436488 2.4466704776226553 0.3351771910383447 0.52533850974502316 -1.3169658182648505 -0.74013575481398919 -1.6160258010723874 0.76494333332086684 -1.2543443250401312;0.44817685162228993 -0.7897651872323258 3.0252499021621078 -1.2665712337107002 -0.1402684363551463 1.8904166751749605 1.0996686347669391 0.074889749622569862 -0.16142742683829991 -0.19889437505074764 0.76284358562566101 0.37271022629454081 0.81039587678427827 1.2215085285929781 0.020109417208761294 0.02886290585796436 0.92648478430188885 -2.6247299285793471 0.088805318376468101 0.089181547472448594 0.059863613198036895 -0.339328499133077 -1.6483955785607101 -0.91324995474747228 0.17663102871102801 -0.040452254018347573 0.74001279409347054 1.4748144302234345 0.067150661158180164 1.7159338149996595;7.1511308553734443 0.95828928748082887 0.55880374545313483 7.183322618539937 -2.1248999751633391 2.1795732442515678 -9.1446502938911109 -2.9191715462259 -1.8903884423408808 -4.5432691962142329 -7.5045019864529978 0.22577839145934989 0.042622060926838651 10.14415348838677 -0.14652159232379722 3.6047777703050143 -5.4590129562949317 6.3755633909480842 3.0127957826468403 3.8778591762380077 -1.0146574773249211 3.7110147770662247 2.0367854837903914 -7.3902409292578293 -2.6600811050213875 -3.422608219467544 -2.9251889730990404 -6.4809589664745753 6.1766431353103091 1.285840963967295];

% Layer 3
b3 = 0.66414891624089878;
LW3_2 = [0.19837301068666041 -1.4284846366915838 -0.055134710167828151 -0.095322064811098145 -0.0021107284745129342 -0.12146328988220635 0.06215893665944535 -0.18792318448147624 0.32803336724183119 0.0081076748165554175];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
