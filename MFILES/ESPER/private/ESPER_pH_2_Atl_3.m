function [Y,Xf,Af] = ESPER_pH_2_Atl_3(X,~,~)
%ESPER_PH_2_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:21.
% 
% [Y] = ESPER_pH_2_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999994516886;-40;0;11.29;-1.99149636107278;-0.2178;-0.12];
x1_step1.gain = [1.00000048738803;1.0003169936794;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0479365703301392;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.2380943103982775533;-0.95179722001162503364;2.4752033846123770999;2.4483027810924755663;-2.055999504460478633;-1.5265007419576948067;2.0704521995577049864;-0.63560751313315100308;-0.48373562423772553664;0.37877980844368086544;-0.67160801854075613537;-0.29642388868761687659;0.880993859073466834;0.40971872773874551399;0.61516853675333571516;-0.96384614030133630713;0.69426312555168601115;1.0704575980270998325;-0.53877553940395961352;-1.2572447105885500296;2.0892156972340960586;0.95850006717021152269;2.0772436319602971544;-1.8093900730652545672;2.1648844129836573025];
IW1_1 = [-0.79607620212797758352 -1.3083252975391308492 0.10023103031359345549 0.45586566950883938842 -0.84600846064868784335 0.077454239714930844807 -1.0635909219852592855 -0.77705298895461694109;1.6903649281850299246 -0.30107441893352637763 -0.93747195790343529342 -0.30618961016993245794 -1.684082841710033307 0.60786495716381150345 0.81763702805509608229 0.41969141561826706077;-0.77366770352730873661 -0.041310239135183134118 -1.6463288383124830005 0.24210129538931116078 1.1619633572700074353 0.83738149132959938115 0.73332096517958389459 0.065724847734589378345;-1.8152237106270696643 1.1977433628705009827 -0.22676028171986969961 1.0496680353667855456 0.36991531991048826056 1.7745284814777857463 0.20687110013880607995 -1.572621908123326806;0.049055291579266982471 -0.55924721587985815052 0.073464894015340009847 -1.0733015440650599537 -0.89026319569978573654 -0.4954277591867866648 1.6235963133547455239 -1.0514703745691245107;0.64037811135979760824 0.065496969014638181661 -0.2952901454464690878 -1.6250669120888070474 0.21941367325266505905 -0.53877248428006796477 -1.2577775927906795772 0.68940878254643256362;-0.26139139469109518021 0.54745468207504344171 -0.71630133796882022867 1.4634281398859341206 1.5072067743209056623 -0.55764099038723580204 0.79509333753373556686 0.2850869300007299878;0.47302073049006904126 -0.35968427856162238365 1.6976435554572846254 -0.34103068538274178279 -0.48074343275721054258 0.7484027048391981296 -1.1715876065394499328 1.4337112765212880472;0.71225557828569974195 -0.38880091754980111718 0.029169778893726010238 -0.54806790202662103439 -0.30208975842651886179 -1.3026057693154877715 -1.4118522947594467354 0.027323692745033760498;-0.07110661267342649472 -1.3324741125269190523 1.6904198181126250944 0.57757863781107077195 0.016990127100783385811 0.84247699130579722926 1.0082164518245257945 -0.060181395659552536226;1.0112640403945460932 0.21679414047757866735 1.9090258464959839468 0.33761199340628184062 0.68651246587639880303 0.67797068452933206828 -0.82099065507712187806 0.21949786109075705709;1.6501490958700821832 -0.298208606869142967 0.20243603213000394003 -1.1061645268569075817 0.97763871242009159346 -1.546644946066997317 0.99615546943534549751 -0.90043553105369433798;0.85751864247258602347 -0.26393334290322856273 -0.75353327193786956428 -0.49335232491532493571 1.7345798765628861471 -0.96635766582183302287 -0.98085876045534770018 0.9495386656100557321;0.29024678109108781321 0.38982347138879702708 2.0242886310532934857 0.26147477113261419213 0.50792350515589634874 1.7576970217964773546 -0.17676222511466380127 1.4357038272292867997;0.084933986767509600524 0.41383945133675809069 1.3542449014997279821 -0.95609120494672883428 1.1745758591330266452 1.1693506630626897547 -0.55015673385207886081 0.83413755432696978787;-0.30249461634420082845 1.1654411835215481297 0.96156760277645014767 0.41223587335373634843 -0.30515122707506764366 0.018460555393379415867 1.4041985116672528466 -0.42655101697866154575;-0.042024560091823121022 0.94868557412049769884 0.73122401894668365152 0.48956304994358124105 -0.6873968979684913494 -0.93539119823952499022 0.97624036538905556437 -0.45316485157314673193;0.35398342437937480032 -1.1771457735544732515 0.17468444795619503251 -0.66395257548617281351 1.1904197275567844905 0.41378938851007823763 -0.42712962000127530082 1.0628594754126097222;-1.1838117572302184755 -1.1758150098326400901 -0.44647496727272700801 0.36669765061904413539 -1.2160963533405366732 -0.62158434250140903732 0.72922679173752913417 -0.67236898121199473177;-0.61983893974615267286 -0.72121944130052662025 0.4240580778356695113 0.85395682235679248873 0.030053381166948521519 -0.16726423933826836676 -0.68329797280358883782 0.31361196004133601312;1.2763581464115014708 -0.33721143916352713799 -2.8890624325212885815 0.70178294009708708234 -0.61319532923469510788 1.5016502786681100723 0.53054703397921199048 -2.3554902116983242877;1.7560499646596858803 1.7261127221619347871 -0.23395270801133558058 -0.10576196615841845783 2.2943842658056627926 -0.66294328588573758765 1.1999825534124035631 -0.43004461228052542898;0.51579706995308660655 0.50178821894610958765 -3.043715620885341977 0.94887865987750097396 2.2443902406800555482 -1.1227680801283510537 0.91103521835085177205 0.63869203625211745656;-0.4154370195250288722 0.078911255791430073847 1.3396158370518780334 -1.1899954109066985808 0.84940833936957949035 0.53753834233055031167 -1.6897019777189110634 1.3475566326115471227;1.4996127985784752923 -1.5213865832068325101 0.65857470619500568798 -0.20727916214883174151 -1.3924810094330106747 -1.0636773050452259515 -0.39859976235596505934 1.5958877080121378622];

% Layer 2
b2 = [-1.4900496288843136927;-1.0747585182810583948;-1.5191066448125893906;-0.6328478961154606619;0.28634302568069547323;0.21178058371446323305;-0.53674495081429196564;-0.67942639418601924461;-0.022503308436420767225;-0.93338759000301951829;0.35488020739293080208;1.1819256257776658003;-0.69345896371436965833;1.3221048481021351328;1.6835226282857524982];
LW2_1 = [0.36676134961397405254 -0.67332251998384717862 -1.0699136056808749018 0.1191113031588787452 -0.37562965402938019999 -0.28922039488154394071 -0.30158252952386682688 -0.63660350607319826644 0.34199333566240186499 0.078288674366036925534 0.38587045268526959374 -1.0703961975304732146 1.1710142863777925903 -0.01470400987126331202 0.86478625463961156239 -0.39770679805331027312 -0.64391384028895259917 0.81586281308169927851 0.46773639984709125539 0.14019025502660062421 -0.025549476355543367101 -1.2715386048932417751 0.25023426345915050772 0.54004725225815508605 -0.25987656608671017011;0.7422820793403033246 0.11590697490380508228 0.53746901047726025613 -0.37845497231569730223 -0.061160426016154831319 -0.14086015764091558422 -0.038711569384465752131 0.25691179750769405077 -0.27394307570360737492 -0.45701463430369354546 -0.37431822117977586739 -0.91151422428353068295 -0.55903364207691863541 -0.26630201710058226672 -0.23913881770204342692 0.067687383978622922553 0.84362869975516274756 0.14611303933342420502 -0.12751155621152371333 -0.37766299910919187699 0.69230109545888240952 1.6095692947796003125 -0.55097046447474606889 -0.26652805343258134663 0.55087547705074846327;0.19003486263018529168 0.30988122803385886872 -0.37995097672420574675 0.17901387953780864559 1.0494510529925917819 1.0002396772951420711 0.91133901572400100033 -0.32401100622992701217 -0.36560879893989806089 -0.60523740869658892993 0.25937623255776581788 0.50029989876419977968 -0.3778610656846413951 -0.70563976760121538412 0.57780169290334448817 -0.16456243558444955122 0.42552594747312533219 -0.0737928894510163913 0.19115911024537834972 0.32786627665757922534 0.35705850672842992521 -0.0012107677202633122804 -0.40942167251148842144 -0.27616789721104462174 -0.35068280498013165714;0.44866479250380253418 0.48789917868500032316 0.68885649705985285696 0.1601429204071267709 -0.39273429004267257358 -0.1133619532253307971 0.1294324503371933055 -0.28389329329016133041 0.11583138075321282312 0.24563205740721677506 0.66913704774471605141 -0.22371760769819654113 -0.10893488308210651228 -0.18412373713352486737 0.74126138807622965476 -0.3871699717416932085 0.38804180469018689781 0.53203204688329330807 0.346115869958318223 -0.28311300918459753051 -1.2994532606948421272 0.48652261182920147897 -0.034060456809526996891 -0.097480901358623486819 -0.33474944357468439105;-0.22283083469655698416 -0.097095362755267144994 0.0027491003988541085762 -0.43489212049396741566 -0.021578005102524094178 -0.5398440097359819001 0.30698722007178963489 0.19643975482123998688 0.9619164500842662946 0.59386208558699593585 -0.039888745644792097944 -0.5789678032282681297 -0.56808738993387708494 -0.17362450740989854303 -0.24755598663345912414 -0.43921888081444193652 0.15989430943258753359 -0.44565628269301260644 -1.2680412690694060629 -0.28263587274212431666 0.72775563460459891107 0.65276485494364600015 0.47737288424214818772 -0.28019984895988503393 -0.45728549120842804099;0.3878556378710085184 -0.11119199473519655874 0.50317262159160813795 -0.99785762615892958927 -0.82152125772682527138 -0.29940631682710294736 0.86171036312530369106 0.012044517859593754927 -0.52983919179709260128 -0.1377249060918391832 -0.10626447561646333584 -1.0269284866363275199 -0.14052763433636111801 0.40946084875575616824 0.19725261225151338729 -0.65227105337544644126 0.24486526920172960176 -0.99019361907758252084 0.86891977308983858741 -0.29526080857507469579 0.65945150870628854722 0.71681942320337876939 -0.50937056305756667207 1.3100059076820500525 1.2656914110316288546;0.69925631067126281515 -0.031739831580830879521 0.58784019816447552476 -0.31656624446174752574 -0.66434339042610002224 1.0404931821105150025 0.25645394169597562906 0.22985796551463671955 1.1133088493844724987 0.25508980497081901184 -0.088302832927509886107 -0.40215379846245680184 -0.019608973279084857683 0.16612068653230868676 0.22654329347145454876 0.58996341846136424181 0.20800560041163357328 -0.46604339150880569331 0.5706322410819522073 0.61605087369521560614 0.015594981401077956384 -0.5999733634279005301 0.29698324994182351277 0.044220316222261316086 -0.12101704166167871757;-0.2801361230680549097 -0.43156549455002357618 -0.72445376316160758901 -0.10570693957653923278 0.21020862556592220804 0.21646551082595127946 0.49205786437859128091 -0.38054544833028897122 0.13313633548752507041 -0.21253448257069051941 -0.73336269073808646457 -0.081993317271746968267 -0.5557559096331774473 0.39523749246566625137 -0.53154965825720390526 0.46685862755734541807 -0.15659217429359451046 -0.14603969961064500183 -0.21745059920320344848 0.079045762498326038736 1.2284818963583366003 -0.55742295257212759463 0.60038996582130188528 0.48834959104209196834 0.59082388642429861658;-0.10486125932653674042 0.28743603692599772881 -0.59570701460488417744 -0.098024923010533865364 0.28432012554721131092 0.23839814444122645054 0.48812859451962281598 -0.9376294583857847087 -0.38117521054072034392 -0.12087782003382868679 -0.61672443590755154919 -0.53928212453061308285 0.39935116857449937111 -1.0354948374639336706 0.36091891216125165931 0.34325103009631663387 -0.010370594684853169307 -0.73681050037296336175 0.2917278798482708102 -0.26026986665775703189 -0.86738441706779456641 -0.34505487527934963765 -0.8807186939318391028 -0.42299236473474760567 0.37831052391031549931;-0.015479152376377241368 0.78830063188180832245 -0.21354516217985786142 -0.007943393038573991205 -0.0695311192627267316 0.4936358925200036718 -0.82340298619162788363 0.71857490157890824278 0.039301144257995371256 -0.92162838646171862944 0.24421812516012228467 -0.18588155820506618854 -0.14348571170348087267 -0.8464421340317479503 0.41184030791987036313 -0.34044088691817953052 -0.28216671538029286515 -0.03103508669763822489 1.2637766139613786365 0.43589594438659012843 -0.65071587083339299529 0.36906539445547859035 -0.23900702984702260068 -1.0878503760882609619 0.29384165703102516076;-0.60518000172253794133 -0.24921682028814862164 0.21096365118943882777 0.045941049907779668571 -0.51792544524565975461 -0.24045005202031052849 -1.1621179935982328679 0.58389890557625423462 0.16063636814932716335 -0.3950001482056176294 -0.37128819522345357651 -0.33820693414153568668 -0.42609174020150469842 -0.77832388147803766021 -0.72023378045948660553 -0.59918283992655041459 1.4266876114936595243 0.29468970122076276752 -0.10521405907800546187 0.29854051568053735499 0.75750124157650866596 0.88963525632320827885 -0.052610997450852452217 -0.9312553295945087406 -0.28873429651370413618;-0.063101496780916033202 -0.16570624502414582624 1.134321554758847439 -0.47895977121403776611 -1.0532220721034188937 -0.43158258305616509221 -0.17011474701962134293 0.28162755234621239531 0.42419406269776227525 0.23872863421565465591 -0.35287994545137973956 0.055108445761878219193 -0.017885846926747075297 0.49455311915906868814 -0.072895287355101839877 0.75808783852075944942 0.044629556984921034402 0.62126208599253618381 0.63332268771979594035 -0.42330070098677097246 -0.81243609473645961305 0.81814879412864338626 -1.5578888445232716986 -0.22093507774610890437 0.06071170397698785054;-0.19045908714635523262 0.051831142797685053614 -0.20322920009479097936 0.064190331397459776674 -0.2499119628658817982 -0.85471175385092057475 -1.4610300991271529814 -0.80903240156859423937 0.66579908594523640186 0.26185788345557026169 0.5817346365245938955 -0.17144609326468721044 0.61106221934896209902 0.63342382782110584483 -0.5308643374368382517 -0.44996186785987951628 -0.28694418229534246478 0.76321828954461190531 -0.16131171545281122737 -0.34691500432619926109 0.13736453511029231289 0.88555596349749365892 0.63360479435857064434 -0.054772144324766264267 -0.53270051521754435697;0.033631618133862048459 -0.30627955858980493442 0.29018091318513872245 -0.23006299350845305085 -0.59943649585922209599 -0.46315939891908647352 0.19136689772624254635 -0.062184989823434067002 -0.28559187120835538565 -0.17525993017988120148 0.21841031320320436482 0.0077112543755971140261 -0.30098336899656241705 -0.070880942433952362491 0.39411402642214482528 -0.070879717272118586413 0.6484525493916807326 0.58351752672528001131 -0.49671911953474390256 -0.23133326364610942716 -0.26630755866980793112 0.22062294495533063543 -0.31034850596960644742 0.12101040875386372131 0.3285421775777370712;0.54261968431201834662 -0.36380242899755038666 0.66305436891208691108 -0.22792886705745515896 0.68005674741399180228 -1.8910587967116105901 1.2991462261467210393 0.7551209289201021857 -0.3914729301679316098 0.68130465193350620012 -0.23689958086755444344 1.5110755379317795111 -0.63209421745230798262 0.80020177205641085383 0.29878607691391190215 -0.58045391647351574083 0.33108665702548767396 0.0055814742058696714677 -0.83923879168121395811 -0.62575632787409196656 -0.39977135744561231867 -0.20789859740067889726 0.2946765257020929063 -0.78477900627880781137 -0.47257554922722555535];

% Layer 3
b3 = 1.0954869721481879097;
LW3_2 = [1.1565862895489880113 1.8151172325542246355 1.154175099505824198 1.579537773692009095 -0.97909366102389883135 -0.73636383283890383122 0.66405712407972017353 1.8885489851271721751 0.85497503715697764637 -1.3390458733116399337 -0.78818763765579102909 1.4511712312884619269 2.2672830166724979861 0.97957822096423785574 -2.4979200771536134162];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 2.03830178109291;
y1_step1.xoffset = 7.47181919175367;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
