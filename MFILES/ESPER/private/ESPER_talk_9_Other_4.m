function [Y,Xf,Af] = ESPER_talk_9_Other_4(X,~,~)
%ESPER_TALK_9_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:48.
% 
% [Y] = ESPER_talk_9_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-0.9;-133.803853032615;-0.1386];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0422119037568594;0.00432440760873659;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.63755296805993222;0.75555323492203907;-2.1269399286387958;0.54320589496213822;-0.5815174103587426;1.7861896051467228;-4.0594732827257056;2.6491051952532283;-0.13536082939436278;-0.91172906361602368;1.9466970454440222;0.37060764935269852;0.43028763437276224;0.65924730112697794;-0.40416304792581675;-0.049696398227046405;0.39903570970141411;-0.4206037398571596;0.64750488220839664;-2.1531480248512689;-0.24764068823862573;1.799108691280185;-0.27010147045552929;-1.2755556855026831;-1.6072595232440896;0.18138000408538127;-0.96181763889012728;-9.9212024704673372;3.808292123977671;-4.6481267273438283];
IW1_1 = [-1.430573381859136 -0.89076447064197217 0.29334355504586712 -0.077770227155528629 -3.2715922463397882 -1.9503663255585777 0.99952780095264737 -0.70567794563237718;-0.14486800737636343 -0.00066931795310761627 0.25662021537858976 0.36524610106987276 0.060361639058201993 -0.097419223850847197 -0.71902831830738756 0.56441942798436429;3.263201330270773 -2.215404044141605 1.6877702541675439 1.1914416844466393 -0.10683934983418986 -0.41858353310810298 3.0304114615871836 -2.6661732883009654;0.25969526193083697 0.0038018039930848339 -1.237360130718103 0.22061707260806671 1.4312791289168734 -0.40061538849650769 0.19835628032871558 -1.0818834740754066;0.1299426640849691 -0.011407158459457193 -0.26485814391352264 -0.24647053181931275 0.15067163652143675 -0.100635402958184 0.76914931633626882 -0.49781356110864061;1.9395991956067207 -0.97613250692236864 -1.4060975817901611 1.1780271833558873 -5.0356041743244999 -1.6587128436110732 -4.2885475818451617 2.6687173825023209;-0.22333013888334843 -0.11317962733048771 -0.12553270370117961 -0.1965557331696032 0.47523371737952308 0.14065318526196566 -5.2473138985881507 -1.0863870141487382;-0.84460791954979897 1.9130730815446135 2.1505614689426933 2.4731059480679187 -1.0589210752783011 -0.34569773705111001 -0.17667656392188599 0.14144809137270728;0.068438691167228241 0.89172763054634763 1.637309743390531 0.57780010957816097 0.48475440373254797 1.6488971245284254 -2.0286247079915602 0.48240195502369887;-0.32473406953044287 1.859538714624466 -1.4856676027786433 -1.2952448990859196 3.4770912424094731 0.78268567484493934 -0.87572303870774793 0.16577463664353917;-0.56277959622056162 -0.1860251408766985 3.8916324289197766 0.33711335601487419 -0.2719131019656929 0.69938999819176684 -0.28263090520624251 0.37977518549779149;0.02367846783515919 -0.047771640237911486 -0.19270256076717748 1.3317995414202026 2.3997148965020298 -0.4752137710943759 0.84906741386011242 -1.1725617779537949;0.15329270312088075 0.052685334662293581 0.81893372068099146 0.24208347679777645 0.91209082295706123 -0.80930121094296525 -0.13975130544710854 1.0169996683132605;1.0268288591125625 1.1297870994983279 1.0159292345827524 -1.4603774983330999 -3.8930758184212895 2.5157336577297156 -1.8479399860600811 3.2394637832510353;0.0054471139038105385 0.028339180186619461 0.95182858583847363 -0.44768531032760461 -0.93564852480312388 -0.24175783124585237 0.084167629278609379 0.5119780324440345;-0.95804372862862242 0.69723791801316204 -0.39854688665233984 -1.0075127667355912 0.79882470555910923 1.7157660306595943 -1.9369429981547854 1.2957155959742057;-2.5712702435039332 -0.31558247175773102 -0.35178248081897195 -0.46621238215153843 3.5029253045464124 4.4744986010464372 -2.3324239511214122 0.82233610560998549;-0.0013737223553412865 0.027463108416218185 0.97551371437036449 -0.41796846823366496 -0.82124179019165078 -0.22744231672268092 0.069515259667361898 0.55835842569970418;0.47118734197663437 0.18205393120325716 1.8514528183296832 -0.21301812918873747 1.2474754219055841 -0.40674762451825675 -0.081288380517568079 1.331814706256047;-2.3806154046976715 -0.85428478822503962 1.2720954791411374 -2.4707423156908193 1.3808058633212987 2.1347158257285139 -2.6613493956577159 1.6798145943873757;-0.26435219637768814 -0.17666575575237176 0.4269099940217963 0.5002146465243138 1.8812325408237067 -1.1875198371615621 0.47578919665862235 -1.2592471667375567;0.29234828124031503 -0.11654265176910313 -0.14521721626986628 0.27778090602776284 1.1882174987925225 -0.80972756050045758 -0.98764177778514639 -2.0891910146449177;0.013860387010326885 -0.18402561097162706 -0.83620641405539986 -1.2694554527256241 -5.9137905568399365 0.29737479436810421 0.0018596444112123829 2.467874066849121;0.33191342946045976 0.63835611804885228 1.805395001000706 -1.602428578860394 2.0869592143192066 -0.50091271013086336 -1.4136863321558431 1.2887703349401345;-1.1224857529548571 -0.0036940491999463694 -1.6897342742809967 0.18932029281472634 -2.0913492012611812 -0.85669866343699608 0.41925043170612741 -0.69859126998780019;1.380654486918538 -0.64547047427658366 0.71611715747888383 0.4488249031483792 1.4175870948518425 -1.3272851643319419 -0.016946825229142995 0.84618160835281564;-0.30354752276968033 0.098604081717204181 0.5372763503110356 0.5576328372957563 0.39098188724331695 0.21652047916476852 0.6820319606192331 1.549042470563514;-4.0355257327191465 0.31117508474605216 4.2169769664861425 -3.222646124653203 -0.90249675972049936 -1.8318017321069431 1.0107529291218473 0.76808515340556083;0.60983818082629559 -2.1939587992520484 -1.8897085685028885 12.915620878426616 -4.1343203615706514 -14.556299052172935 8.858547476601176 -2.4003505239258986;-0.32552751085322035 2.374375453066611 1.7470720472383903 -1.4075425455462638 5.0849574918914797 -0.47241000064100491 2.1330371515957856 0.47611396347970197];

% Layer 2
b2 = [3.8282920036728187;-0.46570520700565732;-34.864924917637701;82.540843074752743;106.62380097173758;-3.9305282361470306;47.672783477030265;19.147178834788679;-18.440314354495669;59.572066713067365];
LW2_1 = [90.130588888205438 4.1239604588731025 57.658170092957469 -56.103318294963181 10.635309979056631 -93.981341532886944 25.336198056402512 -30.271848902351145 29.12455428801869 32.313650339443328 -34.411150704034753 135.39401437638372 24.296961491584689 8.4554563100688576 57.255008613554104 39.962306613161168 8.0714264037425085 15.752327940859491 -120.66904361701674 -2.7105857510174358 -19.955408495482548 51.850452208277552 -29.709256263401286 6.0872841899795569 -11.225049064950428 -23.334046315767843 41.452192337063344 28.775398325220866 -108.26522909261539 -8.1154103448289376;0.00026222971318753377 0.5957319719915749 0.0032322680487821089 0.095122655736622486 0.65587798685548471 -0.0040472550870561969 0.013925446933457153 0.0034903561592097396 0.0069175852981317957 -0.0057379173792424737 0.012008509500282981 -0.058355289233965192 -0.11413486167733473 -0.0066311117509387134 -1.7908386754255063 0.018949640030600876 -0.0035361714982215901 1.8704098309129986 0.035010565389160329 0.0043215391940079765 -0.03723713821262787 0.047471910363991808 -0.022692087521150466 0.012949529966768895 -0.016275476540912957 0.01569814025059086 0.086635136495350748 -0.012517546639044133 0.0011211438788462967 -0.0042478365359567274;-58.41616092303645 20.905555108682083 16.880621715279414 -3.2441981710177346 140.01618289554702 -1.5659717728541405 30.652446687920119 11.331669653336565 108.13929471196032 23.036921439696567 -33.724444845702138 41.469216395423793 -50.286127089649924 2.5411261769515026 -45.725770370419369 52.974144902698235 55.918188900539988 -98.917618059642493 15.292488953795427 123.75055066840937 69.452386379781387 -2.756942669558673 6.6052454489029362 49.952305801708668 -51.079039854984806 -4.0987124493971896 -5.3217967864519933 -14.021194466507472 15.998657457919654 13.340337158723628;-15.812402493966324 24.987767854192182 35.748353281479289 51.578354315852522 -53.471922697736368 19.310566744599054 59.070709334863722 47.111866665732173 -66.601767798818585 37.127177169885577 -21.426231305790015 58.553844402548592 -17.40666583161925 -10.710811159318022 8.963109577093789 -5.7175185108409607 5.7530666346730346 41.277797697757336 40.674004802047442 -39.636740563727571 116.29719442990107 -21.520311270704966 34.221293569473644 -63.332446072797083 -14.234232367061814 3.6238109896239155 28.290665868946967 27.048748037910652 -107.06071418116099 3.3764979287861974;-103.15891648530771 2.7818100371721517 13.847327080400778 5.1550733731647664 94.720019013921856 4.6700218140748539 41.157031469568679 14.003389225392747 -57.047489914373934 -30.557762766234152 -25.681608840378722 12.53123627561258 0.20633563828210927 -10.64880473192464 5.6469662118328952 0.92623978048065281 3.2576847390539077 5.5328468164118183 77.593151703206587 28.268654277215656 13.058230447857623 -12.276806188062963 12.558450915926134 16.47737967661018 22.122027976999387 -16.408318920424385 -24.598572566255292 -24.211240729901451 -24.381976095458228 -27.53124523653516;-0.90330685559315438 -6.5360295553887022 3.8505089143185405 -4.884192743523899 -1.2386179127303361 1.4511310534013182 -18.910721732006483 8.6643094169282993 21.793756601992133 -6.0604444608697374 -1.1103059151126264 10.615009494011256 11.386519643923556 8.3991550631402419 2.9724770835135659 -4.2270218443059635 6.5167985184105737 2.0653068920344886 -22.716487247731731 1.1550180799387846 6.9250048815863723 0.57916324120921014 3.4619492592946295 2.5148150959849236 -6.9164884483765734 4.4522529740870462 -4.7151120795598498 3.5000921518349899 19.057506691618396 1.7188512639934661;-5.5233766826850657 3.2824227628269278 21.846512152680887 -2.6781279536092724 9.2069680633745481 -4.1400410526960014 15.893236120972656 -0.96761287130529539 -11.87969455451978 0.94026208766936559 -1.3531956513744654 11.818610181380278 3.643235348636082 -2.4716391097605834 1.6692471920527872 5.7614813181489506 11.046697972582979 12.227360468146736 21.086463860323121 -3.5289283648326544 -8.9053332510626895 -3.5030206784687534 -0.95523882531277193 18.446198404962093 4.6626325658288206 -10.382101694679081 -2.2973704555637435 -1.1009533744383799 -43.426701608184018 -2.3064311391857664;2.8264808066974605 -3.7466872331101726 1.7969023397476662 -0.52181016298502747 1.0624618167296236 1.3776564084474492 -4.6268391628070793 0.82964524328720879 9.7476089128123764 -0.42151526016785507 -4.0665080982684119 -0.70606466889398212 -1.5537714070731306 -0.064696565754106788 0.067227652074824937 -0.78784148918674957 2.1771263279258468 1.1018703996132546 3.8819838419317505 0.27039051407906367 -1.4660126107201876 -1.2331071799587818 3.0775299838124242 1.7180047429423053 -0.75459418758520957 0.31197595483610391 -1.4259030372066299 1.4771393627484006 -7.0305932720258513 -2.0949028724559016;-42.003964754072868 7.6098063545216039 -5.0429589331693183 -15.121472361152428 6.819543510825719 -6.6797561596064146 49.584933659457398 -0.84789396121251126 -21.518435949873457 2.4094205151402996 -16.105043240660144 -17.455654873336666 -3.8878429406185879 -19.994841684327668 -7.7607826242863762 12.380884927202514 -11.769302259780398 -31.062191821346683 49.358196058290908 -13.163589020911855 -6.7453472397619496 7.1280835984280975 20.464346763364471 -3.5033407016205538 -8.562820718954379 -26.31165080634814 -7.541454891545766 13.079214734127914 40.859553619389601 -24.520808578833609;-10.660801811190861 6.039138896410261 -13.451063827641731 -12.308275155172785 17.377452713652719 -4.2828849528468993 -7.2093422429098135 -4.2646954949014777 44.383075891857025 -37.784551251088523 -3.8537273438665314 -3.9947941756976086 -1.4690967818869107 7.2089844113858161 -0.29668333120589474 -7.8456450130575073 3.4707821608189162 -10.616457294235282 -48.536077831207635 -11.36175821821446 -20.703578216017597 -7.2318320421588451 -4.194449430216447 -4.3034796323244029 4.1390136037806124 21.596682772885163 -29.843647670995495 -4.8661720028922257 -4.9509234732353216 -0.6615603740138859];

% Layer 3
b3 = 3.0473343497225445;
LW3_2 = [-0.0022796667532105513 6.7987617397693398 -0.0027549817821032056 -0.0026721556135549359 0.0080356113494290012 -0.003245451011086409 0.00075327112624099489 -0.0097340604270162723 -0.0044536194174087254 0.0073019049482618593];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
