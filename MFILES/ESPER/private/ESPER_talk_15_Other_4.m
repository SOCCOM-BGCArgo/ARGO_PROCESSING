function [Y,Xf,Af] = ESPER_talk_15_Other_4(X,~,~)
%ESPER_TALK_15_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:51.
% 
% [Y] = ESPER_talk_15_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-133.803853032615];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.00432440760873659];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.5956587042912023;4.0565156607814643;0.88366238754807935;2.0058604296026132;-7.8013117478411127;-0.32744980639091509;1.3149511244475127;4.2637954035998566;2.7623681197538725;3.5144265537029749;0.36531887105831662;-0.98884766325487217;-2.8801223973907204;0.33345170275415797;-0.55250764973472932;-1.1752166967110764;0.86931671730218496;0.96684562045873068;1.2357389867797728;0.28205179530060431;0.41041515239526516;0.025177595047619641;0.09885087255377864;-1.7124896301402242;2.3341619585442062;-2.580022120300475;0.14381213576939847;-6.1232232840620044;-0.15215931361427626;-1.9363682766328418];
IW1_1 = [0.34967606212147884 1.2134138928880773 0.29198917151860859 -1.0338469640722887 -0.45572593141797113 -0.29950471191790212;-0.34673770379961583 -0.35164021946569912 4.360058270797027 0.51631923987162842 -1.0807215973141573 0.43074336578308037;0.019894916446915288 -0.2522364666300157 -0.28901575366693938 0.96263084676120914 -2.026559050470838 -1.9375991641686974;-0.17196502094134872 -0.8956031178683469 -0.96381167142993363 -0.45526530637307655 -1.8711402901006313 -0.27699971221294578;3.9971216581539215 -4.4396894949193264 -4.071870044090133 0.60162966515561667 -1.4343168119104406 0.90067651751206534;-0.73883879712380007 0.56086398793413361 0.70722063998318863 0.29303871143205845 0.86004715579338864 -0.36214612733774976;0.68595463652385413 -0.33220153549108161 0.035819136918631631 1.1193308965654063 -1.0909334459398461 -1.149966750976106;-1.973305105681108 -4.0077069982178912 1.9475697100125446 -0.89007493283333272 -0.27738527975517274 -0.52652947532206251;-2.1630144504871183 0.97587461018669863 -1.0738043666956152 3.4539726517238831 -5.3127686996448684 1.7048007976708968;-0.032143332570775771 -0.33633996899587421 0.52322956783731811 1.2883011159124322 -5.497076640010949 -3.8028846429795879;0.16434840845607815 -0.13589015465133822 -0.51665874883476903 -0.923465023102783 3.1052456632911576 -1.1183765242192343;-0.39270621908377668 -0.069634834686829614 0.20833205366663965 -0.6899219661974374 -0.47706935614908152 0.36016972020058796;1.6596371695528704 3.5838983722945255 -0.91188132321376869 1.3091191508032303 0.5263736768142101 0.084770847678293196;0.9729614826009314 -0.55018087325204101 -1.5519520618962157 0.10853822900656995 0.91034956058937355 -0.16097832056876873;-0.11947042789701869 0.15625066320695158 0.47892152988374354 0.66484503745055179 -1.6626550817415009 1.0296290741247942;0.23597916491557402 0.80550777862627565 1.2878889815947232 0.40190670805217055 0.64604231652985356 -0.17343565365015978;1.2921746756462538 -0.35153520551837658 -0.95990831868428217 0.43037125302363621 -1.0622702283141505 -3.7095154432845305;2.1058443124129056 -1.9899357382211249 3.3549910811485124 0.73455044033545192 1.8027867439471168 1.7151187520560029;0.703931670571457 -0.19829099010416498 0.18280860982703273 1.0215452523205422 -0.4001036443471867 -0.96573150292899879;-0.074430579555087736 -0.42535920809484767 -0.68504147059786336 -0.010616469926883719 -2.9640051804959011 -0.32795673740889203;-0.085486827216400843 0.16569106999915098 0.028316235726668589 -0.076451662880139826 -0.5832841321962311 0.18557854005871033;-0.43868528847906829 0.62231224987704614 -1.2276145460161747 0.12777745340412211 0.28448128161423114 -1.6769011494889186;-0.48991418953303312 0.41583243431406569 0.94225296870802366 0.27664083880712259 0.027167168599787708 -0.30991904539366233;-0.20669995956894366 -0.13073041702303706 0.8793228505153412 -1.2020317865151684 -1.7326222737655907 1.0771115515606182;-0.060966978668506561 -0.070261045871312391 1.047623536999607 1.19521268205418 -2.8727990664973904 -1.2056552047378977;0.57733457014861123 -0.70982657376708036 3.0989198404933203 -1.9014767546222988 -2.1494499548914847 1.0405320879692814;0.51029423618873138 1.0751598797501565 1.9978967664940286 -0.066772291123454827 2.7305905943765638 -0.68560734002577939;0.64851539261338975 -0.12254756482867225 -8.2505019007384277 -0.88484812363626408 -1.7959135373586557 1.0138409144536238;0.26918118207968167 0.93423384179611091 1.559512941087382 -0.24015081050595904 2.5966836444051515 -0.82368485482804987;3.9438108855617777 0.78345501537268336 -4.4414537845472761 0.88283472003187613 -2.2680350771600555 1.231532745745421];

% Layer 2
b2 = [-1.1427783568866268;-0.42623768735734263;-3.2168638994271972;-6.6420181671026972;-4.5022895287312172;0.83950513590129172;-1.0823769986542304;5.4099993108867857;7.3350933963084897;4.5844073150150333];
LW2_1 = [8.1861565975265567 0.90779261447525916 -2.8366285054016771 11.503471276435787 -0.13362777941395687 2.9043569265183806 -1.0885005766990967 5.2250710884842135 -0.31262096107887072 4.0445952115293808 -10.102034512345101 0.8347842698659127 6.0478815419774756 4.3903504967920188 -7.8746503277435567 -5.9213312397756646 -0.65247358794318477 -1.6704213336462581 -0.62524677459108846 -0.82068710212168483 -30.811494677774103 2.8176163210640786 4.8024075240744084 2.715229732960792 4.5867369818148829 6.8025374733680835 -0.84563609049105704 2.2245713908933502 -6.9354543928856112 0.79003150651282195;-0.0052196962744043918 0.081603881963049241 0.12066589877369355 -0.54545058849488814 0.081333083387673477 0.35022742966868486 -0.46496783744492981 -0.1791632353022429 -0.019793432245769561 -0.02103096845113072 -0.27196889926261913 0.15554887901271247 -0.10434847893506749 -0.14736907227150089 -0.26559359209995692 -0.23777064383930618 0.022137903035761249 0.095947474366691099 0.59822346551045058 0.023554218002868312 1.4562403026538435 0.075673813526819012 -0.98537735507124602 -0.037033715180160631 0.05539016403096203 -0.061299518079831403 0.24109175790483092 0.031177158652816742 -0.23874791362662906 -0.13392225981899253;-1.9396953819170082 -4.8498438299644651 9.0371324118950067 -1.4799643699098919 9.3815165057560694 -8.1474652938402237 -13.254888405172533 7.3192133198998972 -2.9888412651140475 -2.9802793876813016 -7.3091364994500339 -22.311428364927998 7.2982642294129665 -12.426659450064889 -10.160447087668725 -7.0621649018812507 -2.828029922990416 3.2709389680092742 -1.0380199454257255 -3.9620256711722255 19.913455148387868 -0.46773338123165431 -2.6421271167707188 -3.5649993058048226 9.0270896768081279 1.9358512593532058 -6.2225126478360124 3.1117703274176627 1.2389078994581935 5.5896452884361096;-1.5399018166944496 0.65608681333769336 1.5178817214109077 0.62364207093590229 -1.778328964036926 -11.626182094610044 2.5031996359425994 0.15291671386729186 -0.068588790142649819 0.85449093870420711 -1.6034365496249798 -4.7901818210378204 0.39276438741678599 -3.3330147126312593 -4.7890106254474407 -1.7499372062719616 -0.31087577417094947 -0.53756266988005841 -1.9766113193190242 -5.155763671417068 1.8292444463836988 -0.3006947447132593 11.178287400651783 -1.7894679047774291 -1.6587715752579828 2.8708376720324025 -10.495702434876401 2.731752091486733 9.0034802716361693 0.57705406051243491;-0.25528404053248432 0.062099561627295054 -0.7034761477157343 -0.18772347179609275 -0.86050600737841243 -5.267212422351137 5.2866220413344394 -1.5367542734894728 -0.91559995205064226 -0.59719213966777673 6.283229631805999 -8.473402439853821 -1.3857825714994763 -0.90606330304437543 -1.9002570435876622 -0.61301798651687367 0.1521141067572373 -0.59354252354726844 -9.261563835713865 2.8855803993790055 -6.7814276416666015 -0.0037781749736491635 6.2296970601020085 7.2660448304232315 -0.064905668917530163 -2.1411005850255416 1.4494590821223736 0.34598199498122983 0.34318916881486261 -0.023153191251851692;0.30612846004496941 0.0038325119463314527 -1.3949924293855389 -2.561691819802133 -0.63090738874337238 2.6719277324657149 4.1203640532828789 -0.92416388197562938 -0.46351245671729002 -0.48449342860761707 -4.1325300477755658 -7.8910027516345362 0.47737941495909403 -4.1781595094022208 -3.3154952177713168 -2.2988357579481535 0.91364762544249523 -0.18400250187486922 -7.4474322734241571 1.1085193585227542 -4.1477759667313139 -1.3634386354860779 -6.5069548666013555 -0.52794533522936826 1.8156129965147914 0.94905492160396632 -1.9396557454183392 -0.9883034304078272 2.7706570636624654 -0.1596562218450315;-0.28398550518528087 -0.16296960495753512 -0.08426979361566779 3.1113437228125957 -0.18168116378683877 -0.94831965692554299 0.79268986100322425 0.43062757133409663 0.0093328232735308738 0.21042966287159343 -4.1464025045338788 -2.7153150994066957 0.36633990055038912 -0.29619872374996009 -5.7711033123144269 2.0982181331518204 0.098940135429035472 -0.3760606177851113 -1.9650298474714289 0.44118381567168585 -2.6657126108343547 -0.60698918593920548 2.4008938917588876 1.7008704953536915 -0.36605315892925894 -0.12205751773235442 -0.53131848236357904 -0.60788583326604706 0.68317137088215785 0.50164395335345724;1.7112945691736989 -0.47882395771720176 0.55005922599152479 0.87296737311399408 1.6886671401226525 -0.80102295991296391 -4.0930634726135162 0.20008041611615385 -0.16690566880593083 0.26602746348286938 2.1578782219824153 5.9388367031721323 -1.1521382405840059 -0.69507331078096035 7.7166635170023508 0.79079352415987925 -0.089497581565499196 -0.039858097194349726 5.9121198251726295 0.64894726203554542 -3.1557858547124691 1.3549720794319799 -2.756717094937156 -3.1123823925274556 -1.057882866778493 -0.29338302436460401 2.952791828700752 0.16590959235029362 -0.58442320756339083 0.45958222783794161;3.9765253355963854 6.0859634320961771 1.1185747995999313 -5.3093712559923478 -0.91394651154655893 8.5756864146762144 0.43127944036768984 3.9453863216332095 -0.3650107243892014 0.14198540579974495 2.5172711129444636 19.908275539789702 1.1647616604676423 -7.9186916153833433 14.967337284035505 -7.3134848099162681 -0.18373819419272641 1.2583300070594192 7.747477906055801 -6.3414116383343675 -1.0844166509577999 1.9189815433044783 -28.858758260505269 -6.3604474429622933 -0.032788128135077359 3.0796348652843419 -5.3353717625840646 0.82697002513618501 7.4721217896397434 -1.165901242921352;1.2713615744106295 -1.6455597741699206 -5.5959249801082889 0.52439220664510411 -2.3246523270109694 -10.292195645491418 5.514076874017567 0.15713710947576293 -1.076608855158262 0.0092028914842702675 12.167947463317805 2.1361866396876126 -0.16500167732685903 -1.3936339591679394 16.726313631039456 -2.6477013945875085 -0.44811752897790985 -0.11171162582798802 -3.8738337906487219 6.6840460790219751 -12.414177138296543 4.4584410750455987 15.7570724314364 -4.1889768164016239 -2.3729664419137682 2.3869746545827342 -6.4450374253318676 -2.8500196008487615 7.3413818308679017 0.86765327077408705];

% Layer 3
b3 = -0.1541792166319991;
LW3_2 = [-0.020519655188798631 -1.9731866401861993 0.017666144572524491 -0.047873670445929967 -0.060933504561144852 0.14743453860008557 -0.53380229125918066 0.061675942663408388 -0.029902863788776279 -0.046689983946394745];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
