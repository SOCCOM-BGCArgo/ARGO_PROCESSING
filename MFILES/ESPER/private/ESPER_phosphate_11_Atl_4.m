function [Y,Xf,Af] = ESPER_phosphate_11_Atl_4(X,~,~)
%ESPER_PHOSPHATE_11_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:30.
% 
% [Y] = ESPER_phosphate_11_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.5670585840866313454;4.1710945422963003892;-4.5956547782790169165;2.036166827115704514;0.92003902223977174213;0.62151367114685973636;-2.8090245044877155678;1.6816073827992958911;-5.7009542653687139691;-4.1137999918551679812;0.27227005210415156089;-1.4798344118407735781;2.2688710091343371467;0.12136506001293193013;-0.17457275624916812617;-1.3042325549647759697;2.2380994817499431093;1.6226373336936206204;-2.7887148551914693329;-1.0657774867059401913;-0.26588600463496275816;2.8756852871450946374;-2.5107288992086784774;2.2399984396506051887;9.8380121216883011925;0.88082766128962441954;-2.577395438308605069;-2.7917447206938867943;-1.2724053916926756358;1.3132735256034171467];
IW1_1 = [0.76110512240097016878 -0.30619448362720691481 3.098508929765698916 -2.0856230487341864688 -1.9265142832471977563 -2.7758282129972839947 1.4506630373807143375;0.027767426181604847046 0.87501929936297118129 1.4658327516999201112 0.76777368111341670609 -0.7841432812305410005 1.2036669954489975787 1.2874862034127612098;-0.016256776303735776673 -1.8967090003119186914 1.3047931176041036583 -0.2028052889174319362 3.2734839648629923126 0.70013026359898711259 -0.50133498140235843721;-1.3273743687113350731 -0.69098623293324035188 1.1526384651714058904 -0.74328068441283678958 -0.65333447686753021166 -1.7980422731834178052 1.4303447284289312336;-0.23819228935382727452 0.37686634795011486609 -0.81893875167062790688 -0.4752935172557143928 -2.0224197588320964591 0.10469071861430258308 -1.3058630165787146193;0.72477548875240005444 0.12839409954316122198 1.2611775937057734254 0.8864920888261591525 -1.9363392414856341883 1.8648639724496438586 0.33886613443371293997;1.3517751411450011911 -1.0008500926653871588 -0.3264468550477958031 0.34150780430139804356 -5.3082534080492393969 -3.72022892112127046 -3.7695881296113444847;0.064520184274550307357 -0.21024105949903090784 0.99555017015224400723 0.19430006626007823023 -1.1647571221989581058 -0.042187461248748295284 1.5776498434453529729;5.3009276158022942127 -1.603671258056817539 3.9077183988849921725 -3.8740279612543910837 -4.9526477359912979281 0.19107669227595230899 1.0132658957172933079;1.6951226546664979189 -0.49155659192155792825 1.8528460864022158194 0.19056845495835264548 6.0808107572719833911 -0.73120736085931870019 0.70821513359460952497;-0.30123060226649173154 -0.19634051910638558591 0.16965181799013928643 -1.8123087630448531105 -2.280149884924120407 -0.66019500256386176584 0.040196613309641443523;0.27968286744448950243 0.09578327651556620137 0.090596055337240868899 1.6090299291352854194 4.3729203214218532736 0.35191758165041092665 0.15817995667970696783;-0.47662911356075543523 0.34573319872029040223 -2.1963879912472545897 2.6947669150855544373 1.930951440657849183 2.4782402827134282219 -1.5306568663169606292;-0.53156421428814637498 1.153599427368269259 -0.22790489222034845951 1.3336147165372345125 0.46879981710138635131 -0.7055970243612277315 0.028396409297327826482;-0.45559549034632540465 -0.60120151701087498619 -0.95517934379796287647 0.077922364336514921002 -0.46023201056834234235 -0.38791503969826629517 0.28425527335329536793;-0.52838408099924383254 0.31944303985380084754 0.58318138748696279894 -0.2148199454416876153 1.9700454866217727012 -0.5107012108274920914 -0.20242962996737692838;-2.4893965450082924384 -0.81088812683997202324 1.1211372105444037395 -0.44207459050532527112 -2.1652649786573960888 0.27246674355511613097 0.017096544154430872581;1.4680296782480215523 0.66750781857897012461 -0.23297415327000348118 -0.43182911083271247055 -2.9574304847506782679 -1.0726223060507731333 0.44594176884954578322;0.32219459412363610218 -0.40870900055577141785 0.94604579346437822629 -0.12269495326028488635 -2.2147858640701199029 -0.14762790839686007471 -3.60336270646185719;-0.11278780904502351545 -0.14394970162465622887 -1.0572016439909064367 -0.9943916034884691113 -0.62785594610939376992 1.5455569182397046468 -0.91137865664559125634;0.88596990449680612656 -0.70993927970576975461 1.1919892996395933249 -1.1938613213730442375 -1.0467825231790515161 -0.22791070984556435763 -0.21287674538073228514;-0.78041819618766228306 -0.12548504235319321576 -0.88271996524222151592 0.88347696003062536896 -4.0936736391837911242 -1.0379921100415703261 0.34660537313382894231;-1.1572854636143121709 -1.8605720751511349853 1.3306629060711023804 -0.5098005639964033886 0.8879998607400685362 -0.90000906314147000042 1.4230899101251637262;-2.5253161721096262227 0.1157359639947894564 -7.7616410188268574188 1.2451223889608045159 2.3493827424823687799 6.6337670263041630392 -4.1428297877510846803;-0.3461317017864507517 0.29397256415049227707 -0.062422109798967943817 7.1913854067394522573 5.2587129488674762001 2.7336330538559967529 4.5835233969869983994;-0.23152586708409134131 -1.1146404803075420364 -0.058795955014450500264 0.3429744997783280569 1.8911786664448704265 1.0249297834372790295 0.40735608640212084275;-0.071363681157524616605 -0.6537905563327922609 -0.89364134041347731419 -0.65306908246959971542 0.36420903527772596764 2.1950049924996828388 -1.4212594230752673141;-1.6629198090428878309 -0.63036178108178420043 2.3222237918649901722 0.44384941267663424735 0.78465414621322160382 0.056630291451706407657 1.0680629032582806826;-1.0756978098389688991 -0.50396923941130566948 1.8357600429245817253 -0.14360364344881082488 0.56569408603750892528 -1.0316857429940060609 2.7102499801693515913;0.82174430605449810816 -0.81734018303253996862 1.263310381659794146 1.7524667691250066515 0.66660257546323276046 -1.0434747482191173429 0.53282850169579976107];

% Layer 2
b2 = [1.8404873213618828665;-0.57834683786441354325;-0.66214282298352333811;-0.68595254163695373872;-2.7749068578561897347;-1.3497874249236323507;-1.6125017404088781703;3.0311005352260744772;-1.9801885831954759709;2.2678070778629249027];
LW2_1 = [0.052024128353263227043 0.59203200291024493662 1.703479304396985361 0.53194218136963367094 2.8439895605024494429 0.50491425780201659723 0.9510742493146920884 1.9343368445166477798 -0.3087120445080627773 0.42933789721296961028 -3.2765059094111044224 -3.0121028601390791302 -0.90224747643698721689 1.1106524262370822687 -0.45835666506087391348 -0.05444873067321021054 -1.1173046938192681132 -1.0720189693822617105 -0.2340752955025527382 1.6068915611365182095 1.2006836346977955987 2.819535328719032119 -1.3294705551685364053 -0.31972925126054085876 3.0029763117960115437 0.40593003686853851297 -2.2374226650972928176 0.11426174655310922246 1.7140852842714904281 -0.88854720572500189846;-0.20167337434571369625 1.0533141090855162592 -0.79608570535746647767 0.25465726160944901491 0.71176736709935761738 0.67605623036305495521 0.69617162625886530591 0.066576583096033578602 0.26845573172853154365 -0.033307428649411920107 1.3657666145192912666 1.5047279332859748724 0.23600361874062905643 0.42779908873587230156 -0.63740378286017862486 -0.36552146528576362483 0.30801337167409342799 -0.29661256771102373353 -1.2812016387112401539 -0.28167430315341207558 0.69869777702897351013 0.11454944307441744522 1.3148356434719379315 -0.13895444451316976697 -0.64640079235421199488 1.315819169209907491 -0.24744576818012076203 -0.8097475966535115921 0.14536461899263772302 -0.035325640537809746555;-0.19484026721344718802 -1.7202558194963195604 0.90759811937753775979 -0.71942333731346475023 -1.3406509417135539231 0.75955822602656830611 -2.4390701104271315103 0.14334096611148067213 0.12087443369900259527 -1.1539364395056643797 -1.8831389896709260778 -2.9589592898423466849 1.066218793077124527 -1.3036892261534465121 -0.94236798583548209152 -0.28503059768640304217 -0.4872949163560247321 -0.16108611592276311786 -0.56100352290911481568 0.43972718817572231664 0.61739801100836189107 1.7947194913705124542 -0.65157638120573635465 0.15947242217446325196 1.0316638060969443025 -2.9240434827129537787 -0.55469867050354171312 1.2516344105269743281 -0.46887127782890286598 0.62949838535652247185;0.26424796475203116142 0.62820700481816083016 -0.25044291446648786481 -0.54515797947541044799 -0.23594081047331344481 0.1334482200740980673 -0.3490062822618194005 0.36601367335964868355 0.63530264197778663071 0.42697070842647827371 -0.086197403558307295057 -0.011137822488554965927 0.63947051165399426687 -0.17384017096062187591 1.3596720146993643841 1.1241703311422459599 0.37970293567620122532 0.80509395991188392738 0.6015488525591672353 -0.72744205991151300594 -0.88619561025911075536 -0.68415607651653487231 0.00085104617940224723191 -0.39115852529798289527 0.29371008540618875893 2.3943020474298646327 1.2514575234547715699 -0.59938543235969665712 0.33733965612428262748 -0.71234172343836676955;1.8051980164023826436 -0.72817733493381997523 -1.6004943525135921778 -0.87128408426922654417 -2.4985218160920315 -1.5086385598155311882 -0.11869751809455947322 0.79956397906100096229 0.58964399441319081951 1.1091763086300812091 -1.789846166974149666 -5.4803010042951925129 1.3497177122620984679 -2.2571267595482766843 -2.6380910828493639997 0.8191168500039592848 -0.020075067741797788384 -0.6645403610182621934 0.69366166160034481436 3.6295631326863060373 -2.3516869829152518001 1.0580233840080315311 0.47264750674303929179 -0.77956799616317773438 0.14781004562133176483 -1.2837300145011856234 -0.66853807277666166264 -3.117071066275181046 1.7816431936807426428 0.58460113606805774733;-0.6513012576569529033 0.52618330586356565348 -0.23680891425255054528 1.0887122749334074978 0.85394971401953967405 -0.75086401256939905302 -0.081134405541248039162 0.35742735389418978098 -0.24001884284898880595 -0.20592870635323051731 -0.33759267905642897922 0.84229168232708506725 -1.1944305030702542236 1.1801808720767836824 -1.1151995831725955988 -1.9214439758125414492 0.12821387442639928245 -0.27506309230043357594 -0.22490954631700360578 1.8135122374700396453 1.6406919242308715123 0.18316691919516411846 0.0035302651739934137395 0.44719598441222524476 1.2526554570138421774 0.72917974928684725633 -0.60207584214756793006 -0.4505828800960777758 2.7489782285627755165 0.67835156335307522646;3.2135764458905908825 0.84898213016588397473 -1.295157063797239827 -1.3257914738238061325 -0.12874625526837271683 -0.96917693358991119368 -0.28632464215150865705 1.7471736401370461245 0.69409706768191259396 1.5140563972998564157 1.6979257342765696759 -2.1418392765028646529 1.2512532390576205366 -0.92110358750438259268 1.0045754030864151307 -1.074917637803223025 -0.071140261093457890507 -0.32326526089676549391 0.8729320200210256564 1.4619464359620326643 -2.5136259918646342015 0.41842590310748378757 1.0538826604215145721 -0.68830779591931356975 -0.14265962698305156842 -0.888416618393613855 0.53054539902836084231 -2.3570826681260554913 1.4991647625668447219 -0.65268598846147585224;-0.23153511169146961945 -0.10628066256566759407 -0.32160604718609986374 0.075707984485039681033 0.044995792410838897357 -0.10654021148108411277 -0.61316656547840986402 -0.025253924679095495626 1.007196265900555332 -0.46878611698142774733 2.4722293132300632301 2.5343419501734265609 3.2800672745990744339 0.40138357166982474578 -1.3201945649112596382 -0.19326542710030880645 -0.31763232097747612359 -0.79936615347480466376 1.4426009302458879802 0.28623502558661234607 1.0314634295255826757 1.2408018367363877754 0.90359414966597073615 -1.0578976312500125712 -0.26551132907570751396 -0.010063822320595203208 -1.053127963833773828 0.57245609718304169 0.84113751312973661367 -0.17619196669968226199;0.35655802739413849922 2.7331451914181612572 -1.3601832806557547784 0.75156433865568417207 0.32228127968333764031 -0.49995658576363771752 -0.79821963596027867283 2.2069598971756918537 -0.36205930633072358482 1.0006986049302939445 -0.84751710121942402942 0.37751904353629511801 0.3190189136997956254 1.7494404600039668018 2.4314576358946369261 -1.9875876222947439498 0.41579515465054417422 0.35356626453262324228 1.2819723486091683107 2.2857639831315084145 0.62862269949744509212 -1.0504268784706025652 0.90384243805017894235 -0.61484367122269367734 1.6030303784566397596 3.0559850519270792546 -0.49917040457595757141 -1.7553409035489977441 2.4244683756050786627 -1.5959229260495380043;0.34860395547138067762 1.71746143070205326 0.9099801149240267506 -0.22632365383392960556 -1.2623857930987385512 1.3112800050816719732 0.43503439069545374318 -1.3870326478303387496 1.1745555933342493038 0.59500396640047248376 -1.0490418582752112364 -1.0548316096352774451 0.46615572299263280387 1.3044018173878975109 1.651267751521807492 0.59732411601177259897 -0.10206179838194358311 0.40639571953823677708 0.47155812150839310215 0.39064303424789592611 -0.16743018792726782618 0.88097819501092478056 -0.28400670662889759832 -0.46065685660038674376 1.2246091656968882688 2.5651048716109738912 -0.70708509199881020013 2.2031284709940242017 -1.9741786713262259312 -0.96550812252474782493];

% Layer 3
b3 = 0.094611870383301877041;
LW3_2 = [0.43192606936586847022 0.77729275121377461311 0.39926695653772470429 0.65477171378263565593 1.0798888564835691373 0.27148402736324606099 -1.1872713059333201979 -1.0320800567674282 -0.20583059734942552033 -0.51956114293384059177];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
