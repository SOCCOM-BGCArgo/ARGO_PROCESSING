function [Y,Xf,Af] = ESPER_tco2_5_Atl_4(X,~,~)
%ESPER_TCO2_5_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:54.
% 
% [Y] = ESPER_tco2_5_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278;-0.2178;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566;0.0461352500991908;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.3297621165594946;1.783806720087447;-1.34469149334094;45.55681249377318;2.0321024765229065;0.48253035457536037;-1.5828038472758217;1.3928685232868925;1.5597550150835982;0.73799927811217358;1.557131053134911;0.90703580159785646;0.41366003142175245;-0.85041579340777573;2.5631905698951645;1.6238144200638673;-0.82256944651179753;-1.8953410921828748;-3.3879432132079668;3.1549096187585572;-0.31576089198978513;0.53930383689727601;-0.077491410447264736;2.8241512722615481;3.2360576979005233;3.7088778069657038;2.09412596037724;-1.919804818572145;-1.4983667527103457;14.771208097721145];
IW1_1 = [-0.88825310812915981 0.047702578530108716 0.4727607609026987 0.93815538539496945 -0.21279639751688026 1.2587987105255274 0.80130209353599402 0.72448856804634076;2.8236643421705026 0.60973692178356842 1.9721273879117933 -7.7851600714536557 9.437228730706579 -1.3969920905394437 15.719495545120912 -8.1495880716531293;0.64799251203950614 -2.1224012725256962 0.96002128825045441 -0.051568539286651477 2.2370078795187349 2.1128834185397021 -0.63973660844984181 1.3924892421811821;0.67072405642383404 2.5290940182274411 0.58589603552008873 1.4572004873633135 -30.18144700567343 26.909545650831788 -3.5617254065846162 -8.4934702181808959;-0.94136268144579094 0.012728754785964328 -0.57411483451941203 0.60117904347029816 -1.1176812981395718 -0.69787209032887443 0.71569607384212863 0.8321883613253126;0.20503306013580405 -0.33155090834987799 0.50428275470500483 0.42236706802199764 0.1994461657679778 -0.041950294798549795 -0.089939364850771197 -0.051646039360182569;0.20134047228777929 0.59516286622284964 -1.3996064732227482 1.0126502368675678 2.6070484272743402 0.4994783000981764 0.21707443045577823 -0.5134522673641474;-0.40782565089306971 -2.6977020892231294 -0.27462691595770722 2.5393840282315976 -0.46018219848411596 -0.83111288770716008 1.5074531424442483 -7.0132824706428716;0.58632540726863924 -1.6543378539992688 1.8952876158213934 -0.13433583247447325 -3.0320609763519673 -1.392008505370484 0.20741558426092505 0.34363734647476796;0.19665120862194915 0.68756731759593226 0.33669837966201493 -0.91662298113252005 -3.4566231588448306 -0.46958448177352047 -0.57829287265465135 -0.76905409224076238;0.39504917261759293 0.31991027017153362 1.0379014370975441 0.88871146375968546 -0.079960785726876316 -0.02137829097987971 -0.3901948670454527 -0.64465364399520664;0.17026253123859536 -2.3889067460605067 1.4788338529837621 -0.59677131056497712 -1.4932571356532338 0.13573074493489484 0.97021637305964825 -1.0280283387975004;-0.51658712399360929 -0.40252400596433963 -0.75858980147297228 0.90916294347001336 1.2149231953068651 -1.2146830197050409 1.2633182656052233 -0.53937546182311891;2.0864166576148815 -0.7204362575422818 2.7736425200948704 -1.6473683002485469 1.9536852685110255 0.30167386781410099 2.4072125973672831 -1.3447012034132497;-0.91407149595842407 0.27991609762362224 -0.90099690284596989 0.59557145260054478 -2.1924954406612991 -0.55331410187060148 0.41003582066104866 2.0036197465142931;-0.0056503325328802183 -0.85343649163267044 1.2502539315345886 -0.57325876005534204 -1.251092018621095 1.1577912946318683 -0.36007809874732483 0.31630062702216177;-0.26975457209328157 -0.42682172419849568 -0.55885073237526162 0.54700930921634439 3.3528668918703999 0.36082174089190999 0.5402145119615912 0.53451803851654478;-0.042593825960272697 -0.13505770439568029 0.70389228161113548 -0.63855289484079725 1.3687746679698871 -1.0375030076693312 0.14241806247169458 1.1614333291936261;0.36078001031458179 -1.1840545649245053 0.0085103006266793804 -0.083938457270760325 0.84246444259771525 0.54146405983318335 -0.54633983407180486 1.0343395422400137;0.41573621865509597 -0.60478208305980385 0.69632405950869691 -0.63047993062385232 -4.8040992469053458 0.069980890160039069 -0.86820563179208554 1.0354934284965485;-0.13658236514171834 -0.094384543029617546 -0.15093603429490415 0.52518303066567329 1.2054634605544021 -1.1391989771638951 0.57281725384612259 0.23763904590618753;0.021355068806545779 -0.52256875310384809 1.0142909500088384 -0.75129086668624034 -1.3424025888670266 -0.43117741972791235 -0.22158210882984941 0.58405174445461527;0.55735486669482392 -1.159417954548567 -0.64890590783284496 -0.072563445676116278 2.0226231167569768 -0.70458553725193362 1.4914161090293157 -0.6066673014027173;-2.1295634436986952 0.51496108602289081 -0.4255649546714933 0.30511868866310454 -2.0794402090029958 -0.50830723558823643 0.12007229393060313 -0.8094202238512439;6.0182773732756436 -3.4723278511325861 -6.6102553079140902 -0.72685443790064419 -6.1937896939411416 -5.4066474457003126 -11.373784942997172 2.3860531223587942;-1.8866412791645608 5.7329572074988437 -2.3010543648464115 1.9005630294235458 -1.0686910803955723 7.9315286587906435 1.3836959982320289 -1.5048549568406602;3.409796387892809 -1.8707104538433716 -1.5292316482156092 -1.0743128630318974 -2.6287028771549132 -4.0028403716254806 3.0453516187588652 -0.64491447171604399;-0.83594008567164946 -1.9193788996189198 3.5857368253844872 1.859229854970458 -0.048380367249763495 6.7519753752026617 -1.1745788578726002 1.0529966250771745;1.4139004936762607 0.10767496902791385 3.7361138604307991 -2.9985685575038943 0.89615584126385484 -1.7505271755324154 -1.5735299554205262 5.9990014209113633;1.1435021946009156 -3.9324779739372682 -0.13386932846889207 -0.55937700625296538 -15.007560534762952 4.0124738316107837 -1.7602897095102397 3.9293165348243217];

% Layer 2
b2 = [16.328659685797781;-2.1155940649978615;14.533169644273974;30.614916972136896;-19.025595586030757;4.5210401081151179;-38.005327586090431;15.766303007780305;-23.453441521154556;-126.2524303382236];
LW2_1 = [-3.1438718830991124 2.1064344503031922 3.1283958797829134 -2.0081590449507436 13.879786178574728 -2.933473652145687 -4.5622296793994606 -0.81933497261177846 -2.2394350311838815 8.705789731955706 -3.7679032802052803 -10.920933987846142 -5.4165467874622726 6.5901101341902999 -5.2002488464354624 4.758256111470577 -0.30622545982432325 -0.98385216281873644 5.8962465253586025 -0.80284361460871412 0.1516514379698326 -19.3675032724434 9.8754382926378081 0.070103356355091739 -6.6019464460074841 0.9157860843417035 1.6452928000196474 -4.3614201670606043 0.35718535452280431 -1.0969425056879689;0.8617160962281597 0.011284122245754518 -0.22027188134394335 0.21468168645432889 0.23863597837375281 5.3975653659119098 3.0329050446215682 -0.17090306541065417 -0.63110841466801881 4.5095047618821793 -3.0826117743249872 -0.55334120805745823 -1.8664254230001118 0.06878844865580877 0.073253645403607112 1.1098451668752816 5.3063136636418831 -2.1622402306258346 -2.3594466215279897 -1.2642212539822306 4.3035170578710895 5.5147014354256108 -0.35320251302871897 -0.39192006208565661 0.062345175889678431 0.011591310008698156 -0.099869858023868732 -0.053579449346697505 -0.39046878703788912 0.51973866427251614;-2.6915948528496534 -32.014599518974627 -2.7922054007439825 -2.1624850144352474 28.390808214689283 -5.5847408382571606 -9.3791578844949335 4.9496933351564492 3.7042529366910908 0.192696868510119 -9.0491727747714226 5.1841787370783088 41.019407652859094 0.21430557644541176 -20.232781283968919 -4.8055717155556001 -15.37107398442399 3.1127527917064874 17.329720029397155 27.73918334316259 -16.948196195571949 -51.018968444885402 18.5817046040153 -24.567880579446946 10.630354496317771 -8.6946381135205275 -8.3414578983117149 20.666483785781892 0.64120410038930298 2.7292602859193384;0.63756689974149672 8.1744618766151707 -2.7223449743813881 0.86823687590262777 4.8204385446924132 3.6601718443880258 4.4992987407399356 1.2135898614305904 9.5055118788467503 -0.95858047994457474 -3.4776852813371621 -8.3446488660766196 2.6914248715232136 4.9660627975299168 2.5410347681588625 -8.3705520409863698 11.795821127091816 6.5946041702371723 14.000092195969886 -4.2107283182582842 -3.0663895178728482 6.8962116855055333 -6.7130215246374503 -7.9860163201727179 1.2232173201246346 1.865447715504992 4.4157284825068714 21.54554452044367 -1.1073209171732845 3.7790526899321391;-3.4029774301241673 9.19947587789623 -1.4698692023282083 13.007849928884353 -0.4647451831711697 1.0119845320704093 -5.6422495709542702 -2.1010172047286915 -4.8095377925582321 3.8622439430234277 0.88409023109869644 -0.23388071962136237 -3.8879994434348846 1.4796769778475329 -1.91740482433818 1.3182129741244279 1.9829811257606718 -2.623041951071186 -1.1920050492898353 -0.48541912003745957 -5.4862499056149456 -8.7404946336903198 -2.4091538032363191 3.6311553361370077 6.4477805998143261 -7.7358782423393686 -1.3401123261318282 -9.5641140083889269 -1.1487528710153705 -1.1631304364921418;0.19528087726611376 -0.46801164378624038 0.83012524671249044 0.08909953094404241 1.3688524750819506 -3.3894251507675333 2.938839298207117 -0.074137896664458663 0.56379006359330053 -4.4592406030048064 0.42373506000390537 -0.53438519461873157 -0.90475848329130448 0.054007801095703883 0.39008901174779503 -1.7969227061026576 -7.3814942770919707 -4.2763674957209101 0.4401350476084282 -2.813311739869726 1.1045934230889365 10.719571676985574 3.7202854241352123 -0.19349254077312913 -0.027052712680432828 -1.1081171978593223 -1.4617014253032345 1.4947414581817431 -0.11484401415722355 -2.4180733430196666;-0.71022925529679826 -26.323385858159948 2.5294550283265691 -1.785586408656332 4.4275659582953004 -1.3548147874836269 -1.5847884842338364 0.96771362989088949 -2.1832164126089655 -9.5210772588779555 2.2040812114996773 -0.95682522874348819 -1.1993515651537061 -4.274784614698512 -3.1732526334850415 -2.3907175802225686 -11.170976388728178 1.5740527382104592 0.69567914351277205 10.047262904384839 1.5040220902567571 -13.136229634918154 13.416362147864978 -2.8568658628388293 9.1989401298804552 7.9303646400446235 -0.64003917370602392 -22.199693920433916 -4.1356962790120031 0.30396467596038523;1.6142105063728411 2.0911364519346392 0.42858054941505752 -9.4862125237430721 4.1688969561542448 -3.9429070264123061 1.9135228256489374 -0.11252676485847522 4.6424358159369765 3.2383455453702079 1.2481050453042848 -3.0120820263957442 -0.86681852029516482 -2.1872231221940264 -3.3073621483567472 -0.36401317933437943 1.1839009540687238 -3.1683962358228075 -0.035934017146277066 2.4125169733027829 -0.076286934297684295 2.4674018052417552 1.6078002443059749 0.070654455380930764 -10.359435044906933 -0.91385570260522542 -2.5469513079811796 -6.492669336155048 -0.87025961697525756 -2.300827832720088;-1.4697012611196827 -0.32120814350162175 -1.6417208633405183 10.432853664725252 3.1701563298952262 0.27745293014490446 -1.3735387698498243 -0.055905654681154181 0.43177026810027047 1.5852373870519092 0.13682203335470275 0.35913680219218747 -1.4862916756656614 -0.10155091370302401 -2.1241520468017887 4.0033204266128788 3.941230150870497 1.679852835146185 -2.1018069141628426 3.1864976971954988 -0.45623584468346917 -9.0346736049555947 -1.4432182818644057 -0.094985130522823202 7.253102630114534 0.31711816291931572 0.84120947072805208 -0.84807758527666099 0.056813358112530597 1.394407561565145;31.102330669714743 -31.498711949353421 26.979938700178909 -116.28134300082168 -17.016259154269378 12.019926937078429 -40.494539139918537 1.4619016646227667 -4.6678105047936507 16.160846012936428 -18.47506719934751 -55.154374991200555 22.007041431097868 -9.0901953012500574 9.4699880641313889 22.355746075609492 6.3635730430164603 4.0762928917530212 -39.819344424671804 -12.172850104327232 -5.2663321637102865 -70.524152996606574 32.351755383483557 -23.77416031609917 -6.8894305300943746 7.0307579775757887 7.3756111016010513 -167.06402227206374 55.777025863096057 9.4455592193070999];

% Layer 3
b3 = -0.91401311090154247;
LW3_2 = [0.0076432466136342808 1.6242273722509248 -0.0030646955872937146 0.0050661785777836423 -0.0022793671624714395 -0.12585558729570173 0.031324863085999327 -0.0072363418525817538 -0.15273612714158055 0.00080547705926470954];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
