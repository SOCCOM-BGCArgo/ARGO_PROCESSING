function [Y,Xf,Af] = ESPER_phosphate_9_Atl_1(X,~,~)
%ESPER_PHOSPHATE_9_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:29.
% 
% [Y] = ESPER_phosphate_9_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.28;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0470499670650231;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.4036947217877342453;-2.5725793512965027254;2.458026090039175493;2.0451048496250914255;0.43924956097111045317;-0.27602513464300199031;-0.41869590701620817974;-1.4542022151344482506;-0.85071375040551666658;-0.48101827038032690664;-0.52556112593238824005;-0.45269297300851962795;2.6735224615624733069;1.9253453865149339208;1.324986085119235879;1.3251142616036302169;-1.158605454055233297;-0.14035917898481722887;2.4281217865837536607;-0.075479335430782001914;0.54607480098098137855;0.29120590124764239581;-0.31737883979432712778;-0.17716608935889621712;-1.5358574729279330651;-1.9076549527803572381;-0.81510953555271203896;-0.44731165753866780621;-3.0990127801564537613;0.41952453815681745031;-1.1752434827946209861;0.99085211540567486033;-1.4029020112099757078;0.2322167184964488984;1.5201919359174926871;1.8805021996517794491;-3.0046354351432444929;2.9160156540710122641;-1.9759166479019436569;1.0698915864363021111];
IW1_1 = [0.73714361833690156267 -0.69805480883408410619 1.2184256218411959605 0.05840292068650330265 3.3601313421422536187 0.7311772278938352132 0.40725247402112579875 -1.4405210920741822189;-0.02886535974219241879 0.68182152267183648853 1.4579185178229874253 -0.27907737572050234087 2.9768018455451925597 0.78839942268789631186 0.26378272682274450656 -1.1921630750746039507;0.0083377610740122329314 0.65723367767148044294 -0.29312270732381429106 0.76308905775021884654 2.2542313617992979502 0.21531660988367362641 -1.2350218432870674334 2.9254952106967575531;-0.41538551375127924503 1.198051084959485646 -2.8282652553918659066 0.073253011588307187507 3.0020952420883308953 0.67905593073008818639 1.37805753479365789 -0.43433091051885008849;-0.42996093827544079602 0.40367390053266771766 -1.3778309312299421574 0.19193562901586816438 -0.65478500656697624649 0.22387492417774640385 0.060917379154527356855 0.079102115190783736653;-0.28461589669839265637 0.57465498930787828336 -1.5012114523932948984 -0.035575219150667865275 0.40416579841846261845 0.4437849662205657908 -0.54406485403394122535 -0.10459753749328309924;-0.32105455665936322163 0.49245945556170478419 1.4652330008151426277 -0.37272825439567197625 0.38706859278077360154 0.74905631236352232527 0.50108868127769268241 -0.66999556121575964962;0.0054015326189612716812 0.25816186802604496053 -0.0067505862953615965519 0.17608244315452631357 1.1647941395223320171 0.072203882851375841834 0.23904614063813375835 -1.1695547817901899013;1.0770770387403958424 -0.23849465684533088794 -0.062942093523109685083 0.10574924722268627675 4.3902127345070276476 -1.273616850306629189 1.2400539198258575535 3.3228805759231043737;0.19271463505391478455 -0.060214002956828154012 -1.7007474239149111828 -0.11800666875737023109 1.4887578773072542848 0.36335479066836934292 -0.00020843277571878536178 -0.51439273639714477859;-0.28526814227326352524 0.62656449836903926887 1.5527692036087701322 -0.044912573374332881437 -0.11473746489748806732 -0.012680812087804839428 -0.15684571565897353906 -0.13026500921382683229;0.71485288424882997838 0.18280493471526965132 0.0054478297079163726102 0.76385094744822545909 2.0124930066767126036 -0.088829231202824321389 1.1373262513636737125 1.8806558931938219814;1.2694262856243161419 -0.58480226504602450532 0.17281209477660999796 -0.51401051258357999263 -8.1078568267583932538 -0.15307200098667550492 0.88155910703966977593 -1.8891293795082806373;1.9286879346225873633 -0.98586512928775393849 -2.0742145168688224111 -0.57946386707313080056 0.40446719491306543093 -2.6360047509315633896 0.53848360043201914937 2.8362381758097594542;-0.25985761318031935785 0.25659979304635793795 -0.21371897798172856398 -0.91784056981257122754 -1.4025115393739078229 0.44780059382174736138 1.5963640471044442393 0.83412185384191228632;-0.98315056364586683735 0.53056053449933693322 -0.16655272736030279912 -0.48086126781694898957 -2.1834321425322413823 -0.95392391563943779165 1.3127132183068570548 -0.68717524723996448177;0.099797106619078659873 0.22691190546970024799 -1.3146228729096864907 0.024430737863852431541 0.65493832289402986735 -3.0653244812907045613 0.43595614804528548536 -0.30438540471537367527;0.27752007658606858698 -0.13021492957065206042 -0.83146779911247536976 -0.041371834297391434088 1.0666654407879523347 -0.21947372508301621341 -0.83083075485823898454 0.17077374449601404049;0.65763334005908113955 0.32045296554462482375 0.97107425165723526561 2.4509904849604078336 3.0385912476633234469 3.1565866234193604711 -0.91447869584137897458 -0.77106783589629912523;-0.87772036245807516508 -0.30779777129023799809 -0.049812653127298836542 -0.75202107068869505913 -1.050360883794063227 0.41220628147138210773 -1.4555119967218090871 -1.8374203497685952513;-0.20597564516726085682 0.31927908051583697713 -0.033483752388706954084 -0.1148343365638878899 0.8030866796352568171 0.20117551683600054524 -0.24270373126228395044 1.4721909469076543964;4.9240914824876131917 2.3645541531862490636 0.22885274882511663641 -0.11204140748724907006 -1.5097225374146128196 -1.3716733052170568818 2.6713157539975052046 -0.066406310167448259763;-0.32357430178820967281 1.129695100264979768 -0.069272620939095141956 0.74305321299414250902 -1.979760767176504288 -1.6916575441064740648 -0.40874201949074701057 -0.025700947894422496165;0.09017983022900850909 -0.80348665190595680574 1.2938241359885664927 0.18055967585097149053 -1.9748978941703743128 -0.37608054865694806601 -1.1280618204565919793 1.1448270640203670467;0.71374997965008235568 -0.46154348110955339957 0.063018514604495895481 0.040332740789927309932 4.4755189219827995473 -0.22259857888411135884 1.2043080794465368388 1.872431210512181643;-0.51741347043485930168 0.018572543815018778546 0.051309958174316050439 0.4806112512944962778 5.2905382504414406597 -0.15542196033810307121 -0.50091854395443369263 1.4869835817906065234;0.10868361603489012923 0.21918636060513357888 -1.4105705879954784088 -0.11545975447288923943 0.13088197370679252596 -3.6176037776213396668 0.80128604575143935751 -0.0338901923694801821;0.35449128659742923375 -1.0228742955385818902 1.7531410344645537158 0.14075215701823320935 0.25773276392448518646 -0.85199398138028015204 1.4850589533689413368 0.33360346058343626208;-1.808565571256366411 -0.79848082989946822519 0.80235617248193569218 -0.079135200406830460973 -3.0876153793001921422 1.1483882633084070424 0.21052637040884589203 -2.8543116956201410872;0.30176784022096764248 -0.11295767409105546275 -1.5455981312329023503 0.034222701432230523411 1.3640633385827478641 -0.75197893411350036352 -1.1907862357701544109 0.6011457170478127221;0.40821844404992074784 -0.93992422996784463773 0.91542715638421345847 -0.8892421372557678394 3.8027179574272338414 -0.37592615863873324322 -0.94732437321049234313 1.4908417077462994271;1.8100566567425604436 2.7075895479739435778 0.226907756542908845 -0.29409230838876232461 0.33567858995913185671 -0.60575168929784350969 1.3185727216137470563 0.043880215447715191501;-0.82282160668878490117 0.12640456433842353623 1.3921696037865476381 0.086065183309456547156 -2.6559395759900636946 -1.9763302810425262823 -0.76108566775798258686 0.83215713037685767883;0.30326676646297534568 -0.29041762614294930334 -0.10385344597074604167 0.7507536479199634627 -1.1304295179353687217 -0.69423562192931653758 -1.3540526743109242425 -0.97053213577135588608;-0.20547384572065541253 0.64467210699116972439 -0.0075355618072768032131 0.22689527072151369214 -0.41572370880108955316 0.50455607694032522659 -0.57007670712920954781 1.5457801994437758708;-0.079887036963167915027 0.45416030468334278591 1.0425116714870765744 1.8787371639610277452 2.175256963644887076 1.6680289692659810985 0.30376526407643755778 -1.3087652709395292128;-1.248949572407492381 1.0102920416451717234 -2.4058803876886170059 -1.6179001580677969674 -1.5306914942469758145 -0.90314491143277286778 0.26592467247150686216 -0.7752796928536883625;0.24418718862571964223 -0.38686085919053186943 -1.0353474606347199405 -0.13818271727161376972 -1.7185424211416917561 0.16607813082555056283 0.95151160675226797991 0.089249704415338193542;0.47064065663285464813 -0.44750394900035600498 -2.2248311222710874802 1.3558280812190837139 -0.46310373193145365489 -0.79201831053700133545 2.1050017199442998539 -0.41108905801583883743;0.4912436020984368712 0.32085452058282087906 -2.9347472764757571717 -0.36281709660650285354 2.887983031295564551 -0.72291117648665115247 0.046382068298114823013 -0.19030970643175001977];

% Layer 2
b2 = 1.9534873331721276379;
LW2_1 = [0.84616574441689884623 0.76822376907222800213 0.66737538290729558899 0.6507850200300661081 -2.5200909331899778998 4.1085660643126651337 -1.1764162245616083258 -3.3031348160465126007 -0.50470284849255808712 2.048699630721093623 1.3444356076023091795 1.0640445449636695141 -0.30575538283271441742 0.17551935996201306622 -0.51330493323590431487 0.48391489402128268216 0.78977227150007733858 -4.6429287704070860698 -0.26744777288564824946 0.87586670864420623772 -2.5197073493524277943 -0.049284742271624555621 -0.4952636605248567081 1.5663958940662974229 0.80256340687355931518 -0.92874673198336743507 -0.59814355248854544911 1.3294223245648837395 0.72129094916957092742 1.8733925981269976546 -0.48824786613789344925 0.12415478283591729891 -0.68415754663757832876 -0.59800932646104698609 1.1721138992579684945 1.1457146459496045932 0.57711950854018922996 -2.1156933141508309504 0.17637949308262984571 0.97768792862563291823];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
