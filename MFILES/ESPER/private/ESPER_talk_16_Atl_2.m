function [Y,Xf,Af] = ESPER_talk_16_Atl_2(X,~,~)
%ESPER_TALK_16_ATL_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:51.
% 
% [Y] = ESPER_talk_16_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.0880882005651604;1.6076961097532065;1.5778848102240539;-2.4605487387267448;2.1225723658480535;-0.75543292169075571;-0.25478381225536617;1.2493905100843472;1.7790415713139547;0.93199617524263856;0.43110128442619677;3.2985892788114914;-0.14468542276454505;0.8221920593913471;1.6173623638519792;-0.92205189236003005;-0.75204204787545215;2.9037163847738698;-2.2254643878253089;-0.58181420644378512];
IW1_1 = [0.43697987293072726 -1.2064750548690584 0.4978980211512451 0.047442099705948822 0.058323082095508669;-0.77705850954947953 0.17732029700761986 2.0304866066241107 0.013066809486759567 -1.6706401714631445;-0.47677172276689345 0.42646169094897296 1.6495248297596412 -0.22957721289359459 -1.4173837656862143;0.87845805313282765 0.7147759086710791 -0.62488835475745452 -0.78106054557034899 1.5766754979324895;-0.53535744329547397 -1.4334127094477964 2.4621575334007906 0.00027349166388963148 -4.4963435236668996;-0.29127813646011996 -0.81308471373757485 -0.014322630905105901 0.61934846843780311 2.1787239029820795;-0.18752092997471007 0.098065868477068635 0.26736737299884317 0.15583851510554161 1.0404682666381189;2.1865194808093698 -1.3411254910694652 0.084193697841916978 -1.9347724800586066 -4.8536428938943823;-0.49566345436856701 -0.32684977979955609 -1.1747992558948215 0.28589833120306529 -2.4094321543964479;1.2242665096075322 1.2226168150387076 0.78012285863732933 -0.38937896035536551 -2.3953409885913186;1.0036985969171939 0.8117310878874795 0.35900730092923466 -0.48736906478955572 -0.038253876764160581;1.2661456705153249 0.92066182302177213 -0.31366950575975983 -0.44997723207722601 -5.3478840505208609;-0.40494748776371625 -0.54417603415195404 -0.66726381064958362 0.029863447084707732 0.59913341208590865;0.36420213837072563 0.34295234752741582 -0.068259147993984706 0.5783021665471948 -0.88273327243141586;4.1513471865412859 -0.070037179404201719 1.5853460546118519 -1.5878162879121802 1.1979895835373102;-0.5507988245897919 0.071306202851844178 0.9454482805777763 0.42341441436391042 0.60666703562911228;-1.4465470074574311 0.51773450976114255 -0.9079432879483007 0.67243210474114468 -0.25014392439395694;-1.0307245297985375 -0.43876632829217427 -4.3017847895409842 0.18419558067507852 2.1303747213784621;-0.8964668834098567 -0.75960262121497513 0.52314243317500297 0.44410060187995137 3.1713471686067276;-0.84602309252966634 -0.54505568495638068 0.0861420842114064 0.45457240852473108 -0.76633247995874687];

% Layer 2
b2 = [14.631169369575099;-3.4767776353247282;-79.306940976057405;1.7936424699917535;10.574146299659237;-1.5183580395951553;-4.9632150575897649;-1.9250630698786468;-8.5931138577646831;-2.5205090730811923;15.741472348662249;-12.261815004912725;3.6878534515046102;7.6137425355886439;5.4767735832369331;-6.1873169976488862;-4.6062479093739279;3.6347668992274986;-7.4275182028324194;26.244822285553617];
LW2_1 = [6.2810112248108618 5.296996435469044 0.19091623433325189 6.400814203863753 -4.2124254144963968 -3.476786187568166 -3.228572156810174 0.41659069513643526 0.95460778573278249 6.9897857495624631 -3.1881450446780653 -0.95904374536628756 11.799414405088035 3.1679096594071168 -1.6373595330568862 5.2384187078369679 -5.2920974940911796 -4.3182152617655332 3.1080084259580345 2.0818859333253568;-0.97932932285238061 2.4589405216670213 -1.0447400756192262 -3.1101143495957451 -0.58797608880014696 -0.96927429356092965 -0.9057122311089596 -0.070643559934366329 0.30323828543853837 0.5172990316326338 5.5989703448758066 1.3239692819861038 2.5393156888652242 0.61916524923079186 0.21278456588156736 -2.3644569075702031 -0.4876151331504629 -0.19562561705781586 3.4693114730476005 5.5171392149130458;-19.397884491218605 12.377716266998105 -5.2026101473154434 -56.942651309447903 -10.072487014386347 27.183308629441623 48.878771104141222 -4.1591356915461635 0.28063752356275617 -15.27648509461558 -2.3858695511699803 4.2263320193835492 -33.16890205930784 -10.248789282043722 -1.9173657585299051 -21.511580095613994 -8.6569801943751692 -4.1529578323853036 -28.342184804545461 1.2350115853093491;2.0030511555814314 3.825869154195253 -0.8841504437897072 -1.159479912013285 -2.0280414048507569 -5.3372362076688384 5.0650491203794683 0.69056294809185226 2.5082862819312046 -2.6040507459591633 -0.77309399209848062 -0.081141209666344499 -4.7179422651749228 1.9918567645954133 1.8458024378982194 -0.46869163643420875 1.6037888610194193 1.3107554441407563 -1.3263296847882398 -0.26939064059415901;1.6538172888269254 7.2217972277321296 -7.115540058690776 10.110985434334768 0.63524813518242851 0.48664984017274793 -4.0483530098721525 -2.4152620978050194 -3.5806815596572594 10.742960624685884 -4.2002532073665151 -0.33565760495546787 8.6903548272115199 -1.1858378870242812 -2.7468453011265037 6.7335204096329795 -0.25180109804712208 -2.7637896549850431 3.7932684366245968 -6.4008809551180406;-8.5825427317383554 -1.6985281045898404 2.3546235211711912 4.7465311178355316 -3.0324500086568036 2.0091245715829542 3.8687719605993012 0.31327599213186424 -1.2682750350430907 -1.2861019872648753 2.7397841727243373 1.3227643477947908 -7.0400110046872042 4.9575937099074201 -5.2051267827156877 -0.42835423400553008 -5.0926918042084237 -1.1377106075141903 0.88744148903007558 -0.8552884279285734;-0.65999383584432314 6.0838247379468315 -3.9933300681945667 -3.3728230616139996 2.9729537207443633 0.82898464836446994 -6.4068781583243357 1.7412448472514614 2.4941930751716557 3.7477534136002375 -5.6301271828536583 2.0571207107998313 1.3408461449895621 1.5614811340444219 3.0101887180911926 2.5696798845281719 -1.6250461274990586 0.35822933114270888 -0.18758489602729062 -0.77487084987067523;-1.5487191540684675 1.0241483389658403 3.6350148949353156 -1.5659351380591073 3.6883597555724168 -0.87085238576878898 -3.2236626638462167 0.29899499567892251 4.7150730288917408 -0.35917103866337863 0.42144444594382802 1.8756233419459551 3.9423467424920813 -5.0613422488944959 0.049507052926858704 -1.3658719223617481 -0.65754399264637242 1.3686644364079212 -7.1680416916566667 4.3726713578960998;0.39591139365890504 -4.7628038419381227 6.2627444995643264 -4.785192897895163 1.0569054956805031 -0.078375020711223223 -1.7128774869571619 -0.057841045764291041 3.2676162769869248 -5.3782107822740501 5.6201738305983726 -2.8199830911439792 -4.5439439597843787 1.8270156218166689 2.1919555136641025 -0.69693360463622767 2.1422246168477286 0.085592075584730545 -2.2173019445203765 4.6246126592539243;-1.0341040998070812 -2.3840031872474459 3.5312504717279736 -2.5832044610118188 -0.46993559839326005 1.1739599257152553 -3.6069378866708481 0.46581129148063966 -3.2418553484643495 0.81216108095437012 3.99016325493263 -2.6296899458783418 3.8484467038601711 4.7923605907730664 -4.3317429846708189 0.32773722491200591 -14.307243413702993 0.75399422131461713 -2.2942532367544319 11.219208400833629;0.16867365323171057 -8.9043903178698081 4.7704583553862436 17.277956836537872 -1.7110998548192786 2.3615238027820009 -0.086649389551657768 -5.432576105754471 2.4271325488541864 2.4035203399216565 10.368345162338031 -3.1452391633941064 8.59467709944043 -7.5973661065143832 -1.6435004655194048 -11.49870705177435 -12.378457694638955 -3.4535016646589241 0.96457746595350891 16.510884896583939;-7.673620599087899 -4.31433743541601 5.5243460593292486 -1.5651247630893397 2.6915298162023089 -0.094963610302914073 -8.4044807192469175 0.29606239005775825 -4.0649550808381347 0.14274958831367526 -1.7482169518077793 1.842530323248337 5.7782235960975923 2.2573241818300978 -7.6859231343493022 -2.0828930230415281 -18.694536734514632 0.42001644553223022 1.9725344265800551 1.4629266163789225;3.6614563431209715 -3.7655437705046886 5.8888840551338051 3.7427255998049356 -5.3527957809575524 -0.7983589066894905 -0.9818309698361728 -3.1948106687870195 -1.7107471585070135 -2.0247673496955407 0.73689182683523358 -0.59787791987313732 -1.1559273647837462 -3.075492932299599 -4.1850724886624731 4.1318733690075691 1.5140481305254825 2.3239300039463244 -0.86972294189400401 -5.3735412219563594;-0.37996520063109684 -6.4527495196489175 9.0801165474251082 -7.2987401918996957 -4.9196794962187811 -4.121746567049585 -8.7302950476839474 -1.3215223681986288 1.6385674166412294 -2.7084369593368489 1.3817626038000028 2.5498584274217286 -1.2491329034481955 -0.80740904524912516 0.88517982039801624 -0.092811856014979308 -2.1484569454433298 -6.4186936246195918 4.3364300825478876 9.5482926279932556;2.1599958636714951 -6.5449621238497944 3.7226025683836736 -0.88554318327821457 2.2543992902699475 3.3138677894270194 3.6667317823315173 -0.39580831906507957 3.0599849643763291 3.3850188886665897 2.591022446692556 1.8579990338076005 3.5864387221424181 -2.4369670403411821 0.79232099734681916 4.8059045207455302 3.3019177181457815 -4.8458922396316639 0.22184162755218698 -2.9911393651771796;-5.1233361432589168 5.4801171637402986 -1.9740640099543718 -5.1533668206460836 -2.1510393776766903 6.0024420266667082 2.7695821066039974 1.6173393599287955 0.32065493147891211 3.3653048540910131 5.3751622849955476 -1.89426378799802 2.7640365085276986 2.1799549230400039 4.3845784193624997 -2.8985101800314461 4.3312795740394909 -1.719623637055548 -2.8565284616721933 4.441236001874425;-2.9905281503173526 5.2661836607930024 3.2220633974141242 0.20356194227070162 -3.3363910871728635 2.55850583625765 -2.1196412601352437 -3.1483387574592192 5.1051882215260127 4.6839591705268768 5.0872251707148717 0.012467755058354412 5.6791106519808201 -2.1897593071053034 -0.56521883567489006 -2.526997774618343 -4.5407680376660586 -1.1086317288244543 3.3471676801632779 0.45344344870787229;-31.774663010369142 14.947170909451321 -0.20379229577515953 -14.19375393077606 -29.612122221959346 -6.7938383063132379 -35.571495569559922 -22.259375862135347 12.929702141945567 21.788237950894882 32.166371100172022 -24.66046413504035 5.0799585022641107 -12.724186050506036 -35.316543289533776 2.6802914804055917 2.3048792653399994 -1.7155229438561703 -2.4947366576911949 -19.843796191243261;-2.1856705092059663 2.2267009827205455 -1.9625365690099137 -0.23725288175902423 -0.67884435746742045 -0.48839747229174868 5.1752809275072247 -0.42801200188646277 -1.9559025889365913 0.7922911551393701 1.7797842626746814 -2.724726579822232 9.3053830085420106 0.20374055212596892 -5.3631224022384405 -1.8544358587598937 -9.1845998584487081 -2.2771689913759978 -3.0025739181768603 2.2545153706919803;4.0268741003149131 -21.646707133148404 20.955598455647326 13.678472563189368 -1.5752065123919943 1.638696913273251 -14.003113382378599 -3.1182450041056535 5.8195228987492031 -9.0712942919160469 -0.52425919148847999 2.2769509141446198 -15.122820611029907 -8.15505556903606 1.8358187367546044 -1.1735097343840517 2.0090553282751404 -3.7606019786297717 4.5046932279601792 10.508622163892616];

% Layer 3
b3 = -0.15678495963166789;
LW3_2 = [-0.011721950180386128 -0.28048572230870622 0.0022899117682981789 -0.11586830475123608 -0.007176471430497754 -0.0015958514510803874 -0.017356125302924498 -0.0044602040485165369 -0.60837956046878805 0.026039008571047455 -0.0071651053960209267 -0.0259228939074394 -0.0061791113884282359 -0.0091191646221088028 -0.30098156788459335 0.029196245927024089 0.02895981296911293 -0.0046414381316957961 -0.039786342123350645 0.0076178803857168097];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
