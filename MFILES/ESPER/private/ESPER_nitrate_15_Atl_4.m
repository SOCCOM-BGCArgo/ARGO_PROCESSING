function [Y,Xf,Af] = ESPER_nitrate_15_Atl_4(X,~,~)
%ESPER_NITRATE_15_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:37.
% 
% [Y] = ESPER_nitrate_15_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.1343912334734778113;-2.5018835642314245504;-9.5647733040135616278;-3.8245118408755507389;-10.358951303570473002;4.9212400136639837811;-3.8604175005830372314;7.6177080342311978001;-4.7539726140160949441;-19.964840759283120519;5.0762062907303100445;4.4420459878647768903;-2.1246344239240824159;-2.7425397320209934371;4.7793811271106818594;-2.9775515753594299362;4.0723761084736018745;-1.799371112357234459;-5.0647068112408462071;-0.89201986892899454151;-0.5877228343055669324;-0.32062006214855737207;-1.5146068176193399069;-2.3248259250612393068;5.6197917148476648208;22.074556601720811244;-6.9274011097745251675;-3.0351861561705208992;0.68310853823325901057;-5.2500954823710426211];
IW1_1 = [2.7365842005262002168 0.51486616374283911135 0.59843812727728840084 -0.51656061277207265814 0.99038645604033548331 -0.088627557851477536954;-0.1481644946138656882 0.54868136344119244896 -1.2899259555849380554 -0.57101273504443950113 3.7635063347733428429 0.75612632331397167107;3.5523074629183124529 2.6362053237193809885 5.0214752655918051261 -0.51671288253501068688 0.17977871506059883711 -5.9486446328990165711;2.5480821141695022547 -0.05425840843076810277 2.443651268883612282 0.094844578212000693607 0.48690023930482517756 1.295970593589545361;0.31380109784098225711 0.8926487989535794032 5.3913160832366475717 0.42278321779102373545 9.7124625418462944282 -8.4439359424306221769;-1.2231766279310707368 -0.83004600821762053453 -0.34322414764727599001 -0.54580063178281357228 -4.0203731707555014907 0.097452041290985544353;5.2879684486710916147 -6.4350939424442294978 1.6971793676778588189 -1.6128506355429821362 -10.248580881729900227 -5.6909050645182599482;-0.19007384451375286538 0.2638370453451801545 0.02707519500919183808 0.68340205619630123302 -7.6330953295594232699 5.3626016706189325589;0.48205145133504945232 -0.25370154601755579016 0.74490175741461051029 -0.40584363680562679511 7.7103822253863825154 -0.069952115912427531574;-0.18200098593250293999 -0.21056330806106290932 -3.712087533072374157 1.2803143835696813024 34.08617937848578805 -0.9869386148915403334;1.1327799647831890972 -0.41868512773855132147 -0.41790763469061881219 0.70533288641200508895 -6.2553476782385164512 7.6239863108452068374;0.57809877729976810734 -1.295447182375453421 3.9902355626343468664 2.4823697116477054792 -7.3032569696754210398 2.5731802180757088472;-0.076190526256807292182 -0.42449614620725389935 -0.73596597969337596012 -0.00069044763344290344814 1.9487068161660492382 1.5037429954730971993;-0.65438580251214983896 -0.23612767151672883759 2.3291120945505818796 1.0190698888354485785 3.186949519144694154 1.4273484373030984607;-0.075277972909372756205 -0.70159140892905680342 -0.44138538069252503115 -0.6217539669837871541 -8.4405980858141251844 1.0346508595034904499;0.10189517546770682221 0.035815300449668338589 0.25025651022907963172 0.24198589886469509813 6.1538751037951042733 0.34743871318607488785;0.016071664819913178412 -0.59027646098286912224 0.34634787938687067177 -1.8803234531838182164 -9.1641837167854589552 1.3751184810754122356;-0.52614017692204806398 2.7625641077413720659 3.6824374728575426374 0.54610086251584843975 3.2280137754504396597 -2.9580404678151070996;-0.29968321272433706692 0.27866108515542359347 -0.63347250018169587449 0.64777191215009066738 6.6392332235914706118 -0.19538858560600802505;-1.604981612285654613 1.0218865165924047034 0.16629183831866062304 0.91092354503653427678 -0.024835764566080428817 -1.1102676503191974966;1.0544786888748649556 0.16796881577190095336 -3.4488675574474512153 0.82005145473801210887 4.7019171818679108554 1.5907351850929343229;0.26915140034395756974 0.40936934707448219273 1.0338384017673609705 -0.86669452561760806919 1.1518426949554416705 -0.68692534567095375753;-0.66500219360487955456 0.47730791574372383179 -2.0471603363278081389 -0.53441424316014152218 1.9070508110407371483 -0.73790638666075714092;-2.035839011475774285 0.53072574400320204902 1.2903482931841390169 -0.045883378067532246125 0.72533658934382205796 -0.13003756307828276406;0.96721310266713000914 -0.5106531115672653387 2.5042784494501360015 11.411002084062594975 6.5005409428554195017 0.94859639288324848483;-0.73691640427250626466 -1.6138147810880483224 6.0625336804907341559 29.978463022959576989 7.2530492696871684544 1.7696647019659643707;-0.38032263007575206615 0.88658909791255513522 4.3211020347792246099 -3.7203863975029309863 0.5897589674115828462 -1.2469911542873894916;-2.6405854654036668983 -2.3801020975485669418 1.6333763646088486077 0.067587305174389378237 -3.6064047454120204961 0.55783534377908416957;-0.16057023149817220564 0.46345493726618064434 1.0962858554306973424 -0.18333786730033138634 0.43248981351144422103 -1.2999319778606219788;-2.0383996400206676469 -0.77232060053991424819 0.26532261409683838282 2.9505169868199736527 6.5844696181414041902 -8.4159314815619836736];

% Layer 2
b2 = [2.6243912937807993835;15.257787381781234615;-1.0864840313572479147;15.680916340670618681;3.2725751691553544021;-3.3649624603243277754;6.1715094349103845062;0.50686096574138195248;1.2352927306438807875;-8.7443133672473827289];
LW2_1 = [0.35411461262989879506 -1.3827195591101471006 -0.87875091975534636024 0.040658267671437403612 -0.50843257177947986936 -0.78931270332790570698 0.21719428525506540018 -0.31802044218887859373 2.7991761212278500892 -0.41674183147207949363 -0.030095289091330496012 0.045115859149441106535 1.5302936033110252634 1.3544835574819511503 -1.3543499548218196349 -3.0258345571378395533 0.56595127521315280461 0.24900962374610932648 -0.96518567669550170418 1.0020371050683125613 -0.74778635231219137136 -0.20604105020899565748 0.8837627039404342133 -1.4680980482168553003 0.81202005318164860448 -0.19246001980816421217 -0.20512946140636650894 0.016119414179788175978 -0.4903318849050060102 0.17392502282472635522;0.50455180915871467029 2.9388239918622036662 2.5672387726023835341 0.56347448165445834789 -0.98812162869043351776 12.021851591167944662 15.393712220670561663 -1.7220388956951129256 0.034395700427401622312 -4.8860848477563525449 0.55273326403108336002 0.66641239924679540607 -2.2249867815556436668 -1.9925415883776864678 4.3024816582039386859 6.2090936875016913277 -4.0207579923115170928 14.083215190995614918 4.1527321945429873651 3.2786503832102087408 -8.0428693840218006272 -1.7933782505815043518 -3.308456679431122982 4.9806910115663889371 -0.85121251721297608306 0.94637914602707151612 -24.257482288874101073 -2.6281290486782840077 -0.36924587276362169641 3.8338931850594968331;-1.4476277461827280479 -1.5441173144204647372 1.7031779522644352465 -2.2603921835539853014 -0.17868934474722550365 4.6990663869471482883 -0.20221694748435833922 -0.36392741606800221854 -6.436559943764018854 -2.3933492462215029128 -0.83525325791015547772 -0.70282036889010934821 2.3633033705172805661 2.9011497676260389333 -3.267151854145899037 -4.8968872611371399017 2.8145189989420091869 2.386296452832810111 2.3798342574890476442 -0.14286764212737079749 3.6443491094783353468 9.4503423274462097226 0.74256401469246946512 -5.000572386962853777 -0.75322466864889481286 -1.0146945207537381162 -0.13942376406752840512 0.71981203413224059684 -1.0723293700450124977 -0.24525119767386738268;-2.373665141363804576 -1.2424273660533504682 -2.9356040587280163301 -0.33481764925172252667 -0.25289610671405970965 -10.558907366030572561 -0.92898898975675769929 2.5968335610862021134 1.6363589089268355536 -2.1645062773893855024 -2.7199409253396980013 0.67398585460311244422 9.2982877739055442845 -0.54073933998868017881 -11.584937988340024972 -11.243686632525282221 5.3208079897970037564 1.8759000110444579157 -8.4866059093893078114 5.1794469399770868279 3.8289873136122021258 5.5705297252314416312 5.3893236561040662735 3.1037133752590806424 1.1904532792732875901 -0.5509541300802021091 4.7616153565750769516 -4.3726125607635397685 0.87190960792656446721 1.4383332997651601115;2.5887737668920327572 -1.1614023582435952786 -1.4392149591696070665 -1.5256263021207836506 0.097561773335322593548 5.2942239666793291519 0.7211873208928534229 -1.7888330511254073585 3.3199030297495837338 1.198602553362816403 -0.73557076468511473077 -0.87948199407545757378 7.1056800067782859287 2.1028251495776890678 -1.7596347957981925969 -6.4633134691518812076 2.111097533204651544 0.22947327103268605475 3.2468356567535305857 3.5118263218705716433 0.2752014434202016413 -1.0236064602677117374 0.11341367538031772721 -4.1773114866557294889 0.6534154037571375806 0.074856656225316217657 -0.36475544989710179111 0.22572602853016507374 4.5081824080837247237 -1.4077906078681516888;1.9410766102723397974 -3.3714727399226807059 -1.7282419152089678605 -1.9806280055062257528 -0.91080358729697363795 -2.0104637202183681666 0.28975752817538663608 -0.69430291792601395162 -0.7266847287369210262 0.8943882099504909533 0.19035198365593195002 -1.3902564927708700449 2.5179950596230806781 0.99979711797624704062 -0.45259926311068782168 5.123825649570314944 1.5884726494899745752 -0.18076969320887953385 -0.80480190389093275716 2.6691614644517018817 3.4865889383365669119 1.870772177444997908 -1.2761541224519594717 -2.3489773913897611379 -1.3780878727568832698 0.29338874430215461375 4.7481453118127019408 2.6698297107677908535 2.2804595207884132968 0.40522258666995703003;-0.089227859597147476944 0.11689668990514753832 3.1854772237311905769 0.35683497515424061897 0.0091335417886201711313 0.43025651332634928803 -0.50547490492099644843 -0.81819437124991400978 2.8917725904389763869 -0.05298390424381038688 -0.033561898114475643973 0.091246599175132531157 -0.20352185611889095362 0.17451005973995784015 -0.5519405327599572475 -4.6567830878673133199 0.088447558913851087592 -0.29676605484446000327 1.4354474114377999694 -0.49560917613754051914 -0.47004591407468077069 -0.72532666324318306739 0.19036389122276828334 0.1342970630420944611 0.26365592921360908596 -0.38096939981707128586 0.10394910556359156228 -0.85540069317457567699 0.45055294123816502783 0.29140990742466216235;-2.1497663943813329901 4.0802663922990429768 2.2494533638073082038 -0.50790124431809968719 -0.81062332093442990288 4.3170015064108460123 -0.19252773971576492285 -2.7361641771352456232 1.1593505311115113177 -7.3168010630455730947 1.9991176369427174908 1.8206897806106354665 -1.6049151478185024189 -1.2833212660318442655 -2.1604511398155499258 3.3235496960749895123 4.2131685639786544684 1.0344968418386182307 -2.069681739587657443 13.388250626486573935 -2.6562604652727435095 -3.6899736742644009269 0.8030173236925235436 -8.283916993321909672 2.1723122980409210747 0.61978402559760525925 -9.286676598752679368 7.7431456962696065816 9.5773037922078874118 -0.63579894158153349437;-1.5144242482841276942 1.4907390188585218915 3.3337307381103356008 -2.5971690382750929338 0.78179527346880894889 0.3785698898403128676 2.3137393622991382358 5.914736166978567411 -2.0974249003985008244 0.0041424646646402232819 -0.50241944934948834511 0.37487047369994580537 -5.9115591642453049204 0.92652458000671789051 -2.5669702774730991379 8.14535860780845411 -0.48111040153492862226 -0.33971178540201601992 1.8094116467003005244 -1.5930941136937513125 -2.2504251607185419282 4.5392753193596044881 -5.7031578281243957562 5.7994088531451222224 -3.7205699954011022257 -1.643418060642968026 -1.0985170430671484798 6.7219908397725234295 -3.4612337443344105559 0.14338066111401523428;-0.42060525749791594086 1.985274374046560153 -0.75388340859486469014 0.62295511490108090857 0.14813150749262427031 1.2296032609348923614 -0.31123799909478044867 1.2031205914398124257 -4.5936667809501932069 -0.44710752734869668723 -1.4438643279336482728 -0.045106162719095212188 -5.4979041937206911683 1.1502516459723963749 0.19716055654148476051 10.243889317000707706 0.88673266791730365188 -0.66876717567233034956 -3.722191233953078715 1.4285580244578977016 0.091357358908691246868 -0.55266376369282432801 -1.0939677450186160446 -4.0212421068974393279 0.020935766703165131775 -0.010536038235745009625 -0.40533849673827626603 4.0130888440285552576 -3.8557735620641082619 -0.061718217476667128207];

% Layer 3
b3 = 0.13878978659646240557;
LW3_2 = [0.20498290074594940902 -0.22577533781170469607 -0.099235569475306970033 -0.1125258890089083641 -0.14146526831195357921 -0.1492030072755931025 -0.53653332259323027742 -0.054027260597112457263 -0.057713689002668565331 0.24482064356606589306];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
