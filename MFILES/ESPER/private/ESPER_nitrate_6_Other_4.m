function [Y,Xf,Af] = ESPER_nitrate_6_Other_4(X,~,~)
%ESPER_NITRATE_6_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:34.
% 
% [Y] = ESPER_nitrate_6_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-0.04979];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.568038194888224];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.4646528649431447278;0.40415519497246032987;6.8034578397635954161;-1.3901484365858807202;-2.8160323515522911464;-1.5754675365193362424;-2.1191610202377195726;1.7810403667995362564;1.2586631541056556571;1.109112573973550786;0.85219129203249766036;0.40208431790972920528;-1.3719818994832848613;-0.11781825335959072998;0.44780094844960599554;0.27318426357799191484;0.77405465869978062887;2.953678078899494075;-6.7067919371682416241;-0.51044154142634035054;5.456698661115426674;-0.69659208911411352183;2.4268231619476359207;2.2560116150650273426;-1.3964797103116879384;-2.6247779460168221277;-1.5548986018094446138;3.4290464759152654572;-1.8097447345254800144;-11.441459835754637098];
IW1_1 = [-0.59560031286502923553 -0.27027443277597335003 0.21035497721623003242 0.10887679640841088635 -0.23137612227953219257 0.89336382508430500771 0.95073063323945161684;-0.048926701105223374677 -0.08787832806437008426 -1.6572139231545184312 -0.62938045670615316851 -2.6393374140117162874 -0.49489612527148862942 0.66263776992767853269;-0.50271439664515127355 5.2359796222580241576 0.43429567991071083011 1.2105405333850232097 0.12534048200282307817 -2.823497089942908822 -1.3396839417231614089;0.12921388714708156864 -0.7631578782218915169 -0.77288494880359170924 -0.10542887357541790017 -0.31557353995420273085 -0.63786264600917552681 0.57675820404987276913;0.091607871677161417656 0.27528303366692125076 1.0647437908321064626 0.11639935350737996844 -1.1770031091294366199 -1.54126749242370642 -1.1640048571282777257;-0.34187920177679814726 0.9974714483448411384 2.3600471617967055948 -0.95523285939949742485 3.9875426068930344137 -2.247980968808686697 -0.5763157032539760749;0.91416037773259517518 -0.83416349448322468785 1.3821640008862152715 -0.27739437003849592989 -4.9748141757153598874 -1.7433084714690820771 0.83861536906431000116;-0.11109764559210616452 0.93074279254818303997 1.2423059486358787318 0.035116323394325132945 0.9300354800968521074 0.88299601530183657871 -0.56528842406499868467;-5.4771086193413571763 -4.4459018794228368776 -2.6523087615087170832 -0.25345873686414072123 2.9232764785868989854 -1.2051470989686943192 -0.15531183091326586365;-0.56619928398153329674 0.18446401145911053843 -0.20198567789091972924 -0.056674851882406070136 -1.7798286358573971455 1.3527230854686242978 -0.82182391545251720633;0.26900587539426906725 0.042056516194515100593 -3.1043610147012445921 0.21469083339764674645 -1.5049036083217666171 1.1153000103342654015 -1.1220501076946707286;0.1481317894525571166 0.027166792112473421572 1.2700424737152744559 0.48359453813363140195 -0.93082783237977972934 -1.0169253195549092794 -0.65185448987702843127;0.1699415844362739958 0.44968559352468107093 1.3672578644274466786 -0.18126198092892240044 1.9844302578460821795 0.84461169935149049692 -0.67471939685708437473;-0.28491366596695583135 0.00064466150758886019839 -0.90094612515598493374 -0.65967392396915947028 0.041077973348510446461 1.3411755959005708938 0.89381046806283281914;0.80584847121243707857 1.1201821761028361024 -2.1968818288139870809 -0.33457612908575484756 1.7435181508803114792 -3.8524101792596536775 -1.2780660505974408281;0.62100947931986560935 -0.033403211337278061743 0.39955408912885409523 0.4522018920077174875 0.069728068375418478242 -0.24219615999935031891 -0.32843853884933943421;-0.16886989013457950892 -0.037966653384107082458 0.32139477303079821979 -0.11596249211528041057 -1.1501288823625541724 -0.10414421469027089484 0.59972182986455280229;-0.033202873227642593079 0.13609923086440159357 0.69861257384252029023 0.88227508633115470094 0.28752949094125163088 0.81269187777078211177 1.6601283356058627039;-12.846825577950975017 -5.1259194799229756967 -2.9920555697896129566 0.47803583775356522922 -2.2537826476116666896 0.40117435640363507954 1.0650297859329582728;-0.42875133960650285703 -0.066967328160332018072 -0.50711685649731619296 -0.22872070616584205816 -0.53247372702924078425 -0.49829514086550730223 -0.30270039153990424552;-0.037496718151291213994 0.46196073631909279067 -3.0157614616151424691 2.20168602487406595 -3.6481711570574280046 -2.3690881668943619687 -5.4655084216645777317;-0.14592983705412113093 0.34202338020407851982 0.30973010065021766568 -0.12027783870077476958 0.8648813332540646881 -0.28606505019551142777 0.9885116047767642522;0.86368402379864839258 -1.3363264744481697655 -0.044602108835101912654 0.033123113251406113844 -0.53722520369510773364 1.6688527438320841512 -0.61398437716243781104;-0.041960709276868561612 -0.1186564202580631805 -0.6592920232106422862 -0.17326141214134421764 -3.1628260372820955482 2.090359265201755079 -1.3644571600436894432;-0.68661098915980700585 -0.10467672389144862255 1.804519613605861883 -0.0013078769851730398521 1.2748384569813544509 -1.369497708940425218 0.030424767903569946426;-0.23847802130033271539 0.27524326842181212616 -0.30857863461220319534 0.98262262305145164909 -0.31881323690339208321 -2.9701178126951104375 -0.67708516393102990971;0.012225349472855889799 0.1883987122896584876 0.43522973101157286235 0.35987671776394497547 2.4992846054975639269 -1.1328649606329337374 1.2847127841894796507;0.32668292651466579457 -0.25041933121686432706 0.37610290546216468277 -0.95846200093320177427 -5.5850873657113533355 4.266432058122548554 0.76264829851881765777;0.2032457718789972001 0.0031139930625323991933 -0.1562653407115904558 -0.35073538743244625504 2.3376014679745811264 -2.2889850437177288178 0.79273673190743121353;-0.18822927359747826381 -0.44680348662939201043 -0.19346311073306188266 -5.8538122980528024542 -0.48937104408364279218 1.3059924600641048542 -5.0645295609465454945];

% Layer 2
b2 = [4.7764832736452040862;-9.3378676967652225471;3.3206650313277368269;2.8053558503416700098;1.1694660591648788905;3.2697342489258818254;-2.1404257068899297245;-3.2215841927228172636;-6.2421274675607909543;-2.6548978522680610759];
LW2_1 = [0.15332833730756303958 -0.048733635963165308769 -1.4056733760618063123 -2.0529718355284778397 -1.5100337775197345547 -0.19783844023130095491 0.15320323351842946025 -1.4360018721116238893 0.067603876640312657309 0.60262962989800039626 -0.73262195492090531612 0.9525960025084152516 4.84243371687253088 1.2271904025458471033 -0.26656852086844973204 1.3421082774886592404 -0.32000077278121796809 -0.37478421239259213094 0.0048900251595449207784 1.6430824566302062451 0.22520625283908726755 -0.034921271859211400201 0.0145734580671077283 -2.5646590917632323681 -1.2602351431946314797 1.395131478308304418 -2.3142933646339547415 1.42384693854761335 -0.2177591532760277393 -1.8175578274435650883;1.2392580127337868845 0.46173219493156475446 0.35198705637858485051 -0.20441909869169988534 -4.8586909703317617826 0.20099544243435055191 -0.11107145402163462466 0.10287474380023331477 -0.08282345989206907344 -0.3112887061828126245 -1.1355650029721433558 -1.0177081133967529336 0.44863368835985567573 -1.0364235638851215793 -0.066747071947229813516 -0.58727669067180554574 1.1508108629775193332 -0.12873988671904898484 0.10547626312882002475 -1.1243808954565333025 0.46940881698185571436 -1.081731391539981546 -0.1098632845454728113 -0.79047555580291617439 -0.74757325274358810141 0.98827383803877100199 -0.13290343396371870344 0.77097046091165122306 0.59224114678308148463 -1.9929199776618995443;0.48446625569041490422 0.40227444845162074749 -0.70236184772564957957 -0.27960423646017634747 0.2081359533687120178 0.061451257930851328759 -0.067126501013210465585 -0.18155445807208336895 -0.0058172807542465516939 -0.37136625951178664495 -0.41080628887532844029 1.2059599623607302199 0.89951046323232308755 1.7630835810731890767 -0.16355287229599169141 2.3218023575841919559 -1.0678817257411212793 1.3453056817551569679 -0.013640753596515437993 3.0623076213925228828 0.42431754098017904209 0.84498805956148137497 0.23348711601390317871 -2.6490241940686751754 -0.62041760613792584778 1.6590019075874031795 -2.1324183181610036897 1.4859672085961583843 -0.037537859656044482437 1.9405072467307822315;1.9397272248113510695 0.61856630618822217027 -0.79850709361104121875 -2.653058415192258046 0.66578165929757227026 0.044893924033350358915 0.26218533814604810805 -1.765898307890191532 0.012992791622166453835 0.59812646194639873531 -0.8799716133213668634 1.7386919125711983725 0.79350166088594376035 1.7099910242923048731 -0.15062880213561946618 1.0447666781918742984 -1.7463585698157266801 -0.16917505608727656519 0.027602859556440182548 1.1398050998702766723 0.52627472679829945257 -0.31808732348030943626 0.42429046646761559014 -0.7394840951899365189 -0.73925403881444962106 1.1446037978537300095 0.20027255474819127823 1.0277656552208522811 1.5522859573233260821 2.0016122611971534084;-0.48477332133671791059 -1.263167108561531693 -1.4664055990043847189 -2.358551632698628886 -1.1980583700815967685 0.3348869568678162767 0.71627407294919798186 -1.357217536382428813 0.040827967201849280077 1.2166705103989385872 -1.3517760618389880189 -0.74857325690863685264 -1.135151194326854851 -0.44481619538365030353 -0.25402839844039010186 0.74263345897592658584 -0.98082865922574602457 -1.5118984308126779403 -0.10444979755447650338 2.1544243218721574884 0.14874419604451125099 1.1278519297765847718 1.0049710827523767875 0.76023234407858686357 -0.72817057707981069914 -0.022170170036776751243 0.15856490919602450607 -1.2396260565444447987 2.2804407647015749738 -2.0842641817522049585;-1.017311427092509879 -0.64314698860162611282 -0.96801588702892182869 -1.5201218605419650753 -2.5221635935099571135 -0.74979134136462066706 -1.0810193456784751298 -0.96739401100237865094 -0.18767992725101609319 -4.0326696854216912413 1.3490420948366494969 0.99120513525279130285 1.4346562143227390429 -0.2783120346794096811 0.20257536877494092264 -1.7682535708571829325 0.1683358659773648569 -1.5389710957117939127 -0.79271490336560190837 -0.67241045501429419495 -1.9332044349785759696 1.3017869284232645999 -1.3773285966551565007 3.2053057841482757162 2.6817294295022087169 0.58189732778697156323 -2.6498232394139682455 0.52688126265210022403 -1.9814063197175864062 2.2635568029768218246;-0.36955645857112573438 -0.3770184613581357147 -0.17961260910558790593 2.8433910884907471761 -0.30871542749426761354 -0.045302453757658706079 -0.14514424884510893077 1.7514549455718484428 0.024889245290663931237 -1.2529897812653234546 1.0328023166252453535 0.99005228447394866276 -0.69837724044959015313 0.62640532105887014591 0.13732542398886019019 1.0160093637557234825 -2.5745510603680301642 1.5622797029349426712 -0.028840156388653365171 2.5349187620080408934 -0.33719290962508763343 2.6906252006401758514 0.096268463926631117622 1.6012967142007490384 -0.33336182951083831449 -0.025862786468705070003 1.4625039450243486616 0.46740996481497232296 -2.1260562352627330185 -1.9589252844413516108;1.0515818734217439179 0.56884883446368017523 0.89942491564766824386 1.0531805134794993695 2.6142537386760884566 0.74330097578601983521 1.0947702177637574916 0.64008501962606334512 0.21716482368924447388 4.296620180747251716 -1.2919594727277214918 -0.91637374688935646638 -1.5369629748184852058 0.28333148047111067491 -0.15273534353101178573 1.7248378968012252344 -0.14204195260209104279 1.4009180069681159697 0.77598200795742211522 0.41997133025176591747 1.892405522253174599 -1.1899583705931338073 1.4982621132184108514 -2.9810792079794317111 -2.6539190361628937076 -0.5647593996967569252 2.7341657627277635711 -0.55163099482187671896 2.2603067488867272239 -2.1632412104102649586;-0.42225240632890470582 0.29521463223432392597 -0.083174378515161073722 -0.15360831430102267481 -0.16056741313275924021 0.062954801912758096005 0.17756407156495473965 -0.42299296758240101379 -0.00057423632588549349941 1.2706803414494753923 0.057644456255295822844 -0.33655220498250215666 0.030392373072839328624 -0.46101589744643195479 0.08532038044738859961 -0.95334954496187784834 1.8665997267817124872 1.0744737982926049202 0.011816185267444451884 -1.9636595662608176127 -0.15208861043969162941 -0.71320526240258275141 0.055281308084251287727 1.5750779510110595183 0.44460514167705988964 -0.099640066022271739365 1.9452858337852194648 0.04075342559352006927 0.95433024025844381821 -2.4475079548377034477;0.29682524920924774348 -0.33127640045736050922 0.0031719639605207786658 2.4461002080449580909 -0.54870736508042650126 -0.15093350005965797123 -0.087714284085499874544 1.3470392534485184921 0.0017912072293801359346 -1.6370943271920015416 1.1337327694086420937 1.6022288892631328938 -0.79946619753848535694 0.89785100295383957203 0.28234644137958370136 0.67373555939284046623 -3.5205957369734579565 1.3801977829093974304 -0.031083223433848467671 2.2769525527215255245 -0.13812280690800640692 3.1786768583617805994 0.089411237314481584182 1.6489030705089355866 -0.14221250943897190133 0.64469293911021896548 1.2765826729353391134 1.1001285092854016234 -2.1455754892619967045 -1.9580677440031077907];

% Layer 3
b3 = -1.0919490084319964929;
LW3_2 = [3.1303290171911264395 0.37603349565072125005 1.6521785539033908563 -1.3345305853212494629 0.24241981075074292562 1.5793736925155485995 -2.06292408603657762 1.6399528030212280338 2.9575763427438679365 1.7442230615610871958];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
