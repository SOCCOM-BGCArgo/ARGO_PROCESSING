function [Y,Xf,Af] = ESPER_talk_9_Atl_4(X,~,~)
%ESPER_TALK_9_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:48.
% 
% [Y] = ESPER_talk_9_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-0.2178;-143.241523403244;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0479365703301392;0.00458552991639557;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.2872652311068533;1.5942846933216337;-0.66378927346799688;-0.76367221223223702;0.55289392067436083;-1.5061850872581442;-0.40211409337199328;0.7965294604119838;-0.80072076526375691;2.671163852688148;2.8595474864909853;0.6769929384715343;-1.0929819406831818;-0.12891081680521868;3.2653506755118609;-0.13998111764912338;0.44366046164655032;-3.6139384088378947;2.5405277109325879;0.34438756884669752;-2.3957556426691387;-1.815306691376366;-2.1337821427272643;-0.73089326598811877;-1.536411428826489;0.3464614894087909;7.8048321260074482;1.7936104360394864;1.6017007901420237;0.55809532883955415];
IW1_1 = [1.3742400921819582 -0.34241723035458443 -0.96080044609683257 -1.5399959976451665 -2.4151153599518946 -0.30164698362633924 0.080916315007817874 0.48855313221146668;-2.2140236188220173 0.95558922584230055 -0.89211627010571581 -1.0262483140142127 0.24847036585780424 -3.2167287600345902 0.34934200575019425 -0.46403941230546442;-0.51904639738386071 0.71053769491317065 0.72558574678318732 0.62009882004751915 2.4286603738723906 0.46933625833733827 -1.3516876896740637 -0.23160186211190309;-2.2014109997914542 -0.81099594951211962 0.1863979925794654 1.3246885433924778 -4.588761670222703 -2.1495005308665549 1.1793288609320736 -0.72862041970163083;0.96639433040325073 -0.56076645683020443 0.16472657111156735 0.90512318580554407 -0.84771181938063689 1.6197364686962845 0.18109950124772117 1.1798099654387351;-0.93702280924910109 1.6718305763541197 0.80137030935036091 -0.98461400484840689 1.1851273355290868 1.9060902503301933 0.57061824704556485 1.5119957837456794;-1.5827525845739818 -0.27909655942501133 -0.068831297857959162 -0.27568314389288279 0.41154239240154206 0.89010287114676412 0.31048007145736423 -0.45946276274431286;1.3665904178658868 -1.3580442606688123 1.4440873962705167 -0.27400063417102594 -0.93488676828048034 -0.38033457510362434 -1.655621200236399 -1.3454890980770944;-0.040027829256911743 -0.052949610413524972 -0.38516283860083128 -0.16527602178714712 1.7782948443145157 -0.84243398220271515 0.39167509467005773 0.18871845581923363;-0.63788348977348797 0.47978702983564414 0.27141853306082342 -0.82083671655918522 -1.9054767304594946 -1.9404431732257252 -0.23022773158414639 1.7139730410233411;-1.201429312405127 -0.55040057679827969 -0.6695024636242054 -0.84818494307476811 -3.7276452953816954 -1.5361293132548741 -0.031819075460598818 0.02953350058732318;1.3884182272833472 -0.68338049150700475 1.4689470164501519 -1.3207112833246548 -0.19482915711174226 3.296136424360451 1.4134984876925825 -1.0608031153577708;-1.4164637261097854 -1.6233657606527718 -0.36872272253467703 -0.0066845406029354335 4.9553351461620938 1.3900644731679535 0.3821700901327959 -0.53568877529732262;0.24426120283429975 -1.2962167088698873 -0.3190766083890198 -0.45422579255297513 -2.9055511398878449 0.14374569271147603 0.34611352133665635 0.29624493852099121;0.12136262073471091 -0.33631380699090696 0.069658819264031474 -1.2283744123660636 -4.1709664449713921 -1.2206189169328918 0.14083129391580398 0.70955635329478772;0.22236450148635509 -0.36535956180527573 -0.23990549674506467 -0.26666245294880336 2.4017975290389377 -0.14385190078808988 -0.91662097818523258 0.90711211317787099;-2.7501673852078348 0.76111167811343405 -0.030705437882506501 0.57926320451244295 -2.7131403694421361 1.65511703733988 -2.6028541617838838 -0.89430703768512099;0.47869441777591037 0.16301049486235528 -2.3702282827652059 -0.09494673060456503 8.0803695674623413 0.7940746644107779 -1.9426564317337629 1.3750480215599425;-1.0314200050129307 0.10002871024617317 -0.78777753682912133 -0.05982657087934605 -3.7851959936113646 -0.28972392772481859 -0.015048463482644591 -0.2442895568765496;0.41672399401621446 0.0069607062195649735 0.46126029745679559 -0.25550226324877046 1.8929780872737367 0.84932699166860015 -1.8867630373298043 2.4135778096870029;-2.5004850343915077 -1.7310212997890289 -3.4477833430987119 -1.7253005901853153 3.3048407048567499 -1.1471026018766253 -2.0202661897074776 0.80135396325908848;-0.30427884474995798 -1.0048901327978181 0.16689377228796184 -0.38387934742249913 2.2022756405189927 0.25533333110215467 -0.61665529613792069 0.38663547655267549;0.68180112459704423 0.20882160647348066 -1.3749959612594744 -1.4333764208459927 4.6685754535099662 -1.3874586323905758 -1.5895169991047728 0.79713950136380107;1.4521619498063263 -0.53830367831383164 1.0346482484206891 0.29814483560662186 2.8934613896767436 -0.29811221669340521 -2.0892006025126353 1.8179300774202831;-0.73607007407173453 -0.13707073447302717 -0.43641531853550297 -0.24299283952475964 1.6048129021196225 0.12135049297730068 -0.49099873375653968 -0.18791661287221109;-0.58454497190335342 0.55982783038107742 -0.16809620997079508 -1.2524652053544603 1.3973535206588763 -0.79424626532612108 0.90033519149177499 0.0067861521912776449;-1.8921670277262221 1.3815911618057446 -2.9916689342354186 -0.25465462139286832 -14.903967613149057 -1.0057421864495233 -3.6881184634697788 2.6775820881518859;2.6479105905714033 -4.5107604750061858 2.5743217165817787 -0.060300842742295566 -1.4025002511862406 -2.4111698181923051 -2.1875279184139322 0.050795344209145277;-0.56035709569228165 1.686779464670672 -0.7295355761095369 -0.24505120165117147 1.6207669723471474 -0.3381978263546816 0.71278309144618657 1.5391608867789777;8.2163799603078473 -7.6276777372200986 2.3906270317186746 -3.9445840298566472 0.67489485471363719 -2.6635999541089301 0.68918297665981931 -4.41556089405083];

% Layer 2
b2 = [-0.39053196580831173;1.260875751984484;2.0336390386147851;1.4462342792494691;0.86191357034250404;-0.98836766157139078;-0.34725120919372038;3.5966128192689526;-1.4277446431383081;-2.9681430372372786];
LW2_1 = [-0.41763098802742904 -0.91659069317196717 -0.89532231817064056 -1.7975145240164243 -1.6202708952532285 -0.049590726424823366 0.4656745433798144 0.31480771149168429 -0.029756313414135295 0.33430752481620124 0.33667005199700478 -0.038487483086233343 -0.85633394171113697 -2.4664961012780995 1.5950174132080606 -3.0182259235696329 0.81136361093643983 0.4512580987847391 2.7392488957214867 1.3105563350265268 0.28792541682884115 0.10215329251839196 -0.99261097764738326 0.21024092924433246 -3.3511737510696515 -1.5493498715543106 -0.27464135227385339 0.34159524677372793 -0.94588710524070863 -0.31989075235625225;-2.4041493092218582 -0.92625706125299878 0.52607400568450624 -1.027707808605453 -0.55137180200419345 -1.9832890065759521 1.6247188245929376 -0.80323799008626984 0.79758242345647246 0.39715218466243524 -0.36449995096279703 -1.3223381776733714 0.33749426254726522 1.3758668749899186 -1.1413751585818841 2.3777946948873865 -0.64840540637313937 1.0766599996313952 3.016317635504973 0.81892641163246505 0.47671630081287875 -0.29962124949158275 -0.32991573049979284 0.48849457134737601 -5.0465632524832245 3.9355837992510176 -2.2356230592098019 0.94842003494585148 0.80921397791660199 -2.3608059065739671;1.5316804455357558 -0.10783518720341272 0.20938510578884897 -1.2676444805262592 0.96332925255188329 -0.19747771650314563 -4.4653577580161272 1.7779490802184303 -5.8226386236993717 0.67728264596914167 1.260896586046145 0.086551484288192912 0.33825022405907773 2.4189453260418161 0.11205898608220667 -2.0621724155055765 -0.19832354973994229 -0.38698453616394407 0.4017445482579371 -1.4995638528864972 0.4576872173934069 1.3221951017201488 -1.4637216401934272 -0.32238900970833889 0.76902994307123307 -0.96374226459495038 -1.1864865311046753 -1.2338931960330592 1.1474145687691151 0.11189415469888575;0.51727316782650823 -0.60307968861484984 0.16436756406029801 -0.39317928132527696 -0.63326231865666338 0.77635292583034066 1.5098471144833074 -2.4503333982744326 0.40180923243321692 -0.89329677052198564 -1.4238597438644909 1.3305596514633606 1.2402872794981907 0.060493389516105604 0.34371702609676463 -2.8537966662905356 -1.0428170624136952 -1.008175211948559 2.2510239736109079 -0.86323586272210895 -0.52936528581980324 -0.13680212851151735 1.9810310082286797 2.1561168752314681 1.2438268887665882 -0.45405958209328601 1.8446504908120649 0.82160192197850557 0.58171299470662408 2.0795453444611423;0.11682243127383243 -0.0010894430606266346 -0.029932717260457833 -0.41085021830766583 0.62646098057884891 -0.55892439624059542 0.17952953151980297 0.34382334597623965 -1.4388492260430534 0.11788607306137568 -0.33430226292166682 -0.21521222243833793 1.2690601187455839 0.27317812463395275 0.51961659089348211 0.95163512905826997 -0.26984682827970513 -0.62056155062923135 0.2828028438568117 0.021110622886833699 0.38749228204092723 -0.90894350535382773 -0.12349666386841913 -0.31757821981029866 -0.63614436824215703 0.49451808080906567 0.33210489030658913 0.42211874912917519 -0.93884899472355487 -0.35181154387764085;-2.2550311066006481 0.6321759105716982 1.6753798731441563 1.4129665779437006 0.85638586330921951 -0.42650488852294299 -1.2718359843783957 1.4388126863949602 3.3483670680635362 -0.48253414644191367 -2.7207715448461389 0.78016892235898949 0.48212636081141524 -1.7167665244714472 -1.954077811207082 -0.16819194287007186 1.5296218188659467 -0.40960465413575275 2.4311574215443947 -0.38419883860090992 0.53547496534955896 6.5638107322299879 1.0454756021176523 -0.93577505438485253 -5.0969865724993664 1.7266734504447738 1.9090791895903851 0.35328970828232531 1.2151264570198523 0.20210251667891968;0.37501210831444076 -1.733199571732533 -0.66485786980377337 0.7647101596405903 -2.3402562770753694 0.27027315892600701 -0.96461017284639361 2.5566160621730449 0.033725503249821168 1.2317225278821222 -0.34127681402961429 -0.29352963855307435 1.8655741687624465 0.17977722076494759 0.03642000818141497 -1.9920852288532134 -1.2568150532113265 2.8801129665950742 -0.99348920204273938 1.3106413713776279 -0.35987351729891925 0.26690941515654071 -0.038189300449305824 0.65110381244734572 5.5011160895697477 1.7488578786810176 -0.68950750042823949 0.70795743183591342 -0.8554275733373663 1.4258964961424514;0.044772881117333338 -0.43111714673286744 -1.2417815455951013 -1.1211915083448183 -1.9811264125186467 1.434231363914793 -0.045264183402440435 -0.63211921353105438 1.9364328859671214 0.034921719745477864 0.022676703175989979 -1.5548578336244763 0.49214445876575208 0.4288327012166197 0.057138209604015125 -0.34908378216084052 0.5403330917363538 -0.18386976838164679 -0.705923242415603 1.9094597442131287 -0.25243877410464849 -0.36466929134049592 -1.6366251708165704 1.0746875516098249 1.4483046972962066 0.31746775516091086 -2.5628588437311763 0.16292713502552772 0.032876512443304806 -3.390419547078579;0.38998068416666359 1.4093606112644024 1.2953630128204232 1.3116646737502675 0.70597699692270544 0.85804066255739708 -1.9229206652338944 4.6111986683869146 2.3040057038760144 -0.23040244544203864 0.62661593047458719 0.60871015722188881 -1.2361911589153312 4.622962233426839 -0.18359688872727181 -0.56257284920406325 0.20354997055156634 -1.2377098151079813 0.31725299635629794 0.71068791333348613 0.015945702378472836 0.076975374794407983 -1.403171361148968 0.38769249158140118 3.0435871257544038 0.88296420203611681 0.28549654482689313 -0.87862259796277997 0.31421926497048353 0.67185523204575048;0.24246368956718173 -1.2669779293592054 -0.8432146798444824 -0.84475590691996261 0.52549439683151522 -0.15243303125324387 -0.14128546898716604 -0.59037105912281318 -0.98551301311662665 -1.7015561910733774 -0.9089025951648817 -0.6292970379170747 -0.73752265863403921 0.13974636553432246 -0.89845041442002616 -0.15224691328039908 -0.72153945589501423 -0.330429922979039 0.51457264514028656 0.74199302465846029 0.39524039957290841 -0.15802430445450447 -1.2725959168758527 -0.45918439701383268 -0.11301598512807577 1.2196939672190064 -2.9223138272856173 1.0062747046207381 -0.48416255826319382 -0.47176809284158427];

% Layer 3
b3 = -0.030262760682298707;
LW3_2 = [-0.040106589314923669 1.1936382270671146 -0.015229311661693175 -0.018114421377920003 -0.85767669432711091 0.027311411246233458 0.032665730897790381 0.020242532458610372 -0.095068148330695157 0.007244870131347776];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
