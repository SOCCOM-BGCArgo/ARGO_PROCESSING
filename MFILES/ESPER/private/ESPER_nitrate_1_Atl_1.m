function [Y,Xf,Af] = ESPER_nitrate_1_Atl_1(X,~,~)
%ESPER_NITRATE_1_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:32.
% 
% [Y] = ESPER_nitrate_1_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.03;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.604229607250755;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.5579073498660984676;2.3019354310442223799;-1.0988517727444635508;2.0448313918496832109;2.0790966143366444996;1.9403599719519379896;1.401736361236683992;-2.6316374743111956569;0.84180853616618611657;0.92987918726006835168;-1.5375430727499164174;0.56984376154651061874;2.4822250799305662916;0.7422895191114374791;1.6487470148089158339;1.2020397590293185885;1.0792054004931648237;-0.072750073136823897868;-0.0537229873515297357;-0.11144847641824083551;-0.19704013459177618928;0.18525502170158378301;0.2217630871860952757;0.49151632954320062519;0.71533796253050629943;-0.78241214498603772753;-1.1790131264146166412;0.78297219416834573646;-1.0544226250147374913;-1.2473183970563959111;1.6691846512434724836;-1.138339657324735299;-1.5314394038197030046;-1.9632193276158591555;-2.3150090376236671652;1.7116745382698850264;1.2986393539160756561;-2.1293897275496047605;2.5511651094218339431;3.3758047047953447795];
IW1_1 = [-0.19674652644012796676 -0.60093274359565995724 0.392956749021758589 -0.8088471097814298183 -1.1566255304539108106 -0.035815218418143508761 0.97716941095906739712 -0.17479976251900386508 -1.5850586054888486931;-0.61841011859838357356 0.51954520824409711199 -1.4647496631924654675 0.59325327815495021433 2.5019785737706965456 1.5632464843831497259 -0.56800859967785999327 1.1052327072679088982 -0.89520316727958282321;0.84301636128879720022 -0.47577749822238624144 -0.88852028063292098903 -0.72572812376523021527 1.2699711440250565087 2.1498416813667580172 -1.2151234935015344796 -0.044532841970737369053 -0.31099173208036856586;-0.11036181492504508472 -0.76553905049718695697 -1.0471766808916997959 0.077558119876907805068 0.82461623696109020987 -1.4252025941675459109 0.30621108270531194329 0.23613725030697582663 -0.60472230544424043774;-0.46454123030707095143 -1.2675601504309454981 0.54132093391522972947 -0.79289066923058548753 0.76157988661187014934 0.36341571738966038652 -0.52883169760135650961 0.058483986446865435238 0.66204498282662216369;0.23485275109007880401 -0.58581532219181509102 -1.1053205899547517976 -0.53578887269187813747 -0.16923291735568599115 0.81160013138296571711 0.43427721382717665577 0.17907675255444474582 0.60016097691292236149;-1.3271540907068946069 0.80920030468469572593 -1.4937980856756463144 -0.37892640556047874068 0.62882730962712607425 -0.085127488855603145046 -1.6650558583039516414 0.076723633460986609411 0.81066364942159918616;0.15875122861419468934 -0.16073283909250443702 -0.21828577052504383182 -0.55740722769160555572 -0.28320842258164735661 0.18674520115383860808 -1.0288153410027611745 -1.9902799436162548208 -0.74718301710301793239;-0.31552697358328235522 -0.31747615668279238754 0.61549493767317109416 -0.16723217584769492494 -0.15450347152097235193 0.53367347302206591397 0.90009087327808678936 -1.2210229822558058554 -0.49606881324697510438;-0.60543043297185128448 0.72800295037162643386 -0.42532190391186741607 -1.1933029451532026766 0.25541371405679352824 -0.37805293394659117423 1.3912870978720115467 0.2043322196781316713 0.082634665174130525478;0.87427178448852094217 1.4912364937053783631 0.64015631989590160433 -0.66551754253396411265 -0.76246506200734276426 0.8951563075876163289 1.1926588842874039642 0.64673609040437485262 0.3262482326999060489;-0.090585789251526022126 0.21487101462612931413 -0.4702321308877168704 0.54929204713429846674 -1.7586701262995558803 -0.22153292837896645939 -0.067686000308653473945 1.1584910175198188664 -0.065057014257160664106;-0.098974141695510997607 -0.045414117658852656834 0.55283215158019360924 1.1987754967419061991 -2.4095779309569129722 0.28894018451926350988 -1.0302453175474139968 1.2599428197514550565 0.17709195033532876273;-1.0960516870425542901 0.58773628345173956067 -0.59667598096950502651 -1.205199782898174421 -0.94814300144763785649 -1.4121467172783817023 0.014753516654689458401 -1.2884925721912907637 -0.15099457815933775562;-1.138616411514768334 -0.63377767285647756967 0.48742679015321027647 0.35114091293493493451 0.2276291837298758669 0.22788834269975200009 0.16911672985201653407 0.98976774482652019049 0.55979652468601504012;-0.34171088412967215442 -0.30218522158215094242 0.40785893063708755779 -0.92700308064910008632 -4.6986900498007928562 0.091014902877240053125 -1.2949597639983945196 0.4921771886896262882 -0.23739159519699837286;-0.52430497798195918602 0.31068557659211465394 0.43640978395007617996 0.98707697931522841994 0.34577989104671863485 0.1872389920462631252 -0.088173015023643108723 0.27410835548571105269 0.0059714871553642953628;0.1511342651008849014 0.57707398767938644646 -1.2820184929451841072 0.60405772366543497576 -0.19392817469420217669 0.71008486669168580097 0.44386854490259869399 0.17674721426598602458 0.98582979526519920466;1.0816712869847591172 -0.17888516609327143048 -1.0428778116238355267 1.0837507903825538413 0.54752831531473999949 0.37118020368177090385 -0.35887146673010028586 1.8780810761700013067 0.15751992437578879458;0.51102833492981469821 -0.4663283790262129358 -0.21278449643267607905 -0.66133529414016123393 0.74560994592833385042 -1.8206576790371737928 -1.1935966326204605625 0.41080485229461960461 0.58007961137006847085;-0.0075854927481585707888 0.59455812537185981359 -0.78790989710913772459 -0.028756355293833295306 -1.2656612048035487117 -0.7273521160857545631 -1.1223356821400567451 -0.46294864830014381685 -0.7041021051649647422;-0.59746412534108794823 0.32470125927228637996 1.3017654072291133804 0.2899962238622019739 0.49550792723359254888 -0.46352696729369613493 -1.2936129298756124939 -1.8242487875389019614 1.0563906039751336241;0.60838556083980122047 2.112147902765070917 1.6777711264863526264 -0.66712493801422378947 -0.096317187521708161335 0.24267954746087724849 -0.71232340043544040142 -0.65613109586427409425 1.340284969971680118;-0.12838140578088264032 0.12116114260631029309 -0.19826591584889949327 -0.43455686271742799409 2.5171317765875436123 -0.95297767295368251972 0.70378412845052373825 2.5815793232819768122 0.99268480850226936685;0.2739075811557696305 0.60374691588785855956 -0.2673120810781869916 0.73852485539511802948 2.6124965751800299785 0.27919254613274679944 -0.86894039964674807397 -0.18165644460660884674 1.3674680774648908521;-0.35945393511934381481 0.044967420603884568353 0.5770335224742975111 0.22072248578956218945 -1.5509261566074230565 -1.5658760279386942926 1.0503607775769538968 -0.88449876337191268849 0.67569409277914949108;-0.46741086612082938245 0.44254321639872962191 1.2364075451857605703 0.13739455280922241442 2.069697271025850327 0.63216388443110749229 1.0826712225819810076 0.95994179544241098334 0.078780540985883412697;0.067215218986748259677 0.43344922358437515397 0.13939798172149978073 0.32842043589768427081 1.5615842627028240219 -1.1073956096752344269 0.046453769578676876173 -0.22514233193846444614 1.6716738625592095779;-0.65795962515167327744 -0.85912773373888995376 -0.20823726309180887184 -1.3918640475062820094 0.68114692503347262775 -0.9428515993264448003 0.34054135949108066406 -1.2373183348218437239 0.11244641305550440169;-0.69482741850818374729 -0.67346897179239029185 0.098270367290496124513 0.077118933120250920954 -0.221159688123952064 -1.8285176529476099283 -0.01341416744223346974 1.2221618009266319582 -0.3259155691285423595;0.039719698858407322117 0.48715940823505810009 -0.82918319695829634242 -1.011939688291494388 -1.8301349470175263257 1.3491745644561181638 -1.3536045363598960822 -0.45277385982517598384 -0.41581740858473675848;-1.0651020380050422176 0.2645060024838996604 1.4815282408115948432 1.2727478018448792341 0.35259794212301071026 -0.82990974973016085059 1.4521012735369269731 -0.35588215183445431888 0.49037569478321985095;-0.99904123818833623361 -0.14545730726473302119 1.3110267696109940694 0.35370865084925057209 -1.1044713310004883322 1.4114434530786843514 -1.0712983964531239689 -1.521402116124151549 0.34541307616238769995;-1.1345320388009820789 -0.80086477379918219466 0.71063282264040739111 -0.010388527947861566844 0.47026630086301635103 0.17653992721026517954 -0.67412519456517205896 -0.30423366017869934996 -0.94834737435546379025;-0.20876796032147468263 0.41139857089258485834 1.2868931468422006859 0.40504793717231385441 1.548907067373923141 0.43475846014580721288 -0.022945918434696514071 0.34954380777971105765 -0.99683297190438890922;0.51290664718253031751 0.0052617983971413335303 -0.84541249137540785963 -0.31038325462236926455 0.12768864750215469517 2.2259925054666829247 0.33271296133994798794 -0.66390572602737185637 0.36941363121604975372;0.85074013857911112702 0.18292513400591797756 0.098888394631838072435 -0.94510377189602912118 2.0230503355697844192 0.97097530688582833758 -0.14866499361214224884 0.01131781859858015625 0.73838461173160019335;-0.8807626347388524124 -1.0352211688779189291 0.91841158162934855014 1.2967641269380376645 0.64149138121249749123 -1.1996629561112677198 -0.56537345085606949269 0.53759589276422659054 0.49647448243121450329;0.95995522526296883647 0.13909065486890662133 0.81940225731499449768 0.22828320751931818755 -0.5451292453779851277 0.26692473287958073946 0.78496524879092310911 0.24712948049608349232 0.8780865738796537201;0.23334480751435598966 -1.5175101111605255877 -0.051584631011036538584 0.89004474154506041383 -2.1266085747160050623 -0.63148807530196859883 0.54297120552136124427 0.60554670140063648898 -0.33356492223404693442];

% Layer 2
b2 = -0.32861956592602531435;
LW2_1 = [1.1238025522835446424 0.56900588075978231206 -0.28448604162889784552 -0.4257333545969374522 -0.43561546839806247755 -0.61457822192903632796 0.19397416920474669366 -0.70928876455404010759 0.60357229252928346064 -0.19339640415085973535 -0.52456004057705118981 0.86592911194057609059 0.8589893219557478421 0.15225235190062663682 -0.41124369098760377161 -0.56958324637471446916 -1.5316357810065572842 0.0021303327348394657248 0.18666762090478383751 0.38412583877340744642 -0.56603444133753033629 0.19854461970923623082 -0.063306557016534203974 -0.36942237331242150367 0.96565033229899266409 0.49848428884350198809 0.54244715791400166527 0.5610663286028305663 -0.19319815651219440777 0.21930380049882797211 0.25634387133912694967 -0.22408704614405672295 0.305503471020778683 0.17934933756109971981 -0.66393002911407761335 0.41304947482537995862 0.94075518306787231371 -0.093507436462068410643 -0.66934615091042148904 -0.50879333344662347471];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
