function [Y,Xf,Af] = ESPER_TA_15_Atl_4(X,~,~)
%ESPER_TA_15_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:05.
% 
% [Y] = ESPER_TA_15_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-143.241523403244];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.00458552991639557];
x1_step1.ymin = -1;

% Layer 1
b1 = [-8.1436973109601176191;15.666592212891625735;-17.408917289891043367;-5.2923705743055275974;12.894298128159995542;-2.0365014290074698877;-14.986924569107420879;7.8682675595882596298;6.1117300659056512657;11.07371536142653845;-2.100471457063799896;-43.031904227769615545;-12.92762027762116972;15.194511102242959311;-12.752216125997181351;11.507508912170056448;7.4407437195320547119;-4.7156861368964584358;-65.028186912966887689;0.34232806263180010076;-1.1678956755684708479;18.198605642109431102;0.63390747548193249195;-4.0581602572801527273;5.9030625624570509657;-3.5762620140240519717;-4.2604620613054455802;0.5980842395099353892;3.3677165820330743351;7.8675092989667732013];
IW1_1 = [9.8930443066076030334 -6.4812877753242741363 0.68106869758683186156 -0.33428769893214999032 0.18209835713195154927 -0.62492662991996628108;-40.38545217542564103 -0.077735505124667994559 -17.39307357815920696 -23.895992583187506852 52.758360885961010922 -37.200789127845823145;12.505131517012983977 14.197347680750855403 -0.31288464912941660323 -1.7874764580671802516 25.583199550978996228 2.2312960909383390273;3.3281835153348424683 0.57179629745525506479 1.6094002017269957161 2.7825921368476516093 8.5996873096327615116 -2.7794167731956438416;5.9282575651905418113 7.2062308656148674757 -2.6357553153052357686 3.6887711645862650833 -10.407558490908957793 -9.1555712764447907404;11.546327319010281087 -10.82124470880278011 -2.5022404067352996826 -2.7136055354708839005 -17.736146735567739796 0.76060293316722449308;2.1882513047687686125 -3.7401436894059316707 6.5669720402236020362 -2.9524805452293620966 18.591398243617156538 -2.1938699528895613255;-9.1487387561677842029 -2.6231092704095764212 5.8721064391907713542 1.4658233570412728675 -28.798688469154321012 -3.7373933846169693496;2.241684425464532282 -2.2667469276654079735 1.1887971652328899186 1.6002702502651182659 -8.6281463802874931446 2.210571104031585854;7.323725085837045512 -0.22304997938459261708 3.9739172534734072961 9.2520697555516733246 -25.634447179001579542 -19.960564812191787354;-3.1897379731929129676 -1.3314370948640703585 -3.1152998353196150738 -4.9032227666695735735 -5.205539204525526209 -2.4198528394605540726;9.7593852482301155504 -21.118676331751803588 -1.7421597383682885241 7.2075225336081780725 29.00496334757935557 -5.3536780500589911114;3.806472320546571364 0.6901700182446595111 -1.1144709367065199768 -9.8997914671954525545 21.740706584541502622 -3.9447583289025009989;-0.29090781175248742185 -5.7921000927686350224 5.0411279312143300047 1.0906713573129371841 -26.978744266107892003 5.6715978711883794361;6.3577256531203927281 -7.1642161627906837396 5.9095784251340992554 -1.7339873845620357162 20.675194067259578645 8.5918241994706132658;11.936719016414182093 -19.863063571598097212 -5.0357613832135834642 2.4101117509635798797 -57.895197865666538917 1.0316951460462775447;1.9583479225015099079 11.841417769443379981 -7.8543672646621303102 -2.7754784403751533439 2.4745579210036008355 7.0842169456288761609;-7.4070249019777216759 4.9171740460764263858 1.1021333548424929738 -0.42220059265187570574 17.284712857522045226 -1.3343535594775737252;-6.7140231001467221006 -13.758267317362541604 -1.3695502475859659963 5.3608811203157049619 90.133427881878773746 18.974632194178656874;2.2196563894953329488 3.0551445120378493137 8.3292859811355057786 4.3720952508257084901 5.8362912700289788503 -0.77819310152665999158;0.86666083056580944799 -3.8240628846372506366 -4.6367017630253393179 0.81998432121115594207 2.9154637367236482248 -8.4492836049104109719;10.030946737688219983 1.5516417137375539959 1.2828700698889345944 2.7611883259405693991 -24.482607760884881998 -5.0250267981361353975;0.018180175115445961626 0.09666856655128831799 0.11330292754648070563 0.58006340275414247643 -2.8555378485452340698 -0.27485592031354344478;0.26443265517669123366 0.19472495252448204783 -0.11811787875211109122 0.91412877622171240244 5.6673690409558892256 0.63775124423203444213;13.880459399002850418 -3.1528209621416767305 -6.8381643561262928088 -1.8287851268494608181 -24.422461226983141813 -4.6236896721192586313;1.1563494048911060474 -4.5283007837170687893 0.14969162115017262127 -0.17307826299319542529 -3.4618923072028060517 -0.77613020246035524519;-0.62545149783873787985 -2.379355531262142609 1.2036616282260725885 -0.13968314236164208753 5.7600246380591668682 0.22196377601331332419;0.74825233916783473465 -0.29823290937432511694 -1.6019665933257640766 -1.5101081229880153334 -3.2309632356276072329 -2.8568884836348407141;-4.2184752155686195962 7.137028038154785925 -3.6787096920700648184 -2.5338037101621311287 -4.7107375824013590915 -1.694921367215729946;4.6488937249623996095 4.1436296421627156761 -0.28926562973258979072 -1.5872894034592068824 -7.8151448978360029685 -7.1021228587753908457];

% Layer 2
b2 = [-2.6325466675950335294;170.16633711416548635;24.755849602088005668;32.189575732244151141;8.3902969056350311661;82.884032478788057574;-5.0414046293406986621;-7.6089188907821894148;0.88753042309992735692;27.543110080038498921];
LW2_1 = [-1.4128612171901824279 -6.0897205995453349558 -29.59594508158337689 -8.8856698018194073541 -21.304713205612578975 5.4328328169652468915 24.884885656206360949 36.538498406310864652 -14.955024585550861005 25.251315059469789048 3.2384390495955486244 45.823640753053091146 22.497033217049615672 -18.414373625084149211 -31.536745577167977217 -8.7448001152904950573 -6.9216563668443482626 -28.398090166280251623 -21.566177325145186927 -20.957830123163585512 -15.2139536875148913 -21.575426199388836324 -3.270703660252233913 -13.589882892918414115 36.55335088527868237 -21.896506886338205078 -9.1874784613607953787 11.963431496566785839 -4.3289859192246176178 -40.568470083988067643;-72.579231368261247326 -153.04598285191724472 -0.82202798322622827598 6.8133852093458910915 -10.295248088264932207 -45.71462457352061648 13.299656372881552002 163.70084568564968208 15.241924685393206218 -6.4090847259059389174 8.2069279386079134753 33.142710890636955412 85.974846965837755874 3.33922613594707407 -120.83824785580422656 -33.717574560691744523 50.197994264464405489 -136.28484323249634258 55.864583328059879364 -8.971668955530397227 -16.168584364201258552 75.68518851061371322 63.132357701085339841 40.509765604358896951 27.882861468204165334 21.020899157498849519 -16.091783419802791144 17.632368995395957256 -8.288816606993867353 2.6196603831327496259;-8.010861170669302922 -7.8976915603522623854 -1.6940243187787404899 0.20073236651363490779 -1.9583866493652790641 5.3950530794110100885 2.6108120365080687009 2.5089676150942912258 -5.9948681458472341532 1.7264879942581934369 2.3395177090753205285 -7.1529801361836167217 -27.933112699518257926 -7.887190170574130299 11.295075677644668133 1.4816283887908232586 2.0025524226228879066 -10.121706425505434979 2.4675474642489700905 0.59538708101226101022 -1.7629193128455911133 -0.78629382156824589867 5.4314940619689462409 -4.2777942153264705283 -5.6213264419243769154 21.541783055106602518 2.2834762256505394262 -8.7635331187315088641 -8.4177226227676609227 1.0995972228362920209;44.51609753125710256 29.640458820618743374 15.94883117752957169 -38.273364230114992779 68.393683627084939758 -9.0463590346762750016 -24.115466590034547067 158.08684848763937225 43.327846891462399981 31.598668518881225964 -5.1671487317926185767 98.069203009652156311 -75.485345269464374951 40.440062178184767561 83.492253279429789359 41.201576967957940667 22.359715800677253839 48.069807431747328508 -48.485070168519811773 -97.946516548678374647 -16.935792673416393939 -83.511843768095573637 19.857376004398762603 -89.624926163059427608 46.015001163823100683 3.2177572916930241576 -38.986378066089052652 -23.578980585353232158 -144.24947243510422368 46.811805645982197177;-7.4942804377635958701 21.56410848780988232 53.043867584303029616 -2.4228615619206901322 2.4670545586328533894 0.80560466715669021287 -4.8876317321903597346 11.713162998071943832 -13.908074435876471853 0.25096296936680806411 -14.905947105556967003 -7.9179250384405399643 53.983229808406512973 -1.8834240399662651733 -4.1845378899702430076 -9.7754146029108373028 -3.6950378064749189733 -9.5394243061842391995 -1.6374418641694434839 2.8211920157536298781 -1.5339311445205918716 4.9111764738923753271 21.328210840658545777 -7.4933737801116198085 -4.7467495282292038183 7.8576330803741569753 14.092739492001118862 -11.459779681677959573 26.994325858646028848 1.2904251658593894891;-0.20130664216365640184 18.736810182492725119 1.4203052160920133229 -13.700495784321057968 1.2414322400400281676 13.030689862285933955 3.1072351299166531824 14.61384265342777411 19.562463314965800265 -3.3815941247954741655 -8.7297859337373253652 -11.854522699303112532 -56.443446779055157947 5.5645277965411867882 9.9759320630219860959 6.7932036764210588231 6.8808026489058722319 4.9949358219697170824 -0.2361446721353724354 -1.2623853550338786089 -6.3973112140639418755 -2.1491846807771435302 23.160336181323408766 29.902070526843782972 0.39321410937480238967 45.959178658596762546 -6.3558116846280823253 29.20421582992933196 -4.2236619751435675596 -15.867365250252632336;54.655695844651866366 -0.038001150914470961661 15.483244745039364432 -7.2862575006642211761 6.8974129334188658547 -17.896830705897922797 -15.512770408953356238 39.293958794417719105 23.434497020436637627 2.9633700039731700748 6.2501989282458323416 3.8920382382149938394 6.5107774971679877041 1.2853703484377760891 6.1712480471119652847 26.15024692738133183 15.345295579986981238 8.1932428156615646486 -18.20906731118218147 20.701263971404408437 -4.0240496197822430702 7.4355471242107658014 7.7981698900026481525 0.84658610070591433505 -12.304506721523555512 37.415273526843940033 11.359927392311472971 5.4878965548306704036 26.073972701567004862 1.3378330370749726974;1.131543032875656607 8.351205458218471378 0.70636244934369107895 -0.76026308668330322416 0.19372550771303287398 -1.2081354456062216585 -0.11580148788769269175 -0.17001564810220698432 -1.5095609405010492754 -0.11954714270381328056 -1.8205897001446624817 -0.073997301985783137113 -1.1656682880621915821 2.3467206732816037196 -2.0982420661107790139 0.32911215654202197189 -1.0445441394005914315 -0.50540629885122856368 0.1290302964189306012 0.52653033722784348125 0.57739542500326612728 0.31172624408974813903 -1.9665016189361854693 -0.73946902695706828723 -0.64073219410542725516 1.5505486277373576876 -1.5438443328521112008 0.1409730577693632525 1.6352112436791839123 -0.58772956679787191625;-0.008444953074315168437 -0.0083098417847866749841 -0.00072256208588961155607 0.0020340855509996618421 -0.0020774670159112063224 0.0085055295762195941289 -0.0015681844467559946394 0.0037385380572857915792 0.019517892566027501139 0.0026362939149139259266 0.0028607998169994024 0.0018321003971878344063 0.0035459904772589985467 -3.6111158858410347225e-05 0.0019575221635117169214 -0.0036427486998833894308 -3.4253716915669074714e-06 -0.0077172978174576203902 5.3079182946491748076e-05 -0.0057999819635400099924 -0.0076172359259401205625 -0.0016386242530073587536 0.26611759737145795901 -0.080794314959528074072 0.005115332994036580691 0.046038400512742466697 -0.011224130865713116342 -0.010926502649623991148 0.0026286021634265833123 0.0024062814755915458778;-20.277427480911409674 -9.2597363929262730409 6.9784064819066475849 -32.499184188138407592 -9.8448953605742914874 26.53873232366201762 -39.890794901984364174 -87.085389149178766388 70.881389105906350778 41.415369409300083703 -26.084904974342855155 -51.157790853470537229 -171.88832611956956953 16.575685935285509487 63.226030171868089269 -24.651129952953045432 8.23952990294002241 53.603695050052152737 -39.388318725113187213 71.899497995377728898 -8.0098457258614619292 -9.4668095617047978152 39.653331780509617488 -53.137723944843799018 -30.598383574243371186 6.2417863037474869969 -8.2786346833990851479 54.993379811804331325 49.241645077932915342 37.352231544816120845];

% Layer 3
b3 = 1.7554494356790535381;
LW3_2 = [-0.002225872217814647662 0.0023484799374994085042 -0.0006120230566959834707 0.0010654828388500666402 -0.00024759863852080580583 -0.00086823002834350300038 -0.0070192735930410688622 -0.01624538407062026818 -2.3709468765115331301 -0.00095615032122330090043];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
