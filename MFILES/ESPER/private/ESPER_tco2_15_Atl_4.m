function [Y,Xf,Af] = ESPER_tco2_15_Atl_4(X,~,~)
%ESPER_TCO2_15_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:04:00.
% 
% [Y] = ESPER_tco2_15_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.2550234970143497;3.1113543047418477;-1.3953054138071928;-2.0232403320696184;1.1414874071733419;1.3743854441332695;0.68093035002309532;-0.89219761397932118;1.2055606482879349;-1.6912099689638234;0.1661285204557498;0.47618341058938013;-0.097604056601456601;1.0680145972608353;-0.27731257916532948;-1.1650023221781263;0.81878898230237096;0.17993310809622992;-0.43468145913987977;0.68388898928640274;-1.0224309320831764;-0.71404325886040099;-1.8416203784656988;-0.70930479350076059;-1.8525549813978253;2.3069958421063284;-2.704829882112592;-1.7471984328526597;-2.4390160129092009;2.3921783581310248];
IW1_1 = [-0.045095905668708393 1.9680922712340303 1.9416074519038093 -0.72382026691861334 -2.6233244461596485 0.14420693130924361;-1.5838102820541677 1.2730003039685009 -2.2769706495009507 0.71039433085956061 1.2651254002980059 1.953722925942023;0.73658902852856545 -0.43707365033171452 -1.0893583742763049 0.13922324634480474 -1.8630310543686732 -0.75440023436457759;1.6758212937356727 -0.09829863488360048 1.3707641621220517 0.83925969379112131 -1.4340186767325769 -0.4372706833579868;-1.1705621644054525 1.9767465396788158 0.34813158981243486 -0.12661667448272368 -0.6509842858453827 -0.23905325562439284;-1.5688139158816932 -0.25928544046247237 -0.92421917852677438 -0.23410289183975139 0.82545905559578903 -1.3726662414540503;-0.75979081069523735 -1.2992471762094375 -0.30878854082595919 -0.26835990111686547 1.0938853989384869 1.3506639878183162;2.0494320282321419 -0.12346566373173148 -0.033579523630117299 1.1821729457376158 0.13865904214601277 -0.69172547109271854;-1.0850710831255668 2.3639047543660947 0.78382079697432705 1.336781019017256 -1.4068947802906924 0.14375650890386671;1.5648332875579518 1.1164469012109899 1.7593015908893439 -0.27288672534850905 0.38219413170758459 0.42678168768058328;-1.5660035325718669 -1.0271260917956311 1.9446203459097933 -0.49160835401984004 0.44901487204044455 0.23841392494632135;-1.6627845742438532 -0.46040953002651214 0.3135206245404108 -0.82519974081900782 -0.37960021324429022 0.053025175507804584;0.36971100901705345 1.0259830861119441 -1.2820600660648274 0.84186769777725234 0.99126472724565307 1.2918275099277314;-0.74221136429826262 -0.400694237710148 1.7359558168418712 0.28502144555760844 -1.4823215744702116 0.33407979208358074;1.3753132744566066 0.71848228273748005 -2.1170165030800456 0.37552352546979156 2.8988105500608645 -0.52876503629876215;-0.60031259524208347 -0.42755884318454312 -1.2604003979750344 -2.2665226556712597 -0.83475022532745757 -0.54151993389031627;0.53166301108646585 -0.12083854377974018 -1.7036582912931082 -0.79076428209753069 -1.7309951158677486 -1.0343774112643609;-0.068851270235833276 0.39028998760665384 -0.44070928192514691 0.76849898927434646 -0.51431764045479378 -2.7072484890767647;-1.6247398977716931 0.038659435628901992 0.29796325821930703 -1.7948145760613934 0.46405123279934685 -0.3000362395847409;0.62176091408651124 -0.49161156014537283 -2.1606876558834647 -1.0793526073975599 0.31432433371259394 1.423496344401936;-0.25898276063150288 1.9343741413458981 1.0606458522199453 -0.63012002149003032 -1.0580888993459496 0.72924978944042473;-0.74730887223344489 -0.21248321539001599 1.1370427593939043 0.29969855847888899 2.5050546025016045 2.3821507690143289;-1.6491017974194055 2.3865820716405972 1.0637757641998875 -0.21467444962234677 2.7231939642991128 0.14256469102640418;-1.628166299822347 -1.5853339777007078 0.65673298661284274 0.17281283978692655 -2.5122040691799277 -1.2033316954505822;-0.82975368368992808 0.38650282093690275 1.3313526796407824 1.0866014642919908 -1.8495338257921374 -0.087752826561190461;-0.0097664025968993914 1.0658652923417649 -0.88946385351727819 -0.13618998755664025 1.3551833719459887 2.8332417032421389;-0.81786110216535968 -0.57987181220325068 -1.4132671034874116 -2.1428084033081358 1.6867140048243183 -1.1509877399807085;-1.7120924140801554 -1.7176661054091651 -2.4401769276500271 -0.44550655695678804 -0.3355505131377341 0.51062514358331279;-0.77094273026264859 1.6246373017513254 -1.0434175876338201 0.14701613874322964 1.2382301396817237 0.76196895870624526;0.721447669013351 0.87413191534650436 -1.7528678340463562 -0.0062862962577083957 -0.75705758831511283 -1.6797056849640242];

% Layer 2
b2 = [-1.7238473042196214;-0.87953310614241387;1.0792949648686441;-0.4133916267484754;0.23322719158040067;0.50848802234974944;0.96280830216346136;-0.45592644550752509;-0.98463191587725529;-1.2788015050099819];
LW2_1 = [1.0526604316797907 0.78476303224956578 0.52066873500797317 0.65159437538295206 -1.3647795258966406 -0.8305979441931044 0.56169628316827536 0.051139966946266574 1.6299834089523719 1.4361967168363932 -0.51356798310484153 0.73607489378395041 -1.320784033467117 0.55999391931285669 0.24631108555233 1.6739856845117647 1.4861062760497643 -0.16807646977169344 -0.18832761858236247 0.81667350643889214 0.046676774248656572 -0.082324621176831175 0.81438585110737804 0.015281074301307224 0.9246074147157648 0.65887451993034785 1.3865747095283081 -0.3666851609619633 0.29183073943652138 -0.078852028551336342;0.18067309094759085 1.2957434188483892 -0.22898051767149627 -0.11122443920632157 -0.24507780600786327 0.043397481568326776 -0.52318694345247019 -0.52417824567982274 -0.15845384192796308 0.13810118778256403 0.1341133130439964 -0.49313836503519193 -0.42267409159426583 -0.10275730471206304 -0.013345288352190416 -0.061895368561662563 0.28821337023337168 0.32603369234225293 0.10858958909475201 0.28011822611438164 -0.59682844442208816 -0.9142386386498399 0.16110610848207593 0.34993465220817693 -0.013257887605559975 0.50060597784467553 0.11655298279982386 0.00042075100375547892 -0.21191900675193112 0.1354170838967603;-0.76767265041559374 -0.37470783084643622 -0.76221370526046273 0.51299996805774295 -1.0542836690532442 -0.091070582831219771 0.46734148374805884 0.43895348153093833 0.18817457650818631 0.50158875628672128 0.17935360197473507 0.44914389911289254 -0.28841847656846337 -1.2407845644591176 -0.15501886440130963 0.021109495666994858 -0.67936263666030494 0.13412471502801027 -0.090036532894722313 0.13590138900949769 0.54951355544237857 -0.026836469065925621 1.2149760155343508 -0.40364497571530322 0.013321800922434431 -0.79537311237071717 0.095560846363390212 -0.18196219418575488 0.019671294354594679 -0.38760742836041284;0.84086673897781206 0.48637835618868558 0.27275049780970506 -0.46064510285591209 0.25544029593288703 -0.25352372034875281 0.15732862675549986 -0.69885541985558886 -0.50090723770796963 -1.0743953372865063 -0.52595392145193132 0.48906463230612351 0.0024157470106913903 0.91775266988290316 -0.92643904545966416 0.81366974678857673 0.71554961015840013 0.65349501498294571 -0.10208674055274312 0.11346675759629246 -0.22788312452043114 -1.2181765018409638 0.38011964412076443 0.96046982739882736 0.26388066912831515 -0.087789183525801506 -0.26022480118268049 0.27236894819525864 -0.22418112261131998 1.0797293786055844;0.60657179124360094 0.13367901978684965 -0.34572404945449048 0.17087608153005604 0.012620333846051655 0.22417127793483466 -0.93333821242039838 0.018176220340397543 0.16529063998293175 -0.32280026733170097 0.076485554088997793 0.26836184063059043 -0.73006929624840411 -0.39297337907736773 -0.38420102959441021 0.23036710091787541 0.64859556380389183 0.53709678414632711 0.090594646094759868 -1.0203895409269237 -0.060944075794329255 -0.093625038709978417 0.39863354126487238 -0.55335783473196942 -0.45097416431158249 0.041545073558469515 0.075369038544487274 -0.023199018221264901 -0.097317171279710318 0.38497728330088854;-0.11917265874641897 -0.65667880711779647 -0.47474614496702833 0.5058743360642074 -0.012052050889071474 0.034149597882311963 0.24270353748285398 0.17631534587979969 0.17376388294118827 0.16746809148075364 -0.31618832193797453 0.639742485042474 -0.12627473281040813 -0.073811200653034287 -0.15791256219168684 -0.19848217418926301 -0.4835014105828595 -0.4304550621196605 -0.39026382686842431 -0.067447146743894543 0.71781128082697465 -0.3814663507000805 -0.12437071271333489 -0.45967348221983106 0.70291513224819147 0.028374803350784076 0.23001066472695264 -0.085884230517769972 -0.17343763558187636 0.18055903869299147;-0.85268009331785166 -0.59708765008692288 -0.49997308215692643 -0.2239807316185573 -0.087042348234689176 -0.62967986957635746 -0.56331518937747382 0.012098632279149122 -0.34169603507504631 0.71947640224298048 -0.30746864737797464 0.44213159042946043 0.14889926010937857 0.28517644567561656 0.33091174284213948 -0.033729076835739627 -0.18423602528847091 -0.0088498650460593509 -0.072473288075614165 -0.11183361043546303 0.36880436372049147 0.1209932829098463 0.93545377803140994 0.39614600346650775 0.11030228913438861 0.47956615623243609 0.53554488456604799 -0.13229153211578493 -1.003714670327305 0.12316579753655099;-1.2035864844431086 -0.087885522873430696 -0.48723513167483934 -0.025237729205012122 -0.14952823222875294 0.21353754286120394 1.7277099649277119 0.17502297259258712 0.0085505250343428443 1.3195711704705861 -0.092979272181511335 -0.44642448677662261 -0.05982138428297621 -0.13825660467284603 0.23715040278806643 0.64585840918023352 0.019885751205796734 0.70760707249233346 0.63962864748973636 -0.03224240648635756 0.53444508856844053 0.60439515499380558 0.42831221334647579 0.75483133177847794 -1.0480705742289305 -0.22310249491092202 -0.40107131431945131 -0.064370459878991024 0.16972716017366304 -0.32066440824821985;0.59154637772657259 0.1088317719119592 -0.34760036984066472 -0.8725197906938793 -0.40275748259534355 -0.56306590264139056 -1.0848787680241254 -0.087442913164185995 0.021193301822695378 -0.96893983286297625 0.15586943105695841 0.21925614799937743 -0.22986606335459905 -1.045349719647485 0.36909247016604313 0.10984690136984665 -1.0606958206296004 -0.37947022453096974 -0.10033478064490529 0.26761381580794735 -0.84591483753492636 0.47608892206948378 -0.14064399407455569 0.68732385697601417 -0.052057614969000313 -1.1550700360800135 -0.18074265636999165 -0.072091115730603131 -0.80044228985861721 -0.29388539089397636;-0.15082191238527068 0.00086474904129247394 -0.30473289829270706 0.20705533096311576 -0.24462702643438142 -0.31655962900522899 0.0072357820957196662 -0.0308049189410309 -0.23585232724047456 -0.4422108108016875 0.29058814543993483 -0.0030040508837701953 0.25823307102046744 -0.46060387065164377 0.33856054897412635 -0.75459488289740584 -0.2759710417704847 0.1900680256252274 -0.21579591823682817 -0.16973411222787593 -0.28207928289537854 -0.3371120152898206 1.007805834049099 -0.98541782620533025 0.14306576920645647 0.331085991696357 0.86113455675900052 -0.061466872970001696 -0.37583997367061522 -0.48463831277070651];

% Layer 3
b3 = -0.59916353947208689;
LW3_2 = [-0.85776173526611921 -0.50252155721050096 0.76598731228087713 -0.033322758689594549 -0.15648137491011627 -1.480762998391103 0.41851467875960757 -0.63406773138386952 -0.47816019698627327 -0.69085801967237004];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
