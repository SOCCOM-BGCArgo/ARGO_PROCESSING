function [Y,Xf,Af] = ESPER_phosphate_3_Atl_1(X,~,~)
%ESPER_PHOSPHATE_3_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:27.
% 
% [Y] = ESPER_phosphate_3_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.7665587438749454918;-0.2198125773918724879;-0.39877255510641534952;-5.6599970908447483353;-0.58545198570832024387;3.4343512848833266382;0.95235914233060914302;0.87972289580971685385;0.98435575654172857707;-2.3213765079532961977;1.0847010782998842693;1.4152171522815946147;-0.76319940561135790613;0.60811609242115494123;0.39642469485323855727;1.0154183519150832282;0.80546621899976733605;1.1597977859668711087;-2.6675542436406813884;-1.8496567722788705979;0.62696813144888230429;-4.4460843576648043651;3.5124530612783617656;0.56421155403897238489;-1.3438697910891890253;0.092083512749484661142;-1.7288919568199505594;4.4490233303641106843;-2.8165833111719558168;2.0805036577821129917;-1.148833242847632885;-1.9084782821991441715;1.2732205492150290294;-2.2000718729787109851;0.97527562623173869039;-1.6580065049018994916;1.3270643194493494388;3.3031183922555897858;4.7041861256929768942;-4.2532171695095346564];
IW1_1 = [-1.4943433754781367817 0.79143012609717178218 1.3374513768339029163 1.9544594612434422753 4.6267530138921753036 0.24604283780284771921 -2.0305410655605466985 2.6080651482451377987;-0.45956624031946213815 -0.082692203570249880884 0.30972387836896841939 0.34057430429135232552 -1.5921288281692325128 -1.7216499041923480906 -1.2952234414688779118 -2.2372891942468537962;0.033783244362379262482 -0.2765244702291919654 -0.75256494619047287209 -0.40547738512605319139 -1.1787007411400174384 0.3127284809216089867 -0.71105849026129719359 0.2414720885728444677;0.23751963203376749711 0.17451475983911318712 1.3541697550906564018 0.48048484005881297865 4.1186000883958788776 -3.4161872417053449347 -2.4974411546508110682 1.5669103554092458364;0.462827448595232116 -0.67945754893749799042 0.16240653578960992376 -0.45437810029426783931 -1.1512541027892533307 -0.83512594591786737386 0.3730426363725769523 -1.6749781171310305083;-0.25504332111750671608 -0.10053254766328613423 -0.50082271707739267619 1.1316206680493343661 -5.2352380544092778081 -1.273108688020677226 -0.3768753231128578185 0.051012648456808737385;0.55986002630508024946 -2.4072532608780887742 2.0372053207681175557 0.3344955494292906617 -0.8052780690349081727 -2.7508135892024423441 2.0457397017101262016 1.3509245120572499488;-0.20907894331446033598 -0.44161716290697305975 1.4466114416812283494 -0.89062180090503917373 -4.6277268066096679533 -2.0089724712389713801 0.78649543089596085643 -0.61499290637340597865;-1.0708512632385183139 -0.7178392026727041797 2.9821415934705202133 2.0829744108932324309 -1.5811460085394151154 3.7110315253659096335 2.0982460591125553506 -2.2596071772643302467;-0.4689708910304225542 2.0719103685570514628 -1.7473943998675645073 -0.34259193298403772809 2.2286703043545808001 2.1539607469440591458 -1.8895197727842407698 -1.5821159249249263645;0.73016152904722919637 -0.48716302991156601454 0.3493201232942005352 -1.371368883659118687 -0.53141618715450777977 2.6516977329663049545 -2.028143026003733862 -1.0186218201147398954;-0.36760578702536034212 0.44560420259824107259 -1.3112860516976061476 -0.82501558776105510251 -2.4135281021174956884 0.66534487213185422583 1.0274926900921121931 0.33752191122466357331;1.9515523686880609233 0.35173284417130984414 2.325444217787984158 -0.63695936930326102487 0.0014888069588020278605 2.1139042026128209706 0.99112388040169407954 0.56334844495472358172;-0.71630937176727893512 0.27053326480183587099 0.17749717580552387686 -0.77086059271182150177 0.66402235393910025163 -0.57690191724034356469 0.58568873087143524803 1.2125979254039822575;-0.4550857788085231892 0.078670325480615560521 0.43692007467563220846 0.29585844456624837973 -1.9784660445552613162 -0.29403621243333771806 0.0027853535852263985526 -1.3010751388923578187;0.17319482025229412936 -0.2560430482618233361 1.1713231507335200021 0.23764527777251026608 -2.5833806536484194005 -0.22522024724668424089 -0.85988466505932725781 0.4778557303851657112;0.62766282210756407789 -0.018665577079904276808 -0.34033964743009842424 1.0235177914292272749 -1.8782550837805263022 1.1115625095177901205 -0.65738662326697905325 -1.1273747996055154541;1.0042933258889650272 -1.1934947711535301984 -0.91785445921530339763 -2.3595529211715948747 -10.336963566372364909 -0.14171978913208288509 -1.3940100579264922409 -2.7098289977916820703;-3.985355800465023357 -0.18401652554734496126 -3.3760941759983849053 -2.0760411399703859736 -2.5970531624620236677 -0.74000188168378988607 -1.9191992909992219296 1.379934500339836223;-0.34170684992518618461 1.3074676680438079845 -0.36319359278226076571 0.46484738924830848461 4.4191163974545180082 0.63057860757560080245 -0.060434907619320514527 -0.25639272520287725854;-1.7995416458313469033 -0.37526363181216348952 -2.4368087200391994607 0.57205305327303201945 -0.091336172600311543723 -2.2003197347836827014 -1.2383794964377661252 -0.64654396601498176356;1.6049189905366458841 2.0171358442754057094 -0.29241833248851556437 0.3094729441412547577 4.7107692233888105449 -0.33441272698827845256 -4.0832615722165082062 1.4544930631991113135;0.319415213490004124 -0.13142541541833505092 0.29299862532079340438 -0.63712126397100787845 -4.0708084269435076408 2.1514138881537880899 -0.27619049015508811973 -0.94805787273021380201;0.24526986417371027249 -0.37415552017226044734 0.028720091280041729065 -0.094100180477136127766 4.1144047820521612024 2.4733779711247048105 1.0630153390529601953 0.1497492346865277324;0.9865987244511726928 -0.031649785258439831759 0.67297210312692001821 -0.045059047833750753842 2.572999186517806347 0.82484484182198491986 -0.37190389286216191111 -0.48459589589414647781;-0.37681650709247094255 -1.0808818560807931242 0.8854835938187132216 -1.3144573093449061219 0.066694852412804872532 0.32517302939825426522 2.1036226475019361715 0.30878121254582852062;-0.23742882726332947829 0.77592004851925300279 1.4145194452886589165 -0.99127323813099332828 -0.014506869289628262706 0.69486248289882812657 0.84809771218913332369 0.099189011970986021294;-0.11469847621546676308 0.32732936457224320881 -0.16401976989113362104 0.85068228238902354743 -3.3003224067584655543 1.6167727904880309087 -2.9168035804835286129 1.7570279996285571578;-0.42054277107660842372 0.67936778090033589361 2.446416157424045057 -0.90703752130038783896 1.0828208431947836665 1.0678280249357081644 -0.036662808724198116261 0.37104654950935012092;-0.19488784706635564614 0.082495282375707801314 -0.39362623212501762771 -0.39665829347679004702 -4.8895073527374499633 -2.0934495312760721397 -0.77205053766622400158 2.2605182691319156696;-0.16301322709228460717 0.45445053096025050943 -0.54665115588097934474 0.047430225006149746847 -1.1880555833208090721 1.3276678598201172576 -2.6090122863819162902 0.1352417118633530424;-1.1581352830625715189 -0.52290092154524714374 0.50190730615766887546 0.487697490900765529 -0.1112972934193315333 -1.501454740268385768 -2.1788052219948776944 -1.4171393102022362687;0.19830627909039283407 -0.82615707379838576596 0.66718095681368672079 0.10440143405348113748 -1.6161025666711479332 0.073975734550488073116 -0.98292351863723570471 -0.54334850961274128167;-0.82971381103463004436 -0.80476905836673151562 -0.87666234584733737645 0.76658274545906679442 -3.4516806707373226537 -2.4515283285651645606 -1.5874128732224488392 -1.7250769689589999789;-0.44505353812925801948 0.33713761391122604172 1.2664955416798686638 0.52602628477560775533 -2.1162504035782374601 0.15742366032194959891 0.69803852676714750469 -0.568205927689173107;-0.4171409810643889049 0.52922537703895167205 -0.22637545119706248276 0.42852112568730954534 2.766098387831849692 -0.16012264846285867437 0.44730850477152106492 0.9148607889059925391;0.24575474065321337158 -0.17895912841740932442 0.070894255381537929495 1.0608109790230417779 3.532993405482111271 -1.6636531236031404379 3.701270573715274903 2.6943535380710788019;0.86387897281892056522 -0.49434352802638725777 2.4008344074773315668 2.1232155137887902541 0.69806096465005795793 0.95884520635805925437 -0.47818885130468880007 0.16577856568723564612;-0.7679321551297892956 0.63143414922532170586 -2.6302658049711209465 0.84321899726052218504 -1.2176743339724751536 1.6880859636061023021 2.7198227612195968739 -0.025850244179100499708;-0.51079367209231985036 0.59901311466557616292 3.7806894533121253588 -1.0822155450783832453 1.0067533302487474689 1.6829171317604592062 0.097668692967001646821 -0.42211529357900690052];

% Layer 2
b2 = -0.86133799151656142978;
LW2_1 = [0.09651816990275396968 0.29216614575702526402 -1.4438549568824687874 0.29828146259215820857 1.2998494048994486683 0.63163436017941188005 -0.36114830906619260764 0.23332628929530466189 -0.050989949857080815732 -0.47544056586967431421 -0.31161009781568754784 0.62182966557552366016 0.78807016070891722226 1.1725682451507626336 -1.5469322826087332778 -1.2398983826597649305 1.0537160708998418723 -0.096380033862353081675 -0.33532966582319023718 -0.30105178984905928141 0.76544862689981452153 -0.11985114880899007395 1.3320053609267015204 0.59728290182503895878 0.64684930594388156955 0.14158815731474064248 -1.092852779018780085 0.3079528487614047183 2.2115274790846819464 0.49936916487143501175 1.0330098543932397792 0.27849451682237424954 0.53257307598964220841 0.47814824807498057524 0.94836063178911156335 2.016232365781698288 0.13729214226690603096 -0.38357252401104746653 -0.18816323911946383762 -0.99418690587353319987];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
