function [Y,Xf,Af] = ESPER_silicate_8_Atl_4(X,~,~)
%ESPER_SILICATE_8_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:40.
% 
% [Y] = ESPER_silicate_8_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.6820380169049631292;-2.6883505299403300803;-4.8913027185926889473;-0.63896114871732412333;-5.9550145443630260189;5.0071157301075972512;-6.5439161442038580319;1.0981427798946385987;3.8460394543114793109;-2.4514827743064753207;-4.3699356454463025301;5.0095005893375796902;2.2864149722552715716;-2.0205503248597622701;-2.1510399687481442932;-8.3911894417861958573;-3.0035764005967222623;3.947738554444068626;-0.94657834276470242951;-13.216410773935171719;-3.459961761913866507;-0.11569573283928723251;16.463423524140178955;-1.7183874005878025937;-1.3835722201090352446;2.7713494994150189576;-9.9928891847549579097;-1.1428780882366542659;-12.630465107787882673;6.602497991699176616];
IW1_1 = [-0.26167296262282435659 -0.14310580980548781582 -1.6538606799408384074 0.94924846672880869303 3.8703041203146830718 -2.7457821584338844012;0.52135476950969927845 0.082545993874065068385 0.019680256516061728211 -0.32004371644929918705 1.9820854339335058913 0.1948296751512929581;0.46583050068775172514 0.099358059411347190992 1.4834179571940537823 0.76886220416890638241 6.0722781502038136736 -1.5119201005844811192;0.26519593460655371819 0.15313112035913750697 -1.4446234308812260227 -5.2129030062259031908 -4.9890131715174979021 1.6688437703515377475;0.87418677702988600853 0.10059584192271806002 1.1239878954086863772 -0.64075181970748562588 5.4393985286370840626 -1.7892000379253447662;-0.7350802665993532159 0.093865964033746140949 -1.2400123223852954624 0.50159975490127839404 -4.322589279108996152 1.9039824609235995734;0.37501256049824849281 -0.034191391441168922372 0.84250795635771635883 0.65308751782060103785 8.960473513050922989 -0.62732652022066104358;0.15688488465039288067 -0.089662077894843594805 0.96664114606590401113 2.0127261965040927905 -0.7923096855498781288 1.3329924019003445146;-1.0166330872488211767 -1.4382963266583039808 2.1145625912818299952 -0.63693057509647876824 -4.8878659291979635881 2.2858073454285565695;-0.12947031578262427343 0.71352066318402573852 1.701584431473562864 1.5004479627227655936 4.6775232270913473798 -0.6943259389181657415;-0.53109097383223580202 -0.7649775478176792376 3.602215263048977878 -1.0279730500659240988 2.529102906880454249 -1.0213360293067006435;-0.94267715367474436139 -0.57025027487215518285 -0.65913447257283941383 2.7661640472128388168 -5.0551965352515022545 2.2201119671805535916;0.36359331268284778016 0.087408282479712648416 -0.30564649909564484132 -1.1439869439917897953 -4.4202600263880249543 1.5246311944808066396;0.22978790651968097891 0.0055487953036810633983 0.0013752118238185835446 -1.6278781662684529419 3.3331294843004961592 0.17047365152177199055;-0.028387852823683338427 0.49259420529959579982 0.081783029730297399085 2.492049402886175713 6.1116208527148430107 -1.9312317305864614703;-0.44550720527491188827 0.39613652671384902426 -0.24298351628942674307 0.078162759842027002 18.876754527730643218 3.7139466183026437207;0.91356056477243852143 -0.26898323041626270857 1.618853318748478376 -1.814798370187955534 3.7377888069823410611 0.3599848291083573848;0.17601870978925920896 0.35118122824380215707 -1.2315134906314086916 2.4920747369643065916 -2.6141574278207668769 -3.2371594820031504014;-1.3921645169739418346 0.2210162558630067442 4.9730001096982210385 0.12319503480309701438 -4.7449615266060058971 0.6371379791365336942;1.0130191961527050815 0.49769969201051961205 4.280879428030731404 -3.3052985494442195247 -0.47910892500107749026 -6.9756761072705071314;-0.77493082562008308578 1.8800021274228222445 8.8266978894647749598 -0.49110158036361023504 -8.8565020708117128123 1.7347350204391485118;0.80226160058113027418 -2.656110494249824594 0.60119244167356822306 0.28336045699715467494 1.9342716989845163411 -0.57101011481902519407;4.8923380431484320141 -0.5200856383072153255 5.5503712106516696068 8.2628599056988196736 7.7055766742976121719 11.577828425719529193;0.75281654924878171897 1.0655845095349605334 -1.9902027492525882213 2.1178231414394921295 5.3663724421412206667 -0.64393893712463834422;-1.1718122579502596725 -0.6197260830346009719 2.7896390084958939681 -0.90344144291472849861 0.66881236615132233503 0.10171692396140488701;1.2620806857170259185 0.27455289675440741615 -1.9821257081700218716 -0.42726377669786597124 -6.0080972008519992755 -1.2866279319868312303;-0.30650061666708644514 -0.40193949101977444194 -0.10276091298257715445 1.7070893953026651246 8.8187120912227037195 -2.8984937534703347772;-0.96235645735192609784 -0.65521156729555829479 -1.344009536992085696 0.47316027065430360521 0.1985085084697181812 -2.67387276774193694;-1.7044469791996874619 0.25899199096368791251 2.2780090884012311747 -12.144835119301486515 -3.491119684033261894 0.64489891484215189355;1.9152474127741379029 1.6731415264847626645 -4.5180713728516472827 -0.59853267263452303304 1.2184686599368979021 2.739806122680511713];

% Layer 2
b2 = [-10.174120399061500564;-3.4472389113249164438;1.6404943903207278577;-1.8254024275918205866;-6.8044686419152382584;2.6971920866192040656;-3.8879583694504304958;0.81168084921672489784;12.118112869057913628;-0.92477624815724746021];
LW2_1 = [1.0613409973901155592 -1.2647759225914105841 -0.50215563274317542852 0.87538142156070641864 -1.8668795739390178223 -2.5561111143069581431 -0.62720490545695650741 0.28167443490935772932 0.74533231012712886088 0.66714980552240743528 -0.97803976606565812268 0.61874441994012230328 -2.0189709162383198127 0.93416367548321688208 2.1373932673243132285 0.14847895944976927107 0.57540568686316606595 -0.46039359371795501863 -2.9751597299278480513 -0.17476023947156504867 -0.49567802090009122074 -0.39477733768858946917 7.8120969556217740859 -0.1508318492601755656 -0.15622248098320792864 0.48863595272057702701 1.5353469445490894874 -0.95776978667435408443 2.3576764464091546358 -0.72598298879154044005;1.599866795983142076 -3.4766557591038793618 3.6101731860493506687 0.13915346795936978097 -4.710447371505851244 1.8063960261658726925 5.9115791223272768917 -1.2031725272745377175 2.1152497059974413318 -2.8251939823581513345 4.802419648184603318 0.49605183194218532838 0.39400490165988777402 1.4551306969876016684 4.7510897363679376326 -2.6315455423476379337 -1.2969644233423562873 0.1528179780063028681 -0.67336553287598743811 -0.48301401824193984647 -1.2128996727840049008 -3.3689613766767267933 0.81042290061059341078 -1.9264867713134041782 -4.6916863248373923412 -1.0186743974577829874 0.06652070379854260751 -2.2324750444695551366 0.37384681801997871053 -3.3517848182342153684;-1.2465473384441507765 -3.720324452498064538 7.1868198313883642214 0.43583162950626924692 -3.3592949019645494957 0.47127727336717056827 0.28793581771061393937 0.62742711082453506144 -1.1520177460464409158 -2.8280612995594540671 1.501218398692481637 0.070928889930961719346 3.1080429948750283309 1.7470972932871102756 -0.42487391342595359767 -4.2815903872788823037 1.0824713439664257475 -0.32671372868413378621 3.2756428883949739728 2.0551825794584286378 -0.12241217223671238545 -0.92534121277938841121 1.0798783635803161918 2.4285088648398951428 1.3122952042957753971 0.12501307468526787203 -0.03396991094312840076 2.0601725494130480598 -6.507650773952645018 1.7960859004642748538;3.6178420947626097615 -5.6691212210633183943 -5.8911942391369711558 -0.69716699962469985685 -0.47717532576834065239 -2.9226913886902874395 3.0374235926568053934 -5.1635846563664857811 1.5139309904998936585 3.7490991538797713289 1.6198874050604650243 -3.0908035507443161194 2.843916259768563215 -4.9163687825758968231 1.1770605265280558172 7.2212558195206284495 0.38831706521412984179 -0.093441465541956814089 -7.8989661941532780531 0.58111609644373884986 11.531499308292492145 1.1837669583062409018 0.6660613983252589021 1.187799417728639062 -2.9943623254194724481 0.85828598295123370576 3.3643789776502797118 0.088486696471490849936 0.915369664155927798 -2.4876957744807381978;-1.2153663831896892589 7.8032774091574976794 4.734378040552435607 1.4457232752628099703 -7.9044757834099144134 -2.5565689903504567049 -0.83842012165845736238 0.98623856715371283066 3.3269788764851178087 0.65600858337304090995 -1.1682506491334765375 1.9061756561241118835 -1.4254915080312200448 8.334092983717592773 1.8402522021739295965 0.57706109817389716898 -2.9762957789972945832 -0.27021345193729606748 -2.2924201280848439666 0.62082360671045244693 1.130692460152625145 -0.92154993700138432278 -5.5277790157584316688 2.4962771265262508891 3.9854359990994638885 2.7529576223931311318 4.0695157212621584364 -0.28595346704574270413 0.61669387287168120348 17.38203562478738462;2.1107845735666113107 14.076940816895801234 6.3006727641191764278 1.6200384591738483664 -10.329859123853822211 -9.0782739356092800875 -11.000010146461990601 0.9945321446096585527 0.023410709604844856524 -1.204342139042595905 -1.3576175443862177339 0.22948893443354553834 -7.4464317438318987641 -1.1474701286396153943 0.089653196401074983224 1.5878288351804650258 1.194306685476344887 1.3615353179339777512 -0.89457430794010450725 -6.9395205768805627855 1.2609634620499656776 -1.9919710084539499206 -2.9823600189313550501 1.6657737663235481218 0.99111070779810728215 0.22925573993524184235 1.5329376883849128443 -1.7963170883534103073 1.8495506948929587576 -0.878874024305783208;-1.1374276366386171233 -3.8486845183897400169 2.551891153573901061 -0.18005309462407356746 -1.9042674937969117366 -0.69780054023274418196 0.96881723387494023125 1.1272597739653278381 0.021794049640420486841 0.097897464466003669692 0.25074598504451711678 1.2205633130732103098 2.4333083257939294164 3.7190106702863894306 -0.42028857213469483778 0.19933413918546039056 0.049539626750796025845 -0.53933635285360082001 -0.25776337430869755707 -0.13954029668146342158 -0.13828168399382836928 -0.10531051382147769979 -0.6826845320043748444 1.1535313476739128546 -0.12282922701186792247 0.065079930066541363809 -1.5714373435928838951 0.94548683259674082269 0.038605960901877525715 -0.023125585494873410197;-1.1472195295769944678 1.1063660446305156881 0.50249726857607035502 -0.8890072647679423401 1.7874111257464702085 2.4341090882675393559 0.61425848627822599024 -0.29051168600172128098 -0.717166100324042044 -0.61675786147985822705 0.95766135264391838433 -0.60485120759769572807 1.9410649083109399182 -0.91225704988818445695 -2.1635920703912319141 -0.11724891025788534982 -0.65958956046382366534 0.4018721895705006375 2.5802040532172059173 0.21048383369984097202 0.27687466343356098575 0.287751483067297531 1.4572218969735968308 0.10464431235367969986 0.065900721616726415375 -0.50567119574901386869 -1.5647049920833326908 0.9408757651353703011 -2.0619308485339091774 0.48154500004746286779;4.7575803257726194673 -1.5612336766326038173 -5.766240868036526912 0.83101269506748087768 4.7936915084351685579 1.8441189584833892479 1.2395297642777609592 6.7287778731945246946 -1.8254343481402199867 -2.6233836766708824584 2.9606452784419809987 -0.12604469417890090677 5.7726273636251415056 9.8799412747464661066 6.3126709368153264279 0.45922318083524316101 -5.0259464935102986516 -1.6087043294341920596 0.85138041119650786914 -0.24931459385375981386 -0.38597263059109632177 -0.11376717379028374044 -0.39743368637308501556 1.8116791413687491907 1.4446005779007333736 -0.74266531080154374322 4.0532463857554610343 1.3750900811201185459 -1.5559332871461293291 -0.96500374215427953128;-0.12835718614947361216 0.80072445558456450954 1.1265798302691805155 -0.59916686656048712134 -1.4942190790230354125 0.69243359549454497337 0.47378135194194409552 1.3859520139594416754 1.4834121187168074485 0.94611387480366859748 0.11259236564980378004 1.7490127744387893305 0.41080369475979872096 2.1795846363435411597 0.32065323768570008767 0.18113106820447655299 0.48422004670818374894 -0.2914154451909050092 -0.35274514946204582611 0.033899628420536717655 -0.16065792447169335855 -0.37527318641682977374 -0.17761317930966077916 0.95962069694808171949 -0.15386969853485871207 0.88484924837527623165 -3.0040357592481909954 0.27068811419978688892 -0.4319069784507622578 -0.54057415758564164587];

% Layer 3
b3 = -2.9340303936770384396;
LW3_2 = [9.5815400281058327181 -0.078498364991632735288 2.8970930371689522786 0.095525045666239108422 -0.15879161406669820011 1.3721820180084010055 -0.26668840437618285266 10.059518250290302888 0.07830918815596202287 0.31988799602666218025];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0145232735458572;
y1_step1.xoffset = -0.52;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
