function [Y,Xf,Af] = ESPER_tco2_8_Atl_2(X,~,~)
%ESPER_TCO2_8_ATL_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:56.
% 
% [Y] = ESPER_tco2_8_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;9.1619;-1.99149636107278];
x1_step1.gain = [1.0000000017546;1.00004398834998;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.061098595529566];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.6922639895216578;-2.6305723290963789;-0.77960735775231382;-0.10453121574509984;-1.3793156296132258;0.50812526336587371;1.6175356002010901;0.86064134368194833;-3.3445094437312832;-0.63412172009139567;-0.46618016687755381;-0.38432518724813575;0.65180469610494285;-3.3603495060707069;0.7926797829201071;-2.062902388112525;0.46121902040470952;-4.6255199644446252;3.9574969336379793;-0.27230735628640984];
IW1_1 = [-0.41340498862354336 1.2038300814690541 -1.3067843308133205 0.33705725616986898 1.2892489344507687 0.029558156398501907;0.090025524657042458 0.56285867083473151 -0.0036607795566870223 -0.79912490940976799 1.6863525089665599 -0.58808108177000895;-1.6047641031171251 -0.47160390737304603 -0.71954654988295974 0.031797159896511412 4.5670816538645438 -1.3692245623321739;-0.65899322058662313 -1.7870275554947497 1.2127015683851485 0.02719690801719667 -0.0015868165007772578 0.023382107551750117;-0.18039048237526206 1.2989878715121508 -1.436796653657324 0.25180423834920984 1.7965508220776687 0.012032917625141342;-0.47604074306123795 -0.38334967814457444 -1.2762925682905004 1.5391672038214523 0.62475674077927223 0.3462472672173364;0.54928712541507208 -0.52817032452660451 0.63520248717661343 -0.60125215308880264 1.8581956117323817 3.548904521895158;0.19863179814105275 0.27749557478583181 -0.054410293196845871 0.14646980962994929 -0.44323658180947667 -0.34315857919109066;0.18161185978165847 0.81270893223444807 0.89020107143876948 -1.4171012781371204 5.2125231069795035 -0.16055034526501688;0.18945665613338283 -0.7442890336413639 -1.2936273024674483 0.63143324453189753 1.6885055855142115 -1.4339822938618281;0.15132472024331148 -0.27166504903503857 1.5590505525130465 0.1294762913328098 0.077291256226534363 0.63355509805739385;-0.33005800789054057 -0.77580346449841942 0.95879845206650749 0.21893362034200661 0.39794368821149584 -0.96525516621899432;0.24805180622439871 0.75917314485079657 -0.43119861795355974 -0.094791553287401825 -0.27225245723017638 0.61602824147018909;0.1519810478890688 0.64298302109197147 0.78465242981537364 -0.49363439205658571 6.4399268205567282 -0.1212456973862924;0.54962775641779782 -0.096334510067374424 0.33445899676707225 0.26370170063296672 -0.53886691727944447 0.23894892809543247;0.12089577227548509 0.085512588093627412 1.1353783527618833 -0.90377341631260921 1.8885179682306008 -0.5726218512113036;-0.11537272899116438 -0.43267322982806761 1.7180093981026436 0.187695109945756 -2.0137963069950731 0.055967341086830387;-1.44968337298366 0.030835072330111339 -0.9440550816193507 0.60804151733338441 5.0789676883426971 -1.0734028306203303;0.33824447609098796 -0.1781680138428697 1.0622377516706702 6.1981753540694502 5.0337038479841212 -0.22374326767609928;0.15519902715565126 0.16623537298195454 0.40197368028165864 -0.01560937347466039 -0.015308351507247677 0.31525533174312831];

% Layer 2
b2 = [3.9988629091168924;15.320999820621001;-13.543972241793439;0.06405673492632992;-7.2368828669786662;-5.9756172724762751;9.8729332137590582;8.9172974977623269;5.7367393849570085;2.289315831597126;3.720162705732454;8.5676631860446832;19.248120894739014;0.28255016535379218;5.7875827969284348;-3.655338169181197;3.3062590896159407;-13.210184081286689;3.7094477678486903;-5.2636728248377143];
LW2_1 = [-2.0432371283430641 -3.0399192798841121 2.2151818348967329 -0.28598654287969227 5.8507008687009119 0.17656258662283805 -2.396660335436513 2.8709029225594249 1.312925282869287 -8.9016755166884867 2.5116296601197776 -2.6696395263478863 -8.7416698049782013 0.88965049107103367 2.0478495333724194 1.6693097587228634 -10.4266922366352 0.097386677687541723 -8.1086426411191077 6.8736618228392414;5.4202254168381385 14.711741782086873 -11.404039129318548 14.611459929741764 -6.8318934918344567 7.2135529886284484 -10.43201534250524 -7.3739808400024582 -19.620672733858221 6.677922285421138 0.44129848564227159 -19.607739055568643 3.1624919133562623 19.83848130372883 5.1997872259609093 22.785597378998041 5.4536415680791972 -10.504914008843153 -6.8192023129559374 -17.986680192414028;-12.25763259343414 -1.8165877961515786 29.831464840456086 -2.4105917172587641 -16.702651237161071 -3.4917676026115037 -15.588053089683481 -6.8446545799458578 -17.382743081113176 34.557886720023134 34.020562935522356 -10.453550834856964 22.511748172001347 -5.1941072914699324 -8.7719717796250372 10.920390834870798 -21.480651061208288 4.6554641704267716 -13.842875199477641 -5.2677828030187435;-1.7897575911340489 5.9840248863399372 0.93825517590806462 7.4491257236162287 -1.3344591099966185 1.0549112207473932 0.86578967913257243 -3.7136709520933637 -2.4791354557887635 -3.7565679630259021 -6.377910386085019 -4.118739541126037 4.6463005068077123 -2.0163056911322137 -0.23719517631724876 -5.8780000775325147 2.295286279196485 -4.1851399567005503 7.2649590414210126 12.364985202761906;-3.283821418965462 5.4139655627078582 3.8220828408245739 2.1807174214986005 3.2964473466856212 -4.3316371104499112 -1.8740757325459716 -2.1611654659221964 -0.65872308352629727 4.8934864915343734 1.5882109533097106 -0.40550048519070447 2.194049791951536 -4.517842323697308 -4.3160878822728419 -3.4895124158553155 -1.8180083614614 -4.058869904140411 6.8178377965143895 0.37020071601438548;1.1172518961535578 0.006140514759936079 3.8733052130570895 -0.035376698759253783 -1.436474645868187 -2.7754264245714326 -1.687755415401111 0.31816555968693555 -4.8057578447575784 0.66374379745199441 2.9790841088163345 1.349015806203788 3.0934963947004448 6.5497477929259418 -4.1184188167662974 -0.47315326319240802 -4.3487243886548992 1.4145890796054903 2.7604143791134241 0.90967171948426517;1.5823557853056671 -2.4555387640240376 3.8786635440623352 4.9282147035917978 1.1920337536483356 2.4352841605389566 4.9511295945546374 -1.1375800175172919 -4.0474270220494457 -1.0760615387598953 -1.0036559832449061 -3.2246238394747686 5.4637015383658811 -0.31118868594891652 3.2815354582735208 4.6208157069829507 3.1008579841939952 4.39484130327945 -11.056154021864748 0.79078701648906413;-0.14621631376330912 11.367098040093206 -5.7276406131243105 1.5123440467060962 -1.0362268250986315 -1.2060877211002101 0.086832456091777699 -8.0973443420479292 2.2017029265230432 4.5654570157664818 5.8826287447612202 9.3315614710383379 16.725707512833864 -3.5212549178970836 3.6567688824929254 -10.918592112526541 8.5631669734355711 2.5550960757134966 6.5820175972851667 -11.598776613766804;-0.3721423044206924 -0.95889278001218048 2.1972090517608733 1.7730388373367627 -0.074963865977867125 3.1447884522323908 0.27835319596830138 -1.4292108255826079 -1.7073246774677333 1.1153206043769228 -0.67943419492677348 -0.17145496618234152 2.6489366652273341 -2.4673327862969674 -2.1075282086698239 1.535152396681283 1.6847521786581974 -2.1300125330323243 -0.19214271906713901 -1.1123682229960881;-9.2884109183082959 3.9569391565996805 0.78740141927253549 3.291057995027288 11.166628783531324 5.7732547653258068 -0.63002750234441796 -8.4177376809162752 0.39758384908402195 6.2318923408036913 6.115304642562295 -7.2118318645406863 -5.7839106154203863 -8.2656714534021454 -7.8629427358274526 1.5350246316770062 0.16377808184416576 -10.49625514334315 8.760088332773913 0.79043952070773282;-0.65108394754420051 2.2549423918129046 1.6383928185004155 -0.21372899225705219 3.275295132492599 2.9092782162467126 3.9227936171332889 3.9809069287718848 -2.2741936286186664 0.020571383459822158 -1.4551100177851806 -3.4746632144826024 0.25743446474064957 1.7373529791620506 -2.6838949860745274 2.4937524920286607 5.8916461633397414 1.0102351179373186 0.93514879044792232 -2.7799977874794912;-0.74231930643697397 4.3235998249988423 -0.55734440014907116 -3.413124210676147 -0.16768104419635599 0.96748958930920226 1.6399334895745357 2.0929652543029125 -0.28240808987899102 -2.1077737086278061 6.2004380687167497 -0.53975112244535617 -1.4459196134732399 0.76407458022499208 -6.8629254141634881 -1.2234514813001529 -1.3734211646728702 0.94317360791775384 1.3503484768442668 -8.9792800393146237;3.9798199769459011 4.9960515972545094 2.4880820228161498 1.673179519156287 -0.036857487127326602 0.25747508801237812 3.4850103770658811 -5.2555970926338551 3.1819437548612268 -4.1860611829781771 -0.64003366583419941 0.33862907437512058 -1.84375589091895 -3.845927073001099 -3.0794799457186186 -4.4596931830738633 2.9670777980503411 -1.810805923963585 -6.6531753278842327 -10.31640459793571;9.7860072204348771 -0.020751429306948899 7.9773767230404626 -5.2057463636556216 -7.0231412802667297 21.965740021697187 -6.8209920594624043 -0.84890305719273362 9.4610304818722035 -0.36479581984915505 0.55321047645299082 -14.754173642497216 -18.588672215857709 -9.7609156555162411 8.9838913703434518 20.972310283010877 2.8156487438420168 -8.242599954812313 -1.545219398103566 7.6965365689378213;-4.2052222833363633 -1.4365556176612126 3.9917208477028314 2.1049331874489057 11.820051961755448 -0.41662031703736824 -4.3985188812871403 2.1579939931158743 5.4656674812845818 -2.3855380865112825 5.5853247276151219 4.0910077339481354 0.30622004727800806 6.3402911233313688 4.0265739543726804 -3.6330030834079485 -0.98523027630946047 8.8966822743567402 0.76891120585310757 1.2111508651516749;4.9619865852330101 0.51577997494977601 5.5892600882355623 -1.9902135669577299 -6.7328225459420352 -0.66213833221313401 2.589150517335248 -1.031944063985597 2.2936748185116942 -0.87468860056464326 -4.3049052664944725 -4.2819763298018527 -6.6741008808048408 3.4509754689232297 4.8700729836754224 -0.39636913868758056 -0.13685813148924753 2.6747151780645271 -9.8515545012732133 -7.8954644872973239;0.097294097846742811 0.44762549603245472 2.0240614751306301 -0.14769930700996498 1.2876938494032952 0.095891332433875931 0.60701942630258066 -0.01493245279605139 -0.47823928217054734 -1.6385377287109995 -0.60468337828419771 2.7665411676000469 -0.91162156926215399 1.5253161999091067 5.2536104963156873 2.0377855399168565 -0.11768062939196727 1.420162314090516 -9.9100113494010458 -3.1913094791575349;0.23526881851848219 2.5869098740588909 -2.5835025474675395 1.9503588246108101 4.4771304522461115 -1.0351991032967285 2.3849444220485121 -2.4378428030959722 -0.36087797731189941 -5.4082826919541453 0.51813140915986966 1.983792865578331 -7.9885548874223433 2.0630838372782869 6.0233945852016753 -0.76787499609757426 -3.4838025791174068 -1.7951720897237522 12.435757767683116 14.170187941475502;-3.7414977298013872 5.6484075759245673 -2.0055342765600797 0.82406194639988306 -0.82738250067844676 -3.4038593057598394 1.028891860354169 4.6332582246720113 -4.1827311006965893 -2.7654094006097441 0.086079344556067694 -5.8178829391167808 -5.7563959203293429 -0.075721416809028941 -1.2764392142468717 -2.9841159868038578 -3.0501593968230027 -4.9366666988212051 -5.6551858573502152 -8.0655248534161306;7.7837875642210772 4.9106130995409041 -2.2588543152838696 0.18408596057404447 -6.4975382984578944 0.14579894432868612 0.57333047919938562 1.4663796279003423 -0.70004729595368098 1.5953561583005178 3.0875655127407966 -5.8255349875367557 -10.900269894040171 -0.27596633199031306 1.9955492566660384 -1.4680156460651965 -2.0719094215943654 -1.325896197960164 10.628587510898686 6.3094837544954467];

% Layer 3
b3 = -0.02274435286768077;
LW3_2 = [-0.013347052105260201 -0.008841355368574947 0.0050266793232476101 -0.0090021463448934306 0.055482008307218091 0.038545672237743474 -0.018549665292152049 -0.029948446200910125 -0.1787376497036775 0.0090848501061091408 0.068782434256867669 0.83912776170321046 0.013830108041065017 0.0073718863923192537 0.013347231240722561 -0.026573489228026353 -0.067666152254584611 0.0061540910008829955 -0.025452339754915145 0.064164869962804752];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00115315130997576;
y1_step1.xoffset = 678.286531932822;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
