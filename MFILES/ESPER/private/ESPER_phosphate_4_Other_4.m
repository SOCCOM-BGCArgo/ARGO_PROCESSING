function [Y,Xf,Af] = ESPER_phosphate_4_Other_4(X,~,~)
%ESPER_PHOSPHATE_4_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:27.
% 
% [Y] = ESPER_phosphate_4_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [9.4480187128450214828;-3.423595724455176903;-6.6751328085602175122;1.0674796603049929722;-5.3691232629427227963;4.9021703643168983433;1.3170387688062705767;-2.4258409951327521981;-0.62123664487951635316;0.94421681038499816196;10.068786747049673025;1.1883075549017441119;1.6071977905794210262;2.7508850209230195638;0.18898860694270883109;-0.48227006248049930637;0.79874132356434479618;-0.34143164950098070509;-4.1244120573104563476;-1.4919520110493766918;-0.46708856028376277703;0.69516599181717630973;0.17930468870367163858;5.9565569332515169165;-2.2562814007349718537;2.9934111187237419927;1.8581798319734166292;1.3487854449320257899;2.5608825357210456275;-1.5239485006101038955];
IW1_1 = [-0.12519512303551613708 0.054083702311832786147 0.82483642483198238438 7.0982781474328318083 1.6509234827800198797 -0.27411667326569955083 0.98044671236239122614;0.38604357487566703933 0.20700105901365645211 -1.9720843817774573736 0.57695898723471639169 -3.0469951198858948871 -2.3358995063862471042 0.59709259415899562651;2.2102499647317865872 0.55820067204108780867 7.5272857819201846041 -4.9519644661016837262 5.692218884422636016 0.57951690073566208827 1.5166014962375664599;-0.24427737593862758336 0.088222798359033821614 0.33652533131100936803 -0.27909506946833712027 -3.222088742930308225 1.1804317713731533601 0.21151002758031980933;-1.135997142564920015 -3.5033955641864009678 0.81605570240932756576 0.60621278600621630872 0.76937571457686548815 -0.12209626819353872063 -1.9366453751157088892;0.28452318246553903736 -0.3511650906307319242 -2.5042041062495710158 0.78796407816120095369 0.3955828214061892778 -0.49931935880449418441 2.9611647323816723265;-0.18686463404560563206 0.98073121210407354642 0.9943580326194261243 -0.1780758612413467501 0.23598791645606465028 2.8782588547666660972 -0.15155343898945139447;0.16319895419661517577 -0.40910270707304419169 -0.86137774976502123891 -0.2377535282392330418 0.65791945726624245783 -3.1259633092141134725 0.3963025753629273451;0.40638758911486899672 0.43406123502861976293 -0.0047074754018542547609 0.29517246837492133738 0.72764427533352005195 0.63467576606015041474 -0.64976767320413686413;0.16345170668153879978 0.14314104064907418046 -3.6304661753800706592 0.83371725007250030437 -0.60026566463342123647 -0.26110918886653355919 0.15462317369762906827;-1.1121928458264929152 0.9812440203514225523 1.437254802925898689 6.9526467772239550769 0.2239226789796707473 -5.897338584803490491 -0.2506912456812627199;-0.42027309076077995487 -0.47100275277336334234 -0.16120290049508145813 1.1619820330687762322 3.6753492885144858349 -0.10029368929655396725 0.43671736450685394448;0.12773916255264219921 0.022957390150863999506 -1.9668981818375081971 0.48627489010089758326 3.3455243048430496344 0.4987943593991928104 -0.35715497925782696553;0.40884112448944359697 -0.026259665495807587438 0.48813794564598600445 -0.14308664903079051922 -3.3320285265229134808 -1.1486988749367110785 2.9733374841538005029;-0.59070583768261208935 -0.65031182306284995853 1.5868249962182681134 -0.89059677787035773644 -1.8082021700215669124 -0.52179774571028647578 0.09411018324599429441;-0.34107712033382814321 0.19353247387401845137 -0.045020114395089863568 -0.37904335814900919077 -1.9212281645687656617 -0.59628315076287718988 0.55807115047116595541;-0.70045940936331085869 0.4240986887421507312 -1.4929124654263057348 0.47911559226589833793 -8.3018344019173806458 4.1972955036500483317 0.68633729441409818683;-0.94474741050134125597 -0.58605899543844652833 -2.1213924896528291164 0.395968452177525021 -0.23630954273491255879 0.43767401958227658554 0.64788171971321217857;-0.18982401998399259235 -0.18867407540099229157 1.7701535543187720823 -0.71169762028626848416 0.86773944182452589224 -0.45334515728299679127 -2.8232802519762345561;-0.20142526367745966498 -0.2421004084105608245 -0.2014307045610145841 -0.18548127254694596333 -1.9865638169897190668 -0.79957269581112877521 0.72139555155282353294;-0.27649400908638788188 -0.16994413613099204619 -0.18377273838698793273 -1.287078874269411477 1.1987419184341172596 1.8355805711700308169 1.1676994408975742701;0.54180255449379399746 0.4825207034464403244 -1.2837651872172510803 0.31478741290782913387 1.7044457139760091913 0.29045040955991791032 1.0309726997552135508;0.38058849816373901964 0.059911246490987266067 -0.12336341095702771375 0.11522932205721117538 1.8363661191606803769 1.878361233883983239 -0.5343357510039852265;0.18443235792223466873 1.7255731085101215783 -3.7512754529015528426 0.51205990065985751425 -7.5936089007984053367 9.8495777397510515527 3.3269741134365791169;-0.069082047128589355034 -0.27050764612087746519 1.8282538565426531552 -0.23225782933169489275 -4.4199080867575535336 -1.048871705655297859 -0.81469335026671818589;-0.97932553459151416853 1.7009038678030199421 3.0249077561563502137 -0.67191825688048356646 -3.4890122747185650098 -0.47148449083356602785 0.39486690305136989965;0.61569035763791402083 0.051396086426983671192 -3.5186336508423536884 0.57963727507322204691 0.55879933448789609329 -0.91554049744321963633 0.28502039387448502294;1.3832277421639125325 -1.8211356810868200018 -1.2582119923679484508 0.10173406327752801404 -2.3120750812727903778 -2.045245682674257548 -2.2901013174317581544;-0.27157437972130160642 -0.54223475973546264584 -3.1636962285342442591 0.29249415894049179965 0.49704236058006101562 -0.68069669681072020317 -0.088899290617253226565;-0.040770129471050402248 1.5509018257896718396 -1.2744736290475109364 0.23057353422598145243 0.68267216856171253347 0.062971593252270988139 -1.2986731226422896235];

% Layer 2
b2 = [-0.87935404788453974678;2.2372535526221652979;5.2127172179230125693;-3.1994203231200790682;-26.436797923821927725;-3.6556514110302993359;-20.779386958689549658;0.42873216193992241818;1.421931453890032282;5.9072835752148984412];
LW2_1 = [0.29775341335082661232 0.078060330299849739477 -0.31616990526120752891 3.1992968704241708799 -0.48215078398430871731 -2.9816721702261239635 -0.035367300449211713786 0.53182531465028137774 -3.6545518935158614049 -0.022563416525042619826 -0.45738424914787501052 0.84684233638449335491 -1.8765357579181618508 -0.44857723529376669624 -0.56255230279951284889 -2.5457154484708381936 -0.24559316130108485576 -0.54159640260232633224 -2.2121269518388020359 0.39067888766966801795 -0.19884607713309807031 0.055825562247837502705 0.19063160202401432941 0.048217733534655728145 -0.48180599000554719114 0.36576579001106102051 1.7211590121931499286 -0.59327759498060894661 -0.61128415034391647698 0.47974249765794763078;-3.4501215707476946548 0.08726924416682763086 0.41157107644352303177 0.16458728021222462923 2.5342852823580686028 -0.65927205086438889214 -0.84605679386032306422 0.15261248211979386302 2.0776922301604199284 -0.92084155734162753681 -0.32310010322084514733 0.094954889737346170886 3.2644070442834411949 2.0974531050028657475 1.5573117762495125582 3.0166150576769030778 0.05195494227998453951 -0.12125810392147000349 0.6406965754232285537 -2.2000660874303097359 -0.35843562470485873517 1.3585747862145232112 0.14830371417025969838 -0.26888760558199970019 0.14774359581444379552 -0.16626704787201707081 -2.428335714439734172 0.31482078356635923022 2.0603161845101691796 -0.2716067878461659868;-4.3980270592469805635 0.56823267807484612035 0.092670943378525078016 -1.3298781878811598567 -0.38211181771418895048 -0.25577167878585266303 -0.4837125468579762666 -0.028370943813368187936 2.1233027000979669552 -0.14941442988380645995 0.5540067654953964027 0.02551485840315386236 1.0212029999274299108 0.13665498844179865823 1.4694118807838620899 1.2183282257747944932 0.20401568045117360328 0.1774814637386878946 0.28535616532652163801 -1.6984284017792457 -0.24734065970002988566 1.0766396504868760431 0.48029421892163653984 0.026213104266289383865 -0.086901923755107385317 -0.19791158108811401917 -0.98584803739499593522 0.3047161138958009996 0.85434413650245333294 -0.38244811746115059403;-0.027507020928010016136 2.3871283676491481529 -0.12556255136697391794 0.65532126368660237326 1.0248853147822418741 -1.0003157132767541704 0.30836339622496206081 -0.95676774435436884314 -0.52358990960647211477 0.71673791672966757904 0.020830886161184745953 0.44946004885860479927 -1.5380781762969202298 0.9133539191063009266 2.0731467012397204464 -2.1846618032989959524 -0.13436454140527559487 0.12875624648047595544 -1.8904525726615120096 -1.2197632459200280497 1.5006388565155786008 1.0861325724295187722 -1.3341470679885019113 -0.072713828150355985791 -1.1855141788987657581 1.0031803119207072239 -0.34370755711862771564 0.72538054793232609185 0.98629321216476839584 0.58012930486581260059;-3.7230324085244648202 -36.259627687515148864 -0.28612408722297133501 -3.3623375482598101271 0.10065882019489323651 -1.1722907369980049008 1.1157919834838396778 2.2622607121003817099 0.45564594161440524767 1.182785480736949113 0.2858774362392083046 -1.7251487846612980626 0.082186621496150011335 -0.50558005344811507431 -1.6932072511669686854 -3.8027094838733059845 -0.017518769881522382875 1.1058231992411609035 0.56352332532223925465 3.2064883415070872807 1.3726977492209526677 -3.8325323350785658327 -0.91749056503166870336 0.19835986287931431371 1.6198563662948057829 0.10242371210176444418 -0.0096459098660956650584 0.038287788002275502386 0.16609772992759597177 0.72061320595493461028;1.402176435257345366 0.82219655731057872394 0.299974707572171706 2.3442852075239590803 -0.17305860163406053265 -1.5683718660807435263 0.45744591601527950786 1.3693266515856856724 1.494488066588032682 1.6017707818665447572 0.30932161645678935002 0.15038061525377252603 -3.7438205287290009515 -2.1115484096789511881 1.1086942138125002177 -2.4893352484997173235 -0.34634880183760757832 0.94301352234123347884 -1.4557148530156442945 -3.5383722930859540234 -1.0033001722206329465 0.86634614812286669938 -1.3265241930989835062 0.17127730661895482211 -0.09467179991622952373 1.0112571970637174168 0.51326142159597010206 -0.052014500335432443945 1.575332192495485728 -0.31390504318541972983;-3.3329556154822750358 1.2176387859498805089 0.32395910910135067295 -0.93446343427469547027 -15.957734206374947661 3.0068566622756724982 0.15261229499600229009 2.2114537006268131236 12.253734312379377158 0.2128131377106710076 1.0230384477294516277 -3.0153932895234878409 -5.7440683633690658993 -0.55143642690556504693 3.5544136362186988798 0.72123730249984951968 0.15140187499966925588 3.4986566079570491361 2.0400530150714613065 -4.0427347019534725092 -2.4139284753072600687 2.1500714068656745503 -3.044110214560235228 0.55956144822791820115 -5.0776250445158810365 0.49097244302889264667 -4.5637958086297754079 0.36916268001508956154 9.4167164350134164863 -2.0080119129865900973;-2.0406658625129892037 1.5135691029407412067 0.48189295039465751547 1.5941229939819601125 1.4692726926855796954 -0.043732912412619215359 0.48119667743417143813 0.71359689184416064123 4.2117331765529444354 2.9907232534961738502 0.01786604581211327647 0.12700101032112665056 -1.9568874219177063711 -1.1178102465192039094 1.3200802795726525041 0.87709552626518805241 -0.35475642561093956306 0.62788152419644849278 -0.082507126743650349709 -4.6034859115909139149 -0.83508411904985779817 0.26669546461396687054 -0.53751235720406242979 0.0089542028828336634599 -0.34321970346773789107 0.14523219674124737688 -2.4945564933077357672 0.59238935823851102125 2.8370239622444368699 -0.59517245549295216822;-2.899871857462350544 0.30494434362892197665 0.15510461901831074094 1.1710238766722960158 1.0965859493165512895 -4.2820325170273791926 0.98807698290378331851 0.23430807010564902448 -1.9241980776166924816 0.31912337887783093215 0.17185387226640011504 0.22825815565726090273 -4.2859833176306585401 1.386800467223579636 -1.5996476053821053753 -4.0460103399418372305 -0.48815663795031771777 0.11154413002570248703 -3.8195422350275518575 1.3634616844952185399 1.3582400060011075027 -0.8682735290555664287 -2.2965512816474307201 0.30834965018479726373 -4.130857387241259282 0.6463596729186373846 -1.4023021999586480213 0.26736673385405979042 1.9366361063253485497 0.1213697248206549173;2.1807364272223193069 1.2526690202469608071 0.29518934823986142657 -3.8231913443563976251 2.8113582530753506994 -1.402165650827671195 0.9147918095888455392 0.034104744368250124176 0.46787480458668517791 0.79054726172874278944 -0.4367639186849940347 0.20742085817524433256 -3.8388380247876172646 1.1459492851916215361 1.9083931484638432252 -0.76826655011545830209 0.46889168465047686984 0.80129000721434295862 2.3250808515273235777 -2.7608525607038534311 1.6009497801923580074 0.61584728807635025216 -0.85905321970190595682 -0.0034750164273744791645 -0.50085493877507236693 1.5921447836693078948 0.21768995362835719121 0.32777125331713191647 0.051673919030735912528 0.39704209907651200062];

% Layer 3
b3 = 0.83023608406247761948;
LW3_2 = [-0.7463242907086901079 0.25244844485063455686 -0.97028634092821608448 0.4213368565924693887 -0.21215453848749465937 0.37801489764322665499 -0.37413120060643600961 -0.42913973285584600115 0.27053042534420013165 -0.41847377933033252928];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.568038194888224;
y1_step1.xoffset = -0.04979;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
