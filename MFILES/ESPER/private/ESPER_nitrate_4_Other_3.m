function [Y,Xf,Af] = ESPER_nitrate_4_Other_3(X,~,~)
%ESPER_NITRATE_4_OTHER_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:33.
% 
% [Y] = ESPER_nitrate_4_Other_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999998793562952;-77.961;0;29.715;-2.18999082656054;-2.02];
x1_step1.gain = [1.00003298043486;1.00000060321889;0.0138606862425759;0.000266418009857466;0.193068829037552;0.0582073296585987;0.00819772922900357];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.6191047112372292105;-4.4545335937698089523;2.05269623046166938;0.084361595412101419988;-0.33653097010346522122;-3.4355806510337565385;2.6849978147713513543;2.8867280906988370681;-0.73272627082762398221;-0.84395738609622916737;0.12590646204626068649;-0.10303051921295276749;1.8972524728030637498;1.1493461928213450918;-2.759473926112951947;-2.7994239004674787985;-0.17617492434252363109;1.3066056031179020813;4.3262840281447862978;0.35666059053656967714;0.60417403325287444282;-4.884275747085856878;2.4204289226321349382;-1.1440685984086162996;-6.6327329847311125022];
IW1_1 = [0.25737736516565545841 -0.19497935853947903628 0.8158350816206690892 -0.53230167720348919858 -0.38683990958892450207 0.91932005915394787721 -1.0558877599541625081;0.26770992817754935 -0.22312657608576144663 -2.4133132743173426604 -1.1645430120081297076 -1.7441583433542737769 -0.95832793077471523091 -0.14366393859655929299;-0.17522893803625727571 -0.069787281614299007115 -1.2106676668728537649 0.14875472988535323737 -0.56448886406440612618 -0.87345069690362464598 1.2033686062419099994;-0.47910135804077869093 0.27475366237220977261 -0.5454938772671246161 0.97857721193370283963 1.7724837286618131404 -1.1606037886893669775 -2.0699938358201648292;0.21104887704006355942 -0.55881129278627850177 0.85848597448710806113 -1.2550507859295079172 3.5800189393323709197 0.1331564121422281477 1.3506155855781478703;0.20492915257335259094 -0.33717773740754658496 -1.6095848837304560508 -1.2647868365680754454 -1.4823546721693809936 -0.62132599744599903424 -0.45817837480953327312;-0.1343366684419712298 -0.30881068142428558243 2.4932004520494999156 0.052534557920792111785 -1.6968550270285811532 0.056647294141610210483 2.3858246613151683491;-0.79498657552183171759 0.037589670293543590851 5.2763707810161433187 -0.16565220870068650405 -3.4237560195357028547 -1.6727572940710364602 -1.0686789613496834317;0.51157494835270622691 0.48233309717245842485 1.0229658616330503662 -0.11234986482193964896 0.42390166652884553322 0.85667780642243784861 0.031771679803957633692;0.035689051823732345636 -0.0004947816970500437889 -1.6982773532319574983 0.65918863977810793209 -1.7602039946794978409 0.076920318332212592183 -2.0386856317004169448;-0.0085095983981616826058 0.091551915190863877858 -0.092216170523447008045 1.4322704240851460433 1.1221306095661873758 -1.1804232375012859713 -1.4779929188265457096;-0.27308190720904629289 0.11082520856802573206 0.012756366248203114197 0.27709868964040390571 -3.0706150958816911256 -0.58438005768093848058 -1.1207054288228919248;0.019558188805847819686 0.14497127246808683143 0.52873119174686233901 -0.58457876646709849844 -3.5725674542069825179 3.5927107385028471676 0.022811302337200370371;0.042721659855316583554 0.24901918631678851557 0.14115695967283550805 -0.068152704949728096229 0.64086091688087953866 1.9918436019318181973 0.30177166229746082982;-0.11677518688327324925 -0.36242129806503736722 1.2651533385305340218 -1.7786158306481201219 -0.35574932203785974982 1.201334041658838947 -0.86050501519421240815;-0.029650862249631308731 -0.26210571827856360416 -0.13188133433734217093 -2.3284048750654173787 -0.50561554178705991891 1.1929090204245567097 -0.67106726840949848523;-0.036174248912769484121 0.11686380260648716878 -0.23267280308956697632 1.3304013270906425159 0.66552460103153432414 -1.3647017117914652662 -1.3742609272876182835;-0.29843948086050398061 -0.82445854194368217716 0.049278667344037352382 -0.0033380820908198269477 0.75768038251127400873 0.85232118794400091311 1.6419833735109918837;4.6023818835361165469 -1.5820098038661487561 -2.497762250366011294 0.36508359850339644481 -3.4724387315657851971 -0.48944014797076129675 0.69449168826387686071;-0.025451960292403656011 0.12552145420869070813 1.3352086712360731191 -0.61777104624706735692 -0.98224615528546965759 0.084216300571063648639 2.0775844515960320003;0.39293027601379265645 1.2451293570068537875 0.71448403798321014069 -0.31233119804112230433 8.5876311208133806474 -1.1800402021196949587 -2.2037882061211098161;0.94034282605065522276 -0.91984959403178967463 0.68267645766205131697 -2.3800379622007481473 -3.029548378801824704 -2.432776920295961709 -0.83663347531125298318;0.79108090982022372106 -0.39349845857693099838 -3.676022256095039964 0.73317631211900724519 2.9693947266731335333 -0.92598519264120804362 0.49656593609244092935;-0.61156840129769263203 0.39003825594275298716 -0.055415665949868783691 -0.54637120212954426446 0.092085173883463822264 -0.63262513457570401787 0.3836837100759505903;1.078381558472176982 0.93465103552163242284 2.6710568328030919183 -5.9994348170561737632 -3.1776651588670605797 -1.0979637962604456014 3.0434687580314334632];

% Layer 2
b2 = [-6.0150911831087832127;2.8611402768960174647;-1.1348431603874107321;10.070033148726528438;-0.758864409205005086;-5.6379327275736708103;2.9695487093934942457;0.7503847497716843451;-0.060053643761987123006;2.0953063125966946423;0.78240755644645731959;0.097635571294196338288;1.8175886331242356864;1.6978826712564552004;8.9643593211393710618];
LW2_1 = [4.7412919253408292164 0.77209673826455871293 4.1407779237328776745 1.53080724892697706 1.672087225171956959 -1.0424442143017764728 -1.1025047986117721965 1.1635528654534506021 2.0536241901940930354 -0.39233016615865562438 3.9420463371644367534 2.5380256260177311844 0.58975235118744651075 -0.30310566927062770892 -0.39296180687462600734 -0.33179864010288129261 -5.2584560885633733207 0.022529214112661302694 0.042099955606114215778 -3.1258060633150734908 -0.63362442284093045686 0.68844351512182599961 -0.69367260166582067615 1.6847572555959029472 -3.542082159361335858;-1.8152523311505950332 3.1221619140947254323 -0.20334522012903727406 -0.12740095777245480368 -0.37411776944034702552 -2.9697185218956199115 1.1305184729605874949 1.0670492012069150434 0.34833244338459007361 4.0209151619644627473 4.1624388015068491953 -3.0260725527218323982 -0.86079702925604650865 -1.1954240910410174337 -1.1489446725281375894 2.0703005927904278849 -2.5394080173422062252 0.26468610308471529624 0.1674439575580822237 4.3438080046900129361 -0.85287164690370076414 -0.37899546579624432407 -1.1513622983056175375 -0.87587976710480364151 -1.0675609685123306214;4.3224582459916103261 -5.4902620472557845943 2.2519243666940096382 2.3427622742921974108 0.82940355294077006132 2.2705974844321352712 -1.6218801607001867016 1.9220751695203699416 2.6154115732230884817 -0.040984164247779550361 -1.2126798105891682944 1.4961284987450642614 -0.28565533478019911051 1.6034687514275545173 1.0250806417310376339 1.4218078470126467305 2.9761388729769362449 0.97825438803004693966 0.037088379099924420612 0.094937858875774813749 -0.39425417580933869166 0.97335358946747929654 -0.43310616861739598127 1.7247368092134605089 0.69261888939241578189;16.670171303535273211 -8.2173002070086766935 6.2965981019418100217 -1.4597349604988658633 -0.53763403425345268616 8.2987962338491954029 -0.77123917884328752059 -1.2007014933912454335 -1.7281953851713327541 -1.5853742892234934381 1.9466465043689469283 3.7251771730327800647 0.14551514519559599625 1.4826682911021806799 -0.16714054490618290849 0.84530203802764947163 -2.1393444842105875381 2.0829426646642121845 0.24419204635286320682 -0.62575230117366897886 1.2880809728419204685 0.95375567384233284063 0.19808254252141752061 -2.4141225578121776607 0.045460163460414981795;0.051867519021333650941 2.0692814035489663915 0.59109971046200937561 0.28759203874254801736 0.52826737673254986483 -2.4070108290879583812 -1.0215861847660390183 0.60551296936999288167 1.3807652294682206673 0.028758323749473343328 -3.867392747672688369 -0.58854377006801639194 0.85496276264055592886 -0.49586934898500245605 -3.7195017122020890277 3.4181911673292488807 3.5984720774245899655 1.2977287309693130712 0.094128363341081516813 -0.89650673956737425563 0.018306465603951865145 0.60673931704575834178 -0.47426131941652965862 0.12518308138659481332 -0.53007132814298907331;5.5165318514653609583 0.8575480680742803008 4.6855216029742381423 1.79408527835717857 1.6361704404746921782 -1.021030992476650967 -1.1048683376249297527 1.0995450255402408057 2.1645365623805425948 -0.51584982376318344599 4.1917078752237539874 2.5121664752002677012 0.61786349620211344913 -0.28116564606625427114 -0.27397652426620605626 -0.57168553428479307321 -5.6955009862544141441 -0.065915115179704372728 0.036895265036426136418 -3.5268846739201529239 -0.65760946002653752895 0.71244320391604876175 -0.77390239369801516744 1.7582278442882166569 -3.2341265637180027781;0.95042754834710696521 1.206553946711961256 -1.4634532374235100782 -1.2486637925220487322 1.6333239730458128935 -4.7727544746865593339 -0.33628446954110374767 -1.9398895295238658409 -0.41909769512849165407 -1.9304554166954608352 -0.70473813592947509576 2.3517228395776350602 -1.3014978711375089215 -2.2742798916299697964 -2.253934502301900622 3.6221920182740241501 1.706888748002238998 -0.49022306773342422259 -0.29949303252300002454 -0.90540938707299400967 0.029333116414745036282 -0.42216937467360532432 0.59909787713049400537 -1.3636884750793303311 -0.28543795008977829175;-2.5407980711044086952 2.9734483140826730718 -4.1374836921713633586 -1.0523814513670699533 -0.26085794897725089747 0.04992841273433006738 1.2391737447196402577 0.99067336582526566158 -1.5299810288055888385 1.6281311189596714417 3.7681009924470831862 -0.22580807511448819369 2.0118957941542325862 -1.4686429155243976297 -0.49603919506831917197 0.82180528649773343375 -2.2501597552343963748 -0.11430411104686988288 -0.10995685252349314542 2.0263282660257009304 0.12101038364006425074 -0.44955078305608808797 1.2226993792400069339 0.16473287101076128369 0.26647122591004052117;-3.0147927315976574825 5.0528990520844301315 -5.0528168794437178235 -2.2080405821293038748 -0.55127922171065146806 -0.87665420553168005302 2.0264088684770440452 1.064734608912744962 -2.7390893797482536165 1.2501383305024991177 6.8858446085717961438 0.56279004992401548968 1.7045696218630728147 -0.19489543036131473652 -6.445519584044931527 6.6155353276164801102 -5.1406835392131338125 -0.22077086594871697667 -0.14278984058302621185 1.4080268828994788599 0.37586752067409340272 -1.0062141383506881809 1.5403777630561279466 -0.34339888035987714554 0.51117304980639199918;2.2699295727078339091 2.6662480012904650195 2.0218159950071750153 -0.72224090029662368906 0.21363585918135200026 -3.2794960026722841384 -1.0106612957549818699 0.57474192620648101304 1.0282612059548381644 -1.5755079942700900286 -3.7280050870889245296 -0.26248353328518453376 0.40834375662803595874 -0.084148278225292458266 0.26376186848564925347 1.0511999469068131763 4.0930809269355323821 0.12055275688078891105 -0.11013163677977894084 -2.3886344629350300117 0.30853174923617632253 0.5348323487875104032 -0.58725994346927590239 0.20230298484430214723 -0.63534823509123394825;0.90377941385711524358 -1.4265210824617238217 0.73736494891577464283 -0.030946030150803272019 -0.64309016489253678639 2.0483663865102346158 0.92889707122274933759 -0.43358092329930353337 -1.0376254680934449137 -0.39677473706961474686 4.1264974984072981812 0.41793579907214734037 -0.61324016023316807456 -0.0025662701137239888292 3.786670075196573837 -3.3994399442933294075 -4.3159357243269598214 -1.2327794670705063407 -0.10938866576996947311 0.62652893655176900012 0.091280461705234558489 -0.58115818880830960591 0.30602410982542360696 -0.13942292188806676423 0.44869927376010848574;-0.42164112285829635773 -2.4129943207244211045 0.57482861527694462112 -1.0271499687616532093 -0.50955572781955216222 2.1582152455839143101 -0.27109246459811647822 0.10214744650801815817 0.24458010470691521343 -0.49312793212151645461 1.2830456372389609232 0.11784716164110570213 1.2164582946779005646 -0.39392471768321485337 2.567466771029166317 -1.6705840774783213831 -0.35351762158817240378 0.25051305994179323688 -0.14919634028263153991 -0.48597232185937233595 -0.29390492647815702476 0.23447716020394926417 0.63212366860214208586 0.86162194171790373876 -0.11277267371159839515;1.0916832711730013461 5.0909808691016635862 -1.5402514766921382439 0.48620748443076949874 -0.49136454646950633585 -3.6588944155725919849 0.16210746645810167332 0.39578573324352284146 -0.46768906584019453998 1.6089878791316158946 4.0668010475709843732 -1.0282004990256283783 0.3382018504701914674 -1.4143436506026350052 -1.7611201598973127425 -1.0733647070444718441 -5.5903735288273042059 -0.35032063586931228016 -0.16539269392570404849 1.1031903053997993425 0.069930531412892016352 -0.0042987078105185035776 -0.74243052202069581558 -0.74672528488188949503 -0.16592109074461067197;-1.5520775829611033192 4.4673890747839228865 -2.8792919048475460464 0.81094819071224155671 0.90043382865083454458 -4.1776090331923318999 -0.47320186844046147057 0.67712112331538987231 -0.091642982982101023337 1.0650636570851412799 -5.1674795427090094435 0.22267209111671157351 -0.31131924251472298248 0.81141848778939451581 1.5264731564622384674 -0.53576505715957212228 5.9143356865344935969 0.11057777830148073084 0.29206806648221778078 1.7600619007739628508 0.020955545462664523781 0.62200552049774515684 0.5938717715938980346 0.068401399535081022774 0.23735007962746890176;17.630956666080603412 -7.6044310114012994006 9.768246970389906636 0.62814762276250735162 1.1931676951012339938 2.2962565412617461647 -0.4027851252311482888 -2.1767204374735698025 -0.60594995403667173406 0.2578780664080246865 -1.8556906125697307797 1.6552361330115936688 -1.7714679321969630799 4.2945269252841207219 5.9766597540338404215 -3.2603603768038307287 3.7577426742698496476 -1.1436929930708896741 0.28631177340998259506 -0.085486389027612214031 -0.39541568170395108295 1.1135982107579354139 0.83780447581394390522 2.7359969413418872008 -0.15780540678087209838];

% Layer 3
b3 = 0.24722956635010637227;
LW3_2 = [9.8883241403145483162 -1.19106272459844309 -0.71637079740788445203 0.13005919360815818009 2.2239915533434992945 -9.3400646752472606948 0.57678521955383743602 -0.8015184086036476474 0.32079390454414730138 -0.66931703200690162436 2.476832794510450686 0.79074958727396027491 0.51522961566438563175 0.54700968462808929882 -0.086017804797121469318];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0415843642790311;
y1_step1.xoffset = -0.9;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
