function [Y,Xf,Af] = ESPER_talk_8_Other_4(X,~,~)
%ESPER_TALK_8_OTHER_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:47.
% 
% [Y] = ESPER_talk_8_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0584431850247228];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.757413528579471;8.665055244396159;0.90826172424288565;-0.17371247425911887;-1.5251744843304575;3.7951391073305643;-0.35677244169672023;-1.8022516442111485;-0.50202352198243905;0.3784202077733938;1.6699996829064332;-4.5388558118099738;-0.42648442873685255;-0.22180848638273232;-2.7005122803107371;-4.2099687733674358;4.9596065641959832;-2.2780365169220236;-1.8541810651153998;-3.0157291982155083;-0.64810995250818115;-0.50550287286949436;-1.1814836403188167;-1.8102587003235069;-0.43216432583018555;-4.0529930810619801;0.40550743728861882;-0.82489337899301263;2.2043097079066785;-1.1940208366141536];
IW1_1 = [0.84430933523136276 1.2017194109845548 -0.89763526479993017 -2.2583415079419815 2.0063017842007937 -0.42678954673127661;-3.9757134519264445 5.9729653095539321 -3.1841599039194994 -0.1455605599184471 -1.0177043005554498 4.2951498859919273;0.59702800667418876 -0.1611503781009698 -0.78008015351211468 -0.28714570555270663 2.8344215402856161 0.80397862787665786;-0.2413197518936499 0.32758179053012942 0.73462074675743538 -0.16547460353116103 -0.90151739656613783 -0.95991610960141982;0.31212483234309601 0.14892277308887 -1.7529029075011731 -0.32350558592199863 -1.474329915461067 0.018115432333341779;-0.67505836322236845 -1.3366051013025275 0.23356050156103558 2.0245256350127629 -2.8771848648962615 0.99788594314835022;-0.22393093352085955 -0.16003074072229156 -0.016772807549322821 -0.33630709330858072 0.71148676834264768 0.46554761177842691;0.26442515178205422 0.11464962343162174 -2.4549573851295721 -0.30770310002790957 -1.753516323085446 0.0569269295769868;0.86729389957389058 -0.73576887267243818 -1.1604935459882033 0.27799717802502061 -0.077432192179724024 0.80207324919873035;-0.20525246632732638 -0.32785438000286637 -0.24069841874021347 -0.85651476652889413 0.15797901413404042 -0.33021088559946499;0.085737047125925309 0.11457279337280209 -0.051650984627748316 -0.78667455210005277 -4.101347915660762 2.6512031706408905;0.23093924244404979 1.3306821860421874 -1.7366313470808747 -1.5297050681836397 3.5516851126184208 -1.1629169787147688;-1.3956294408677259 -0.57520849683825326 -1.5925384312268485 0.055067940882486288 1.6080195443023138 -0.41644822186567843;-0.44684060976329476 -0.24504354742389817 0.028482561288777589 -0.91901490931914254 1.4255997510236458 -0.49733850604715207;1.9573875658697164 -1.0412014112819881 0.61743403469186253 -3.026533249120098 -0.079769953961147971 1.0039309839723309;0.19947728320374497 0.3906201816675553 0.68044143962030779 0.86583668543555481 1.09415397661601 -3.9684929411117227;-0.032800792616431415 -1.0228090174408282 4.0680696171418864 -1.0536527773950153 -2.597342044202128 3.229252840185949;-1.7072585467485595 -1.0773343149462347 -1.1959049594017399 -1.6089363173985656 -1.3002766411395497 0.011575921149313094;1.135197883081724 -0.4071302508922654 -7.4690019799674392 -2.8126778838153994 -2.9018749400473873 1.8712867272257292;0.61828146432330777 2.2535561980431398 0.42016138550693172 -0.21553180452115628 3.9240401197425574 -1.4531495259786689;-0.97089986708353504 1.0184767488307434 0.052397594635638617 -1.3475325299022571 0.80246373716704111 -1.5663192507580157;0.037691796316835273 0.85527024448799427 0.2428479838499682 0.56239906434213172 0.033266191196277786 0.64898070081475367;-0.88292797164902848 -1.3877933095525758 -1.2510914992986002 -0.416603493646032 -0.43070860627239549 0.90507446730697161;-0.56411692474480224 -0.039573061210337677 0.53564464216873398 -0.91844072378452846 1.9587114497592808 -0.5095295137987591;-0.61447652305364731 0.23208877301629302 -2.7134968879089101 0.71391447510410366 -1.8909065524616469 0.11001421931544231;0.10982985617821994 0.2623940357230804 0.46382507480934021 0.85619756973646943 1.6478169227813573 -3.6319679510713643;0.3468157991221037 0.28853532020850681 0.037112105715555448 0.33309784525619368 -0.35254658383052589 -0.71706989766631568;0.17152190734237088 0.77502274864919363 -0.28158508763928275 -0.45749640825656418 -0.60556588482526696 0.52050898561521175;-0.56878728880426188 -0.93358550755425451 -0.62265452630314699 1.8945856537209307 -3.8940146764008361 0.56789171520871007;-0.75413889363410413 0.51616475243911009 -2.0925456138815566 0.72957902019301668 -0.17883337167501326 -0.06163437616221832];

% Layer 2
b2 = [-1.9703835011116657;-2.1873089643426162;1.460783093163835;-5.3100855939753266;12.091022451761779;-10.085333125035357;2.9559362482682041;-12.425153038923794;4.25198085291676;-0.089921261704526967];
LW2_1 = [0.63666049859123186 -1.25500361190368 1.3537114715526106 7.3580422580660994 -1.6529949593693609 -0.21804761254117785 7.9437257660474287 0.51002540996420287 1.8409634439945364 -0.021584972565218699 1.1552348238377677 1.8709652784563531 -0.21074492180658264 -5.8351036520940092 -0.34234813755485666 17.411340080384601 0.16417462053991652 -1.3881814922867131 0.15615235700438956 -0.40670718990575394 1.7943504831296344 1.1204114576597393 1.3858057303268292 -3.4919010183857555 1.5141802270387366 -23.989003343739046 -1.4643247135396489 -3.7252610302476135 -0.066321122125035437 -0.95878659120531284;-1.5532555276640643 -1.1048150203449014 -0.21261284347395201 -1.5757010082773835 -0.63305264850483201 -2.9816482626589482 5.2102161499922968 -0.61912712331246056 -0.24706435672000177 7.8696081834853659 0.69051226459418147 -0.76946199465166276 0.23936951305711043 -4.1962685163246398 -0.69184401086463987 6.6908882148269688 -0.6741265843847134 -0.014539403072505921 0.11554681925178016 -0.81858290933576083 0.6669393599568485 1.6769546982146672 -0.60551855989679637 -1.5831169364322897 0.49313703016660904 -3.9649027738274749 3.2813141261326502 -2.3541605177254734 -0.31175465945776437 0.24994654182788167;1.6375611319971413 0.5865819040678526 0.6988314191232774 1.3394574962349399 -1.5028626842108093 2.1365744317315731 -7.7389390757644936 1.257919303115145 0.8551174892614537 -9.8920598148437122 -0.78776901153318291 0.5720359737487668 -0.082386632045907834 3.9003867945494415 0.46502971602254545 -1.8777558426033023 0.50923612362062698 -0.21410067979071926 -0.12918394193765267 0.25740089396525934 -0.091366566527115514 -2.3236759053539902 0.81097451301630463 1.7314036288880001 -0.68432399879470374 -2.649061422073745 -4.8903272641525612 2.3991246941363391 0.25682924460278611 0.55085646240787367;4.6086702055409612 0.41597750504816422 -2.1944435040253869 2.6933537652818345 -5.2826501670944124 8.7915324128365224 11.299330959084555 5.8943504333678911 0.37549967663922407 -19.479384295468694 -1.5635827051870481 -0.075358206512063639 2.3502220471379056 3.9033942499282532 0.58663488027590105 9.4151560655986302 0.62395216022242705 0.66784319974343342 -0.69372950612250528 2.9659901339911277 3.5291237787516025 -7.4335337528965431 -0.80481278534149647 -4.8605836151467505 0.69457158305510325 -19.663319000825357 4.4743620734968195 3.733610101851621 -2.4460172725935734 -1.0430226136939444;1.5498330098363284 1.7602226482845869 -3.8601318628498409 4.1418198785781639 7.9957472013607109 1.4853413413671253 2.2077932165768424 -3.9183284575416999 2.2143016834315055 -23.234610560956476 -3.3472736469334112 0.048182047740334986 -0.13010724471728538 4.1898726383283647 0.079132887783582712 1.589741012239678 1.447000713162635 -0.44766491009650283 -0.016858723203018514 0.85891410194775075 -1.7913589895895519 -7.1601412545334995 -0.11073474916205732 -2.2059750288561109 -1.4424958361951827 -14.376904137665019 -9.2374712238491359 5.1756959613685547 1.1350549282891012 2.5060567603431574;3.5403609117603825 -5.5652309184662103 3.2180469060905716 8.9878655442954454 -20.488987109749797 7.9997625867673259 10.005560200147892 14.183855683020065 0.85166278917199523 -11.471275900173035 -0.24974614035922463 -1.2840227071154331 3.1527312139674262 5.3581842406462359 -1.4000009074121169 -3.3865374347925452 0.75559289889373937 1.0265246432659454 -0.66736215586585024 1.010612795829491 1.8797727373419659 -7.1496839767282161 -3.5989471808127642 -6.6723798246077353 1.2256152453608284 2.0054007178385298 -1.5845172529231624 3.1357643082507654 -3.8948560842928401 -0.78446428517084144;-1.3387523253343003 0.8156018417427453 5.4868869864043619 -4.3338348152772355 -5.0814475108016595 0.59988846930988404 -33.290592317562123 -0.16267024065596156 3.8435050851144203 -20.410283372690873 -0.39098870554149862 2.0850695654033262 -1.9407544273858399 14.699428779196243 -0.094795276862166586 0.37662657227503399 0.025015616944634226 -0.8492030754347849 -0.14665732032265374 0.25282945718438904 0.25501003633784963 -6.3288877189242356 -0.75458506636264666 7.220707269421446 0.80168684312841176 -1.6572863824551827 -19.572796601212179 6.6200787723354564 1.8137917459823181 0.78134964098432724;4.9480247107087623 -0.77361160213514446 0.15515275217098004 -2.2386717314286422 -3.7711363810037848 5.6354454837515577 -12.453538198122716 -1.5285525030886273 3.3218844217150467 -0.57627681585213186 0.96828967143603151 2.0690766471651134 -1.8867825432299423 3.4765030075294847 0.046886130887522567 -19.368824576949521 -0.95096681774335445 1.9679182055794819 -1.2818182713353354 -0.25099702196641055 3.3846870909979394 9.105713695820512 0.027362095151946597 -0.51947926340969475 -1.3582175672896362 7.7280272292039092 -3.4117592483365757 -9.1302829628139524 -0.87064438718336057 3.257816002760006;2.6628723761348869 -0.85059548172426203 2.9601473855041118 2.7799623102591839 -6.5851515174779598 3.48741567168803 -23.648635644530994 2.6279988407712018 4.3358180348647961 -20.719145352396893 -1.0025462397256715 2.5695465389588414 -0.99165409078044198 7.4295937267697276 0.96258747963050051 6.7776795189848178 1.0291287903300517 -1.0391349731686539 -0.4851938694039119 -0.092211446972451025 1.3787040194215017 -4.8715386311323856 2.1838229051794698 4.9037317537316518 -1.9011913953654105 -18.097692980023549 -14.583751845463418 4.503764032706072 0.56505171922013031 4.0780991105278366;-0.14576939239047723 -0.52644913838182517 0.82628758464684138 0.76794593810133049 1.6191487671688907 -0.014225790560772262 7.0364849374358096 0.72353231154429976 -0.57211260705161804 1.542072611447864 0.81886797761644481 0.21259219143843641 -0.048482830370371592 -0.82554524645010974 0.053316855629704216 8.5903512629825229 0.023984618432865291 -0.19366255371489474 0.22286920906675353 0.29117318166655992 -0.36672266702495937 1.4857497649697857 0.5962450995084192 -0.67072956009533158 -0.34532280069001436 -7.3498284845222051 3.9510375374030646 -1.4911673174465481 -0.27378139506900256 -0.48609907420517368];

% Layer 3
b3 = 0.82176074183677184;
LW3_2 = [-0.15088403213142054 0.62108526887410254 1.1175189916279031 0.066850392544849979 -0.12177462752330834 0.037549682261644408 0.11286944327477094 -0.075995139922625451 -0.12858122756083643 0.45019516392579728];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
