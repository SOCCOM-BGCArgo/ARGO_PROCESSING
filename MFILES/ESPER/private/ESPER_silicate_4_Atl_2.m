function [Y,Xf,Af] = ESPER_silicate_4_Atl_2(X,~,~)
%ESPER_SILICATE_4_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:39.
% 
% [Y] = ESPER_silicate_4_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.28];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0470499670650231];
x1_step1.ymin = -1;

% Layer 1
b1 = [7.2287963510640009801;0.3123118418869118007;0.78080368973134217647;0.2833730504823147589;-5.6018195909359702611;0.95383400200554169235;2.7493462773533381416;11.953931073154043574;-0.83729323165508673377;-1.9905486740444373606;-2.0397922859710462262;-5.5101251616308886128;5.2871395388482484989;-0.069569902642145881044;-1.5168114956619473954;-1.9599707366974568057;-2.0281014737184070995;4.0499174724316286955;5.0818921234234526452;-1.4159307120267352609];
IW1_1 = [0.39786369818976058399 -0.60730508335068156267 1.2932875414526758817 -1.766024018591069833 1.0914926087486083173 -0.60149244421230418922 -5.5283661800045180712;0.039214528295201632468 -0.070596703838424756938 0.11458333814985498245 0.20996618314408649342 -1.1475617513380733659 0.070416334647028844262 -0.21390350746978026297;-1.6138203177325076698 -0.85696875043700238006 -0.87519325681568704844 -1.2680694533485392661 2.0791071702343342231 -0.50834865301493048495 -0.45056586943777338083;0.051503409025260946108 -0.07524571598295108632 -0.03946441571744098431 -0.93892665267646036042 -1.5329710392859676737 0.086590950781434056216 -0.53441950468777821293;3.0208488494211813702 -3.1646645278018086245 3.9585463424245088682 1.4281265313548101581 1.6505470243304805056 0.26622559738553358555 -2.8007790623991928314;-0.10242093365387791581 -0.14148811370820305044 -0.25034005685404830954 -0.83911914486368266441 -3.3045869607020992298 -0.92884294347479945397 0.57557234293906200939;-0.31562005613034194162 0.52839274128830204802 -0.21959570530921532217 -0.31459202930947011145 -1.8990755146731499448 0.93424512565962147814 -0.12601509854753678574;1.5403312819737586814 -3.8940896422778048525 0.93372918789053460653 -2.8618080282644484669 -5.0808743876095894265 12.01132927061125244 -0.14642157274949987866;0.062142119897921510585 -0.018959508952009700156 0.064146615577440085909 -0.83814847399060266042 2.0913404965425077542 1.0064122942039728237 -0.10581196498381731375;0.081028234927902051399 -0.15849580608847493868 -0.047642609548296702138 -0.84256327878418535438 0.31361493112160554464 -0.10748889941847381002 -0.32942514267078853996;0.11007498044845458185 -0.18362671707811759059 -0.12283351752528916256 -1.3780379276721939075 -0.66077630733115277906 -0.056512323574349397626 -0.59557790435360469239;-0.048108015085923980236 0.04639768871141724399 -0.11529337669997939686 0.076094181509642158656 5.8681936348981924567 -1.3567472882304323356 0.013185428429813164999;0.030220984734245819742 0.011049092770952137141 0.03911312681591399415 -0.56262961014621326594 -5.9249252882746068494 1.5268776452373786778 -0.090838393677567033646;0.036292880767363387695 -0.060302907856976915857 -0.27052870338094148206 -0.78180383309000678338 0.35223717052665443061 -0.4280250137079557593 0.73999025078073099593;-0.024826423332705380848 -0.16348266738492003847 -0.26371822198267441673 -0.11383741684748689693 -1.5766475232228722714 -2.3207801805105465753 0.47479953711710315423;-0.33279132407741729427 -0.2343665859735576118 -0.27131106733139687126 0.054507989916306502642 -1.2943087947861302567 1.3839264675680182926 -0.86175277197428035159;2.15044692944864968 -3.6300565477776403078 1.800586369689348043 2.5621681189544571744 -3.6555217515705704656 2.8369848319867427833 -3.4880621687186770252;-0.60389379825300693039 0.61985952953619105621 -0.19490513174415818876 -0.0238149481506945912 -3.3277663629236657883 1.3087671212680405119 -0.15486450091774114912;1.4035096009881640189 -0.98691116860693217649 0.7000257201900076387 -0.9099743803823434618 -1.3629027042254648894 -1.8979330461187302603 -0.30695866137261024198;-0.18515706285318275781 0.43502798520435725926 -0.31994737504305775788 -0.72835308229356932053 0.69475972276823805274 0.10570976656853187103 -0.39950864311229405956];

% Layer 2
b2 = [93.224852417365923429;116.58137232362962266;38.637914066815817193;0.12243189007398834478;-153.48299751071084529;124.4945777939118301;-292.62778212433829594;1.5062944874187618183;154.75616224830633882;-26.550116516033348546;-122.57280723333131789;-29.496068039754110401;178.70649257635082563;16.460744398460334992;-133.20245217990924402;74.1425635523901434;-25.963116692459109913;74.736369638189884768;96.541622824795950919;-176.1705484245899811];
LW2_1 = [-162.20726514005392005 40.266138556429098116 18.162857228667387943 21.321974688451955871 -0.36352714141447994844 -31.586705688919220592 8.9624387280212793883 -35.561608525239343237 7.2556725916851787517 19.658635793513372647 -22.573095167883646894 10.421551962834781691 -6.8366649223123268087 -12.36240014180952862 -37.237658987601619742 -4.8543990940824652824 7.4995895151798608325 11.745910956273840853 53.921384150460184514 15.092176457481219387;26.078975339867653815 38.821879263015205197 11.15269890182872814 68.045163743745561646 -10.938717553846437625 17.197606378011478512 -36.229729351659685221 -64.962986250166210311 2.7219769689006048097 4.189123571325710671 -19.290915882825959926 -36.771622992407444031 -16.436804556639284414 9.8071120670193678848 -14.735613728721371984 -167.71303112925588152 1.7842886784293865432 -21.681373020249512962 -2.1472449828562583107 -20.536418418607187419;-39.984374443142272071 -3.1212193777054952903 0.62246577939340252961 19.37687449765252623 -2.5605444214673269698 3.3002608761110874269 -7.4600028267535876125 -38.239549322409224885 -8.972754977540416732 -6.4893723861007792664 -11.252218062185587399 -2.0813135523970958118 1.4215777094606012465 3.1892800705627930569 -0.13011944935310179594 22.832517825345522766 1.8433187763412424154 -10.473361654378859242 -6.434753213329768684 0.1586334259953701975;-5.1840571133251769353 21.329673294307749387 -1.8775827880303797013 7.7830870053273324416 6.1533710963270031868 -0.16973709848707171921 -7.861886703117228592 -0.58286246773452388137 1.8220337297454629599 15.55635207275612153 -18.906832076642142937 -3.3330553947448970931 -11.40657995406116676 6.5670104814760028589 -0.51382262584079596568 51.342674015630059614 11.980398061437476542 -3.0219129394901145247 -25.010764656797562111 -4.3232842395213380016;195.8665945925625067 26.38782911919967944 5.197534113025372271 -9.4239701878099442212 5.2834066476895946707 10.998888887861735242 -29.089321709150027573 61.466917380375207358 -38.773178937864720695 17.905719640106930513 -67.795363742463450762 -30.549248099313032867 7.9370374238475100981 0.60592243085629371446 171.47694253806974984 -54.110108760047957333 4.8080442795688851376 -28.102610477251527499 67.830296098687554718 -48.916844424810541625;-46.836432625476689395 -0.5827776204538941407 -0.045409172301445810405 -10.426210409572789217 0.80152218960351229171 -7.8103229695864682114 1.4278647549112075676 2.3755797328301793137 -2.5366548476806998202 3.433902491950543201 7.6456143409805203959 8.5454841964262087117 -2.1894151227033309404 -1.824665053607903209 -0.68732529905998651643 -58.036807828275712495 0.77374006638414272174 -0.50753494202759075193 -4.0900695203829631197 3.2509205130738298983;29.739362906976509748 -414.12151865728776556 11.940176748958903019 167.44565719355162514 61.659425547545119173 88.603760738242883122 -94.878928122894507169 116.22051487362659827 -171.53757918379005787 -246.66437652977347739 76.552191590212956385 -84.766000964018090258 140.98792115136978964 -14.583015345033038201 69.898129663335396344 -298.50177735954815716 -35.749139421979243991 171.18627475265276416 -273.26193871659592105 -129.20134573904459785;-23.056189124105905819 -16.911536058510321823 -0.037165092439883251618 27.603551559520102643 2.9173765453289051131 22.056229181104878734 -8.0156886145485781725 -130.23417295132290405 -1.2942204965929766658 -5.7511704953013591535 0.19235798200363196653 -22.296349840170766043 5.6383066662322613993 5.3531007747747008096 -2.9206772151467448317 105.05966572536355841 0.18899595935896840171 -0.27896490033468784864 3.3826686711467428559 -1.084825936662433099;-43.13849932681613808 -83.509847067282677813 5.2544292643751857597 -55.914491655438716577 -21.334541822993038807 -215.3179368156120006 -63.095074290802024564 136.70248663027379621 -8.335095576335859846 62.772591611128575551 -28.472786828506954748 83.619469725775516622 -10.023565825789276573 -1.5856771082991369948 -7.6380196056476235 -368.85293117971792753 -6.7652918102288701618 32.121418176779584996 71.748322161692257737 25.64621336299433807;-122.92229588240287796 -12.173842201816421849 1.7561404542042624577 15.404072073396918086 8.3776590480960191343 -3.8126084596552414219 2.094973601864464019 -4.4886902352231619062 9.0914304663612206525 -2.6779684454582532993 -7.1158237138008235689 1.4478434459974283133 1.7002352094059054455 -0.6899073712140124659 24.423611564577161204 146.52975884526827599 3.1151321542409142751 22.038069605315385502 1.5375116461526867617 -0.65570180103701769525;-2.426376737168841391 6.0253075877753170531 2.0745443096984375053 -60.249303363839715075 1.5006377354399742519 -7.945557928220977395 -1.3795107041327308028 265.71924474140558914 -1.2468448235206257557 2.3742659666821728237 -14.521557300345161678 15.017492911069199479 -0.68630261367445088982 -1.7348053827290867979 0.58551776948040645809 -66.759146945912092974 -0.29003968574208022213 -1.0564281481036510435 -9.6822567278330335938 -4.8987466144617766162;-14.085772742206380315 1.0094924041575916718 -0.37238089059104995115 1.4354520655222615666 0.76440755356839085177 -13.45431743893288612 1.2690034630709630115 0.7603686937174922722 -0.28350206704612590514 -2.6584302480877126662 12.303617644784788254 13.583449698660041705 1.3710196807950407738 -0.0047655669562531310923 -2.053260116527646062 48.682479935359026513 0.42755226637591237093 -1.0948686088953238915 1.9800062486581548882 -2.7860763912375263729;-114.02459314517680866 15.684646222283941341 6.5366058037527352553 -30.677930319086904376 -53.654244987025727198 3.0144030114637985207 -31.460386842565871035 -12.915920068905922591 10.629860180677383141 -36.485788638279821328 40.523388406046940702 -36.982999104904642707 -21.780915234020284288 -23.152162467783906408 -57.047465144004448234 -174.29448405236149711 38.725973927977264566 -40.306873010273584157 130.16511799260788962 -66.004175196855058516;-91.816669286796496863 8.1944692320393315299 2.6915842661951119297 -39.241312862528708649 5.1687817896264611761 -24.588775311905408216 -12.397351662603471212 -9.7866930803774998537 18.973286115355016079 -28.390463006576325711 11.089638139612112866 35.05532945343075113 4.538945483071151088 -9.2142838446925416918 -43.931936810844014474 88.057280713755901047 -7.1322936432472427981 -6.7694969898306505129 37.035891497758036905 -28.50275516064543524;77.963448262695976609 -61.506274877808145618 -0.74125948273012887135 22.290480586391122841 0.056114854467535509042 -4.4904525427065165033 -19.557288223971323049 0.054103000475694169868 -11.741847420502889321 -83.39475553374968797 46.693593003063412539 31.595915246564665324 29.248507833403930789 -12.380734319584302483 -5.4103226880071142446 -2.9001633251274658853 0.54519609273969749097 5.6239258865906318618 14.69304568219142304 -14.231396969943247655;-16.018882886171201818 11.91728538306078633 -3.4948183219115143139 9.0162615192786130791 -5.6801305078468935505 0.52572144089566841263 -3.6243287743831937853 -0.6473090247389867713 2.1595706869849013998 -6.9316214905105670852 -8.6223508019004242442 3.8235557059205129704 -0.21104501491475113895 2.2143723177266325663 -1.4403578271811539047 -52.693091563182349546 1.8566859210348316545 1.8522575554437736844 2.0824966109603675335 11.921938819973000534;0.61026411346526276969 1.3820624445566116467 0.63676863495801561132 -9.7804558051566719001 -4.4489406280286099005 -11.059454277780364606 0.11124398106997010482 4.4103136921228029976 7.5557339791073392377 17.929934714530798345 -14.074178483556487151 -3.6399075369080602371 -12.803358532534947045 -8.9720811376736691045 1.6282435616401726985 16.722392406717016655 -1.4974049402987699153 -3.248180467173886754 2.937489033151144735 -8.647905036779119925;-43.272908981652363991 -0.12620034643824470932 0.62975766541016231503 -5.4685576558092892085 -1.3683691581363430778 -14.708326565786943974 0.77327515412132841188 1.5854738069445948323 2.8732602849476407414 -5.0730513243415904512 19.387583208494362452 15.762210234261564423 0.90777660585507957691 -6.305300914384178057 -2.8521051051066508286 -23.448342315545112058 -0.16554756647376303591 -0.097393862888109861142 11.553292078611406168 -5.3194104364512035943;76.624037630668269117 -7.2358981130272725935 0.18813447303559671653 -4.1122257110986222273 1.806822325500454518 -4.8188772407813864618 6.7692959635923166672 -65.761422266948116544 -4.3581669678527061862 3.5344115822369408519 17.887431817542871926 10.729334041127170707 -2.2732855222798100669 -1.6316666302208855388 -0.23596020171242626517 -96.125540723481464056 -1.033921306101798443 -1.5219822033877545842 8.2395997956584139388 4.6128624856443165569;42.862344042922813969 -43.079940086716007386 11.811826453221669908 -22.491987576971482099 0.5503810107393665163 -17.218337302153727819 0.27994849102012242525 27.048735239609246861 -24.032501088035409964 -47.019097999846579228 -75.734419262346222013 40.635967399688439627 26.129105243419985527 14.837353523232106767 33.352458920828688349 148.99401307127547511 5.1380909508816241527 21.889667860823337264 -32.670327019841622018 48.92877387305915704];

% Layer 3
b3 = -0.86728871429384601921;
LW3_2 = [-0.0043175658048369338488 0.042583978170275434139 0.0036797787814293269303 -0.0097862916219762369208 -0.0017057044399546275777 -0.087114981727941895318 -0.010982448386543591096 -0.0067722254881768841062 0.50953007622188783987 -0.12993698943306064564 -0.0017480227673604296565 -0.21903522547291670586 0.050703700867295226073 0.0096909212516378528263 -1.1740031313505705501 -0.051328426540393684574 0.022729990409292577525 0.14166899369842655965 0.10964722328423114062 -0.036208690031317297686];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0145232735458572;
y1_step1.xoffset = -0.52;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
