function [Y,Xf,Af] = ESPER_talk_16_Other_3(X,~,~)
%ESPER_TALK_16_OTHER_3 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:51.
% 
% [Y] = ESPER_talk_16_Other_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014];
x1_step1.ymin = -1;

% Layer 1
b1 = [-6.4139386086210308;-3.4938865082602106;-3.2424383911322372;1.0127478468029354;-1.697083528157304;0.030596454002750594;5.0562845189095471;-15.753897573632836;-0.82455274218078611;1.6689289147947546;-0.019849368578144518;-0.47504002449549532;-1.4139423007545882;-3.0082972419794092;-0.21534838883961971;1.1671469040281135;-18.339127435692046;1.1372351521167716;1.1320291177173782;2.382991773243905;3.0230642442132449;0.10214855829418214;-2.5609314767172027;-5.7897015636474443;-8.2534799221222013];
IW1_1 = [7.4209781860638167 0.0068983961376817013 -3.3925417058091307 1.4083173496435115 11.522227957662022;-0.69398084124142623 1.8581532721941927 -0.89479787515544906 -3.5201894867169989 -2.5942794992454803;-0.48401033061239629 0.55495221162190245 3.8665806906258093 2.0382023839409262 -0.54245390847353792;-0.81343795619633152 -0.18914807694537183 -0.51639201878515217 -1.1798905243739566 -4.6381034387116911;0.75840287657222261 -0.75797085202641035 -2.2108777184676081 -2.9563786187564629 3.5291749212752905;0.052622005300605609 -0.48843274824918931 0.0097987138087562917 -1.5209608896105682 1.9659558046656216;-0.65876557299436722 -0.44639332332551662 6.8027939194199547 0.33583618505252844 -0.29884732287590993;7.5403346422646376 -14.169360674412848 2.310003588871302 0.35673465424212081 5.0770576971819894;0.035874596133491067 -0.66964349445089277 -2.2392474700100449 -0.27376596147664389 3.6733649513315938;1.3395760748411611 -0.11035074082577119 0.057051111727748037 1.6231296324467512 1.5701261882611324;-0.74895046374643559 2.0818653077828464 -2.9024155723871665 -1.1537137660054979 1.8153298042358452;-2.6744491677650202 2.148437084504589 -2.1361784389922014 -1.5562228653029002 4.499272084194275;-0.4291669214710172 0.81216034011016347 0.10269279318306937 -1.5487615006157249 0.94882833620062768;0.16189173568985341 0.93207884969501043 -2.3322946598734862 -4.4673114394298672 11.512576481981631;0.013628044505785886 0.15525708051835038 1.2905258069995291 -0.35624513170452277 -2.161599797476828;-0.046253012136756373 0.16181100039591378 1.0543612349566738 1.873760102907335 -3.5583615409544183;-0.057260992050256865 -0.19950985243875177 0.39051119697228326 -16.326363116490121 0.33712171083915937;-0.052881147066514277 -0.60914648094048129 0.26363108117437906 1.416850733089658 -0.45329751660785911;-0.077287037833661129 0.18579471184991581 1.0751781426176732 1.836028344375561 -3.3480576130841162;0.86788541684281251 -1.4934749426914378 -0.96297225991032853 2.5183126450577671 -1.2792347343364365;4.3665717861528677 -4.8963697497578647 -2.9300359810573977 0.26401534456037501 -2.4642482607626093;0.34902709012342165 0.047089225421591684 -0.15914990041700644 -0.78001078275416125 -2.1140871754961137;-1.58290359097522 -0.51192306596712289 1.3589948045359879 0.57091787121544169 -1.9394216604450751;-1.6498132870407951 0.4756717285074239 -2.3599235431179841 -3.2676269605773225 -3.0962684915512311;0.04485634006541446 -0.23455168666412221 -1.7138471786976168 2.3681424349378233 30.340197942090885];

% Layer 2
b2 = [-10.724492674340434;28.948524908509977;-38.997451715285351;-22.963621306566786;-79.743983638162263;-0.68568147555168679;5.9281952775917972;-37.384704849744331;-30.085831311715225;0.11517217717892698;-59.763156494321265;14.429187013171701;-9.0919730118668696;-29.335718173597932;-17.508779887714592];
LW2_1 = [18.935111331077714 -41.496577169566748 20.024912370618207 -18.714935575670232 -53.922634923864237 -5.5489123656544184 -0.85629704055042444 -22.605393671741233 16.135867614002098 -48.65873171643522 45.778528650937226 33.938397318642622 50.645794880417654 -82.155330378647093 28.868409177540027 -0.49300793654154845 -20.0625481708073 -56.259904329173011 -24.512981109866914 29.514508501699925 36.928849726875029 53.392865930781745 19.819519594536278 -17.283662614371472 47.194316334684224;-15.481020946817997 5.2367084536102819 47.716337071555188 20.834463374400929 -18.101755548864926 -5.7756506133743954 -11.257075445469622 -28.716308598184767 -4.2384057623781057 -1.9485755446698678 -1.1990933032326114 14.349305224178774 -28.915454852480543 -2.8283336787387889 -57.1279279512733 5.0802859975873647 -0.38555869464422765 -31.215218955998274 6.2907021579257929 -21.864437237706493 22.68338644362473 -5.2786475368973225 10.032178740889531 24.536081654938521 -12.648500099673548;-27.243645391207231 -12.678225847494184 -10.069461799132124 -0.42900474921788173 35.644305556090487 16.23868243439733 -8.5946078148340277 26.798690156210412 -11.43396176754128 -14.63072391683022 0.91862940312164743 6.4353498805902687 -50.73066800711797 18.414735086587488 40.266990234895076 0.56344101945951719 -26.118902688844059 -62.415655329368597 42.278025942350432 3.9979990381999992 29.178702864307475 -47.4903072264133 11.818439367832319 -32.658373891016033 -3.8195821132356604;0.20509250219005787 1.5709727003335963 16.814149397945137 -41.275060460401221 1.7356147422997299 1.7775157699814685 18.38767427161488 -15.016340985331269 -28.780682411387712 -28.192488967542719 3.0096956127419379 -16.655028157471349 -65.894483682472199 27.755790735966372 -16.324642168301505 -3.4867789224255561 27.78367384070696 4.8448005309697795 -6.311806598435612 -22.037859822800534 -12.502718438769611 -60.649445248760443 9.5395836323853036 18.561183179280537 12.555280325929841;14.214372825724473 12.718559461777842 -14.860878338385888 1.3784002468735808 -18.34464448052077 10.035344142100136 24.764455913563719 -1.9262595925448966 17.417987222299711 -5.4761157105581866 -35.645260903143296 16.995193743782281 -53.247070534314489 8.6041869678336145 49.838014567513973 -26.800494711390694 4.3229158162983596 -7.0812205372992585 0.47453821838522292 -23.153612388776352 3.6085007856626805 -27.723737739842484 -1.7534756866252676 -54.897694608573914 3.8248463204573682;4.5650488567431626 2.4109881136616247 -1.9457230265219292 -12.108700765433253 -4.0296814621858275 3.8684354179197333 3.4549340015879748 3.0975168363091266 7.792388279113859 -11.440937958360172 -1.0940555146693371 3.1179588479518396 -6.9916367854796722 12.357323747553387 -8.9122146714675026 10.404885050345978 4.9400858090082043 -3.6785800782689817 3.3850213554608777 -3.1702841169804783 -6.1039676615779781 -0.38338128937192045 -2.5172211178620669 -7.1820934208782186 -6.1716929297460723;5.6274423636219613 -42.939358593257666 -5.0528841209437472 -15.955070447288882 5.2161628986028949 8.713897132930466 -2.9142321762052963 27.474328660239177 3.8341121526074229 3.0852963180635169 1.2995149232592962 9.8196851748412968 6.6564042816372941 -8.8528900932936931 12.361794114569951 -7.0238625841820372 -1.1976003819639276 -59.415681808470779 4.6743497276996848 17.789500279364638 -7.6034523561256293 -12.247743710655651 7.5944256281273681 -12.540549359733568 -3.0234457661561542;23.038699488285168 -46.626258797010699 59.327169993546399 37.97090457512266 -10.505729516428675 12.344120990272149 17.759691112155515 -72.09398071570142 35.318726038097161 2.3713349983579444 -2.6772151935547344 3.3780246340350466 -131.72937096358402 8.5792576015037714 42.835499214279501 -34.002033145769623 8.4179620456189639 -132.93026223955584 -4.1528145078912182 -29.582907210090031 -17.500401844907838 20.009360859423762 16.664866637332345 -7.9339779732887452 0.68878070276557524;-5.8184147591852593 3.3715521343913406 29.178116899637441 57.080890697593716 -23.2790241534302 39.55402544011946 16.778926058389207 -4.6563105484573093 -8.4961024521614643 41.220308138814325 3.2158698772307024 24.926097375037742 -86.098992797436892 33.79990617000206 -36.159947042174586 -19.799733189772244 -13.015232492513702 -41.197156846822914 42.569944384323669 -50.426229503084834 21.689293017380187 -83.826143862535261 110.87011615705096 -29.148779567598694 -5.9618726686163326;-0.03697451799499496 0.064641908137564888 0.089109163351786688 -0.32559291500935517 0.15660568757523535 0.44314632771946538 -0.11795942054881312 -0.16329345133714199 -0.01250033861498339 -0.14169901694775985 -0.07438749681419618 -0.003899054357146214 -0.89420037634578986 -0.076019161830427617 -0.3299645463409982 -9.558251598740366 0.34837344721974861 -0.82747136640687313 9.9327316405908039 -0.17161702603537718 0.058718063772009471 -0.63964715057975552 -0.14534572599391854 -0.19723041112374412 -0.14502300852966685;25.707947743213737 -87.814841012599672 10.262792071649379 61.741826219078973 1.1500134410325524 -36.510384090151248 29.86869035858777 -4.9688705336580945 -0.037804507128516844 28.101646658427544 -11.982148265343039 9.6451102639226427 -45.83103122153225 -8.6354169432008785 -7.929978843990181 8.6651468446061362 9.6180842693686266 -19.746802080597057 -21.769057664442933 -38.269063478644824 1.0353152785182784 30.52808673171161 4.8407205266980453 14.650059188373822 -8.0474491768098524;-6.7511226879663653 2.4959514443253048 1.1034834375813518 -1.7614462636809136 0.26776232671375344 6.1040920880591027 -1.1036153105603792 8.4863550736255444 -0.15279721189036197 -6.2879945133239037 5.0287373214270934 -3.7597288207406181 -1.9001976606672304 -0.21233400034220493 -6.2126601943986195 -5.4501460073105532 -5.1844820338786413 -8.8815119247952818 9.7511481534109183 -0.55257201037784054 0.25737820438175202 -1.2982929321405157 11.710760080800165 -1.1252642815613545 0.89177650690314048;-3.7000666782653688 -2.0088468793771304 -12.811124956977048 -4.1517121843994076 20.29590909802284 31.405465756555635 -5.3168581760304665 8.3832671762565489 -24.181498084166236 -0.11002947627175499 -22.187664969004455 -6.0963852008852557 29.539018233148866 -7.5561620844508202 4.6483904511039071 -14.740448257769099 14.252435493689177 1.5915376074908199 15.670145983559777 23.857317151886008 -1.5611119394408692 -9.0118855808506915 -26.097826741235277 3.5708727712851558 -4.9089833469625246;0.33867614097566773 -1.618197595584935 6.6057284284560964 -0.54741159426747366 1.036254395005914 4.0881828070538777 0.34535773969403694 -0.12171253322901902 -6.5901733346192248 -0.87041740887157981 -0.048790235110224074 -2.4209445594486461 5.2212938244159464 4.2056730135065283 -11.882677457620135 -6.2965880145905446 7.3185502658886081 5.4335903064412348 11.572210535503562 0.24891359170091801 -0.80266481993355721 4.1859370286514093 -7.5267055197945121 -30.006173538926944 1.3253840020916061;-0.19235190345343109 0.48714793115449323 -12.389161532520747 -2.3905967709396552 -1.3632550192675279 -4.1540419038150009 0.50396008766148781 -0.62115369471134518 0.94957092626942186 -2.159467012498693 0.44769439859650811 -0.3158756932582848 -3.4736326354190936 -0.29595682003858154 3.4984703871243643 -1.5329556751727833 -7.6375272510376471 -3.1181035638134835 -5.038567281362754 0.24331300908197451 0.12193113531901584 0.2733023649262552 2.5553171925612195 -2.0781610024474531 -0.62657111624970963];

% Layer 3
b3 = -0.020423252576690604;
LW3_2 = [-0.0024355993576609431 0.016195952523182299 0.017232359731731435 -0.015847952958996873 -0.016396149559448635 0.019384373278945117 0.0092865133658078924 0.0080686141343863302 -0.011710418434150579 0.84306112201319283 0.0089344772636047644 -0.023329558546643279 0.022917423149870299 0.060050467756864664 -0.17137259195493248];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
