function [Y,Xf,Af] = ESPER_TA_7_Atl_4(X,~,~)
%ESPER_TA_7_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:02.
% 
% [Y] = ESPER_TA_7_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-143.241523403244];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.00458552991639557];
x1_step1.ymin = -1;

% Layer 1
b1 = [-8.684759080260617381;1.7284916047405616268;-10.535389873343387279;-6.1370834295335612296;-9.9132979114493195993;4.7727476933671040271;13.285956712258244039;0.78951357713571990171;-0.67780050624037202489;1.3363456055204512296;-6.3840315127699343023;1.3648411713246106913;-1.15700794335839241;-11.132138075528004606;4.0385743012636785565;-6.0516349033933085622;7.3179671792691962651;0.84863040815654666726;2.1051474160006917735;-3.1017643182418481729;10.053574778334725792;-1.4192359191921388728;-1.1094207230570520828;-5.9185720930858307653;1.385799298159935411;-3.0473733829241003157;4.0104112752533902508;0.73605369002055887062;-2.2023262111839385646;0.49867861574505989442];
IW1_1 = [1.309637031190885148 4.2658918017071831841 2.4083474882475917056 -0.56945495972364001958 10.946965453352886399 10.456319164602911442 1.8128854357864589986;-0.72699206789074322099 -0.43931517204118819553 -0.39317317197583473432 0.21253244018296538198 -2.1524886669970335618 0.68135537516696254023 0.16957852075625923227;-7.4641495991047079883 3.5298016971177337275 -5.1898176132831368434 -0.83311496921743277699 8.6042929917920147886 -9.3475568997896338885 -4.0020504100029423711;4.5958635602102502205 -6.2717302174322195896 4.5040357600451974562 1.5695505393668969241 1.0575409628978027499 -0.69346731111665194103 1.1512542023130105662;-0.39846710432663517976 -4.7171188863577322437 -3.2910052908044162834 -1.8920267161747570395 17.647664491803883635 1.2666516048197176136 -6.473562407225683657;-0.19476725307402392717 -0.070904523964993304563 -0.11386818630672036756 -1.4671001487270760588 -4.8129410556562319812 1.6861086233469240181 -1.3901808598902645198;-14.866025952154528156 0.62827518855645114737 -0.69364610797210746185 -0.26383596692293703745 4.1923255686180551649 -1.5311983109834683692 -0.48495315463854704596;-0.17835679231953696644 0.22752227844722822114 1.1939762013457915213 0.15410377129927543827 -2.3223123322077738884 -0.38099648700023308612 -0.33392408807251516834;0.5008970298045304359 0.0013691104859576272088 0.20761728738695589547 -1.7126580392997285962 4.66975734258994013 3.2050425621077134331 0.0082863992937019671087;-0.25797952987859318341 -0.059182887240243453597 -0.40539768380355450939 0.015911526739867492414 -1.3366862547266822325 0.28716980029847816169 0.067248365424254871736;-5.6828319793260995141 4.8032625063298608481 4.242728162722615437 -2.0952926526690833775 14.062445858017849076 -6.0481809937656834109 0.46140192333468743602;-0.18099846511262987492 -0.37449147850815467375 2.3630475372065378181 0.51266293289195774552 -4.4825767877507711745 -0.4447476004435528818 -0.62156722564886390803;1.4109851465966449791 -0.87036704093029615414 0.86133904827382001823 1.0119369035323406703 -1.2717102920679819178 0.37205577579752630024 -1.1449750061438452864;4.1040884325421336243 -1.4515870398520962503 -1.0848828316011882578 1.3405745868139760102 13.618831101893224655 1.0860379473066099631 0.69558435225672388125;0.8950330772938782653 0.81738066572011724986 0.26250855171642623054 0.85920862420395827108 -3.1848141780829863912 4.3278483880570854936 -0.25101682756576193523;-1.8173388812943644943 0.18043946880460995374 -0.13667281648816911876 -1.1221123603887763753 8.7752030857702383315 -2.2341441950380636072 0.077854601936783091043;-1.1525638282874404172 0.956383331764845801 -2.722763045251570535 -1.6850414456197924107 -10.748065823401990571 1.5726050174764643064 -1.130594565454983158;-0.47307897576478930013 5.4026814555611748503 3.0358196420440535235 -0.9468489091428712312 3.1376833406319453168 -2.3446517879957649022 -3.3735175759333704271;-0.76547736613822203733 -0.47986020513979527058 -0.39866698155131585768 0.26971352785358526649 -2.6011642243275181485 0.79819473109122673904 0.19189186788156567531;-0.068010931854567288624 0.35573019655236320924 0.81782711011708675297 -0.36786886044670968898 5.1902704342907686197 -0.98267226676461261192 -0.67424188733994605549;-1.089336413952959548 2.4346007232390109998 -4.1196214591161481877 -3.0694030894156298928 -19.621805282106606683 3.7016930249776467399 2.1979696257221688072;1.2838885212153858806 0.078734232962842903847 0.16742633951472329912 -0.017369639613361451125 0.91927151172566934356 -0.29962478389183933025 0.19109931165240226503;-0.016585651022152519268 -0.59547465404556310098 -0.65062126967323730131 0.027384791960837543551 0.59696096801781883823 0.39516840373920208984 0.25139727274926770839;-3.4503331426056851328 -4.1802960892143694593 5.2187001136229609344 0.10047368628531355705 4.6890188011847397931 3.447193568661013785 -0.91358874770115305886;-0.26991304139280020147 0.66566696549387793791 0.50602385930747362242 0.0581959889469924746 -1.7410990270243320577 -0.11091405881568712488 -0.20041885966709671596;0.31199527154946105068 -0.6077077463422628778 0.43686261747026444713 -0.12285393186504869889 2.8385726989554442845 -0.55045677765459455344 -0.042632359198254303478;-0.17391411694707414881 0.10133611081587196034 -0.079723410764948821061 0.98669824406118200599 -8.2916785068747245191 -1.839472062616808623 1.0542443091632702767;-1.0192529390664151201 0.38497816298416631664 0.71453855320918557847 -0.15827969066517924568 -3.910644241092449569 -1.3502336229971980686 0.8146170745217299336;-1.649128638788250889 2.3454907895373553472 0.14227492384240511547 -1.3214126264469092664 7.5310191015681553495 4.4605855542362053967 3.0521851944586599892;0.70133470301829481386 0.21327870364803783176 -0.15022832203447544774 -0.10428830759497728642 -0.89909506626694946085 -0.10341387875486800219 -0.011057850824234665907];

% Layer 2
b2 = [107.38747565594336209;152.97048529223530977;-6.1047463383540367943;1.0235116348634922812;15.533140166868085075;-10.736753161543724389;-10.187707531117435877;-59.530215640740927086;-1.6046070200233595315;-2.5207468899532070594];
LW2_1 = [-8.1578643945044788666 21.52739383842629195 52.847724383926880876 -1.5864452876769365997 -32.115855648628205188 -26.631039049671542784 37.007281606036457333 -5.4992547090089729522 1.8886883182744163001 46.16320381893945779 3.4463538694134596696 6.576708392682178328 10.279122226005435792 8.0602732750475141188 -4.2234424283083056295 3.447714305941026236 6.6682998780457722887 -6.4720744574993522846 -0.83412586305234326378 -11.952124903017562474 -3.7308477267482058615 57.315567465236739508 7.372398532690030315 8.7572696445646442953 -7.9324705489312705708 0.5559893909479051155 -15.990165149452424842 42.555484987400419072 -25.614935765578028537 -40.842719872817923488;38.804206802685563105 -7.8308769071955230956 0.23467101754013899861 -45.813132136496768965 -30.798619234132058153 183.87411662368737097 68.230238394833264692 -96.323915294611168747 -4.9861829256451306591 119.12069659385575449 41.042191310013258487 29.991209173130883414 98.143971449851065358 32.831443874562801 -2.643138559530652465 -19.284419686539894911 -48.035677057900421971 -75.262728504459389001 -52.187752095608871628 -17.773313447611844396 19.601603326248088877 49.70523483753439109 97.806867391503232056 -2.2555622919397508852 -52.115279307909908368 -59.933168871383095677 71.039358564492005144 -97.801354211646810199 90.627895622042913715 -44.037292865511830087;-35.183460689661387732 -28.746333819786435981 -8.6207733167544500219 -0.015512547508496173782 -10.708939151900128905 48.539347106338375681 -8.7072086388119451783 27.021641819966255582 16.109723643984629859 12.513912757440756707 -14.875120050669689675 17.000619656007444291 -21.992582383025151671 -5.7010755018043841602 0.73865724516990893811 -0.95831814266091608356 30.806812968804038633 5.3531494271294066678 5.5495432758540150786 2.5394958717140014848 -14.793095782475504052 -65.221941626963953809 105.12136193699249986 20.802514836744702365 -20.690434370527068353 -39.701851053264896052 0.63362071030397149052 -24.091708013249487408 3.2796220490485845644 15.227240087436099358;-1.1401353016896016435 -1.4284177366277908128 -6.6813202945568583857 -6.7018059706400778808 9.7982932746903035337 8.9645918176605050576 -7.2081938453071288109 3.3478823741860987973 -13.892652086174665627 -2.4037355207824160352 -9.9993777455318841874 -4.5903212568782842951 2.7452056614739510643 -11.755458934817447414 -5.5206307707584629796 -2.3193568995560727153 -9.2204476953461078637 6.9282823688495973613 -8.0548121186885133227 -11.257216819540637687 -5.5274463044740276274 -2.736657030948324909 8.5657223284647283634 5.0446583365800705678 1.0038818494208905374 -14.270305479522079395 10.829683327156578443 3.4863325929484059174 -2.7118999239740673168 19.556341120114833387;-18.181289740788265874 9.8714404915757913983 18.736256965599828561 1.1642379587416549214 -1.9112809118705993416 15.112731785282750963 -3.8127738945278548677 9.369211292042361805 -6.2829141637927863329 -5.7743034189245037169 -1.4719495720116866355 -20.836573424994220716 10.091490476902896134 18.942382259868978167 3.9410106714751629298 -20.718727394805011244 6.7098178034913882328 11.238001158476468078 19.537158127334780744 3.5684061571809060354 13.630133108541910403 -23.770526819918078587 -23.220214884757474749 -5.2394384489407013206 -11.174022411955700562 11.865090481461493255 -3.1900759026715848066 -11.000230428205270528 3.7022128213189677837 -34.151802845687818433;-40.825756899053494919 9.5028353287831723861 -4.2617456482724422884 -4.5011667654705833641 -13.847203415999652876 -7.3341668976070728547 23.923119056717858655 -7.3361196188422264086 -17.726121611898438601 48.516831922803490329 -29.324885603252070609 -9.2406080672737527237 4.8184654692004222909 9.0361747378227530447 -4.497355592344977282 -4.9064608998907512927 -19.344259856733231118 30.405024753099425538 23.956907636061270495 -13.25675871745102441 -5.1069898340890560462 12.428112691433579329 3.3440254924584804641 -16.726228831686452025 22.312702610648610602 -9.1092324582228041407 -2.8269236693108927838 0.4176483525056607915 -3.4275937375453180422 3.7227022718595663697;0.80426448613381473773 -9.8669115901909218991 -1.7768229096501719777 2.5632059315881146055 5.6682264545587868199 -4.1465669893174661453 13.06187662763608337 31.402913410138566519 18.590854473255038926 -10.923993961696581323 8.2762527851924208022 8.9094460771617409733 -9.8183002940076757881 12.272708044362621749 1.6794778662098788224 -0.49111257623854259746 -6.2438038716752650714 5.3500129964909959313 -0.13209614840249092604 10.271763243669225218 -1.5505664148158151416 -2.6525695859772588925 58.262503893616496953 -7.214744887621721503 0.73078030548982098047 -29.507808457128195556 -2.8615536617065546743 5.3547048391549125768 12.793696070124429554 -0.26733407982364282285;-37.228787369801501939 -8.2263916548702376019 -25.948443311917866794 1.3454457936716235356 3.1313705674522966937 3.2715461068140099243 0.84339655476694563863 6.7678226270678303322 -3.8152010720951081701 8.1974481970763530825 5.2721187387630426002 7.9039772861792956249 -9.8812139128666505172 -3.1554727371069724029 7.5228348079415372496 -8.0025094382459460718 -1.1212071066398492381 0.3021711654467187369 10.607517794688689605 6.3318974815659254674 -0.0079073207493095924725 0.038538856711089308771 -0.65009071816238817032 -1.5601493189472050993 -19.249834600244618343 -19.845682734583242279 -4.8698101238054789519 7.8615321465394512046 1.2675498115088319473 -7.5523858239927870173;0.0064657489325140610897 -3.7339718520142879399 0.04368408360928924955 -0.020933513380098949658 -0.075225313920275344026 -0.22046813361114050989 1.1223027093663768827 -0.77155012418664215001 0.32273735995856167591 -3.153559612777647736 0.035557344543938718129 -0.3802542757227503345 -0.45726468327238350975 0.073348270382514110799 0.0078534892787051786833 0.040145409998686786002 -0.0103560888295170829 0.0061456202885908708944 2.1424211013895813061 0.10631338548713069325 0.041409223383143657637 -0.99402084795320322375 2.9662363680543566424 -0.023033576046075546206 3.5007499747271042523 -0.92782051420154376675 0.60070601820617497424 -0.94723902870491361039 0.023532699518333248523 -0.055212507171909258608;0.037785645994402629333 11.299220344039746067 0.10758153038460170625 0.0029801824653337156273 -0.079894005891395503127 -0.2733946672427713942 0.9433896162643427008 1.6299768612747091989 0.26718341293868835828 -7.2018097517128776275 0.013280690240806346594 -0.84180069801308754496 -0.39551787330813548138 0.11132016929320255605 0.044464051793567306581 0.19828508333128189167 -0.088307052831979856999 0.056812898440642307929 -9.4647362062302118346 -0.61054347158237487481 0.010766474361191574749 -1.6233294935072677401 -0.95172351337111760206 -0.053384241725893760711 -0.73338899450306027639 -3.0789418269746255952 0.40983772712616689526 -0.82315789243351911164 0.048714337587625507198 2.1829694114478850331];

% Layer 3
b3 = 0.40460825637540354105;
LW3_2 = [-0.0012760847812544862633 0.0020341127831345392346 -0.00069185861007384989296 -0.00049308913770284472713 -0.0011445726374016880218 0.00026823481292034405702 0.00094466206124155206129 -0.0019277741381943525999 1.7347992936099139172 -1.7118057348597461864];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
