function [Y,Xf,Af] = ESPER_TA_4_Atl_4(X,~,~)
%ESPER_TA_4_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:01.
% 
% [Y] = ESPER_TA_4_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-1.99149636107278;-0.12];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0604107502911417;0.0145655815308426];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.21010195647442228561;5.3628526392353261798;-0.35520664842134641592;-0.29295306785073227385;6.3588984048687517969;0.73439938678280292095;-10.638226490592151308;0.18562898634759092409;-3.6721241294186626192;1.5372557048978898742;-4.5087937805939395375;0.2456975056853952788;0.75007110712258939778;-0.73775254861011452245;-2.3510402051864351947;0.99606096216062123272;0.78336235714431401433;-0.56007677060340477215;-1.6328592903176746276;1.1259535460229457282;3.9702481474162714115;4.5884905872539176741;1.7799736348331494096;-3.8320753691881819236;1.435515714361702333;-7.5922775566324034457;-0.062091046928769426383;-9.7023904237700211439;-1.5735741307740456207;-3.5854417237827349574];
IW1_1 = [0.15062346563808950983 -0.13193530321711771647 0.057225865065687817057 -0.067950926814805287512 -0.20132041264099309608 0.51804033116284509131 -0.0013119519839994288161;-1.5859704925690163435 4.8272584315954052414 -1.3526419430474809769 -0.5124940911104944874 -3.8186837306352559018 1.3448229070731065882 -0.29010990678202930315;8.4325331679363486614 -0.71917305302147627177 12.590747809826032366 -1.67387033806769292 16.211735356602606117 -4.7490254727753864472 -6.1231729938788515;-0.62550667131966908308 0.65437482787796963368 0.1597015635585336546 -0.32117447315480651682 0.56860893124995670611 -0.021335795813070934646 -0.033555426402345718551;-0.38863423696487525705 -1.7274531184073582679 -0.31333587990591615924 -0.21010744658210167568 -5.7957225825973583966 1.4270718983643519984 -0.64387961455803999211;1.6616510788825222811 1.2725388241160022762 1.4785682253987242341 1.1773741331904097329 -1.1014151280261390564 2.0894886657169613464 -0.73372238270437029062;-4.7671949646271150058 2.8802096409188173709 2.8881094139900107542 -3.7752807394875613767 19.242452700671051957 -4.9976461737875235158 -0.97245159987182738792;-1.738115464981575764 0.51711175550955656988 0.1932006326510593841 -0.37804703357194080482 3.6227098708157638995 0.52863337674928401189 1.1835710885240766643;0.84649097101657699849 0.42836458153018031059 0.044805779818906099621 0.65235963760206472362 0.1181011616930242869 -2.1890268721558241438 -0.85668385358051590828;0.086659919843252122829 1.3797187082802566671 1.5918882102219509278 0.61214590779910871277 -1.0473823180504029384 -0.19094790099569278197 1.8594591812537712983;2.8673801490836501316 -0.22839039780580638883 -1.8975876799546314011 1.295765158012838425 2.6745730929347777405 -0.46626004290325012702 -0.13127315629507335659;-1.4199003013406403806 -1.3318728040911105293 0.83989812430434951374 -2.6402319348343521455 -0.70623583226853015038 1.0029684486410568311 2.8931432547484789986;2.2428519069628638505 -0.40797736118839128538 -0.90533855640746141447 1.2955621125646636926 -2.0719103427314382593 0.4660997669845812208 1.4354173446759155297;-0.72930020564888609069 0.56585615713954351413 0.10029862615069556897 0.74319739491145841992 3.6525075504242345836 0.16151934999061495768 1.4221038086227746344;0.16027003047254279045 -0.46912413676890757364 0.0070618486699245523741 0.0189098120892013076 2.1368400812305514691 -1.535778808101829096 0.87836280895992102646;0.90066848409442767931 0.99983786989090672748 0.47474354589175504771 1.411969500570733338 -2.7067225043099836235 -1.2093029432432225168 -1.9112206087368752705;0.99806564181755785814 -0.4384979177485242019 -0.29403659080486505006 -0.29408025822541311589 -2.2966861320981868388 0.68638019228325530818 -0.20354094665895791638;-0.21708600580489145759 -0.45015338022022799436 -0.35990924500086268756 0.46003942714549084236 -0.2620606745433087803 0.065403334489312167643 -0.16538086852661629256;-0.5883361581022334974 2.2187021989715280945 -1.3123491439999463992 -0.50133397155879044771 4.6149414800660588654 1.8155210446172846961 1.2139180017917454713;0.17460339880823094738 -1.5710051161818561205 1.0711899978380061693 0.37812574557715838974 -1.8939588471991062324 -1.4970880353230131554 0.036493043133579615434;-1.1666044885537603104 1.8492510218569646607 -0.29090404509284972789 0.55399306033395634419 -4.8432720966993265677 -0.73322125980858854355 -1.9675961937326607032;0.49803806264144512284 2.3067273605200755426 -0.48678165853404203878 -1.0661884280104638734 -1.7960052900996870129 2.9176876601857379967 0.61538884024140005913;-0.507364867648997242 -0.039548866731264009644 -0.48717879981510520127 0.83545587174791202667 -2.908706350476402136 0.9173889705804476602 -0.49737541571331844725;1.4783292560067649024 -3.6533192722181531131 0.87570054329855107067 0.44631910588575302024 1.4121660722645845709 -1.7222779464150781426 0.066147522772756192633;1.861898646135962565 0.3262186530244188809 -0.49244400906780227967 0.37427256265031128013 -3.2958526939335408557 -1.1749009328480439773 -2.5117290328391348453;1.604394936358690904 -3.1941661474421567668 -0.85683064472703585057 -0.77858497497332179726 5.6220873747847432966 0.39534452539565784202 0.9577576214432729218;-1.3371125646565422684 0.28609496487085056549 -0.62962103549478831699 -0.60304940221068925599 -1.6980497218743779708 0.88558088552028502161 -0.040786523594555701422;0.68839484388184557506 -0.74414015890174711743 0.38028723257412572201 -0.026114720640198537532 10.608503451723253264 -0.93674042386991773768 1.1452612022900121591;-0.54591073217169705512 0.23025160579245454451 -0.52695917024062777223 1.9663687167837564651 2.2745728424051696592 0.53194251707901796244 0.2545143118648370284;0.31271980716451019955 0.33405694897068022309 1.599268368297655396 -0.77909932359215494646 8.0222345620697677049 -1.7524817753669612586 -1.6383804755721622648];

% Layer 2
b2 = [0.95074601736622477155;-7.6947064694389259998;5.7443593578986513748;-4.2165744736022086059;1.6218179826495500162;8.0196050956442963553;-1.6623755791548693317;0.79856712215143821343;-7.2661780036844554331;1.3791518826228847949];
LW2_1 = [1.8177758791491454016 1.2454150441021050177 -8.514794143051037878 2.2675807100281524242 1.5420474896650411267 -0.27633079179642761058 0.26075177217150347087 -4.2579165271127283887 -2.7867250930108826701 0.254893005263039929 2.1338112014610595146 1.543341097954576302 -3.0555351353072426335 1.5269251341616496553 4.0597892688867558419 -1.0886917879180195712 -2.7407176254558480721 1.4531203897968547611 -3.7138718000838051303 -3.5828657552557641175 -2.0038266194344958038 1.1403869510479602845 3.4830761390220805751 -1.4759271012294947756 4.4118917647658051351 -0.66721216559360629894 0.10292215138247004513 -1.7743730747737112008 -1.6081364298170701677 4.1571032258805722392;-3.2911519807169806739 -0.56033681593824924416 6.5658865098111780512 -1.3576045985877249755 -2.2725866771232570152 0.21112004609059945026 -0.065144518221818076276 -0.81538210604031680084 -1.5454898937098036082 0.39735242922050528769 -0.05786424288565247126 -0.047388703516821978345 0.089336529310133069859 -0.32723841651210244796 -2.5147286260832393268 -0.59496905335952743332 0.0074747763694655439126 -0.92901808348284764527 0.3762243075144212634 0.29390067183132800865 -0.37903520367117021772 -0.54170408383817447717 0.22479545552726656887 -0.51470159463151210488 -0.36459530696103414904 -0.33933922373740532663 0.75887743864935297555 -0.16919558954098731784 -0.10410658028792622865 0.79431525882540487959;8.4891610443784681905 -25.715206726281365945 -1.8936441716763634524 4.3822319730346164235 -0.17564471651308982691 -9.5985891545433581484 -14.320327658212812949 5.7460337424098124615 -1.6747120622857560868 16.210945382379446045 -20.016263519502857093 -4.5745458019038656161 -11.378525255164893437 -2.0442798677891715897 30.944616933895737532 -7.7187805630257084744 0.59125900291883581872 -6.5393581983456359197 -4.6389192853577183584 3.5641029137124773385 2.6472106719293408972 -5.3040735727602381644 11.911555812365209661 -22.621344297067587092 7.4887061458655042046 3.2087628251527204881 19.078450892131172623 -22.076078688922763149 -2.4360392327322100137 -28.856839753833003925;1.6252860143751135524 -0.35768184549446302434 -19.268429913446318835 -1.6212978951686387585 4.5065682423598332207 0.45494650130224251194 -0.54160438084683626414 5.1308434126923359031 0.096087526206300871712 1.3271390378872116589 -0.62576678496957527376 -2.2061565429069593947 -0.35359802522163208405 7.4169180427934833233 0.42660310988843713753 0.42421608655236897611 -1.0260372390112686425 -3.070759150583440622 -0.45860152689157712702 -2.3767874886788051825 -0.053667600955853732303 -2.1463454896155176321 0.42477804553186487846 0.84539789472231086087 -1.2392219304046205863 0.14598532173360140307 -5.9058380008648034831 -9.3752923692957175206 -0.72651377166848851719 7.4114468624201146341;-7.4400356210665030687 0.82718179325826557413 -0.80108028455116597755 12.613731653012070666 3.3641278865865951175 -2.8720959676060098253 -0.39879735607667765596 1.7605833474018022233 5.276019848661943179 -1.3952920515628344234 2.9826073610633985211 -0.27055738285665270615 -2.2012254610837405089 7.2745277533394805403 -1.3851450967020257909 -1.8740773192277426773 4.1397259862766047078 -21.922969151694598366 -5.487660224658018393 1.7280524933161736101 5.1170940760789811463 -2.9343484664018002483 -6.7203248251041740602 -5.1975100405727872044 2.9296404876473269852 -0.58463660514039805793 -1.4653880032595871796 7.9422436485666949579 1.4871900698151507836 -5.8335694732291791809;-2.9083873368697394923 1.316473885546802558 0.14661035455961507479 -0.67959177348629862259 0.3366904321864413463 0.43377704523916144064 0.38741726447913199527 0.63835476125003820513 -0.018454586407090592393 -0.65805566686139838062 0.40913347966224272723 0.38450195766952854903 0.10403532519350361385 1.486830558276510672 -1.3994954664938936695 0.074118460082576803627 0.80308368334747715078 -1.2484277331847963843 0.8293665120972369964 -2.699763155060323605 -0.075200860409362413339 -0.10565519011234493496 -0.94698768654055653915 2.1533404518445409259 -0.31447975754970702855 0.94407740742060830552 3.3689613682147592222 4.7704470653143618009 -0.2653930162269965698 1.5612208519971302323;-3.351330973905730648 -1.410136946051678164 -1.7592712331236437517 -2.7694217532484075583 -5.1594442015181813943 -4.7891363382108522728 -1.6969580519165849974 13.668894441906747517 3.9717728387002293466 -3.6200618913379538633 -9.5062549196212380309 -0.64576314809756252266 6.6220365311017550525 -0.82190736537553055197 3.8465004721779503249 -0.44689018844637701244 12.693771526504393776 2.254138067990739458 -2.8753430354850437745 -1.2257739014017652313 5.2721653168451627636 -0.83591290977033261278 0.055056835805312724641 3.8999736225163768033 1.3042479342389614594 -1.7140555232540288788 2.0753151020192439624 -2.5296411089383723514 1.5780217928879545219 -5.0346787229045961709;14.202865922010984079 -1.5228806336891151929 -6.6638800265652315957 -3.0683230189993273562 -3.8147314971297108244 -0.49192839901601054242 -0.1082122276770639685 -4.0414337247250129437 -2.6272561794583961792 0.10459074221660294435 3.4156895297971487935 -0.42793584976066401104 -2.3878521765902238627 2.9418497472236859736 2.5410554746538789317 -3.0432508167481078232 -8.353948387874831738 -8.5191214631458507256 1.2256433230210488361 4.2348351217854851569 1.1207286728271816933 0.15272924199578685744 1.7912929115583775541 -2.0498605747583353853 5.6381196617429889528 0.85566724039247676892 -1.3224470218750894457 0.032381205752212392779 5.2416845287454378877 3.9005453684157913585;-4.6476447997324727979 3.0155109848056387278 -13.613242939815160426 3.8831615865386219788 -5.6235118206075451752 -3.3056583506967358588 -3.489580033894680966 -2.497953597004843207 4.5308647927220224716 -1.5048678927098839697 6.480226195214997098 -6.5363863802961628124 -1.0153227162616977886 -24.499485293465578906 -5.8753435989766913394 -7.1913124046269620848 5.6073781732355740814 -14.56679163432087698 5.5096689852495623896 3.1384654999369026029 -0.081391890242202419303 -6.6997586154281423276 -3.9337564329950187592 13.401269912386389649 -4.8298153197586151109 -2.6009607423650487057 11.134920218074743303 -21.972617982586719165 7.0443342622693911892 0.33838252919284922404;0.477193908793196786 -0.35286341106778845722 -2.8104883283801065375 0.85558586410445713888 -1.6430072980112540026 0.066517137412260382567 -0.26400258298779544219 -0.096135644571461884023 0.041930464651017552991 0.19812397423503261273 -0.33470502093871140614 -0.14922043916418961662 -0.22744946512254607396 -0.47565583399687832999 -0.62433823854317638258 0.15363143029009257434 1.190726622145541036 2.6993698269299817305 0.32471345020063635545 -0.043463321804429792816 0.12021553986304325812 -0.28920170284395724236 -1.4366183802160994443 -0.48096618440855148924 -0.46759772776306729458 -0.51606495797865681308 0.94968124924192753866 1.0644435041102211503 0.6940933508730361412 6.0858315000931071381];

% Layer 3
b3 = 0.25238162016610199423;
LW3_2 = [-0.039513955978558057414 -0.27014625211529574855 -0.0018772198374056598552 0.0040305509427488233828 0.0023535842286738781551 0.10349195973671480864 -0.0029257703917335469226 0.039160091191806425948 -0.00050571883978540402987 0.21795152166976256014];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
