function [Y,Xf,Af] = ESPER_talk_14_Atl_4(X,~,~)
%ESPER_TALK_14_ATL_4 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:50.
% 
% [Y] = ESPER_talk_14_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999999390765;-40;0;11.29;-0.2178];
x1_step1.gain = [1.0000000017546;1.00031699124092;0.0153846153846154;0.000310077519379845;0.0705602618858232;0.0479365703301392];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.7724477889361339;2.6712747396551388;0.06916245653442904;1.1857123690841738;1.5408987085424768;-1.7925763899696214;-2.0573317175928505;0.74989858272224141;-0.035543695198636642;-0.81746511362461183;1.2706146948161963;-2.157899289059694;1.550090447543524;-0.052061401378656648;-0.53288881772138685;-0.21937901950672667;0.92187862595921699;-1.5720147758058285;-1.6408863698769967;1.7216251726490934;-0.27889446306731602;-1.2246890691379291;0.67569153866450216;2.9258076060871381;-1.4411549379518986;0.7605265376125433;6.0330433473841909;1.0902342110260221;-1.7340566037982377;-0.88122147995898281];
IW1_1 = [1.314169697954455 0.39578381750532898 -0.62582414534703523 -1.1666651800346746 -0.22373982741122544 -1.2344165176567017;-0.81831430628792878 -1.1040491805655301 -1.9641717223373711 0.27274524283885049 -0.10734901634800237 0.59933961484477627;-1.3523210712930211 -1.593791282772425 0.26180743496543912 0.74711791517113268 1.9362200892698973 -0.5316968656605956;-0.923699625844429 -0.78708426085018868 -0.94447404205221264 0.36416415586050233 0.68254665196276898 1.0646065272879057;-1.8708869958106193 -0.87064182518718269 -2.4441313871815602 1.0870771746286696 0.40651807494835285 1.0211597676605422;0.87640181323372268 -1.9286397383470175 -0.051692285422183862 -0.26253047190463674 -3.5019847614979169 -1.4049541083527683;0.81157130264787858 0.55050868126577313 0.094942157804544985 -0.27421470720942126 0.77153471703798393 -0.85459219280946175;-0.83046549545056714 0.51726777598772788 -1.359760378571802 0.3826334819779792 -0.18505705193124042 -0.12843852701461778;0.41464929765426611 -0.33039189655770818 -4.0517293005690487 -0.97098347087528492 0.67448161642541304 -0.48388362089281106;1.7198880354846369 -0.061675130476520637 -0.59685393035347867 0.030936244684893852 -1.9774421664960244 -0.054023233408738547;-1.771495486656457 0.96787733028969825 0.06035319724668553 0.17877716869554364 2.0943549501774048 1.1182778941989673;1.7975694501774029 0.72148683956165172 2.2933733025302394 -0.85198591133488522 0.56709857000148312 -0.73717250057402195;0.32797731166519323 -1.270303896132416 -1.4619914043842852 0.74507065630095792 -3.6653690015619547 0.057809941997503611;-0.30113106350095808 -0.56007388255313262 -3.0789460737411853 0.19168991601854235 -0.36358815152077822 1.2518863067063;1.7475752861301861 -1.1921695248537054 2.5504956445743781 0.81385708616575236 -0.9145089571093904 0.334749620348195;-0.1299539272381473 -1.7237468149792516 -3.9266686112188847 0.031376077115858679 0.9437716443328521 -0.45327857594631432;1.0241377733037997 1.4943449143251923 -0.56168974372195857 -1.0034311626336359 -2.600153428646562 0.057197147196403425;-1.5933487446520822 1.7845348918084369 2.8396713164310663 0.60145842395725135 3.2379576913227828 -1.4669246633059334;-0.80992734008470335 0.86504102807826255 -0.28871876076862774 0.83241442611287586 -0.46667455603182378 2.9215297144706138;0.22941630669995969 -0.87507380000993706 -0.28523909190298502 -0.58039311409517158 -0.044711901155268463 -1.7212602601715312;-1.3872423210603837 -0.11570279702420454 -1.2256843577181091 -0.0060765164601610314 -0.79587863468997277 1.1458103836595395;-1.0377464077636864 0.052057385144634163 0.043259970701297931 0.57403472774394626 -0.78138991350765219 1.4725658370470087;-0.95296029645978364 0.52764749425405777 -1.4918680320096329 0.4617510042729055 0.02187926914042955 -0.013626854035697848;0.13085296788265458 0.10955842601743618 -0.32005912470090736 -0.49045242164729091 -2.8507231837734515 -0.27403155357509779;-0.53827178716174673 0.20383908610327744 -0.04740968366896596 -0.70399427992537422 1.6976687588184218 -0.77744053793215406;-2.4658741394449182 0.33911819382845898 -0.42918000871675499 0.92052197505954458 -2.8360496009865193 -1.1144710643656903;2.4650423289935617 0.99460215712925648 -3.4413936362271094 -0.68701934220097138 -2.9102470713584965 -1.9435906691063372;1.2818949841235341 0.84095522759598362 -0.24250229758556549 -1.0897702256340815 -0.084875592814440792 2.1478186611767338;-0.98928243702583307 -0.79747721702247343 0.55508425604877809 -0.18918984984295123 -0.48811486638961821 -0.35260306050793994;-0.91593185123460252 0.13247528656913454 -1.2094063806828623 -0.26201531050926302 0.054710994649546846 0.88059300746568459];

% Layer 2
b2 = [-0.44248635106714329;5.8975867747534512;0.93827450209381391;-1.4898629153980496;-1.3688375498550394;0.03070613834275171;0.37683190361493013;2.0752132989368395;1.346022157314847;0.76397876313831325];
LW2_1 = [-0.022904813710720236 0.37562983138712058 0.20097783546153283 0.76694379239161081 0.46168933496067627 0.49038679421832443 1.1931854689825545 -0.7379627114425753 -0.017852433688171014 -0.18647678419548669 0.46039821516064483 0.55717395503287426 0.046948970087111332 -0.065391823594643461 -0.23852233958289989 0.090520922960206501 0.13705804929503135 0.17856121307261322 -0.91551158494559703 -0.36155140816287057 -0.1364815621759366 -0.019978898406366515 0.7444150463696092 -0.084730248238926886 0.068637796650842853 0.4115022725844803 0.11709289029824636 0.1158309877432102 0.079492343641223123 -0.21168881421323679;-2.098243572872736 -0.35377131268117651 -1.2357635160693226 0.079528254917572566 -2.4775167573014527 0.31657495402438457 -1.3828881660419847 1.448706678488582 0.3224714585146024 -0.60648526578089212 1.5399237784885342 -3.4040012638268529 1.8495515796181798 1.8679333315756939 1.3615440180351375 0.16650842004783781 2.1583405829300899 0.49981614608037772 -1.6216176617819873 1.6427945315703865 2.1103572640677313 -1.3283781374502797 2.3156139729754557 1.1703913269275095 1.0026853443035564 0.68436122884033146 -3.6716637072789329 -1.5634803291981445 -0.28049593519801952 -0.67819111380777575;0.12759569131612658 -0.33014954288262149 1.6329209989857252 1.1496760752762099 -2.3542408902104417 5.6285237154318954 -0.91615448431389335 0.63876468724323021 -2.9011634819634344 -0.33312504856141079 0.53486383226550405 -1.7090413363999877 -0.98891643618795699 1.004239369816911 -0.11783760914129414 2.1351321291549743 1.419968641948214 0.99423392694153023 0.0033729077894906773 2.4312264773118799 0.12436191361546146 -1.0224094154143373 -0.07981570334579749 1.0271068550757327 0.64445653637840805 -0.51946805283603237 1.2315978839204826 -0.36328193404975057 0.5266106553342188 -1.2489175720451091;0.49876516469671645 -0.51853198680633272 -0.90279076446722217 0.73810072209211441 -0.19439484165170909 0.28923098543692327 -1.8936069973292733 -1.0470754581875175 0.10479570079988784 0.22505557271944548 0.53072240823178707 0.41645095718889508 0.20898690158334948 0.51801998462930576 0.42278626289541343 0.018482998077263228 -0.48263235926415654 0.1700985039908347 0.42972412866565307 -0.61156021438851793 0.94230000459344299 -0.57895213690700498 0.3215397208219683 2.2347307430745103 -0.37045878604959126 1.1992471372255369 0.12664457370298021 1.8037716615569042 1.5158198708766408 0.28760411480076098;0.073135526432413833 1.8369645165194199 0.54176085801464879 0.59377722773537311 0.95818661078380296 1.1399800956585402 1.7637403237476952 0.034610757432791683 -0.23389977217813446 -1.1152900090611131 1.0051620231455705 1.4595578571206607 0.0049817746318033714 0.13429529894425138 -0.77931288368955953 0.4226917210644664 0.23437700740260861 0.2962556326711554 -0.8940123711417195 -1.7837449477566358 0.16157870121547607 -0.92048702709404739 0.21524815744435633 0.25787254802482112 -0.35395003169374811 0.83485252529898979 0.13804363735705949 0.32811958864764296 0.31580467536442491 -0.99153362269513567;-0.97767676823545102 0.61243254387613077 0.89118711181063692 -0.73382885455750668 -1.1387879191724906 -1.0967395688248003 1.4315892077065673 -1.3726785798271228 -1.0844755828382864 -0.28364509783924136 -0.9659772030053696 0.044092264797825437 -1.2052047520745206 1.0452915456228795 -0.38169987222779367 0.69020135662533511 1.0429824130281475 -1.3275964486211749 0.012208225642339659 -0.49647066038648635 -1.3478900974667818 0.97737015728136112 1.4331102516201613 -0.11147103929214988 -0.49787087484946685 -0.79113228752354692 0.28532083354470117 -1.0755781976865566 0.041038217132301651 0.52569371494932549;0.80134045560963252 -0.066797080370071649 -0.57905027908761952 1.0213810297526482 -0.54757942113026781 1.1909442055516413 1.4863251555324519 -0.10517361951056853 -0.90015200915613369 0.41091930066811261 0.76684101389856318 -1.4745922807059255 0.63736496059574321 0.40504751643812564 -1.0642293018179072 -1.0585701303274122 0.25771124717164151 0.054837431426410593 -0.60351595734281327 1.0400685946946993 -0.3453609310746622 0.21545584763806599 -1.4042183438566662 -1.978448199315801 -0.17597430275658588 0.41529998754972175 0.37246162713037867 -0.39332273100356202 -1.2692247067124205 0.91893818066020727;0.24699531766015265 -0.63017077501287178 -1.4525574885073951 -1.2383513069343455 0.37213777266339443 -0.95977516907102645 -1.7906877909070051 -0.55157398967340243 0.3859788324893007 -0.40907849730997925 -0.98774133321120816 0.014549401727406094 0.43531627430564845 -0.017452599151245786 0.0027982392538316984 -0.57907469226316177 -0.93653601463373837 -0.35816974315611355 0.27358901749020681 -0.19980853611184524 0.42883393209970116 1.7484780078649365 0.040704006567118006 -0.4572408286844879 0.011323241368429968 -0.43428683606759677 0.040716290283386067 0.14818598464109298 -0.30997047108651909 0.67424774374239471;0.98491344713224827 0.33794141376562303 0.025727700521478426 -1.5010627384720907 -1.761262847593152 -0.66183959145655036 -2.6561837355676379 -1.5872587406348537 -2.2714614800294002 0.62264340283505193 0.62638348442668723 -0.56953689486991266 -0.45997320882655041 0.86262585148747584 -1.0523114037872301 1.819826793630728 -1.1356534998589369 -0.3877094952806272 -0.40674678191310593 -0.76501109565360004 0.77146466340768349 0.42423545793453904 0.29950903255059852 -2.887649065857727 0.26742594512410744 -0.84051443331174669 -0.071961697610990027 -0.17234855938796023 -1.539531082523006 -0.063464766003859766;0.72778269620766645 -1.1144011994432499 1.0524826696997283 -0.66739096458143599 -0.61691596240868396 2.0250284844707891 0.45455337083317282 0.26571286525855936 0.14256121644433989 2.38421155216886 0.94404665569050716 -0.31464735800660415 -0.44145555187919494 0.46278594772458714 0.95620694452400046 0.20872973467358391 -0.83205287221907132 -0.021548456321948486 -0.54954604332085988 0.28475875216678559 1.0359314897213348 -0.50182252560498153 0.22780886592536631 -0.64215675462317556 -1.0645461215969649 -1.0288317133592779 1.7441349862899722 -0.21092786841657196 -0.51884212736968782 -0.45504662544294089];

% Layer 3
b3 = 0.51762176376192337;
LW3_2 = [0.91003449353170551 -0.011593718046158505 -0.27297449841043314 -0.090223196099841391 -0.26647368864229359 0.06191621556725567 -0.19497888114810938 0.22607596580524861 0.064996736036813649 0.052077733304824556];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00111018595614765;
y1_step1.xoffset = 1025.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
