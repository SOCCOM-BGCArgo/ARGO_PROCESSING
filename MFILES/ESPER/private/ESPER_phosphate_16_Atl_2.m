function [Y,Xf,Af] = ESPER_phosphate_16_Atl_2(X,~,~)
%ESPER_PHOSPHATE_16_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:31.
% 
% [Y] = ESPER_phosphate_16_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552];
x1_step1.ymin = -1;

% Layer 1
b1 = [7.2821139183610048562;3.1341092420768839055;2.3619805874189059303;4.8747256328925949731;1.7953035272722339677;-2.3117709316863335189;-1.6596495551725647388;-6.5691723810589142118;0.024568953832905058438;-1.2201303004652122031;2.469651688578887061;-0.2472664900093612117;2.3325472635851074443;3.1118689087058353238;2.4479065939320356904;0.56603183150859859296;-4.4954831364351939271;-2.8260252190322745491;8.6990184603417244347;-5.5273328181404925985];
IW1_1 = [-1.2274000668999824892 -1.0545645294075156606 -2.2796854180909948973 1.4712612497644561582 -8.0619913791788349045;-2.6572766360692239296 2.4250206996286625127 -0.65579458797959999661 0.20590799465800252444 0.49201891962615845744;-4.2849508387480241822 -0.87619499586339699704 1.0613641216835856262 -2.5097282363083470713 -0.42685211015900925702;0.12278736277343067773 0.076144309807137280921 0.41895199388323239864 3.8132221216862900448 -0.68988889910232542579;-0.90919480603558955334 -0.33480551586111328977 -3.9838521577551531117 -0.29432351537123457863 0.59905843407767189746;0.79169973624682665747 -0.18003043089808168364 1.3558934820240617913 -0.15757620954289000559 3.2495296775697952718;0.66493049734547560181 -2.1314106172814839546 3.0300168500067066191 -0.0065518553011574224426 -1.1086277806316300332;-0.95132485656581733391 0.72114713545687791907 -2.5803905444671730862 -8.0247247895853455191 1.6327736691018126525;2.73369032826461833 0.93463605140482852729 -0.65456964136172612889 -0.27222802533694845373 -1.5425631334736014111;-1.9146446688847444939 -3.5766380154823198545 -1.6038159218573122544 1.775886618364725944 3.4388520629147709684;1.3060720368531708591 2.5871745050592869219 0.91149512358489948038 -0.30948907811561526815 -5.0546938368645886186;0.0400232318382343355 0.5811856141965229261 1.25585038291021589 3.8589962904684731448 5.6190232343291697248;4.1231928387582206241 0.7567138177942888122 -9.2045277334959543225 -0.13196946584110227918 6.1210535712452784907;-2.6710730769947486074 -2.7693415056848302847 1.014956070607314409 1.3148015558642183187 -8.0075476124388877963;0.88348629253035870779 0.89721441014109670764 0.59857409583322718216 0.5650531628545104601 -3.9493053499246744131;-0.56942045536297236641 0.61150971053579206149 2.3347069121402532765 -1.9125213921897219471 1.6683644008532327874;-1.1589678057672003764 2.5384729817474074309 3.6297521012233877613 0.15764043682126221979 -1.4640474975016393167;-0.3736848034356122783 -0.13141405675231462857 0.33176084259357330186 1.4185299500020791541 2.0397343144379789237;1.0086006619334220158 -0.45174640467240900765 2.3111829845442257714 6.3162196143137867566 -5.9636161362095521099;-0.81305952397155611955 0.17245610182132314891 -2.0402683442714217854 0.32067678076150790689 7.4711021707705933537];

% Layer 2
b2 = [6.3001106960441166649;0.63674470151032080967;-4.4770431616594423829;-1.6406181330234728133;-1.7751646067488890957;3.4808085296482960125;0.93434776576042744001;-2.5030170854551467841;0.8995105527191575856;4.6773279802637750535;-4.0536651204339904098;-1.6888939976994978842;-1.7665075753199526165;1.7755191420238025657;6.8911781602685833192;0.62369367753221915951;-0.31895029017534071158;5.6083704093425987836;2.7837289676388445869;5.5864275665939882032];
LW2_1 = [-1.4168706177021730408 0.15290158130503719858 -0.077693515947589900095 -0.54920468674172995271 -4.0942779953228862766 0.25631874470015120204 -0.46591026212118963334 1.2833020867340731996 -0.26577243559611746226 0.4770856049950319977 -0.046296324154397702766 1.7168686223510640776 0.89977513387397267675 0.33428045549294088667 0.65990372997022483936 0.22860744991685821859 1.7422360404274970236 0.54405314683410510579 0.28826039325819413639 -2.0330132355674463973;-0.72301038290491315141 0.77749819977763034995 -0.046337852687923661299 0.7656905991521202326 -0.23641570223306421217 -1.0903960515747361804 0.73890090874064162652 0.98115893097471662543 0.26914451193181132549 -0.79782911400110301248 -2.1844243002110408369 -0.0094681106117315179393 0.55090669139812264987 1.0127811908437596156 0.86974011057834899052 0.51785407420262630218 1.8721946155331787853 -2.0085672471952968898 0.67299373164709663797 -0.36478462217513207833;-1.2698321124464970744 2.5467515805616689484 -0.54423591912878954702 -0.018147397045514268576 -1.7430031311359335255 -2.325102133136336402 -1.0833090094825477134 -2.8226519885625442896 1.686003494568087735 1.0199874144411136268 -0.58001929733681845125 -5.0742046978435286775 -2.4137524662342046966 1.7538439734044224405 0.49258676190166500453 1.7419297075210997683 -3.313079785091643803 3.4280599350096863098 -3.9980777393407236353 0.80508916599092006372;1.0887461906542659218 -0.68587019769376189604 -0.15321222999994155156 -3.9080241013142664741 -0.86815504907538398882 -3.9088068998916765118 -0.046043359723880121492 -0.42285662378301086539 0.064534579585898907417 -0.67885429947274944507 -0.9241399519134163576 0.73602177381300171177 0.50141284413985276469 -0.49113430593608931041 0.84485599950510326117 0.92489793664534947215 -3.103588199575124662 -0.49142991111068778931 1.1100903894795688398 -0.86889452972091163474;0.94973274084243575199 -0.07987169043704245297 0.37767381773174324433 -3.4365063518058578396 -0.61928897092897916554 1.7038482812445863157 -0.53977939702529842414 -0.89320928725204862264 0.093715107557731838761 -0.35175788097107391073 -1.2528710833958489612 0.9335668240009995511 0.1124067013091315792 0.44673249795131769746 0.82028171703081653732 0.53122637625664070882 -1.4992397747708210431 -0.64247347840845570044 -0.50695975086207356597 1.0862549164078747488;-0.52699142516746488862 -0.63183279955875715217 -0.11847281885713557836 -0.053034145136452146008 -0.31403156761418937748 0.27786296561244189229 0.07395070840714176863 -0.67129582251442754259 0.63203691593396182924 -0.73700520602475527721 -0.97829295286187822889 -0.39879891224485858325 -0.66615363769893798374 0.30834201381291581612 0.20138543515114409876 0.37244891827319553945 1.2349617681986011508 -0.95531872320928246101 -0.963966992011755619 1.502257659058180872;0.29493734397357118659 0.60647131266488685242 0.055381991467226630854 0.4065367790745197385 0.17475928741909260711 1.0594490957610327442 0.63943079349259013267 0.90003779492601942991 0.10906559134512348874 -0.040844286003150799547 0.7123780575987330721 1.2631082168326830395 -0.89971428457548630053 0.29731200565810750325 -0.70932369956140106648 0.2257426873274211987 -0.64881618892129511167 0.45612106954893594235 -0.29335022498424739856 0.58969675495254814113;1.3298216354831868813 0.098045866599620279391 -0.081560754124314849278 0.92157030910666071222 -0.88430177804693999022 -0.40587679935251991248 1.3187095835475821648 -0.70348180805978655084 -0.11743005374864516621 0.010360339979160484991 0.33592792152277201057 -1.7342328582784434232 2.3429589827528602974 0.51772222540982748562 -0.94141051333098935139 0.021865473639099554382 -0.29210661121724912359 -0.98482641339384335843 0.50264423920869705231 2.5690415767823338022;-1.6113580599441701402 1.1382155240113409622 -0.17602529027495936176 -4.8016836120721961834 -0.60025633830612346031 -0.1273000864690242151 1.7826640162289093539 -0.45643349299632496319 2.1279221709060767154 1.1698494337250604502 -0.17221852678740323661 -2.6736325597190599979 1.9114770320925835723 -1.8422851435938700781 -1.359369368609311346 2.8347300488782476435 0.57793370213711403593 4.3986136923336154325 0.46444594200398187089 0.9373324086399384969;4.8643663802410905816 -2.8150000407344415443 -1.8195931048375100225 -11.348743924300114472 -2.4589958534353439923 1.3906057823223743064 -3.6630163962258750487 0.42559741777660503592 -3.9245105114277016867 -0.7343243527978903229 0.51901223024256382121 1.4943129689505940672 3.785613073164854292 0.91710853846088191688 -1.0913801236034801345 -2.1125868333874620042 -4.4672868831582777105 -2.1289985366659074373 1.2229012421400711208 -2.6375078350926437487;0.18474617474615909196 0.057378690761473782889 -0.0074415559693998805518 3.4916175572098571145 0.6757398252875809197 -1.4282455037166561507 0.020935472099523760869 -0.3420373583497750003 -0.25861473038163479421 0.30495675415670864261 0.27535403496421134717 -0.15496858767489815611 0.46563034736896274923 0.081869981084664533721 0.056440682440524927999 -0.33460530311755476429 -1.5296735661514275773 0.68724604208607731337 -0.66993578614125204318 -0.78427561792233013716;-0.91539708990136081646 -0.26588604671772275712 -0.14161363210385652378 -0.23231754338406113147 -0.02555746246334354016 -0.97342937736023305018 -0.23370308689747582021 -0.38070155209379052952 -0.067373285510129124476 0.19491091669761845262 -0.63341428030795610127 -1.5643910009378831916 1.4265409035764287093 -0.31928985582020918965 1.0349950447815787768 -0.14259995398418490176 1.2412662222233266096 -1.1075660399700910652 0.23317589591635040636 -0.65602398778194259688;0.52672661044023161292 0.5419342355318148563 1.0953295889405842978 -9.056483010534082112 -1.0669558843842892326 -0.78680503421207748094 1.035990745652725975 1.0414851818347046208 0.58058716686423861297 -0.42935153299315775843 0.21464829478799363205 -0.86643309479540353557 -0.096686400141858697133 -0.39188441954526009869 0.30509488218207636567 2.4823806518966553547 -0.079575492731506977662 -1.0436392772679521368 -0.25404460517578636436 -3.1757770558451277054;0.79750365541471679443 -0.25979135083818793994 -0.52502925952904577755 -2.3368255280465639601 -0.76245064756968616848 -1.6468733433782791753 0.014987958843340358495 -0.31811503101814198047 0.85798244481356011892 -0.46284179484329596166 -0.73082175458802967061 0.021938059140566651406 0.45712356533182052498 0.23595187160655417546 0.090318390934004857962 0.8369135654214771014 -1.1091833955416829927 0.25634105199723355994 -0.4801385526867428255 0.70948981438249958398;0.4785261620419983819 -0.073067068858483283367 -0.045826109938743989081 -9.3462449242683849349 -0.92782958864887554729 2.9352436734123412698 -0.084222309770338205093 -0.37491115975178268549 -0.29725080288543409557 0.058232702837880172264 -0.10192767379672773576 2.1915345900127110035 -0.61365264554063181368 -0.46727766146144994464 -0.13883880306076779032 -1.379621777149835804 -0.031058678290391029952 0.067644055396334251684 0.13651257722964302288 0.52844789977506634315;-0.65158319194126179674 -0.10592476691128145661 -0.010239157476140106975 2.8578061213053564948 0.74146875486600982708 -0.88107662073423176352 0.3283792646248529512 0.71018962059060630754 -0.42407943373633827377 0.25705694141050206003 1.1807941809465116734 -0.27153614856070157346 -0.26320035338081032572 -0.46685393482993819969 -0.51552780222089733542 -0.47459901658069653108 1.1952991689121130747 0.20571629166025787172 0.54237321849754693837 -0.81500705344222856841;-0.74207013752417072538 0.12276529180500891925 -0.43829543632756029492 9.2363545273058420548 -1.8634288414261599431 3.0370987468473478188 -1.3225922123782496431 -1.5408675861615983571 -0.1826833269334051657 -1.1602792708415057277 0.36227640027153501512 -1.0738106986612092619 -0.90728213202294771822 -0.81556638008405990536 -0.15243042573032281051 -1.6749911349378199255 1.4887329049353723587 2.3195999893426884064 -2.6026023873980985712 -1.2415007028667774946;2.4980195541327523401 -0.60195281628005625763 -0.98217388635963553956 -4.6367309816718922377 1.8964556138498138704 0.71022187536666081531 0.64388511767740119751 -3.3142186431665936475 -2.3625513957611614657 1.8067506953380325641 1.7098122425881943087 -5.0293132958968955748 0.15317357230504297094 -4.6067891304308545841 1.7056632416251591433 1.0747761886461473235 -3.9399462686386961252 1.7164047345626538554 -2.3231367622456877697 -0.87227021698651086012;-0.642117894278859902 0.42302938000430689858 -0.54231277308988445895 -3.1807840714622019895 0.54067504857849080224 -3.8251588258282214206 0.64441030469832905059 -0.32912959894017318474 1.3627238195277457944 -0.19664471309281889022 -0.28238002972621967235 0.16390025594463264458 -0.20859609604685236395 -1.9429509417559778228 -0.62883516460603794407 1.0897759324105222856 -0.86008569450885075103 2.1099287109783224636 0.061774300483714614241 -0.02630244682363179487;-2.0656614712336893724 -0.093821394326944834718 0.22937069361365661213 5.8327596030692605567 1.2337975259430726815 4.7716293782326300033 3.7484249624849481641 -2.5814250362895156954 -0.10606777724677368679 0.32091783828394104816 0.4519607130799311312 -4.296154660774003986 -1.5055914885251939772 1.9925383890587631264 0.014083184268619699728 -0.65911573615409357885 2.5244235822166150029 -1.6420086511502796078 -0.30579988556634440933 2.8075433279371075912];

% Layer 3
b3 = -0.79159379110404992641;
LW3_2 = [-0.87925396722440496422 0.91052436846883333388 0.3550986095664230846 -0.51760937489930081146 1.3380921661819040747 -1.3447627841386919911 -1.4611201343751960557 -0.55566906695777873448 0.38099097975113793701 -0.07422803609301682759 -0.96742476599252558156 -1.4647319143955568332 -0.6379655304816154171 1.2937108198084819044 -0.40272821293646071661 2.281081479630412634 0.16731450858596130793 0.14682044046870224019 -0.72831036156672834814 -0.40211046343516587687];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
