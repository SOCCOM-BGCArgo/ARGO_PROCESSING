function [Y,Xf,Af] = ESPER_phosphate_1_Atl_1(X,~,~)
%ESPER_PHOSPHATE_1_ATL_1 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:26.
% 
% [Y] = ESPER_phosphate_1_Atl_1(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.28;-177.232103709389;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.0470499670650231;0.00425400504498441;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.9142113437581378399;1.6045682621611818686;-2.4674664524905995933;-2.6132148801743633193;-0.51889890802898019917;2.3385279001617087502;0.87411447998844793439;-2.4099118177190490542;1.5876082281875238955;1.3641701575829447979;1.1308354672690439369;2.3935907666439297792;-1.4428550571666955982;0.5276232386495017801;0.26362069102765428585;1.4345821991069320767;0.27066688702081703743;0.16359657095920193681;-1.8600544594746635241;-1.3836651890611042504;-0.65694995513271337018;0.14823123343310906641;-0.72876793305689835378;0.93043623514092976823;1.3623807947101460591;1.2819099860687630521;1.5806562386446276758;-1.2463252338621795268;2.7495656147578744211;-1.9618446082656653129;-0.51588824998081084239;3.7874010324334785871;1.9824992582183875722;0.52875939723567821904;0.17646190310068485263;1.4603458674826537145;-2.4899782298672170633;-1.5035011100361252989;0.44466134526921541337;-2.0940450567308266372];
IW1_1 = [-0.12853019666078913108 -1.5647417697481968979 -0.1903669764536952691 0.41428497570730399291 0.65481223568150281888 -0.068376581480526416046 -2.5089124515952829775 -1.5264187055723710262 0.46061367524028568043;0.34348142769045331146 -0.61060221268324343935 1.5431856398116841067 1.4771313195542192798 -0.20570404213324700038 -0.9336155414199562852 0.16776955816510538688 3.1811308402846547594 -1.1966240423748757404;-1.9313246380483708453 -1.0755526536315034303 -2.332338135525674705 0.63303540138683978 1.2407756449300697543 -2.8937082150271637992 -0.31401839709680301471 0.27837547416591118532 0.2107223307055960948;0.048384318916840661495 0.11086461067972736005 2.7575809753080866571 0.5579207785582153134 -1.7903963879413447025 -0.64124639861743248925 -1.8460285657256925163 -1.1314127420178423655 2.1569103911061233703;0.080385465169944811392 0.10011607383652722236 -0.21642424893007133901 -0.043640134621340143095 -0.25062793458591653417 0.21735222270415152646 1.1852091124779480236 -0.27529450420850565262 -1.1043314040766247786;-1.3921696161179633044 0.10134681819779868539 -0.13897902643556217517 -0.07073598980558569449 -1.2873549150411092157 -0.79292239323267266204 -1.5798105596507219239 0.9020151811563816846 1.5040718512477682101;0.7043058069421676004 -0.035011703482427679324 2.383031421154084839 -0.62504877471423769819 1.8211708138362256992 1.6883458004895475213 0.22178042767274691593 0.14011593070770433922 0.154018294815305129;0.089150488248008266656 0.41421840014878097413 -0.74986173133999522999 -0.80623616661105090841 -0.42507722801048647421 0.59511068290079682797 -0.84981135522639883462 -0.083686264125423223681 -1.1716365474283638726;-1.1635415834995661566 -0.50155656198956355407 -0.37691217328891357674 -0.13531904912014761089 1.3722022191599405616 -0.34774932531891888932 1.0062075152635594488 -0.15449984516467210605 -0.3602695343130429273;-0.95022090859528896001 0.17319138304339617984 -0.54197995554303246557 0.13131007028755153909 -0.029479262272167260084 0.19779790467695781975 -1.2890197187515348709 0.68277999546839696077 -0.31914270692143370534;0.10704038341328442341 -0.07987280813367822474 -0.16151205123714404421 -0.17269781515173429631 -0.022828086678000590604 0.42836700397001720164 0.69812438231236184638 0.83540593550989739047 1.3934813125524629918;-0.22957107115712629963 0.45207054143023245318 -0.51841432549043331424 1.2259559554005949877 -2.1292057058477289466 0.81290396622967897589 -0.51878006327766013062 1.0383937307843384978 0.39435979776864588109;0.86173312775701538246 -0.3947656198567549013 1.3545460974869030224 0.97907834401075410913 1.5306372242551935514 -0.9346955689394249589 1.9981722527744234519 -0.22675513370985697637 -0.61598591748443498606;-0.45251426733321881146 -0.8851353072105651032 -0.20639376933048800278 0.0433082494373543056 -0.40271446102847174853 -0.80068505387884703062 -1.368904983997830227 0.84057566484585954925 0.25960827153564691727;1.2363809499176134921 -1.3918643356323541216 2.5341823706543675776 -1.0371156706030106864 -1.3170102942708723504 2.892037541542528345 -0.28804865107991861617 0.16222283096510728417 -1.122620093208800407;-1.5110044445012733583 -1.0884322700327846434 -0.79894082228045759653 -0.014528279495877167299 1.9850482658668961999 -1.0027325353095573046 0.0091899211755737258978 -0.09302213321791386047 0.70176459292016712954;-0.43833344342835145468 0.55068004737753706301 -0.12180384013313919067 0.58645118892442682501 1.3172913023884418315 1.0584351688129693958 -0.055935991182354365125 0.35614617206708515385 -1.1163464038084498497;1.2366497123180082429 -2.0100426722316959705 1.7128934721249140516 0.13160148356990739038 1.4169405525961602521 0.59434733117872329267 -0.12702309176132126067 -1.4429598756691495165 0.013572838332167823025;-0.57655795189896752451 0.098941639741578116252 0.9665312356876460953 0.15964382142877842075 3.521977092463514758 -0.74066059515217863574 1.2216128752170323235 -0.12341101309712333711 -0.56051828490239130609;0.079997048462872907826 0.21860868354698598237 0.38912555517872837729 0.43951248559528005577 2.6574802996917799014 0.35500096108664619399 0.52592371998345133211 -0.038205493939328559472 -1.2372055693378867236;-0.91624311116934653576 0.53950791193659675127 2.3749036439806210375 0.031800143649609542706 -0.9066308205328789116 0.91232099751162598622 1.0050724919446798467 -0.15104688671353380669 -1.3086598406905327607;-0.98383417074249923662 -0.28533812880415065916 -1.5329066349309310446 0.27874492098917624805 -1.8497903845414072066 -0.66777388799472892078 -0.8330488511032965171 0.0034085162848904045595 0.26693118337291488196;0.20188403060210094453 0.41915762803673839443 1.0008260539410163137 -0.64106806037638197626 -0.4048492101382697439 -0.29795318350700011889 0.69532914153325320328 0.24461145238365938903 -1.5963843571755884643;0.72485864479542505556 0.31327986438255028823 -1.8185188364985438447 0.21664133968742207981 1.7316921783039984639 -0.23096116276035152937 -0.078551834088541286349 -0.43781411679456938568 1.5181137023745472359;0.61498460560385403983 0.14527602484878585076 -2.0198021417927716215 0.29408322462015384913 0.90434751833444870783 -0.51592294102012903334 -0.26081043042465668069 -0.27112475736704422236 1.2172045531552209141;-0.72594979896800981845 -0.30820217074578598604 -1.3552300944137958272 0.025319158416304578946 -3.1904137993808574514 -0.41028100481143037204 -0.43275766747901300846 -0.20544025322057790639 0.56416727623563078797;0.88877209225669739912 -0.25821858272942016521 -1.7254245391325526704 -0.23734216715070732828 2.4250601937596893976 0.76271551758248157249 0.45942874332288236028 0.21520157060869227195 -1.1432877574309689983;0.0067215406053424339716 0.17801351264169129607 -0.13931907842383126073 0.32445802988189076377 1.3908010646150164025 -0.34696596911105520578 -0.36928532446883438611 -0.54908561661908983353 0.22171598234816791706;-0.15030057019422085607 -0.63609221778136126879 0.59285851777383113959 0.78879627518777983841 0.18568910055897203115 -1.0949212237133507664 0.62224804953311374511 -0.19221078202875907515 1.6286619200303811272;-0.99768221695561654094 0.62056302511694849677 -1.5182208543962851799 0.77433239261313968615 -0.23375634553549240469 -1.8528974390315777754 -0.44025900784838123414 1.2790004387459905644 -1.7824365010241360885;-0.92495825140743082038 0.028510251309052138391 2.0072988781920062529 -0.32149342827874249906 -2.4262395028990919599 -0.25367149421995222047 -0.27436365777040222502 0.22582626211101364255 -1.8272687601218646769;1.2030033532758754866 -0.22099653564092613944 1.321415655925712862 -0.21517562894729591605 -3.4167461174562903103 2.2664071682735231761 -1.3735190311443892242 0.60319472308983745901 0.3957121407455553852;0.031011179552952794491 -0.27323401736184749211 1.1479508792982833221 0.70620244477110294401 -0.41083011497632881959 -0.61845588484488367431 0.44880528338758690632 1.7785595702715268907 -0.30178018375094467496;0.97819124355410036475 0.012809139953506120183 1.8302156630541659421 -0.51473180167604482005 0.65433534723012087841 0.56066113733870670544 0.80789041846754583442 0.22885964403028608016 -0.16884491614225460854;-0.52470498416343802628 -0.20030010121191990646 -0.3314648315250465771 -0.20800504200009797828 -2.1672394432513950591 0.73163218150890629854 -1.1026871860218856458 -1.1401988932910829266 -0.42687925846003904606;-0.27684107826302667421 -0.29026182587681542691 0.52805241020441551214 -0.53231503864622375932 -0.60938559193748320642 0.049650791024730127343 -0.44439309311137431546 1.3768894720780429086 0.35888463049051388953;-1.5388903745664923584 0.19079799148871937065 1.7355411912455351864 -0.18915600138965718569 -3.1662864013841742761 -1.7425467214773140423 0.23176050697009706325 -0.076210691610867520307 0.83444518101293352341;0.32030136470253139924 0.26108421684064070378 -0.37329602179656984351 0.49533027916877203634 1.348313417025046812 -0.42668258283899374028 -0.04007521845597795257 -1.0725209120631891135 0.1641695044782032209;1.1602496477350385806 -0.34919567442239118904 1.0242844421196986016 -0.16219818026232446506 1.4477810478606105704 1.837757876415556213 -1.267209456131495493 -0.091067619798346391424 0.49709935448270814451;-1.3174545317776698017 0.18535348843453294809 0.64281645811172904992 0.014356745132074940144 -2.7385482784745094342 -1.8317196222803491246 -0.53284983222867698949 0.50202065437440512863 0.48947837674517102879];

% Layer 2
b2 = -0.85216513992454567816;
LW2_1 = [-0.29983521890156533685 0.68515098197518398138 0.063410800595201502472 0.93035743184471386691 1.0424340945853487472 0.40674243822088451683 -0.5450400369167363035 -1.7217729043688279056 2.5707774579371753809 -1.0041432324138870325 0.34815562999748878026 0.23634059858665346088 0.13413495612312742455 0.82743453508389042117 -0.086172534951507645529 -0.92594344096884362294 0.7447552960069450112 -0.17112022795484213566 -0.39134835319249744456 -1.3072528884949718986 -0.47507933086998044292 2.5092654774573110998 0.51957622521012170047 1.2773522881975725163 -1.3972571210933546482 -1.7005748469026182867 1.7478596564228010557 2.2601583372571063535 -0.95382576686433739876 -0.3450425281229309582 0.34552304152597324016 0.61264682746238863231 -1.8169190439168074747 1.7116894348211340038 -0.24019440699048175136 -1.5753723598316944354 1.3910598471396244946 -1.8905530104549717052 -0.56817411700307285383 -1.170334469865276672];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
