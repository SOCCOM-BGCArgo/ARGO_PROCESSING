function [Y,Xf,Af] = ESPER_nitrate_2_Atl_3(X,~,~)
%ESPER_NITRATE_2_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:32.
% 
% [Y] = ESPER_nitrate_2_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-1.99149636107278;-0.03;-0.52];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0604107502911417;0.604229607250755;0.0145232735458572];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.5048069896093156927;-1.3224772054637445873;5.3925560985340226239;2.1278029623254246516;3.618834426655972436;4.1681885896275900905;4.6729311140732008312;1.5398159004562324004;-1.2763280276285660086;4.0894205936473744245;-1.0659855388072909665;1.1908250881734421256;-0.94046789364801508526;-3.9111484878462792203;2.0534213444802884574;2.8171311196320827364;0.95586772749943149652;-2.6262445723821015164;1.5695267681570828078;1.5857247758181081121;2.7213670999422663321;1.7156064793389973477;-6.2026343853431429309;-5.7969358042411416321;-1.6624694731672182701];
IW1_1 = [-5.4971427275054987049 -3.2271589352466230061 -0.0097302294197077962568 0.65339491916197400823 -0.22732013648044002707 -2.2776564698877908022 -1.9933514143785693307 -3.3652533677510967358;0.52108510645882344381 -0.38035624777110371708 -0.83324276674935870979 -1.2534562132203250773 1.5882030518384218087 -0.54188519285458014441 -0.43567231255928529077 0.12406221530791422536;-0.72842844712514409622 -0.6416508049787420509 -1.7682990054980813888 0.3490319058034411781 -8.2992974199750531028 -0.32387383132808783559 -2.7005178772749443006 -1.177212078419206609;-0.15304440455409115684 -0.37941414523502775547 0.19185160446475449381 -0.91356909804501706951 -3.3367934415874693777 2.322600293913971381 1.2739570053426787499 -1.6450404927666284483;-0.50885435919781762948 -0.31254216668404449786 1.4244945356157834304 -0.069721385626968612748 -3.6885320731937651928 0.92288929534102603913 2.5982753822674529154 1.3412296234695391117;-0.093699840734356096283 -1.1971051264260483826 0.4154244479898029363 0.094207851020529628783 -2.3601151734633720736 0.2537911760134525796 1.3309967838842611254 1.4344424809698848033;-0.71361325477641079917 0.20873227396361376806 -0.92455654049836111241 0.22608933287142476964 -2.5431646880135314603 1.7583249411072672252 1.9250626535675039452 -0.16350789386307423845;-0.16140314522096810279 -0.54413946080403552408 0.25513492396496417758 -1.8499766418601426565 -4.3227739000216240939 0.33754621006994012244 -0.71541956091542147078 1.5919255814974124785;0.77338641246536210527 -0.72336030631900849475 -1.3624218646085088924 0.17345639985435093444 2.4311958620274785048 0.85006993730755875394 -1.0029626856237634502 2.3494020442805090276;0.25017439980507200081 -0.13967459523392525278 -0.34700460857749149124 -0.16230089328796595827 -5.6947311676144583004 0.13374324732170292385 0.14852896224891293242 -0.147136468350057531;0.43803104042363022463 0.10601914087716708679 -1.9902479052091737177 0.75829449495215905941 3.489781058510960321 -1.7346917398120544895 -0.50630471449340719303 2.379377569907723089;-0.63981925036784503824 0.054434524465885231193 1.3873433475048286834 0.24733308491482039471 -3.8846022883309125895 -1.2735052631476098117 0.95667268868880728228 -1.0151554316984070514;-0.56993909077915771988 -1.4848868104218890807 -0.77635135345737082968 0.53232901567077828275 1.9379138830089872592 0.84916925067164872321 0.10943644063332469418 0.61348726747183290886;-0.10910325757732292073 0.42836101815671601134 0.04530242135712543583 -0.33386271688478585951 6.5533707605364934778 -0.22144883113505509087 0.017212674269392980869 1.3038668527634060812;-2.1127525588397086942 -1.8213535331255292782 -2.3697750943974491555 0.26037813672041487667 2.4331827148236868652 0.36608214304489844482 -0.44744526943735429825 2.4908933005147559925;-1.0963883049478819753 0.93010110315912908341 2.3511844900991203389 0.77338970403077667015 -3.5222853588325926388 0.73917948291053148235 -0.39644694012857095711 -2.8719546405551730217;1.8048372774731089585 -0.076578008809652722833 0.45487610457882243775 2.618645231769425763 -0.10150205549956356488 4.2384643527382808159 -1.4941527428010676903 2.0148089481796640499;-0.81358555376815777649 0.39142340209473774904 0.65018767495894824737 -2.9520485272855268022 -0.082109146100438568094 2.6973295638060506008 3.6859500882715634518 -0.10205891704225210359;-0.019099693813476901344 -0.14864636170524922476 -1.1090664093189490647 0.18789697527506504793 0.54530648591010633108 2.335884550112217628 -2.2957000444053261567 -0.85072888555902426155;0.46285433542837217669 -0.15992821240914487091 -0.95174452888320792976 -0.24561435519973603969 2.5051310479690700461 0.46376459297293054496 0.25845889692368778645 2.4242932069045144416;-0.59794027152418272042 0.3150829040178109719 0.65091956542508810912 0.73282488151439351132 -2.5277286387382615906 -0.21145169911549671626 -1.2067911417292116472 -1.1401112977855691888;-0.02792953754772122682 1.4765008232279808187 -0.46696872005489686863 0.76716158556327196383 -0.15762491251953408833 -0.14341760064842212774 -0.93460929286170646435 -0.038652181910318252067;-0.14468997081571216556 -1.1203981051451670226 0.90603182352420141843 0.65199589322813078507 5.9466759906208368491 -0.070428824066183379204 2.1361106647710781381 -2.0370524202639872513;0.29013816180064433414 -0.44429605623473578113 -0.23211224535510091571 0.32783710632246421124 4.5769653786146555774 -1.5369311713239584005 0.40765455406635298097 -1.8189587656146395389;-0.15891537098637503744 -1.4241492536957180981 0.92301466434842305286 -0.30651549214098294804 -0.26948713625829018303 -1.3507964755133032853 0.82160622877054356739 -2.4485184676128195491];

% Layer 2
b2 = [-4.0140750924475554484;2.2813501339098620768;-0.99955633192377379981;-1.2147460484404761782;-1.5638671497088296736;1.1116883442210125921;0.94851440408693621364;-0.29508585267893017168;4.1582847066984944817;-2.4694351913417742495;-1.517938582489994026;1.6412071948165982693;-1.4881718495375335642;0.079664851550511395217;-1.8768117201580636344];
LW2_1 = [0.3340590776853716859 0.82148525266679661705 0.087305443283694966761 -0.65110967745551018293 -0.47455982918195194209 0.77545452632118938574 1.0089894193184365534 0.78441377829880654104 -0.31236331099820202617 0.69922299642548102483 0.61470104258072777448 0.89338961836917385462 0.12340012437164450676 2.4359341732978960771 0.099636132052813436433 0.56707843175542460568 0.70723690255012272576 -2.1848511861555661717 -1.3327874238453569777 0.92261930234562328224 0.97633400038524664755 0.62655684284913637505 -0.13788155840090207671 0.88464973976790650667 0.56298976665382305384;-0.91999782169458854675 1.8095480322797419248 -0.063936926229952797951 -0.29842178441574546133 -0.10612816697340618499 -1.3211943982878493475 1.3193963270434108104 -0.71968890171896704455 1.1053522706402154618 -0.90075169815467681644 0.85239977685714762856 0.8142533111745429153 -0.27954790245035826546 -1.0778150944476523332 -0.57418251457035063279 0.55817747115666849211 -0.027975242665099649825 0.34337520309090807658 -0.46025569639813690426 0.48673146127334621092 0.6051372417055783659 0.020295585126388664826 -0.07530805778920572624 -0.028802801716985744485 -0.63460333949788672037;-0.17518700523076310982 -2.0669898778575910292 0.13252181837132290254 0.41984742917101369741 -0.026408894578093138061 1.4583751269354425784 -1.4378006263305587176 0.78905711222109919945 -1.1145141609788911108 1.1770727257343311933 -0.95439139560583763355 -0.74044523985942045652 0.37035873411728997828 1.4925035616284991757 0.60136313916835615334 -0.35306401976894302708 0.076292808283641169731 -0.55245492844652566156 0.36063449686903925606 -0.38818010879261449775 -1.1993885385795970411 -0.036076770001888879003 0.11301515379215044954 0.077388149356191746064 0.77515440424443637912;0.17317157143482181381 0.49744780271738575639 -0.1994233331994792191 -0.069888016387267173912 -0.6236972868744455889 -0.97203328255551879611 0.89947665048455027748 0.75728541645518421266 0.56582269120412787 -0.077384585039132550155 -0.76607865898871052579 0.37052267695900420463 0.79162733166954857289 -0.24565510243921928613 0.40432579850872585325 -0.065719605593090729689 -0.26933498196138244696 -1.4923121008891337969 -0.6827838461211593879 0.46181581312487657298 -0.60829247387343521325 0.30999811885804257061 -0.24391517324455277982 1.1293562736937878821 0.49526473620170402556;-0.36033805759889731002 0.31348874628725820202 1.0724221959529893766 -1.2884786987418119786 -0.79147337005123197251 -0.4221626755106066553 0.11288135388431788653 0.72258059141723207652 -1.1223434508609955174 -2.2757651292683562794 -0.858231267123383601 -0.6476693489738205578 -1.197584081853485749 -1.0344348092623436575 0.020058134395525378108 -0.8996862894614732209 -0.031381239830801682666 0.024936276163363704783 -0.83506684575420597749 2.1130041731644402248 -0.68272391042288005369 -0.16330651828800821224 1.2742790253924132227 -1.5605352594825598889 0.1062011670587311718;-0.79776742064066963334 0.041490347775961000654 -0.016239225136825120172 0.335499107054020973 0.091848049837753326097 -0.070464689872296024098 -0.54324633272799038863 0.13050342975822268321 0.002627332378120544442 -1.3589935498420531168 0.93429730385145259852 -1.5377598647453694092 -0.63576443622297595937 -1.690743853247083095 -0.34166995445698949974 0.37178908015720391056 -0.11612898413130563757 -0.42198113801956999014 -0.40528776332217952838 -1.9387651313373741591 1.1482025325437337226 -0.57218186726807440667 0.57700641160444376965 -1.0719160760471457827 0.0053715527300807284355;-1.5477403350553182726 -0.28993069664637405314 0.27658981859547981941 0.89205157799740097957 -0.12660281048966498529 -1.9376282490100906752 -0.15756522975274087073 1.9161692317799954299 -0.28071257586282705176 -0.92679387585099626268 -1.9650258335898567186 0.80130616353731443091 0.41544955929351762292 -1.5547837263217134662 0.037199385422081100716 -2.2043718942867776001 0.63342134525164928149 -0.15257026324008560181 0.40959067183036507176 0.66770715990079065882 3.2211623386549659287 1.3915977075791778894 0.80080527277814861353 1.6915882834837689952 0.19835360501267970679;0.78079554728897715421 -1.270377375974359957 0.01080742842781830422 0.56317670585281309759 -0.88479938289018089659 0.21810284309355851273 -0.96723047616439916663 -0.69009335342895261611 -0.49323342426033611741 3.4307427138819690526 0.071829191418166155048 -0.48671491026591157114 0.87717583589103420572 3.5317773059242325573 -0.20528520582428610997 0.34247970881582368019 0.23415611836270686097 0.27040868451373806236 -0.57908275125323838139 -0.13073451062582258642 0.19553195224980871036 -0.025240905525038333235 1.0687256973708580965 0.072151022435940570521 1.0042146018722326595;1.0620020915896000169 1.2876531102057686695 0.8137766824559836687 1.3554858361097135155 -0.85179001775327800594 0.50563800465106101267 1.1164552153271340984 1.1755441551544454359 0.048459834428431949882 1.9614569816025819726 -1.6503208570992422555 -2.8501754437261395125 -0.75233775304008787543 3.1495776397704964289 -0.48521652357569938774 -0.035115402350379472385 0.66025612960238300175 1.6053115011752427943 -2.0227306767940831378 -4.9813281321742870489 -2.087097042044068651 0.77106056079518459079 0.80512810111571320171 3.3950106794096717167 0.057271512879687500042;-1.0161735954246149394 0.50725268662111022699 0.4559893911735491967 1.1631281930018306792 -0.20494700070548382831 -0.35583135290855555377 0.41459428204412424046 0.27280817734009299436 -1.1108394803784851224 -2.1404570595163145974 0.67256804312713103222 1.1468565981735627801 0.26718741342774648961 -0.21803643112212522936 -0.14471702029874228268 -0.10790175573888614868 0.26293393681375115678 -0.37475758459665259315 -0.25323460832694782985 0.54687447118648990774 1.1395390408956063144 -0.034026727611800436368 -0.44573681550389637751 -0.70287841602622025405 -0.13418741365003364341;0.11535462042504594782 0.6562597019015817823 0.32824052050136892644 -0.45801545142752503326 0.46802163052271278376 -0.025272433609290878564 0.82208757676178356721 1.1300985123446916081 -2.3458661510362142089 -1.1201294826246435132 -2.0268680672117858066 0.49289107842857804442 1.3546710381082742725 1.0057488323795116258 -0.12383102865565558115 -1.3450036164202756606 0.64638107815629808339 0.95611607282430455257 -0.071403755236667032502 2.8439285788280370681 -1.6843566834900920437 2.3024281996249529314 -0.051695180773382670703 1.1183323824203708075 1.503164692017495474;0.46654318962260699077 0.68898463359214379143 0.6419920701514681971 1.3598437451660478903 -0.86714727462774876532 0.57970229489110580712 -0.03745002688645233252 -0.56772392627586831804 0.28261046941072909267 -0.77603826258825081563 -0.0015044975118055957733 -0.93531481758789869474 -0.56828850093240590446 0.059478728506037158164 -0.66032760911512400348 -0.39083147567710635473 -0.029537606703593656532 1.7569728763258294357 -1.6806227281244743299 -1.8586069552903949909 -0.67281319023005192737 -0.85131116954674768138 -0.17475709943138398317 -0.24554633998399230665 -0.47088911875811528818;0.035280933415421843191 0.48452455225644885939 0.021714922155025136175 -1.04528662805527639 -0.60846054780039526833 0.2824625921943167417 0.70428985002434585372 0.82059510093586052193 -0.40535473135360378105 -0.20258049490468268972 -0.63314354871448741413 0.42709570044688183188 0.54971273486327343338 0.39977519066565353478 0.05351203644057443698 -0.65098112688218845445 0.10813766810678263064 -1.3434522661913632646 -0.16684212099109443916 -0.18515195539407514058 -0.45079538147695025208 0.076992882480309707272 0.62217936034590526351 0.49708357607034892034 0.016064524382936901103;0.014550105907247460127 0.46202493729382310139 0.46000654565262266704 -0.14308417364639128277 0.34413638779368016518 -0.046067930526303514649 0.17305473967142478986 -0.12989585757983479475 -0.39212977538346255324 -3.0444152861238436003 0.63348178772194507768 -0.82721802250462728168 -0.77734351926413869371 -3.0194265463387539583 -0.16921989643996843133 -0.17033884953396744022 0.01343357712195050041 0.22030127810680735778 -0.66652019725187083843 0.47542303998209767268 -1.2947228345810819494 -0.40015644544164136187 -0.16111271896888329502 -1.3452865387848613743 0.021144772738958702435;0.33428107347564939289 -0.061010246496927905691 -0.016730972710112548829 -1.1309540394234520733 -0.64731065253360875467 0.71110994276273298276 0.22999297565418835854 -0.036208598181556958528 -0.59239512649508530018 -0.21173056652509730791 0.12105533474772126046 1.030667959792736843 0.5104010620710804913 1.5618869205670808942 0.50869007703663782216 -0.65747792523858450409 0.27669406625695314172 -0.35882708823278564036 0.39408782558318516953 0.11896544140074005735 -0.83890375277794781983 -0.92665732570542802549 0.26992899780487006334 0.96405713126450964801 0.3243266239230093162];

% Layer 3
b3 = -0.53201845470644149039;
LW3_2 = [-0.23373968037390882579 2.3352323450546426109 2.2400471272529940414 -0.31624331692816609607 -0.34275771395834991884 -0.40734568010102306657 -0.21635307310697196592 0.31122645203962379101 0.13557544726864650952 0.34134438799656380281 -0.21066541067061345105 -0.37422316975206681988 0.82305874447232929558 0.48831839238456065111 -0.49705798066742507002];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0470499670650231;
y1_step1.xoffset = -0.28;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
