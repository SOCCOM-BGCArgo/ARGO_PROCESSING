function [Y,Xf,Af] = ESPER_phosphate_14_Atl_4(X,~,~)
%ESPER_PHOSPHATE_14_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:31.
% 
% [Y] = ESPER_phosphate_14_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.28];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0470499670650231];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.7222177827581690579;1.0708366993158369151;-8.5736484226002520614;1.8827668402409794002;-0.94295489875864069163;-0.15313927130267745991;0.5807550873587502549;4.3775082027255862727;-1.316943363350933982;0.23229745331851583967;1.4561170452638010353;1.2132936544214119046;2.2893412748145003377;1.0960826737168265499;-1.8227361646741933043;6.3785055500531440131;-1.9515872686367901068;-0.86819976398979770149;-1.5720271821319919958;0.22489739975026074026;0.76460135532369477573;3.8801301975519759679;3.0232166087975054225;-0.92350180961758443487;0.74006767635708969877;-9.7750811491486526705;4.9705082570096532635;-12.535921636095107345;4.2880490889515927577;9.1515575057699436456];
IW1_1 = [1.4467297453632954607 -1.2689422791192235263 4.669866323574025202 1.2394371123761140918 -2.1692153772396256528 0.19787889860925578223;-0.056209632639213101546 0.32009612034552958892 1.9364390550301118221 0.042409349046727308485 -1.3660662219727734978 -0.23003610441957966781;0.70108775834433045837 0.34661727374409906366 -0.90922452697264377619 -6.9532148666970918782 2.9546225073364431601 0.30166081215488893541;-1.2750337932492439297 0.68169996552505229825 0.7882511277930817073 0.42647258830174922251 -1.1593630702744144312 -0.83572594496383834084;0.64748318434030416313 -0.38322674387942495811 0.039759646849994535744 -0.18713621699593202541 -0.66327358132705027671 1.6861445638874186237;-0.61052649924700919115 0.8915653526081829261 -0.47266459917557041015 -0.028124539161040996993 2.2734108737026246239 -1.7637634291327559666;1.3716626726551910398 -0.67568533929608343147 0.59800392271242552855 1.1643965422503703699 -3.0129274154950955733 0.93294641100402508904;-0.60569533402546227308 1.4154268282952875424 -0.84110055643222603194 -0.71181670433187627101 -6.2666042109282500405 0.86880276725067928645;-0.24110335478116817765 -1.1465326285819492647 -0.11410357323783713868 -0.50572371103428992445 0.1454098316651435685 0.41142712969975853143;-0.20066185671042952032 -0.31130624877483309421 1.1434844706456257502 0.080517885220388898948 -0.66139151393506190324 -0.75662424663969785055;-1.6741468277433024792 -0.34693949959046810338 -1.5869550009385671174 -0.68959485962477717891 0.17469937628849821487 1.4094581448027418968;-2.080396264676404261 -1.9384616197949529059 2.1106945793610778495 0.019718820069142536933 -4.2977221972461920885 0.57801285652704381679;-2.1928084545433974561 1.0684200312356892937 -1.042144392383472784 -0.9764517827021182983 -0.60421585587045512078 -1.0774934731742493721;-1.9129870617357833673 -0.69955283276806656811 0.48783588560305463089 0.074789887414415015532 -0.026412252041211552178 0.56363801778909283779;0.82417839330931874642 0.47084198278712863228 -1.1803942507418565544 -0.49649542928735734826 1.9509389840287998386 -0.58007358170542244746;8.6481632777589574346 -3.4965429332847701716 4.4744884818920285241 0.17092507703515141815 0.24660851737356484503 -0.79752069375064771339;-0.85635724629378373596 0.41241184227493515868 -1.6405793928659215819 0.072773368693202375446 2.4772771657339989204 -0.94064264113041895499;-1.0041483101219579321 0.558690105051727115 0.10431180460415641342 0.56053142985843129598 0.785293686400809543 0.25972665043804382679;-2.9156918154569382295 -0.46683182602020056873 -1.7237271783603822506 0.0051893210515479943831 3.8935670613918822447 1.6090491613699775542;-0.56599321332475549529 -0.19318478889836240842 -0.63897424184818196746 -1.2022385626039049367 -2.2718184019627503112 -1.3995585805510224464;-0.68927426941788627612 -0.41378903312344966769 0.41275855789022014575 0.14644435052117704688 -4.1866266440584904984 -0.97572226799665928709;1.0680221991708054308 -0.33455504364564814246 -2.3652516040565094713 0.1095148655612652594 -1.41432675155682408 -0.1442322400245927283;0.69715467899185268319 -0.44456243753468621671 0.21414000899978311021 -0.34476865165006431724 -3.1949581271806337668 0.54871328264159824339;-4.019934065677901458 3.1317225230827610005 -4.2725220194808164464 0.54731892057622066883 1.690858833731765376 1.5320161689534192995;-0.54485639257709317373 -0.80960275053656693967 2.8143472712731303353 -0.39829122207407990919 -6.1381352080586761844 0.35595493567509778332;-2.9785206290089463188 1.9768569580360224602 2.9025213949474233388 0.31345888537333199686 3.3307918767671060856 -2.1259543881438114354;0.51990864018962679172 0.020147435687993334175 1.8014015074300635533 -3.0421228937351418864 -0.31686613254291728925 7.4172736669124530451;-4.6613630954645968174 2.2856376038540084927 -4.7542360975306987569 -9.1831325442444491358 2.781223468701839785 1.7569919962273718994;4.5104585347600982814 -2.3776177954601509512 1.2594725217940967443 0.24199701960693384417 0.86208272208895553312 -0.57440779474733794085;2.1188768046245471943 0.370681778934030981 2.3618259432286450306 0.13201117020872160657 -9.905653144981659608 -2.2991839735043018145];

% Layer 2
b2 = [0.8289785586345632673;6.0179313931783715574;0.79308521762116179765;2.0907063066601687673;9.0827633646251122457;0.036623904175393046101;1.4825168955908170076;2.9343153735326250597;-5.8166067963547360975;-2.7678239765188137333];
LW2_1 = [-0.19415050511058476457 -2.5495381821293512381 -0.5147941450075094183 -1.8875306933592488345 -0.70336131825676995177 -0.56010361475305425749 0.2584605724262311055 0.66897729230882030382 0.77298740205544380633 1.7121678220818941085 -1.4716917251395769117 1.1242600672731277722 -0.7232372599205042496 -0.65709863985988803403 -0.8219926578088523339 -0.14460683348078287591 -0.0076117025407079728916 -1.3029981909126950868 -0.5879380593697831614 0.41046529586476199203 0.4918793646545012721 -5.6038982613518788511 7.5714021369755926116 0.016989691007889124591 -0.91509921202741217883 -1.2889900337004320807 1.4103920127310918264 3.2858829538262597225 -2.3363794468151759531 -0.22700222226366134626;-0.31504335946299794058 -0.27688053403993218016 -0.011238824372779546504 -0.73400838083496444675 0.96095841881722299238 0.6300394853345633317 -0.17060065873032248529 -0.081020085721540582857 -0.57552022892407650456 1.6925632622972421881 0.26425736844962000038 0.33760881802017234099 -0.08264027116885339086 0.16900409190887294431 -0.21161886900946288992 7.8373361578377753744 0.054690134220170508184 -0.34896860710635396741 -0.19380543559165736012 0.30511899861196850603 3.1237252093572793754 0.31712189664319290205 -1.8607257569036670386 -0.25927833766033930862 1.3182602815188302348 3.9387381445507090305 0.14954574141252266473 -0.9855154877538874203 -4.4452203685780009579 -0.29487374840450697455;0.085170544768279884962 -1.0899887904942393568 0.026592494956345365253 1.3365731918923671184 -1.1444294350878545519 -1.6471741134184059163 -1.5518005254588858044 1.3743521398509794817 0.1891439289371136534 -1.6619482744589459955 -1.1280240230030502691 0.44625493063281979067 0.11396064237345210346 0.13662127569031842778 -0.59778498918583300448 -0.15344774638733860161 0.47964797297715838775 6.3521366568853681045 -0.69030579323316476614 -0.17669444823008645384 1.6629713074862717548 -1.2308746278835469568 0.02928577801144097853 0.37624109796235133407 -1.9650786573966103621 -1.2518519742711358145 0.1252582253479690988 -6.6605621666390080193 0.43052175662360592234 1.4314176604827264505;-0.42961232842284946543 2.1410051042339985905 -0.11058669841736040729 1.0301593663474004625 1.8473539796125286738 1.6025953390203802051 0.63725056959420312008 -0.57546523209223743311 -1.6252755235560785163 -3.3337167679113659524 0.81484530729906967661 -0.15350319053277874937 0.50604974073113917488 1.3727492661698688092 2.2732528220618641868 1.3896856079738393319 -1.423178692183122207 -2.5245406607769482754 -0.22106982186358076214 -0.48728700534332247685 0.76509887908814089297 -0.64426266888768213281 -3.8699225954665967819 0.12384070966926329083 -0.41379906686632267343 0.74029306704912301029 -1.3654758625239300507 -1.2864816013594309041 1.2815089098673495549 -0.60542676629603320304;-0.033784550169252323959 0.41705411537533237931 0.023388191311560231622 3.1976950985441758846 -2.4148384939643192659 -0.70044564055871760822 3.5033490455291569354 0.25900573664350762249 2.7195277084119751088 -3.4750628112498134215 -1.3216103870993853864 0.099102365096932376609 0.69233742868242520441 0.98630708676588418893 1.8537362743917638053 2.3611944268468136876 0.17390100911186873178 -1.7685416594159191206 -0.6172417567173853481 -1.2257595437834447605 -2.1894501154293912748 -3.009275578739075474 -5.030453893956798872 0.37124916803457291836 0.54565078994772553411 5.031989335860020951 -3.0042565074234026667 -3.6951589698220157487 0.32467349888947055758 1.1124917467320418751;0.15465960029616288018 2.1055935869940993754 0.55368641197787504815 1.7653858985729145026 0.88543941274847759448 0.78335024030240041348 -0.31569996626735935541 -0.67371898233559190938 -0.56212516487367614193 -1.3979287894848497764 1.2505948393371426608 -0.97485124601354289364 0.60521009762683630751 0.67796870020000610246 0.85206465476377069024 -0.80932398187333853823 -0.042311877291040696225 1.8681208306500549643 0.47694330861241474029 -0.33093127253133314269 -0.68355259401426882171 5.9306882355031813603 -7.8900758438747882195 0.030799430200540670044 1.1508215818181461998 0.93748157228207174008 -1.0660143051522381619 -3.4596435775685678848 2.2791423446668006569 0.30509860076923128736;0.84611267863342376483 0.27257043089337634756 -0.070697741287390897247 0.95819536501631230596 0.6069994974060435311 -0.32857466950954333784 0.091854191210468311146 -0.30513478408928246255 0.83600839281641092793 -1.5047135747362598845 -0.58776751190309739492 0.018373656894163356568 0.10848462662187742522 -0.35152532496895350089 0.11424262628385832563 0.1716212169539993726 1.0435806676070096266 -0.52293314755620434742 -0.11438513190688218146 0.34618101649848093126 0.8164770391985515241 -1.0022955561901383259 0.26250640020786797368 0.051679571094697708544 -0.4597168323986153271 0.16203499528818282593 -0.15073197146307762417 -0.2165213319625862165 -0.19659619884216208985 0.65729568031733853761;-0.70841910020587373076 -2.4292601217571361261 -0.13861218596828192573 1.8610220274608610946 -1.414884025064601758 -1.5208178821961209071 -3.8098736062196052465 -0.31818042309763927555 3.4232300440091987248 1.7922826654663621682 -0.92367082100520603305 0.38088464784306519384 -3.7225857884728661418 -1.5674298146945424559 -1.0533367906628161581 6.5489976515180652328 0.54478056395190310734 -0.26344496792658977924 -0.99521358982177898778 0.21271185708943632364 2.6702065118844244829 -3.434704099777852182 -0.52357304861665399098 0.60694263026134520622 -2.4931798018277486761 -1.5761520574714005249 0.5017842758123634006 3.1923878767567694936 -2.3919511289272361587 1.0800513761205330354;-1.1810694723161765385 -2.3312355085310989544 4.8268229421734600848 2.2763912498857696853 -2.3304647600046761724 -5.6857896240152916434 -0.26910138659378296522 -0.28582267369661684686 0.49723572222915751739 3.0473699815071668695 0.44872199644981142219 -1.0240798218517832563 0.2041957058316498097 -2.4261497803475644552 -4.6346909374502986978 -3.2510930689227763857 -3.3144382500681190962 5.659280638712580469 0.78282546607065750521 2.8402950513019158407 2.8559402556146444851 2.1995102082256479115 1.6097074988882542623 -0.036689175787763865511 -1.4542836398970235834 -0.98699711513629706516 -0.92687263845835698994 -3.193156963546177618 0.18712559239785397924 6.0764370899934547765;0.90514074268427402448 2.0630430437888094275 0.20662512975852651009 -1.5426513843648790303 0.69843667095183470384 1.0528712714811525597 4.5447760903175558056 0.84337830607458508236 -1.855211228829103165 -1.210583442355672501 1.184263852054408428 -0.27662294306699247715 3.8147478524449902615 1.4709482952220194196 1.6609224957743056184 -0.69537780211812749709 -0.043297818091020012776 -0.34444430971261669194 0.60639354564258751701 -0.76134064283265867612 1.9685501120427144617 2.3775546212521314615 -0.60634761736960507417 -0.91720523432432754518 0.28354743491576989145 -2.7775598045094813671 -0.4045451091518944553 -5.2286528718694675888 -5.879443004849223442 -0.98166926857669301043];

% Layer 3
b3 = -0.70042626922227413377;
LW3_2 = [-2.260944819852165999 -0.93686434901736093117 1.6804149834512600581 -1.5320985112118865601 -0.29287489507477382222 -2.3089908874325151267 -0.45066993235577290644 0.7084030789886904822 -1.0852022738002737867 0.60015227852581709556];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
