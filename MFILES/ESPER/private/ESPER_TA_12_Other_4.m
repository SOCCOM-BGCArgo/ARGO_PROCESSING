function [Y,Xf,Af] = ESPER_TA_12_Other_4(X,~,~)
%ESPER_TA_12_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:04.
% 
% [Y] = ESPER_TA_12_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-0.1386];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.8413103955003882195;1.737398845703890915;0.84571198004381842317;0.43756762941509480536;0.044681556857401327765;-0.73266025244952348583;0.38548067677978686829;0.13316593614279831348;2.0711628291199168928;-0.051556547979908502743;1.2481669489885496294;0.77512478089610881149;-2.2160832982264704327;1.3032393917548004136;-1.5733856368288663408;1.0633306606253907223;3.3685828758232974067;2.6586107148937143663;-0.42940925234689547585;0.80682334122329113502;0.047648430622104956389;-0.6427066265977577908;-1.2854785032239146592;-1.05482040215184103;1.1552732040550097725;1.7412250267089457445;3.967231807838314861;-1.1803253887686431245;0.9336388040811964828;-1.7421674613834801093];
IW1_1 = [-2.7289443604795526888 1.5948880229568711542 0.56016067708249472901 -3.5670607015657540551 6.2232311725818121317 -1.4367863203315154319;-0.25799197908548437974 0.0040741998092300073589 2.3128365966781219143 -0.077359094004329359562 1.2407208768914741448 -1.3445821725728750451;2.7743025764146982404 0.02423002940474696526 2.2404185408030414806 -0.41673121675028557132 -0.48015578514198692384 1.881164979280567362;-0.93445907760927238161 -1.1145370709442499191 -0.087975959628053837513 0.39381992821404571137 0.62545037795673519287 -0.34682197974409045838;1.4512385382585639704 -0.021577435410584260012 2.0886603992203460756 0.60738030604227111198 2.8032313226145832985 -0.37455390618581785311;0.12586575109013653506 -0.017127861414353514474 -0.48466941744913100143 -0.39390648516910853338 -0.26237785105952943221 -0.12797321366795416653;-0.016460774318874219629 0.014306156170694764307 0.042500677841453275707 0.05352847742234676659 -0.045634422286582591866 0.11878992300436218288;1.1626101479700297059 -1.6586397798071506049 1.5377423408029005092 -0.55215906178543638916 -0.3306688777685275471 -0.93325919279642965964;0.045725423645980180221 0.095350303329364755056 -0.010268014826529676953 -0.47900404133153967612 -1.2558809468998748393 -0.10580340543603042325;0.26023640974496931033 0.9477793283524783563 -1.6497967218508102771 0.70711403829853802794 -7.0461428656366660306 -3.0710052905029172621;-1.3046789491737484923 -0.45331729210897225846 -1.3015132554526103181 1.1205128356133402523 -0.87006620757119856879 1.9506506872332907143;0.061119963741677094116 -0.038380371259920241511 -0.6750345204191293691 -0.43988718008467481146 -0.52704104693210718224 -0.53916727849150758445;0.093230936228145475098 -0.54797345993186385993 -0.27909073096276548753 0.50140003866993154702 3.8526280587015939716 1.1111176759405956282;1.2973662821138869372 -1.1991932361524400008 0.98564918951912761091 -0.40062521096083864025 0.78251778147643746841 -1.0618514722413887608;0.92765897740179414921 0.7054365416701007252 1.4111374077599627697 -2.1524801353683851168 -2.898928769150750373 3.4422626507939462215;2.3753584481365117576 2.7372128505118094033 -4.2174649966363393361 -0.12459724300752791915 -4.4563409403977027878 -4.2904356848011548919;0.93557268366819412719 2.1105214958407993997 2.5517760499516843886 -0.29057215332496616478 -4.4287196714338827874 0.39452338508307166487;2.8603936572494155222 0.43019036493030593515 -1.5590650575769098296 -3.7292325888354325159 -5.9490177062882603209 2.4109394451869872178;0.79465204031395253459 0.3210594866084030552 2.4543280359583499184 1.1033975194896785688 -0.0071759895691053572631 1.0669412252515935169;0.37930436437963288565 -0.35984698963482886214 1.8075816847594501358 0.88728466627926538823 0.93948305855787184182 -0.78775299647327845509;-4.955472049672668966 -2.4730159899330903528 -3.475850601844357346 -3.8161021817655496058 5.6502962925622028934 3.5829686934813973487;-0.01134179108139165941 -0.12220154126384064064 0.041130305377169606995 0.065778334400962881756 0.62857699445045456255 -0.63997911291057252292;-1.8349221588230295588 1.5680449050792457655 0.67270824930860417812 1.7969759018665680816 8.7338779508274626551 -1.134992254463973671;-0.68545759971864839155 0.64700998641245321963 -1.451244669564938361 0.0055183856616219566574 -1.7531334654216410573 -1.0902472815645516402;0.16888428672190702873 -0.49906399068076823244 -1.3015991020299282344 1.702684113315830805 2.6190339456619082803 -0.48930061466673946402;-0.27518774124196254682 0.028362251610478683012 1.7478905447263033412 -0.14140976618908870921 -1.9333598146066253154 0.57634417218687605811;-0.46972459360567253572 -1.1184974417948003733 -2.0918792757997923815 1.6079417305066947552 0.099604751569591504223 1.5430846879995621102;-0.019820864865802093752 0.029623273280594442092 -0.38640303880378218393 -0.13524004314661092208 -0.40739179947511416913 0.53863821620034091353;0.52173364045353731733 0.22085739236932280805 0.15405356831626179637 0.93997640908692259298 2.1008603425209129156 -1.262482407637836257;0.28114717620319851221 -0.020782670377998989364 -1.8227755737269746295 0.16145946428032648123 2.0505009684276198634 -0.54626065444004445748];

% Layer 2
b2 = [11.685813726407143776;1.2675897911414883978;22.734348093885348163;14.513372821038096561;-17.7662645721616137;-4.5962056620703801713;15.523173182233794165;3.0455406026031566213;-19.891454845973118637;-32.712999363859509572];
LW2_1 = [0.070818775656050700351 -17.420111987551866406 -2.8165362112044367571 1.2094045823867218825 10.595510193333781856 9.7541300191560313948 2.2208358136276746819 -10.13737201472425653 11.131132600702493107 0.14478320219984475159 34.271344825210356078 36.282323364867949067 -33.929189914283895746 -33.981166900170528322 17.720136745972972392 -5.8690991940092915868 -7.7009704863103580763 16.916784963528385788 -11.871599780086290465 -4.8914844437113345066 18.572299628022534534 10.16173186988797994 -6.4888625817731346856 -6.3153861718739543463 1.9901350865189726402 -7.6373323952661396063 -37.140903668339632304 -4.9456317177980144706 36.262132102578725323 -7.5400551464453418049;-3.0237003529381296651 1.7006744289841153606 -1.4993991349197328677 1.2362345766797790958 5.2919479376688984829 -6.8382709058253512424 -24.070597937154563084 -8.1056732935309430133 -16.13081707100615958 2.4666878903019355818 6.1368738211529629822 37.148408839894770495 9.6064639830956117805 5.2704671869516905858 -3.9686971117311413693 6.4309619744523054408 0.90483029877740683844 -3.456521550715692559 3.3880557017638177619 -3.0903969434435940578 -1.9619329338109170457 -2.8577372265518037331 3.1890389973291237702 -16.320103323704728382 -12.63193042575701952 20.821117425877055496 8.204717805325152824 18.393219141450071419 6.2948113524865210167 16.299278698294543233;6.6187131748051912794 6.4777760670293886847 -3.0642592733135987082 -8.9419945922447787723 -1.329040334889175945 7.8254128841139536377 14.877248870862592511 7.0326675769030284613 2.2281026355722484134 -7.583749983985252463 -9.5442441052675928148 -18.45248277414504301 5.1753063625262605285 -5.9765960162751143869 -7.7622638066598694806 4.867361563660688617 -3.5025393479966320243 2.7363788938638702319 -5.1778294706141165804 8.6346426774875180143 5.501822833197342888 -12.414797082506566994 3.5599686427243937281 8.8675944825520289783 -3.1827206541962502762 -9.0687089042756241497 -11.22617118474074438 12.777382095069091505 -10.740283597434094887 -3.594391860389246407;16.141416978362311596 17.380358892979824503 23.59218301648572691 0.54275894412300962344 7.7399776116779435142 19.163797819496036112 15.645439667027149611 -15.203039124422321748 32.590065002836936969 -17.263382839398023094 -2.0051441423903475503 -23.6910432365223933 -2.8239130915161116953 20.741002233669618704 -5.3487300217217805809 -1.5477436389054233246 -17.998401967273704116 0.27415627538216541526 0.86342657654644017207 -8.3872700146487968453 4.2257962238633464125 -7.7162790243923025102 5.9935027040278106014 -1.1133068916839790052 4.6488715662268980111 -7.4094867531484238654 -38.193289700428337596 -14.291748171821716085 -2.9050704037063757035 -15.772788059385129955;0.021178606764274937602 -0.31141518914327959155 0.031517950218098632342 -0.057279772247677364361 -0.02908460461955848439 4.3887491169074595021 29.707630454236561235 -0.025122905439780074399 5.3177697764147815462 -0.0036047168524611082098 -0.020933808756452478711 1.8193810798043328347 0.30853574687483714678 -0.077438721813246930159 -0.046292045656742455972 -0.0055180710331927812495 0.018682269858074633528 0.0060317273678994979408 0.099005522705398932293 0.046020504947875559565 -0.0074440503345585499334 3.9331952681253987691 0.0123864204114853306 0.046516445842604288441 -0.12327999585285839834 3.7090690513588766564 -0.069705098712291690966 -6.1730690901633744616 -0.23666785124842396049 3.3462515730893551691;-6.863198745475759921 -21.197397380762616592 -15.452861207233276275 6.0021532181153851582 10.216785719652348163 -5.2370058589960821749 -27.792283848154433201 -5.1444570786407481933 0.011887510858343644862 -1.5961415788252091286 1.6792834470390634038 5.15468703256648908 -5.6944424534698905305 -4.4536215404970924681 -1.1519201432949872643 -1.0067308646826300667 -5.4727352721103903477 9.7770072116044879351 -0.14959294326186553525 11.295163479435702314 3.9999365504254238424 2.2758768131702518112 -0.064247647196769716582 7.9805057517358788388 4.4831339823751248375 6.7564730458063833041 4.936669846729718536 5.0229306919409157928 -6.076586331296444321 21.703077297705171134;-2.8011568957037860095 3.795997173454470186 -74.848112838587923079 -8.6865279451691108648 4.7037657989207914966 -26.625489091831820332 -52.00754660829320386 -16.807286989304316194 -29.585620166377651685 6.1953132740424114999 -5.2752600885754654669 23.127128157945307407 -3.3124542481051526543 20.28485972303734286 -0.20646821899301279202 -8.7934480003180279795 11.016225996170986079 7.3644331015981459032 -9.8757912699508185739 -18.286207468947864641 10.3552886866017122 2.527101010455494734 26.023055695297077961 9.5282723479145143841 14.544262298576628112 50.085963349965950897 30.324093182125469781 24.450036988942326133 -57.837667200693253733 45.403438739545499914;3.9798081213109326448 17.869663820936352749 0.014736950523460976351 -23.330972308708659568 17.815693002412078982 -45.859912056033955707 4.3485880571341262169 14.749624021678393149 8.860026016500556878 12.281808618594000748 8.1150948705811618566 -3.9781147171787525352 15.576366453387301192 -1.2140798456450796472 11.538558221660089487 9.2998230566094512994 -14.638072313279684167 8.2780123001750443024 -32.269774349245594181 32.182770032313534614 16.952653596956292148 -33.956548834008678739 -8.6492883220355096796 20.893449525862578753 -33.167732136629091144 -17.492438500913021215 19.906395990426837272 44.845956465931045898 9.6271575574756926841 -4.605181846510535415;32.131470323228533914 -5.8734599004857734883 -12.742849911863368462 11.659076303079681125 -19.603980118194389348 -24.334722640870079857 -31.628294194095612824 -9.4156238858774177203 -44.058230526478503464 -16.684632742523660909 6.5622687378008990322 22.866494751408144026 -48.072883102353529239 11.561542536347088728 23.181616752967485695 -1.4500450607931234526 12.245949672200474367 5.5176310299022883754 3.6112480864836906669 -54.760831342124568266 0.92843600194014352933 26.364440263284485866 -3.2088013696817752063 -24.669958806155534603 -45.135045098028250266 25.853936525858713935 -48.191153855249375226 -18.669970013011742083 -2.1225575473183440067 4.9055915972326875618;3.4465416143239093749 -0.026158885402408408455 7.9783779293983556613 -4.2006706703982565898 -13.874435741075096473 14.9774790823581192 16.897180362748681404 -3.3999040230455306322 27.497581254421824326 -3.5352160745049627799 17.14727045894084867 27.117318323104633748 -16.519475300720912969 -1.5897368819027368758 -2.5258343804150955592 -7.3925765801142935274 5.6956256854641704734 -3.3849627792249878944 17.701243549992348392 25.017020468814113343 2.3342223126980012893 10.792431802213940273 -4.8652610122892880895 4.8431587306414343175 2.3876072028801140767 -16.976908008288905449 -8.800962974535472938 13.086871478457183571 1.5459490419030315067 -13.312875814922806583];

% Layer 3
b3 = -2.7388213545944473104;
LW3_2 = [0.0042204059872617835994 0.013756536469928750191 -0.0087093294567685206053 -0.0088954001092862809014 -4.0629475393260969796 -0.0049623225914514311474 -0.0011351320448771892724 0.0043252951756400006417 0.0036193638423146715782 0.010787740004702475044];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
