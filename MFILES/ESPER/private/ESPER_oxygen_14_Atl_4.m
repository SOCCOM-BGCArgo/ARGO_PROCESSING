function [Y,Xf,Af] = ESPER_oxygen_14_Atl_4(X,~,~)
%ESPER_OXYGEN_14_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:49.
% 
% [Y] = ESPER_oxygen_14_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.03];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.604229607250755];
x1_step1.ymin = -1;

% Layer 1
b1 = [-8.5080136706504596589;-1.4833956074411120962;-0.84739755220936785474;4.9410640227424424964;-0.30299156991649545123;-7.5199546265220957864;9.172059834802629652;-0.25599696849411346378;2.7546162688807163121;5.3282825571552434596;-3.0659316172764454755;1.5964589500796486643;2.4896184575335698064;-1.4952891469642675126;-9.0571049286578428905;2.2025725406980241061;1.4147314753534756537;-2.4181257665794682055;-2.8726149777990235279;1.0141006263476071148;1.5059898686309698412;1.5786783473415226808;1.0108048518534948901;-2.7835466234906607319;14.055315570086056809;1.4455822374839060185;-9.7720213554992341187;-0.93776936099424068605;5.5378809199159606536;3.4619956166384744378];
IW1_1 = [4.9135834959774937758 -1.1948855077480826647 -4.079275292206375525 -2.8789192451619527446 6.1403283471334342281 -0.10292965270132312106;-1.0685664236972713947 -0.56422599088661473665 -0.66422148238993961034 -0.51780224081247328005 1.8047921640474300364 1.6181575454534087299;-1.7995106734545629479 1.0702150226344919748 -0.28496311810701074885 0.97057976850372607025 4.6166230135367669618 0.91660339520434097604;-0.045950675831838393159 0.28003843807905831609 -0.91462403860653240795 -0.87630082393621455683 -6.1276850952835646424 -1.0969977924877014619;0.40512481326708293938 -0.84318976213845298062 -0.65934109349121616805 -0.74812174685382537564 1.0995070955042263172 2.0155675151807823653;0.34924816831685162599 -0.69429918178651028882 7.5433724391224270533 -0.092785013027184060075 1.9318838800438047354 1.6523767012032679613;-0.30817922807606640268 0.34444789305091455534 0.91942220613414737951 8.9110714959836005988 1.6366827216474266748 3.9749025777609143795;0.36861467975763101412 0.012689095744548914771 1.6591663878839169044 -0.12653707009380305015 0.24714260518669114997 -0.30971915618481371535;-1.4215064118348053057 -0.054197596855109698988 -0.68843934367093373439 -0.55553280491872791824 -3.4804870237728917637 1.7009482793800982936;1.3240771677705633902 -1.9594436463477082899 -7.2328805786428436164 0.45143065328018627813 0.212229920532209404 4.3744259260063991235;0.32171384272592068454 -0.039973838344479421802 1.1767471772083903936 1.1626822220125352381 3.1086586819258155145 -0.26751040825796257305;0.77832771601369388215 -0.59744465172163385702 0.5386837810612508104 -3.263078666555537577 -5.8717442300144710998 -0.85880539925586396599;-0.20401648420983659049 -0.63546496759348358729 -0.032284203353643528556 0.55552980058893264292 -3.4754408933792717562 0.92127648280319329732;0.34140989131500465437 -1.1105746182334310657 -0.430408930872479778 0.40543708595145766527 1.3327502913994069278 0.64628308952438906498;-0.20842413378291829718 -1.5287055970887224454 1.6270988950257543326 -2.8453462567774794323 8.1599472135380821669 -2.2173798105654558555;-0.45417768401373892484 1.7175801697366348542 2.0783975323368903965 -0.4151861566116190061 -4.4874988874868932953 -0.92812767169069698703;0.035756848308522888591 -0.22752874257405530933 -0.48129771523074760253 -0.10433705828756412171 -3.2766907455802432025 0.056878690850273673496;-0.5547913797421230031 0.44003260398530003039 1.668137031349635313 0.49075375818000316341 3.0147276881872255849 -0.99163833045122695697;-0.92524424002039151738 0.021999037956209874234 -1.7455787626523355804 0.10982884594329181405 4.5943470179242176243 1.1147329690486820208;0.3386121149612335568 0.45749423803856864579 1.4319214033793969953 1.1573103062646290518 -2.4186328522776627814 -1.4326699078415781052;0.01810751386016417469 -0.069237828425108061126 -0.045606272472989733968 0.44871067736947256588 -0.6660908235261127075 -0.4018542289926054778;1.2235133523361432228 0.93469276327385653058 -3.0944747254633560019 2.0302493849144074289 4.0224591217134983978 0.066983271195010407606;1.2604728527223616474 -1.3004565970811017284 3.956991732770778647 3.8257947177590811982 3.5808437878649548303 -0.19415600825739018354;-1.0932416664327992972 -1.2300446496564196863 4.2810710447825348623 -2.2274227881420425312 -4.0470594640217711913 -0.24092401231742713308;5.9076077463616849528 6.4379519800904425608 1.872504307119634559 5.2051697260481644136 -8.0584637871722346603 6.5704851434938911225;1.1099053592359908738 0.0014607226344305109661 1.896988762729928002 -0.097251805878565189545 -2.9751970387621180514 -1.3167499358458472081;0.56755919073292293575 0.20597630141150924388 0.42720625110794940849 1.2281582898689795691 13.649618288369442354 -0.070294037910401535596;-0.026034412701717433991 0.38763958307001816772 -0.035077372262040641682 -0.782580339558157978 0.25414940228115112664 -0.25052719242250753862;-0.11786838704004097556 0.39018997097986013456 -0.69543931425952876246 -0.94568261341719228597 -6.9305468885057042172 -0.56625768793074904295;-0.50591957941124476861 5.1207428624673543283 -5.433742351282871752 -3.3731858082494499129 1.4829988347125315773 2.2119817492468389908];

% Layer 2
b2 = [-5.8182164017255963984;0.0063856045797419450083;8.5885440883756452024;4.6605531723230066987;9.0769157770539798946;-4.3840274957414937518;7.590248283977278021;-5.0003013270132257162;14.253336111165653577;7.1010491032134375189];
LW2_1 = [0.28202637998173563094 1.9014745177991296821 -1.7247147081180116412 0.68400766446459160264 -1.8779636352554429646 2.3878574369204117467 1.1769772120098356272 2.9449454184562862125 -0.5564322185115967434 -0.64745312638771845837 2.3556410245158727612 1.5973804613712225819 2.6786838429353951874 0.8121270126283224311 -0.48565150421152331051 -3.5197429948437459757 -11.811973558646064575 -3.0134037522590846336 1.5421214120297634942 -0.2415824188091068303 6.3382582572709829094 -6.9242792417938012761 -1.3314790555250768378 -5.410410174982909659 -0.38701984235067882212 -0.74351786998811386642 5.1265148905202577723 7.3639280041040171554 6.157658133141231005 -0.91605688830221609908;-0.70249210958506136393 1.034745152360036613 -1.8900452757379495594 6.0330242793540458379 -2.2384714620610468572 -0.21674225869750543549 0.19691776572396285649 5.4741725726812671127 -1.0001037654288416068 0.2515440786435282905 5.0334564940694201951 0.27688456297411812024 1.0622030045374946106 -2.0333051633241705503 -0.88138501235153143831 1.526230761887476417 -6.5035124589606425616 -3.4386542341630552677 12.417711966893291375 -2.3259494804341511731 -0.62093766568032060515 0.24424722046746988324 -0.59105175637584839166 1.0633482077225597795 -0.18342245674423190982 6.8001873168875084374 -2.7084937353485512013 -0.24932220498484847226 -5.4263473872418899191 -0.29578664688540862171;0.24010254683093676387 2.0026642969884864698 -0.95384348358037729376 -2.742812346405394397 2.1653056670672294892 -0.28377321564211732685 0.25969366809725141776 -11.932135285416391568 -1.0184460349441215588 0.057117226942440452175 -10.307101207326594405 -1.1777259269781288342 2.4341635244755930323 -4.4652810303030125993 1.1240540903703464259 -3.7576858462593372145 2.1109690770352425027 3.4728184378073945204 -9.6937817140414210826 4.5216542732424578332 -6.672245322496580755 2.6290991729771469032 0.62257738509856386244 3.4507610983427250417 0.16834320299076749317 -2.768478386382552614 1.2326073647698283509 3.0616038173711035419 -6.9216642205641267793 0.22002000090293191703;0.39859175045776873425 0.575874481495860846 0.32432633775238522977 -0.90473619181069353523 -0.45662411993994966863 0.18464133442113545014 -0.45965280790186435755 -2.146204343539489745 0.73893031338869652469 -0.35670101671155096668 -7.5568080708158715808 0.0049546094476407131352 -4.1504716774178929128 -0.073424213546709374278 0.29472720966641496876 0.56674546533838121576 0.17471487863368334592 -0.43839874610159934587 -1.9731589755103278172 2.1031640993886870916 -8.2940135066602351799 -7.5780458953458182947 0.043236739886427684454 -7.3789644998758765482 0.28167743243493736927 0.22937773158725022205 -0.21670118628687815021 -7.6966138084774904371 -7.0900877098691656997 0.40808631765995134755;-0.15362134457217763162 2.8341209739469479523 1.0068294166220261854 -4.6282359671581305705 -1.7800757513850518077 1.3908715643103310988 -0.17319846697822777193 4.517779442102397347 -3.7536561496922740133 2.1054262053182553061 0.15309973956306760501 -0.1873144614103037231 -1.639208474522745318 -0.13784832900173307757 -0.31789310517862368055 0.91962127936905402326 5.7194617634271764928 -0.25190938676563562337 2.2669026617449548056 -0.57304697940438531489 -2.9438378676355378971 11.419956864190474732 -2.4846193927282818059 9.3379799197648818421 -0.249442719894201137 -2.3857407246087767305 0.91403149723051502207 1.4722425332529405217 4.8846890770863646836 -0.78939513575026509784;0.21194433773843709967 4.11415622219442767 -0.31105502087362019159 -1.5498092526825013593 0.93122969944752098659 -2.0922026318579662885 -0.20261576738778300233 -4.5818128942519642521 -2.7811702610335240493 1.4589057996153467212 -8.7076572998120607139 -0.060147795343896109932 -2.0890186333692635223 -2.8451969716393499255 0.023174393902545328133 -0.42997894418457449639 -3.6768905747102973436 2.1732454303647759097 1.5124775288633747206 3.3172335604532530162 -1.1718081101826924861 1.5469670706058407106 0.52370430585827587588 2.9655243905646910818 0.13890270021513809184 2.5850095902617269417 -0.98803231174184824592 -4.900311382389989312 -6.889411928260125606 0.57580463664205261409;1.0214751033772369038 0.01592878496820104503 -0.77329070359128737611 -5.9935411397203059991 0.84505365510509922178 0.72332648872616689406 -0.23683499987630940442 -9.9326307740747648012 0.10534855785390455363 -2.4563749988739784769 -2.4544213244402666163 -0.58494836858703980198 -5.4730405724348933916 0.19122760139645358923 1.3522960029546020611 1.1634871012337775209 10.183412937029988399 6.2612367454173396553 7.1020467175758756895 -2.3950878129871573385 0.35308253236850739576 -9.5039579395577149512 2.1520053228686708557 -7.0560162926030844943 -0.22091997889788880793 10.993072622831066454 2.1710967040392263883 -0.4254647875007442348 -2.548989520599764802 0.047023897017394872266;1.9662486025235237364 -9.7442468061497180543 4.8239441195848913324 10.191233181398594354 -2.0149879814232178887 -0.027110052173009144272 -0.46553142214942022648 3.2500716975192789349 -0.1767808823991956213 -2.2352757095518449582 -6.8415084399092975787 -0.46319073920274422829 19.123089804085431354 -7.2675910752753303257 1.4146492007048012685 -2.8761604739391724017 -18.094446066354770153 1.2070746578084505796 -9.9909136953224155775 -2.8066473312582851385 -1.7348466989438944275 8.4251213748993460939 -18.351058624397090568 6.8131229503536374636 -0.60901777414742475081 -17.231441951518586819 2.6703837542093094015 -11.185988455254822327 2.4774918047589955528 -0.20179528955820202896;0.85330865761866558916 2.1488432742372713946 -0.21287387357086012818 -1.9199744804400291631 2.0841641296542716688 -1.1580203881488000395 0.62156099033535272547 -3.2665522296407591973 -1.293323863664671558 3.0207858527117759095 1.0044165171492183131 1.6410163126286136936 -3.6069759914828884995 4.6920108373790156975 -0.43256901976808215249 2.4206893444099910617 6.1368584952079734407 5.5061946896168425525 -0.35222057292269803863 2.6979189038009683266 -12.710040675908757635 -1.1918430968148083782 -1.5497876085194965956 -0.84247280402427759949 -0.2337998673802805516 1.16884608339289775 1.8183295594269446305 -5.7687261057516314722 6.8883953744764605531 -0.0041817904445916919201;-1.8625404533159433118 2.6935880584815210526 -5.7946712793337127323 4.1889571547168280574 6.384737179613929392 1.3678657033822265721 4.392379553014134963 -2.3264533905938242775 2.6031234549291779601 -5.6012530931510733367 -7.7486610646209621578 2.628067358100217632 6.5259110954258821025 6.0967610354732624245 -7.1737580754778482728 6.0569221592336512927 -0.56111431631473918102 -9.988440478414339907 0.03380429131906785567 1.5752201532658141048 -1.4934837651676289294 7.0477645927038441442 1.9708911408422860045 2.3945041473458124059 1.914327484666930923 2.6576959376560966852 2.7896716363451177223 17.68285265317453181 3.6098870972842171945 -2.8351511558026176729];

% Layer 3
b3 = 0.27912840648900016927;
LW3_2 = [-0.072123075746047773937 -0.25376386119808230779 -0.30560241756314227013 -0.3072565195549301631 -0.159689895729152459 0.15259365482928854973 0.14101218271725127207 -0.083126290566526775394 -0.11061552841056800089 -0.010347808706634251119];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00368391969055075;
y1_step1.xoffset = 13.5;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
