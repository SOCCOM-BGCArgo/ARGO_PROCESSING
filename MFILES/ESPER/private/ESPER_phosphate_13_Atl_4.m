function [Y,Xf,Af] = ESPER_phosphate_13_Atl_4(X,~,~)
%ESPER_PHOSPHATE_13_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 15-Feb-2021 18:30:30.
% 
% [Y] = ESPER_phosphate_13_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999996490807;-0.999999994516886;-40;0;9.1619;-0.28;-177.232103709389];
x1_step1.gain = [1.0000000017546;1.00003626070655;0.0153846153846154;0.000309885342423303;0.0656325902039552;0.0470499670650231;0.00425400504498441];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.9173863969628870407;0.95468664885806464593;1.4090736363393341346;-0.89472869158677215129;2.0271123400218677979;-1.73395182652885671;-2.1137387489408188124;0.63237485015911609754;-0.11518702465376959299;-0.53179508635191830024;0.49429125632574610893;-0.061582580418184401649;-0.58591056047153056152;-0.20125370357861407933;0.22022195789341708627;-0.49463758295484017147;-0.11049012217172229922;-0.75265947931900123447;0.40896701306350224936;-0.20257564684594053794;0.087193310187865677441;0.5580662620492714554;-1.964231810787556709;2.3117662170199717586;0.29321860120374454439;1.0622340197815023366;1.6460743925193270787;2.2319122349016344842;-1.4078667059645950665;-2.0264769860836016058];
IW1_1 = [-1.135368282558002706 -1.8605645040849312366 -1.030823173313615726 0.0021259367153899934831 -0.33508600499135543505 1.5844735137532710567 -0.6703635440069672935;-0.84446413638799400214 -0.045283379777277463218 0.28095342372075515769 0.39407886669332370388 1.7201221974545644056 -1.1409690370939349346 -1.3602520590295219538;-0.50749494969245645404 0.79758583012036332605 -0.9646197712910816735 0.12096193244163963576 2.1281450306024329855 -0.33964002097311113415 -1.3309906597928966576;1.1878236900769854056 0.96012275081612874494 -0.46511417458356413279 0.057030878592674950911 -1.493884645084817997 -1.7102350750833674731 -0.96209443998421839694;-1.565346001947802268 -0.25060386377092747079 -2.0317010693031520852 -0.28953674175514310107 -0.50069208682428467672 0.8165342638916401885 -1.4858419143003340768;0.83488058756813665617 0.31341175287069161781 0.98940125701597125829 -0.13209430630822602271 2.6975493460075896657 -0.038781102655216594111 0.13544038940698555074;-0.15478614072921778599 -1.5199939455829922785 0.95597399237363234192 0.077848218337460889371 0.55495874443012538357 0.30788763888903003529 0.4353576647483572426;-0.35695750073655946322 -1.1099538948791547455 0.52163177099814495019 0.3333088298028253349 -1.0720945350121273698 0.014940347822610621636 -0.41551602609797000376;-0.39129965621135592846 0.22989059446977924694 -1.4858645707553159721 0.87708146683172361069 0.20758599409592307095 0.59570310921845226471 0.81954286770895157233;1.616556503120543109 -0.24840254768129513274 0.88383506873154171757 -0.91444913656425264037 -1.4157027711546796844 -1.0262677279157936816 1.4803843772803979562;-0.033875292965289453828 1.0804640716597344596 1.1348425085289319814 0.039011299237106715487 -0.49801500154823763467 2.308103598217582153 -1.4927518793201906;-0.22528099315532362779 1.6034415799806052139 -0.96584110522327881743 -0.6280806508356796547 -0.48299445031158599884 -2.2136727304661336646 -1.3509008978282428526;-0.5305228591489467016 -1.0630401997490956933 0.75768226185229137215 0.035249717513137636404 -0.37452267068933575711 0.87324061259545038283 -0.46422828613086059013;0.95487729682272748377 -0.22574089731438023998 1.420512112656024728 0.57281812249436570017 0.98053921291030721186 0.81051930949139383564 1.7166931487718979366;-1.5842895697521568454 0.82729878396123357476 -0.3765077374807910271 0.73785841793309991932 1.2236514217388250181 -1.0104530894855501266 0.27724106176923585254;-1.9892979624832156649 -0.43398628699051228219 -0.65347487374641810565 -0.25785263690585957796 2.135888439785724735 0.73473837002144704034 -0.71598300827690619652;0.08424458531718079235 0.01868929466502238998 2.5828829721475785597 0.064072356227255392036 -0.19926010235334301601 -0.92106140998361607508 -2.2391204134724262964;-2.1925675909692912136 0.21751494390677653112 -0.86453605602513838857 -0.087435288461411173055 -0.1780057216163258571 -0.87981791569825817945 -1.0482736248959265701;-1.1064592753533730729 -0.82365113014136503988 -1.5890368352338177793 0.30499027173217235775 -1.9691874495051548966 0.21403660973853275151 -0.59887697282856078296;-0.39703774242547373863 -1.4915505970353390985 0.21499729175685422522 -0.58330382696727667291 1.16538052381966728 -0.13467467817559866661 1.3013407038679922767;-0.20828793828569591717 -0.41167886745481374611 -2.0652454559350763574 -0.0081206332307923630165 -0.54038595617268514459 0.78486838433224326295 0.55372653050427067534;0.05343152227126106435 0.35436102956697573818 -2.0197922421153258199 0.48888172945569480232 3.3933802964056365425 -0.26443625339299420274 0.31500020190709043799;-1.0581119172845920851 -0.27847656356414163259 -1.1461617940315969033 0.42922510857017548425 -0.95534117418044905978 -2.3000191099777294035 0.39866026753456440535;0.3897747364027179251 -0.68265660046354947887 0.78978994109629108156 0.21242966793113005064 -2.5407129343492220741 -0.19520068255131384216 -0.67289400969427559662;-0.37019628021168143883 -0.14170605757892529297 -1.0213959609658358474 -1.1096751692291351166 -4.3849776322484199653 -0.93155749743358584603 0.44617210094727999259;1.4225601065544450918 -0.38834578101904837499 -0.35065833471008822642 1.5581091472855079783 2.7898980249208671367 -0.20406667194389482844 1.4032500893058375002;1.3277125074988742615 1.1064170016757799431 -0.0029869673201166312138 0.7404413709824751999 1.432461413459868993 -1.2723723212220188206 -0.26006354106838341922;1.6036745876092515228 -1.0385796018928619144 1.9866056381049470581 1.3532592060275456802 0.5383203372419674837 0.66702315500470932275 -1.2296247987998212281;-1.2394610985458727193 0.84354138403291945014 0.41755449325703225538 0.35180998981028394068 -0.38634392259588457019 0.59150619163321127569 1.15989283413155575;-2.0360381780207812419 -0.3721947005340561776 -0.068871629733912795301 0.20671146627579684019 -0.64806216701339613984 -0.26368714084052463642 1.3550377402389779391];

% Layer 2
b2 = [-2.173260630745496691;-0.66142737954644359455;-0.53973218013705737128;0.51004634927464009841;-0.91387608426803412787;-0.93141030285792691945;-0.39251823357385989821;0.89408094515212621634;1.5771640194815446101;-1.1655162132272052222];
LW2_1 = [-0.75334139149084256015 0.66409996767789247762 -0.66765871981197233431 -0.014200398239497149036 -0.28066396757837419607 1.2896108404997781438 0.24908050745123244685 -0.10515727376603284382 -0.026509842839246233748 -0.058959645466472004882 -0.1106831530632413213 -0.81650815890993955204 0.39193404598042119735 -0.81693647686155146381 0.73840318824390704933 -0.19922494997098746938 0.71270808365765547787 0.485259015034735397 -0.088321457432473174376 0.61455882923191951228 0.49626465953486925686 0.90491652196726179991 0.12230851758369074012 -1.1430991228086326839 0.20236969343925378939 0.81440767225229226955 0.58626526114979249371 0.50184519219208045815 -0.13118810692645876959 0.11115238547959305215;-0.56612445824003110317 1.5740338238507038948 1.2196711297825724163 0.089814231192341345555 -0.0046088206909569284092 0.099245327914363676292 0.17484726182573054332 0.11390828539261638186 -0.082969960987649998829 -0.55579396656985591285 -0.27798625360368189874 -0.6527315660565659039 -0.16210263348495759783 -0.42446012060612764438 0.54519606207494386574 -0.65164605073044434835 0.76522578875573554757 0.23461268503785531747 -0.25877398081456420842 0.14999514889474768742 0.47609450676080899978 -0.92910158474148163421 0.075918335460037580931 -0.76693286827802686911 0.42328488927550816934 -0.27340141839908527199 0.28111931342647555887 -0.14980209289610604828 0.50421903507272380907 -0.3314011741606531225;-0.077655992507082563514 -0.81640303817139903142 0.46949901493666373886 0.14342795170193045617 -0.60190991753282785393 0.20092116974939530638 0.68232886985083263109 -0.071880499571366371359 -0.75117168394274613785 0.85010019153627258692 -0.76089385994009839376 -0.23787661598689582854 -0.89732833184955285155 0.21209851274432545143 1.1468805350780952867 0.54604532265600502772 0.48510803605580243847 0.2679959269689433099 0.46374347843882463005 0.3089563038443653431 1.0987823989898721777 1.7203180253043530712 -1.029685179235455994 -0.26217737269009722123 1.4508589489228409519 -1.0386394311148341441 -0.1408796839869208839 0.38573928335776586085 -0.24173646246875873933 0.42948172027311665166;0.69678360726923571633 0.16938992525956445001 -0.74182490332962180979 0.063229229373269926762 -0.27918237209676549648 -0.93503114158590105998 0.55351070152938641744 -0.61048065717179444967 -0.84275240024769104696 0.23728988594285080338 -0.1690446154113391386 0.24026177394310879731 -0.34325262583632931701 -0.16811618248044013502 0.48529854112235343289 -0.017235188549148662551 0.3406362280007165233 0.49835374463539022782 -0.0099883091075235602707 -0.15550097379182392654 1.5441006187024586271 -1.7982590269519487247 -1.1407649494371625565 -0.20955024231993293893 -0.90049605990761161234 -0.42541322056504360383 0.71176021332735406322 0.57276248548979347142 0.72595035340155500414 0.23121875977751751852;-0.077729993084232160139 0.25033153046970224587 -0.15422997798198140318 -0.15923499296417531479 0.65798759746770807411 0.8353781639718117491 0.075760173789959570079 0.20204582884560504108 0.11009380132912263695 -0.29668540547420940712 -0.24076065065471902171 0.32227132772476418943 -0.72451701460863782156 -0.023755953737341753418 -0.37235291212225990476 -0.33230668371616572943 0.0045059890240585626087 1.080529915882883385 0.30850039602588918974 -0.35044352938187384172 -0.051372042684734040008 -0.24194800775097957679 -0.014058331278707182632 0.19372668312372792743 -0.2267103293670319486 0.42559895747683107459 0.1590013330148803139 0.4970420301014893405 -0.38331296596347497196 0.52359172130810938128;-0.33495743137842154402 -0.14719171305253617166 -0.60242858400849985667 -0.12512595437083706695 0.60156023875817055124 0.51523322202583521356 -0.81568238853536634281 0.74331652250919455494 0.12085171376915564145 0.24259863936998160572 -0.14545366737829654169 0.14838564421283670369 0.014188024325696831085 0.26838742223620659644 -0.21840506199364892459 -0.26451318644008531278 -0.36666590730172549106 0.13987882280704549975 -0.7412462285245453586 -0.62430542393717591843 -0.020774564738828164151 -0.63921023982032110222 -0.33760525874851354811 -0.1988609316109037628 -1.1048040605095854616 0.30524582616352541331 -0.46982224024660373951 -0.083807456806068547639 0.29386820641879929372 0.62718112193327779647;-0.66893376490262335121 1.5872019943198794056 0.11128024989671601863 -0.078619834291160373141 -0.50400621693288027991 -0.33962660032170399749 0.031455342272361949685 -0.4435180641673451829 0.65512836119809991775 0.16170191965808045076 0.85959375372743929145 0.065200639845631014335 -0.38820315229025448289 0.56379615129114823979 -0.18331932378703089115 0.2319616914984812539 -1.0660363321212669163 -0.69286430009798138929 -1.3501528556883806154 -0.024549341781436691962 -1.1839595479466609174 0.54176194101052288499 0.013955253857385326727 0.14996391112177789862 0.43198325486777211513 -0.38116160791879510894 -0.17907331917232527374 -0.049327140372914857203 0.32469268338872431245 0.24235812506088100227;-0.023206763494036063838 0.036960831859721439419 0.20359016557391895752 0.31803413537677099887 -0.36621371252675832819 0.23559355593783895544 0.42018950952134692667 0.27741366245968601678 0.0065211027774911174693 0.62235428219754951318 0.46698639191758711808 -0.082131721000790081089 0.3853273320266813462 0.18686030345128387675 0.091260953755876894622 0.0258454571386637251 -0.092015067860299323832 -0.47708980173391668522 0.24986234317563282836 0.52877353872997290285 0.70562364600679605697 -0.46612354564550301239 -0.28613798215229208077 -0.91974621698278280491 -0.095583861149878449059 -0.033970361060794374009 0.59878251630065648659 0.31333844766126445203 0.59986754600925173975 -0.15059279876362716144;0.12481079825363820823 -0.82159388672449396029 -0.41156848978085219803 0.36199304365442058762 1.4491757948728301031 2.7855053817603736555 -0.80863815826932017305 0.67990303921434724899 1.1381012727503769799 0.15747819874663768203 -0.079834284998170509939 0.52073031993659835148 -0.31636566266710558493 1.2527720832344968471 0.83040879651044974263 -0.076716318843964612095 -0.4365797328141295397 0.51567998852066543325 0.92195849241588956335 0.98790079660208818257 -0.48765168787049018029 -1.163450998936524261 -0.93156953079623328051 -1.8640975546062350521 0.66943449492780116028 0.71382295437304343899 -0.11662965519298452988 0.20629117077524855572 -1.1273796109321778669 -1.1052645262859555064;-0.5155775603595769141 -0.34750663440623968947 0.30808308411681495365 -0.11557833133416148264 -0.34246604089992704889 -2.4300326808907608545 0.71948945038573752786 0.35328030405800459057 0.4050283120471203091 0.065292712264349767048 -0.025352044787836792994 0.03472858098514805536 -0.54743138309220618076 0.31838017479252933573 -0.49991758295194566042 -0.52044530809465949783 0.35307325036082287673 0.57083917463465028153 -0.73919541574379155069 0.056353740221385437148 0.31631416366588649414 1.3005924726749824583 0.18599478868252822261 0.80489572955575239277 -0.68382833794786634929 -0.79196513528922329872 0.19524420075629975169 -0.79130257686130145434 -0.91885729509687252836 0.67800292632694836303];

% Layer 3
b3 = -0.42807630717637845663;
LW3_2 = [0.50773722362589657209 -0.58998490901238087591 -0.30207352452771585316 0.55695552160265371366 -1.0690088613049197885 1.0581462142772044555 0.14885384666099388262 -0.81857901485691331178 2.3786107495154600322 1.276171295863091304];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.604229607250755;
y1_step1.xoffset = -0.03;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
