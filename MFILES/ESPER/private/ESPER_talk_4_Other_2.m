function [Y,Xf,Af] = ESPER_talk_4_Other_2(X,~,~)
%ESPER_TALK_4_OTHER_2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 12-Jan-2021 17:03:45.
% 
% [Y] = ESPER_talk_4_Other_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999984769129;-0.999540494077341;-75.751;0;29.715;-2.05132667284751;-0.1386];
x1_step1.gain = [1.00000001035699;1.00022983623563;0.0140762793578401;0.000302617642608564;0.251952632905014;0.0584431850247228;0.00826143816767911];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.7198529812044454;-6.9812745921347572;2.1345386151011887;6.0728960352869095;0.029777288886470882;0.52781474547594687;0.055094866975670578;0.50114470776233078;-0.59922420305508772;0.21354319414605474;0.28596668465863506;2.4542570378774973;-0.46850384699836101;1.5868152959433093;0.60868533284114468;0.79057275095732671;-0.68381169255592689;-1.5536937366664747;-0.47048850552166277;-1.512361763390117];
IW1_1 = [0.83750131742486444 0.24527787994112116 -2.3145197556069501 -0.29513959066017631 -0.14625413288565087 -0.20220573235501382 0.89975663804006589;4.4481822021237827 -2.652251048780327 -0.50777266880278871 -0.0011800993444956095 -0.3568306589591777 0.059639391186715747 1.0327625841529802;-0.43464031728757996 0.088879959806950973 2.5931109650599797 0.066401455236797344 0.6161779232580229 1.1468231916277576 -0.55964540872483637;-0.11571236071765187 0.061165398851828964 -0.20561527700655979 4.3419264959432002 -1.3388212840613471 0.7725839064399469 0.70572825578629339;-0.18551582534324926 0.21035878999260474 -0.43963455461252127 0.23067334853874136 1.6328134415971622 0.92208429706503803 -0.6645805823059201;-0.74403584725582383 0.45554506650539595 0.25900103943317676 -0.18994551463364134 1.723787207665491 1.2535308171805073 -0.85241632476090234;0.051871454134703801 -0.19327064698252175 0.16341053349389889 0.355364165070788 0.62218718473051449 1.4250234642172876 -1.1803740722259548;0.13794840002119971 0.059089208641457065 0.20908280577910196 -0.41883155637366515 -1.5445765566566207 -0.33436392282349053 0.14978088393125311;0.33364988426461178 0.11103468595439665 -1.0335933335285923 -0.44177451977225607 2.1295948821105242 -0.77396466719136492 0.16026323314731361;-0.65967660487095692 -0.55947725823139838 2.4828901412539892 -0.15932322394298229 -0.76761427916584946 -0.35264747845349531 -0.018882141932592588;0.12283314459222462 -0.074476929151971724 -0.49183860568215632 -0.098217490454781287 0.10126123558273084 0.26141473548843558 -0.14364888335136491;-0.31319156705490458 0.21299916786203191 -1.6962477428348224 -0.52313700209713465 -2.5915239549830256 1.7642924925813237 0.07997741999766815;0.72927436996588968 0.56497703558902879 0.069809017182152086 0.12511443858653967 1.7656585982477735 -0.46195029294702378 0.0098947085139466373;-0.48856935996958017 0.14255969966798346 -0.63735521342191093 0.37505238537930313 1.1856860939392764 -0.24693228193158148 0.89964804882369065;0.65869775670997111 -0.76366097767677765 -0.092149965026641675 -0.0034979806146172533 -1.8626609881758698 0.27810154580284119 -0.29283784944560748;-0.1691633349855434 -0.2413231701173183 -0.81518831653864665 -0.47994361545135406 -0.66588924645945924 -0.067768380132169431 0.6571420242467888;-0.19115467389691354 -0.47109813765458508 -0.3769460716411635 -0.20212357886923146 1.716259566927347 -0.55129232005898476 0.1469476574007276;0.80988476531635689 -0.028786827215864418 0.86204343590692678 0.39805297554661895 -0.95334941822144459 -1.7599416264253502 0.53165270926042651;0.18402905068420713 -0.18644084803039906 0.47459851952139426 -0.79493611527968 -1.1912641270530386 -1.9793579294138981 -0.63424617096700298;-0.36793430218305173 -0.070036662830154237 1.247774224186756 0.44694780092003833 -0.96836477410810851 -1.4246468108409631 -0.60168239714948013];

% Layer 2
b2 = [7.392638204255177;-1.6666660753761879;0.43465485352594263;3.8074247736091387;3.0158920880239779;-1.3982471181196345;-2.3427959352417447;-2.9260723069293433;3.0182136534459079;-2.9625898731331013;-3.7796716645078257;2.3746071202234238;-1.6126368860206013;2.5952253345381791;-1.9403131839430809;2.2919356163100164;-1.5251097398030224;-0.30012636324041869;3.4094289490471059;-5.0734685529076771];
LW2_1 = [2.1062562557213291 -1.5365409107087702 0.0019215161678433658 -1.7837538463326368 1.0274854184355813 -0.78709669638950841 -1.5277403785957855 -8.4984155573599072 -0.023933834157469129 0.072769543286610686 -1.6706048169290479 -1.8908782315824644 -1.677541820381993 -5.1808666059861688 0.52251042838244643 0.064038880722145586 -2.1525166566554934 1.0712500751479659 3.9265283678943161 -2.1216956542839474;0.85243570643592226 -3.1832603122776151 0.78508033408879652 -0.6830246478494334 -0.15883027868464375 -0.63391988926559917 1.0909965040469851 0.15528867129628934 0.68529251924507317 -0.37093954179280342 -3.5187715299204401 1.3306352590224073 0.19839955298390222 -1.6703792198189924 -0.3496090371615288 0.028358245545606856 -0.10303348593620758 0.9390210836228956 0.43617193520170294 -0.24755699869333919;0.30628533297752736 -0.2073507017631453 -0.22879453566026425 -1.2418745513851999 -3.4428100721971457 0.56974704707463109 0.58284132789725374 -2.7867653503631593 0.79167443586862418 0.18027639603895659 2.2875183412666176 -3.6084158476224357 0.72030000543610129 0.1346163915571022 1.393934750393901 0.60780053491929797 -1.5833887189805784 -3.2583884122625371 1.042115874461861 -0.90226500421962041;2.3174601355305393 -3.4582410994866506 0.14652097083775908 -3.1736757349176208 3.7087842520126788 -1.9110668483724766 -1.9206516577278827 -6.4494957178569869 2.8718291292756097 0.79513006557133126 -10.859410669671643 -1.5967137387156261 -3.8771688272952787 -4.5550344391902753 0.32439315947285918 2.4916635829694265 -3.4248025487123113 -0.75585604342814749 2.8805875684307556 -1.6549425398627644;-1.4160750105080699 1.9625808973041545 -2.1673510334739583 0.36146368627920833 -0.43689613636637648 1.2998415609124871 -0.13435234508460911 -2.7102802795518137 0.18988870396889396 0.20027705207611793 3.3731464958331587 0.37509488958594495 -1.5483521988552624 1.1475343703769356 0.538176585302377 -0.52330589756997425 -1.5573311367274363 1.7765135680177231 1.9104670979345593 1.1365479929577491;-2.8102980312707349 -7.026751805109714 1.0661941565394273 -9.6249514562503666 3.4091531732270983 -4.1118964515644896 -0.065569908807461302 2.8534392396354384 1.1316246459627954 6.7721891489829016 -7.2409399448053602 0.37199492925972222 0.95233140273752703 -4.2457574782893728 1.5624151516053058 2.9821841370464992 1.6641636588836464 5.9075868554527 1.8598601656606459 -0.51687879981306595;-1.3391055968489527 -2.4835990729921602 -1.9272252966593963 1.5410680776388099 0.64318079960692731 -0.50262105397035739 1.6062916317262834 -1.1048905315232309 0.96872705957313698 0.01420350981993249 -3.6174941298446028 -1.3557276127772369 0.21621711473195648 -0.26305963786115638 -0.46303652697394743 2.1983156043129437 -0.37907828973020252 0.093178786067460689 -0.25368154458587661 -1.0398290135392414;-0.4803931981277218 -2.2961651271338903 0.41561175993808547 -0.57980539574618617 -0.60327783530850554 -0.57598702385394607 -0.25668385547375439 -5.3907633161716948 4.963867446541645 -0.58360005619823929 0.092068956963061499 0.055661384707030089 0.098983505736290667 -1.2386239593870865 0.10097876926972084 3.0200167717928772 -1.7502631772441501 0.29695718069849403 2.8097131665322914 5.0272594865340636;1.9143130210860151 0.43481621764493905 0.41092258713043217 -1.814211352127524 0.27682867762733515 -0.11742259982116869 1.0947307819335479 1.1452800676998875 2.4696629391294946 -1.3970030018120467 -2.8846426281373647 -1.0700575508712364 -3.0702106147865287 0.89490782723629891 0.090963380282181192 -3.4771473799964379 -1.2875573430134077 -0.64476869406286608 -0.067774857067124106 -1.0666388729582881;-0.77765924756838722 -0.95960548210391361 -1.0582262832303504 0.31809866737177728 -0.029009026826696933 0.82995930022076081 -0.59623388473236305 -1.2381242158852306 -0.08324370693827933 0.16585919432979646 2.1330385826477514 1.134569641350526 -0.94081621907661006 1.8991024745489815 0.52886719106739521 -0.75919652143248917 -0.57002032210409859 0.6607388404503115 0.64900133294800111 0.12927866807795305;0.00067381683920544541 -4.9239084686899295 -1.3700696605003884 -0.45615579156875902 2.3153798122767011 -0.53442370313616094 1.3935925131872586 2.5055153804317651 0.47311345579733638 -0.26926059009534786 -6.682185927032867 -0.87400557336250706 0.71016877595722638 1.5543467945082108 0.042878876747680858 3.4187422034910124 0.50909402855434793 0.972065133645583 -1.2910432287628788 -1.2591128680156733;-0.11620452818492458 0.58220063520624132 -0.10493815698198587 0.091353509869775126 -2.4179102777078922 0.81043000839217516 -0.37843856246044655 -1.5903348324827973 -1.0360414837625849 -0.2701846929961661 4.6332142959716958 0.01304271360961113 -0.14368615240599239 -1.3630398638704002 -0.40612697039166823 -0.96696897249052416 -0.24449518344930943 0.24873514652654996 0.89944818312538222 1.0391032755741674;1.3126058973599015 2.1583278760256364 2.2603487676932592 0.052533329247213878 -3.0680413673874223 2.3786008601158741 0.57478462331981095 2.6674547572932759 -1.6469836869325465 -0.58697825044052154 -0.67391525047244571 -0.23582332480494983 0.93936908882111991 3.2572263344521573 0.92222347044248798 -0.21806460397307706 1.7511766807608515 -0.20586418401073722 -2.2802024604150688 -2.3404650398648874;0.94568990800285746 -0.84261742109854632 1.3222813858931539 -1.9269571892096256 -2.0326141159678035 -1.3432468524831738 -0.67017197041283783 -4.2030772927591542 -1.2944156149205901 -0.380799058290547 1.251017910091055 0.75070260945593403 -0.91926875804861752 -2.5968868522346673 -0.18075249297640092 -1.3829233887198573 -0.77447792687860251 -2.3299012178321887 0.78468430730260386 -1.2784678314206934;-0.67535148979125958 0.65499850194027953 -0.148591620418728 -1.8895342482045996 3.9293495088524519 -1.4065732301057035 -0.19473106289483491 4.5993555778345687 0.52134310636883874 0.40590142377220395 1.379136252581344 0.068039698509352486 -0.79933101226954251 3.8081566215336462 -0.43804990697471552 0.32443934031316968 -0.69192815841382593 0.83369074561215895 -0.66788440519059011 1.2714527228911296;0.12561962351373412 0.50983245907645591 0.50355526539724516 -0.80420210175730311 0.95246037588716947 -0.82559424799926451 -0.62501281976836998 0.0033326533866277746 -0.0095186248487016938 -0.0096316162888101346 -0.35141672543473684 -0.69172485084333735 0.0099873111486478879 -0.28719467097191703 -0.081925358806680476 -0.39215017317256246 0.29642008686716509 -0.87334510692101741 -0.25980981075268195 0.16585926717920732;-7.2587498148351735 2.9952911984497219 -2.3384530976346571 0.85954256126127393 -1.6209987493771445 -2.2332149774275476 2.4361480636951018 1.5123381281907311 2.3740855803773799 0.99028007977511556 0.42901090241264206 -1.2332439965936079 -0.9968828391219281 -1.366861018254697 -2.3510206428988152 -0.58144056998875771 -0.30254254542618048 -0.75444159012262191 -0.26090484736677627 0.57901707337323738;-0.73347259024706235 -1.8014022025089451 2.4273840080241094 1.6869727844506908 -1.0878981332547704 -1.7603834118519206 -0.14800116859235524 1.6115168871292009 2.6238994978881949 -3.1810452835469345 -3.8859062382276841 0.9070661675950249 -1.2876234088575036 -3.3182379077640349 0.67775105608633879 -9.0564540191606078 3.8227374548153175 -3.3909818218818586 0.52464517418516554 1.3592217456026732;2.8095997309744485 -0.02212930471296681 2.977678041055936 -1.2027519108689695 2.9601100245207177 -1.6633374667748839 -0.20359344506533611 -0.42003017842884738 2.1024872295405155 -0.97327271863200604 -7.181936309231455 3.4339640433002541 -1.7815388313559564 0.40872711953948671 0.93607144149449051 -3.8660785870826255 0.061820900171426302 -0.45054597205700159 2.1341277924108293 0.42000330208817116;2.0130016233426842 -4.9717537273402597 1.540166515424662 -3.9736621807979686 3.3938662273485294 -2.7645992546478881 -3.7070842751857582 -4.0860195139140529 5.5030953380493406 2.5669984532469523 -5.1197628775713948 0.80861058083785009 -2.1009531746335641 0.91468721086432669 1.6450340433566355 0.21068009878694743 -3.6298737480811765 -4.0900093722701136 -0.70760299381936509 0.54250907668514314];

% Layer 3
b3 = -0.21334797686795515;
LW3_2 = [0.06875165899407007 0.52389309827022512 0.074271576099431844 -0.083320488521008776 -0.31731030941589111 -0.020909903673371671 0.22562642364883964 -0.24932103745563602 -0.10680622899195574 0.60957680342054643 0.22504136808386599 0.47051374932108575 0.16102569305361372 -0.16870478863311683 -0.11449979775182856 0.9369742933970665 0.18005428025349032 -0.040661957346443144 0.10627872310578033 0.060874482400053935];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00492610837438424;
y1_step1.xoffset = 2075.6;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
